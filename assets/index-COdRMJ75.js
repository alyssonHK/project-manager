var cPe=Object.defineProperty;var uPe=(t,e,n)=>e in t?cPe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var N=(t,e,n)=>uPe(t,typeof e!="symbol"?e+"":e,n);function dPe(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Oi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var r2={exports:{}},U0={},i2={exports:{}},Wt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fV;function hPe(){if(fV)return Wt;fV=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;function h(U){return U===null||typeof U!="object"?null:(U=d&&U[d]||U["@@iterator"],typeof U=="function"?U:null)}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,b={};function v(U,J,ge){this.props=U,this.context=J,this.refs=b,this.updater=ge||f}v.prototype.isReactComponent={},v.prototype.setState=function(U,J){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,J,"setState")},v.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function x(){}x.prototype=v.prototype;function C(U,J,ge){this.props=U,this.context=J,this.refs=b,this.updater=ge||f}var E=C.prototype=new x;E.constructor=C,y(E,v.prototype),E.isPureReactComponent=!0;var I=Array.isArray,P=Object.prototype.hasOwnProperty,_={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function D(U,J,ge){var _e,fe={},je=null,Ae=null;if(J!=null)for(_e in J.ref!==void 0&&(Ae=J.ref),J.key!==void 0&&(je=""+J.key),J)P.call(J,_e)&&!A.hasOwnProperty(_e)&&(fe[_e]=J[_e]);var ke=arguments.length-2;if(ke===1)fe.children=ge;else if(1<ke){for(var le=Array(ke),ve=0;ve<ke;ve++)le[ve]=arguments[ve+2];fe.children=le}if(U&&U.defaultProps)for(_e in ke=U.defaultProps,ke)fe[_e]===void 0&&(fe[_e]=ke[_e]);return{$$typeof:t,type:U,key:je,ref:Ae,props:fe,_owner:_.current}}function L(U,J){return{$$typeof:t,type:U.type,key:J,ref:U.ref,props:U.props,_owner:U._owner}}function z(U){return typeof U=="object"&&U!==null&&U.$$typeof===t}function $(U){var J={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(ge){return J[ge]})}var H=/\/+/g;function R(U,J){return typeof U=="object"&&U!==null&&U.key!=null?$(""+U.key):J.toString(36)}function j(U,J,ge,_e,fe){var je=typeof U;(je==="undefined"||je==="boolean")&&(U=null);var Ae=!1;if(U===null)Ae=!0;else switch(je){case"string":case"number":Ae=!0;break;case"object":switch(U.$$typeof){case t:case e:Ae=!0}}if(Ae)return Ae=U,fe=fe(Ae),U=_e===""?"."+R(Ae,0):_e,I(fe)?(ge="",U!=null&&(ge=U.replace(H,"$&/")+"/"),j(fe,J,ge,"",function(ve){return ve})):fe!=null&&(z(fe)&&(fe=L(fe,ge+(!fe.key||Ae&&Ae.key===fe.key?"":(""+fe.key).replace(H,"$&/")+"/")+U)),J.push(fe)),1;if(Ae=0,_e=_e===""?".":_e+":",I(U))for(var ke=0;ke<U.length;ke++){je=U[ke];var le=_e+R(je,ke);Ae+=j(je,J,ge,le,fe)}else if(le=h(U),typeof le=="function")for(U=le.call(U),ke=0;!(je=U.next()).done;)je=je.value,le=_e+R(je,ke++),Ae+=j(je,J,ge,le,fe);else if(je==="object")throw J=String(U),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.");return Ae}function B(U,J,ge){if(U==null)return U;var _e=[],fe=0;return j(U,_e,"","",function(je){return J.call(ge,je,fe++)}),_e}function K(U){if(U._status===-1){var J=U._result;J=J(),J.then(function(ge){(U._status===0||U._status===-1)&&(U._status=1,U._result=ge)},function(ge){(U._status===0||U._status===-1)&&(U._status=2,U._result=ge)}),U._status===-1&&(U._status=0,U._result=J)}if(U._status===1)return U._result.default;throw U._result}var G={current:null},V={transition:null},W={ReactCurrentDispatcher:G,ReactCurrentBatchConfig:V,ReactCurrentOwner:_};function Z(){throw Error("act(...) is not supported in production builds of React.")}return Wt.Children={map:B,forEach:function(U,J,ge){B(U,function(){J.apply(this,arguments)},ge)},count:function(U){var J=0;return B(U,function(){J++}),J},toArray:function(U){return B(U,function(J){return J})||[]},only:function(U){if(!z(U))throw Error("React.Children.only expected to receive a single React element child.");return U}},Wt.Component=v,Wt.Fragment=n,Wt.Profiler=i,Wt.PureComponent=C,Wt.StrictMode=r,Wt.Suspense=l,Wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W,Wt.act=Z,Wt.cloneElement=function(U,J,ge){if(U==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+U+".");var _e=y({},U.props),fe=U.key,je=U.ref,Ae=U._owner;if(J!=null){if(J.ref!==void 0&&(je=J.ref,Ae=_.current),J.key!==void 0&&(fe=""+J.key),U.type&&U.type.defaultProps)var ke=U.type.defaultProps;for(le in J)P.call(J,le)&&!A.hasOwnProperty(le)&&(_e[le]=J[le]===void 0&&ke!==void 0?ke[le]:J[le])}var le=arguments.length-2;if(le===1)_e.children=ge;else if(1<le){ke=Array(le);for(var ve=0;ve<le;ve++)ke[ve]=arguments[ve+2];_e.children=ke}return{$$typeof:t,type:U.type,key:fe,ref:je,props:_e,_owner:Ae}},Wt.createContext=function(U){return U={$$typeof:o,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},U.Provider={$$typeof:s,_context:U},U.Consumer=U},Wt.createElement=D,Wt.createFactory=function(U){var J=D.bind(null,U);return J.type=U,J},Wt.createRef=function(){return{current:null}},Wt.forwardRef=function(U){return{$$typeof:a,render:U}},Wt.isValidElement=z,Wt.lazy=function(U){return{$$typeof:u,_payload:{_status:-1,_result:U},_init:K}},Wt.memo=function(U,J){return{$$typeof:c,type:U,compare:J===void 0?null:J}},Wt.startTransition=function(U){var J=V.transition;V.transition={};try{U()}finally{V.transition=J}},Wt.unstable_act=Z,Wt.useCallback=function(U,J){return G.current.useCallback(U,J)},Wt.useContext=function(U){return G.current.useContext(U)},Wt.useDebugValue=function(){},Wt.useDeferredValue=function(U){return G.current.useDeferredValue(U)},Wt.useEffect=function(U,J){return G.current.useEffect(U,J)},Wt.useId=function(){return G.current.useId()},Wt.useImperativeHandle=function(U,J,ge){return G.current.useImperativeHandle(U,J,ge)},Wt.useInsertionEffect=function(U,J){return G.current.useInsertionEffect(U,J)},Wt.useLayoutEffect=function(U,J){return G.current.useLayoutEffect(U,J)},Wt.useMemo=function(U,J){return G.current.useMemo(U,J)},Wt.useReducer=function(U,J,ge){return G.current.useReducer(U,J,ge)},Wt.useRef=function(U){return G.current.useRef(U)},Wt.useState=function(U){return G.current.useState(U)},Wt.useSyncExternalStore=function(U,J,ge){return G.current.useSyncExternalStore(U,J,ge)},Wt.useTransition=function(){return G.current.useTransition()},Wt.version="18.3.1",Wt}var pV;function hv(){return pV||(pV=1,i2.exports=hPe()),i2.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gV;function fPe(){if(gV)return U0;gV=1;var t=hv(),e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,c){var u,d={},h=null,f=null;c!==void 0&&(h=""+c),l.key!==void 0&&(h=""+l.key),l.ref!==void 0&&(f=l.ref);for(u in l)r.call(l,u)&&!s.hasOwnProperty(u)&&(d[u]=l[u]);if(a&&a.defaultProps)for(u in l=a.defaultProps,l)d[u]===void 0&&(d[u]=l[u]);return{$$typeof:e,type:a,key:h,ref:f,props:d,_owner:i.current}}return U0.Fragment=n,U0.jsx=o,U0.jsxs=o,U0}var mV;function pPe(){return mV||(mV=1,r2.exports=fPe()),r2.exports}var g=pPe(),S=hv();const $e=Oi(S),S_=dPe({__proto__:null,default:$e},[S]);var dC={},s2={exports:{}},Fo={},o2={exports:{}},a2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yV;function gPe(){return yV||(yV=1,function(t){function e(V,W){var Z=V.length;V.push(W);e:for(;0<Z;){var U=Z-1>>>1,J=V[U];if(0<i(J,W))V[U]=W,V[Z]=J,Z=U;else break e}}function n(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var W=V[0],Z=V.pop();if(Z!==W){V[0]=Z;e:for(var U=0,J=V.length,ge=J>>>1;U<ge;){var _e=2*(U+1)-1,fe=V[_e],je=_e+1,Ae=V[je];if(0>i(fe,Z))je<J&&0>i(Ae,fe)?(V[U]=Ae,V[je]=Z,U=je):(V[U]=fe,V[_e]=Z,U=_e);else if(je<J&&0>i(Ae,Z))V[U]=Ae,V[je]=Z,U=je;else break e}}return W}function i(V,W){var Z=V.sortIndex-W.sortIndex;return Z!==0?Z:V.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,y=!1,b=!1,v=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(V){for(var W=n(c);W!==null;){if(W.callback===null)r(c);else if(W.startTime<=V)r(c),W.sortIndex=W.expirationTime,e(l,W);else break;W=n(c)}}function I(V){if(b=!1,E(V),!y)if(n(l)!==null)y=!0,K(P);else{var W=n(c);W!==null&&G(I,W.startTime-V)}}function P(V,W){y=!1,b&&(b=!1,x(D),D=-1),f=!0;var Z=h;try{for(E(W),d=n(l);d!==null&&(!(d.expirationTime>W)||V&&!$());){var U=d.callback;if(typeof U=="function"){d.callback=null,h=d.priorityLevel;var J=U(d.expirationTime<=W);W=t.unstable_now(),typeof J=="function"?d.callback=J:d===n(l)&&r(l),E(W)}else r(l);d=n(l)}if(d!==null)var ge=!0;else{var _e=n(c);_e!==null&&G(I,_e.startTime-W),ge=!1}return ge}finally{d=null,h=Z,f=!1}}var _=!1,A=null,D=-1,L=5,z=-1;function $(){return!(t.unstable_now()-z<L)}function H(){if(A!==null){var V=t.unstable_now();z=V;var W=!0;try{W=A(!0,V)}finally{W?R():(_=!1,A=null)}}else _=!1}var R;if(typeof C=="function")R=function(){C(H)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,B=j.port2;j.port1.onmessage=H,R=function(){B.postMessage(null)}}else R=function(){v(H,0)};function K(V){A=V,_||(_=!0,R())}function G(V,W){D=v(function(){V(t.unstable_now())},W)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_continueExecution=function(){y||f||(y=!0,K(P))},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(V){switch(h){case 1:case 2:case 3:var W=3;break;default:W=h}var Z=h;h=W;try{return V()}finally{h=Z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(V,W){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Z=h;h=V;try{return W()}finally{h=Z}},t.unstable_scheduleCallback=function(V,W,Z){var U=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?U+Z:U):Z=U,V){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=Z+J,V={id:u++,callback:W,priorityLevel:V,startTime:Z,expirationTime:J,sortIndex:-1},Z>U?(V.sortIndex=Z,e(c,V),n(l)===null&&V===n(c)&&(b?(x(D),D=-1):b=!0,G(I,Z-U))):(V.sortIndex=J,e(l,V),y||f||(y=!0,K(P))),V},t.unstable_shouldYield=$,t.unstable_wrapCallback=function(V){var W=h;return function(){var Z=h;h=W;try{return V.apply(this,arguments)}finally{h=Z}}}}(a2)),a2}var vV;function mPe(){return vV||(vV=1,o2.exports=gPe()),o2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bV;function yPe(){if(bV)return Fo;bV=1;var t=hv(),e=mPe();function n(p){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+p,w=1;w<arguments.length;w++)m+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function s(p,m){o(p,m),o(p+"Capture",m)}function o(p,m){for(i[p]=m,p=0;p<m.length;p++)r.add(m[p])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},d={};function h(p){return l.call(d,p)?!0:l.call(u,p)?!1:c.test(p)?d[p]=!0:(u[p]=!0,!1)}function f(p,m,w,T){if(w!==null&&w.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return T?!1:w!==null?!w.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function y(p,m,w,T){if(m===null||typeof m>"u"||f(p,m,w,T))return!0;if(T)return!1;if(w!==null)switch(w.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function b(p,m,w,T,k,O,F){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=T,this.attributeNamespace=k,this.mustUseProperty=w,this.propertyName=p,this.type=m,this.sanitizeURL=O,this.removeEmptyString=F}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){v[p]=new b(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var m=p[0];v[m]=new b(m,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){v[p]=new b(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){v[p]=new b(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){v[p]=new b(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){v[p]=new b(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){v[p]=new b(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){v[p]=new b(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){v[p]=new b(p,5,!1,p.toLowerCase(),null,!1,!1)});var x=/[\-:]([a-z])/g;function C(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var m=p.replace(x,C);v[m]=new b(m,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var m=p.replace(x,C);v[m]=new b(m,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var m=p.replace(x,C);v[m]=new b(m,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){v[p]=new b(p,1,!1,p.toLowerCase(),null,!1,!1)}),v.xlinkHref=new b("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){v[p]=new b(p,1,!1,p.toLowerCase(),null,!0,!0)});function E(p,m,w,T){var k=v.hasOwnProperty(m)?v[m]:null;(k!==null?k.type!==0:T||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(y(m,w,k,T)&&(w=null),T||k===null?h(m)&&(w===null?p.removeAttribute(m):p.setAttribute(m,""+w)):k.mustUseProperty?p[k.propertyName]=w===null?k.type===3?!1:"":w:(m=k.attributeName,T=k.attributeNamespace,w===null?p.removeAttribute(m):(k=k.type,w=k===3||k===4&&w===!0?"":""+w,T?p.setAttributeNS(T,m,w):p.setAttribute(m,w))))}var I=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,P=Symbol.for("react.element"),_=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),$=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),G=Symbol.for("react.offscreen"),V=Symbol.iterator;function W(p){return p===null||typeof p!="object"?null:(p=V&&p[V]||p["@@iterator"],typeof p=="function"?p:null)}var Z=Object.assign,U;function J(p){if(U===void 0)try{throw Error()}catch(w){var m=w.stack.trim().match(/\n( *(at )?)/);U=m&&m[1]||""}return`
`+U+p}var ge=!1;function _e(p,m){if(!p||ge)return"";ge=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(ce){var T=ce}Reflect.construct(p,[],m)}else{try{m.call()}catch(ce){T=ce}p.call(m.prototype)}else{try{throw Error()}catch(ce){T=ce}p()}}catch(ce){if(ce&&T&&typeof ce.stack=="string"){for(var k=ce.stack.split(`
`),O=T.stack.split(`
`),F=k.length-1,Y=O.length-1;1<=F&&0<=Y&&k[F]!==O[Y];)Y--;for(;1<=F&&0<=Y;F--,Y--)if(k[F]!==O[Y]){if(F!==1||Y!==1)do if(F--,Y--,0>Y||k[F]!==O[Y]){var Q=`
`+k[F].replace(" at new "," at ");return p.displayName&&Q.includes("<anonymous>")&&(Q=Q.replace("<anonymous>",p.displayName)),Q}while(1<=F&&0<=Y);break}}}finally{ge=!1,Error.prepareStackTrace=w}return(p=p?p.displayName||p.name:"")?J(p):""}function fe(p){switch(p.tag){case 5:return J(p.type);case 16:return J("Lazy");case 13:return J("Suspense");case 19:return J("SuspenseList");case 0:case 2:case 15:return p=_e(p.type,!1),p;case 11:return p=_e(p.type.render,!1),p;case 1:return p=_e(p.type,!0),p;default:return""}}function je(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case A:return"Fragment";case _:return"Portal";case L:return"Profiler";case D:return"StrictMode";case R:return"Suspense";case j:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case $:return(p.displayName||"Context")+".Consumer";case z:return(p._context.displayName||"Context")+".Provider";case H:var m=p.render;return p=p.displayName,p||(p=m.displayName||m.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case B:return m=p.displayName||null,m!==null?m:je(p.type)||"Memo";case K:m=p._payload,p=p._init;try{return je(p(m))}catch{}}return null}function Ae(p){var m=p.type;switch(p.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=m.render,p=p.displayName||p.name||"",m.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return je(m);case 8:return m===D?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function ke(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function le(p){var m=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function ve(p){var m=le(p)?"checked":"value",w=Object.getOwnPropertyDescriptor(p.constructor.prototype,m),T=""+p[m];if(!p.hasOwnProperty(m)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var k=w.get,O=w.set;return Object.defineProperty(p,m,{configurable:!0,get:function(){return k.call(this)},set:function(F){T=""+F,O.call(this,F)}}),Object.defineProperty(p,m,{enumerable:w.enumerable}),{getValue:function(){return T},setValue:function(F){T=""+F},stopTracking:function(){p._valueTracker=null,delete p[m]}}}}function qe(p){p._valueTracker||(p._valueTracker=ve(p))}function de(p){if(!p)return!1;var m=p._valueTracker;if(!m)return!0;var w=m.getValue(),T="";return p&&(T=le(p)?p.checked?"true":"false":p.value),p=T,p!==w?(m.setValue(p),!0):!1}function pe(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Se(p,m){var w=m.checked;return Z({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??p._wrapperState.initialChecked})}function Fe(p,m){var w=m.defaultValue==null?"":m.defaultValue,T=m.checked!=null?m.checked:m.defaultChecked;w=ke(m.value!=null?m.value:w),p._wrapperState={initialChecked:T,initialValue:w,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function ut(p,m){m=m.checked,m!=null&&E(p,"checked",m,!1)}function Tt(p,m){ut(p,m);var w=ke(m.value),T=m.type;if(w!=null)T==="number"?(w===0&&p.value===""||p.value!=w)&&(p.value=""+w):p.value!==""+w&&(p.value=""+w);else if(T==="submit"||T==="reset"){p.removeAttribute("value");return}m.hasOwnProperty("value")?qn(p,m.type,w):m.hasOwnProperty("defaultValue")&&qn(p,m.type,ke(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(p.defaultChecked=!!m.defaultChecked)}function pn(p,m,w){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var T=m.type;if(!(T!=="submit"&&T!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+p._wrapperState.initialValue,w||m===p.value||(p.value=m),p.defaultValue=m}w=p.name,w!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,w!==""&&(p.name=w)}function qn(p,m,w){(m!=="number"||pe(p.ownerDocument)!==p)&&(w==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+w&&(p.defaultValue=""+w))}var ci=Array.isArray;function Yr(p,m,w,T){if(p=p.options,m){m={};for(var k=0;k<w.length;k++)m["$"+w[k]]=!0;for(w=0;w<p.length;w++)k=m.hasOwnProperty("$"+p[w].value),p[w].selected!==k&&(p[w].selected=k),k&&T&&(p[w].defaultSelected=!0)}else{for(w=""+ke(w),m=null,k=0;k<p.length;k++){if(p[k].value===w){p[k].selected=!0,T&&(p[k].defaultSelected=!0);return}m!==null||p[k].disabled||(m=p[k])}m!==null&&(m.selected=!0)}}function zl(p,m){if(m.dangerouslySetInnerHTML!=null)throw Error(n(91));return Z({},m,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Au(p,m){var w=m.value;if(w==null){if(w=m.children,m=m.defaultValue,w!=null){if(m!=null)throw Error(n(92));if(ci(w)){if(1<w.length)throw Error(n(93));w=w[0]}m=w}m==null&&(m=""),w=m}p._wrapperState={initialValue:ke(w)}}function Mu(p,m){var w=ke(m.value),T=ke(m.defaultValue);w!=null&&(w=""+w,w!==p.value&&(p.value=w),m.defaultValue==null&&p.defaultValue!==w&&(p.defaultValue=w)),T!=null&&(p.defaultValue=""+T)}function cs(p){var m=p.textContent;m===p._wrapperState.initialValue&&m!==""&&m!==null&&(p.value=m)}function Ga(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ya(p,m){return p==null||p==="http://www.w3.org/1999/xhtml"?Ga(m):p==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Po,Nc=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,w,T,k){MSApp.execUnsafeLocalFunction(function(){return p(m,w,T,k)})}:p}(function(p,m){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=m;else{for(Po=Po||document.createElement("div"),Po.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=Po.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;m.firstChild;)p.appendChild(m.firstChild)}});function ue(p,m){if(m){var w=p.firstChild;if(w&&w===p.lastChild&&w.nodeType===3){w.nodeValue=m;return}}p.textContent=m}var Re={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ft=["Webkit","ms","Moz","O"];Object.keys(Re).forEach(function(p){ft.forEach(function(m){m=m+p.charAt(0).toUpperCase()+p.substring(1),Re[m]=Re[p]})});function on(p,m,w){return m==null||typeof m=="boolean"||m===""?"":w||typeof m!="number"||m===0||Re.hasOwnProperty(p)&&Re[p]?(""+m).trim():m+"px"}function ui(p,m){p=p.style;for(var w in m)if(m.hasOwnProperty(w)){var T=w.indexOf("--")===0,k=on(w,m[w],T);w==="float"&&(w="cssFloat"),T?p.setProperty(w,k):p[w]=k}}var di=Z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ra(p,m){if(m){if(di[p]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(n(137,p));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(n(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(n(61))}if(m.style!=null&&typeof m.style!="object")throw Error(n(62))}}function Fi(p,m){if(p.indexOf("-")===-1)return typeof m.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xr=null;function us(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Xs=null,ds=null,ia=null;function Yd(p){if(p=P0(p)){if(typeof Xs!="function")throw Error(n(280));var m=p.stateNode;m&&(m=I1(m),Xs(p.stateNode,p.type,m))}}function Ul(p){ds?ia?ia.push(p):ia=[p]:ds=p}function jc(){if(ds){var p=ds,m=ia;if(ia=ds=null,Yd(p),m)for(p=0;p<m.length;p++)Yd(m[p])}}function _o(p,m){return p(m)}function Xd(){}var Hl=!1;function Jg(p,m,w){if(Hl)return p(m,w);Hl=!0;try{return _o(p,m,w)}finally{Hl=!1,(ds!==null||ia!==null)&&(Xd(),jc())}}function Ou(p,m){var w=p.stateNode;if(w===null)return null;var T=I1(w);if(T===null)return null;w=T[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(T=!T.disabled)||(p=p.type,T=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!T;break e;default:p=!1}if(p)return null;if(w&&typeof w!="function")throw Error(n(231,m,typeof w));return w}var qf=!1;if(a)try{var $i={};Object.defineProperty($i,"passive",{get:function(){qf=!0}}),window.addEventListener("test",$i,$i),window.removeEventListener("test",$i,$i)}catch{qf=!1}function o0(p,m,w,T,k,O,F,Y,Q){var ce=Array.prototype.slice.call(arguments,3);try{m.apply(w,ce)}catch(Te){this.onError(Te)}}var Lc=!1,Fc=null,ko=!1,Gf=null,Vl={onError:function(p){Lc=!0,Fc=p}};function a0(p,m,w,T,k,O,F,Y,Q){Lc=!1,Fc=null,o0.apply(Vl,arguments)}function l0(p,m,w,T,k,O,F,Y,Q){if(a0.apply(this,arguments),Lc){if(Lc){var ce=Fc;Lc=!1,Fc=null}else throw Error(n(198));ko||(ko=!0,Gf=ce)}}function Wl(p){var m=p,w=p;if(p.alternate)for(;m.return;)m=m.return;else{p=m;do m=p,(m.flags&4098)!==0&&(w=m.return),p=m.return;while(p)}return m.tag===3?w:null}function Ao(p){if(p.tag===13){var m=p.memoizedState;if(m===null&&(p=p.alternate,p!==null&&(m=p.memoizedState)),m!==null)return m.dehydrated}return null}function Zg(p){if(Wl(p)!==p)throw Error(n(188))}function Jd(p){var m=p.alternate;if(!m){if(m=Wl(p),m===null)throw Error(n(188));return m!==p?null:p}for(var w=p,T=m;;){var k=w.return;if(k===null)break;var O=k.alternate;if(O===null){if(T=k.return,T!==null){w=T;continue}break}if(k.child===O.child){for(O=k.child;O;){if(O===w)return Zg(k),p;if(O===T)return Zg(k),m;O=O.sibling}throw Error(n(188))}if(w.return!==T.return)w=k,T=O;else{for(var F=!1,Y=k.child;Y;){if(Y===w){F=!0,w=k,T=O;break}if(Y===T){F=!0,T=k,w=O;break}Y=Y.sibling}if(!F){for(Y=O.child;Y;){if(Y===w){F=!0,w=O,T=k;break}if(Y===T){F=!0,T=O,w=k;break}Y=Y.sibling}if(!F)throw Error(n(189))}}if(w.alternate!==T)throw Error(n(190))}if(w.tag!==3)throw Error(n(188));return w.stateNode.current===w?p:m}function Qg(p){return p=Jd(p),p!==null?em(p):null}function em(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var m=em(p);if(m!==null)return m;p=p.sibling}return null}var sa=e.unstable_scheduleCallback,Xa=e.unstable_cancelCallback,c0=e.unstable_shouldYield,u0=e.unstable_requestPaint,Ln=e.unstable_now,d0=e.unstable_getCurrentPriorityLevel,Yf=e.unstable_ImmediatePriority,Ja=e.unstable_UserBlockingPriority,Zd=e.unstable_NormalPriority,tm=e.unstable_LowPriority,oa=e.unstable_IdlePriority,Qd=null,Mo=null;function h0(p){if(Mo&&typeof Mo.onCommitFiberRoot=="function")try{Mo.onCommitFiberRoot(Qd,p,void 0,(p.current.flags&128)===128)}catch{}}var hs=Math.clz32?Math.clz32:Kl,f0=Math.log,p0=Math.LN2;function Kl(p){return p>>>=0,p===0?32:31-(f0(p)/p0|0)|0}var aa=64,Jr=4194304;function $c(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Du(p,m){var w=p.pendingLanes;if(w===0)return 0;var T=0,k=p.suspendedLanes,O=p.pingedLanes,F=w&268435455;if(F!==0){var Y=F&~k;Y!==0?T=$c(Y):(O&=F,O!==0&&(T=$c(O)))}else F=w&~k,F!==0?T=$c(F):O!==0&&(T=$c(O));if(T===0)return 0;if(m!==0&&m!==T&&(m&k)===0&&(k=T&-T,O=m&-m,k>=O||k===16&&(O&4194240)!==0))return m;if((T&4)!==0&&(T|=w&16),m=p.entangledLanes,m!==0)for(p=p.entanglements,m&=T;0<m;)w=31-hs(m),k=1<<w,T|=p[w],m&=~k;return T}function g0(p,m){switch(p){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function m0(p,m){for(var w=p.suspendedLanes,T=p.pingedLanes,k=p.expirationTimes,O=p.pendingLanes;0<O;){var F=31-hs(O),Y=1<<F,Q=k[F];Q===-1?((Y&w)===0||(Y&T)!==0)&&(k[F]=g0(Y,m)):Q<=m&&(p.expiredLanes|=Y),O&=~Y}}function la(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Xf(){var p=aa;return aa<<=1,(aa&4194240)===0&&(aa=64),p}function eh(p){for(var m=[],w=0;31>w;w++)m.push(p);return m}function ql(p,m,w){p.pendingLanes|=m,m!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,m=31-hs(m),p[m]=w}function nm(p,m){var w=p.pendingLanes&~m;p.pendingLanes=m,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=m,p.mutableReadLanes&=m,p.entangledLanes&=m,m=p.entanglements;var T=p.eventTimes;for(p=p.expirationTimes;0<w;){var k=31-hs(w),O=1<<k;m[k]=0,T[k]=-1,p[k]=-1,w&=~O}}function th(p,m){var w=p.entangledLanes|=m;for(p=p.entanglements;w;){var T=31-hs(w),k=1<<T;k&m|p[T]&m&&(p[T]|=m),w&=~k}}var qt=0;function Za(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Jf,Ru,Js,rm,Zf,X=!1,se=[],Ie=null,He=null,tn=null,Et=new Map,An=new Map,Fn=[],fr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zr(p,m){switch(p){case"focusin":case"focusout":Ie=null;break;case"dragenter":case"dragleave":He=null;break;case"mouseover":case"mouseout":tn=null;break;case"pointerover":case"pointerout":Et.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":An.delete(m.pointerId)}}function Tr(p,m,w,T,k,O){return p===null||p.nativeEvent!==O?(p={blockedOn:m,domEventName:w,eventSystemFlags:T,nativeEvent:O,targetContainers:[k]},m!==null&&(m=P0(m),m!==null&&Ru(m)),p):(p.eventSystemFlags|=T,m=p.targetContainers,k!==null&&m.indexOf(k)===-1&&m.push(k),p)}function fs(p,m,w,T,k){switch(m){case"focusin":return Ie=Tr(Ie,p,m,w,T,k),!0;case"dragenter":return He=Tr(He,p,m,w,T,k),!0;case"mouseover":return tn=Tr(tn,p,m,w,T,k),!0;case"pointerover":var O=k.pointerId;return Et.set(O,Tr(Et.get(O)||null,p,m,w,T,k)),!0;case"gotpointercapture":return O=k.pointerId,An.set(O,Tr(An.get(O)||null,p,m,w,T,k)),!0}return!1}function Ir(p){var m=Qf(p.target);if(m!==null){var w=Wl(m);if(w!==null){if(m=w.tag,m===13){if(m=Ao(w),m!==null){p.blockedOn=m,Zf(p.priority,function(){Js(w)});return}}else if(m===3&&w.stateNode.current.memoizedState.isDehydrated){p.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}p.blockedOn=null}function rr(p){if(p.blockedOn!==null)return!1;for(var m=p.targetContainers;0<m.length;){var w=Mn(p.domEventName,p.eventSystemFlags,m[0],p.nativeEvent);if(w===null){w=p.nativeEvent;var T=new w.constructor(w.type,w);Xr=T,w.target.dispatchEvent(T),Xr=null}else return m=P0(w),m!==null&&Ru(m),p.blockedOn=w,!1;m.shift()}return!0}function hi(p,m,w){rr(p)&&w.delete(m)}function Qa(){X=!1,Ie!==null&&rr(Ie)&&(Ie=null),He!==null&&rr(He)&&(He=null),tn!==null&&rr(tn)&&(tn=null),Et.forEach(hi),An.forEach(hi)}function Bi(p,m){p.blockedOn===m&&(p.blockedOn=null,X||(X=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Qa)))}function Zs(p){function m(k){return Bi(k,p)}if(0<se.length){Bi(se[0],p);for(var w=1;w<se.length;w++){var T=se[w];T.blockedOn===p&&(T.blockedOn=null)}}for(Ie!==null&&Bi(Ie,p),He!==null&&Bi(He,p),tn!==null&&Bi(tn,p),Et.forEach(m),An.forEach(m),w=0;w<Fn.length;w++)T=Fn[w],T.blockedOn===p&&(T.blockedOn=null);for(;0<Fn.length&&(w=Fn[0],w.blockedOn===null);)Ir(w),w.blockedOn===null&&Fn.shift()}var q=I.ReactCurrentBatchConfig,ne=!0;function be(p,m,w,T){var k=qt,O=q.transition;q.transition=null;try{qt=1,mn(p,m,w,T)}finally{qt=k,q.transition=O}}function Ge(p,m,w,T){var k=qt,O=q.transition;q.transition=null;try{qt=4,mn(p,m,w,T)}finally{qt=k,q.transition=O}}function mn(p,m,w,T){if(ne){var k=Mn(p,m,w,T);if(k===null)qM(p,m,T,Pt,w),Zr(p,T);else if(fs(k,p,m,w,T))T.stopPropagation();else if(Zr(p,T),m&4&&-1<fr.indexOf(p)){for(;k!==null;){var O=P0(k);if(O!==null&&Jf(O),O=Mn(p,m,w,T),O===null&&qM(p,m,T,Pt,w),O===k)break;k=O}k!==null&&T.stopPropagation()}else qM(p,m,T,null,w)}}var Pt=null;function Mn(p,m,w,T){if(Pt=null,p=us(T),p=Qf(p),p!==null)if(m=Wl(p),m===null)p=null;else if(w=m.tag,w===13){if(p=Ao(m),p!==null)return p;p=null}else if(w===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;p=null}else m!==p&&(p=null);return Pt=p,null}function Pr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(d0()){case Yf:return 1;case Ja:return 4;case Zd:case tm:return 16;case oa:return 536870912;default:return 16}default:return 16}}var On=null,En=null,fi=null;function Oo(){if(fi)return fi;var p,m=En,w=m.length,T,k="value"in On?On.value:On.textContent,O=k.length;for(p=0;p<w&&m[p]===k[p];p++);var F=w-p;for(T=1;T<=F&&m[w-T]===k[O-T];T++);return fi=k.slice(p,1<T?1-T:void 0)}function _r(p){var m=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&m===13&&(p=13)):p=m,p===10&&(p=13),32<=p||p===13?p:0}function zi(){return!0}function Qs(){return!1}function pr(p){function m(w,T,k,O,F){this._reactName=w,this._targetInst=k,this.type=T,this.nativeEvent=O,this.target=F,this.currentTarget=null;for(var Y in p)p.hasOwnProperty(Y)&&(w=p[Y],this[Y]=w?w(O):O[Y]);return this.isDefaultPrevented=(O.defaultPrevented!=null?O.defaultPrevented:O.returnValue===!1)?zi:Qs,this.isPropagationStopped=Qs,this}return Z(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=zi)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=zi)},persist:function(){},isPersistent:zi}),m}var ps={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gl=pr(ps),nh=Z({},ps,{view:0,detail:0}),im=pr(nh),rh,RM,y0,v1=Z({},nh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jM,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==y0&&(y0&&p.type==="mousemove"?(rh=p.screenX-y0.screenX,RM=p.screenY-y0.screenY):RM=rh=0,y0=p),rh)},movementY:function(p){return"movementY"in p?p.movementY:RM}}),nH=pr(v1),LTe=Z({},v1,{dataTransfer:0}),FTe=pr(LTe),$Te=Z({},nh,{relatedTarget:0}),NM=pr($Te),BTe=Z({},ps,{animationName:0,elapsedTime:0,pseudoElement:0}),zTe=pr(BTe),UTe=Z({},ps,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),HTe=pr(UTe),VTe=Z({},ps,{data:0}),rH=pr(VTe),WTe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},KTe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qTe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function GTe(p){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(p):(p=qTe[p])?!!m[p]:!1}function jM(){return GTe}var YTe=Z({},nh,{key:function(p){if(p.key){var m=WTe[p.key]||p.key;if(m!=="Unidentified")return m}return p.type==="keypress"?(p=_r(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?KTe[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jM,charCode:function(p){return p.type==="keypress"?_r(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?_r(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),XTe=pr(YTe),JTe=Z({},v1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iH=pr(JTe),ZTe=Z({},nh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jM}),QTe=pr(ZTe),eIe=Z({},ps,{propertyName:0,elapsedTime:0,pseudoElement:0}),tIe=pr(eIe),nIe=Z({},v1,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),rIe=pr(nIe),iIe=[9,13,27,32],LM=a&&"CompositionEvent"in window,v0=null;a&&"documentMode"in document&&(v0=document.documentMode);var sIe=a&&"TextEvent"in window&&!v0,sH=a&&(!LM||v0&&8<v0&&11>=v0),oH=" ",aH=!1;function lH(p,m){switch(p){case"keyup":return iIe.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cH(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var sm=!1;function oIe(p,m){switch(p){case"compositionend":return cH(m);case"keypress":return m.which!==32?null:(aH=!0,oH);case"textInput":return p=m.data,p===oH&&aH?null:p;default:return null}}function aIe(p,m){if(sm)return p==="compositionend"||!LM&&lH(p,m)?(p=Oo(),fi=En=On=null,sm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return sH&&m.locale!=="ko"?null:m.data;default:return null}}var lIe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uH(p){var m=p&&p.nodeName&&p.nodeName.toLowerCase();return m==="input"?!!lIe[p.type]:m==="textarea"}function dH(p,m,w,T){Ul(T),m=C1(m,"onChange"),0<m.length&&(w=new Gl("onChange","change",null,w,T),p.push({event:w,listeners:m}))}var b0=null,x0=null;function cIe(p){kH(p,0)}function b1(p){var m=um(p);if(de(m))return p}function uIe(p,m){if(p==="change")return m}var hH=!1;if(a){var FM;if(a){var $M="oninput"in document;if(!$M){var fH=document.createElement("div");fH.setAttribute("oninput","return;"),$M=typeof fH.oninput=="function"}FM=$M}else FM=!1;hH=FM&&(!document.documentMode||9<document.documentMode)}function pH(){b0&&(b0.detachEvent("onpropertychange",gH),x0=b0=null)}function gH(p){if(p.propertyName==="value"&&b1(x0)){var m=[];dH(m,x0,p,us(p)),Jg(cIe,m)}}function dIe(p,m,w){p==="focusin"?(pH(),b0=m,x0=w,b0.attachEvent("onpropertychange",gH)):p==="focusout"&&pH()}function hIe(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return b1(x0)}function fIe(p,m){if(p==="click")return b1(m)}function pIe(p,m){if(p==="input"||p==="change")return b1(m)}function gIe(p,m){return p===m&&(p!==0||1/p===1/m)||p!==p&&m!==m}var Yl=typeof Object.is=="function"?Object.is:gIe;function w0(p,m){if(Yl(p,m))return!0;if(typeof p!="object"||p===null||typeof m!="object"||m===null)return!1;var w=Object.keys(p),T=Object.keys(m);if(w.length!==T.length)return!1;for(T=0;T<w.length;T++){var k=w[T];if(!l.call(m,k)||!Yl(p[k],m[k]))return!1}return!0}function mH(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function yH(p,m){var w=mH(p);p=0;for(var T;w;){if(w.nodeType===3){if(T=p+w.textContent.length,p<=m&&T>=m)return{node:w,offset:m-p};p=T}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=mH(w)}}function vH(p,m){return p&&m?p===m?!0:p&&p.nodeType===3?!1:m&&m.nodeType===3?vH(p,m.parentNode):"contains"in p?p.contains(m):p.compareDocumentPosition?!!(p.compareDocumentPosition(m)&16):!1:!1}function bH(){for(var p=window,m=pe();m instanceof p.HTMLIFrameElement;){try{var w=typeof m.contentWindow.location.href=="string"}catch{w=!1}if(w)p=m.contentWindow;else break;m=pe(p.document)}return m}function BM(p){var m=p&&p.nodeName&&p.nodeName.toLowerCase();return m&&(m==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||m==="textarea"||p.contentEditable==="true")}function mIe(p){var m=bH(),w=p.focusedElem,T=p.selectionRange;if(m!==w&&w&&w.ownerDocument&&vH(w.ownerDocument.documentElement,w)){if(T!==null&&BM(w)){if(m=T.start,p=T.end,p===void 0&&(p=m),"selectionStart"in w)w.selectionStart=m,w.selectionEnd=Math.min(p,w.value.length);else if(p=(m=w.ownerDocument||document)&&m.defaultView||window,p.getSelection){p=p.getSelection();var k=w.textContent.length,O=Math.min(T.start,k);T=T.end===void 0?O:Math.min(T.end,k),!p.extend&&O>T&&(k=T,T=O,O=k),k=yH(w,O);var F=yH(w,T);k&&F&&(p.rangeCount!==1||p.anchorNode!==k.node||p.anchorOffset!==k.offset||p.focusNode!==F.node||p.focusOffset!==F.offset)&&(m=m.createRange(),m.setStart(k.node,k.offset),p.removeAllRanges(),O>T?(p.addRange(m),p.extend(F.node,F.offset)):(m.setEnd(F.node,F.offset),p.addRange(m)))}}for(m=[],p=w;p=p.parentNode;)p.nodeType===1&&m.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<m.length;w++)p=m[w],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var yIe=a&&"documentMode"in document&&11>=document.documentMode,om=null,zM=null,S0=null,UM=!1;function xH(p,m,w){var T=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;UM||om==null||om!==pe(T)||(T=om,"selectionStart"in T&&BM(T)?T={start:T.selectionStart,end:T.selectionEnd}:(T=(T.ownerDocument&&T.ownerDocument.defaultView||window).getSelection(),T={anchorNode:T.anchorNode,anchorOffset:T.anchorOffset,focusNode:T.focusNode,focusOffset:T.focusOffset}),S0&&w0(S0,T)||(S0=T,T=C1(zM,"onSelect"),0<T.length&&(m=new Gl("onSelect","select",null,m,w),p.push({event:m,listeners:T}),m.target=om)))}function x1(p,m){var w={};return w[p.toLowerCase()]=m.toLowerCase(),w["Webkit"+p]="webkit"+m,w["Moz"+p]="moz"+m,w}var am={animationend:x1("Animation","AnimationEnd"),animationiteration:x1("Animation","AnimationIteration"),animationstart:x1("Animation","AnimationStart"),transitionend:x1("Transition","TransitionEnd")},HM={},wH={};a&&(wH=document.createElement("div").style,"AnimationEvent"in window||(delete am.animationend.animation,delete am.animationiteration.animation,delete am.animationstart.animation),"TransitionEvent"in window||delete am.transitionend.transition);function w1(p){if(HM[p])return HM[p];if(!am[p])return p;var m=am[p],w;for(w in m)if(m.hasOwnProperty(w)&&w in wH)return HM[p]=m[w];return p}var SH=w1("animationend"),CH=w1("animationiteration"),EH=w1("animationstart"),TH=w1("transitionend"),IH=new Map,PH="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ih(p,m){IH.set(p,m),s(m,[p])}for(var VM=0;VM<PH.length;VM++){var WM=PH[VM],vIe=WM.toLowerCase(),bIe=WM[0].toUpperCase()+WM.slice(1);ih(vIe,"on"+bIe)}ih(SH,"onAnimationEnd"),ih(CH,"onAnimationIteration"),ih(EH,"onAnimationStart"),ih("dblclick","onDoubleClick"),ih("focusin","onFocus"),ih("focusout","onBlur"),ih(TH,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var C0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xIe=new Set("cancel close invalid load scroll toggle".split(" ").concat(C0));function _H(p,m,w){var T=p.type||"unknown-event";p.currentTarget=w,l0(T,m,void 0,p),p.currentTarget=null}function kH(p,m){m=(m&4)!==0;for(var w=0;w<p.length;w++){var T=p[w],k=T.event;T=T.listeners;e:{var O=void 0;if(m)for(var F=T.length-1;0<=F;F--){var Y=T[F],Q=Y.instance,ce=Y.currentTarget;if(Y=Y.listener,Q!==O&&k.isPropagationStopped())break e;_H(k,Y,ce),O=Q}else for(F=0;F<T.length;F++){if(Y=T[F],Q=Y.instance,ce=Y.currentTarget,Y=Y.listener,Q!==O&&k.isPropagationStopped())break e;_H(k,Y,ce),O=Q}}}if(ko)throw p=Gf,ko=!1,Gf=null,p}function $n(p,m){var w=m[QM];w===void 0&&(w=m[QM]=new Set);var T=p+"__bubble";w.has(T)||(AH(m,p,2,!1),w.add(T))}function KM(p,m,w){var T=0;m&&(T|=4),AH(w,p,T,m)}var S1="_reactListening"+Math.random().toString(36).slice(2);function E0(p){if(!p[S1]){p[S1]=!0,r.forEach(function(w){w!=="selectionchange"&&(xIe.has(w)||KM(w,!1,p),KM(w,!0,p))});var m=p.nodeType===9?p:p.ownerDocument;m===null||m[S1]||(m[S1]=!0,KM("selectionchange",!1,m))}}function AH(p,m,w,T){switch(Pr(m)){case 1:var k=be;break;case 4:k=Ge;break;default:k=mn}w=k.bind(null,m,w,p),k=void 0,!qf||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(k=!0),T?k!==void 0?p.addEventListener(m,w,{capture:!0,passive:k}):p.addEventListener(m,w,!0):k!==void 0?p.addEventListener(m,w,{passive:k}):p.addEventListener(m,w,!1)}function qM(p,m,w,T,k){var O=T;if((m&1)===0&&(m&2)===0&&T!==null)e:for(;;){if(T===null)return;var F=T.tag;if(F===3||F===4){var Y=T.stateNode.containerInfo;if(Y===k||Y.nodeType===8&&Y.parentNode===k)break;if(F===4)for(F=T.return;F!==null;){var Q=F.tag;if((Q===3||Q===4)&&(Q=F.stateNode.containerInfo,Q===k||Q.nodeType===8&&Q.parentNode===k))return;F=F.return}for(;Y!==null;){if(F=Qf(Y),F===null)return;if(Q=F.tag,Q===5||Q===6){T=O=F;continue e}Y=Y.parentNode}}T=T.return}Jg(function(){var ce=O,Te=us(w),Me=[];e:{var Ce=IH.get(p);if(Ce!==void 0){var Ke=Gl,tt=p;switch(p){case"keypress":if(_r(w)===0)break e;case"keydown":case"keyup":Ke=XTe;break;case"focusin":tt="focus",Ke=NM;break;case"focusout":tt="blur",Ke=NM;break;case"beforeblur":case"afterblur":Ke=NM;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ke=nH;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ke=FTe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ke=QTe;break;case SH:case CH:case EH:Ke=zTe;break;case TH:Ke=tIe;break;case"scroll":Ke=im;break;case"wheel":Ke=rIe;break;case"copy":case"cut":case"paste":Ke=HTe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ke=iH}var st=(m&4)!==0,kr=!st&&p==="scroll",oe=st?Ce!==null?Ce+"Capture":null:Ce;st=[];for(var ee=ce,ae;ee!==null;){ae=ee;var Ne=ae.stateNode;if(ae.tag===5&&Ne!==null&&(ae=Ne,oe!==null&&(Ne=Ou(ee,oe),Ne!=null&&st.push(T0(ee,Ne,ae)))),kr)break;ee=ee.return}0<st.length&&(Ce=new Ke(Ce,tt,null,w,Te),Me.push({event:Ce,listeners:st}))}}if((m&7)===0){e:{if(Ce=p==="mouseover"||p==="pointerover",Ke=p==="mouseout"||p==="pointerout",Ce&&w!==Xr&&(tt=w.relatedTarget||w.fromElement)&&(Qf(tt)||tt[Nu]))break e;if((Ke||Ce)&&(Ce=Te.window===Te?Te:(Ce=Te.ownerDocument)?Ce.defaultView||Ce.parentWindow:window,Ke?(tt=w.relatedTarget||w.toElement,Ke=ce,tt=tt?Qf(tt):null,tt!==null&&(kr=Wl(tt),tt!==kr||tt.tag!==5&&tt.tag!==6)&&(tt=null)):(Ke=null,tt=ce),Ke!==tt)){if(st=nH,Ne="onMouseLeave",oe="onMouseEnter",ee="mouse",(p==="pointerout"||p==="pointerover")&&(st=iH,Ne="onPointerLeave",oe="onPointerEnter",ee="pointer"),kr=Ke==null?Ce:um(Ke),ae=tt==null?Ce:um(tt),Ce=new st(Ne,ee+"leave",Ke,w,Te),Ce.target=kr,Ce.relatedTarget=ae,Ne=null,Qf(Te)===ce&&(st=new st(oe,ee+"enter",tt,w,Te),st.target=ae,st.relatedTarget=kr,Ne=st),kr=Ne,Ke&&tt)t:{for(st=Ke,oe=tt,ee=0,ae=st;ae;ae=lm(ae))ee++;for(ae=0,Ne=oe;Ne;Ne=lm(Ne))ae++;for(;0<ee-ae;)st=lm(st),ee--;for(;0<ae-ee;)oe=lm(oe),ae--;for(;ee--;){if(st===oe||oe!==null&&st===oe.alternate)break t;st=lm(st),oe=lm(oe)}st=null}else st=null;Ke!==null&&MH(Me,Ce,Ke,st,!1),tt!==null&&kr!==null&&MH(Me,kr,tt,st,!0)}}e:{if(Ce=ce?um(ce):window,Ke=Ce.nodeName&&Ce.nodeName.toLowerCase(),Ke==="select"||Ke==="input"&&Ce.type==="file")var ot=uIe;else if(uH(Ce))if(hH)ot=pIe;else{ot=hIe;var pt=dIe}else(Ke=Ce.nodeName)&&Ke.toLowerCase()==="input"&&(Ce.type==="checkbox"||Ce.type==="radio")&&(ot=fIe);if(ot&&(ot=ot(p,ce))){dH(Me,ot,w,Te);break e}pt&&pt(p,Ce,ce),p==="focusout"&&(pt=Ce._wrapperState)&&pt.controlled&&Ce.type==="number"&&qn(Ce,"number",Ce.value)}switch(pt=ce?um(ce):window,p){case"focusin":(uH(pt)||pt.contentEditable==="true")&&(om=pt,zM=ce,S0=null);break;case"focusout":S0=zM=om=null;break;case"mousedown":UM=!0;break;case"contextmenu":case"mouseup":case"dragend":UM=!1,xH(Me,w,Te);break;case"selectionchange":if(yIe)break;case"keydown":case"keyup":xH(Me,w,Te)}var gt;if(LM)e:{switch(p){case"compositionstart":var It="onCompositionStart";break e;case"compositionend":It="onCompositionEnd";break e;case"compositionupdate":It="onCompositionUpdate";break e}It=void 0}else sm?lH(p,w)&&(It="onCompositionEnd"):p==="keydown"&&w.keyCode===229&&(It="onCompositionStart");It&&(sH&&w.locale!=="ko"&&(sm||It!=="onCompositionStart"?It==="onCompositionEnd"&&sm&&(gt=Oo()):(On=Te,En="value"in On?On.value:On.textContent,sm=!0)),pt=C1(ce,It),0<pt.length&&(It=new rH(It,p,null,w,Te),Me.push({event:It,listeners:pt}),gt?It.data=gt:(gt=cH(w),gt!==null&&(It.data=gt)))),(gt=sIe?oIe(p,w):aIe(p,w))&&(ce=C1(ce,"onBeforeInput"),0<ce.length&&(Te=new rH("onBeforeInput","beforeinput",null,w,Te),Me.push({event:Te,listeners:ce}),Te.data=gt))}kH(Me,m)})}function T0(p,m,w){return{instance:p,listener:m,currentTarget:w}}function C1(p,m){for(var w=m+"Capture",T=[];p!==null;){var k=p,O=k.stateNode;k.tag===5&&O!==null&&(k=O,O=Ou(p,w),O!=null&&T.unshift(T0(p,O,k)),O=Ou(p,m),O!=null&&T.push(T0(p,O,k))),p=p.return}return T}function lm(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function MH(p,m,w,T,k){for(var O=m._reactName,F=[];w!==null&&w!==T;){var Y=w,Q=Y.alternate,ce=Y.stateNode;if(Q!==null&&Q===T)break;Y.tag===5&&ce!==null&&(Y=ce,k?(Q=Ou(w,O),Q!=null&&F.unshift(T0(w,Q,Y))):k||(Q=Ou(w,O),Q!=null&&F.push(T0(w,Q,Y)))),w=w.return}F.length!==0&&p.push({event:m,listeners:F})}var wIe=/\r\n?/g,SIe=/\u0000|\uFFFD/g;function OH(p){return(typeof p=="string"?p:""+p).replace(wIe,`
`).replace(SIe,"")}function E1(p,m,w){if(m=OH(m),OH(p)!==m&&w)throw Error(n(425))}function T1(){}var GM=null,YM=null;function XM(p,m){return p==="textarea"||p==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var JM=typeof setTimeout=="function"?setTimeout:void 0,CIe=typeof clearTimeout=="function"?clearTimeout:void 0,DH=typeof Promise=="function"?Promise:void 0,EIe=typeof queueMicrotask=="function"?queueMicrotask:typeof DH<"u"?function(p){return DH.resolve(null).then(p).catch(TIe)}:JM;function TIe(p){setTimeout(function(){throw p})}function ZM(p,m){var w=m,T=0;do{var k=w.nextSibling;if(p.removeChild(w),k&&k.nodeType===8)if(w=k.data,w==="/$"){if(T===0){p.removeChild(k),Zs(m);return}T--}else w!=="$"&&w!=="$?"&&w!=="$!"||T++;w=k}while(w);Zs(m)}function sh(p){for(;p!=null;p=p.nextSibling){var m=p.nodeType;if(m===1||m===3)break;if(m===8){if(m=p.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return p}function RH(p){p=p.previousSibling;for(var m=0;p;){if(p.nodeType===8){var w=p.data;if(w==="$"||w==="$!"||w==="$?"){if(m===0)return p;m--}else w==="/$"&&m++}p=p.previousSibling}return null}var cm=Math.random().toString(36).slice(2),Bc="__reactFiber$"+cm,I0="__reactProps$"+cm,Nu="__reactContainer$"+cm,QM="__reactEvents$"+cm,IIe="__reactListeners$"+cm,PIe="__reactHandles$"+cm;function Qf(p){var m=p[Bc];if(m)return m;for(var w=p.parentNode;w;){if(m=w[Nu]||w[Bc]){if(w=m.alternate,m.child!==null||w!==null&&w.child!==null)for(p=RH(p);p!==null;){if(w=p[Bc])return w;p=RH(p)}return m}p=w,w=p.parentNode}return null}function P0(p){return p=p[Bc]||p[Nu],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function um(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(n(33))}function I1(p){return p[I0]||null}var eO=[],dm=-1;function oh(p){return{current:p}}function Bn(p){0>dm||(p.current=eO[dm],eO[dm]=null,dm--)}function Dn(p,m){dm++,eO[dm]=p.current,p.current=m}var ah={},gs=oh(ah),Do=oh(!1),ep=ah;function hm(p,m){var w=p.type.contextTypes;if(!w)return ah;var T=p.stateNode;if(T&&T.__reactInternalMemoizedUnmaskedChildContext===m)return T.__reactInternalMemoizedMaskedChildContext;var k={},O;for(O in w)k[O]=m[O];return T&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=m,p.__reactInternalMemoizedMaskedChildContext=k),k}function Ro(p){return p=p.childContextTypes,p!=null}function P1(){Bn(Do),Bn(gs)}function NH(p,m,w){if(gs.current!==ah)throw Error(n(168));Dn(gs,m),Dn(Do,w)}function jH(p,m,w){var T=p.stateNode;if(m=m.childContextTypes,typeof T.getChildContext!="function")return w;T=T.getChildContext();for(var k in T)if(!(k in m))throw Error(n(108,Ae(p)||"Unknown",k));return Z({},w,T)}function _1(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||ah,ep=gs.current,Dn(gs,p),Dn(Do,Do.current),!0}function LH(p,m,w){var T=p.stateNode;if(!T)throw Error(n(169));w?(p=jH(p,m,ep),T.__reactInternalMemoizedMergedChildContext=p,Bn(Do),Bn(gs),Dn(gs,p)):Bn(Do),Dn(Do,w)}var ju=null,k1=!1,tO=!1;function FH(p){ju===null?ju=[p]:ju.push(p)}function _Ie(p){k1=!0,FH(p)}function lh(){if(!tO&&ju!==null){tO=!0;var p=0,m=qt;try{var w=ju;for(qt=1;p<w.length;p++){var T=w[p];do T=T(!0);while(T!==null)}ju=null,k1=!1}catch(k){throw ju!==null&&(ju=ju.slice(p+1)),sa(Yf,lh),k}finally{qt=m,tO=!1}}return null}var fm=[],pm=0,A1=null,M1=0,el=[],tl=0,tp=null,Lu=1,Fu="";function np(p,m){fm[pm++]=M1,fm[pm++]=A1,A1=p,M1=m}function $H(p,m,w){el[tl++]=Lu,el[tl++]=Fu,el[tl++]=tp,tp=p;var T=Lu;p=Fu;var k=32-hs(T)-1;T&=~(1<<k),w+=1;var O=32-hs(m)+k;if(30<O){var F=k-k%5;O=(T&(1<<F)-1).toString(32),T>>=F,k-=F,Lu=1<<32-hs(m)+k|w<<k|T,Fu=O+p}else Lu=1<<O|w<<k|T,Fu=p}function nO(p){p.return!==null&&(np(p,1),$H(p,1,0))}function rO(p){for(;p===A1;)A1=fm[--pm],fm[pm]=null,M1=fm[--pm],fm[pm]=null;for(;p===tp;)tp=el[--tl],el[tl]=null,Fu=el[--tl],el[tl]=null,Lu=el[--tl],el[tl]=null}var ca=null,ua=null,Gn=!1,Xl=null;function BH(p,m){var w=sl(5,null,null,0);w.elementType="DELETED",w.stateNode=m,w.return=p,m=p.deletions,m===null?(p.deletions=[w],p.flags|=16):m.push(w)}function zH(p,m){switch(p.tag){case 5:var w=p.type;return m=m.nodeType!==1||w.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(p.stateNode=m,ca=p,ua=sh(m.firstChild),!0):!1;case 6:return m=p.pendingProps===""||m.nodeType!==3?null:m,m!==null?(p.stateNode=m,ca=p,ua=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(w=tp!==null?{id:Lu,overflow:Fu}:null,p.memoizedState={dehydrated:m,treeContext:w,retryLane:1073741824},w=sl(18,null,null,0),w.stateNode=m,w.return=p,p.child=w,ca=p,ua=null,!0):!1;default:return!1}}function iO(p){return(p.mode&1)!==0&&(p.flags&128)===0}function sO(p){if(Gn){var m=ua;if(m){var w=m;if(!zH(p,m)){if(iO(p))throw Error(n(418));m=sh(w.nextSibling);var T=ca;m&&zH(p,m)?BH(T,w):(p.flags=p.flags&-4097|2,Gn=!1,ca=p)}}else{if(iO(p))throw Error(n(418));p.flags=p.flags&-4097|2,Gn=!1,ca=p}}}function UH(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;ca=p}function O1(p){if(p!==ca)return!1;if(!Gn)return UH(p),Gn=!0,!1;var m;if((m=p.tag!==3)&&!(m=p.tag!==5)&&(m=p.type,m=m!=="head"&&m!=="body"&&!XM(p.type,p.memoizedProps)),m&&(m=ua)){if(iO(p))throw HH(),Error(n(418));for(;m;)BH(p,m),m=sh(m.nextSibling)}if(UH(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(n(317));e:{for(p=p.nextSibling,m=0;p;){if(p.nodeType===8){var w=p.data;if(w==="/$"){if(m===0){ua=sh(p.nextSibling);break e}m--}else w!=="$"&&w!=="$!"&&w!=="$?"||m++}p=p.nextSibling}ua=null}}else ua=ca?sh(p.stateNode.nextSibling):null;return!0}function HH(){for(var p=ua;p;)p=sh(p.nextSibling)}function gm(){ua=ca=null,Gn=!1}function oO(p){Xl===null?Xl=[p]:Xl.push(p)}var kIe=I.ReactCurrentBatchConfig;function _0(p,m,w){if(p=w.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(n(309));var T=w.stateNode}if(!T)throw Error(n(147,p));var k=T,O=""+p;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===O?m.ref:(m=function(F){var Y=k.refs;F===null?delete Y[O]:Y[O]=F},m._stringRef=O,m)}if(typeof p!="string")throw Error(n(284));if(!w._owner)throw Error(n(290,p))}return p}function D1(p,m){throw p=Object.prototype.toString.call(m),Error(n(31,p==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":p))}function VH(p){var m=p._init;return m(p._payload)}function WH(p){function m(oe,ee){if(p){var ae=oe.deletions;ae===null?(oe.deletions=[ee],oe.flags|=16):ae.push(ee)}}function w(oe,ee){if(!p)return null;for(;ee!==null;)m(oe,ee),ee=ee.sibling;return null}function T(oe,ee){for(oe=new Map;ee!==null;)ee.key!==null?oe.set(ee.key,ee):oe.set(ee.index,ee),ee=ee.sibling;return oe}function k(oe,ee){return oe=mh(oe,ee),oe.index=0,oe.sibling=null,oe}function O(oe,ee,ae){return oe.index=ae,p?(ae=oe.alternate,ae!==null?(ae=ae.index,ae<ee?(oe.flags|=2,ee):ae):(oe.flags|=2,ee)):(oe.flags|=1048576,ee)}function F(oe){return p&&oe.alternate===null&&(oe.flags|=2),oe}function Y(oe,ee,ae,Ne){return ee===null||ee.tag!==6?(ee=JO(ae,oe.mode,Ne),ee.return=oe,ee):(ee=k(ee,ae),ee.return=oe,ee)}function Q(oe,ee,ae,Ne){var ot=ae.type;return ot===A?Te(oe,ee,ae.props.children,Ne,ae.key):ee!==null&&(ee.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===K&&VH(ot)===ee.type)?(Ne=k(ee,ae.props),Ne.ref=_0(oe,ee,ae),Ne.return=oe,Ne):(Ne=rC(ae.type,ae.key,ae.props,null,oe.mode,Ne),Ne.ref=_0(oe,ee,ae),Ne.return=oe,Ne)}function ce(oe,ee,ae,Ne){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==ae.containerInfo||ee.stateNode.implementation!==ae.implementation?(ee=ZO(ae,oe.mode,Ne),ee.return=oe,ee):(ee=k(ee,ae.children||[]),ee.return=oe,ee)}function Te(oe,ee,ae,Ne,ot){return ee===null||ee.tag!==7?(ee=up(ae,oe.mode,Ne,ot),ee.return=oe,ee):(ee=k(ee,ae),ee.return=oe,ee)}function Me(oe,ee,ae){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=JO(""+ee,oe.mode,ae),ee.return=oe,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case P:return ae=rC(ee.type,ee.key,ee.props,null,oe.mode,ae),ae.ref=_0(oe,null,ee),ae.return=oe,ae;case _:return ee=ZO(ee,oe.mode,ae),ee.return=oe,ee;case K:var Ne=ee._init;return Me(oe,Ne(ee._payload),ae)}if(ci(ee)||W(ee))return ee=up(ee,oe.mode,ae,null),ee.return=oe,ee;D1(oe,ee)}return null}function Ce(oe,ee,ae,Ne){var ot=ee!==null?ee.key:null;if(typeof ae=="string"&&ae!==""||typeof ae=="number")return ot!==null?null:Y(oe,ee,""+ae,Ne);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case P:return ae.key===ot?Q(oe,ee,ae,Ne):null;case _:return ae.key===ot?ce(oe,ee,ae,Ne):null;case K:return ot=ae._init,Ce(oe,ee,ot(ae._payload),Ne)}if(ci(ae)||W(ae))return ot!==null?null:Te(oe,ee,ae,Ne,null);D1(oe,ae)}return null}function Ke(oe,ee,ae,Ne,ot){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return oe=oe.get(ae)||null,Y(ee,oe,""+Ne,ot);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case P:return oe=oe.get(Ne.key===null?ae:Ne.key)||null,Q(ee,oe,Ne,ot);case _:return oe=oe.get(Ne.key===null?ae:Ne.key)||null,ce(ee,oe,Ne,ot);case K:var pt=Ne._init;return Ke(oe,ee,ae,pt(Ne._payload),ot)}if(ci(Ne)||W(Ne))return oe=oe.get(ae)||null,Te(ee,oe,Ne,ot,null);D1(ee,Ne)}return null}function tt(oe,ee,ae,Ne){for(var ot=null,pt=null,gt=ee,It=ee=0,mi=null;gt!==null&&It<ae.length;It++){gt.index>It?(mi=gt,gt=null):mi=gt.sibling;var an=Ce(oe,gt,ae[It],Ne);if(an===null){gt===null&&(gt=mi);break}p&&gt&&an.alternate===null&&m(oe,gt),ee=O(an,ee,It),pt===null?ot=an:pt.sibling=an,pt=an,gt=mi}if(It===ae.length)return w(oe,gt),Gn&&np(oe,It),ot;if(gt===null){for(;It<ae.length;It++)gt=Me(oe,ae[It],Ne),gt!==null&&(ee=O(gt,ee,It),pt===null?ot=gt:pt.sibling=gt,pt=gt);return Gn&&np(oe,It),ot}for(gt=T(oe,gt);It<ae.length;It++)mi=Ke(gt,oe,It,ae[It],Ne),mi!==null&&(p&&mi.alternate!==null&&gt.delete(mi.key===null?It:mi.key),ee=O(mi,ee,It),pt===null?ot=mi:pt.sibling=mi,pt=mi);return p&&gt.forEach(function(yh){return m(oe,yh)}),Gn&&np(oe,It),ot}function st(oe,ee,ae,Ne){var ot=W(ae);if(typeof ot!="function")throw Error(n(150));if(ae=ot.call(ae),ae==null)throw Error(n(151));for(var pt=ot=null,gt=ee,It=ee=0,mi=null,an=ae.next();gt!==null&&!an.done;It++,an=ae.next()){gt.index>It?(mi=gt,gt=null):mi=gt.sibling;var yh=Ce(oe,gt,an.value,Ne);if(yh===null){gt===null&&(gt=mi);break}p&&gt&&yh.alternate===null&&m(oe,gt),ee=O(yh,ee,It),pt===null?ot=yh:pt.sibling=yh,pt=yh,gt=mi}if(an.done)return w(oe,gt),Gn&&np(oe,It),ot;if(gt===null){for(;!an.done;It++,an=ae.next())an=Me(oe,an.value,Ne),an!==null&&(ee=O(an,ee,It),pt===null?ot=an:pt.sibling=an,pt=an);return Gn&&np(oe,It),ot}for(gt=T(oe,gt);!an.done;It++,an=ae.next())an=Ke(gt,oe,It,an.value,Ne),an!==null&&(p&&an.alternate!==null&&gt.delete(an.key===null?It:an.key),ee=O(an,ee,It),pt===null?ot=an:pt.sibling=an,pt=an);return p&&gt.forEach(function(lPe){return m(oe,lPe)}),Gn&&np(oe,It),ot}function kr(oe,ee,ae,Ne){if(typeof ae=="object"&&ae!==null&&ae.type===A&&ae.key===null&&(ae=ae.props.children),typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case P:e:{for(var ot=ae.key,pt=ee;pt!==null;){if(pt.key===ot){if(ot=ae.type,ot===A){if(pt.tag===7){w(oe,pt.sibling),ee=k(pt,ae.props.children),ee.return=oe,oe=ee;break e}}else if(pt.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===K&&VH(ot)===pt.type){w(oe,pt.sibling),ee=k(pt,ae.props),ee.ref=_0(oe,pt,ae),ee.return=oe,oe=ee;break e}w(oe,pt);break}else m(oe,pt);pt=pt.sibling}ae.type===A?(ee=up(ae.props.children,oe.mode,Ne,ae.key),ee.return=oe,oe=ee):(Ne=rC(ae.type,ae.key,ae.props,null,oe.mode,Ne),Ne.ref=_0(oe,ee,ae),Ne.return=oe,oe=Ne)}return F(oe);case _:e:{for(pt=ae.key;ee!==null;){if(ee.key===pt)if(ee.tag===4&&ee.stateNode.containerInfo===ae.containerInfo&&ee.stateNode.implementation===ae.implementation){w(oe,ee.sibling),ee=k(ee,ae.children||[]),ee.return=oe,oe=ee;break e}else{w(oe,ee);break}else m(oe,ee);ee=ee.sibling}ee=ZO(ae,oe.mode,Ne),ee.return=oe,oe=ee}return F(oe);case K:return pt=ae._init,kr(oe,ee,pt(ae._payload),Ne)}if(ci(ae))return tt(oe,ee,ae,Ne);if(W(ae))return st(oe,ee,ae,Ne);D1(oe,ae)}return typeof ae=="string"&&ae!==""||typeof ae=="number"?(ae=""+ae,ee!==null&&ee.tag===6?(w(oe,ee.sibling),ee=k(ee,ae),ee.return=oe,oe=ee):(w(oe,ee),ee=JO(ae,oe.mode,Ne),ee.return=oe,oe=ee),F(oe)):w(oe,ee)}return kr}var mm=WH(!0),KH=WH(!1),R1=oh(null),N1=null,ym=null,aO=null;function lO(){aO=ym=N1=null}function cO(p){var m=R1.current;Bn(R1),p._currentValue=m}function uO(p,m,w){for(;p!==null;){var T=p.alternate;if((p.childLanes&m)!==m?(p.childLanes|=m,T!==null&&(T.childLanes|=m)):T!==null&&(T.childLanes&m)!==m&&(T.childLanes|=m),p===w)break;p=p.return}}function vm(p,m){N1=p,aO=ym=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&m)!==0&&(No=!0),p.firstContext=null)}function nl(p){var m=p._currentValue;if(aO!==p)if(p={context:p,memoizedValue:m,next:null},ym===null){if(N1===null)throw Error(n(308));ym=p,N1.dependencies={lanes:0,firstContext:p}}else ym=ym.next=p;return m}var rp=null;function dO(p){rp===null?rp=[p]:rp.push(p)}function qH(p,m,w,T){var k=m.interleaved;return k===null?(w.next=w,dO(m)):(w.next=k.next,k.next=w),m.interleaved=w,$u(p,T)}function $u(p,m){p.lanes|=m;var w=p.alternate;for(w!==null&&(w.lanes|=m),w=p,p=p.return;p!==null;)p.childLanes|=m,w=p.alternate,w!==null&&(w.childLanes|=m),w=p,p=p.return;return w.tag===3?w.stateNode:null}var ch=!1;function hO(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function GH(p,m){p=p.updateQueue,m.updateQueue===p&&(m.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Bu(p,m){return{eventTime:p,lane:m,tag:0,payload:null,callback:null,next:null}}function uh(p,m,w){var T=p.updateQueue;if(T===null)return null;if(T=T.shared,(nn&2)!==0){var k=T.pending;return k===null?m.next=m:(m.next=k.next,k.next=m),T.pending=m,$u(p,w)}return k=T.interleaved,k===null?(m.next=m,dO(T)):(m.next=k.next,k.next=m),T.interleaved=m,$u(p,w)}function j1(p,m,w){if(m=m.updateQueue,m!==null&&(m=m.shared,(w&4194240)!==0)){var T=m.lanes;T&=p.pendingLanes,w|=T,m.lanes=w,th(p,w)}}function YH(p,m){var w=p.updateQueue,T=p.alternate;if(T!==null&&(T=T.updateQueue,w===T)){var k=null,O=null;if(w=w.firstBaseUpdate,w!==null){do{var F={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};O===null?k=O=F:O=O.next=F,w=w.next}while(w!==null);O===null?k=O=m:O=O.next=m}else k=O=m;w={baseState:T.baseState,firstBaseUpdate:k,lastBaseUpdate:O,shared:T.shared,effects:T.effects},p.updateQueue=w;return}p=w.lastBaseUpdate,p===null?w.firstBaseUpdate=m:p.next=m,w.lastBaseUpdate=m}function L1(p,m,w,T){var k=p.updateQueue;ch=!1;var O=k.firstBaseUpdate,F=k.lastBaseUpdate,Y=k.shared.pending;if(Y!==null){k.shared.pending=null;var Q=Y,ce=Q.next;Q.next=null,F===null?O=ce:F.next=ce,F=Q;var Te=p.alternate;Te!==null&&(Te=Te.updateQueue,Y=Te.lastBaseUpdate,Y!==F&&(Y===null?Te.firstBaseUpdate=ce:Y.next=ce,Te.lastBaseUpdate=Q))}if(O!==null){var Me=k.baseState;F=0,Te=ce=Q=null,Y=O;do{var Ce=Y.lane,Ke=Y.eventTime;if((T&Ce)===Ce){Te!==null&&(Te=Te.next={eventTime:Ke,lane:0,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null});e:{var tt=p,st=Y;switch(Ce=m,Ke=w,st.tag){case 1:if(tt=st.payload,typeof tt=="function"){Me=tt.call(Ke,Me,Ce);break e}Me=tt;break e;case 3:tt.flags=tt.flags&-65537|128;case 0:if(tt=st.payload,Ce=typeof tt=="function"?tt.call(Ke,Me,Ce):tt,Ce==null)break e;Me=Z({},Me,Ce);break e;case 2:ch=!0}}Y.callback!==null&&Y.lane!==0&&(p.flags|=64,Ce=k.effects,Ce===null?k.effects=[Y]:Ce.push(Y))}else Ke={eventTime:Ke,lane:Ce,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},Te===null?(ce=Te=Ke,Q=Me):Te=Te.next=Ke,F|=Ce;if(Y=Y.next,Y===null){if(Y=k.shared.pending,Y===null)break;Ce=Y,Y=Ce.next,Ce.next=null,k.lastBaseUpdate=Ce,k.shared.pending=null}}while(!0);if(Te===null&&(Q=Me),k.baseState=Q,k.firstBaseUpdate=ce,k.lastBaseUpdate=Te,m=k.shared.interleaved,m!==null){k=m;do F|=k.lane,k=k.next;while(k!==m)}else O===null&&(k.shared.lanes=0);op|=F,p.lanes=F,p.memoizedState=Me}}function XH(p,m,w){if(p=m.effects,m.effects=null,p!==null)for(m=0;m<p.length;m++){var T=p[m],k=T.callback;if(k!==null){if(T.callback=null,T=w,typeof k!="function")throw Error(n(191,k));k.call(T)}}}var k0={},zc=oh(k0),A0=oh(k0),M0=oh(k0);function ip(p){if(p===k0)throw Error(n(174));return p}function fO(p,m){switch(Dn(M0,m),Dn(A0,p),Dn(zc,k0),p=m.nodeType,p){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:Ya(null,"");break;default:p=p===8?m.parentNode:m,m=p.namespaceURI||null,p=p.tagName,m=Ya(m,p)}Bn(zc),Dn(zc,m)}function bm(){Bn(zc),Bn(A0),Bn(M0)}function JH(p){ip(M0.current);var m=ip(zc.current),w=Ya(m,p.type);m!==w&&(Dn(A0,p),Dn(zc,w))}function pO(p){A0.current===p&&(Bn(zc),Bn(A0))}var ir=oh(0);function F1(p){for(var m=p;m!==null;){if(m.tag===13){var w=m.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===p)break;for(;m.sibling===null;){if(m.return===null||m.return===p)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var gO=[];function mO(){for(var p=0;p<gO.length;p++)gO[p]._workInProgressVersionPrimary=null;gO.length=0}var $1=I.ReactCurrentDispatcher,yO=I.ReactCurrentBatchConfig,sp=0,sr=null,Qr=null,pi=null,B1=!1,O0=!1,D0=0,AIe=0;function ms(){throw Error(n(321))}function vO(p,m){if(m===null)return!1;for(var w=0;w<m.length&&w<p.length;w++)if(!Yl(p[w],m[w]))return!1;return!0}function bO(p,m,w,T,k,O){if(sp=O,sr=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,$1.current=p===null||p.memoizedState===null?RIe:NIe,p=w(T,k),O0){O=0;do{if(O0=!1,D0=0,25<=O)throw Error(n(301));O+=1,pi=Qr=null,m.updateQueue=null,$1.current=jIe,p=w(T,k)}while(O0)}if($1.current=H1,m=Qr!==null&&Qr.next!==null,sp=0,pi=Qr=sr=null,B1=!1,m)throw Error(n(300));return p}function xO(){var p=D0!==0;return D0=0,p}function Uc(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pi===null?sr.memoizedState=pi=p:pi=pi.next=p,pi}function rl(){if(Qr===null){var p=sr.alternate;p=p!==null?p.memoizedState:null}else p=Qr.next;var m=pi===null?sr.memoizedState:pi.next;if(m!==null)pi=m,Qr=p;else{if(p===null)throw Error(n(310));Qr=p,p={memoizedState:Qr.memoizedState,baseState:Qr.baseState,baseQueue:Qr.baseQueue,queue:Qr.queue,next:null},pi===null?sr.memoizedState=pi=p:pi=pi.next=p}return pi}function R0(p,m){return typeof m=="function"?m(p):m}function wO(p){var m=rl(),w=m.queue;if(w===null)throw Error(n(311));w.lastRenderedReducer=p;var T=Qr,k=T.baseQueue,O=w.pending;if(O!==null){if(k!==null){var F=k.next;k.next=O.next,O.next=F}T.baseQueue=k=O,w.pending=null}if(k!==null){O=k.next,T=T.baseState;var Y=F=null,Q=null,ce=O;do{var Te=ce.lane;if((sp&Te)===Te)Q!==null&&(Q=Q.next={lane:0,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),T=ce.hasEagerState?ce.eagerState:p(T,ce.action);else{var Me={lane:Te,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null};Q===null?(Y=Q=Me,F=T):Q=Q.next=Me,sr.lanes|=Te,op|=Te}ce=ce.next}while(ce!==null&&ce!==O);Q===null?F=T:Q.next=Y,Yl(T,m.memoizedState)||(No=!0),m.memoizedState=T,m.baseState=F,m.baseQueue=Q,w.lastRenderedState=T}if(p=w.interleaved,p!==null){k=p;do O=k.lane,sr.lanes|=O,op|=O,k=k.next;while(k!==p)}else k===null&&(w.lanes=0);return[m.memoizedState,w.dispatch]}function SO(p){var m=rl(),w=m.queue;if(w===null)throw Error(n(311));w.lastRenderedReducer=p;var T=w.dispatch,k=w.pending,O=m.memoizedState;if(k!==null){w.pending=null;var F=k=k.next;do O=p(O,F.action),F=F.next;while(F!==k);Yl(O,m.memoizedState)||(No=!0),m.memoizedState=O,m.baseQueue===null&&(m.baseState=O),w.lastRenderedState=O}return[O,T]}function ZH(){}function QH(p,m){var w=sr,T=rl(),k=m(),O=!Yl(T.memoizedState,k);if(O&&(T.memoizedState=k,No=!0),T=T.queue,CO(n7.bind(null,w,T,p),[p]),T.getSnapshot!==m||O||pi!==null&&pi.memoizedState.tag&1){if(w.flags|=2048,N0(9,t7.bind(null,w,T,k,m),void 0,null),gi===null)throw Error(n(349));(sp&30)!==0||e7(w,m,k)}return k}function e7(p,m,w){p.flags|=16384,p={getSnapshot:m,value:w},m=sr.updateQueue,m===null?(m={lastEffect:null,stores:null},sr.updateQueue=m,m.stores=[p]):(w=m.stores,w===null?m.stores=[p]:w.push(p))}function t7(p,m,w,T){m.value=w,m.getSnapshot=T,r7(m)&&i7(p)}function n7(p,m,w){return w(function(){r7(m)&&i7(p)})}function r7(p){var m=p.getSnapshot;p=p.value;try{var w=m();return!Yl(p,w)}catch{return!0}}function i7(p){var m=$u(p,1);m!==null&&ec(m,p,1,-1)}function s7(p){var m=Uc();return typeof p=="function"&&(p=p()),m.memoizedState=m.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:R0,lastRenderedState:p},m.queue=p,p=p.dispatch=DIe.bind(null,sr,p),[m.memoizedState,p]}function N0(p,m,w,T){return p={tag:p,create:m,destroy:w,deps:T,next:null},m=sr.updateQueue,m===null?(m={lastEffect:null,stores:null},sr.updateQueue=m,m.lastEffect=p.next=p):(w=m.lastEffect,w===null?m.lastEffect=p.next=p:(T=w.next,w.next=p,p.next=T,m.lastEffect=p)),p}function o7(){return rl().memoizedState}function z1(p,m,w,T){var k=Uc();sr.flags|=p,k.memoizedState=N0(1|m,w,void 0,T===void 0?null:T)}function U1(p,m,w,T){var k=rl();T=T===void 0?null:T;var O=void 0;if(Qr!==null){var F=Qr.memoizedState;if(O=F.destroy,T!==null&&vO(T,F.deps)){k.memoizedState=N0(m,w,O,T);return}}sr.flags|=p,k.memoizedState=N0(1|m,w,O,T)}function a7(p,m){return z1(8390656,8,p,m)}function CO(p,m){return U1(2048,8,p,m)}function l7(p,m){return U1(4,2,p,m)}function c7(p,m){return U1(4,4,p,m)}function u7(p,m){if(typeof m=="function")return p=p(),m(p),function(){m(null)};if(m!=null)return p=p(),m.current=p,function(){m.current=null}}function d7(p,m,w){return w=w!=null?w.concat([p]):null,U1(4,4,u7.bind(null,m,p),w)}function EO(){}function h7(p,m){var w=rl();m=m===void 0?null:m;var T=w.memoizedState;return T!==null&&m!==null&&vO(m,T[1])?T[0]:(w.memoizedState=[p,m],p)}function f7(p,m){var w=rl();m=m===void 0?null:m;var T=w.memoizedState;return T!==null&&m!==null&&vO(m,T[1])?T[0]:(p=p(),w.memoizedState=[p,m],p)}function p7(p,m,w){return(sp&21)===0?(p.baseState&&(p.baseState=!1,No=!0),p.memoizedState=w):(Yl(w,m)||(w=Xf(),sr.lanes|=w,op|=w,p.baseState=!0),m)}function MIe(p,m){var w=qt;qt=w!==0&&4>w?w:4,p(!0);var T=yO.transition;yO.transition={};try{p(!1),m()}finally{qt=w,yO.transition=T}}function g7(){return rl().memoizedState}function OIe(p,m,w){var T=ph(p);if(w={lane:T,action:w,hasEagerState:!1,eagerState:null,next:null},m7(p))y7(m,w);else if(w=qH(p,m,w,T),w!==null){var k=to();ec(w,p,T,k),v7(w,m,T)}}function DIe(p,m,w){var T=ph(p),k={lane:T,action:w,hasEagerState:!1,eagerState:null,next:null};if(m7(p))y7(m,k);else{var O=p.alternate;if(p.lanes===0&&(O===null||O.lanes===0)&&(O=m.lastRenderedReducer,O!==null))try{var F=m.lastRenderedState,Y=O(F,w);if(k.hasEagerState=!0,k.eagerState=Y,Yl(Y,F)){var Q=m.interleaved;Q===null?(k.next=k,dO(m)):(k.next=Q.next,Q.next=k),m.interleaved=k;return}}catch{}finally{}w=qH(p,m,k,T),w!==null&&(k=to(),ec(w,p,T,k),v7(w,m,T))}}function m7(p){var m=p.alternate;return p===sr||m!==null&&m===sr}function y7(p,m){O0=B1=!0;var w=p.pending;w===null?m.next=m:(m.next=w.next,w.next=m),p.pending=m}function v7(p,m,w){if((w&4194240)!==0){var T=m.lanes;T&=p.pendingLanes,w|=T,m.lanes=w,th(p,w)}}var H1={readContext:nl,useCallback:ms,useContext:ms,useEffect:ms,useImperativeHandle:ms,useInsertionEffect:ms,useLayoutEffect:ms,useMemo:ms,useReducer:ms,useRef:ms,useState:ms,useDebugValue:ms,useDeferredValue:ms,useTransition:ms,useMutableSource:ms,useSyncExternalStore:ms,useId:ms,unstable_isNewReconciler:!1},RIe={readContext:nl,useCallback:function(p,m){return Uc().memoizedState=[p,m===void 0?null:m],p},useContext:nl,useEffect:a7,useImperativeHandle:function(p,m,w){return w=w!=null?w.concat([p]):null,z1(4194308,4,u7.bind(null,m,p),w)},useLayoutEffect:function(p,m){return z1(4194308,4,p,m)},useInsertionEffect:function(p,m){return z1(4,2,p,m)},useMemo:function(p,m){var w=Uc();return m=m===void 0?null:m,p=p(),w.memoizedState=[p,m],p},useReducer:function(p,m,w){var T=Uc();return m=w!==void 0?w(m):m,T.memoizedState=T.baseState=m,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:m},T.queue=p,p=p.dispatch=OIe.bind(null,sr,p),[T.memoizedState,p]},useRef:function(p){var m=Uc();return p={current:p},m.memoizedState=p},useState:s7,useDebugValue:EO,useDeferredValue:function(p){return Uc().memoizedState=p},useTransition:function(){var p=s7(!1),m=p[0];return p=MIe.bind(null,p[1]),Uc().memoizedState=p,[m,p]},useMutableSource:function(){},useSyncExternalStore:function(p,m,w){var T=sr,k=Uc();if(Gn){if(w===void 0)throw Error(n(407));w=w()}else{if(w=m(),gi===null)throw Error(n(349));(sp&30)!==0||e7(T,m,w)}k.memoizedState=w;var O={value:w,getSnapshot:m};return k.queue=O,a7(n7.bind(null,T,O,p),[p]),T.flags|=2048,N0(9,t7.bind(null,T,O,w,m),void 0,null),w},useId:function(){var p=Uc(),m=gi.identifierPrefix;if(Gn){var w=Fu,T=Lu;w=(T&~(1<<32-hs(T)-1)).toString(32)+w,m=":"+m+"R"+w,w=D0++,0<w&&(m+="H"+w.toString(32)),m+=":"}else w=AIe++,m=":"+m+"r"+w.toString(32)+":";return p.memoizedState=m},unstable_isNewReconciler:!1},NIe={readContext:nl,useCallback:h7,useContext:nl,useEffect:CO,useImperativeHandle:d7,useInsertionEffect:l7,useLayoutEffect:c7,useMemo:f7,useReducer:wO,useRef:o7,useState:function(){return wO(R0)},useDebugValue:EO,useDeferredValue:function(p){var m=rl();return p7(m,Qr.memoizedState,p)},useTransition:function(){var p=wO(R0)[0],m=rl().memoizedState;return[p,m]},useMutableSource:ZH,useSyncExternalStore:QH,useId:g7,unstable_isNewReconciler:!1},jIe={readContext:nl,useCallback:h7,useContext:nl,useEffect:CO,useImperativeHandle:d7,useInsertionEffect:l7,useLayoutEffect:c7,useMemo:f7,useReducer:SO,useRef:o7,useState:function(){return SO(R0)},useDebugValue:EO,useDeferredValue:function(p){var m=rl();return Qr===null?m.memoizedState=p:p7(m,Qr.memoizedState,p)},useTransition:function(){var p=SO(R0)[0],m=rl().memoizedState;return[p,m]},useMutableSource:ZH,useSyncExternalStore:QH,useId:g7,unstable_isNewReconciler:!1};function Jl(p,m){if(p&&p.defaultProps){m=Z({},m),p=p.defaultProps;for(var w in p)m[w]===void 0&&(m[w]=p[w]);return m}return m}function TO(p,m,w,T){m=p.memoizedState,w=w(T,m),w=w==null?m:Z({},m,w),p.memoizedState=w,p.lanes===0&&(p.updateQueue.baseState=w)}var V1={isMounted:function(p){return(p=p._reactInternals)?Wl(p)===p:!1},enqueueSetState:function(p,m,w){p=p._reactInternals;var T=to(),k=ph(p),O=Bu(T,k);O.payload=m,w!=null&&(O.callback=w),m=uh(p,O,k),m!==null&&(ec(m,p,k,T),j1(m,p,k))},enqueueReplaceState:function(p,m,w){p=p._reactInternals;var T=to(),k=ph(p),O=Bu(T,k);O.tag=1,O.payload=m,w!=null&&(O.callback=w),m=uh(p,O,k),m!==null&&(ec(m,p,k,T),j1(m,p,k))},enqueueForceUpdate:function(p,m){p=p._reactInternals;var w=to(),T=ph(p),k=Bu(w,T);k.tag=2,m!=null&&(k.callback=m),m=uh(p,k,T),m!==null&&(ec(m,p,T,w),j1(m,p,T))}};function b7(p,m,w,T,k,O,F){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(T,O,F):m.prototype&&m.prototype.isPureReactComponent?!w0(w,T)||!w0(k,O):!0}function x7(p,m,w){var T=!1,k=ah,O=m.contextType;return typeof O=="object"&&O!==null?O=nl(O):(k=Ro(m)?ep:gs.current,T=m.contextTypes,O=(T=T!=null)?hm(p,k):ah),m=new m(w,O),p.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=V1,p.stateNode=m,m._reactInternals=p,T&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=k,p.__reactInternalMemoizedMaskedChildContext=O),m}function w7(p,m,w,T){p=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(w,T),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(w,T),m.state!==p&&V1.enqueueReplaceState(m,m.state,null)}function IO(p,m,w,T){var k=p.stateNode;k.props=w,k.state=p.memoizedState,k.refs={},hO(p);var O=m.contextType;typeof O=="object"&&O!==null?k.context=nl(O):(O=Ro(m)?ep:gs.current,k.context=hm(p,O)),k.state=p.memoizedState,O=m.getDerivedStateFromProps,typeof O=="function"&&(TO(p,m,O,w),k.state=p.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(m=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),m!==k.state&&V1.enqueueReplaceState(k,k.state,null),L1(p,w,k,T),k.state=p.memoizedState),typeof k.componentDidMount=="function"&&(p.flags|=4194308)}function xm(p,m){try{var w="",T=m;do w+=fe(T),T=T.return;while(T);var k=w}catch(O){k=`
Error generating stack: `+O.message+`
`+O.stack}return{value:p,source:m,stack:k,digest:null}}function PO(p,m,w){return{value:p,source:null,stack:w??null,digest:m??null}}function _O(p,m){try{console.error(m.value)}catch(w){setTimeout(function(){throw w})}}var LIe=typeof WeakMap=="function"?WeakMap:Map;function S7(p,m,w){w=Bu(-1,w),w.tag=3,w.payload={element:null};var T=m.value;return w.callback=function(){J1||(J1=!0,HO=T),_O(p,m)},w}function C7(p,m,w){w=Bu(-1,w),w.tag=3;var T=p.type.getDerivedStateFromError;if(typeof T=="function"){var k=m.value;w.payload=function(){return T(k)},w.callback=function(){_O(p,m)}}var O=p.stateNode;return O!==null&&typeof O.componentDidCatch=="function"&&(w.callback=function(){_O(p,m),typeof T!="function"&&(hh===null?hh=new Set([this]):hh.add(this));var F=m.stack;this.componentDidCatch(m.value,{componentStack:F!==null?F:""})}),w}function E7(p,m,w){var T=p.pingCache;if(T===null){T=p.pingCache=new LIe;var k=new Set;T.set(m,k)}else k=T.get(m),k===void 0&&(k=new Set,T.set(m,k));k.has(w)||(k.add(w),p=JIe.bind(null,p,m,w),m.then(p,p))}function T7(p){do{var m;if((m=p.tag===13)&&(m=p.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return p;p=p.return}while(p!==null);return null}function I7(p,m,w,T,k){return(p.mode&1)===0?(p===m?p.flags|=65536:(p.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(m=Bu(-1,1),m.tag=2,uh(w,m,1))),w.lanes|=1),p):(p.flags|=65536,p.lanes=k,p)}var FIe=I.ReactCurrentOwner,No=!1;function eo(p,m,w,T){m.child=p===null?KH(m,null,w,T):mm(m,p.child,w,T)}function P7(p,m,w,T,k){w=w.render;var O=m.ref;return vm(m,k),T=bO(p,m,w,T,O,k),w=xO(),p!==null&&!No?(m.updateQueue=p.updateQueue,m.flags&=-2053,p.lanes&=~k,zu(p,m,k)):(Gn&&w&&nO(m),m.flags|=1,eo(p,m,T,k),m.child)}function _7(p,m,w,T,k){if(p===null){var O=w.type;return typeof O=="function"&&!XO(O)&&O.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(m.tag=15,m.type=O,k7(p,m,O,T,k)):(p=rC(w.type,null,T,m,m.mode,k),p.ref=m.ref,p.return=m,m.child=p)}if(O=p.child,(p.lanes&k)===0){var F=O.memoizedProps;if(w=w.compare,w=w!==null?w:w0,w(F,T)&&p.ref===m.ref)return zu(p,m,k)}return m.flags|=1,p=mh(O,T),p.ref=m.ref,p.return=m,m.child=p}function k7(p,m,w,T,k){if(p!==null){var O=p.memoizedProps;if(w0(O,T)&&p.ref===m.ref)if(No=!1,m.pendingProps=T=O,(p.lanes&k)!==0)(p.flags&131072)!==0&&(No=!0);else return m.lanes=p.lanes,zu(p,m,k)}return kO(p,m,w,T,k)}function A7(p,m,w){var T=m.pendingProps,k=T.children,O=p!==null?p.memoizedState:null;if(T.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dn(Sm,da),da|=w;else{if((w&1073741824)===0)return p=O!==null?O.baseLanes|w:w,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:p,cachePool:null,transitions:null},m.updateQueue=null,Dn(Sm,da),da|=p,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},T=O!==null?O.baseLanes:w,Dn(Sm,da),da|=T}else O!==null?(T=O.baseLanes|w,m.memoizedState=null):T=w,Dn(Sm,da),da|=T;return eo(p,m,k,w),m.child}function M7(p,m){var w=m.ref;(p===null&&w!==null||p!==null&&p.ref!==w)&&(m.flags|=512,m.flags|=2097152)}function kO(p,m,w,T,k){var O=Ro(w)?ep:gs.current;return O=hm(m,O),vm(m,k),w=bO(p,m,w,T,O,k),T=xO(),p!==null&&!No?(m.updateQueue=p.updateQueue,m.flags&=-2053,p.lanes&=~k,zu(p,m,k)):(Gn&&T&&nO(m),m.flags|=1,eo(p,m,w,k),m.child)}function O7(p,m,w,T,k){if(Ro(w)){var O=!0;_1(m)}else O=!1;if(vm(m,k),m.stateNode===null)K1(p,m),x7(m,w,T),IO(m,w,T,k),T=!0;else if(p===null){var F=m.stateNode,Y=m.memoizedProps;F.props=Y;var Q=F.context,ce=w.contextType;typeof ce=="object"&&ce!==null?ce=nl(ce):(ce=Ro(w)?ep:gs.current,ce=hm(m,ce));var Te=w.getDerivedStateFromProps,Me=typeof Te=="function"||typeof F.getSnapshotBeforeUpdate=="function";Me||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(Y!==T||Q!==ce)&&w7(m,F,T,ce),ch=!1;var Ce=m.memoizedState;F.state=Ce,L1(m,T,F,k),Q=m.memoizedState,Y!==T||Ce!==Q||Do.current||ch?(typeof Te=="function"&&(TO(m,w,Te,T),Q=m.memoizedState),(Y=ch||b7(m,w,Y,T,Ce,Q,ce))?(Me||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount()),typeof F.componentDidMount=="function"&&(m.flags|=4194308)):(typeof F.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=T,m.memoizedState=Q),F.props=T,F.state=Q,F.context=ce,T=Y):(typeof F.componentDidMount=="function"&&(m.flags|=4194308),T=!1)}else{F=m.stateNode,GH(p,m),Y=m.memoizedProps,ce=m.type===m.elementType?Y:Jl(m.type,Y),F.props=ce,Me=m.pendingProps,Ce=F.context,Q=w.contextType,typeof Q=="object"&&Q!==null?Q=nl(Q):(Q=Ro(w)?ep:gs.current,Q=hm(m,Q));var Ke=w.getDerivedStateFromProps;(Te=typeof Ke=="function"||typeof F.getSnapshotBeforeUpdate=="function")||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(Y!==Me||Ce!==Q)&&w7(m,F,T,Q),ch=!1,Ce=m.memoizedState,F.state=Ce,L1(m,T,F,k);var tt=m.memoizedState;Y!==Me||Ce!==tt||Do.current||ch?(typeof Ke=="function"&&(TO(m,w,Ke,T),tt=m.memoizedState),(ce=ch||b7(m,w,ce,T,Ce,tt,Q)||!1)?(Te||typeof F.UNSAFE_componentWillUpdate!="function"&&typeof F.componentWillUpdate!="function"||(typeof F.componentWillUpdate=="function"&&F.componentWillUpdate(T,tt,Q),typeof F.UNSAFE_componentWillUpdate=="function"&&F.UNSAFE_componentWillUpdate(T,tt,Q)),typeof F.componentDidUpdate=="function"&&(m.flags|=4),typeof F.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof F.componentDidUpdate!="function"||Y===p.memoizedProps&&Ce===p.memoizedState||(m.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||Y===p.memoizedProps&&Ce===p.memoizedState||(m.flags|=1024),m.memoizedProps=T,m.memoizedState=tt),F.props=T,F.state=tt,F.context=Q,T=ce):(typeof F.componentDidUpdate!="function"||Y===p.memoizedProps&&Ce===p.memoizedState||(m.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||Y===p.memoizedProps&&Ce===p.memoizedState||(m.flags|=1024),T=!1)}return AO(p,m,w,T,O,k)}function AO(p,m,w,T,k,O){M7(p,m);var F=(m.flags&128)!==0;if(!T&&!F)return k&&LH(m,w,!1),zu(p,m,O);T=m.stateNode,FIe.current=m;var Y=F&&typeof w.getDerivedStateFromError!="function"?null:T.render();return m.flags|=1,p!==null&&F?(m.child=mm(m,p.child,null,O),m.child=mm(m,null,Y,O)):eo(p,m,Y,O),m.memoizedState=T.state,k&&LH(m,w,!0),m.child}function D7(p){var m=p.stateNode;m.pendingContext?NH(p,m.pendingContext,m.pendingContext!==m.context):m.context&&NH(p,m.context,!1),fO(p,m.containerInfo)}function R7(p,m,w,T,k){return gm(),oO(k),m.flags|=256,eo(p,m,w,T),m.child}var MO={dehydrated:null,treeContext:null,retryLane:0};function OO(p){return{baseLanes:p,cachePool:null,transitions:null}}function N7(p,m,w){var T=m.pendingProps,k=ir.current,O=!1,F=(m.flags&128)!==0,Y;if((Y=F)||(Y=p!==null&&p.memoizedState===null?!1:(k&2)!==0),Y?(O=!0,m.flags&=-129):(p===null||p.memoizedState!==null)&&(k|=1),Dn(ir,k&1),p===null)return sO(m),p=m.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((m.mode&1)===0?m.lanes=1:p.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(F=T.children,p=T.fallback,O?(T=m.mode,O=m.child,F={mode:"hidden",children:F},(T&1)===0&&O!==null?(O.childLanes=0,O.pendingProps=F):O=iC(F,T,0,null),p=up(p,T,w,null),O.return=m,p.return=m,O.sibling=p,m.child=O,m.child.memoizedState=OO(w),m.memoizedState=MO,p):DO(m,F));if(k=p.memoizedState,k!==null&&(Y=k.dehydrated,Y!==null))return $Ie(p,m,F,T,Y,k,w);if(O){O=T.fallback,F=m.mode,k=p.child,Y=k.sibling;var Q={mode:"hidden",children:T.children};return(F&1)===0&&m.child!==k?(T=m.child,T.childLanes=0,T.pendingProps=Q,m.deletions=null):(T=mh(k,Q),T.subtreeFlags=k.subtreeFlags&14680064),Y!==null?O=mh(Y,O):(O=up(O,F,w,null),O.flags|=2),O.return=m,T.return=m,T.sibling=O,m.child=T,T=O,O=m.child,F=p.child.memoizedState,F=F===null?OO(w):{baseLanes:F.baseLanes|w,cachePool:null,transitions:F.transitions},O.memoizedState=F,O.childLanes=p.childLanes&~w,m.memoizedState=MO,T}return O=p.child,p=O.sibling,T=mh(O,{mode:"visible",children:T.children}),(m.mode&1)===0&&(T.lanes=w),T.return=m,T.sibling=null,p!==null&&(w=m.deletions,w===null?(m.deletions=[p],m.flags|=16):w.push(p)),m.child=T,m.memoizedState=null,T}function DO(p,m){return m=iC({mode:"visible",children:m},p.mode,0,null),m.return=p,p.child=m}function W1(p,m,w,T){return T!==null&&oO(T),mm(m,p.child,null,w),p=DO(m,m.pendingProps.children),p.flags|=2,m.memoizedState=null,p}function $Ie(p,m,w,T,k,O,F){if(w)return m.flags&256?(m.flags&=-257,T=PO(Error(n(422))),W1(p,m,F,T)):m.memoizedState!==null?(m.child=p.child,m.flags|=128,null):(O=T.fallback,k=m.mode,T=iC({mode:"visible",children:T.children},k,0,null),O=up(O,k,F,null),O.flags|=2,T.return=m,O.return=m,T.sibling=O,m.child=T,(m.mode&1)!==0&&mm(m,p.child,null,F),m.child.memoizedState=OO(F),m.memoizedState=MO,O);if((m.mode&1)===0)return W1(p,m,F,null);if(k.data==="$!"){if(T=k.nextSibling&&k.nextSibling.dataset,T)var Y=T.dgst;return T=Y,O=Error(n(419)),T=PO(O,T,void 0),W1(p,m,F,T)}if(Y=(F&p.childLanes)!==0,No||Y){if(T=gi,T!==null){switch(F&-F){case 4:k=2;break;case 16:k=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:k=32;break;case 536870912:k=268435456;break;default:k=0}k=(k&(T.suspendedLanes|F))!==0?0:k,k!==0&&k!==O.retryLane&&(O.retryLane=k,$u(p,k),ec(T,p,k,-1))}return YO(),T=PO(Error(n(421))),W1(p,m,F,T)}return k.data==="$?"?(m.flags|=128,m.child=p.child,m=ZIe.bind(null,p),k._reactRetry=m,null):(p=O.treeContext,ua=sh(k.nextSibling),ca=m,Gn=!0,Xl=null,p!==null&&(el[tl++]=Lu,el[tl++]=Fu,el[tl++]=tp,Lu=p.id,Fu=p.overflow,tp=m),m=DO(m,T.children),m.flags|=4096,m)}function j7(p,m,w){p.lanes|=m;var T=p.alternate;T!==null&&(T.lanes|=m),uO(p.return,m,w)}function RO(p,m,w,T,k){var O=p.memoizedState;O===null?p.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:T,tail:w,tailMode:k}:(O.isBackwards=m,O.rendering=null,O.renderingStartTime=0,O.last=T,O.tail=w,O.tailMode=k)}function L7(p,m,w){var T=m.pendingProps,k=T.revealOrder,O=T.tail;if(eo(p,m,T.children,w),T=ir.current,(T&2)!==0)T=T&1|2,m.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=m.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&j7(p,w,m);else if(p.tag===19)j7(p,w,m);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===m)break e;for(;p.sibling===null;){if(p.return===null||p.return===m)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}T&=1}if(Dn(ir,T),(m.mode&1)===0)m.memoizedState=null;else switch(k){case"forwards":for(w=m.child,k=null;w!==null;)p=w.alternate,p!==null&&F1(p)===null&&(k=w),w=w.sibling;w=k,w===null?(k=m.child,m.child=null):(k=w.sibling,w.sibling=null),RO(m,!1,k,w,O);break;case"backwards":for(w=null,k=m.child,m.child=null;k!==null;){if(p=k.alternate,p!==null&&F1(p)===null){m.child=k;break}p=k.sibling,k.sibling=w,w=k,k=p}RO(m,!0,w,null,O);break;case"together":RO(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function K1(p,m){(m.mode&1)===0&&p!==null&&(p.alternate=null,m.alternate=null,m.flags|=2)}function zu(p,m,w){if(p!==null&&(m.dependencies=p.dependencies),op|=m.lanes,(w&m.childLanes)===0)return null;if(p!==null&&m.child!==p.child)throw Error(n(153));if(m.child!==null){for(p=m.child,w=mh(p,p.pendingProps),m.child=w,w.return=m;p.sibling!==null;)p=p.sibling,w=w.sibling=mh(p,p.pendingProps),w.return=m;w.sibling=null}return m.child}function BIe(p,m,w){switch(m.tag){case 3:D7(m),gm();break;case 5:JH(m);break;case 1:Ro(m.type)&&_1(m);break;case 4:fO(m,m.stateNode.containerInfo);break;case 10:var T=m.type._context,k=m.memoizedProps.value;Dn(R1,T._currentValue),T._currentValue=k;break;case 13:if(T=m.memoizedState,T!==null)return T.dehydrated!==null?(Dn(ir,ir.current&1),m.flags|=128,null):(w&m.child.childLanes)!==0?N7(p,m,w):(Dn(ir,ir.current&1),p=zu(p,m,w),p!==null?p.sibling:null);Dn(ir,ir.current&1);break;case 19:if(T=(w&m.childLanes)!==0,(p.flags&128)!==0){if(T)return L7(p,m,w);m.flags|=128}if(k=m.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),Dn(ir,ir.current),T)break;return null;case 22:case 23:return m.lanes=0,A7(p,m,w)}return zu(p,m,w)}var F7,NO,$7,B7;F7=function(p,m){for(var w=m.child;w!==null;){if(w.tag===5||w.tag===6)p.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===m)break;for(;w.sibling===null;){if(w.return===null||w.return===m)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},NO=function(){},$7=function(p,m,w,T){var k=p.memoizedProps;if(k!==T){p=m.stateNode,ip(zc.current);var O=null;switch(w){case"input":k=Se(p,k),T=Se(p,T),O=[];break;case"select":k=Z({},k,{value:void 0}),T=Z({},T,{value:void 0}),O=[];break;case"textarea":k=zl(p,k),T=zl(p,T),O=[];break;default:typeof k.onClick!="function"&&typeof T.onClick=="function"&&(p.onclick=T1)}ra(w,T);var F;w=null;for(ce in k)if(!T.hasOwnProperty(ce)&&k.hasOwnProperty(ce)&&k[ce]!=null)if(ce==="style"){var Y=k[ce];for(F in Y)Y.hasOwnProperty(F)&&(w||(w={}),w[F]="")}else ce!=="dangerouslySetInnerHTML"&&ce!=="children"&&ce!=="suppressContentEditableWarning"&&ce!=="suppressHydrationWarning"&&ce!=="autoFocus"&&(i.hasOwnProperty(ce)?O||(O=[]):(O=O||[]).push(ce,null));for(ce in T){var Q=T[ce];if(Y=k!=null?k[ce]:void 0,T.hasOwnProperty(ce)&&Q!==Y&&(Q!=null||Y!=null))if(ce==="style")if(Y){for(F in Y)!Y.hasOwnProperty(F)||Q&&Q.hasOwnProperty(F)||(w||(w={}),w[F]="");for(F in Q)Q.hasOwnProperty(F)&&Y[F]!==Q[F]&&(w||(w={}),w[F]=Q[F])}else w||(O||(O=[]),O.push(ce,w)),w=Q;else ce==="dangerouslySetInnerHTML"?(Q=Q?Q.__html:void 0,Y=Y?Y.__html:void 0,Q!=null&&Y!==Q&&(O=O||[]).push(ce,Q)):ce==="children"?typeof Q!="string"&&typeof Q!="number"||(O=O||[]).push(ce,""+Q):ce!=="suppressContentEditableWarning"&&ce!=="suppressHydrationWarning"&&(i.hasOwnProperty(ce)?(Q!=null&&ce==="onScroll"&&$n("scroll",p),O||Y===Q||(O=[])):(O=O||[]).push(ce,Q))}w&&(O=O||[]).push("style",w);var ce=O;(m.updateQueue=ce)&&(m.flags|=4)}},B7=function(p,m,w,T){w!==T&&(m.flags|=4)};function j0(p,m){if(!Gn)switch(p.tailMode){case"hidden":m=p.tail;for(var w=null;m!==null;)m.alternate!==null&&(w=m),m=m.sibling;w===null?p.tail=null:w.sibling=null;break;case"collapsed":w=p.tail;for(var T=null;w!==null;)w.alternate!==null&&(T=w),w=w.sibling;T===null?m||p.tail===null?p.tail=null:p.tail.sibling=null:T.sibling=null}}function ys(p){var m=p.alternate!==null&&p.alternate.child===p.child,w=0,T=0;if(m)for(var k=p.child;k!==null;)w|=k.lanes|k.childLanes,T|=k.subtreeFlags&14680064,T|=k.flags&14680064,k.return=p,k=k.sibling;else for(k=p.child;k!==null;)w|=k.lanes|k.childLanes,T|=k.subtreeFlags,T|=k.flags,k.return=p,k=k.sibling;return p.subtreeFlags|=T,p.childLanes=w,m}function zIe(p,m,w){var T=m.pendingProps;switch(rO(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ys(m),null;case 1:return Ro(m.type)&&P1(),ys(m),null;case 3:return T=m.stateNode,bm(),Bn(Do),Bn(gs),mO(),T.pendingContext&&(T.context=T.pendingContext,T.pendingContext=null),(p===null||p.child===null)&&(O1(m)?m.flags|=4:p===null||p.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,Xl!==null&&(KO(Xl),Xl=null))),NO(p,m),ys(m),null;case 5:pO(m);var k=ip(M0.current);if(w=m.type,p!==null&&m.stateNode!=null)$7(p,m,w,T,k),p.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!T){if(m.stateNode===null)throw Error(n(166));return ys(m),null}if(p=ip(zc.current),O1(m)){T=m.stateNode,w=m.type;var O=m.memoizedProps;switch(T[Bc]=m,T[I0]=O,p=(m.mode&1)!==0,w){case"dialog":$n("cancel",T),$n("close",T);break;case"iframe":case"object":case"embed":$n("load",T);break;case"video":case"audio":for(k=0;k<C0.length;k++)$n(C0[k],T);break;case"source":$n("error",T);break;case"img":case"image":case"link":$n("error",T),$n("load",T);break;case"details":$n("toggle",T);break;case"input":Fe(T,O),$n("invalid",T);break;case"select":T._wrapperState={wasMultiple:!!O.multiple},$n("invalid",T);break;case"textarea":Au(T,O),$n("invalid",T)}ra(w,O),k=null;for(var F in O)if(O.hasOwnProperty(F)){var Y=O[F];F==="children"?typeof Y=="string"?T.textContent!==Y&&(O.suppressHydrationWarning!==!0&&E1(T.textContent,Y,p),k=["children",Y]):typeof Y=="number"&&T.textContent!==""+Y&&(O.suppressHydrationWarning!==!0&&E1(T.textContent,Y,p),k=["children",""+Y]):i.hasOwnProperty(F)&&Y!=null&&F==="onScroll"&&$n("scroll",T)}switch(w){case"input":qe(T),pn(T,O,!0);break;case"textarea":qe(T),cs(T);break;case"select":case"option":break;default:typeof O.onClick=="function"&&(T.onclick=T1)}T=k,m.updateQueue=T,T!==null&&(m.flags|=4)}else{F=k.nodeType===9?k:k.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Ga(w)),p==="http://www.w3.org/1999/xhtml"?w==="script"?(p=F.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof T.is=="string"?p=F.createElement(w,{is:T.is}):(p=F.createElement(w),w==="select"&&(F=p,T.multiple?F.multiple=!0:T.size&&(F.size=T.size))):p=F.createElementNS(p,w),p[Bc]=m,p[I0]=T,F7(p,m,!1,!1),m.stateNode=p;e:{switch(F=Fi(w,T),w){case"dialog":$n("cancel",p),$n("close",p),k=T;break;case"iframe":case"object":case"embed":$n("load",p),k=T;break;case"video":case"audio":for(k=0;k<C0.length;k++)$n(C0[k],p);k=T;break;case"source":$n("error",p),k=T;break;case"img":case"image":case"link":$n("error",p),$n("load",p),k=T;break;case"details":$n("toggle",p),k=T;break;case"input":Fe(p,T),k=Se(p,T),$n("invalid",p);break;case"option":k=T;break;case"select":p._wrapperState={wasMultiple:!!T.multiple},k=Z({},T,{value:void 0}),$n("invalid",p);break;case"textarea":Au(p,T),k=zl(p,T),$n("invalid",p);break;default:k=T}ra(w,k),Y=k;for(O in Y)if(Y.hasOwnProperty(O)){var Q=Y[O];O==="style"?ui(p,Q):O==="dangerouslySetInnerHTML"?(Q=Q?Q.__html:void 0,Q!=null&&Nc(p,Q)):O==="children"?typeof Q=="string"?(w!=="textarea"||Q!=="")&&ue(p,Q):typeof Q=="number"&&ue(p,""+Q):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(i.hasOwnProperty(O)?Q!=null&&O==="onScroll"&&$n("scroll",p):Q!=null&&E(p,O,Q,F))}switch(w){case"input":qe(p),pn(p,T,!1);break;case"textarea":qe(p),cs(p);break;case"option":T.value!=null&&p.setAttribute("value",""+ke(T.value));break;case"select":p.multiple=!!T.multiple,O=T.value,O!=null?Yr(p,!!T.multiple,O,!1):T.defaultValue!=null&&Yr(p,!!T.multiple,T.defaultValue,!0);break;default:typeof k.onClick=="function"&&(p.onclick=T1)}switch(w){case"button":case"input":case"select":case"textarea":T=!!T.autoFocus;break e;case"img":T=!0;break e;default:T=!1}}T&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return ys(m),null;case 6:if(p&&m.stateNode!=null)B7(p,m,p.memoizedProps,T);else{if(typeof T!="string"&&m.stateNode===null)throw Error(n(166));if(w=ip(M0.current),ip(zc.current),O1(m)){if(T=m.stateNode,w=m.memoizedProps,T[Bc]=m,(O=T.nodeValue!==w)&&(p=ca,p!==null))switch(p.tag){case 3:E1(T.nodeValue,w,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&E1(T.nodeValue,w,(p.mode&1)!==0)}O&&(m.flags|=4)}else T=(w.nodeType===9?w:w.ownerDocument).createTextNode(T),T[Bc]=m,m.stateNode=T}return ys(m),null;case 13:if(Bn(ir),T=m.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(Gn&&ua!==null&&(m.mode&1)!==0&&(m.flags&128)===0)HH(),gm(),m.flags|=98560,O=!1;else if(O=O1(m),T!==null&&T.dehydrated!==null){if(p===null){if(!O)throw Error(n(318));if(O=m.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error(n(317));O[Bc]=m}else gm(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;ys(m),O=!1}else Xl!==null&&(KO(Xl),Xl=null),O=!0;if(!O)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=w,m):(T=T!==null,T!==(p!==null&&p.memoizedState!==null)&&T&&(m.child.flags|=8192,(m.mode&1)!==0&&(p===null||(ir.current&1)!==0?ei===0&&(ei=3):YO())),m.updateQueue!==null&&(m.flags|=4),ys(m),null);case 4:return bm(),NO(p,m),p===null&&E0(m.stateNode.containerInfo),ys(m),null;case 10:return cO(m.type._context),ys(m),null;case 17:return Ro(m.type)&&P1(),ys(m),null;case 19:if(Bn(ir),O=m.memoizedState,O===null)return ys(m),null;if(T=(m.flags&128)!==0,F=O.rendering,F===null)if(T)j0(O,!1);else{if(ei!==0||p!==null&&(p.flags&128)!==0)for(p=m.child;p!==null;){if(F=F1(p),F!==null){for(m.flags|=128,j0(O,!1),T=F.updateQueue,T!==null&&(m.updateQueue=T,m.flags|=4),m.subtreeFlags=0,T=w,w=m.child;w!==null;)O=w,p=T,O.flags&=14680066,F=O.alternate,F===null?(O.childLanes=0,O.lanes=p,O.child=null,O.subtreeFlags=0,O.memoizedProps=null,O.memoizedState=null,O.updateQueue=null,O.dependencies=null,O.stateNode=null):(O.childLanes=F.childLanes,O.lanes=F.lanes,O.child=F.child,O.subtreeFlags=0,O.deletions=null,O.memoizedProps=F.memoizedProps,O.memoizedState=F.memoizedState,O.updateQueue=F.updateQueue,O.type=F.type,p=F.dependencies,O.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),w=w.sibling;return Dn(ir,ir.current&1|2),m.child}p=p.sibling}O.tail!==null&&Ln()>Cm&&(m.flags|=128,T=!0,j0(O,!1),m.lanes=4194304)}else{if(!T)if(p=F1(F),p!==null){if(m.flags|=128,T=!0,w=p.updateQueue,w!==null&&(m.updateQueue=w,m.flags|=4),j0(O,!0),O.tail===null&&O.tailMode==="hidden"&&!F.alternate&&!Gn)return ys(m),null}else 2*Ln()-O.renderingStartTime>Cm&&w!==1073741824&&(m.flags|=128,T=!0,j0(O,!1),m.lanes=4194304);O.isBackwards?(F.sibling=m.child,m.child=F):(w=O.last,w!==null?w.sibling=F:m.child=F,O.last=F)}return O.tail!==null?(m=O.tail,O.rendering=m,O.tail=m.sibling,O.renderingStartTime=Ln(),m.sibling=null,w=ir.current,Dn(ir,T?w&1|2:w&1),m):(ys(m),null);case 22:case 23:return GO(),T=m.memoizedState!==null,p!==null&&p.memoizedState!==null!==T&&(m.flags|=8192),T&&(m.mode&1)!==0?(da&1073741824)!==0&&(ys(m),m.subtreeFlags&6&&(m.flags|=8192)):ys(m),null;case 24:return null;case 25:return null}throw Error(n(156,m.tag))}function UIe(p,m){switch(rO(m),m.tag){case 1:return Ro(m.type)&&P1(),p=m.flags,p&65536?(m.flags=p&-65537|128,m):null;case 3:return bm(),Bn(Do),Bn(gs),mO(),p=m.flags,(p&65536)!==0&&(p&128)===0?(m.flags=p&-65537|128,m):null;case 5:return pO(m),null;case 13:if(Bn(ir),p=m.memoizedState,p!==null&&p.dehydrated!==null){if(m.alternate===null)throw Error(n(340));gm()}return p=m.flags,p&65536?(m.flags=p&-65537|128,m):null;case 19:return Bn(ir),null;case 4:return bm(),null;case 10:return cO(m.type._context),null;case 22:case 23:return GO(),null;case 24:return null;default:return null}}var q1=!1,vs=!1,HIe=typeof WeakSet=="function"?WeakSet:Set,Je=null;function wm(p,m){var w=p.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(T){gr(p,m,T)}else w.current=null}function jO(p,m,w){try{w()}catch(T){gr(p,m,T)}}var z7=!1;function VIe(p,m){if(GM=ne,p=bH(),BM(p)){if("selectionStart"in p)var w={start:p.selectionStart,end:p.selectionEnd};else e:{w=(w=p.ownerDocument)&&w.defaultView||window;var T=w.getSelection&&w.getSelection();if(T&&T.rangeCount!==0){w=T.anchorNode;var k=T.anchorOffset,O=T.focusNode;T=T.focusOffset;try{w.nodeType,O.nodeType}catch{w=null;break e}var F=0,Y=-1,Q=-1,ce=0,Te=0,Me=p,Ce=null;t:for(;;){for(var Ke;Me!==w||k!==0&&Me.nodeType!==3||(Y=F+k),Me!==O||T!==0&&Me.nodeType!==3||(Q=F+T),Me.nodeType===3&&(F+=Me.nodeValue.length),(Ke=Me.firstChild)!==null;)Ce=Me,Me=Ke;for(;;){if(Me===p)break t;if(Ce===w&&++ce===k&&(Y=F),Ce===O&&++Te===T&&(Q=F),(Ke=Me.nextSibling)!==null)break;Me=Ce,Ce=Me.parentNode}Me=Ke}w=Y===-1||Q===-1?null:{start:Y,end:Q}}else w=null}w=w||{start:0,end:0}}else w=null;for(YM={focusedElem:p,selectionRange:w},ne=!1,Je=m;Je!==null;)if(m=Je,p=m.child,(m.subtreeFlags&1028)!==0&&p!==null)p.return=m,Je=p;else for(;Je!==null;){m=Je;try{var tt=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(tt!==null){var st=tt.memoizedProps,kr=tt.memoizedState,oe=m.stateNode,ee=oe.getSnapshotBeforeUpdate(m.elementType===m.type?st:Jl(m.type,st),kr);oe.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var ae=m.stateNode.containerInfo;ae.nodeType===1?ae.textContent="":ae.nodeType===9&&ae.documentElement&&ae.removeChild(ae.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Ne){gr(m,m.return,Ne)}if(p=m.sibling,p!==null){p.return=m.return,Je=p;break}Je=m.return}return tt=z7,z7=!1,tt}function L0(p,m,w){var T=m.updateQueue;if(T=T!==null?T.lastEffect:null,T!==null){var k=T=T.next;do{if((k.tag&p)===p){var O=k.destroy;k.destroy=void 0,O!==void 0&&jO(m,w,O)}k=k.next}while(k!==T)}}function G1(p,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var w=m=m.next;do{if((w.tag&p)===p){var T=w.create;w.destroy=T()}w=w.next}while(w!==m)}}function LO(p){var m=p.ref;if(m!==null){var w=p.stateNode;switch(p.tag){case 5:p=w;break;default:p=w}typeof m=="function"?m(p):m.current=p}}function U7(p){var m=p.alternate;m!==null&&(p.alternate=null,U7(m)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(m=p.stateNode,m!==null&&(delete m[Bc],delete m[I0],delete m[QM],delete m[IIe],delete m[PIe])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function H7(p){return p.tag===5||p.tag===3||p.tag===4}function V7(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||H7(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function FO(p,m,w){var T=p.tag;if(T===5||T===6)p=p.stateNode,m?w.nodeType===8?w.parentNode.insertBefore(p,m):w.insertBefore(p,m):(w.nodeType===8?(m=w.parentNode,m.insertBefore(p,w)):(m=w,m.appendChild(p)),w=w._reactRootContainer,w!=null||m.onclick!==null||(m.onclick=T1));else if(T!==4&&(p=p.child,p!==null))for(FO(p,m,w),p=p.sibling;p!==null;)FO(p,m,w),p=p.sibling}function $O(p,m,w){var T=p.tag;if(T===5||T===6)p=p.stateNode,m?w.insertBefore(p,m):w.appendChild(p);else if(T!==4&&(p=p.child,p!==null))for($O(p,m,w),p=p.sibling;p!==null;)$O(p,m,w),p=p.sibling}var Ui=null,Zl=!1;function dh(p,m,w){for(w=w.child;w!==null;)W7(p,m,w),w=w.sibling}function W7(p,m,w){if(Mo&&typeof Mo.onCommitFiberUnmount=="function")try{Mo.onCommitFiberUnmount(Qd,w)}catch{}switch(w.tag){case 5:vs||wm(w,m);case 6:var T=Ui,k=Zl;Ui=null,dh(p,m,w),Ui=T,Zl=k,Ui!==null&&(Zl?(p=Ui,w=w.stateNode,p.nodeType===8?p.parentNode.removeChild(w):p.removeChild(w)):Ui.removeChild(w.stateNode));break;case 18:Ui!==null&&(Zl?(p=Ui,w=w.stateNode,p.nodeType===8?ZM(p.parentNode,w):p.nodeType===1&&ZM(p,w),Zs(p)):ZM(Ui,w.stateNode));break;case 4:T=Ui,k=Zl,Ui=w.stateNode.containerInfo,Zl=!0,dh(p,m,w),Ui=T,Zl=k;break;case 0:case 11:case 14:case 15:if(!vs&&(T=w.updateQueue,T!==null&&(T=T.lastEffect,T!==null))){k=T=T.next;do{var O=k,F=O.destroy;O=O.tag,F!==void 0&&((O&2)!==0||(O&4)!==0)&&jO(w,m,F),k=k.next}while(k!==T)}dh(p,m,w);break;case 1:if(!vs&&(wm(w,m),T=w.stateNode,typeof T.componentWillUnmount=="function"))try{T.props=w.memoizedProps,T.state=w.memoizedState,T.componentWillUnmount()}catch(Y){gr(w,m,Y)}dh(p,m,w);break;case 21:dh(p,m,w);break;case 22:w.mode&1?(vs=(T=vs)||w.memoizedState!==null,dh(p,m,w),vs=T):dh(p,m,w);break;default:dh(p,m,w)}}function K7(p){var m=p.updateQueue;if(m!==null){p.updateQueue=null;var w=p.stateNode;w===null&&(w=p.stateNode=new HIe),m.forEach(function(T){var k=QIe.bind(null,p,T);w.has(T)||(w.add(T),T.then(k,k))})}}function Ql(p,m){var w=m.deletions;if(w!==null)for(var T=0;T<w.length;T++){var k=w[T];try{var O=p,F=m,Y=F;e:for(;Y!==null;){switch(Y.tag){case 5:Ui=Y.stateNode,Zl=!1;break e;case 3:Ui=Y.stateNode.containerInfo,Zl=!0;break e;case 4:Ui=Y.stateNode.containerInfo,Zl=!0;break e}Y=Y.return}if(Ui===null)throw Error(n(160));W7(O,F,k),Ui=null,Zl=!1;var Q=k.alternate;Q!==null&&(Q.return=null),k.return=null}catch(ce){gr(k,m,ce)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)q7(m,p),m=m.sibling}function q7(p,m){var w=p.alternate,T=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Ql(m,p),Hc(p),T&4){try{L0(3,p,p.return),G1(3,p)}catch(st){gr(p,p.return,st)}try{L0(5,p,p.return)}catch(st){gr(p,p.return,st)}}break;case 1:Ql(m,p),Hc(p),T&512&&w!==null&&wm(w,w.return);break;case 5:if(Ql(m,p),Hc(p),T&512&&w!==null&&wm(w,w.return),p.flags&32){var k=p.stateNode;try{ue(k,"")}catch(st){gr(p,p.return,st)}}if(T&4&&(k=p.stateNode,k!=null)){var O=p.memoizedProps,F=w!==null?w.memoizedProps:O,Y=p.type,Q=p.updateQueue;if(p.updateQueue=null,Q!==null)try{Y==="input"&&O.type==="radio"&&O.name!=null&&ut(k,O),Fi(Y,F);var ce=Fi(Y,O);for(F=0;F<Q.length;F+=2){var Te=Q[F],Me=Q[F+1];Te==="style"?ui(k,Me):Te==="dangerouslySetInnerHTML"?Nc(k,Me):Te==="children"?ue(k,Me):E(k,Te,Me,ce)}switch(Y){case"input":Tt(k,O);break;case"textarea":Mu(k,O);break;case"select":var Ce=k._wrapperState.wasMultiple;k._wrapperState.wasMultiple=!!O.multiple;var Ke=O.value;Ke!=null?Yr(k,!!O.multiple,Ke,!1):Ce!==!!O.multiple&&(O.defaultValue!=null?Yr(k,!!O.multiple,O.defaultValue,!0):Yr(k,!!O.multiple,O.multiple?[]:"",!1))}k[I0]=O}catch(st){gr(p,p.return,st)}}break;case 6:if(Ql(m,p),Hc(p),T&4){if(p.stateNode===null)throw Error(n(162));k=p.stateNode,O=p.memoizedProps;try{k.nodeValue=O}catch(st){gr(p,p.return,st)}}break;case 3:if(Ql(m,p),Hc(p),T&4&&w!==null&&w.memoizedState.isDehydrated)try{Zs(m.containerInfo)}catch(st){gr(p,p.return,st)}break;case 4:Ql(m,p),Hc(p);break;case 13:Ql(m,p),Hc(p),k=p.child,k.flags&8192&&(O=k.memoizedState!==null,k.stateNode.isHidden=O,!O||k.alternate!==null&&k.alternate.memoizedState!==null||(UO=Ln())),T&4&&K7(p);break;case 22:if(Te=w!==null&&w.memoizedState!==null,p.mode&1?(vs=(ce=vs)||Te,Ql(m,p),vs=ce):Ql(m,p),Hc(p),T&8192){if(ce=p.memoizedState!==null,(p.stateNode.isHidden=ce)&&!Te&&(p.mode&1)!==0)for(Je=p,Te=p.child;Te!==null;){for(Me=Je=Te;Je!==null;){switch(Ce=Je,Ke=Ce.child,Ce.tag){case 0:case 11:case 14:case 15:L0(4,Ce,Ce.return);break;case 1:wm(Ce,Ce.return);var tt=Ce.stateNode;if(typeof tt.componentWillUnmount=="function"){T=Ce,w=Ce.return;try{m=T,tt.props=m.memoizedProps,tt.state=m.memoizedState,tt.componentWillUnmount()}catch(st){gr(T,w,st)}}break;case 5:wm(Ce,Ce.return);break;case 22:if(Ce.memoizedState!==null){X7(Me);continue}}Ke!==null?(Ke.return=Ce,Je=Ke):X7(Me)}Te=Te.sibling}e:for(Te=null,Me=p;;){if(Me.tag===5){if(Te===null){Te=Me;try{k=Me.stateNode,ce?(O=k.style,typeof O.setProperty=="function"?O.setProperty("display","none","important"):O.display="none"):(Y=Me.stateNode,Q=Me.memoizedProps.style,F=Q!=null&&Q.hasOwnProperty("display")?Q.display:null,Y.style.display=on("display",F))}catch(st){gr(p,p.return,st)}}}else if(Me.tag===6){if(Te===null)try{Me.stateNode.nodeValue=ce?"":Me.memoizedProps}catch(st){gr(p,p.return,st)}}else if((Me.tag!==22&&Me.tag!==23||Me.memoizedState===null||Me===p)&&Me.child!==null){Me.child.return=Me,Me=Me.child;continue}if(Me===p)break e;for(;Me.sibling===null;){if(Me.return===null||Me.return===p)break e;Te===Me&&(Te=null),Me=Me.return}Te===Me&&(Te=null),Me.sibling.return=Me.return,Me=Me.sibling}}break;case 19:Ql(m,p),Hc(p),T&4&&K7(p);break;case 21:break;default:Ql(m,p),Hc(p)}}function Hc(p){var m=p.flags;if(m&2){try{e:{for(var w=p.return;w!==null;){if(H7(w)){var T=w;break e}w=w.return}throw Error(n(160))}switch(T.tag){case 5:var k=T.stateNode;T.flags&32&&(ue(k,""),T.flags&=-33);var O=V7(p);$O(p,O,k);break;case 3:case 4:var F=T.stateNode.containerInfo,Y=V7(p);FO(p,Y,F);break;default:throw Error(n(161))}}catch(Q){gr(p,p.return,Q)}p.flags&=-3}m&4096&&(p.flags&=-4097)}function WIe(p,m,w){Je=p,G7(p)}function G7(p,m,w){for(var T=(p.mode&1)!==0;Je!==null;){var k=Je,O=k.child;if(k.tag===22&&T){var F=k.memoizedState!==null||q1;if(!F){var Y=k.alternate,Q=Y!==null&&Y.memoizedState!==null||vs;Y=q1;var ce=vs;if(q1=F,(vs=Q)&&!ce)for(Je=k;Je!==null;)F=Je,Q=F.child,F.tag===22&&F.memoizedState!==null?J7(k):Q!==null?(Q.return=F,Je=Q):J7(k);for(;O!==null;)Je=O,G7(O),O=O.sibling;Je=k,q1=Y,vs=ce}Y7(p)}else(k.subtreeFlags&8772)!==0&&O!==null?(O.return=k,Je=O):Y7(p)}}function Y7(p){for(;Je!==null;){var m=Je;if((m.flags&8772)!==0){var w=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:vs||G1(5,m);break;case 1:var T=m.stateNode;if(m.flags&4&&!vs)if(w===null)T.componentDidMount();else{var k=m.elementType===m.type?w.memoizedProps:Jl(m.type,w.memoizedProps);T.componentDidUpdate(k,w.memoizedState,T.__reactInternalSnapshotBeforeUpdate)}var O=m.updateQueue;O!==null&&XH(m,O,T);break;case 3:var F=m.updateQueue;if(F!==null){if(w=null,m.child!==null)switch(m.child.tag){case 5:w=m.child.stateNode;break;case 1:w=m.child.stateNode}XH(m,F,w)}break;case 5:var Y=m.stateNode;if(w===null&&m.flags&4){w=Y;var Q=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":Q.autoFocus&&w.focus();break;case"img":Q.src&&(w.src=Q.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var ce=m.alternate;if(ce!==null){var Te=ce.memoizedState;if(Te!==null){var Me=Te.dehydrated;Me!==null&&Zs(Me)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}vs||m.flags&512&&LO(m)}catch(Ce){gr(m,m.return,Ce)}}if(m===p){Je=null;break}if(w=m.sibling,w!==null){w.return=m.return,Je=w;break}Je=m.return}}function X7(p){for(;Je!==null;){var m=Je;if(m===p){Je=null;break}var w=m.sibling;if(w!==null){w.return=m.return,Je=w;break}Je=m.return}}function J7(p){for(;Je!==null;){var m=Je;try{switch(m.tag){case 0:case 11:case 15:var w=m.return;try{G1(4,m)}catch(Q){gr(m,w,Q)}break;case 1:var T=m.stateNode;if(typeof T.componentDidMount=="function"){var k=m.return;try{T.componentDidMount()}catch(Q){gr(m,k,Q)}}var O=m.return;try{LO(m)}catch(Q){gr(m,O,Q)}break;case 5:var F=m.return;try{LO(m)}catch(Q){gr(m,F,Q)}}}catch(Q){gr(m,m.return,Q)}if(m===p){Je=null;break}var Y=m.sibling;if(Y!==null){Y.return=m.return,Je=Y;break}Je=m.return}}var KIe=Math.ceil,Y1=I.ReactCurrentDispatcher,BO=I.ReactCurrentOwner,il=I.ReactCurrentBatchConfig,nn=0,gi=null,$r=null,Hi=0,da=0,Sm=oh(0),ei=0,F0=null,op=0,X1=0,zO=0,$0=null,jo=null,UO=0,Cm=1/0,Uu=null,J1=!1,HO=null,hh=null,Z1=!1,fh=null,Q1=0,B0=0,VO=null,eC=-1,tC=0;function to(){return(nn&6)!==0?Ln():eC!==-1?eC:eC=Ln()}function ph(p){return(p.mode&1)===0?1:(nn&2)!==0&&Hi!==0?Hi&-Hi:kIe.transition!==null?(tC===0&&(tC=Xf()),tC):(p=qt,p!==0||(p=window.event,p=p===void 0?16:Pr(p.type)),p)}function ec(p,m,w,T){if(50<B0)throw B0=0,VO=null,Error(n(185));ql(p,w,T),((nn&2)===0||p!==gi)&&(p===gi&&((nn&2)===0&&(X1|=w),ei===4&&gh(p,Hi)),Lo(p,T),w===1&&nn===0&&(m.mode&1)===0&&(Cm=Ln()+500,k1&&lh()))}function Lo(p,m){var w=p.callbackNode;m0(p,m);var T=Du(p,p===gi?Hi:0);if(T===0)w!==null&&Xa(w),p.callbackNode=null,p.callbackPriority=0;else if(m=T&-T,p.callbackPriority!==m){if(w!=null&&Xa(w),m===1)p.tag===0?_Ie(Q7.bind(null,p)):FH(Q7.bind(null,p)),EIe(function(){(nn&6)===0&&lh()}),w=null;else{switch(Za(T)){case 1:w=Yf;break;case 4:w=Ja;break;case 16:w=Zd;break;case 536870912:w=oa;break;default:w=Zd}w=aV(w,Z7.bind(null,p))}p.callbackPriority=m,p.callbackNode=w}}function Z7(p,m){if(eC=-1,tC=0,(nn&6)!==0)throw Error(n(327));var w=p.callbackNode;if(Em()&&p.callbackNode!==w)return null;var T=Du(p,p===gi?Hi:0);if(T===0)return null;if((T&30)!==0||(T&p.expiredLanes)!==0||m)m=nC(p,T);else{m=T;var k=nn;nn|=2;var O=tV();(gi!==p||Hi!==m)&&(Uu=null,Cm=Ln()+500,lp(p,m));do try{YIe();break}catch(Y){eV(p,Y)}while(!0);lO(),Y1.current=O,nn=k,$r!==null?m=0:(gi=null,Hi=0,m=ei)}if(m!==0){if(m===2&&(k=la(p),k!==0&&(T=k,m=WO(p,k))),m===1)throw w=F0,lp(p,0),gh(p,T),Lo(p,Ln()),w;if(m===6)gh(p,T);else{if(k=p.current.alternate,(T&30)===0&&!qIe(k)&&(m=nC(p,T),m===2&&(O=la(p),O!==0&&(T=O,m=WO(p,O))),m===1))throw w=F0,lp(p,0),gh(p,T),Lo(p,Ln()),w;switch(p.finishedWork=k,p.finishedLanes=T,m){case 0:case 1:throw Error(n(345));case 2:cp(p,jo,Uu);break;case 3:if(gh(p,T),(T&130023424)===T&&(m=UO+500-Ln(),10<m)){if(Du(p,0)!==0)break;if(k=p.suspendedLanes,(k&T)!==T){to(),p.pingedLanes|=p.suspendedLanes&k;break}p.timeoutHandle=JM(cp.bind(null,p,jo,Uu),m);break}cp(p,jo,Uu);break;case 4:if(gh(p,T),(T&4194240)===T)break;for(m=p.eventTimes,k=-1;0<T;){var F=31-hs(T);O=1<<F,F=m[F],F>k&&(k=F),T&=~O}if(T=k,T=Ln()-T,T=(120>T?120:480>T?480:1080>T?1080:1920>T?1920:3e3>T?3e3:4320>T?4320:1960*KIe(T/1960))-T,10<T){p.timeoutHandle=JM(cp.bind(null,p,jo,Uu),T);break}cp(p,jo,Uu);break;case 5:cp(p,jo,Uu);break;default:throw Error(n(329))}}}return Lo(p,Ln()),p.callbackNode===w?Z7.bind(null,p):null}function WO(p,m){var w=$0;return p.current.memoizedState.isDehydrated&&(lp(p,m).flags|=256),p=nC(p,m),p!==2&&(m=jo,jo=w,m!==null&&KO(m)),p}function KO(p){jo===null?jo=p:jo.push.apply(jo,p)}function qIe(p){for(var m=p;;){if(m.flags&16384){var w=m.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var T=0;T<w.length;T++){var k=w[T],O=k.getSnapshot;k=k.value;try{if(!Yl(O(),k))return!1}catch{return!1}}}if(w=m.child,m.subtreeFlags&16384&&w!==null)w.return=m,m=w;else{if(m===p)break;for(;m.sibling===null;){if(m.return===null||m.return===p)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function gh(p,m){for(m&=~zO,m&=~X1,p.suspendedLanes|=m,p.pingedLanes&=~m,p=p.expirationTimes;0<m;){var w=31-hs(m),T=1<<w;p[w]=-1,m&=~T}}function Q7(p){if((nn&6)!==0)throw Error(n(327));Em();var m=Du(p,0);if((m&1)===0)return Lo(p,Ln()),null;var w=nC(p,m);if(p.tag!==0&&w===2){var T=la(p);T!==0&&(m=T,w=WO(p,T))}if(w===1)throw w=F0,lp(p,0),gh(p,m),Lo(p,Ln()),w;if(w===6)throw Error(n(345));return p.finishedWork=p.current.alternate,p.finishedLanes=m,cp(p,jo,Uu),Lo(p,Ln()),null}function qO(p,m){var w=nn;nn|=1;try{return p(m)}finally{nn=w,nn===0&&(Cm=Ln()+500,k1&&lh())}}function ap(p){fh!==null&&fh.tag===0&&(nn&6)===0&&Em();var m=nn;nn|=1;var w=il.transition,T=qt;try{if(il.transition=null,qt=1,p)return p()}finally{qt=T,il.transition=w,nn=m,(nn&6)===0&&lh()}}function GO(){da=Sm.current,Bn(Sm)}function lp(p,m){p.finishedWork=null,p.finishedLanes=0;var w=p.timeoutHandle;if(w!==-1&&(p.timeoutHandle=-1,CIe(w)),$r!==null)for(w=$r.return;w!==null;){var T=w;switch(rO(T),T.tag){case 1:T=T.type.childContextTypes,T!=null&&P1();break;case 3:bm(),Bn(Do),Bn(gs),mO();break;case 5:pO(T);break;case 4:bm();break;case 13:Bn(ir);break;case 19:Bn(ir);break;case 10:cO(T.type._context);break;case 22:case 23:GO()}w=w.return}if(gi=p,$r=p=mh(p.current,null),Hi=da=m,ei=0,F0=null,zO=X1=op=0,jo=$0=null,rp!==null){for(m=0;m<rp.length;m++)if(w=rp[m],T=w.interleaved,T!==null){w.interleaved=null;var k=T.next,O=w.pending;if(O!==null){var F=O.next;O.next=k,T.next=F}w.pending=T}rp=null}return p}function eV(p,m){do{var w=$r;try{if(lO(),$1.current=H1,B1){for(var T=sr.memoizedState;T!==null;){var k=T.queue;k!==null&&(k.pending=null),T=T.next}B1=!1}if(sp=0,pi=Qr=sr=null,O0=!1,D0=0,BO.current=null,w===null||w.return===null){ei=1,F0=m,$r=null;break}e:{var O=p,F=w.return,Y=w,Q=m;if(m=Hi,Y.flags|=32768,Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var ce=Q,Te=Y,Me=Te.tag;if((Te.mode&1)===0&&(Me===0||Me===11||Me===15)){var Ce=Te.alternate;Ce?(Te.updateQueue=Ce.updateQueue,Te.memoizedState=Ce.memoizedState,Te.lanes=Ce.lanes):(Te.updateQueue=null,Te.memoizedState=null)}var Ke=T7(F);if(Ke!==null){Ke.flags&=-257,I7(Ke,F,Y,O,m),Ke.mode&1&&E7(O,ce,m),m=Ke,Q=ce;var tt=m.updateQueue;if(tt===null){var st=new Set;st.add(Q),m.updateQueue=st}else tt.add(Q);break e}else{if((m&1)===0){E7(O,ce,m),YO();break e}Q=Error(n(426))}}else if(Gn&&Y.mode&1){var kr=T7(F);if(kr!==null){(kr.flags&65536)===0&&(kr.flags|=256),I7(kr,F,Y,O,m),oO(xm(Q,Y));break e}}O=Q=xm(Q,Y),ei!==4&&(ei=2),$0===null?$0=[O]:$0.push(O),O=F;do{switch(O.tag){case 3:O.flags|=65536,m&=-m,O.lanes|=m;var oe=S7(O,Q,m);YH(O,oe);break e;case 1:Y=Q;var ee=O.type,ae=O.stateNode;if((O.flags&128)===0&&(typeof ee.getDerivedStateFromError=="function"||ae!==null&&typeof ae.componentDidCatch=="function"&&(hh===null||!hh.has(ae)))){O.flags|=65536,m&=-m,O.lanes|=m;var Ne=C7(O,Y,m);YH(O,Ne);break e}}O=O.return}while(O!==null)}rV(w)}catch(ot){m=ot,$r===w&&w!==null&&($r=w=w.return);continue}break}while(!0)}function tV(){var p=Y1.current;return Y1.current=H1,p===null?H1:p}function YO(){(ei===0||ei===3||ei===2)&&(ei=4),gi===null||(op&268435455)===0&&(X1&268435455)===0||gh(gi,Hi)}function nC(p,m){var w=nn;nn|=2;var T=tV();(gi!==p||Hi!==m)&&(Uu=null,lp(p,m));do try{GIe();break}catch(k){eV(p,k)}while(!0);if(lO(),nn=w,Y1.current=T,$r!==null)throw Error(n(261));return gi=null,Hi=0,ei}function GIe(){for(;$r!==null;)nV($r)}function YIe(){for(;$r!==null&&!c0();)nV($r)}function nV(p){var m=oV(p.alternate,p,da);p.memoizedProps=p.pendingProps,m===null?rV(p):$r=m,BO.current=null}function rV(p){var m=p;do{var w=m.alternate;if(p=m.return,(m.flags&32768)===0){if(w=zIe(w,m,da),w!==null){$r=w;return}}else{if(w=UIe(w,m),w!==null){w.flags&=32767,$r=w;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{ei=6,$r=null;return}}if(m=m.sibling,m!==null){$r=m;return}$r=m=p}while(m!==null);ei===0&&(ei=5)}function cp(p,m,w){var T=qt,k=il.transition;try{il.transition=null,qt=1,XIe(p,m,w,T)}finally{il.transition=k,qt=T}return null}function XIe(p,m,w,T){do Em();while(fh!==null);if((nn&6)!==0)throw Error(n(327));w=p.finishedWork;var k=p.finishedLanes;if(w===null)return null;if(p.finishedWork=null,p.finishedLanes=0,w===p.current)throw Error(n(177));p.callbackNode=null,p.callbackPriority=0;var O=w.lanes|w.childLanes;if(nm(p,O),p===gi&&($r=gi=null,Hi=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||Z1||(Z1=!0,aV(Zd,function(){return Em(),null})),O=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||O){O=il.transition,il.transition=null;var F=qt;qt=1;var Y=nn;nn|=4,BO.current=null,VIe(p,w),q7(w,p),mIe(YM),ne=!!GM,YM=GM=null,p.current=w,WIe(w),u0(),nn=Y,qt=F,il.transition=O}else p.current=w;if(Z1&&(Z1=!1,fh=p,Q1=k),O=p.pendingLanes,O===0&&(hh=null),h0(w.stateNode),Lo(p,Ln()),m!==null)for(T=p.onRecoverableError,w=0;w<m.length;w++)k=m[w],T(k.value,{componentStack:k.stack,digest:k.digest});if(J1)throw J1=!1,p=HO,HO=null,p;return(Q1&1)!==0&&p.tag!==0&&Em(),O=p.pendingLanes,(O&1)!==0?p===VO?B0++:(B0=0,VO=p):B0=0,lh(),null}function Em(){if(fh!==null){var p=Za(Q1),m=il.transition,w=qt;try{if(il.transition=null,qt=16>p?16:p,fh===null)var T=!1;else{if(p=fh,fh=null,Q1=0,(nn&6)!==0)throw Error(n(331));var k=nn;for(nn|=4,Je=p.current;Je!==null;){var O=Je,F=O.child;if((Je.flags&16)!==0){var Y=O.deletions;if(Y!==null){for(var Q=0;Q<Y.length;Q++){var ce=Y[Q];for(Je=ce;Je!==null;){var Te=Je;switch(Te.tag){case 0:case 11:case 15:L0(8,Te,O)}var Me=Te.child;if(Me!==null)Me.return=Te,Je=Me;else for(;Je!==null;){Te=Je;var Ce=Te.sibling,Ke=Te.return;if(U7(Te),Te===ce){Je=null;break}if(Ce!==null){Ce.return=Ke,Je=Ce;break}Je=Ke}}}var tt=O.alternate;if(tt!==null){var st=tt.child;if(st!==null){tt.child=null;do{var kr=st.sibling;st.sibling=null,st=kr}while(st!==null)}}Je=O}}if((O.subtreeFlags&2064)!==0&&F!==null)F.return=O,Je=F;else e:for(;Je!==null;){if(O=Je,(O.flags&2048)!==0)switch(O.tag){case 0:case 11:case 15:L0(9,O,O.return)}var oe=O.sibling;if(oe!==null){oe.return=O.return,Je=oe;break e}Je=O.return}}var ee=p.current;for(Je=ee;Je!==null;){F=Je;var ae=F.child;if((F.subtreeFlags&2064)!==0&&ae!==null)ae.return=F,Je=ae;else e:for(F=ee;Je!==null;){if(Y=Je,(Y.flags&2048)!==0)try{switch(Y.tag){case 0:case 11:case 15:G1(9,Y)}}catch(ot){gr(Y,Y.return,ot)}if(Y===F){Je=null;break e}var Ne=Y.sibling;if(Ne!==null){Ne.return=Y.return,Je=Ne;break e}Je=Y.return}}if(nn=k,lh(),Mo&&typeof Mo.onPostCommitFiberRoot=="function")try{Mo.onPostCommitFiberRoot(Qd,p)}catch{}T=!0}return T}finally{qt=w,il.transition=m}}return!1}function iV(p,m,w){m=xm(w,m),m=S7(p,m,1),p=uh(p,m,1),m=to(),p!==null&&(ql(p,1,m),Lo(p,m))}function gr(p,m,w){if(p.tag===3)iV(p,p,w);else for(;m!==null;){if(m.tag===3){iV(m,p,w);break}else if(m.tag===1){var T=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof T.componentDidCatch=="function"&&(hh===null||!hh.has(T))){p=xm(w,p),p=C7(m,p,1),m=uh(m,p,1),p=to(),m!==null&&(ql(m,1,p),Lo(m,p));break}}m=m.return}}function JIe(p,m,w){var T=p.pingCache;T!==null&&T.delete(m),m=to(),p.pingedLanes|=p.suspendedLanes&w,gi===p&&(Hi&w)===w&&(ei===4||ei===3&&(Hi&130023424)===Hi&&500>Ln()-UO?lp(p,0):zO|=w),Lo(p,m)}function sV(p,m){m===0&&((p.mode&1)===0?m=1:(m=Jr,Jr<<=1,(Jr&130023424)===0&&(Jr=4194304)));var w=to();p=$u(p,m),p!==null&&(ql(p,m,w),Lo(p,w))}function ZIe(p){var m=p.memoizedState,w=0;m!==null&&(w=m.retryLane),sV(p,w)}function QIe(p,m){var w=0;switch(p.tag){case 13:var T=p.stateNode,k=p.memoizedState;k!==null&&(w=k.retryLane);break;case 19:T=p.stateNode;break;default:throw Error(n(314))}T!==null&&T.delete(m),sV(p,w)}var oV;oV=function(p,m,w){if(p!==null)if(p.memoizedProps!==m.pendingProps||Do.current)No=!0;else{if((p.lanes&w)===0&&(m.flags&128)===0)return No=!1,BIe(p,m,w);No=(p.flags&131072)!==0}else No=!1,Gn&&(m.flags&1048576)!==0&&$H(m,M1,m.index);switch(m.lanes=0,m.tag){case 2:var T=m.type;K1(p,m),p=m.pendingProps;var k=hm(m,gs.current);vm(m,w),k=bO(null,m,T,p,k,w);var O=xO();return m.flags|=1,typeof k=="object"&&k!==null&&typeof k.render=="function"&&k.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,Ro(T)?(O=!0,_1(m)):O=!1,m.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,hO(m),k.updater=V1,m.stateNode=k,k._reactInternals=m,IO(m,T,p,w),m=AO(null,m,T,!0,O,w)):(m.tag=0,Gn&&O&&nO(m),eo(null,m,k,w),m=m.child),m;case 16:T=m.elementType;e:{switch(K1(p,m),p=m.pendingProps,k=T._init,T=k(T._payload),m.type=T,k=m.tag=tPe(T),p=Jl(T,p),k){case 0:m=kO(null,m,T,p,w);break e;case 1:m=O7(null,m,T,p,w);break e;case 11:m=P7(null,m,T,p,w);break e;case 14:m=_7(null,m,T,Jl(T.type,p),w);break e}throw Error(n(306,T,""))}return m;case 0:return T=m.type,k=m.pendingProps,k=m.elementType===T?k:Jl(T,k),kO(p,m,T,k,w);case 1:return T=m.type,k=m.pendingProps,k=m.elementType===T?k:Jl(T,k),O7(p,m,T,k,w);case 3:e:{if(D7(m),p===null)throw Error(n(387));T=m.pendingProps,O=m.memoizedState,k=O.element,GH(p,m),L1(m,T,null,w);var F=m.memoizedState;if(T=F.element,O.isDehydrated)if(O={element:T,isDehydrated:!1,cache:F.cache,pendingSuspenseBoundaries:F.pendingSuspenseBoundaries,transitions:F.transitions},m.updateQueue.baseState=O,m.memoizedState=O,m.flags&256){k=xm(Error(n(423)),m),m=R7(p,m,T,w,k);break e}else if(T!==k){k=xm(Error(n(424)),m),m=R7(p,m,T,w,k);break e}else for(ua=sh(m.stateNode.containerInfo.firstChild),ca=m,Gn=!0,Xl=null,w=KH(m,null,T,w),m.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(gm(),T===k){m=zu(p,m,w);break e}eo(p,m,T,w)}m=m.child}return m;case 5:return JH(m),p===null&&sO(m),T=m.type,k=m.pendingProps,O=p!==null?p.memoizedProps:null,F=k.children,XM(T,k)?F=null:O!==null&&XM(T,O)&&(m.flags|=32),M7(p,m),eo(p,m,F,w),m.child;case 6:return p===null&&sO(m),null;case 13:return N7(p,m,w);case 4:return fO(m,m.stateNode.containerInfo),T=m.pendingProps,p===null?m.child=mm(m,null,T,w):eo(p,m,T,w),m.child;case 11:return T=m.type,k=m.pendingProps,k=m.elementType===T?k:Jl(T,k),P7(p,m,T,k,w);case 7:return eo(p,m,m.pendingProps,w),m.child;case 8:return eo(p,m,m.pendingProps.children,w),m.child;case 12:return eo(p,m,m.pendingProps.children,w),m.child;case 10:e:{if(T=m.type._context,k=m.pendingProps,O=m.memoizedProps,F=k.value,Dn(R1,T._currentValue),T._currentValue=F,O!==null)if(Yl(O.value,F)){if(O.children===k.children&&!Do.current){m=zu(p,m,w);break e}}else for(O=m.child,O!==null&&(O.return=m);O!==null;){var Y=O.dependencies;if(Y!==null){F=O.child;for(var Q=Y.firstContext;Q!==null;){if(Q.context===T){if(O.tag===1){Q=Bu(-1,w&-w),Q.tag=2;var ce=O.updateQueue;if(ce!==null){ce=ce.shared;var Te=ce.pending;Te===null?Q.next=Q:(Q.next=Te.next,Te.next=Q),ce.pending=Q}}O.lanes|=w,Q=O.alternate,Q!==null&&(Q.lanes|=w),uO(O.return,w,m),Y.lanes|=w;break}Q=Q.next}}else if(O.tag===10)F=O.type===m.type?null:O.child;else if(O.tag===18){if(F=O.return,F===null)throw Error(n(341));F.lanes|=w,Y=F.alternate,Y!==null&&(Y.lanes|=w),uO(F,w,m),F=O.sibling}else F=O.child;if(F!==null)F.return=O;else for(F=O;F!==null;){if(F===m){F=null;break}if(O=F.sibling,O!==null){O.return=F.return,F=O;break}F=F.return}O=F}eo(p,m,k.children,w),m=m.child}return m;case 9:return k=m.type,T=m.pendingProps.children,vm(m,w),k=nl(k),T=T(k),m.flags|=1,eo(p,m,T,w),m.child;case 14:return T=m.type,k=Jl(T,m.pendingProps),k=Jl(T.type,k),_7(p,m,T,k,w);case 15:return k7(p,m,m.type,m.pendingProps,w);case 17:return T=m.type,k=m.pendingProps,k=m.elementType===T?k:Jl(T,k),K1(p,m),m.tag=1,Ro(T)?(p=!0,_1(m)):p=!1,vm(m,w),x7(m,T,k),IO(m,T,k,w),AO(null,m,T,!0,p,w);case 19:return L7(p,m,w);case 22:return A7(p,m,w)}throw Error(n(156,m.tag))};function aV(p,m){return sa(p,m)}function ePe(p,m,w,T){this.tag=p,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=T,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sl(p,m,w,T){return new ePe(p,m,w,T)}function XO(p){return p=p.prototype,!(!p||!p.isReactComponent)}function tPe(p){if(typeof p=="function")return XO(p)?1:0;if(p!=null){if(p=p.$$typeof,p===H)return 11;if(p===B)return 14}return 2}function mh(p,m){var w=p.alternate;return w===null?(w=sl(p.tag,m,p.key,p.mode),w.elementType=p.elementType,w.type=p.type,w.stateNode=p.stateNode,w.alternate=p,p.alternate=w):(w.pendingProps=m,w.type=p.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=p.flags&14680064,w.childLanes=p.childLanes,w.lanes=p.lanes,w.child=p.child,w.memoizedProps=p.memoizedProps,w.memoizedState=p.memoizedState,w.updateQueue=p.updateQueue,m=p.dependencies,w.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},w.sibling=p.sibling,w.index=p.index,w.ref=p.ref,w}function rC(p,m,w,T,k,O){var F=2;if(T=p,typeof p=="function")XO(p)&&(F=1);else if(typeof p=="string")F=5;else e:switch(p){case A:return up(w.children,k,O,m);case D:F=8,k|=8;break;case L:return p=sl(12,w,m,k|2),p.elementType=L,p.lanes=O,p;case R:return p=sl(13,w,m,k),p.elementType=R,p.lanes=O,p;case j:return p=sl(19,w,m,k),p.elementType=j,p.lanes=O,p;case G:return iC(w,k,O,m);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case z:F=10;break e;case $:F=9;break e;case H:F=11;break e;case B:F=14;break e;case K:F=16,T=null;break e}throw Error(n(130,p==null?p:typeof p,""))}return m=sl(F,w,m,k),m.elementType=p,m.type=T,m.lanes=O,m}function up(p,m,w,T){return p=sl(7,p,T,m),p.lanes=w,p}function iC(p,m,w,T){return p=sl(22,p,T,m),p.elementType=G,p.lanes=w,p.stateNode={isHidden:!1},p}function JO(p,m,w){return p=sl(6,p,null,m),p.lanes=w,p}function ZO(p,m,w){return m=sl(4,p.children!==null?p.children:[],p.key,m),m.lanes=w,m.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},m}function nPe(p,m,w,T,k){this.tag=m,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eh(0),this.expirationTimes=eh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eh(0),this.identifierPrefix=T,this.onRecoverableError=k,this.mutableSourceEagerHydrationData=null}function QO(p,m,w,T,k,O,F,Y,Q){return p=new nPe(p,m,w,Y,Q),m===1?(m=1,O===!0&&(m|=8)):m=0,O=sl(3,null,null,m),p.current=O,O.stateNode=p,O.memoizedState={element:T,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},hO(O),p}function rPe(p,m,w){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_,key:T==null?null:""+T,children:p,containerInfo:m,implementation:w}}function lV(p){if(!p)return ah;p=p._reactInternals;e:{if(Wl(p)!==p||p.tag!==1)throw Error(n(170));var m=p;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(Ro(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(n(171))}if(p.tag===1){var w=p.type;if(Ro(w))return jH(p,w,m)}return m}function cV(p,m,w,T,k,O,F,Y,Q){return p=QO(w,T,!0,p,k,O,F,Y,Q),p.context=lV(null),w=p.current,T=to(),k=ph(w),O=Bu(T,k),O.callback=m??null,uh(w,O,k),p.current.lanes=k,ql(p,k,T),Lo(p,T),p}function sC(p,m,w,T){var k=m.current,O=to(),F=ph(k);return w=lV(w),m.context===null?m.context=w:m.pendingContext=w,m=Bu(O,F),m.payload={element:p},T=T===void 0?null:T,T!==null&&(m.callback=T),p=uh(k,m,F),p!==null&&(ec(p,k,F,O),j1(p,k,F)),F}function oC(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function uV(p,m){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var w=p.retryLane;p.retryLane=w!==0&&w<m?w:m}}function e2(p,m){uV(p,m),(p=p.alternate)&&uV(p,m)}function iPe(){return null}var dV=typeof reportError=="function"?reportError:function(p){console.error(p)};function t2(p){this._internalRoot=p}aC.prototype.render=t2.prototype.render=function(p){var m=this._internalRoot;if(m===null)throw Error(n(409));sC(p,m,null,null)},aC.prototype.unmount=t2.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var m=p.containerInfo;ap(function(){sC(null,p,null,null)}),m[Nu]=null}};function aC(p){this._internalRoot=p}aC.prototype.unstable_scheduleHydration=function(p){if(p){var m=rm();p={blockedOn:null,target:p,priority:m};for(var w=0;w<Fn.length&&m!==0&&m<Fn[w].priority;w++);Fn.splice(w,0,p),w===0&&Ir(p)}};function n2(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function lC(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function hV(){}function sPe(p,m,w,T,k){if(k){if(typeof T=="function"){var O=T;T=function(){var ce=oC(F);O.call(ce)}}var F=cV(m,T,p,0,null,!1,!1,"",hV);return p._reactRootContainer=F,p[Nu]=F.current,E0(p.nodeType===8?p.parentNode:p),ap(),F}for(;k=p.lastChild;)p.removeChild(k);if(typeof T=="function"){var Y=T;T=function(){var ce=oC(Q);Y.call(ce)}}var Q=QO(p,0,!1,null,null,!1,!1,"",hV);return p._reactRootContainer=Q,p[Nu]=Q.current,E0(p.nodeType===8?p.parentNode:p),ap(function(){sC(m,Q,w,T)}),Q}function cC(p,m,w,T,k){var O=w._reactRootContainer;if(O){var F=O;if(typeof k=="function"){var Y=k;k=function(){var Q=oC(F);Y.call(Q)}}sC(m,F,p,k)}else F=sPe(w,m,p,k,T);return oC(F)}Jf=function(p){switch(p.tag){case 3:var m=p.stateNode;if(m.current.memoizedState.isDehydrated){var w=$c(m.pendingLanes);w!==0&&(th(m,w|1),Lo(m,Ln()),(nn&6)===0&&(Cm=Ln()+500,lh()))}break;case 13:ap(function(){var T=$u(p,1);if(T!==null){var k=to();ec(T,p,1,k)}}),e2(p,1)}},Ru=function(p){if(p.tag===13){var m=$u(p,134217728);if(m!==null){var w=to();ec(m,p,134217728,w)}e2(p,134217728)}},Js=function(p){if(p.tag===13){var m=ph(p),w=$u(p,m);if(w!==null){var T=to();ec(w,p,m,T)}e2(p,m)}},rm=function(){return qt},Zf=function(p,m){var w=qt;try{return qt=p,m()}finally{qt=w}},Xs=function(p,m,w){switch(m){case"input":if(Tt(p,w),m=w.name,w.type==="radio"&&m!=null){for(w=p;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<w.length;m++){var T=w[m];if(T!==p&&T.form===p.form){var k=I1(T);if(!k)throw Error(n(90));de(T),Tt(T,k)}}}break;case"textarea":Mu(p,w);break;case"select":m=w.value,m!=null&&Yr(p,!!w.multiple,m,!1)}},_o=qO,Xd=ap;var oPe={usingClientEntryPoint:!1,Events:[P0,um,I1,Ul,jc,qO]},z0={findFiberByHostInstance:Qf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},aPe={bundleType:z0.bundleType,version:z0.version,rendererPackageName:z0.rendererPackageName,rendererConfig:z0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:I.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Qg(p),p===null?null:p.stateNode},findFiberByHostInstance:z0.findFiberByHostInstance||iPe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uC=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uC.isDisabled&&uC.supportsFiber)try{Qd=uC.inject(aPe),Mo=uC}catch{}}return Fo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oPe,Fo.createPortal=function(p,m){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!n2(m))throw Error(n(200));return rPe(p,m,null,w)},Fo.createRoot=function(p,m){if(!n2(p))throw Error(n(299));var w=!1,T="",k=dV;return m!=null&&(m.unstable_strictMode===!0&&(w=!0),m.identifierPrefix!==void 0&&(T=m.identifierPrefix),m.onRecoverableError!==void 0&&(k=m.onRecoverableError)),m=QO(p,1,!1,null,null,w,!1,T,k),p[Nu]=m.current,E0(p.nodeType===8?p.parentNode:p),new t2(m)},Fo.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var m=p._reactInternals;if(m===void 0)throw typeof p.render=="function"?Error(n(188)):(p=Object.keys(p).join(","),Error(n(268,p)));return p=Qg(m),p=p===null?null:p.stateNode,p},Fo.flushSync=function(p){return ap(p)},Fo.hydrate=function(p,m,w){if(!lC(m))throw Error(n(200));return cC(null,p,m,!0,w)},Fo.hydrateRoot=function(p,m,w){if(!n2(p))throw Error(n(405));var T=w!=null&&w.hydratedSources||null,k=!1,O="",F=dV;if(w!=null&&(w.unstable_strictMode===!0&&(k=!0),w.identifierPrefix!==void 0&&(O=w.identifierPrefix),w.onRecoverableError!==void 0&&(F=w.onRecoverableError)),m=cV(m,null,p,1,w??null,k,!1,O,F),p[Nu]=m.current,E0(p),T)for(p=0;p<T.length;p++)w=T[p],k=w._getVersion,k=k(w._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[w,k]:m.mutableSourceEagerHydrationData.push(w,k);return new aC(m)},Fo.render=function(p,m,w){if(!lC(m))throw Error(n(200));return cC(null,p,m,!1,w)},Fo.unmountComponentAtNode=function(p){if(!lC(p))throw Error(n(40));return p._reactRootContainer?(ap(function(){cC(null,null,p,!1,function(){p._reactRootContainer=null,p[Nu]=null})}),!0):!1},Fo.unstable_batchedUpdates=qO,Fo.unstable_renderSubtreeIntoContainer=function(p,m,w,T){if(!lC(w))throw Error(n(200));if(p==null||p._reactInternals===void 0)throw Error(n(38));return cC(p,m,w,!1,T)},Fo.version="18.3.1-next-f1338f8080-20240426",Fo}var xV;function Nre(){if(xV)return s2.exports;xV=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),s2.exports=yPe(),s2.exports}var wV;function vPe(){if(wV)return dC;wV=1;var t=Nre();return dC.createRoot=t.createRoot,dC.hydrateRoot=t.hydrateRoot,dC}var jre=vPe();const bPe=Oi(jre);var _c=Nre();const Lre=Oi(_c);/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ox(){return Ox=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ox.apply(this,arguments)}var Vh;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Vh||(Vh={}));const SV="popstate";function xPe(t){t===void 0&&(t={});function e(i,s){let{pathname:o="/",search:a="",hash:l=""}=kg(i.location.hash.substr(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),CF("",{pathname:o,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(i,s){let o=i.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let l=i.location.href,c=l.indexOf("#");a=c===-1?l:l.slice(0,c)}return a+"#"+(typeof s=="string"?s:kT(s))}function r(i,s){XB(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(s)+")")}return SPe(e,n,r,t)}function Dr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function XB(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function wPe(){return Math.random().toString(36).substr(2,8)}function CV(t,e){return{usr:t.state,key:t.key,idx:e}}function CF(t,e,n,r){return n===void 0&&(n=null),Ox({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?kg(e):e,{state:n,key:e&&e.key||r||wPe()})}function kT(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function kg(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function SPe(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a=Vh.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(Ox({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=Vh.Pop;let v=u(),x=v==null?null:v-c;c=v,l&&l({action:a,location:b.location,delta:x})}function h(v,x){a=Vh.Push;let C=CF(b.location,v,x);n&&n(C,v),c=u()+1;let E=CV(C,c),I=b.createHref(C);try{o.pushState(E,"",I)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;i.location.assign(I)}s&&l&&l({action:a,location:b.location,delta:1})}function f(v,x){a=Vh.Replace;let C=CF(b.location,v,x);n&&n(C,v),c=u();let E=CV(C,c),I=b.createHref(C);o.replaceState(E,"",I),s&&l&&l({action:a,location:b.location,delta:0})}function y(v){let x=i.location.origin!=="null"?i.location.origin:i.location.href,C=typeof v=="string"?v:kT(v);return C=C.replace(/ $/,"%20"),Dr(x,"No window.location.(origin|href) available to create URL for href: "+C),new URL(C,x)}let b={get action(){return a},get location(){return t(i,o)},listen(v){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(SV,d),l=v,()=>{i.removeEventListener(SV,d),l=null}},createHref(v){return e(i,v)},createURL:y,encodeLocation(v){let x=y(v);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:h,replace:f,go(v){return o.go(v)}};return b}var EV;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(EV||(EV={}));function CPe(t,e,n){return n===void 0&&(n="/"),EPe(t,e,n)}function EPe(t,e,n,r){let i=typeof e=="string"?kg(e):e,s=JB(i.pathname||"/",n);if(s==null)return null;let o=Fre(t);TPe(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=LPe(s);a=RPe(o[l],c)}return a}function Fre(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(Dr(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=Zh([r,l.relativePath]),u=n.concat(l);s.children&&s.children.length>0&&(Dr(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),Fre(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:OPe(c,s.index),routesMeta:u})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let l of $re(s.path))i(s,o,l)}),e}function $re(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=$re(r.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),i&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function TPe(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:DPe(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const IPe=/^:[\w-]+$/,PPe=3,_Pe=2,kPe=1,APe=10,MPe=-2,TV=t=>t==="*";function OPe(t,e){let n=t.split("/"),r=n.length;return n.some(TV)&&(r+=MPe),e&&(r+=_Pe),n.filter(i=>!TV(i)).reduce((i,s)=>i+(IPe.test(s)?PPe:s===""?kPe:APe),r)}function DPe(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function RPe(t,e,n){let{routesMeta:r}=t,i={},s="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=s==="/"?e:e.slice(s.length)||"/",d=NPe({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d)return null;Object.assign(i,d.params),o.push({params:i,pathname:Zh([s,d.pathname]),pathnameBase:zPe(Zh([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=Zh([s,d.pathnameBase]))}return o}function NPe(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=jPe(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((c,u,d)=>{let{paramName:h,isOptional:f}=u;if(h==="*"){let b=a[d]||"";o=s.slice(0,s.length-b.length).replace(/(.)\/+$/,"$1")}const y=a[d];return f&&!y?c[h]=void 0:c[h]=(y||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:o,pattern:t}}function jPe(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),XB(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function LPe(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return XB(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function JB(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function FPe(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?kg(t):t;return{pathname:n?n.startsWith("/")?n:$Pe(n,e):e,search:UPe(r),hash:HPe(i)}}function $Pe(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function l2(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function BPe(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function ZB(t,e){let n=BPe(t);return e?n.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function QB(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=kg(t):(i=Ox({},t),Dr(!i.pathname||!i.pathname.includes("?"),l2("?","pathname","search",i)),Dr(!i.pathname||!i.pathname.includes("#"),l2("#","pathname","hash",i)),Dr(!i.search||!i.search.includes("#"),l2("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=n;else{let d=e.length-1;if(!r&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),d-=1;i.pathname=h.join("/")}a=d>=0?e[d]:"/"}let l=FPe(i,a),c=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const Zh=t=>t.join("/").replace(/\/\/+/g,"/"),zPe=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),UPe=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,HPe=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function VPe(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Bre=["post","put","patch","delete"];new Set(Bre);const WPe=["get",...Bre];new Set(WPe);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dx(){return Dx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Dx.apply(this,arguments)}const e4=S.createContext(null),KPe=S.createContext(null),Ef=S.createContext(null),C_=S.createContext(null),Dd=S.createContext({outlet:null,matches:[],isDataRoute:!1}),zre=S.createContext(null);function qPe(t,e){let{relative:n}=e===void 0?{}:e;fv()||Dr(!1);let{basename:r,navigator:i}=S.useContext(Ef),{hash:s,pathname:o,search:a}=Vre(t,{relative:n}),l=o;return r!=="/"&&(l=o==="/"?r:Zh([r,o])),i.createHref({pathname:l,search:a,hash:s})}function fv(){return S.useContext(C_)!=null}function Gw(){return fv()||Dr(!1),S.useContext(C_).location}function Ure(t){S.useContext(Ef).static||S.useLayoutEffect(t)}function Yw(){let{isDataRoute:t}=S.useContext(Dd);return t?o_e():GPe()}function GPe(){fv()||Dr(!1);let t=S.useContext(e4),{basename:e,future:n,navigator:r}=S.useContext(Ef),{matches:i}=S.useContext(Dd),{pathname:s}=Gw(),o=JSON.stringify(ZB(i,n.v7_relativeSplatPath)),a=S.useRef(!1);return Ure(()=>{a.current=!0}),S.useCallback(function(c,u){if(u===void 0&&(u={}),!a.current)return;if(typeof c=="number"){r.go(c);return}let d=QB(c,JSON.parse(o),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Zh([e,d.pathname])),(u.replace?r.replace:r.push)(d,u.state,u)},[e,r,o,s,t])}function Hre(){let{matches:t}=S.useContext(Dd),e=t[t.length-1];return e?e.params:{}}function Vre(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=S.useContext(Ef),{matches:i}=S.useContext(Dd),{pathname:s}=Gw(),o=JSON.stringify(ZB(i,r.v7_relativeSplatPath));return S.useMemo(()=>QB(t,JSON.parse(o),s,n==="path"),[t,o,s,n])}function YPe(t,e){return XPe(t,e)}function XPe(t,e,n,r){fv()||Dr(!1);let{navigator:i}=S.useContext(Ef),{matches:s}=S.useContext(Dd),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=Gw(),u;if(e){var d;let v=typeof e=="string"?kg(e):e;l==="/"||(d=v.pathname)!=null&&d.startsWith(l)||Dr(!1),u=v}else u=c;let h=u.pathname||"/",f=h;if(l!=="/"){let v=l.replace(/^\//,"").split("/");f="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let y=CPe(t,{pathname:f}),b=t_e(y&&y.map(v=>Object.assign({},v,{params:Object.assign({},a,v.params),pathname:Zh([l,i.encodeLocation?i.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?l:Zh([l,i.encodeLocation?i.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),s,n,r);return e&&b?S.createElement(C_.Provider,{value:{location:Dx({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Vh.Pop}},b):b}function JPe(){let t=s_e(),e=VPe(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return S.createElement(S.Fragment,null,S.createElement("h2",null,"Unexpected Application Error!"),S.createElement("h3",{style:{fontStyle:"italic"}},e),n?S.createElement("pre",{style:i},n):null,null)}const ZPe=S.createElement(JPe,null);class QPe extends S.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?S.createElement(Dd.Provider,{value:this.props.routeContext},S.createElement(zre.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function e_e(t){let{routeContext:e,match:n,children:r}=t,i=S.useContext(e4);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),S.createElement(Dd.Provider,{value:e},r)}function t_e(t,e,n,r){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(i=n)==null?void 0:i.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||Dr(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(n&&r&&r.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:h,errors:f}=n,y=d.route.loader&&h[d.route.id]===void 0&&(!f||f[d.route.id]===void 0);if(d.route.lazy||y){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,d,h)=>{let f,y=!1,b=null,v=null;n&&(f=a&&d.route.id?a[d.route.id]:void 0,b=d.route.errorElement||ZPe,l&&(c<0&&h===0?(a_e("route-fallback"),y=!0,v=null):c===h&&(y=!0,v=d.route.hydrateFallbackElement||null)));let x=e.concat(o.slice(0,h+1)),C=()=>{let E;return f?E=b:y?E=v:d.route.Component?E=S.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=u,S.createElement(e_e,{match:d,routeContext:{outlet:u,matches:x,isDataRoute:n!=null},children:E})};return n&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?S.createElement(QPe,{location:n.location,revalidation:n.revalidation,component:b,error:f,children:C(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):C()},null)}var Wre=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Wre||{}),Kre=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Kre||{});function n_e(t){let e=S.useContext(e4);return e||Dr(!1),e}function r_e(t){let e=S.useContext(KPe);return e||Dr(!1),e}function i_e(t){let e=S.useContext(Dd);return e||Dr(!1),e}function qre(t){let e=i_e(),n=e.matches[e.matches.length-1];return n.route.id||Dr(!1),n.route.id}function s_e(){var t;let e=S.useContext(zre),n=r_e(),r=qre();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function o_e(){let{router:t}=n_e(Wre.UseNavigateStable),e=qre(Kre.UseNavigateStable),n=S.useRef(!1);return Ure(()=>{n.current=!0}),S.useCallback(function(i,s){s===void 0&&(s={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,Dx({fromRouteId:e},s)))},[t,e])}const IV={};function a_e(t,e,n){IV[t]||(IV[t]=!0)}function l_e(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function hC(t){let{to:e,replace:n,state:r,relative:i}=t;fv()||Dr(!1);let{future:s,static:o}=S.useContext(Ef),{matches:a}=S.useContext(Dd),{pathname:l}=Gw(),c=Yw(),u=QB(e,ZB(a,s.v7_relativeSplatPath),l,i==="path"),d=JSON.stringify(u);return S.useEffect(()=>c(JSON.parse(d),{replace:n,state:r,relative:i}),[c,d,i,n,r]),null}function Um(t){Dr(!1)}function c_e(t){let{basename:e="/",children:n=null,location:r,navigationType:i=Vh.Pop,navigator:s,static:o=!1,future:a}=t;fv()&&Dr(!1);let l=e.replace(/^\/*/,"/"),c=S.useMemo(()=>({basename:l,navigator:s,static:o,future:Dx({v7_relativeSplatPath:!1},a)}),[l,a,s,o]);typeof r=="string"&&(r=kg(r));let{pathname:u="/",search:d="",hash:h="",state:f=null,key:y="default"}=r,b=S.useMemo(()=>{let v=JB(u,l);return v==null?null:{location:{pathname:v,search:d,hash:h,state:f,key:y},navigationType:i}},[l,u,d,h,f,y,i]);return b==null?null:S.createElement(Ef.Provider,{value:c},S.createElement(C_.Provider,{children:n,value:b}))}function u_e(t){let{children:e,location:n}=t;return YPe(EF(e),n)}new Promise(()=>{});function EF(t,e){e===void 0&&(e=[]);let n=[];return S.Children.forEach(t,(r,i)=>{if(!S.isValidElement(r))return;let s=[...e,i];if(r.type===S.Fragment){n.push.apply(n,EF(r.props.children,s));return}r.type!==Um&&Dr(!1),!r.props.index||!r.props.children||Dr(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=EF(r.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function TF(){return TF=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},TF.apply(this,arguments)}function d_e(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function h_e(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function f_e(t,e){return t.button===0&&(!e||e==="_self")&&!h_e(t)}const p_e=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],g_e="6";try{window.__reactRouterVersion=g_e}catch{}const m_e="startTransition",PV=S_[m_e];function y_e(t){let{basename:e,children:n,future:r,window:i}=t,s=S.useRef();s.current==null&&(s.current=xPe({window:i,v5Compat:!0}));let o=s.current,[a,l]=S.useState({action:o.action,location:o.location}),{v7_startTransition:c}=r||{},u=S.useCallback(d=>{c&&PV?PV(()=>l(d)):l(d)},[l,c]);return S.useLayoutEffect(()=>o.listen(u),[o,u]),S.useEffect(()=>l_e(r),[r]),S.createElement(c_e,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:r})}const v_e=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",b_e=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,IF=S.forwardRef(function(e,n){let{onClick:r,relative:i,reloadDocument:s,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:d}=e,h=d_e(e,p_e),{basename:f}=S.useContext(Ef),y,b=!1;if(typeof c=="string"&&b_e.test(c)&&(y=c,v_e))try{let E=new URL(window.location.href),I=c.startsWith("//")?new URL(E.protocol+c):new URL(c),P=JB(I.pathname,f);I.origin===E.origin&&P!=null?c=P+I.search+I.hash:b=!0}catch{}let v=qPe(c,{relative:i}),x=x_e(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:i,viewTransition:d});function C(E){r&&r(E),E.defaultPrevented||x(E)}return S.createElement("a",TF({},h,{href:y||v,onClick:b||s?r:C,ref:n,target:l}))});var _V;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(_V||(_V={}));var kV;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(kV||(kV={}));function x_e(t,e){let{target:n,replace:r,state:i,preventScrollReset:s,relative:o,viewTransition:a}=e===void 0?{}:e,l=Yw(),c=Gw(),u=Vre(t,{relative:o});return S.useCallback(d=>{if(f_e(d,n)){d.preventDefault();let h=r!==void 0?r:kT(c)===kT(u);l(t,{replace:h,state:i,preventScrollReset:s,relative:o,viewTransition:a})}},[c,l,u,r,i,n,t,s,o,a])}var AV={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gre=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},w_e=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],o=t[n++],a=t[n++],l=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Yre={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],o=i+1<t.length,a=o?t[i+1]:0,l=i+2<t.length,c=l?t[i+2]:0,u=s>>2,d=(s&3)<<4|a>>4;let h=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(h=64)),r.push(n[u],n[d],n[h],n[f])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Gre(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):w_e(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const c=i<t.length?n[t.charAt(i)]:64;++i;const d=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||c==null||d==null)throw new S_e;const h=s<<2|a>>4;if(r.push(h),c!==64){const f=a<<4&240|c>>2;if(r.push(f),d!==64){const y=c<<6&192|d;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class S_e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const C_e=function(t){const e=Gre(t);return Yre.encodeByteArray(e,!0)},AT=function(t){return C_e(t).replace(/\./g,"")},Xre=function(t){try{return Yre.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E_e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T_e=()=>E_e().__FIREBASE_DEFAULTS__,I_e=()=>{if(typeof process>"u"||typeof AV>"u")return;const t=AV.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},P_e=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Xre(t[1]);return e&&JSON.parse(e)},E_=()=>{try{return T_e()||I_e()||P_e()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Jre=t=>{var e,n;return(n=(e=E_())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},Zre=t=>{const e=Jre(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Qre=()=>{var t;return(t=E_())===null||t===void 0?void 0:t.config},eie=t=>{var e;return(e=E_())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __e{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tie(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[AT(JSON.stringify(n)),AT(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ls(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function k_e(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ls())}function A_e(){var t;const e=(t=E_())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function nie(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function M_e(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function O_e(){const t=Ls();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function rie(){try{return typeof indexedDB=="object"}catch{return!1}}function iie(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}function D_e(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R_e="FirebaseError";class Rl extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=R_e,Object.setPrototypeOf(this,Rl.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ag.prototype.create)}}class Ag{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?N_e(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Rl(i,a,r)}}function N_e(t,e){return t.replace(j_e,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const j_e=/\{\$([^}]+)}/g;function L_e(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Rx(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],o=e[i];if(MV(s)&&MV(o)){if(!Rx(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function MV(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xw(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function xb(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function wb(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function F_e(t,e){const n=new $_e(t,e);return n.subscribe.bind(n)}class $_e{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");B_e(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=c2),i.error===void 0&&(i.error=c2),i.complete===void 0&&(i.complete=c2);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function B_e(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function c2(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z_e=1e3,U_e=2,H_e=14400*1e3,V_e=.5;function OV(t,e=z_e,n=U_e){const r=e*Math.pow(n,t),i=Math.round(V_e*r*(Math.random()-.5)*2);return Math.min(H_e,r+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nn(t){return t&&t._delegate?t._delegate:t}class Al{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let W_e=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new __e;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(q_e(e))try{this.getOrInitializeService({instanceIdentifier:pp})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=pp){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=pp){return this.instances.has(e)}getOptions(e=pp){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:K_e(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=pp){return this.component?this.component.multipleInstances?e:pp:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function K_e(t){return t===pp?void 0:t}function q_e(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_e{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new W_e(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cn;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(cn||(cn={}));const Y_e={debug:cn.DEBUG,verbose:cn.VERBOSE,info:cn.INFO,warn:cn.WARN,error:cn.ERROR,silent:cn.SILENT},X_e=cn.INFO,J_e={[cn.DEBUG]:"log",[cn.VERBOSE]:"log",[cn.INFO]:"info",[cn.WARN]:"warn",[cn.ERROR]:"error"},Z_e=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=J_e[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class T_{constructor(e){this.name=e,this._logLevel=X_e,this._logHandler=Z_e,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in cn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Y_e[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,cn.DEBUG,...e),this._logHandler(this,cn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,cn.VERBOSE,...e),this._logHandler(this,cn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,cn.INFO,...e),this._logHandler(this,cn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,cn.WARN,...e),this._logHandler(this,cn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,cn.ERROR,...e),this._logHandler(this,cn.ERROR,...e)}}const Q_e=(t,e)=>e.some(n=>t instanceof n);let DV,RV;function eke(){return DV||(DV=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tke(){return RV||(RV=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const sie=new WeakMap,PF=new WeakMap,oie=new WeakMap,u2=new WeakMap,t4=new WeakMap;function nke(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(cd(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&sie.set(n,t)}).catch(()=>{}),t4.set(e,t),e}function rke(t){if(PF.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});PF.set(t,e)}let _F={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return PF.get(t);if(e==="objectStoreNames")return t.objectStoreNames||oie.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return cd(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function ike(t){_F=t(_F)}function ske(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(d2(this),e,...n);return oie.set(r,e.sort?e.sort():[e]),cd(r)}:tke().includes(t)?function(...e){return t.apply(d2(this),e),cd(sie.get(this))}:function(...e){return cd(t.apply(d2(this),e))}}function oke(t){return typeof t=="function"?ske(t):(t instanceof IDBTransaction&&rke(t),Q_e(t,eke())?new Proxy(t,_F):t)}function cd(t){if(t instanceof IDBRequest)return nke(t);if(u2.has(t))return u2.get(t);const e=oke(t);return e!==t&&(u2.set(t,e),t4.set(e,t)),e}const d2=t=>t4.get(t);function n4(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=cd(o);return r&&o.addEventListener("upgradeneeded",l=>{r(cd(o.result),l.oldVersion,l.newVersion,cd(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function aie(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",r=>e(r.oldVersion,r)),cd(n).then(()=>{})}const ake=["get","getKey","getAll","getAllKeys","count"],lke=["put","add","delete","clear"],h2=new Map;function NV(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(h2.get(e))return h2.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=lke.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||ake.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return h2.set(e,s),s}ike(t=>({...t,get:(e,n,r)=>NV(e,n)||t.get(e,n,r),has:(e,n)=>!!NV(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cke{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(uke(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function uke(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const kF="@firebase/app",jV="0.9.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zp=new T_("@firebase/app"),dke="@firebase/app-compat",hke="@firebase/analytics-compat",fke="@firebase/analytics",pke="@firebase/app-check-compat",gke="@firebase/app-check",mke="@firebase/auth",yke="@firebase/auth-compat",vke="@firebase/database",bke="@firebase/database-compat",xke="@firebase/functions",wke="@firebase/functions-compat",Ske="@firebase/installations",Cke="@firebase/installations-compat",Eke="@firebase/messaging",Tke="@firebase/messaging-compat",Ike="@firebase/performance",Pke="@firebase/performance-compat",_ke="@firebase/remote-config",kke="@firebase/remote-config-compat",Ake="@firebase/storage",Mke="@firebase/storage-compat",Oke="@firebase/firestore",Dke="@firebase/firestore-compat",Rke="firebase",Nke="9.23.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AF="[DEFAULT]",jke={[kF]:"fire-core",[dke]:"fire-core-compat",[fke]:"fire-analytics",[hke]:"fire-analytics-compat",[gke]:"fire-app-check",[pke]:"fire-app-check-compat",[mke]:"fire-auth",[yke]:"fire-auth-compat",[vke]:"fire-rtdb",[bke]:"fire-rtdb-compat",[xke]:"fire-fn",[wke]:"fire-fn-compat",[Ske]:"fire-iid",[Cke]:"fire-iid-compat",[Eke]:"fire-fcm",[Tke]:"fire-fcm-compat",[Ike]:"fire-perf",[Pke]:"fire-perf-compat",[_ke]:"fire-rc",[kke]:"fire-rc-compat",[Ake]:"fire-gcs",[Mke]:"fire-gcs-compat",[Oke]:"fire-fst",[Dke]:"fire-fst-compat","fire-js":"fire-js",[Rke]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MT=new Map,MF=new Map;function Lke(t,e){try{t.container.addComponent(e)}catch(n){Zp.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function yc(t){const e=t.name;if(MF.has(e))return Zp.debug(`There were multiple attempts to register component ${e}.`),!1;MF.set(e,t);for(const n of MT.values())Lke(n,t);return!0}function Tf(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fke={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Qh=new Ag("app","Firebase",Fke);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ke{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Al("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qh.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mg=Nke;function lie(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:AF,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Qh.create("bad-app-name",{appName:String(i)});if(n||(n=Qre()),!n)throw Qh.create("no-options");const s=MT.get(i);if(s){if(Rx(n,s.options)&&Rx(r,s.config))return s;throw Qh.create("duplicate-app",{appName:i})}const o=new G_e(i);for(const l of MF.values())o.addComponent(l);const a=new $ke(n,r,o);return MT.set(i,a),a}function I_(t=AF){const e=MT.get(t);if(!e&&t===AF&&Qre())return lie();if(!e)throw Qh.create("no-app",{appName:t});return e}function Xo(t,e,n){var r;let i=(r=jke[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Zp.warn(a.join(" "));return}yc(new Al(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bke="firebase-heartbeat-database",zke=1,Nx="firebase-heartbeat-store";let f2=null;function cie(){return f2||(f2=n4(Bke,zke,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Nx)}}}).catch(t=>{throw Qh.create("idb-open",{originalErrorMessage:t.message})})),f2}async function Uke(t){try{return await(await cie()).transaction(Nx).objectStore(Nx).get(uie(t))}catch(e){if(e instanceof Rl)Zp.warn(e.message);else{const n=Qh.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Zp.warn(n.message)}}}async function LV(t,e){try{const r=(await cie()).transaction(Nx,"readwrite");await r.objectStore(Nx).put(e,uie(t)),await r.done}catch(n){if(n instanceof Rl)Zp.warn(n.message);else{const r=Qh.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Zp.warn(r.message)}}}function uie(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hke=1024,Vke=720*60*60*1e3;class Wke{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new qke(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=FV();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(i=>{const s=new Date(i.date).valueOf();return Date.now()-s<=Vke}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=FV(),{heartbeatsToSend:n,unsentEntries:r}=Kke(this._heartbeatsCache.heartbeats),i=AT(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function FV(){return new Date().toISOString().substring(0,10)}function Kke(t,e=Hke){const n=[];let r=t.slice();for(const i of t){const s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),$V(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),$V(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class qke{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return rie()?iie().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Uke(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return LV(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return LV(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function $V(t){return AT(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gke(t){yc(new Al("platform-logger",e=>new cke(e),"PRIVATE")),yc(new Al("heartbeat",e=>new Wke(e),"PRIVATE")),Xo(kF,jV,t),Xo(kF,jV,"esm2017"),Xo("fire-js","")}Gke("");var Qc=function(){return Qc=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Qc.apply(this,arguments)};function Jw(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Yke(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function die(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Xke=die,hie=new Ag("auth","Firebase",die());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OT=new T_("@firebase/auth");function Jke(t,...e){OT.logLevel<=cn.WARN&&OT.warn(`Auth (${Mg}): ${t}`,...e)}function LE(t,...e){OT.logLevel<=cn.ERROR&&OT.error(`Auth (${Mg}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vc(t,...e){throw r4(t,...e)}function cu(t,...e){return r4(t,...e)}function Zke(t,e,n){const r=Object.assign(Object.assign({},Xke()),{[e]:n});return new Ag("auth","Firebase",r).create(e,{appName:t.name})}function r4(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return hie.create(t,...e)}function _t(t,e,...n){if(!t)throw r4(e,...n)}function nd(t){const e="INTERNAL ASSERTION FAILED: "+t;throw LE(e),new Error(e)}function yd(t,e){t||nd(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OF(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Qke(){return BV()==="http:"||BV()==="https:"}function BV(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eAe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Qke()||nie()||"connection"in navigator)?navigator.onLine:!0}function tAe(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{constructor(e,n){this.shortDelay=e,this.longDelay=n,yd(n>e,"Short delay should be less than long delay!"),this.isMobile=k_e()||M_e()}get(){return eAe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i4(t,e){yd(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fie{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;nd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;nd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;nd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nAe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rAe=new Zw(3e4,6e4);function pv(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Og(t,e,n,r,i={}){return pie(t,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const a=Xw(Object.assign({key:t.config.apiKey},o)).slice(1),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode),fie.fetch()(gie(t,t.config.apiHost,n,a),Object.assign({method:e,headers:l,referrerPolicy:"no-referrer"},s))})}async function pie(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},nAe),e);try{const i=new iAe(t),s=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw fC(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw fC(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw fC(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw fC(t,"user-disabled",o);const u=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Zke(t,u,c);vc(t,u)}}catch(i){if(i instanceof Rl)throw i;vc(t,"network-request-failed",{message:String(i)})}}async function Qw(t,e,n,r,i={}){const s=await Og(t,e,n,r,i);return"mfaPendingCredential"in s&&vc(t,"multi-factor-auth-required",{_serverResponse:s}),s}function gie(t,e,n,r){const i=`${e}${n}?${r}`;return t.config.emulator?i4(t.config,i):`${t.config.apiScheme}://${i}`}class iAe{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(cu(this.auth,"network-request-failed")),rAe.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function fC(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=cu(t,e,r);return i.customData._tokenResponse=n,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sAe(t,e){return Og(t,"POST","/v1/accounts:delete",e)}async function oAe(t,e){return Og(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ex(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function aAe(t,e=!1){const n=Nn(t),r=await n.getIdToken(e),i=s4(r);_t(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:ex(p2(i.auth_time)),issuedAtTime:ex(p2(i.iat)),expirationTime:ex(p2(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function p2(t){return Number(t)*1e3}function s4(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return LE("JWT malformed, contained fewer than 3 sections"),null;try{const i=Xre(n);return i?JSON.parse(i):(LE("Failed to decode base64 JWT payload"),null)}catch(i){return LE("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function lAe(t){const e=s4(t);return _t(e,"internal-error"),_t(typeof e.exp<"u","internal-error"),_t(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Iy(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Rl&&cAe(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function cAe({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uAe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mie{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=ex(this.lastLoginAt),this.creationTime=ex(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DT(t){var e;const n=t.auth,r=await t.getIdToken(),i=await Iy(t,oAe(n,{idToken:r}));_t(i==null?void 0:i.users.length,n,"internal-error");const s=i.users[0];t._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?fAe(s.providerUserInfo):[],a=hAe(t.providerData,o),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(a!=null&&a.length),u=l?c:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new mie(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(t,d)}async function dAe(t){const e=Nn(t);await DT(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function hAe(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function fAe(t){return t.map(e=>{var{providerId:n}=e,r=Jw(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pAe(t,e){const n=await pie(t,{},async()=>{const r=Xw({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,o=gie(t,i,"/v1/token",`key=${s}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",fie.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_t(e.idToken,"internal-error"),_t(typeof e.idToken<"u","internal-error"),_t(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):lAe(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,n=!1){return _t(!this.accessToken||this.refreshToken,e,"user-token-expired"),!n&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:s}=await pAe(e,n);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:s}=n,o=new jx;return r&&(_t(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(_t(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(_t(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new jx,this.toJSON())}_performRefresh(){return nd("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vh(t,e){_t(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Fp{constructor(e){var{uid:n,auth:r,stsTokenManager:i}=e,s=Jw(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new uAe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new mie(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Iy(this,this.stsTokenManager.getToken(this.auth,e));return _t(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return aAe(this,e)}reload(){return dAe(this)}_assign(e){this!==e&&(_t(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Fp(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){_t(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await DT(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Iy(this,sAe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,i,s,o,a,l,c,u;const d=(r=n.displayName)!==null&&r!==void 0?r:void 0,h=(i=n.email)!==null&&i!==void 0?i:void 0,f=(s=n.phoneNumber)!==null&&s!==void 0?s:void 0,y=(o=n.photoURL)!==null&&o!==void 0?o:void 0,b=(a=n.tenantId)!==null&&a!==void 0?a:void 0,v=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,x=(c=n.createdAt)!==null&&c!==void 0?c:void 0,C=(u=n.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:E,emailVerified:I,isAnonymous:P,providerData:_,stsTokenManager:A}=n;_t(E&&A,e,"internal-error");const D=jx.fromJSON(this.name,A);_t(typeof E=="string",e,"internal-error"),vh(d,e.name),vh(h,e.name),_t(typeof I=="boolean",e,"internal-error"),_t(typeof P=="boolean",e,"internal-error"),vh(f,e.name),vh(y,e.name),vh(b,e.name),vh(v,e.name),vh(x,e.name),vh(C,e.name);const L=new Fp({uid:E,auth:e,email:h,emailVerified:I,displayName:d,isAnonymous:P,photoURL:y,phoneNumber:f,tenantId:b,stsTokenManager:D,createdAt:x,lastLoginAt:C});return _&&Array.isArray(_)&&(L.providerData=_.map(z=>Object.assign({},z))),v&&(L._redirectEventId=v),L}static async _fromIdTokenResponse(e,n,r=!1){const i=new jx;i.updateFromServerResponse(n);const s=new Fp({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await DT(s),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zV=new Map;function rd(t){yd(t instanceof Function,"Expected a class definition");let e=zV.get(t);return e?(yd(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,zV.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}yie.type="NONE";const UV=yie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FE(t,e,n){return`firebase:${t}:${e}:${n}`}class oy{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=FE(this.userKey,i.apiKey,s),this.fullPersistenceKey=FE("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Fp._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new oy(rd(UV),e,r);const i=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let s=i[0]||rd(UV);const o=FE(r,e.config.apiKey,e.name);let a=null;for(const c of n)try{const u=await c._get(o);if(u){const d=Fp._fromJSON(e,u);c!==s&&(a=d),s=c;break}}catch{}const l=i.filter(c=>c._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new oy(s,e,r):(s=l[0],a&&await s._set(o,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==s)try{await c._remove(o)}catch{}})),new oy(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HV(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(xie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(vie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Sie(e))return"Blackberry";if(Cie(e))return"Webos";if(o4(e))return"Safari";if((e.includes("chrome/")||bie(e))&&!e.includes("edge/"))return"Chrome";if(wie(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function vie(t=Ls()){return/firefox\//i.test(t)}function o4(t=Ls()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function bie(t=Ls()){return/crios\//i.test(t)}function xie(t=Ls()){return/iemobile/i.test(t)}function wie(t=Ls()){return/android/i.test(t)}function Sie(t=Ls()){return/blackberry/i.test(t)}function Cie(t=Ls()){return/webos/i.test(t)}function P_(t=Ls()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function gAe(t=Ls()){var e;return P_(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function mAe(){return O_e()&&document.documentMode===10}function Eie(t=Ls()){return P_(t)||wie(t)||Cie(t)||Sie(t)||/windows phone/i.test(t)||xie(t)}function yAe(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tie(t,e=[]){let n;switch(t){case"Browser":n=HV(Ls());break;case"Worker":n=`${HV(Ls())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Mg}/${r}`}async function Iie(t,e){return Og(t,"GET","/v2/recaptchaConfig",pv(t,e))}function VV(t){return t!==void 0&&t.enterprise!==void 0}class Pie{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(n=>n.provider==="EMAIL_PASSWORD_PROVIDER"&&n.enforcementState!=="OFF")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vAe(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}function _ie(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const s=cu("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",vAe().appendChild(r)})}function bAe(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const xAe="https://www.google.com/recaptcha/enterprise.js?render=",wAe="recaptcha-enterprise",SAe="NO_RECAPTCHA";class kie{constructor(e){this.type=wAe,this.auth=gv(e)}async verify(e="verify",n=!1){async function r(s){if(!n){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(o,a)=>{Iie(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new Pie(l);return s.tenantId==null?s._agentRecaptchaConfig=c:s._tenantRecaptchaConfigs[s.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function i(s,o,a){const l=window.grecaptcha;VV(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(c=>{o(c)}).catch(()=>{o(SAe)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,o)=>{r(this.auth).then(a=>{if(!n&&VV(window.grecaptcha))i(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}_ie(xAe+a).then(()=>{i(a,s,o)}).catch(l=>{o(l)})}}).catch(a=>{o(a)})})}}async function RT(t,e,n,r=!1){const i=new kie(t);let s;try{s=await i.verify(n)}catch{s=await i.verify(n,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CAe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=s=>new Promise((o,a)=>{try{const l=e(s);o(l)}catch(l){a(l)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EAe{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new WV(this),this.idTokenSubscription=new WV(this),this.beforeStateQueue=new CAe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=hie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=rd(n)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await oy.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var n;const r=await this.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i==null?void 0:i._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(i=l.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return _t(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await DT(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=tAe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const n=e?Nn(e):null;return n&&_t(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&_t(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(rd(e))})}async initializeRecaptchaConfig(){const e=await Iie(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),n=new Pie(e);this.tenantId==null?this._agentRecaptchaConfig=n:this._tenantRecaptchaConfigs[this.tenantId]=n,n.emailPasswordEnabled&&new kie(this).verify()}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ag("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&rd(e)||this._popupRedirectResolver;_t(n,this,"argument-error"),this.redirectPersistenceManager=await oy.create(this,[rd(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const s=typeof n=="function"?n:n.next.bind(n),o=this._isInitialized?Promise.resolve():this._initializationPromise;return _t(o,this,"internal-error"),o.then(()=>s(this.currentUser)),typeof n=="function"?e.addObserver(n,r,i):e.addObserver(n)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _t(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Tie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&Jke(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function gv(t){return Nn(t)}class WV{constructor(e){this.auth=e,this.observer=null,this.addObserver=F_e(n=>this.observer=n)}get next(){return _t(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TAe(t,e){const n=Tf(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),s=n.getOptions();if(Rx(s,e??{}))return i;vc(i,"already-initialized")}return n.initialize({options:e})}function IAe(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(rd);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function PAe(t,e,n){const r=gv(t);_t(r._canInitEmulator,r,"emulator-config-failed"),_t(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=Aie(e),{host:o,port:a}=_Ae(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${s}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),kAe()}function Aie(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function _Ae(t){const e=Aie(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:KV(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:KV(o)}}}function KV(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function kAe(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a4{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return nd("not implemented")}_getIdTokenResponse(e){return nd("not implemented")}_linkToIdToken(e,n){return nd("not implemented")}_getReauthenticationResolver(e){return nd("not implemented")}}async function AAe(t,e){return Og(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g2(t,e){return Qw(t,"POST","/v1/accounts:signInWithPassword",pv(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MAe(t,e){return Qw(t,"POST","/v1/accounts:signInWithEmailLink",pv(t,e))}async function OAe(t,e){return Qw(t,"POST","/v1/accounts:signInWithEmailLink",pv(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lx extends a4{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Lx(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Lx(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){var n;switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(!((n=e._getRecaptchaConfig())===null||n===void 0)&&n.emailPasswordEnabled){const i=await RT(e,r,"signInWithPassword");return g2(e,i)}else return g2(e,r).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const s=await RT(e,r,"signInWithPassword");return g2(e,s)}else return Promise.reject(i)});case"emailLink":return MAe(e,{email:this._email,oobCode:this._password});default:vc(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":return AAe(e,{idToken:n,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return OAe(e,{idToken:n,email:this._email,oobCode:this._password});default:vc(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ay(t,e){return Qw(t,"POST","/v1/accounts:signInWithIdp",pv(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DAe="http://localhost";class Qp extends a4{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Qp(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):vc("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=n,s=Jw(n,["providerId","signInMethod"]);if(!r||!i)return null;const o=new Qp(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return ay(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,ay(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,ay(e,n)}buildRequest(){const e={requestUri:DAe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Xw(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RAe(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function NAe(t){const e=xb(wb(t)).link,n=e?xb(wb(e)).deep_link_id:null,r=xb(wb(t)).deep_link_id;return(r?xb(wb(r)).link:null)||r||n||e||t}class l4{constructor(e){var n,r,i,s,o,a;const l=xb(wb(e)),c=(n=l.apiKey)!==null&&n!==void 0?n:null,u=(r=l.oobCode)!==null&&r!==void 0?r:null,d=RAe((i=l.mode)!==null&&i!==void 0?i:null);_t(c&&u&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=u,this.continueUrl=(s=l.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=NAe(e);try{return new l4(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(){this.providerId=mv.PROVIDER_ID}static credential(e,n){return Lx._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=l4.parseLink(n);return _t(r,"argument-error"),Lx._fromEmailAndCode(e,r.code,r.tenantId)}}mv.PROVIDER_ID="password";mv.EMAIL_PASSWORD_SIGN_IN_METHOD="password";mv.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eS extends Mie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh extends eS{constructor(){super("facebook.com")}static credential(e){return Qp._fromParams({providerId:Nh.PROVIDER_ID,signInMethod:Nh.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Nh.credentialFromTaggedObject(e)}static credentialFromError(e){return Nh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Nh.credential(e.oauthAccessToken)}catch{return null}}}Nh.FACEBOOK_SIGN_IN_METHOD="facebook.com";Nh.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh extends eS{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Qp._fromParams({providerId:jh.PROVIDER_ID,signInMethod:jh.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return jh.credentialFromTaggedObject(e)}static credentialFromError(e){return jh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return jh.credential(n,r)}catch{return null}}}jh.GOOGLE_SIGN_IN_METHOD="google.com";jh.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh extends eS{constructor(){super("github.com")}static credential(e){return Qp._fromParams({providerId:Lh.PROVIDER_ID,signInMethod:Lh.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Lh.credentialFromTaggedObject(e)}static credentialFromError(e){return Lh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Lh.credential(e.oauthAccessToken)}catch{return null}}}Lh.GITHUB_SIGN_IN_METHOD="github.com";Lh.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh extends eS{constructor(){super("twitter.com")}static credential(e,n){return Qp._fromParams({providerId:Fh.PROVIDER_ID,signInMethod:Fh.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Fh.credentialFromTaggedObject(e)}static credentialFromError(e){return Fh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Fh.credential(n,r)}catch{return null}}}Fh.TWITTER_SIGN_IN_METHOD="twitter.com";Fh.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m2(t,e){return Qw(t,"POST","/v1/accounts:signUp",pv(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const s=await Fp._fromIdTokenResponse(e,r,i),o=qV(r);return new eg({user:s,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=qV(r);return new eg({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function qV(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NT extends Rl{constructor(e,n,r,i){var s;super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,NT.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new NT(e,n,r,i)}}function Oie(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?NT._fromErrorAndOperation(t,s,e,r):s})}async function jAe(t,e,n=!1){const r=await Iy(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return eg._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LAe(t,e,n=!1){const{auth:r}=t,i="reauthenticate";try{const s=await Iy(t,Oie(r,i,e,t),n);_t(s.idToken,r,"internal-error");const o=s4(s.idToken);_t(o,r,"internal-error");const{sub:a}=o;return _t(t.uid===a,r,"user-mismatch"),eg._forOperation(t,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&vc(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Die(t,e,n=!1){const r="signIn",i=await Oie(t,r,e),s=await eg._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(s.user),s}async function FAe(t,e){return Die(gv(t),e)}async function $Ae(t,e,n){var r;const i=gv(t),s={returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(!((r=i._getRecaptchaConfig())===null||r===void 0)&&r.emailPasswordEnabled){const c=await RT(i,s,"signUpPassword");o=m2(i,c)}else o=m2(i,s).catch(async c=>{if(c.code==="auth/missing-recaptcha-token"){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const u=await RT(i,s,"signUpPassword");return m2(i,u)}else return Promise.reject(c)});const a=await o.catch(c=>Promise.reject(c)),l=await eg._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(l.user),l}function BAe(t,e,n){return FAe(Nn(t),mv.credential(e,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zAe(t,e){return Og(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UAe(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const r=Nn(t),s={idToken:await r.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await Iy(r,zAe(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function HAe(t,e,n,r){return Nn(t).onIdTokenChanged(e,n,r)}function VAe(t,e,n){return Nn(t).beforeAuthStateChanged(e,n)}function WAe(t,e,n,r){return Nn(t).onAuthStateChanged(e,n,r)}function KAe(t){return Nn(t).signOut()}const jT="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rie{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(jT,"1"),this.storage.removeItem(jT),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qAe(){const t=Ls();return o4(t)||P_(t)}const GAe=1e3,YAe=10;class Nie extends Rie{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=qAe()&&yAe(),this.fallbackToPolling=Eie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(r);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!n)return}const i=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);mAe()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,YAe):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},GAe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}Nie.type="LOCAL";const XAe=Nie;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jie extends Rie{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}jie.type="SESSION";const Lie=jie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JAe(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new __(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(async c=>c(n.origin,s)),l=await JAe(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}__.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c4(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZAe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{const c=c4("",20);i.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(d){const h=d;if(h.data.eventId===c)switch(h.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(h.data.response);break;default:clearTimeout(u),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uu(){return window}function QAe(t){uu().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fie(){return typeof uu().WorkerGlobalScope<"u"&&typeof uu().importScripts=="function"}async function eMe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function tMe(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function nMe(){return Fie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $ie="firebaseLocalStorageDb",rMe=1,LT="firebaseLocalStorage",Bie="fbase_key";class tS{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function k_(t,e){return t.transaction([LT],e?"readwrite":"readonly").objectStore(LT)}function iMe(){const t=indexedDB.deleteDatabase($ie);return new tS(t).toPromise()}function DF(){const t=indexedDB.open($ie,rMe);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(LT,{keyPath:Bie})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(LT)?e(r):(r.close(),await iMe(),e(await DF()))})})}async function GV(t,e,n){const r=k_(t,!0).put({[Bie]:e,value:n});return new tS(r).toPromise()}async function sMe(t,e){const n=k_(t,!1).get(e),r=await new tS(n).toPromise();return r===void 0?null:r.value}function YV(t,e){const n=k_(t,!0).delete(e);return new tS(n).toPromise()}const oMe=800,aMe=3;class zie{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await DF(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>aMe)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Fie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=__._getInstance(nMe()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await eMe(),!this.activeServiceWorker)return;this.sender=new ZAe(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||tMe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await DF();return await GV(e,jT,"1"),await YV(e,jT),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>GV(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>sMe(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>YV(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=k_(i,!1).getAll();return new tS(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),oMe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}zie.type="LOCAL";const lMe=zie;new Zw(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cMe(t,e){return e?rd(e):(_t(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4 extends a4{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ay(e,this._buildIdpRequest())}_linkToIdToken(e,n){return ay(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return ay(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function uMe(t){return Die(t.auth,new u4(t),t.bypassAuthState)}function dMe(t){const{auth:e,user:n}=t;return _t(n,e,"internal-error"),LAe(n,new u4(t),t.bypassAuthState)}async function hMe(t){const{auth:e,user:n}=t;return _t(n,e,"internal-error"),jAe(n,new u4(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uie{constructor(e,n,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return uMe;case"linkViaPopup":case"linkViaRedirect":return hMe;case"reauthViaPopup":case"reauthViaRedirect":return dMe;default:vc(this.auth,"internal-error")}}resolve(e){yd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){yd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fMe=new Zw(2e3,1e4);class Xm extends Uie{constructor(e,n,r,i,s){super(e,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,Xm.currentPopupAction&&Xm.currentPopupAction.cancel(),Xm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _t(e,this.auth,"internal-error"),e}async onExecution(){yd(this.filter.length===1,"Popup operations only handle one event");const e=c4();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(cu(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(cu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Xm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(cu(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,fMe.get())};e()}}Xm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pMe="pendingRedirect",$E=new Map;class gMe extends Uie{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=$E.get(this.auth._key());if(!e){try{const r=await mMe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}$E.set(this.auth._key(),e)}return this.bypassAuthState||$E.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function mMe(t,e){const n=bMe(e),r=vMe(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function yMe(t,e){$E.set(t._key(),e)}function vMe(t){return rd(t._redirectPersistence)}function bMe(t){return FE(pMe,t.config.apiKey,t.name)}async function xMe(t,e,n=!1){const r=gv(t),i=cMe(r,e),o=await new gMe(r,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wMe=600*1e3;class SMe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!CMe(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Hie(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(cu(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=wMe&&this.cachedEventUids.clear(),this.cachedEventUids.has(XV(e))}saveEventToCache(e){this.cachedEventUids.add(XV(e)),this.lastProcessedEventTime=Date.now()}}function XV(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Hie({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function CMe(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Hie(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EMe(t,e={}){return Og(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TMe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,IMe=/^https?/;async function PMe(t){if(t.config.emulator)return;const{authorizedDomains:e}=await EMe(t);for(const n of e)try{if(_Me(n))return}catch{}vc(t,"unauthorized-domain")}function _Me(t){const e=OF(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!IMe.test(n))return!1;if(TMe.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kMe=new Zw(3e4,6e4);function JV(){const t=uu().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function AMe(t){return new Promise((e,n)=>{var r,i,s;function o(){JV(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{JV(),n(cu(t,"network-request-failed"))},timeout:kMe.get()})}if(!((i=(r=uu().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=uu().gapi)===null||s===void 0)&&s.load)o();else{const a=bAe("iframefcb");return uu()[a]=()=>{gapi.load?o():n(cu(t,"network-request-failed"))},_ie(`https://apis.google.com/js/api.js?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw BE=null,e})}let BE=null;function MMe(t){return BE=BE||AMe(t),BE}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OMe=new Zw(5e3,15e3),DMe="__/auth/iframe",RMe="emulator/auth/iframe",NMe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},jMe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function LMe(t){const e=t.config;_t(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?i4(e,RMe):`https://${t.config.authDomain}/${DMe}`,r={apiKey:e.apiKey,appName:t.name,v:Mg},i=jMe.get(t.config.apiHost);i&&(r.eid=i);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Xw(r).slice(1)}`}async function FMe(t){const e=await MMe(t),n=uu().gapi;return _t(n,t,"internal-error"),e.open({where:document.body,url:LMe(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:NMe,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=cu(t,"network-request-failed"),a=uu().setTimeout(()=>{s(o)},OMe.get());function l(){uu().clearTimeout(a),i(r)}r.ping(l).then(l,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Me={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},BMe=500,zMe=600,UMe="_blank",HMe="http://localhost";class ZV{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function VMe(t,e,n,r=BMe,i=zMe){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},$Me),{width:r.toString(),height:i.toString(),top:s,left:o}),c=Ls().toLowerCase();n&&(a=bie(c)?UMe:n),vie(c)&&(e=e||HMe,l.scrollbars="yes");const u=Object.entries(l).reduce((h,[f,y])=>`${h}${f}=${y},`,"");if(gAe(c)&&a!=="_self")return WMe(e||"",a),new ZV(null);const d=window.open(e||"",a,u);_t(d,t,"popup-blocked");try{d.focus()}catch{}return new ZV(d)}function WMe(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KMe="__/auth/handler",qMe="emulator/auth/handler",GMe=encodeURIComponent("fac");async function QV(t,e,n,r,i,s){_t(t.config.authDomain,t,"auth-domain-config-required"),_t(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Mg,eventId:i};if(e instanceof Mie){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",L_e(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,d]of Object.entries({}))o[u]=d}if(e instanceof eS){const u=e.getScopes().filter(d=>d!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const l=await t._getAppCheckToken(),c=l?`#${GMe}=${encodeURIComponent(l)}`:"";return`${YMe(t)}?${Xw(a).slice(1)}${c}`}function YMe({config:t}){return t.emulator?i4(t,qMe):`https://${t.authDomain}/${KMe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y2="webStorageSupport";class XMe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Lie,this._completeRedirectFn=xMe,this._overrideRedirectResult=yMe}async _openPopup(e,n,r,i){var s;yd((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await QV(e,n,r,OF(),i);return VMe(e,o,c4())}async _openRedirect(e,n,r,i){await this._originValidation(e);const s=await QV(e,n,r,OF(),i);return QAe(s),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:s}=this.eventManagers[n];return i?Promise.resolve(i):(yd(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await FMe(e),r=new SMe(e);return n.register("authEvent",i=>(_t(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(y2,{type:y2},i=>{var s;const o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[y2];o!==void 0&&n(!!o),vc(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=PMe(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return Eie()||o4()||P_()}}const JMe=XMe;var eW="@firebase/auth",tW="0.23.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZMe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){_t(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QMe(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function eOe(t){yc(new Al("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;_t(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Tie(t)},c=new EAe(r,i,s,l);return IAe(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),yc(new Al("auth-internal",e=>{const n=gv(e.getProvider("auth").getImmediate());return(r=>new ZMe(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Xo(eW,tW,QMe(t)),Xo(eW,tW,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tOe=300,nOe=eie("authIdTokenMaxAge")||tOe;let nW=null;const rOe=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>nOe)return;const i=n==null?void 0:n.token;nW!==i&&(nW=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function A_(t=I_()){const e=Tf(t,"auth");if(e.isInitialized())return e.getImmediate();const n=TAe(t,{popupRedirectResolver:JMe,persistence:[lMe,XAe,Lie]}),r=eie("authTokenSyncURL");if(r){const s=rOe(r);VAe(n,s,()=>s(n.currentUser)),HAe(n,o=>s(o))}const i=Jre("auth");return i&&PAe(n,`http://${i}`),n}eOe("Browser");var iOe="firebase",sOe="9.23.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xo(iOe,sOe,"app");const oOe=(t,e)=>e.some(n=>t instanceof n);let rW,iW;function aOe(){return rW||(rW=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function lOe(){return iW||(iW=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Vie=new WeakMap,RF=new WeakMap,Wie=new WeakMap,v2=new WeakMap,d4=new WeakMap;function cOe(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(ef(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Vie.set(n,t)}).catch(()=>{}),d4.set(e,t),e}function uOe(t){if(RF.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});RF.set(t,e)}let NF={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return RF.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Wie.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ef(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function dOe(t){NF=t(NF)}function hOe(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(b2(this),e,...n);return Wie.set(r,e.sort?e.sort():[e]),ef(r)}:lOe().includes(t)?function(...e){return t.apply(b2(this),e),ef(Vie.get(this))}:function(...e){return ef(t.apply(b2(this),e))}}function fOe(t){return typeof t=="function"?hOe(t):(t instanceof IDBTransaction&&uOe(t),oOe(t,aOe())?new Proxy(t,NF):t)}function ef(t){if(t instanceof IDBRequest)return cOe(t);if(v2.has(t))return v2.get(t);const e=fOe(t);return e!==t&&(v2.set(t,e),d4.set(e,t)),e}const b2=t=>d4.get(t);function pOe(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=ef(o);return r&&o.addEventListener("upgradeneeded",l=>{r(ef(o.result),l.oldVersion,l.newVersion,ef(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}const gOe=["get","getKey","getAll","getAllKeys","count"],mOe=["put","add","delete","clear"],x2=new Map;function sW(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(x2.get(e))return x2.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=mOe.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||gOe.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return x2.set(e,s),s}dOe(t=>({...t,get:(e,n,r)=>sW(e,n)||t.get(e,n,r),has:(e,n)=>!!sW(e,n)||t.has(e,n)}));const Kie="@firebase/installations",h4="0.6.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qie=1e4,Gie=`w:${h4}`,Yie="FIS_v2",yOe="https://firebaseinstallations.googleapis.com/v1",vOe=3600*1e3,bOe="installations",xOe="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wOe={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},tg=new Ag(bOe,xOe,wOe);function Xie(t){return t instanceof Rl&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jie({projectId:t}){return`${yOe}/projects/${t}/installations`}function Zie(t){return{token:t.token,requestStatus:2,expiresIn:COe(t.expiresIn),creationTime:Date.now()}}async function Qie(t,e){const r=(await e.json()).error;return tg.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function ese({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function SOe(t,{refreshToken:e}){const n=ese(t);return n.append("Authorization",EOe(e)),n}async function tse(t){const e=await t();return e.status>=500&&e.status<600?t():e}function COe(t){return Number(t.replace("s","000"))}function EOe(t){return`${Yie} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TOe({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=Jie(t),i=ese(t),s=e.getImmediate({optional:!0});if(s){const c=await s.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={fid:n,authVersion:Yie,appId:t.appId,sdkVersion:Gie},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await tse(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||n,registrationStatus:2,refreshToken:c.refreshToken,authToken:Zie(c.authToken)}}else throw await Qie("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nse(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IOe(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const POe=/^[cdef][\w-]{21}$/,jF="";function _Oe(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=kOe(t);return POe.test(n)?n:jF}catch{return jF}}function kOe(t){return IOe(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M_(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rse=new Map;function ise(t,e){const n=M_(t);sse(n,e),AOe(n,e)}function sse(t,e){const n=rse.get(t);if(n)for(const r of n)r(e)}function AOe(t,e){const n=MOe();n&&n.postMessage({key:t,fid:e}),OOe()}let Ep=null;function MOe(){return!Ep&&"BroadcastChannel"in self&&(Ep=new BroadcastChannel("[Firebase] FID Change"),Ep.onmessage=t=>{sse(t.data.key,t.data.fid)}),Ep}function OOe(){rse.size===0&&Ep&&(Ep.close(),Ep=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DOe="firebase-installations-database",ROe=1,ng="firebase-installations-store";let w2=null;function f4(){return w2||(w2=pOe(DOe,ROe,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(ng)}}})),w2}async function FT(t,e){const n=M_(t),i=(await f4()).transaction(ng,"readwrite"),s=i.objectStore(ng),o=await s.get(n);return await s.put(e,n),await i.done,(!o||o.fid!==e.fid)&&ise(t,e.fid),e}async function ose(t){const e=M_(t),r=(await f4()).transaction(ng,"readwrite");await r.objectStore(ng).delete(e),await r.done}async function O_(t,e){const n=M_(t),i=(await f4()).transaction(ng,"readwrite"),s=i.objectStore(ng),o=await s.get(n),a=e(o);return a===void 0?await s.delete(n):await s.put(a,n),await i.done,a&&(!o||o.fid!==a.fid)&&ise(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p4(t){let e;const n=await O_(t.appConfig,r=>{const i=NOe(r),s=jOe(t,i);return e=s.registrationPromise,s.installationEntry});return n.fid===jF?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function NOe(t){const e=t||{fid:_Oe(),registrationStatus:0};return ase(e)}function jOe(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(tg.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=LOe(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:FOe(t)}:{installationEntry:e}}async function LOe(t,e){try{const n=await TOe(t,e);return FT(t.appConfig,n)}catch(n){throw Xie(n)&&n.customData.serverCode===409?await ose(t.appConfig):await FT(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function FOe(t){let e=await oW(t.appConfig);for(;e.registrationStatus===1;)await nse(100),e=await oW(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await p4(t);return r||n}return e}function oW(t){return O_(t,e=>{if(!e)throw tg.create("installation-not-found");return ase(e)})}function ase(t){return $Oe(t)?{fid:t.fid,registrationStatus:0}:t}function $Oe(t){return t.registrationStatus===1&&t.registrationTime+qie<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BOe({appConfig:t,heartbeatServiceProvider:e},n){const r=zOe(t,n),i=SOe(t,n),s=e.getImmediate({optional:!0});if(s){const c=await s.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={installation:{sdkVersion:Gie,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await tse(()=>fetch(r,a));if(l.ok){const c=await l.json();return Zie(c)}else throw await Qie("Generate Auth Token",l)}function zOe(t,{fid:e}){return`${Jie(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g4(t,e=!1){let n;const r=await O_(t.appConfig,s=>{if(!lse(s))throw tg.create("not-registered");const o=s.authToken;if(!e&&VOe(o))return s;if(o.requestStatus===1)return n=UOe(t,e),s;{if(!navigator.onLine)throw tg.create("app-offline");const a=KOe(s);return n=HOe(t,a),a}});return n?await n:r.authToken}async function UOe(t,e){let n=await aW(t.appConfig);for(;n.authToken.requestStatus===1;)await nse(100),n=await aW(t.appConfig);const r=n.authToken;return r.requestStatus===0?g4(t,e):r}function aW(t){return O_(t,e=>{if(!lse(e))throw tg.create("not-registered");const n=e.authToken;return qOe(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function HOe(t,e){try{const n=await BOe(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await FT(t.appConfig,r),n}catch(n){if(Xie(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await ose(t.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await FT(t.appConfig,r)}throw n}}function lse(t){return t!==void 0&&t.registrationStatus===2}function VOe(t){return t.requestStatus===2&&!WOe(t)}function WOe(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+vOe}function KOe(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function qOe(t){return t.requestStatus===1&&t.requestTime+qie<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GOe(t){const e=t,{installationEntry:n,registrationPromise:r}=await p4(e);return r?r.catch(console.error):g4(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YOe(t,e=!1){const n=t;return await XOe(n),(await g4(n,e)).token}async function XOe(t){const{registrationPromise:e}=await p4(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JOe(t){if(!t||!t.options)throw S2("App Configuration");if(!t.name)throw S2("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw S2(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function S2(t){return tg.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cse="installations",ZOe="installations-internal",QOe=t=>{const e=t.getProvider("app").getImmediate(),n=JOe(e),r=Tf(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},e2e=t=>{const e=t.getProvider("app").getImmediate(),n=Tf(e,cse).getImmediate();return{getId:()=>GOe(n),getToken:i=>YOe(n,i)}};function t2e(){yc(new Al(cse,QOe,"PUBLIC")),yc(new Al(ZOe,e2e,"PRIVATE"))}t2e();Xo(Kie,h4);Xo(Kie,h4,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $T="analytics",n2e="firebase_id",r2e="origin",i2e=60*1e3,s2e="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",m4="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jo=new T_("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2e={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Ia=new Ag("analytics","Analytics",o2e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a2e(t){if(!t.startsWith(m4)){const e=Ia.create("invalid-gtag-resource",{gtagURL:t});return Jo.warn(e.message),""}return t}function use(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function l2e(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function c2e(t,e){const n=l2e("firebase-js-sdk-policy",{createScriptURL:a2e}),r=document.createElement("script"),i=`${m4}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function u2e(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function d2e(t,e,n,r,i,s){const o=r[i];try{if(o)await e[o];else{const l=(await use(n)).find(c=>c.measurementId===i);l&&await e[l.appId]}}catch(a){Jo.error(a)}t("config",i,s)}async function h2e(t,e,n,r,i){try{let s=[];if(i&&i.send_to){let o=i.send_to;Array.isArray(o)||(o=[o]);const a=await use(n);for(const l of o){const c=a.find(d=>d.measurementId===l),u=c&&e[c.appId];if(u)s.push(u);else{s=[];break}}}s.length===0&&(s=Object.values(e)),await Promise.all(s),t("event",r,i||{})}catch(s){Jo.error(s)}}function f2e(t,e,n,r){async function i(s,...o){try{if(s==="event"){const[a,l]=o;await h2e(t,e,n,a,l)}else if(s==="config"){const[a,l]=o;await d2e(t,e,n,r,a,l)}else if(s==="consent"){const[a]=o;t("consent","update",a)}else if(s==="get"){const[a,l,c]=o;t("get",a,l,c)}else if(s==="set"){const[a]=o;t("set",a)}else t(s,...o)}catch(a){Jo.error(a)}}return i}function p2e(t,e,n,r,i){let s=function(...o){window[r].push(arguments)};return window[i]&&typeof window[i]=="function"&&(s=window[i]),window[i]=f2e(s,t,e,n),{gtagCore:s,wrappedGtag:window[i]}}function g2e(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(m4)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m2e=30,y2e=1e3;class v2e{constructor(e={},n=y2e){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const dse=new v2e;function b2e(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function x2e(t){var e;const{appId:n,apiKey:r}=t,i={method:"GET",headers:b2e(r)},s=s2e.replace("{app-id}",n),o=await fetch(s,i);if(o.status!==200&&o.status!==304){let a="";try{const l=await o.json();!((e=l.error)===null||e===void 0)&&e.message&&(a=l.error.message)}catch{}throw Ia.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function w2e(t,e=dse,n){const{appId:r,apiKey:i,measurementId:s}=t.options;if(!r)throw Ia.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw Ia.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new E2e;return setTimeout(async()=>{a.abort()},i2e),hse({appId:r,apiKey:i,measurementId:s},o,a,e)}async function hse(t,{throttleEndTimeMillis:e,backoffCount:n},r,i=dse){var s;const{appId:o,measurementId:a}=t;try{await S2e(r,e)}catch(l){if(a)return Jo.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:a};throw l}try{const l=await x2e(t);return i.deleteThrottleMetadata(o),l}catch(l){const c=l;if(!C2e(c)){if(i.deleteThrottleMetadata(o),a)return Jo.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:o,measurementId:a};throw l}const u=Number((s=c==null?void 0:c.customData)===null||s===void 0?void 0:s.httpStatus)===503?OV(n,i.intervalMillis,m2e):OV(n,i.intervalMillis),d={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(o,d),Jo.debug(`Calling attemptFetch again in ${u} millis`),hse(t,d,r,i)}}function S2e(t,e){return new Promise((n,r)=>{const i=Math.max(e-Date.now(),0),s=setTimeout(n,i);t.addEventListener(()=>{clearTimeout(s),r(Ia.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function C2e(t){if(!(t instanceof Rl)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class E2e{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function T2e(t,e,n,r,i){if(i&&i.global){t("event",n,r);return}else{const s=await e,o=Object.assign(Object.assign({},r),{send_to:s});t("event",n,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I2e(){if(rie())try{await iie()}catch(t){return Jo.warn(Ia.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return Jo.warn(Ia.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function P2e(t,e,n,r,i,s,o){var a;const l=w2e(t);l.then(f=>{n[f.measurementId]=f.appId,t.options.measurementId&&f.measurementId!==t.options.measurementId&&Jo.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${f.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(f=>Jo.error(f)),e.push(l);const c=I2e().then(f=>{if(f)return r.getId()}),[u,d]=await Promise.all([l,c]);g2e(s)||c2e(s,u.measurementId),i("js",new Date);const h=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return h[r2e]="firebase",h.update=!0,d!=null&&(h[n2e]=d),i("config",u.measurementId,h),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _2e{constructor(e){this.app=e}_delete(){return delete tx[this.app.options.appId],Promise.resolve()}}let tx={},lW=[];const cW={};let C2="dataLayer",k2e="gtag",uW,fse,dW=!1;function A2e(){const t=[];if(nie()&&t.push("This is a browser extension environment."),D_e()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,i)=>`(${i+1}) ${r}`).join(" "),n=Ia.create("invalid-analytics-context",{errorInfo:e});Jo.warn(n.message)}}function M2e(t,e,n){A2e();const r=t.options.appId;if(!r)throw Ia.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)Jo.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Ia.create("no-api-key");if(tx[r]!=null)throw Ia.create("already-exists",{id:r});if(!dW){u2e(C2);const{wrappedGtag:s,gtagCore:o}=p2e(tx,lW,cW,C2,k2e);fse=s,uW=o,dW=!0}return tx[r]=P2e(t,lW,cW,e,uW,C2,n),new _2e(t)}function O2e(t=I_()){t=Nn(t);const e=Tf(t,$T);return e.isInitialized()?e.getImmediate():D2e(t)}function D2e(t,e={}){const n=Tf(t,$T);if(n.isInitialized()){const i=n.getImmediate();if(Rx(e,n.getOptions()))return i;throw Ia.create("already-initialized")}return n.initialize({options:e})}function R2e(t,e,n,r){t=Nn(t),T2e(fse,tx[t.app.options.appId],e,n,r).catch(i=>Jo.error(i))}const hW="@firebase/analytics",fW="0.10.0";function N2e(){yc(new Al($T,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return M2e(r,i,n)},"PUBLIC")),yc(new Al("analytics-internal",t,"PRIVATE")),Xo(hW,fW),Xo(hW,fW,"esm2017");function t(e){try{const n=e.getProvider($T).getImmediate();return{logEvent:(r,i,s)=>R2e(n,r,i,s)}}catch(n){throw Ia.create("interop-component-reg-failed",{reason:n})}}}N2e();const j2e={apiKey:"AIzaSyBkW26jyUJNw9kIBYLnnEiLTeRPtBb6sbU",authDomain:"projetos-78be8.firebaseapp.com",projectId:"projetos-78be8",storageBucket:"projetos-78be8.firebasestorage.app",messagingSenderId:"151662864542",appId:"1:151662864542:web:a6812c337f4ce50ad1338f",measurementId:"G-QHYXRG8F2G"},Co=lie(j2e);O2e(Co);function y4(t){return{uid:t.uid,name:t.displayName||"",email:t.email||""}}async function L2e(t,e,n){const r=A_(Co),i=await $Ae(r,e,n);if(i.user)return await UAe(i.user,{displayName:t}),y4({...i.user,displayName:t});throw new Error("Erro ao criar usuário.")}async function F2e(t,e){const n=A_(Co),r=await BAe(n,t,e);if(r.user)return y4(r.user);throw new Error("Usuário não encontrado.")}async function $2e(){const t=A_(Co);console.log("Iniciando signOut do Firebase..."),await KAe(t),console.log("SignOut do Firebase concluído")}function B2e(t){const e=A_(Co);return console.log("Configurando listener de mudança de estado de autenticação..."),WAe(e,n=>{console.log("Firebase auth state changed:",n?`User: ${n.email}`:"No user");const r=n?y4(n):null;t(r)})}const z2e=()=>{const[t,e]=S.useState("login"),[n,r]=S.useState(""),[i,s]=S.useState(""),[o,a]=S.useState(""),[l,c]=S.useState(""),[u,d]=S.useState(!1),h=Yw(),f=async b=>{b.preventDefault(),d(!0),c("");try{t==="login"?await F2e(n,i):await L2e(o,n,i),h("/dashboard")}catch(v){console.error("Erro de autenticação:",v),c(v.message||JSON.stringify(v)||"Ocorreu um erro.")}finally{d(!1)}},y=()=>{e(b=>b==="login"?"signup":"login"),c(""),r(""),s(""),a("")};return g.jsx("div",{className:"flex items-center justify-center py-12",children:g.jsxs("div",{className:"w-full max-w-md bg-card p-8 rounded-lg shadow-xl",children:[g.jsx("h2",{className:"text-2xl font-bold text-center text-text-primary mb-2",children:t==="login"?"Bem-vindo de volta!":"Crie sua conta"}),g.jsx("p",{className:"text-center text-text-secondary mb-6",children:t==="login"?"Faça login para continuar.":"Preencha os campos para se cadastrar."}),l&&g.jsx("p",{className:"bg-red-500/20 text-red-400 p-3 rounded-md mb-4 text-sm",children:l}),g.jsxs("form",{onSubmit:f,className:"space-y-6",children:[t==="signup"&&g.jsxs("div",{children:[g.jsx("label",{htmlFor:"name",className:"text-sm font-medium text-text-secondary",children:"Nome"}),g.jsx("input",{id:"name",type:"text",value:o,onChange:b=>a(b.target.value),required:!0,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})]}),g.jsxs("div",{children:[g.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-text-secondary",children:"Email"}),g.jsx("input",{id:"email",type:"email",value:n,onChange:b=>r(b.target.value),required:!0,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})]}),g.jsxs("div",{children:[g.jsx("label",{htmlFor:"password",className:"text-sm font-medium text-text-secondary",children:"Senha"}),g.jsx("input",{id:"password",type:"password",value:i,onChange:b=>s(b.target.value),required:!0,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})]}),g.jsx("button",{type:"submit",disabled:u,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-blue-900/50 disabled:cursor-not-allowed",children:u?g.jsx("div",{className:"w-5 h-5 border-2 border-t-transparent rounded-full animate-spin"}):t==="login"?"Entrar":"Cadastrar"})]}),g.jsxs("p",{className:"mt-6 text-center text-sm text-text-secondary",children:[t==="login"?"Não tem uma conta?":"Já tem uma conta?",g.jsx("button",{onClick:y,className:"font-medium text-accent hover:text-blue-400 ml-1",children:t==="login"?"Cadastre-se":"Faça login"})]})]})})};function yi(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var U2e=typeof Symbol=="function"&&Symbol.observable||"@@observable",pW=U2e,E2=()=>Math.random().toString(36).substring(7).split("").join("."),H2e={INIT:`@@redux/INIT${E2()}`,REPLACE:`@@redux/REPLACE${E2()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${E2()}`},BT=H2e;function v4(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function b4(t,e,n){if(typeof t!="function")throw new Error(yi(2));if(typeof e=="function"&&typeof n=="function"||typeof n=="function"&&typeof arguments[3]=="function")throw new Error(yi(0));if(typeof e=="function"&&typeof n>"u"&&(n=e,e=void 0),typeof n<"u"){if(typeof n!="function")throw new Error(yi(1));return n(b4)(t,e)}let r=t,i=e,s=new Map,o=s,a=0,l=!1;function c(){o===s&&(o=new Map,s.forEach((v,x)=>{o.set(x,v)}))}function u(){if(l)throw new Error(yi(3));return i}function d(v){if(typeof v!="function")throw new Error(yi(4));if(l)throw new Error(yi(5));let x=!0;c();const C=a++;return o.set(C,v),function(){if(x){if(l)throw new Error(yi(6));x=!1,c(),o.delete(C),s=null}}}function h(v){if(!v4(v))throw new Error(yi(7));if(typeof v.type>"u")throw new Error(yi(8));if(typeof v.type!="string")throw new Error(yi(17));if(l)throw new Error(yi(9));try{l=!0,i=r(i,v)}finally{l=!1}return(s=o).forEach(C=>{C()}),v}function f(v){if(typeof v!="function")throw new Error(yi(10));r=v,h({type:BT.REPLACE})}function y(){const v=d;return{subscribe(x){if(typeof x!="object"||x===null)throw new Error(yi(11));function C(){const I=x;I.next&&I.next(u())}return C(),{unsubscribe:v(C)}},[pW](){return this}}}return h({type:BT.INIT}),{dispatch:h,subscribe:d,getState:u,replaceReducer:f,[pW]:y}}function V2e(t){Object.keys(t).forEach(e=>{const n=t[e];if(typeof n(void 0,{type:BT.INIT})>"u")throw new Error(yi(12));if(typeof n(void 0,{type:BT.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(yi(13))})}function pse(t){const e=Object.keys(t),n={};for(let s=0;s<e.length;s++){const o=e[s];typeof t[o]=="function"&&(n[o]=t[o])}const r=Object.keys(n);let i;try{V2e(n)}catch(s){i=s}return function(o={},a){if(i)throw i;let l=!1;const c={};for(let u=0;u<r.length;u++){const d=r[u],h=n[d],f=o[d],y=h(f,a);if(typeof y>"u")throw a&&a.type,new Error(yi(14));c[d]=y,l=l||y!==f}return l=l||r.length!==Object.keys(o).length,l?c:o}}function gW(t,e){return function(...n){return e(t.apply(this,n))}}function mW(t,e){if(typeof t=="function")return gW(t,e);if(typeof t!="object"||t===null)throw new Error(yi(16));const n={};for(const r in t){const i=t[r];typeof i=="function"&&(n[r]=gW(i,e))}return n}function Fx(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,n)=>(...r)=>e(n(...r)))}function gse(...t){return e=>(n,r)=>{const i=e(n,r);let s=()=>{throw new Error(yi(15))};const o={getState:i.getState,dispatch:(l,...c)=>s(l,...c)},a=t.map(l=>l(o));return s=Fx(...a)(i.dispatch),{...i,dispatch:s}}}function mse(t){return v4(t)&&"type"in t&&typeof t.type=="string"}var T2={exports:{}},I2={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yW;function W2e(){if(yW)return I2;yW=1;var t=hv();function e(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var n=typeof Object.is=="function"?Object.is:e,r=t.useSyncExternalStore,i=t.useRef,s=t.useEffect,o=t.useMemo,a=t.useDebugValue;return I2.useSyncExternalStoreWithSelector=function(l,c,u,d,h){var f=i(null);if(f.current===null){var y={hasValue:!1,value:null};f.current=y}else y=f.current;f=o(function(){function v(P){if(!x){if(x=!0,C=P,P=d(P),h!==void 0&&y.hasValue){var _=y.value;if(h(_,P))return E=_}return E=P}if(_=E,n(C,P))return _;var A=d(P);return h!==void 0&&h(_,A)?(C=P,_):(C=P,E=A)}var x=!1,C,E,I=u===void 0?null:u;return[function(){return v(c())},I===null?void 0:function(){return v(I())}]},[c,u,d,h]);var b=r(l,f[0],f[1]);return s(function(){y.hasValue=!0,y.value=b},[b]),a(b),b},I2}var vW;function K2e(){return vW||(vW=1,T2.exports=W2e()),T2.exports}K2e();var q2e=S.version.startsWith("19"),G2e=Symbol.for(q2e?"react.transitional.element":"react.element"),Y2e=Symbol.for("react.portal"),X2e=Symbol.for("react.fragment"),J2e=Symbol.for("react.strict_mode"),Z2e=Symbol.for("react.profiler"),Q2e=Symbol.for("react.consumer"),eDe=Symbol.for("react.context"),yse=Symbol.for("react.forward_ref"),tDe=Symbol.for("react.suspense"),nDe=Symbol.for("react.suspense_list"),x4=Symbol.for("react.memo"),rDe=Symbol.for("react.lazy"),iDe=yse,sDe=x4;function oDe(t){if(typeof t=="object"&&t!==null){const{$$typeof:e}=t;switch(e){case G2e:switch(t=t.type,t){case X2e:case Z2e:case J2e:case tDe:case nDe:return t;default:switch(t=t&&t.$$typeof,t){case eDe:case yse:case rDe:case x4:return t;case Q2e:return t;default:return e}}case Y2e:return e}}}function aDe(t){return oDe(t)===x4}function lDe(t,e,n,r,{areStatesEqual:i,areOwnPropsEqual:s,areStatePropsEqual:o}){let a=!1,l,c,u,d,h;function f(C,E){return l=C,c=E,u=t(l,c),d=e(r,c),h=n(u,d,c),a=!0,h}function y(){return u=t(l,c),e.dependsOnOwnProps&&(d=e(r,c)),h=n(u,d,c),h}function b(){return t.dependsOnOwnProps&&(u=t(l,c)),e.dependsOnOwnProps&&(d=e(r,c)),h=n(u,d,c),h}function v(){const C=t(l,c),E=!o(C,u);return u=C,E&&(h=n(u,d,c)),h}function x(C,E){const I=!s(E,c),P=!i(C,l,E,c);return l=C,c=E,I&&P?y():I?b():P?v():h}return function(E,I){return a?x(E,I):f(E,I)}}function cDe(t,{initMapStateToProps:e,initMapDispatchToProps:n,initMergeProps:r,...i}){const s=e(t,i),o=n(t,i),a=r(t,i);return lDe(s,o,a,t,i)}function uDe(t,e){const n={};for(const r in t){const i=t[r];typeof i=="function"&&(n[r]=(...s)=>e(i(...s)))}return n}function LF(t){return function(n){const r=t(n);function i(){return r}return i.dependsOnOwnProps=!1,i}}function bW(t){return t.dependsOnOwnProps?!!t.dependsOnOwnProps:t.length!==1}function vse(t,e){return function(r,{displayName:i}){const s=function(a,l){return s.dependsOnOwnProps?s.mapToProps(a,l):s.mapToProps(a,void 0)};return s.dependsOnOwnProps=!0,s.mapToProps=function(a,l){s.mapToProps=t,s.dependsOnOwnProps=bW(t);let c=s(a,l);return typeof c=="function"&&(s.mapToProps=c,s.dependsOnOwnProps=bW(c),c=s(a,l)),c},s}}function w4(t,e){return(n,r)=>{throw new Error(`Invalid value of type ${typeof t} for ${e} argument when connecting component ${r.wrappedComponentName}.`)}}function dDe(t){return t&&typeof t=="object"?LF(e=>uDe(t,e)):t?typeof t=="function"?vse(t):w4(t,"mapDispatchToProps"):LF(e=>({dispatch:e}))}function hDe(t){return t?typeof t=="function"?vse(t):w4(t,"mapStateToProps"):LF(()=>({}))}function fDe(t,e,n){return{...n,...t,...e}}function pDe(t){return function(n,{displayName:r,areMergedPropsEqual:i}){let s=!1,o;return function(l,c,u){const d=t(l,c,u);return s?i(d,o)||(o=d):(s=!0,o=d),o}}}function gDe(t){return t?typeof t=="function"?pDe(t):w4(t,"mergeProps"):()=>fDe}function mDe(t){t()}function yDe(){let t=null,e=null;return{clear(){t=null,e=null},notify(){mDe(()=>{let n=t;for(;n;)n.callback(),n=n.next})},get(){const n=[];let r=t;for(;r;)n.push(r),r=r.next;return n},subscribe(n){let r=!0;const i=e={callback:n,next:null,prev:e};return i.prev?i.prev.next=i:t=i,function(){!r||t===null||(r=!1,i.next?i.next.prev=i.prev:e=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}var xW={notify(){},get:()=>[]};function bse(t,e){let n,r=xW,i=0,s=!1;function o(b){u();const v=r.subscribe(b);let x=!1;return()=>{x||(x=!0,v(),d())}}function a(){r.notify()}function l(){y.onStateChange&&y.onStateChange()}function c(){return s}function u(){i++,n||(n=e?e.addNestedSub(l):t.subscribe(l),r=yDe())}function d(){i--,n&&i===0&&(n(),n=void 0,r.clear(),r=xW)}function h(){s||(s=!0,u())}function f(){s&&(s=!1,d())}const y={addNestedSub:o,notifyNestedSubs:a,handleChangeWrapper:l,isSubscribed:c,trySubscribe:h,tryUnsubscribe:f,getListeners:()=>r};return y}var vDe=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",bDe=vDe(),xDe=()=>typeof navigator<"u"&&navigator.product==="ReactNative",wDe=xDe(),SDe=()=>bDe||wDe?S.useLayoutEffect:S.useEffect,zT=SDe();function wW(t,e){return t===e?t!==0||e!==0||1/t===1/e:t!==t&&e!==e}function P2(t,e){if(wW(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(!Object.prototype.hasOwnProperty.call(e,n[i])||!wW(t[n[i]],e[n[i]]))return!1;return!0}var CDe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},EDe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},TDe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},xse={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},IDe={[iDe]:TDe,[sDe]:xse};function SW(t){return aDe(t)?xse:IDe[t.$$typeof]||CDe}var PDe=Object.defineProperty,_De=Object.getOwnPropertyNames,CW=Object.getOwnPropertySymbols,kDe=Object.getOwnPropertyDescriptor,ADe=Object.getPrototypeOf,EW=Object.prototype;function FF(t,e){if(typeof e!="string"){if(EW){const s=ADe(e);s&&s!==EW&&FF(t,s)}let n=_De(e);CW&&(n=n.concat(CW(e)));const r=SW(t),i=SW(e);for(let s=0;s<n.length;++s){const o=n[s];if(!EDe[o]&&!(i&&i[o])&&!(r&&r[o])){const a=kDe(e,o);try{PDe(t,o,a)}catch{}}}}return t}var _2=Symbol.for("react-redux-context"),k2=typeof globalThis<"u"?globalThis:{};function MDe(){if(!S.createContext)return{};const t=k2[_2]??(k2[_2]=new Map);let e=t.get(S.createContext);return e||(e=S.createContext(null),t.set(S.createContext,e)),e}var wse=MDe(),ODe=[null,null];function DDe(t,e,n){zT(()=>t(...e),n)}function RDe(t,e,n,r,i,s){t.current=r,n.current=!1,i.current&&(i.current=null,s())}function NDe(t,e,n,r,i,s,o,a,l,c,u){if(!t)return()=>{};let d=!1,h=null;const f=()=>{if(d||!a.current)return;const b=e.getState();let v,x;try{v=r(b,i.current)}catch(C){x=C,h=C}x||(h=null),v===s.current?o.current||c():(s.current=v,l.current=v,o.current=!0,u())};return n.onStateChange=f,n.trySubscribe(),f(),()=>{if(d=!0,n.tryUnsubscribe(),n.onStateChange=null,h)throw h}}function jDe(t,e){return t===e}function LDe(t,e,n,{pure:r,areStatesEqual:i=jDe,areOwnPropsEqual:s=P2,areStatePropsEqual:o=P2,areMergedPropsEqual:a=P2,forwardRef:l=!1,context:c=wse}={}){const u=c,d=hDe(t),h=dDe(e),f=gDe(n),y=!!t;return v=>{const x=v.displayName||v.name||"Component",C=`Connect(${x})`,E={shouldHandleStateChanges:y,displayName:C,wrappedComponentName:x,WrappedComponent:v,initMapStateToProps:d,initMapDispatchToProps:h,initMergeProps:f,areStatesEqual:i,areStatePropsEqual:o,areOwnPropsEqual:s,areMergedPropsEqual:a};function I(A){const[D,L,z]=S.useMemo(()=>{const{reactReduxForwardedRef:de,...pe}=A;return[A.context,de,pe]},[A]),$=S.useMemo(()=>{let de=u;return D!=null&&D.Consumer,de},[D,u]),H=S.useContext($),R=!!A.store&&!!A.store.getState&&!!A.store.dispatch,j=!!H&&!!H.store,B=R?A.store:H.store,K=j?H.getServerState:B.getState,G=S.useMemo(()=>cDe(B.dispatch,E),[B]),[V,W]=S.useMemo(()=>{if(!y)return ODe;const de=bse(B,R?void 0:H.subscription),pe=de.notifyNestedSubs.bind(de);return[de,pe]},[B,R,H]),Z=S.useMemo(()=>R?H:{...H,subscription:V},[R,H,V]),U=S.useRef(void 0),J=S.useRef(z),ge=S.useRef(void 0),_e=S.useRef(!1),fe=S.useRef(!1),je=S.useRef(void 0);zT(()=>(fe.current=!0,()=>{fe.current=!1}),[]);const Ae=S.useMemo(()=>()=>ge.current&&z===J.current?ge.current:G(B.getState(),z),[B,z]),ke=S.useMemo(()=>pe=>V?NDe(y,B,V,G,J,U,_e,fe,ge,W,pe):()=>{},[V]);DDe(RDe,[J,U,_e,z,ge,W]);let le;try{le=S.useSyncExternalStore(ke,Ae,K?()=>G(K(),z):Ae)}catch(de){throw je.current&&(de.message+=`
The error may be correlated with this previous error:
${je.current.stack}

`),de}zT(()=>{je.current=void 0,ge.current=void 0,U.current=le});const ve=S.useMemo(()=>S.createElement(v,{...le,ref:L}),[L,v,le]);return S.useMemo(()=>y?S.createElement($.Provider,{value:Z},ve):ve,[$,ve,Z])}const _=S.memo(I);if(_.WrappedComponent=v,_.displayName=I.displayName=C,l){const D=S.forwardRef(function(z,$){return S.createElement(_,{...z,reactReduxForwardedRef:$})});return D.displayName=C,D.WrappedComponent=v,FF(D,v)}return FF(_,v)}}var Sse=LDe;function FDe(t){const{children:e,context:n,serverState:r,store:i}=t,s=S.useMemo(()=>{const l=bse(i);return{store:i,subscription:l,getServerState:r?()=>r:void 0}},[i,r]),o=S.useMemo(()=>i.getState(),[i]);zT(()=>{const{subscription:l}=s;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),o!==i.getState()&&l.notifyNestedSubs(),()=>{l.tryUnsubscribe(),l.onStateChange=void 0}},[s,o]);const a=n||wse;return S.createElement(a.Provider,{value:s},e)}var Cse=FDe,$De="Invariant failed";function BDe(t,e){throw new Error($De)}var oc=function(e){var n=e.top,r=e.right,i=e.bottom,s=e.left,o=r-s,a=i-n,l={top:n,right:r,bottom:i,left:s,width:o,height:a,x:s,y:n,center:{x:(r+s)/2,y:(i+n)/2}};return l},S4=function(e,n){return{top:e.top-n.top,left:e.left-n.left,bottom:e.bottom+n.bottom,right:e.right+n.right}},TW=function(e,n){return{top:e.top+n.top,left:e.left+n.left,bottom:e.bottom-n.bottom,right:e.right-n.right}},zDe=function(e,n){return{top:e.top+n.y,left:e.left+n.x,bottom:e.bottom+n.y,right:e.right+n.x}},A2={top:0,right:0,bottom:0,left:0},C4=function(e){var n=e.borderBox,r=e.margin,i=r===void 0?A2:r,s=e.border,o=s===void 0?A2:s,a=e.padding,l=a===void 0?A2:a,c=oc(S4(n,i)),u=oc(TW(n,o)),d=oc(TW(u,l));return{marginBox:c,borderBox:oc(n),paddingBox:u,contentBox:d,margin:i,border:o,padding:l}},ol=function(e){var n=e.slice(0,-2),r=e.slice(-2);if(r!=="px")return 0;var i=Number(n);return isNaN(i)&&BDe(),i},UDe=function(){return{x:window.pageXOffset,y:window.pageYOffset}},UT=function(e,n){var r=e.borderBox,i=e.border,s=e.margin,o=e.padding,a=zDe(r,n);return C4({borderBox:a,border:i,margin:s,padding:o})},HT=function(e,n){return n===void 0&&(n=UDe()),UT(e,n)},Ese=function(e,n){var r={top:ol(n.marginTop),right:ol(n.marginRight),bottom:ol(n.marginBottom),left:ol(n.marginLeft)},i={top:ol(n.paddingTop),right:ol(n.paddingRight),bottom:ol(n.paddingBottom),left:ol(n.paddingLeft)},s={top:ol(n.borderTopWidth),right:ol(n.borderRightWidth),bottom:ol(n.borderBottomWidth),left:ol(n.borderLeftWidth)};return C4({borderBox:e,margin:r,padding:i,border:s})},Tse=function(e){var n=e.getBoundingClientRect(),r=window.getComputedStyle(e);return Ese(n,r)},$x=function(e){var n=[],r=null,i=function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];n=a,!r&&(r=requestAnimationFrame(function(){r=null,e.apply(void 0,n)}))};return i.cancel=function(){r&&(cancelAnimationFrame(r),r=null)},i};function VT(){return VT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},VT.apply(null,arguments)}function Ise(t,e){}Ise.bind(null,"warn");Ise.bind(null,"error");function tf(){}function HDe(t,e){return{...t,...e}}function wl(t,e,n){const r=e.map(i=>{const s=HDe(n,i.options);return t.addEventListener(i.eventName,i.fn,s),function(){t.removeEventListener(i.eventName,i.fn,s)}});return function(){r.forEach(s=>{s()})}}const VDe="Invariant failed";class WT extends Error{}WT.prototype.toString=function(){return this.message};function Le(t,e){throw new WT(VDe)}let WDe=class extends $e.Component{constructor(...e){super(...e),this.callbacks=null,this.unbind=tf,this.onWindowError=n=>{const r=this.getCallbacks();r.isDragging()&&r.tryAbort(),n.error instanceof WT&&n.preventDefault()},this.getCallbacks=()=>{if(!this.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return this.callbacks},this.setCallbacks=n=>{this.callbacks=n}}componentDidMount(){this.unbind=wl(window,[{eventName:"error",fn:this.onWindowError}])}componentDidCatch(e){if(e instanceof WT){this.setState({});return}throw e}componentWillUnmount(){this.unbind()}render(){return this.props.children(this.setCallbacks)}};const KDe=`
  Press space bar to start a drag.
  When dragging you can use the arrow keys to move the item around and escape to cancel.
  Some screen readers may require you to be in focus mode or to use your pass through key
`,KT=t=>t+1,qDe=t=>`
  You have lifted an item in position ${KT(t.source.index)}
`,Pse=(t,e)=>{const n=t.droppableId===e.droppableId,r=KT(t.index),i=KT(e.index);return n?`
      You have moved the item from position ${r}
      to position ${i}
    `:`
    You have moved the item from position ${r}
    in list ${t.droppableId}
    to list ${e.droppableId}
    in position ${i}
  `},_se=(t,e,n)=>e.droppableId===n.droppableId?`
      The item ${t}
      has been combined with ${n.draggableId}`:`
      The item ${t}
      in list ${e.droppableId}
      has been combined with ${n.draggableId}
      in list ${n.droppableId}
    `,GDe=t=>{const e=t.destination;if(e)return Pse(t.source,e);const n=t.combine;return n?_se(t.draggableId,t.source,n):"You are over an area that cannot be dropped on"},IW=t=>`
  The item has returned to its starting position
  of ${KT(t.index)}
`,YDe=t=>{if(t.reason==="CANCEL")return`
      Movement cancelled.
      ${IW(t.source)}
    `;const e=t.destination,n=t.combine;return e?`
      You have dropped the item.
      ${Pse(t.source,e)}
    `:n?`
      You have dropped the item.
      ${_se(t.draggableId,t.source,n)}
    `:`
    The item has been dropped while not over a drop area.
    ${IW(t.source)}
  `},zE={dragHandleUsageInstructions:KDe,onDragStart:qDe,onDragUpdate:GDe,onDragEnd:YDe};function XDe(t,e){return!!(t===e||Number.isNaN(t)&&Number.isNaN(e))}function kse(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!XDe(t[n],e[n]))return!1;return!0}function en(t,e){const n=S.useState(()=>({inputs:e,result:t()}))[0],r=S.useRef(!0),i=S.useRef(n),o=r.current||!!(e&&i.current.inputs&&kse(e,i.current.inputs))?i.current:{inputs:e,result:t()};return S.useEffect(()=>{r.current=!1,i.current=o},[o]),o.result}function ct(t,e){return en(()=>t,e)}const _i={x:0,y:0},ns=(t,e)=>({x:t.x+e.x,y:t.y+e.y}),va=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),nf=(t,e)=>t.x===e.x&&t.y===e.y,yv=t=>({x:t.x!==0?-t.x:0,y:t.y!==0?-t.y:0}),rg=(t,e,n=0)=>t==="x"?{x:e,y:n}:{x:n,y:e},Bx=(t,e)=>Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2),PW=(t,e)=>Math.min(...e.map(n=>Bx(t,n))),Ase=t=>e=>({x:t(e.x),y:t(e.y)});var JDe=(t,e)=>{const n=oc({top:Math.max(e.top,t.top),right:Math.min(e.right,t.right),bottom:Math.min(e.bottom,t.bottom),left:Math.max(e.left,t.left)});return n.width<=0||n.height<=0?null:n};const nS=(t,e)=>({top:t.top+e.y,left:t.left+e.x,bottom:t.bottom+e.y,right:t.right+e.x}),_W=t=>[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.bottom}],ZDe={top:0,right:0,bottom:0,left:0},QDe=(t,e)=>e?nS(t,e.scroll.diff.displacement):t,eRe=(t,e,n)=>n&&n.increasedBy?{...t,[e.end]:t[e.end]+n.increasedBy[e.line]}:t,tRe=(t,e)=>e&&e.shouldClipSubject?JDe(e.pageMarginBox,t):oc(t);var Py=({page:t,withPlaceholder:e,axis:n,frame:r})=>{const i=QDe(t.marginBox,r),s=eRe(i,n,e),o=tRe(s,r);return{page:t,withPlaceholder:e,active:o}},E4=(t,e)=>{t.frame||Le();const n=t.frame,r=va(e,n.scroll.initial),i=yv(r),s={...n,scroll:{initial:n.scroll.initial,current:e,diff:{value:r,displacement:i},max:n.scroll.max}},o=Py({page:t.subject.page,withPlaceholder:t.subject.withPlaceholder,axis:t.axis,frame:s});return{...t,frame:s,subject:o}};function Ti(t,e=kse){let n=null;function r(...i){if(n&&n.lastThis===this&&e(i,n.lastArgs))return n.lastResult;const s=t.apply(this,i);return n={lastResult:s,lastArgs:i,lastThis:this},s}return r.clear=function(){n=null},r}const Mse=Ti(t=>t.reduce((e,n)=>(e[n.descriptor.id]=n,e),{})),Ose=Ti(t=>t.reduce((e,n)=>(e[n.descriptor.id]=n,e),{})),D_=Ti(t=>Object.values(t)),nRe=Ti(t=>Object.values(t));var vv=Ti((t,e)=>nRe(e).filter(r=>t===r.descriptor.droppableId).sort((r,i)=>r.descriptor.index-i.descriptor.index));function T4(t){return t.at&&t.at.type==="REORDER"?t.at.destination:null}function R_(t){return t.at&&t.at.type==="COMBINE"?t.at.combine:null}var N_=Ti((t,e)=>e.filter(n=>n.descriptor.id!==t.descriptor.id)),rRe=({isMovingForward:t,draggable:e,destination:n,insideDestination:r,previousImpact:i})=>{if(!n.isCombineEnabled||!T4(i))return null;function o(f){const y={type:"COMBINE",combine:{draggableId:f,droppableId:n.descriptor.id}};return{...i,at:y}}const a=i.displaced.all,l=a.length?a[0]:null;if(t)return l?o(l):null;const c=N_(e,r);if(!l){if(!c.length)return null;const f=c[c.length-1];return o(f.descriptor.id)}const u=c.findIndex(f=>f.descriptor.id===l);u===-1&&Le();const d=u-1;if(d<0)return null;const h=c[d];return o(h.descriptor.id)},bv=(t,e)=>t.descriptor.droppableId===e.descriptor.id;const Dse={point:_i,value:0},zx={invisible:{},visible:{},all:[]},iRe={displaced:zx,displacedBy:Dse,at:null};var Tl=(t,e)=>n=>t<=n&&n<=e,Rse=t=>{const e=Tl(t.top,t.bottom),n=Tl(t.left,t.right);return r=>{if(e(r.top)&&e(r.bottom)&&n(r.left)&&n(r.right))return!0;const s=e(r.top)||e(r.bottom),o=n(r.left)||n(r.right);if(s&&o)return!0;const l=r.top<t.top&&r.bottom>t.bottom,c=r.left<t.left&&r.right>t.right;return l&&c?!0:l&&o||c&&s}},sRe=t=>{const e=Tl(t.top,t.bottom),n=Tl(t.left,t.right);return r=>e(r.top)&&e(r.bottom)&&n(r.left)&&n(r.right)};const I4={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},Nse={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"};var oRe=t=>e=>{const n=Tl(e.top,e.bottom),r=Tl(e.left,e.right);return i=>t===I4?n(i.top)&&n(i.bottom):r(i.left)&&r(i.right)};const aRe=(t,e)=>{const n=e.frame?e.frame.scroll.diff.displacement:_i;return nS(t,n)},lRe=(t,e,n)=>e.subject.active?n(e.subject.active)(t):!1,cRe=(t,e,n)=>n(e)(t),P4=({target:t,destination:e,viewport:n,withDroppableDisplacement:r,isVisibleThroughFrameFn:i})=>{const s=r?aRe(t,e):t;return lRe(s,e,i)&&cRe(s,n,i)},uRe=t=>P4({...t,isVisibleThroughFrameFn:Rse}),jse=t=>P4({...t,isVisibleThroughFrameFn:sRe}),dRe=t=>P4({...t,isVisibleThroughFrameFn:oRe(t.destination.axis)}),hRe=(t,e,n)=>{if(typeof n=="boolean")return n;if(!e)return!0;const{invisible:r,visible:i}=e;if(r[t])return!1;const s=i[t];return s?s.shouldAnimate:!0};function fRe(t,e){const n=t.page.marginBox,r={top:e.point.y,right:0,bottom:0,left:e.point.x};return oc(S4(n,r))}function Ux({afterDragging:t,destination:e,displacedBy:n,viewport:r,forceShouldAnimate:i,last:s}){return t.reduce(function(a,l){const c=fRe(l,n),u=l.descriptor.id;if(a.all.push(u),!uRe({target:c,destination:e,viewport:r,withDroppableDisplacement:!0}))return a.invisible[l.descriptor.id]=!0,a;const h=hRe(u,s,i),f={draggableId:u,shouldAnimate:h};return a.visible[u]=f,a},{all:[],visible:{},invisible:{}})}function pRe(t,e){if(!t.length)return 0;const n=t[t.length-1].descriptor.index;return e.inHomeList?n:n+1}function kW({insideDestination:t,inHomeList:e,displacedBy:n,destination:r}){const i=pRe(t,{inHomeList:e});return{displaced:zx,displacedBy:n,at:{type:"REORDER",destination:{droppableId:r.descriptor.id,index:i}}}}function qT({draggable:t,insideDestination:e,destination:n,viewport:r,displacedBy:i,last:s,index:o,forceShouldAnimate:a}){const l=bv(t,n);if(o==null)return kW({insideDestination:e,inHomeList:l,displacedBy:i,destination:n});const c=e.find(y=>y.descriptor.index===o);if(!c)return kW({insideDestination:e,inHomeList:l,displacedBy:i,destination:n});const u=N_(t,e),d=e.indexOf(c),h=u.slice(d);return{displaced:Ux({afterDragging:h,destination:n,displacedBy:i,last:s,viewport:r.frame,forceShouldAnimate:a}),displacedBy:i,at:{type:"REORDER",destination:{droppableId:n.descriptor.id,index:o}}}}function hf(t,e){return!!e.effected[t]}var gRe=({isMovingForward:t,destination:e,draggables:n,combine:r,afterCritical:i})=>{if(!e.isCombineEnabled)return null;const s=r.draggableId,a=n[s].descriptor.index;return hf(s,i)?t?a:a-1:t?a+1:a},mRe=({isMovingForward:t,isInHomeList:e,insideDestination:n,location:r})=>{if(!n.length)return null;const i=r.index,s=t?i+1:i-1,o=n[0].descriptor.index,a=n[n.length-1].descriptor.index,l=e?a:a+1;return s<o||s>l?null:s},yRe=({isMovingForward:t,isInHomeList:e,draggable:n,draggables:r,destination:i,insideDestination:s,previousImpact:o,viewport:a,afterCritical:l})=>{const c=o.at;if(c||Le(),c.type==="REORDER"){const d=mRe({isMovingForward:t,isInHomeList:e,location:c.destination,insideDestination:s});return d==null?null:qT({draggable:n,insideDestination:s,destination:i,viewport:a,last:o.displaced,displacedBy:o.displacedBy,index:d})}const u=gRe({isMovingForward:t,destination:i,displaced:o.displaced,draggables:r,combine:c.combine,afterCritical:l});return u==null?null:qT({draggable:n,insideDestination:s,destination:i,viewport:a,last:o.displaced,displacedBy:o.displacedBy,index:u})},vRe=({displaced:t,afterCritical:e,combineWith:n,displacedBy:r})=>{const i=!!(t.visible[n]||t.invisible[n]);return hf(n,e)?i?_i:yv(r.point):i?r.point:_i},bRe=({afterCritical:t,impact:e,draggables:n})=>{const r=R_(e);r||Le();const i=r.draggableId,s=n[i].page.borderBox.center,o=vRe({displaced:e.displaced,afterCritical:t,combineWith:i,displacedBy:e.displacedBy});return ns(s,o)};const Lse=(t,e)=>e.margin[t.start]+e.borderBox[t.size]/2,xRe=(t,e)=>e.margin[t.end]+e.borderBox[t.size]/2,_4=(t,e,n)=>e[t.crossAxisStart]+n.margin[t.crossAxisStart]+n.borderBox[t.crossAxisSize]/2,AW=({axis:t,moveRelativeTo:e,isMoving:n})=>rg(t.line,e.marginBox[t.end]+Lse(t,n),_4(t,e.marginBox,n)),MW=({axis:t,moveRelativeTo:e,isMoving:n})=>rg(t.line,e.marginBox[t.start]-xRe(t,n),_4(t,e.marginBox,n)),wRe=({axis:t,moveInto:e,isMoving:n})=>rg(t.line,e.contentBox[t.start]+Lse(t,n),_4(t,e.contentBox,n));var SRe=({impact:t,draggable:e,draggables:n,droppable:r,afterCritical:i})=>{const s=vv(r.descriptor.id,n),o=e.page,a=r.axis;if(!s.length)return wRe({axis:a,moveInto:r.page,isMoving:o});const{displaced:l,displacedBy:c}=t,u=l.all[0];if(u){const h=n[u];if(hf(u,i))return MW({axis:a,moveRelativeTo:h.page,isMoving:o});const f=UT(h.page,c.point);return MW({axis:a,moveRelativeTo:f,isMoving:o})}const d=s[s.length-1];if(d.descriptor.id===e.descriptor.id)return o.borderBox.center;if(hf(d.descriptor.id,i)){const h=UT(d.page,yv(i.displacedBy.point));return AW({axis:a,moveRelativeTo:h,isMoving:o})}return AW({axis:a,moveRelativeTo:d.page,isMoving:o})},$F=(t,e)=>{const n=t.frame;return n?ns(e,n.scroll.diff.displacement):e};const CRe=({impact:t,draggable:e,droppable:n,draggables:r,afterCritical:i})=>{const s=e.page.borderBox.center,o=t.at;return!n||!o?s:o.type==="REORDER"?SRe({impact:t,draggable:e,draggables:r,droppable:n,afterCritical:i}):bRe({impact:t,draggables:r,afterCritical:i})};var j_=t=>{const e=CRe(t),n=t.droppable;return n?$F(n,e):e},Fse=(t,e)=>{const n=va(e,t.scroll.initial),r=yv(n);return{frame:oc({top:e.y,bottom:e.y+t.frame.height,left:e.x,right:e.x+t.frame.width}),scroll:{initial:t.scroll.initial,max:t.scroll.max,current:e,diff:{value:n,displacement:r}}}};function OW(t,e){return t.map(n=>e[n])}function ERe(t,e){for(let n=0;n<e.length;n++){const r=e[n].visible[t];if(r)return r}return null}var TRe=({impact:t,viewport:e,destination:n,draggables:r,maxScrollChange:i})=>{const s=Fse(e,ns(e.scroll.current,i)),o=n.frame?E4(n,ns(n.frame.scroll.current,i)):n,a=t.displaced,l=Ux({afterDragging:OW(a.all,r),destination:n,displacedBy:t.displacedBy,viewport:s.frame,last:a,forceShouldAnimate:!1}),c=Ux({afterDragging:OW(a.all,r),destination:o,displacedBy:t.displacedBy,viewport:e.frame,last:a,forceShouldAnimate:!1}),u={},d={},h=[a,l,c];return a.all.forEach(y=>{const b=ERe(y,h);if(b){d[y]=b;return}u[y]=!0}),{...t,displaced:{all:a.all,invisible:u,visible:d}}},IRe=(t,e)=>ns(t.scroll.diff.displacement,e),k4=({pageBorderBoxCenter:t,draggable:e,viewport:n})=>{const r=IRe(n,t),i=va(r,e.page.borderBox.center);return ns(e.client.borderBox.center,i)},$se=({draggable:t,destination:e,newPageBorderBoxCenter:n,viewport:r,withDroppableDisplacement:i,onlyOnMainAxis:s=!1})=>{const o=va(n,t.page.borderBox.center),l={target:nS(t.page.borderBox,o),destination:e,withDroppableDisplacement:i,viewport:r};return s?dRe(l):jse(l)},PRe=({isMovingForward:t,draggable:e,destination:n,draggables:r,previousImpact:i,viewport:s,previousPageBorderBoxCenter:o,previousClientSelection:a,afterCritical:l})=>{if(!n.isEnabled)return null;const c=vv(n.descriptor.id,r),u=bv(e,n),d=rRe({isMovingForward:t,draggable:e,destination:n,insideDestination:c,previousImpact:i})||yRe({isMovingForward:t,isInHomeList:u,draggable:e,draggables:r,destination:n,insideDestination:c,previousImpact:i,viewport:s,afterCritical:l});if(!d)return null;const h=j_({impact:d,draggable:e,droppable:n,draggables:r,afterCritical:l});if($se({draggable:e,destination:n,newPageBorderBoxCenter:h,viewport:s.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0}))return{clientSelection:k4({pageBorderBoxCenter:h,draggable:e,viewport:s}),impact:d,scrollJumpRequest:null};const y=va(h,o),b=TRe({impact:d,viewport:s,destination:n,draggables:r,maxScrollChange:y});return{clientSelection:a,impact:b,scrollJumpRequest:y}};const no=t=>{const e=t.subject.active;return e||Le(),e};var _Re=({isMovingForward:t,pageBorderBoxCenter:e,source:n,droppables:r,viewport:i})=>{const s=n.subject.active;if(!s)return null;const o=n.axis,a=Tl(s[o.start],s[o.end]),l=D_(r).filter(u=>u!==n).filter(u=>u.isEnabled).filter(u=>!!u.subject.active).filter(u=>Rse(i.frame)(no(u))).filter(u=>{const d=no(u);return t?s[o.crossAxisEnd]<d[o.crossAxisEnd]:d[o.crossAxisStart]<s[o.crossAxisStart]}).filter(u=>{const d=no(u),h=Tl(d[o.start],d[o.end]);return a(d[o.start])||a(d[o.end])||h(s[o.start])||h(s[o.end])}).sort((u,d)=>{const h=no(u)[o.crossAxisStart],f=no(d)[o.crossAxisStart];return t?h-f:f-h}).filter((u,d,h)=>no(u)[o.crossAxisStart]===no(h[0])[o.crossAxisStart]);if(!l.length)return null;if(l.length===1)return l[0];const c=l.filter(u=>Tl(no(u)[o.start],no(u)[o.end])(e[o.line]));return c.length===1?c[0]:c.length>1?c.sort((u,d)=>no(u)[o.start]-no(d)[o.start])[0]:l.sort((u,d)=>{const h=PW(e,_W(no(u))),f=PW(e,_W(no(d)));return h!==f?h-f:no(u)[o.start]-no(d)[o.start]})[0]};const DW=(t,e)=>{const n=t.page.borderBox.center;return hf(t.descriptor.id,e)?va(n,e.displacedBy.point):n},kRe=(t,e)=>{const n=t.page.borderBox;return hf(t.descriptor.id,e)?nS(n,yv(e.displacedBy.point)):n};var ARe=({pageBorderBoxCenter:t,viewport:e,destination:n,insideDestination:r,afterCritical:i})=>r.filter(o=>jse({target:kRe(o,i),destination:n,viewport:e.frame,withDroppableDisplacement:!0})).sort((o,a)=>{const l=Bx(t,$F(n,DW(o,i))),c=Bx(t,$F(n,DW(a,i)));return l<c?-1:c<l?1:o.descriptor.index-a.descriptor.index})[0]||null,rS=Ti(function(e,n){const r=n[e.line];return{value:r,point:rg(e.line,r)}});const MRe=(t,e,n)=>{const r=t.axis;if(t.descriptor.mode==="virtual")return rg(r.line,e[r.line]);const i=t.subject.page.contentBox[r.size],l=vv(t.descriptor.id,n).reduce((c,u)=>c+u.client.marginBox[r.size],0)+e[r.line]-i;return l<=0?null:rg(r.line,l)},Bse=(t,e)=>({...t,scroll:{...t.scroll,max:e}}),zse=(t,e,n)=>{const r=t.frame;bv(e,t)&&Le(),t.subject.withPlaceholder&&Le();const i=rS(t.axis,e.displaceBy).point,s=MRe(t,i,n),o={placeholderSize:i,increasedBy:s,oldFrameMaxScroll:t.frame?t.frame.scroll.max:null};if(!r){const u=Py({page:t.subject.page,withPlaceholder:o,axis:t.axis,frame:t.frame});return{...t,subject:u}}const a=s?ns(r.scroll.max,s):r.scroll.max,l=Bse(r,a),c=Py({page:t.subject.page,withPlaceholder:o,axis:t.axis,frame:l});return{...t,subject:c,frame:l}},ORe=t=>{const e=t.subject.withPlaceholder;e||Le();const n=t.frame;if(!n){const o=Py({page:t.subject.page,axis:t.axis,frame:null,withPlaceholder:null});return{...t,subject:o}}const r=e.oldFrameMaxScroll;r||Le();const i=Bse(n,r),s=Py({page:t.subject.page,axis:t.axis,frame:i,withPlaceholder:null});return{...t,subject:s,frame:i}};var DRe=({previousPageBorderBoxCenter:t,moveRelativeTo:e,insideDestination:n,draggable:r,draggables:i,destination:s,viewport:o,afterCritical:a})=>{if(!e){if(n.length)return null;const d={displaced:zx,displacedBy:Dse,at:{type:"REORDER",destination:{droppableId:s.descriptor.id,index:0}}},h=j_({impact:d,draggable:r,droppable:s,draggables:i,afterCritical:a}),f=bv(r,s)?s:zse(s,r,i);return $se({draggable:r,destination:f,newPageBorderBoxCenter:h,viewport:o.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0})?d:null}const l=t[s.axis.line]<=e.page.borderBox.center[s.axis.line],c=(()=>{const d=e.descriptor.index;return e.descriptor.id===r.descriptor.id||l?d:d+1})(),u=rS(s.axis,r.displaceBy);return qT({draggable:r,insideDestination:n,destination:s,viewport:o,displacedBy:u,last:zx,index:c})},RRe=({isMovingForward:t,previousPageBorderBoxCenter:e,draggable:n,isOver:r,draggables:i,droppables:s,viewport:o,afterCritical:a})=>{const l=_Re({isMovingForward:t,pageBorderBoxCenter:e,source:r,droppables:s,viewport:o});if(!l)return null;const c=vv(l.descriptor.id,i),u=ARe({pageBorderBoxCenter:e,viewport:o,destination:l,insideDestination:c,afterCritical:a}),d=DRe({previousPageBorderBoxCenter:e,destination:l,draggable:n,draggables:i,moveRelativeTo:u,insideDestination:c,viewport:o,afterCritical:a});if(!d)return null;const h=j_({impact:d,draggable:n,droppable:l,draggables:i,afterCritical:a});return{clientSelection:k4({pageBorderBoxCenter:h,draggable:n,viewport:o}),impact:d,scrollJumpRequest:null}},Pa=t=>{const e=t.at;return e?e.type==="REORDER"?e.destination.droppableId:e.combine.droppableId:null};const NRe=(t,e)=>{const n=Pa(t);return n?e[n]:null};var jRe=({state:t,type:e})=>{const n=NRe(t.impact,t.dimensions.droppables),r=!!n,i=t.dimensions.droppables[t.critical.droppable.id],s=n||i,o=s.axis.direction,a=o==="vertical"&&(e==="MOVE_UP"||e==="MOVE_DOWN")||o==="horizontal"&&(e==="MOVE_LEFT"||e==="MOVE_RIGHT");if(a&&!r)return null;const l=e==="MOVE_DOWN"||e==="MOVE_RIGHT",c=t.dimensions.draggables[t.critical.draggable.id],u=t.current.page.borderBoxCenter,{draggables:d,droppables:h}=t.dimensions;return a?PRe({isMovingForward:l,previousPageBorderBoxCenter:u,draggable:c,destination:s,draggables:d,viewport:t.viewport,previousClientSelection:t.current.client.selection,previousImpact:t.impact,afterCritical:t.afterCritical}):RRe({isMovingForward:l,previousPageBorderBoxCenter:u,draggable:c,isOver:s,draggables:d,droppables:h,viewport:t.viewport,afterCritical:t.afterCritical})};function gp(t){return t.phase==="DRAGGING"||t.phase==="COLLECTING"}function Use(t){const e=Tl(t.top,t.bottom),n=Tl(t.left,t.right);return function(i){return e(i.y)&&n(i.x)}}function LRe(t,e){return t.left<e.right&&t.right>e.left&&t.top<e.bottom&&t.bottom>e.top}function FRe({pageBorderBox:t,draggable:e,candidates:n}){const r=e.page.borderBox.center,i=n.map(s=>{const o=s.axis,a=rg(s.axis.line,t.center[o.line],s.page.borderBox.center[o.crossAxisLine]);return{id:s.descriptor.id,distance:Bx(r,a)}}).sort((s,o)=>o.distance-s.distance);return i[0]?i[0].id:null}function $Re({pageBorderBox:t,draggable:e,droppables:n}){const r=D_(n).filter(i=>{if(!i.isEnabled)return!1;const s=i.subject.active;if(!s||!LRe(t,s))return!1;if(Use(s)(t.center))return!0;const o=i.axis,a=s.center[o.crossAxisLine],l=t[o.crossAxisStart],c=t[o.crossAxisEnd],u=Tl(s[o.crossAxisStart],s[o.crossAxisEnd]),d=u(l),h=u(c);return!d&&!h?!0:d?l<a:c>a});return r.length?r.length===1?r[0].descriptor.id:FRe({pageBorderBox:t,draggable:e,candidates:r}):null}const Hse=(t,e)=>oc(nS(t,e));var BRe=(t,e)=>{const n=t.frame;return n?Hse(e,n.scroll.diff.value):e};function Vse({displaced:t,id:e}){return!!(t.visible[e]||t.invisible[e])}function zRe({draggable:t,closest:e,inHomeList:n}){return e?n&&e.descriptor.index>t.descriptor.index?e.descriptor.index-1:e.descriptor.index:null}var URe=({pageBorderBoxWithDroppableScroll:t,draggable:e,destination:n,insideDestination:r,last:i,viewport:s,afterCritical:o})=>{const a=n.axis,l=rS(n.axis,e.displaceBy),c=l.value,u=t[a.start],d=t[a.end],f=N_(e,r).find(b=>{const v=b.descriptor.id,x=b.page.borderBox.center[a.line],C=hf(v,o),E=Vse({displaced:i,id:v});return C?E?d<=x:u<x-c:E?d<=x+c:u<x})||null,y=zRe({draggable:e,closest:f,inHomeList:bv(e,n)});return qT({draggable:e,insideDestination:r,destination:n,viewport:s,last:i,displacedBy:l,index:y})};const HRe=4;var VRe=({draggable:t,pageBorderBoxWithDroppableScroll:e,previousImpact:n,destination:r,insideDestination:i,afterCritical:s})=>{if(!r.isCombineEnabled)return null;const o=r.axis,a=rS(r.axis,t.displaceBy),l=a.value,c=e[o.start],u=e[o.end],h=N_(t,i).find(y=>{const b=y.descriptor.id,v=y.page.borderBox,C=v[o.size]/HRe,E=hf(b,s),I=Vse({displaced:n.displaced,id:b});return E?I?u>v[o.start]+C&&u<v[o.end]-C:c>v[o.start]-l+C&&c<v[o.end]-l-C:I?u>v[o.start]+l+C&&u<v[o.end]+l-C:c>v[o.start]+C&&c<v[o.end]-C});return h?{displacedBy:a,displaced:n.displaced,at:{type:"COMBINE",combine:{draggableId:h.descriptor.id,droppableId:r.descriptor.id}}}:null},Wse=({pageOffset:t,draggable:e,draggables:n,droppables:r,previousImpact:i,viewport:s,afterCritical:o})=>{const a=Hse(e.page.borderBox,t),l=$Re({pageBorderBox:a,draggable:e,droppables:r});if(!l)return iRe;const c=r[l],u=vv(c.descriptor.id,n),d=BRe(c,a);return VRe({pageBorderBoxWithDroppableScroll:d,draggable:e,previousImpact:i,destination:c,insideDestination:u,afterCritical:o})||URe({pageBorderBoxWithDroppableScroll:d,draggable:e,destination:c,insideDestination:u,last:i.displaced,viewport:s,afterCritical:o})},A4=(t,e)=>({...t,[e.descriptor.id]:e});const WRe=({previousImpact:t,impact:e,droppables:n})=>{const r=Pa(t),i=Pa(e);if(!r||r===i)return n;const s=n[r];if(!s.subject.withPlaceholder)return n;const o=ORe(s);return A4(n,o)};var KRe=({draggable:t,draggables:e,droppables:n,previousImpact:r,impact:i})=>{const s=WRe({previousImpact:r,impact:i,droppables:n}),o=Pa(i);if(!o)return s;const a=n[o];if(bv(t,a)||a.subject.withPlaceholder)return s;const l=zse(a,t,e);return A4(s,l)},nx=({state:t,clientSelection:e,dimensions:n,viewport:r,impact:i,scrollJumpRequest:s})=>{const o=r||t.viewport,a=n||t.dimensions,l=e||t.current.client.selection,c=va(l,t.initial.client.selection),u={offset:c,selection:l,borderBoxCenter:ns(t.initial.client.borderBoxCenter,c)},d={selection:ns(u.selection,o.scroll.current),borderBoxCenter:ns(u.borderBoxCenter,o.scroll.current),offset:ns(u.offset,o.scroll.diff.value)},h={client:u,page:d};if(t.phase==="COLLECTING")return{...t,dimensions:a,viewport:o,current:h};const f=a.draggables[t.critical.draggable.id],y=i||Wse({pageOffset:d.offset,draggable:f,draggables:a.draggables,droppables:a.droppables,previousImpact:t.impact,viewport:o,afterCritical:t.afterCritical}),b=KRe({draggable:f,impact:y,previousImpact:t.impact,draggables:a.draggables,droppables:a.droppables});return{...t,current:h,dimensions:{draggables:a.draggables,droppables:b},impact:y,viewport:o,scrollJumpRequest:s||null,forceShouldAnimate:s?!1:null}};function qRe(t,e){return t.map(n=>e[n])}var Kse=({impact:t,viewport:e,draggables:n,destination:r,forceShouldAnimate:i})=>{const s=t.displaced,o=qRe(s.all,n),a=Ux({afterDragging:o,destination:r,displacedBy:t.displacedBy,viewport:e.frame,forceShouldAnimate:i,last:s});return{...t,displaced:a}},qse=({impact:t,draggable:e,droppable:n,draggables:r,viewport:i,afterCritical:s})=>{const o=j_({impact:t,draggable:e,draggables:r,droppable:n,afterCritical:s});return k4({pageBorderBoxCenter:o,draggable:e,viewport:i})},Gse=({state:t,dimensions:e,viewport:n})=>{t.movementMode!=="SNAP"&&Le();const r=t.impact,i=n||t.viewport,s=e||t.dimensions,{draggables:o,droppables:a}=s,l=o[t.critical.draggable.id],c=Pa(r);c||Le();const u=a[c],d=Kse({impact:r,viewport:i,destination:u,draggables:o}),h=qse({impact:d,draggable:l,droppable:u,draggables:o,viewport:i,afterCritical:t.afterCritical});return nx({impact:d,clientSelection:h,state:t,dimensions:s,viewport:i})},GRe=t=>({index:t.index,droppableId:t.droppableId}),Yse=({draggable:t,home:e,draggables:n,viewport:r})=>{const i=rS(e.axis,t.displaceBy),s=vv(e.descriptor.id,n),o=s.indexOf(t);o===-1&&Le();const a=s.slice(o+1),l=a.reduce((h,f)=>(h[f.descriptor.id]=!0,h),{}),c={inVirtualList:e.descriptor.mode==="virtual",displacedBy:i,effected:l};return{impact:{displaced:Ux({afterDragging:a,destination:e,displacedBy:i,last:null,viewport:r.frame,forceShouldAnimate:!1}),displacedBy:i,at:{type:"REORDER",destination:GRe(t.descriptor)}},afterCritical:c}},YRe=(t,e)=>({draggables:t.draggables,droppables:A4(t.droppables,e)}),XRe=({draggable:t,offset:e,initialWindowScroll:n})=>{const r=UT(t.client,e),i=HT(r,n);return{...t,placeholder:{...t.placeholder,client:r},client:r,page:i}},JRe=t=>{const e=t.frame;return e||Le(),e},ZRe=({additions:t,updatedDroppables:e,viewport:n})=>{const r=n.scroll.diff.value;return t.map(i=>{const s=i.descriptor.droppableId,o=e[s],l=JRe(o).scroll.diff.value,c=ns(r,l);return XRe({draggable:i,offset:c,initialWindowScroll:n.scroll.initial})})},QRe=({state:t,published:e})=>{const n=e.modified.map(x=>{const C=t.dimensions.droppables[x.droppableId];return E4(C,x.scroll)}),r={...t.dimensions.droppables,...Mse(n)},i=Ose(ZRe({additions:e.additions,updatedDroppables:r,viewport:t.viewport})),s={...t.dimensions.draggables,...i};e.removals.forEach(x=>{delete s[x]});const o={droppables:r,draggables:s},a=Pa(t.impact),l=a?o.droppables[a]:null,c=o.draggables[t.critical.draggable.id],u=o.droppables[t.critical.droppable.id],{impact:d,afterCritical:h}=Yse({draggable:c,home:u,draggables:s,viewport:t.viewport}),f=l&&l.isCombineEnabled?t.impact:d,y=Wse({pageOffset:t.current.page.offset,draggable:o.draggables[t.critical.draggable.id],draggables:o.draggables,droppables:o.droppables,previousImpact:f,viewport:t.viewport,afterCritical:h}),b={...t,phase:"DRAGGING",impact:y,onLiftImpact:d,dimensions:o,afterCritical:h,forceShouldAnimate:!1};return t.phase==="COLLECTING"?b:{...b,phase:"DROP_PENDING",reason:t.reason,isWaiting:!1}};const BF=t=>t.movementMode==="SNAP",M2=(t,e,n)=>{const r=YRe(t.dimensions,e);return!BF(t)||n?nx({state:t,dimensions:r}):Gse({state:t,dimensions:r})};function O2(t){return t.isDragging&&t.movementMode==="SNAP"?{...t,scrollJumpRequest:null}:t}const RW={phase:"IDLE",completed:null,shouldFlush:!1};var eNe=(t=RW,e)=>{if(e.type==="FLUSH")return{...RW,shouldFlush:!0};if(e.type==="INITIAL_PUBLISH"){t.phase!=="IDLE"&&Le();const{critical:n,clientSelection:r,viewport:i,dimensions:s,movementMode:o}=e.payload,a=s.draggables[n.draggable.id],l=s.droppables[n.droppable.id],c={selection:r,borderBoxCenter:a.client.borderBox.center,offset:_i},u={client:c,page:{selection:ns(c.selection,i.scroll.initial),borderBoxCenter:ns(c.selection,i.scroll.initial),offset:ns(c.selection,i.scroll.diff.value)}},d=D_(s.droppables).every(b=>!b.isFixedOnPage),{impact:h,afterCritical:f}=Yse({draggable:a,home:l,draggables:s.draggables,viewport:i});return{phase:"DRAGGING",isDragging:!0,critical:n,movementMode:o,dimensions:s,initial:u,current:u,isWindowScrollAllowed:d,impact:h,afterCritical:f,onLiftImpact:h,viewport:i,scrollJumpRequest:null,forceShouldAnimate:null}}if(e.type==="COLLECTION_STARTING")return t.phase==="COLLECTING"||t.phase==="DROP_PENDING"?t:(t.phase!=="DRAGGING"&&Le(),{...t,phase:"COLLECTING"});if(e.type==="PUBLISH_WHILE_DRAGGING")return t.phase==="COLLECTING"||t.phase==="DROP_PENDING"||Le(),QRe({state:t,published:e.payload});if(e.type==="MOVE"){if(t.phase==="DROP_PENDING")return t;gp(t)||Le();const{client:n}=e.payload;return nf(n,t.current.client.selection)?t:nx({state:t,clientSelection:n,impact:BF(t)?t.impact:null})}if(e.type==="UPDATE_DROPPABLE_SCROLL"){if(t.phase==="DROP_PENDING"||t.phase==="COLLECTING")return O2(t);gp(t)||Le();const{id:n,newScroll:r}=e.payload,i=t.dimensions.droppables[n];if(!i)return t;const s=E4(i,r);return M2(t,s,!1)}if(e.type==="UPDATE_DROPPABLE_IS_ENABLED"){if(t.phase==="DROP_PENDING")return t;gp(t)||Le();const{id:n,isEnabled:r}=e.payload,i=t.dimensions.droppables[n];i||Le(),i.isEnabled===r&&Le();const s={...i,isEnabled:r};return M2(t,s,!0)}if(e.type==="UPDATE_DROPPABLE_IS_COMBINE_ENABLED"){if(t.phase==="DROP_PENDING")return t;gp(t)||Le();const{id:n,isCombineEnabled:r}=e.payload,i=t.dimensions.droppables[n];i||Le(),i.isCombineEnabled===r&&Le();const s={...i,isCombineEnabled:r};return M2(t,s,!0)}if(e.type==="MOVE_BY_WINDOW_SCROLL"){if(t.phase==="DROP_PENDING"||t.phase==="DROP_ANIMATING")return t;gp(t)||Le(),t.isWindowScrollAllowed||Le();const n=e.payload.newScroll;if(nf(t.viewport.scroll.current,n))return O2(t);const r=Fse(t.viewport,n);return BF(t)?Gse({state:t,viewport:r}):nx({state:t,viewport:r})}if(e.type==="UPDATE_VIEWPORT_MAX_SCROLL"){if(!gp(t))return t;const n=e.payload.maxScroll;if(nf(n,t.viewport.scroll.max))return t;const r={...t.viewport,scroll:{...t.viewport.scroll,max:n}};return{...t,viewport:r}}if(e.type==="MOVE_UP"||e.type==="MOVE_DOWN"||e.type==="MOVE_LEFT"||e.type==="MOVE_RIGHT"){if(t.phase==="COLLECTING"||t.phase==="DROP_PENDING")return t;t.phase!=="DRAGGING"&&Le();const n=jRe({state:t,type:e.type});return n?nx({state:t,impact:n.impact,clientSelection:n.clientSelection,scrollJumpRequest:n.scrollJumpRequest}):t}if(e.type==="DROP_PENDING"){const n=e.payload.reason;return t.phase!=="COLLECTING"&&Le(),{...t,phase:"DROP_PENDING",isWaiting:!0,reason:n}}if(e.type==="DROP_ANIMATE"){const{completed:n,dropDuration:r,newHomeClientOffset:i}=e.payload;return t.phase==="DRAGGING"||t.phase==="DROP_PENDING"||Le(),{phase:"DROP_ANIMATING",completed:n,dropDuration:r,newHomeClientOffset:i,dimensions:t.dimensions}}if(e.type==="DROP_COMPLETE"){const{completed:n}=e.payload;return{phase:"IDLE",completed:n,shouldFlush:!1}}return t};function gn(t,e){return t instanceof Object&&"type"in t&&t.type===e}const tNe=t=>({type:"BEFORE_INITIAL_CAPTURE",payload:t}),nNe=t=>({type:"LIFT",payload:t}),rNe=t=>({type:"INITIAL_PUBLISH",payload:t}),iNe=t=>({type:"PUBLISH_WHILE_DRAGGING",payload:t}),sNe=()=>({type:"COLLECTION_STARTING",payload:null}),oNe=t=>({type:"UPDATE_DROPPABLE_SCROLL",payload:t}),aNe=t=>({type:"UPDATE_DROPPABLE_IS_ENABLED",payload:t}),lNe=t=>({type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:t}),Xse=t=>({type:"MOVE",payload:t}),cNe=t=>({type:"MOVE_BY_WINDOW_SCROLL",payload:t}),uNe=t=>({type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:t}),dNe=()=>({type:"MOVE_UP",payload:null}),hNe=()=>({type:"MOVE_DOWN",payload:null}),fNe=()=>({type:"MOVE_RIGHT",payload:null}),pNe=()=>({type:"MOVE_LEFT",payload:null}),M4=()=>({type:"FLUSH",payload:null}),gNe=t=>({type:"DROP_ANIMATE",payload:t}),O4=t=>({type:"DROP_COMPLETE",payload:t}),Jse=t=>({type:"DROP",payload:t}),mNe=t=>({type:"DROP_PENDING",payload:t}),Zse=()=>({type:"DROP_ANIMATION_FINISHED",payload:null});var yNe=t=>({getState:e,dispatch:n})=>r=>i=>{if(!gn(i,"LIFT")){r(i);return}const{id:s,clientSelection:o,movementMode:a}=i.payload,l=e();l.phase==="DROP_ANIMATING"&&n(O4({completed:l.completed})),e().phase!=="IDLE"&&Le(),n(M4()),n(tNe({draggableId:s,movementMode:a}));const u={draggableId:s,scrollOptions:{shouldPublishImmediately:a==="SNAP"}},{critical:d,dimensions:h,viewport:f}=t.startPublishing(u);n(rNe({critical:d,dimensions:h,clientSelection:o,movementMode:a,viewport:f}))},vNe=t=>()=>e=>n=>{gn(n,"INITIAL_PUBLISH")&&t.dragging(),gn(n,"DROP_ANIMATE")&&t.dropping(n.payload.completed.result.reason),(gn(n,"FLUSH")||gn(n,"DROP_COMPLETE"))&&t.resting(),e(n)};const D4={outOfTheWay:"cubic-bezier(0.2, 0, 0, 1)",drop:"cubic-bezier(.2,1,.1,1)"},Hx={opacity:{drop:0,combining:.7},scale:{drop:.75}},Qse={outOfTheWay:.2,minDropTime:.33,maxDropTime:.55},dp=`${Qse.outOfTheWay}s ${D4.outOfTheWay}`,rx={fluid:`opacity ${dp}`,snap:`transform ${dp}, opacity ${dp}`,drop:t=>{const e=`${t}s ${D4.drop}`;return`transform ${e}, opacity ${e}`},outOfTheWay:`transform ${dp}`,placeholder:`height ${dp}, width ${dp}, margin ${dp}`},NW=t=>nf(t,_i)?void 0:`translate(${t.x}px, ${t.y}px)`,zF={moveTo:NW,drop:(t,e)=>{const n=NW(t);if(n)return e?`${n} scale(${Hx.scale.drop})`:n}},{minDropTime:UF,maxDropTime:eoe}=Qse,bNe=eoe-UF,jW=1500,xNe=.6;var wNe=({current:t,destination:e,reason:n})=>{const r=Bx(t,e);if(r<=0)return UF;if(r>=jW)return eoe;const i=r/jW,s=UF+bNe*i,o=n==="CANCEL"?s*xNe:s;return Number(o.toFixed(2))},SNe=({impact:t,draggable:e,dimensions:n,viewport:r,afterCritical:i})=>{const{draggables:s,droppables:o}=n,a=Pa(t),l=a?o[a]:null,c=o[e.descriptor.droppableId],u=qse({impact:t,draggable:e,draggables:s,afterCritical:i,droppable:l||c,viewport:r});return va(u,e.client.borderBox.center)},CNe=({draggables:t,reason:e,lastImpact:n,home:r,viewport:i,onLiftImpact:s})=>!n.at||e!=="DROP"?{impact:Kse({draggables:t,impact:s,destination:r,viewport:i,forceShouldAnimate:!0}),didDropInsideDroppable:!1}:n.at.type==="REORDER"?{impact:n,didDropInsideDroppable:!0}:{impact:{...n,displaced:zx},didDropInsideDroppable:!0};const ENe=({getState:t,dispatch:e})=>n=>r=>{if(!gn(r,"DROP")){n(r);return}const i=t(),s=r.payload.reason;if(i.phase==="COLLECTING"){e(mNe({reason:s}));return}if(i.phase==="IDLE")return;i.phase==="DROP_PENDING"&&i.isWaiting&&Le(),i.phase==="DRAGGING"||i.phase==="DROP_PENDING"||Le();const a=i.critical,l=i.dimensions,c=l.draggables[i.critical.draggable.id],{impact:u,didDropInsideDroppable:d}=CNe({reason:s,lastImpact:i.impact,afterCritical:i.afterCritical,onLiftImpact:i.onLiftImpact,home:i.dimensions.droppables[i.critical.droppable.id],viewport:i.viewport,draggables:i.dimensions.draggables}),h=d?T4(u):null,f=d?R_(u):null,y={index:a.draggable.index,droppableId:a.droppable.id},b={draggableId:c.descriptor.id,type:c.descriptor.type,source:y,reason:s,mode:i.movementMode,destination:h,combine:f},v=SNe({impact:u,draggable:c,dimensions:l,viewport:i.viewport,afterCritical:i.afterCritical}),x={critical:i.critical,afterCritical:i.afterCritical,result:b,impact:u};if(!(!nf(i.current.client.offset,v)||!!b.combine)){e(O4({completed:x}));return}const E=wNe({current:i.current.client.offset,destination:v,reason:s});e(gNe({newHomeClientOffset:v,dropDuration:E,completed:x}))};var toe=()=>({x:window.pageXOffset,y:window.pageYOffset});function TNe(t){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:e=>{e.target!==window&&e.target!==window.document||t()}}}function INe({onWindowScroll:t}){function e(){t(toe())}const n=$x(e),r=TNe(n);let i=tf;function s(){return i!==tf}function o(){s()&&Le(),i=wl(window,[r])}function a(){s()||Le(),n.cancel(),i(),i=tf}return{start:o,stop:a,isActive:s}}const PNe=t=>gn(t,"DROP_COMPLETE")||gn(t,"DROP_ANIMATE")||gn(t,"FLUSH"),_Ne=t=>{const e=INe({onWindowScroll:n=>{t.dispatch(cNe({newScroll:n}))}});return n=>r=>{!e.isActive()&&gn(r,"INITIAL_PUBLISH")&&e.start(),e.isActive()&&PNe(r)&&e.stop(),n(r)}};var kNe=t=>{let e=!1,n=!1;const r=setTimeout(()=>{n=!0}),i=s=>{e||n||(e=!0,t(s),clearTimeout(r))};return i.wasCalled=()=>e,i},ANe=()=>{const t=[],e=i=>{const s=t.findIndex(a=>a.timerId===i);s===-1&&Le();const[o]=t.splice(s,1);o.callback()};return{add:i=>{const s=setTimeout(()=>e(s)),o={timerId:s,callback:i};t.push(o)},flush:()=>{if(!t.length)return;const i=[...t];t.length=0,i.forEach(s=>{clearTimeout(s.timerId),s.callback()})}}};const MNe=(t,e)=>t==null&&e==null?!0:t==null||e==null?!1:t.droppableId===e.droppableId&&t.index===e.index,ONe=(t,e)=>t==null&&e==null?!0:t==null||e==null?!1:t.draggableId===e.draggableId&&t.droppableId===e.droppableId,DNe=(t,e)=>{if(t===e)return!0;const n=t.draggable.id===e.draggable.id&&t.draggable.droppableId===e.draggable.droppableId&&t.draggable.type===e.draggable.type&&t.draggable.index===e.draggable.index,r=t.droppable.id===e.droppable.id&&t.droppable.type===e.droppable.type;return n&&r},H0=(t,e)=>{e()},pC=(t,e)=>({draggableId:t.draggable.id,type:t.droppable.type,source:{droppableId:t.droppable.id,index:t.draggable.index},mode:e});function D2(t,e,n,r){if(!t){n(r(e));return}const i=kNe(n);t(e,{announce:i}),i.wasCalled()||n(r(e))}var RNe=(t,e)=>{const n=ANe();let r=null;const i=(d,h)=>{r&&Le(),H0("onBeforeCapture",()=>{const f=t().onBeforeCapture;f&&f({draggableId:d,mode:h})})},s=(d,h)=>{r&&Le(),H0("onBeforeDragStart",()=>{const f=t().onBeforeDragStart;f&&f(pC(d,h))})},o=(d,h)=>{r&&Le();const f=pC(d,h);r={mode:h,lastCritical:d,lastLocation:f.source,lastCombine:null},n.add(()=>{H0("onDragStart",()=>D2(t().onDragStart,f,e,zE.onDragStart))})},a=(d,h)=>{const f=T4(h),y=R_(h);r||Le();const b=!DNe(d,r.lastCritical);b&&(r.lastCritical=d);const v=!MNe(r.lastLocation,f);v&&(r.lastLocation=f);const x=!ONe(r.lastCombine,y);if(x&&(r.lastCombine=y),!b&&!v&&!x)return;const C={...pC(d,r.mode),combine:y,destination:f};n.add(()=>{H0("onDragUpdate",()=>D2(t().onDragUpdate,C,e,zE.onDragUpdate))})},l=()=>{r||Le(),n.flush()},c=d=>{r||Le(),r=null,H0("onDragEnd",()=>D2(t().onDragEnd,d,e,zE.onDragEnd))};return{beforeCapture:i,beforeStart:s,start:o,update:a,flush:l,drop:c,abort:()=>{if(!r)return;const d={...pC(r.lastCritical,r.mode),combine:null,destination:null,reason:"CANCEL"};c(d)}}},NNe=(t,e)=>{const n=RNe(t,e);return r=>i=>s=>{if(gn(s,"BEFORE_INITIAL_CAPTURE")){n.beforeCapture(s.payload.draggableId,s.payload.movementMode);return}if(gn(s,"INITIAL_PUBLISH")){const a=s.payload.critical;n.beforeStart(a,s.payload.movementMode),i(s),n.start(a,s.payload.movementMode);return}if(gn(s,"DROP_COMPLETE")){const a=s.payload.completed.result;n.flush(),i(s),n.drop(a);return}if(i(s),gn(s,"FLUSH")){n.abort();return}const o=r.getState();o.phase==="DRAGGING"&&n.update(o.critical,o.impact)}};const jNe=t=>e=>n=>{if(!gn(n,"DROP_ANIMATION_FINISHED")){e(n);return}const r=t.getState();r.phase!=="DROP_ANIMATING"&&Le(),t.dispatch(O4({completed:r.completed}))},LNe=t=>{let e=null,n=null;function r(){n&&(cancelAnimationFrame(n),n=null),e&&(e(),e=null)}return i=>s=>{if((gn(s,"FLUSH")||gn(s,"DROP_COMPLETE")||gn(s,"DROP_ANIMATION_FINISHED"))&&r(),i(s),!gn(s,"DROP_ANIMATE"))return;const o={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){t.getState().phase==="DROP_ANIMATING"&&t.dispatch(Zse())}};n=requestAnimationFrame(()=>{n=null,e=wl(window,[o])})}};var FNe=t=>()=>e=>n=>{(gn(n,"DROP_COMPLETE")||gn(n,"FLUSH")||gn(n,"DROP_ANIMATE"))&&t.stopPublishing(),e(n)},$Ne=t=>{let e=!1;return()=>n=>r=>{if(gn(r,"INITIAL_PUBLISH")){e=!0,t.tryRecordFocus(r.payload.critical.draggable.id),n(r),t.tryRestoreFocusRecorded();return}if(n(r),!!e){if(gn(r,"FLUSH")){e=!1,t.tryRestoreFocusRecorded();return}if(gn(r,"DROP_COMPLETE")){e=!1;const i=r.payload.completed.result;i.combine&&t.tryShiftRecord(i.draggableId,i.combine.draggableId),t.tryRestoreFocusRecorded()}}}};const BNe=t=>gn(t,"DROP_COMPLETE")||gn(t,"DROP_ANIMATE")||gn(t,"FLUSH");var zNe=t=>e=>n=>r=>{if(BNe(r)){t.stop(),n(r);return}if(gn(r,"INITIAL_PUBLISH")){n(r);const i=e.getState();i.phase!=="DRAGGING"&&Le(),t.start(i);return}n(r),t.scroll(e.getState())};const UNe=t=>e=>n=>{if(e(n),!gn(n,"PUBLISH_WHILE_DRAGGING"))return;const r=t.getState();r.phase==="DROP_PENDING"&&(r.isWaiting||t.dispatch(Jse({reason:r.reason})))},HNe=Fx;var VNe=({dimensionMarshal:t,focusMarshal:e,styleMarshal:n,getResponders:r,announce:i,autoScroller:s})=>b4(eNe,HNe(gse(vNe(n),FNe(t),yNe(t),ENe,jNe,LNe,UNe,zNe(s),_Ne,$Ne(e),NNe(r,i))));const R2=()=>({additions:{},removals:{},modified:{}});function WNe({registry:t,callbacks:e}){let n=R2(),r=null;const i=()=>{r||(e.collectionStarting(),r=requestAnimationFrame(()=>{r=null;const{additions:l,removals:c,modified:u}=n,d=Object.keys(l).map(y=>t.draggable.getById(y).getDimension(_i)).sort((y,b)=>y.descriptor.index-b.descriptor.index),h=Object.keys(u).map(y=>{const v=t.droppable.getById(y).callbacks.getScrollWhileDragging();return{droppableId:y,scroll:v}}),f={additions:d,removals:Object.keys(c),modified:h};n=R2(),e.publish(f)}))};return{add:l=>{const c=l.descriptor.id;n.additions[c]=l,n.modified[l.descriptor.droppableId]=!0,n.removals[c]&&delete n.removals[c],i()},remove:l=>{const c=l.descriptor;n.removals[c.id]=!0,n.modified[c.droppableId]=!0,n.additions[c.id]&&delete n.additions[c.id],i()},stop:()=>{r&&(cancelAnimationFrame(r),r=null,n=R2())}}}var noe=({scrollHeight:t,scrollWidth:e,height:n,width:r})=>{const i=va({x:e,y:t},{x:r,y:n});return{x:Math.max(0,i.x),y:Math.max(0,i.y)}},roe=()=>{const t=document.documentElement;return t||Le(),t},ioe=()=>{const t=roe();return noe({scrollHeight:t.scrollHeight,scrollWidth:t.scrollWidth,width:t.clientWidth,height:t.clientHeight})},KNe=()=>{const t=toe(),e=ioe(),n=t.y,r=t.x,i=roe(),s=i.clientWidth,o=i.clientHeight,a=r+s,l=n+o;return{frame:oc({top:n,left:r,right:a,bottom:l}),scroll:{initial:t,current:t,max:e,diff:{value:_i,displacement:_i}}}},qNe=({critical:t,scrollOptions:e,registry:n})=>{const r=KNe(),i=r.scroll.current,s=t.droppable,o=n.droppable.getAllByType(s.type).map(u=>u.callbacks.getDimensionAndWatchScroll(i,e)),a=n.draggable.getAllByType(t.draggable.type).map(u=>u.getDimension(i));return{dimensions:{draggables:Ose(a),droppables:Mse(o)},critical:t,viewport:r}};function LW(t,e,n){return!(n.descriptor.id===e.id||n.descriptor.type!==e.type||t.droppable.getById(n.descriptor.droppableId).descriptor.mode!=="virtual")}var GNe=(t,e)=>{let n=null;const r=WNe({callbacks:{publish:e.publishWhileDragging,collectionStarting:e.collectionStarting},registry:t}),i=(h,f)=>{t.droppable.exists(h)||Le(),n&&e.updateDroppableIsEnabled({id:h,isEnabled:f})},s=(h,f)=>{n&&(t.droppable.exists(h)||Le(),e.updateDroppableIsCombineEnabled({id:h,isCombineEnabled:f}))},o=(h,f)=>{n&&(t.droppable.exists(h)||Le(),e.updateDroppableScroll({id:h,newScroll:f}))},a=(h,f)=>{n&&t.droppable.getById(h).callbacks.scroll(f)},l=()=>{if(!n)return;r.stop();const h=n.critical.droppable;t.droppable.getAllByType(h.type).forEach(f=>f.callbacks.dragStopped()),n.unsubscribe(),n=null},c=h=>{n||Le();const f=n.critical.draggable;h.type==="ADDITION"&&LW(t,f,h.value)&&r.add(h.value),h.type==="REMOVAL"&&LW(t,f,h.value)&&r.remove(h.value)};return{updateDroppableIsEnabled:i,updateDroppableIsCombineEnabled:s,scrollDroppable:a,updateDroppableScroll:o,startPublishing:h=>{n&&Le();const f=t.draggable.getById(h.draggableId),y=t.droppable.getById(f.descriptor.droppableId),b={draggable:f.descriptor,droppable:y.descriptor},v=t.subscribe(c);return n={critical:b,unsubscribe:v},qNe({critical:b,registry:t,scrollOptions:h.scrollOptions})},stopPublishing:l}},soe=(t,e)=>t.phase==="IDLE"?!0:t.phase!=="DROP_ANIMATING"||t.completed.result.draggableId===e?!1:t.completed.result.reason==="DROP",YNe=t=>{window.scrollBy(t.x,t.y)};const XNe=Ti(t=>D_(t).filter(e=>!(!e.isEnabled||!e.frame))),JNe=(t,e)=>XNe(e).find(r=>(r.frame||Le(),Use(r.frame.pageMarginBox)(t)))||null;var ZNe=({center:t,destination:e,droppables:n})=>{if(e){const i=n[e];return i.frame?i:null}return JNe(t,n)};const Vx={startFromPercentage:.25,maxScrollAtPercentage:.05,maxPixelScroll:28,ease:t=>t**2,durationDampening:{stopDampeningAt:1200,accelerateAt:360},disabled:!1};var QNe=(t,e,n=()=>Vx)=>{const r=n(),i=t[e.size]*r.startFromPercentage,s=t[e.size]*r.maxScrollAtPercentage;return{startScrollingFrom:i,maxScrollValueAt:s}},ooe=({startOfRange:t,endOfRange:e,current:n})=>{const r=e-t;return r===0?0:(n-t)/r},R4=1,eje=(t,e,n=()=>Vx)=>{const r=n();if(t>e.startScrollingFrom)return 0;if(t<=e.maxScrollValueAt)return r.maxPixelScroll;if(t===e.startScrollingFrom)return R4;const s=1-ooe({startOfRange:e.maxScrollValueAt,endOfRange:e.startScrollingFrom,current:t}),o=r.maxPixelScroll*r.ease(s);return Math.ceil(o)},tje=(t,e,n)=>{const r=n(),i=r.durationDampening.accelerateAt,s=r.durationDampening.stopDampeningAt,o=e,a=s,c=Date.now()-o;if(c>=s)return t;if(c<i)return R4;const u=ooe({startOfRange:i,endOfRange:a,current:c}),d=t*r.ease(u);return Math.ceil(d)},FW=({distanceToEdge:t,thresholds:e,dragStartTime:n,shouldUseTimeDampening:r,getAutoScrollerOptions:i})=>{const s=eje(t,e,i);return s===0?0:r?Math.max(tje(s,n,i),R4):s},$W=({container:t,distanceToEdges:e,dragStartTime:n,axis:r,shouldUseTimeDampening:i,getAutoScrollerOptions:s})=>{const o=QNe(t,r,s);return e[r.end]<e[r.start]?FW({distanceToEdge:e[r.end],thresholds:o,dragStartTime:n,shouldUseTimeDampening:i,getAutoScrollerOptions:s}):-1*FW({distanceToEdge:e[r.start],thresholds:o,dragStartTime:n,shouldUseTimeDampening:i,getAutoScrollerOptions:s})},nje=({container:t,subject:e,proposedScroll:n})=>{const r=e.height>t.height,i=e.width>t.width;return!i&&!r?n:i&&r?null:{x:i?0:n.x,y:r?0:n.y}};const rje=Ase(t=>t===0?0:t);var aoe=({dragStartTime:t,container:e,subject:n,center:r,shouldUseTimeDampening:i,getAutoScrollerOptions:s})=>{const o={top:r.y-e.top,right:e.right-r.x,bottom:e.bottom-r.y,left:r.x-e.left},a=$W({container:e,distanceToEdges:o,dragStartTime:t,axis:I4,shouldUseTimeDampening:i,getAutoScrollerOptions:s}),l=$W({container:e,distanceToEdges:o,dragStartTime:t,axis:Nse,shouldUseTimeDampening:i,getAutoScrollerOptions:s}),c=rje({x:l,y:a});if(nf(c,_i))return null;const u=nje({container:e,subject:n,proposedScroll:c});return u?nf(u,_i)?null:u:null};const ije=Ase(t=>t===0?0:t>0?1:-1),N4=(()=>{const t=(e,n)=>e<0?e:e>n?e-n:0;return({current:e,max:n,change:r})=>{const i=ns(e,r),s={x:t(i.x,n.x),y:t(i.y,n.y)};return nf(s,_i)?null:s}})(),loe=({max:t,current:e,change:n})=>{const r={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)},i=ije(n),s=N4({max:r,current:e,change:i});return!s||i.x!==0&&s.x===0||i.y!==0&&s.y===0},j4=(t,e)=>loe({current:t.scroll.current,max:t.scroll.max,change:e}),sje=(t,e)=>{if(!j4(t,e))return null;const n=t.scroll.max,r=t.scroll.current;return N4({current:r,max:n,change:e})},L4=(t,e)=>{const n=t.frame;return n?loe({current:n.scroll.current,max:n.scroll.max,change:e}):!1},oje=(t,e)=>{const n=t.frame;return!n||!L4(t,e)?null:N4({current:n.scroll.current,max:n.scroll.max,change:e})};var aje=({viewport:t,subject:e,center:n,dragStartTime:r,shouldUseTimeDampening:i,getAutoScrollerOptions:s})=>{const o=aoe({dragStartTime:r,container:t.frame,subject:e,center:n,shouldUseTimeDampening:i,getAutoScrollerOptions:s});return o&&j4(t,o)?o:null},lje=({droppable:t,subject:e,center:n,dragStartTime:r,shouldUseTimeDampening:i,getAutoScrollerOptions:s})=>{const o=t.frame;if(!o)return null;const a=aoe({dragStartTime:r,container:o.pageMarginBox,subject:e,center:n,shouldUseTimeDampening:i,getAutoScrollerOptions:s});return a&&L4(t,a)?a:null},BW=({state:t,dragStartTime:e,shouldUseTimeDampening:n,scrollWindow:r,scrollDroppable:i,getAutoScrollerOptions:s})=>{const o=t.current.page.borderBoxCenter,l=t.dimensions.draggables[t.critical.draggable.id].page.marginBox;if(t.isWindowScrollAllowed){const d=t.viewport,h=aje({dragStartTime:e,viewport:d,subject:l,center:o,shouldUseTimeDampening:n,getAutoScrollerOptions:s});if(h){r(h);return}}const c=ZNe({center:o,destination:Pa(t.impact),droppables:t.dimensions.droppables});if(!c)return;const u=lje({dragStartTime:e,droppable:c,subject:l,center:o,shouldUseTimeDampening:n,getAutoScrollerOptions:s});u&&i(c.descriptor.id,u)},cje=({scrollWindow:t,scrollDroppable:e,getAutoScrollerOptions:n=()=>Vx})=>{const r=$x(t),i=$x(e);let s=null;const o=c=>{s||Le();const{shouldUseTimeDampening:u,dragStartTime:d}=s;BW({state:c,scrollWindow:r,scrollDroppable:i,dragStartTime:d,shouldUseTimeDampening:u,getAutoScrollerOptions:n})};return{start:c=>{s&&Le();const u=Date.now();let d=!1;const h=()=>{d=!0};BW({state:c,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:h,scrollDroppable:h,getAutoScrollerOptions:n}),s={dragStartTime:u,shouldUseTimeDampening:d},d&&o(c)},stop:()=>{s&&(r.cancel(),i.cancel(),s=null)},scroll:o}},uje=({move:t,scrollDroppable:e,scrollWindow:n})=>{const r=(a,l)=>{const c=ns(a.current.client.selection,l);t({client:c})},i=(a,l)=>{if(!L4(a,l))return l;const c=oje(a,l);if(!c)return e(a.descriptor.id,l),null;const u=va(l,c);return e(a.descriptor.id,u),va(l,u)},s=(a,l,c)=>{if(!a||!j4(l,c))return c;const u=sje(l,c);if(!u)return n(c),null;const d=va(c,u);return n(d),va(c,d)};return a=>{const l=a.scrollJumpRequest;if(!l)return;const c=Pa(a.impact);c||Le();const u=i(a.dimensions.droppables[c],l);if(!u)return;const d=a.viewport,h=s(a.isWindowScrollAllowed,d,u);h&&r(a,h)}},dje=({scrollDroppable:t,scrollWindow:e,move:n,getAutoScrollerOptions:r})=>{const i=cje({scrollWindow:e,scrollDroppable:t,getAutoScrollerOptions:r}),s=uje({move:n,scrollWindow:e,scrollDroppable:t});return{scroll:l=>{if(!(r().disabled||l.phase!=="DRAGGING")){if(l.movementMode==="FLUID"){i.scroll(l);return}l.scrollJumpRequest&&s(l)}},start:i.start,stop:i.stop}};const _y="data-rfd",ky=(()=>{const t=`${_y}-drag-handle`;return{base:t,draggableId:`${t}-draggable-id`,contextId:`${t}-context-id`}})(),HF=(()=>{const t=`${_y}-draggable`;return{base:t,contextId:`${t}-context-id`,id:`${t}-id`}})(),hje=(()=>{const t=`${_y}-droppable`;return{base:t,contextId:`${t}-context-id`,id:`${t}-id`}})(),zW={contextId:`${_y}-scroll-container-context-id`},fje=t=>e=>`[${e}="${t}"]`,V0=(t,e)=>t.map(n=>{const r=n.styles[e];return r?`${n.selector} { ${r} }`:""}).join(" "),pje="pointer-events: none;";var gje=t=>{const e=fje(t),n=(()=>{const a=`
      cursor: -webkit-grab;
      cursor: grab;
    `;return{selector:e(ky.contextId),styles:{always:`
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: rgba(0,0,0,0);
          touch-action: manipulation;
        `,resting:a,dragging:pje,dropAnimating:a}}})(),r=(()=>{const a=`
      transition: ${rx.outOfTheWay};
    `;return{selector:e(HF.contextId),styles:{dragging:a,dropAnimating:a,userCancel:a}}})(),i={selector:e(hje.contextId),styles:{always:"overflow-anchor: none;"}},o=[r,n,i,{selector:"body",styles:{dragging:`
        cursor: grabbing;
        cursor: -webkit-grabbing;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        overflow-anchor: none;
      `}}];return{always:V0(o,"always"),resting:V0(o,"resting"),dragging:V0(o,"dragging"),dropAnimating:V0(o,"dropAnimating"),userCancel:V0(o,"userCancel")}};const _a=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?S.useLayoutEffect:S.useEffect,N2=()=>{const t=document.querySelector("head");return t||Le(),t},UW=t=>{const e=document.createElement("style");return t&&e.setAttribute("nonce",t),e.type="text/css",e};function mje(t,e){const n=en(()=>gje(t),[t]),r=S.useRef(null),i=S.useRef(null),s=ct(Ti(d=>{const h=i.current;h||Le(),h.textContent=d}),[]),o=ct(d=>{const h=r.current;h||Le(),h.textContent=d},[]);_a(()=>{!r.current&&!i.current||Le();const d=UW(e),h=UW(e);return r.current=d,i.current=h,d.setAttribute(`${_y}-always`,t),h.setAttribute(`${_y}-dynamic`,t),N2().appendChild(d),N2().appendChild(h),o(n.always),s(n.resting),()=>{const f=y=>{const b=y.current;b||Le(),N2().removeChild(b),y.current=null};f(r),f(i)}},[e,o,s,n.always,n.resting,t]);const a=ct(()=>s(n.dragging),[s,n.dragging]),l=ct(d=>{if(d==="DROP"){s(n.dropAnimating);return}s(n.userCancel)},[s,n.dropAnimating,n.userCancel]),c=ct(()=>{i.current&&s(n.resting)},[s,n.resting]);return en(()=>({dragging:a,dropping:l,resting:c}),[a,l,c])}function coe(t,e){return Array.from(t.querySelectorAll(e))}var uoe=t=>t&&t.ownerDocument&&t.ownerDocument.defaultView?t.ownerDocument.defaultView:window;function L_(t){return t instanceof uoe(t).HTMLElement}function yje(t,e){const n=`[${ky.contextId}="${t}"]`,r=coe(document,n);if(!r.length)return null;const i=r.find(s=>s.getAttribute(ky.draggableId)===e);return!i||!L_(i)?null:i}function vje(t){const e=S.useRef({}),n=S.useRef(null),r=S.useRef(null),i=S.useRef(!1),s=ct(function(h,f){const y={id:h,focus:f};return e.current[h]=y,function(){const v=e.current;v[h]!==y&&delete v[h]}},[]),o=ct(function(h){const f=yje(t,h);f&&f!==document.activeElement&&f.focus()},[t]),a=ct(function(h,f){n.current===h&&(n.current=f)},[]),l=ct(function(){r.current||i.current&&(r.current=requestAnimationFrame(()=>{r.current=null;const h=n.current;h&&o(h)}))},[o]),c=ct(function(h){n.current=null;const f=document.activeElement;f&&f.getAttribute(ky.draggableId)===h&&(n.current=h)},[]);return _a(()=>(i.current=!0,function(){i.current=!1;const h=r.current;h&&cancelAnimationFrame(h)}),[]),en(()=>({register:s,tryRecordFocus:c,tryRestoreFocusRecorded:l,tryShiftRecord:a}),[s,c,l,a])}function bje(){const t={draggables:{},droppables:{}},e=[];function n(d){return e.push(d),function(){const f=e.indexOf(d);f!==-1&&e.splice(f,1)}}function r(d){e.length&&e.forEach(h=>h(d))}function i(d){return t.draggables[d]||null}function s(d){const h=i(d);return h||Le(),h}const o={register:d=>{t.draggables[d.descriptor.id]=d,r({type:"ADDITION",value:d})},update:(d,h)=>{const f=t.draggables[h.descriptor.id];f&&f.uniqueId===d.uniqueId&&(delete t.draggables[h.descriptor.id],t.draggables[d.descriptor.id]=d)},unregister:d=>{const h=d.descriptor.id,f=i(h);f&&d.uniqueId===f.uniqueId&&(delete t.draggables[h],t.droppables[d.descriptor.droppableId]&&r({type:"REMOVAL",value:d}))},getById:s,findById:i,exists:d=>!!i(d),getAllByType:d=>Object.values(t.draggables).filter(h=>h.descriptor.type===d)};function a(d){return t.droppables[d]||null}function l(d){const h=a(d);return h||Le(),h}const c={register:d=>{t.droppables[d.descriptor.id]=d},unregister:d=>{const h=a(d.descriptor.id);h&&d.uniqueId===h.uniqueId&&delete t.droppables[d.descriptor.id]},getById:l,findById:a,exists:d=>!!a(d),getAllByType:d=>Object.values(t.droppables).filter(h=>h.descriptor.type===d)};function u(){t.draggables={},t.droppables={},e.length=0}return{draggable:o,droppable:c,subscribe:n,clean:u}}function xje(){const t=en(bje,[]);return S.useEffect(()=>function(){t.clean()},[t]),t}var F4=$e.createContext(null),GT=()=>{const t=document.body;return t||Le(),t};const wje={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},Sje=t=>`rfd-announcement-${t}`;function Cje(t){const e=en(()=>Sje(t),[t]),n=S.useRef(null);return S.useEffect(function(){const s=document.createElement("div");return n.current=s,s.id=e,s.setAttribute("aria-live","assertive"),s.setAttribute("aria-atomic","true"),VT(s.style,wje),GT().appendChild(s),function(){setTimeout(function(){const l=GT();l.contains(s)&&l.removeChild(s),s===n.current&&(n.current=null)})}},[e]),ct(i=>{const s=n.current;if(s){s.textContent=i;return}},[])}const Eje={separator:"::"};function $4(t,e=Eje){const n=$e.useId();return en(()=>`${t}${e.separator}${n}`,[e.separator,t,n])}function Tje({contextId:t,uniqueId:e}){return`rfd-hidden-text-${t}-${e}`}function Ije({contextId:t,text:e}){const n=$4("hidden-text",{separator:"-"}),r=en(()=>Tje({contextId:t,uniqueId:n}),[n,t]);return S.useEffect(function(){const s=document.createElement("div");return s.id=r,s.textContent=e,s.style.display="none",GT().appendChild(s),function(){const a=GT();a.contains(s)&&a.removeChild(s)}},[r,e]),r}var F_=$e.createContext(null);function doe(t){const e=S.useRef(t);return S.useEffect(()=>{e.current=t}),e}function Pje(){let t=null;function e(){return!!t}function n(o){return o===t}function r(o){t&&Le();const a={abandon:o};return t=a,a}function i(){t||Le(),t=null}function s(){t&&(t.abandon(),i())}return{isClaimed:e,isActive:n,claim:r,release:i,tryAbandon:s}}function Wx(t){return t.phase==="IDLE"||t.phase==="DROP_ANIMATING"?!1:t.isDragging}const _je=9,kje=13,B4=27,hoe=32,Aje=33,Mje=34,Oje=35,Dje=36,Rje=37,Nje=38,jje=39,Lje=40,Fje={[kje]:!0,[_je]:!0};var foe=t=>{Fje[t.keyCode]&&t.preventDefault()};const $_=(()=>{const t="visibilitychange";return typeof document>"u"?t:[t,`ms${t}`,`webkit${t}`,`moz${t}`,`o${t}`].find(r=>`on${r}`in document)||t})(),poe=0,HW=5;function $je(t,e){return Math.abs(e.x-t.x)>=HW||Math.abs(e.y-t.y)>=HW}const VW={type:"IDLE"};function Bje({cancel:t,completed:e,getPhase:n,setPhase:r}){return[{eventName:"mousemove",fn:i=>{const{button:s,clientX:o,clientY:a}=i;if(s!==poe)return;const l={x:o,y:a},c=n();if(c.type==="DRAGGING"){i.preventDefault(),c.actions.move(l);return}c.type!=="PENDING"&&Le();const u=c.point;if(!$je(u,l))return;i.preventDefault();const d=c.actions.fluidLift(l);r({type:"DRAGGING",actions:d})}},{eventName:"mouseup",fn:i=>{const s=n();if(s.type!=="DRAGGING"){t();return}i.preventDefault(),s.actions.drop({shouldBlockNextClick:!0}),e()}},{eventName:"mousedown",fn:i=>{n().type==="DRAGGING"&&i.preventDefault(),t()}},{eventName:"keydown",fn:i=>{if(n().type==="PENDING"){t();return}if(i.keyCode===B4){i.preventDefault(),t();return}foe(i)}},{eventName:"resize",fn:t},{eventName:"scroll",options:{passive:!0,capture:!1},fn:()=>{n().type==="PENDING"&&t()}},{eventName:"webkitmouseforcedown",fn:i=>{const s=n();if(s.type==="IDLE"&&Le(),s.actions.shouldRespectForcePress()){t();return}i.preventDefault()}},{eventName:$_,fn:t}]}function zje(t){const e=S.useRef(VW),n=S.useRef(tf),r=en(()=>({eventName:"mousedown",fn:function(d){if(d.defaultPrevented||d.button!==poe||d.ctrlKey||d.metaKey||d.shiftKey||d.altKey)return;const h=t.findClosestDraggableId(d);if(!h)return;const f=t.tryGetLock(h,o,{sourceEvent:d});if(!f)return;d.preventDefault();const y={x:d.clientX,y:d.clientY};n.current(),c(f,y)}}),[t]),i=en(()=>({eventName:"webkitmouseforcewillbegin",fn:u=>{if(u.defaultPrevented)return;const d=t.findClosestDraggableId(u);if(!d)return;const h=t.findOptionsForDraggable(d);h&&(h.shouldRespectForcePress||t.canGetLock(d)&&u.preventDefault())}}),[t]),s=ct(function(){const d={passive:!1,capture:!0};n.current=wl(window,[i,r],d)},[i,r]),o=ct(()=>{e.current.type!=="IDLE"&&(e.current=VW,n.current(),s())},[s]),a=ct(()=>{const u=e.current;o(),u.type==="DRAGGING"&&u.actions.cancel({shouldBlockNextClick:!0}),u.type==="PENDING"&&u.actions.abort()},[o]),l=ct(function(){const d={capture:!0,passive:!1},h=Bje({cancel:a,completed:o,getPhase:()=>e.current,setPhase:f=>{e.current=f}});n.current=wl(window,h,d)},[a,o]),c=ct(function(d,h){e.current.type!=="IDLE"&&Le(),e.current={type:"PENDING",point:h,actions:d},l()},[l]);_a(function(){return s(),function(){n.current()}},[s])}function Uje(){}const Hje={[Mje]:!0,[Aje]:!0,[Dje]:!0,[Oje]:!0};function Vje(t,e){function n(){e(),t.cancel()}function r(){e(),t.drop()}return[{eventName:"keydown",fn:i=>{if(i.keyCode===B4){i.preventDefault(),n();return}if(i.keyCode===hoe){i.preventDefault(),r();return}if(i.keyCode===Lje){i.preventDefault(),t.moveDown();return}if(i.keyCode===Nje){i.preventDefault(),t.moveUp();return}if(i.keyCode===jje){i.preventDefault(),t.moveRight();return}if(i.keyCode===Rje){i.preventDefault(),t.moveLeft();return}if(Hje[i.keyCode]){i.preventDefault();return}foe(i)}},{eventName:"mousedown",fn:n},{eventName:"mouseup",fn:n},{eventName:"click",fn:n},{eventName:"touchstart",fn:n},{eventName:"resize",fn:n},{eventName:"wheel",fn:n,options:{passive:!0}},{eventName:$_,fn:n}]}function Wje(t){const e=S.useRef(Uje),n=en(()=>({eventName:"keydown",fn:function(s){if(s.defaultPrevented||s.keyCode!==hoe)return;const o=t.findClosestDraggableId(s);if(!o)return;const a=t.tryGetLock(o,u,{sourceEvent:s});if(!a)return;s.preventDefault();let l=!0;const c=a.snapLift();e.current();function u(){l||Le(),l=!1,e.current(),r()}e.current=wl(window,Vje(c,u),{capture:!0,passive:!1})}}),[t]),r=ct(function(){const s={passive:!1,capture:!0};e.current=wl(window,[n],s)},[n]);_a(function(){return r(),function(){e.current()}},[r])}const j2={type:"IDLE"},Kje=120,qje=.15;function Gje({cancel:t,getPhase:e}){return[{eventName:"orientationchange",fn:t},{eventName:"resize",fn:t},{eventName:"contextmenu",fn:n=>{n.preventDefault()}},{eventName:"keydown",fn:n=>{if(e().type!=="DRAGGING"){t();return}n.keyCode===B4&&n.preventDefault(),t()}},{eventName:$_,fn:t}]}function Yje({cancel:t,completed:e,getPhase:n}){return[{eventName:"touchmove",options:{capture:!1},fn:r=>{const i=n();if(i.type!=="DRAGGING"){t();return}i.hasMoved=!0;const{clientX:s,clientY:o}=r.touches[0],a={x:s,y:o};r.preventDefault(),i.actions.move(a)}},{eventName:"touchend",fn:r=>{const i=n();if(i.type!=="DRAGGING"){t();return}r.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),e()}},{eventName:"touchcancel",fn:r=>{if(n().type!=="DRAGGING"){t();return}r.preventDefault(),t()}},{eventName:"touchforcechange",fn:r=>{const i=n();i.type==="IDLE"&&Le();const s=r.touches[0];if(!s||!(s.force>=qje))return;const a=i.actions.shouldRespectForcePress();if(i.type==="PENDING"){a&&t();return}if(a){if(i.hasMoved){r.preventDefault();return}t();return}r.preventDefault()}},{eventName:$_,fn:t}]}function Xje(t){const e=S.useRef(j2),n=S.useRef(tf),r=ct(function(){return e.current},[]),i=ct(function(f){e.current=f},[]),s=en(()=>({eventName:"touchstart",fn:function(f){if(f.defaultPrevented)return;const y=t.findClosestDraggableId(f);if(!y)return;const b=t.tryGetLock(y,a,{sourceEvent:f});if(!b)return;const v=f.touches[0],{clientX:x,clientY:C}=v,E={x,y:C};n.current(),d(b,E)}}),[t]),o=ct(function(){const f={capture:!0,passive:!1};n.current=wl(window,[s],f)},[s]),a=ct(()=>{const h=e.current;h.type!=="IDLE"&&(h.type==="PENDING"&&clearTimeout(h.longPressTimerId),i(j2),n.current(),o())},[o,i]),l=ct(()=>{const h=e.current;a(),h.type==="DRAGGING"&&h.actions.cancel({shouldBlockNextClick:!0}),h.type==="PENDING"&&h.actions.abort()},[a]),c=ct(function(){const f={capture:!0,passive:!1},y={cancel:l,completed:a,getPhase:r},b=wl(window,Yje(y),f),v=wl(window,Gje(y),f);n.current=function(){b(),v()}},[l,r,a]),u=ct(function(){const f=r();f.type!=="PENDING"&&Le();const y=f.actions.fluidLift(f.point);i({type:"DRAGGING",actions:y,hasMoved:!1})},[r,i]),d=ct(function(f,y){r().type!=="IDLE"&&Le();const b=setTimeout(u,Kje);i({type:"PENDING",point:y,actions:f,longPressTimerId:b}),c()},[c,r,i,u]);_a(function(){return o(),function(){n.current();const y=r();y.type==="PENDING"&&(clearTimeout(y.longPressTimerId),i(j2))}},[r,o,i]),_a(function(){return wl(window,[{eventName:"touchmove",fn:()=>{},options:{capture:!1,passive:!1}}])},[])}const Jje=["input","button","textarea","select","option","optgroup","video","audio"];function goe(t,e){if(e==null)return!1;if(Jje.includes(e.tagName.toLowerCase()))return!0;const r=e.getAttribute("contenteditable");return r==="true"||r===""?!0:e===t?!1:goe(t,e.parentElement)}function Zje(t,e){const n=e.target;return L_(n)?goe(t,n):!1}var Qje=t=>oc(t.getBoundingClientRect()).center;function eLe(t){return t instanceof uoe(t).Element}const tLe=(()=>{const t="matches";return typeof document>"u"?t:[t,"msMatchesSelector","webkitMatchesSelector"].find(r=>r in Element.prototype)||t})();function moe(t,e){return t==null?null:t[tLe](e)?t:moe(t.parentElement,e)}function nLe(t,e){return t.closest?t.closest(e):moe(t,e)}function rLe(t){return`[${ky.contextId}="${t}"]`}function iLe(t,e){const n=e.target;if(!eLe(n))return null;const r=rLe(t),i=nLe(n,r);return!i||!L_(i)?null:i}function sLe(t,e){const n=iLe(t,e);return n?n.getAttribute(ky.draggableId):null}function oLe(t,e){const n=`[${HF.contextId}="${t}"]`,i=coe(document,n).find(s=>s.getAttribute(HF.id)===e);return!i||!L_(i)?null:i}function aLe(t){t.preventDefault()}function gC({expected:t,phase:e,isLockActive:n,shouldWarn:r}){return!(!n()||t!==e)}function yoe({lockAPI:t,store:e,registry:n,draggableId:r}){if(t.isClaimed())return!1;const i=n.draggable.findById(r);return!(!i||!i.options.isEnabled||!soe(e.getState(),r))}function lLe({lockAPI:t,contextId:e,store:n,registry:r,draggableId:i,forceSensorStop:s,sourceEvent:o}){if(!yoe({lockAPI:t,store:n,registry:r,draggableId:i}))return null;const l=r.draggable.getById(i),c=oLe(e,l.descriptor.id);if(!c||o&&!l.options.canDragInteractiveElements&&Zje(c,o))return null;const u=t.claim(s||tf);let d="PRE_DRAG";function h(){return l.options.shouldRespectForcePress}function f(){return t.isActive(u)}function y(P,_){gC({expected:P,phase:d,isLockActive:f,shouldWarn:!0})&&n.dispatch(_())}const b=y.bind(null,"DRAGGING");function v(P){function _(){t.release(),d="COMPLETED"}d!=="PRE_DRAG"&&(_(),Le()),n.dispatch(nNe(P.liftActionArgs)),d="DRAGGING";function A(D,L={shouldBlockNextClick:!1}){if(P.cleanup(),L.shouldBlockNextClick){const z=wl(window,[{eventName:"click",fn:aLe,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(z)}_(),n.dispatch(Jse({reason:D}))}return{isActive:()=>gC({expected:"DRAGGING",phase:d,isLockActive:f,shouldWarn:!1}),shouldRespectForcePress:h,drop:D=>A("DROP",D),cancel:D=>A("CANCEL",D),...P.actions}}function x(P){const _=$x(D=>{b(()=>Xse({client:D}))});return{...v({liftActionArgs:{id:i,clientSelection:P,movementMode:"FLUID"},cleanup:()=>_.cancel(),actions:{move:_}}),move:_}}function C(){const P={moveUp:()=>b(dNe),moveRight:()=>b(fNe),moveDown:()=>b(hNe),moveLeft:()=>b(pNe)};return v({liftActionArgs:{id:i,clientSelection:Qje(c),movementMode:"SNAP"},cleanup:tf,actions:P})}function E(){gC({expected:"PRE_DRAG",phase:d,isLockActive:f,shouldWarn:!0})&&t.release()}return{isActive:()=>gC({expected:"PRE_DRAG",phase:d,isLockActive:f,shouldWarn:!1}),shouldRespectForcePress:h,fluidLift:x,snapLift:C,abort:E}}const cLe=[zje,Wje,Xje];function uLe({contextId:t,store:e,registry:n,customSensors:r,enableDefaultSensors:i}){const s=[...i?cLe:[],...r||[]],o=S.useState(()=>Pje())[0],a=ct(function(v,x){Wx(v)&&!Wx(x)&&o.tryAbandon()},[o]);_a(function(){let v=e.getState();return e.subscribe(()=>{const C=e.getState();a(v,C),v=C})},[o,e,a]),_a(()=>o.tryAbandon,[o.tryAbandon]);const l=ct(b=>yoe({lockAPI:o,registry:n,store:e,draggableId:b}),[o,n,e]),c=ct((b,v,x)=>lLe({lockAPI:o,registry:n,contextId:t,store:e,draggableId:b,forceSensorStop:v||null,sourceEvent:x&&x.sourceEvent?x.sourceEvent:null}),[t,o,n,e]),u=ct(b=>sLe(t,b),[t]),d=ct(b=>{const v=n.draggable.findById(b);return v?v.options:null},[n.draggable]),h=ct(function(){o.isClaimed()&&(o.tryAbandon(),e.getState().phase!=="IDLE"&&e.dispatch(M4()))},[o,e]),f=ct(()=>o.isClaimed(),[o]),y=en(()=>({canGetLock:l,tryGetLock:c,findClosestDraggableId:u,findOptionsForDraggable:d,tryReleaseLock:h,isLockClaimed:f}),[l,c,u,d,h,f]);for(let b=0;b<s.length;b++)s[b](y)}const dLe=t=>({onBeforeCapture:e=>{const n=()=>{t.onBeforeCapture&&t.onBeforeCapture(e)};_c.flushSync(n)},onBeforeDragStart:t.onBeforeDragStart,onDragStart:t.onDragStart,onDragEnd:t.onDragEnd,onDragUpdate:t.onDragUpdate}),hLe=t=>({...Vx,...t.autoScrollerOptions,durationDampening:{...Vx.durationDampening,...t.autoScrollerOptions}});function W0(t){return t.current||Le(),t.current}function fLe(t){const{contextId:e,setCallbacks:n,sensors:r,nonce:i,dragHandleUsageInstructions:s}=t,o=S.useRef(null),a=doe(t),l=ct(()=>dLe(a.current),[a]),c=ct(()=>hLe(a.current),[a]),u=Cje(e),d=Ije({contextId:e,text:s}),h=mje(e,i),f=ct(z=>{W0(o).dispatch(z)},[]),y=en(()=>mW({publishWhileDragging:iNe,updateDroppableScroll:oNe,updateDroppableIsEnabled:aNe,updateDroppableIsCombineEnabled:lNe,collectionStarting:sNe},f),[f]),b=xje(),v=en(()=>GNe(b,y),[b,y]),x=en(()=>dje({scrollWindow:YNe,scrollDroppable:v.scrollDroppable,getAutoScrollerOptions:c,...mW({move:Xse},f)}),[v.scrollDroppable,f,c]),C=vje(e),E=en(()=>VNe({announce:u,autoScroller:x,dimensionMarshal:v,focusMarshal:C,getResponders:l,styleMarshal:h}),[u,x,v,C,l,h]);o.current=E;const I=ct(()=>{const z=W0(o);z.getState().phase!=="IDLE"&&z.dispatch(M4())},[]),P=ct(()=>{const z=W0(o).getState();return z.phase==="DROP_ANIMATING"?!0:z.phase==="IDLE"?!1:z.isDragging},[]),_=en(()=>({isDragging:P,tryAbort:I}),[P,I]);n(_);const A=ct(z=>soe(W0(o).getState(),z),[]),D=ct(()=>gp(W0(o).getState()),[]),L=en(()=>({marshal:v,focus:C,contextId:e,canLift:A,isMovementAllowed:D,dragHandleUsageInstructionsId:d,registry:b}),[e,v,d,C,A,D,b]);return uLe({contextId:e,store:E,registry:b,customSensors:r||null,enableDefaultSensors:t.enableDefaultSensors!==!1}),S.useEffect(()=>I,[I]),$e.createElement(F_.Provider,{value:L},$e.createElement(Cse,{context:F4,store:E},t.children))}function pLe(){return $e.useId()}function voe(t){const e=pLe(),n=t.dragHandleUsageInstructions||zE.dragHandleUsageInstructions;return $e.createElement(WDe,null,r=>$e.createElement(fLe,{nonce:t.nonce,contextId:e,setCallbacks:r,dragHandleUsageInstructions:n,enableDefaultSensors:t.enableDefaultSensors,sensors:t.sensors,onBeforeCapture:t.onBeforeCapture,onBeforeDragStart:t.onBeforeDragStart,onDragStart:t.onDragStart,onDragUpdate:t.onDragUpdate,onDragEnd:t.onDragEnd,autoScrollerOptions:t.autoScrollerOptions},t.children))}const WW={dragging:5e3,dropAnimating:4500},gLe=(t,e)=>e?rx.drop(e.duration):t?rx.snap:rx.fluid,mLe=(t,e)=>{if(t)return e?Hx.opacity.drop:Hx.opacity.combining},yLe=t=>t.forceShouldAnimate!=null?t.forceShouldAnimate:t.mode==="SNAP";function vLe(t){const n=t.dimension.client,{offset:r,combineWith:i,dropping:s}=t,o=!!i,a=yLe(t),l=!!s,c=l?zF.drop(r,o):zF.moveTo(r);return{position:"fixed",top:n.marginBox.top,left:n.marginBox.left,boxSizing:"border-box",width:n.borderBox.width,height:n.borderBox.height,transition:gLe(a,s),transform:c,opacity:mLe(o,l),zIndex:l?WW.dropAnimating:WW.dragging,pointerEvents:"none"}}function bLe(t){return{transform:zF.moveTo(t.offset),transition:t.shouldAnimateDisplacement?void 0:"none"}}function xLe(t){return t.type==="DRAGGING"?vLe(t):bLe(t)}function wLe(t,e,n=_i){const r=window.getComputedStyle(e),i=e.getBoundingClientRect(),s=Ese(i,r),o=HT(s,n),a={client:s,tagName:e.tagName.toLowerCase(),display:r.display},l={x:s.marginBox.width,y:s.marginBox.height};return{descriptor:t,placeholder:a,displaceBy:l,client:s,page:o}}function SLe(t){const e=$4("draggable"),{descriptor:n,registry:r,getDraggableRef:i,canDragInteractiveElements:s,shouldRespectForcePress:o,isEnabled:a}=t,l=en(()=>({canDragInteractiveElements:s,shouldRespectForcePress:o,isEnabled:a}),[s,a,o]),c=ct(f=>{const y=i();return y||Le(),wLe(n,y,f)},[n,i]),u=en(()=>({uniqueId:e,descriptor:n,options:l,getDimension:c}),[n,c,l,e]),d=S.useRef(u),h=S.useRef(!0);_a(()=>(r.draggable.register(d.current),()=>r.draggable.unregister(d.current)),[r.draggable]),_a(()=>{if(h.current){h.current=!1;return}const f=d.current;d.current=u,r.draggable.update(u,f)},[u,r.draggable])}var z4=$e.createContext(null);function YT(t){const e=S.useContext(t);return e||Le(),e}function CLe(t){t.preventDefault()}const ELe=t=>{const e=S.useRef(null),n=ct((_=null)=>{e.current=_},[]),r=ct(()=>e.current,[]),{contextId:i,dragHandleUsageInstructionsId:s,registry:o}=YT(F_),{type:a,droppableId:l}=YT(z4),c=en(()=>({id:t.draggableId,index:t.index,type:a,droppableId:l}),[t.draggableId,t.index,a,l]),{children:u,draggableId:d,isEnabled:h,shouldRespectForcePress:f,canDragInteractiveElements:y,isClone:b,mapped:v,dropAnimationFinished:x}=t;if(!b){const _=en(()=>({descriptor:c,registry:o,getDraggableRef:r,canDragInteractiveElements:y,shouldRespectForcePress:f,isEnabled:h}),[c,o,r,y,f,h]);SLe(_)}const C=en(()=>h?{tabIndex:0,role:"button","aria-describedby":s,"data-rfd-drag-handle-draggable-id":d,"data-rfd-drag-handle-context-id":i,draggable:!1,onDragStart:CLe}:null,[i,s,d,h]),E=ct(_=>{v.type==="DRAGGING"&&v.dropping&&_.propertyName==="transform"&&_c.flushSync(x)},[x,v]),I=en(()=>{const _=xLe(v),A=v.type==="DRAGGING"&&v.dropping?E:void 0;return{innerRef:n,draggableProps:{"data-rfd-draggable-context-id":i,"data-rfd-draggable-id":d,style:_,onTransitionEnd:A},dragHandleProps:C}},[i,C,d,v,E,n]),P=en(()=>({draggableId:c.id,type:c.type,source:{index:c.index,droppableId:c.droppableId}}),[c.droppableId,c.id,c.index,c.type]);return $e.createElement($e.Fragment,null,u(I,v.snapshot,P))};var boe=(t,e)=>t===e,xoe=t=>{const{combine:e,destination:n}=t;return n?n.droppableId:e?e.droppableId:null};const TLe=t=>t.combine?t.combine.draggableId:null,ILe=t=>t.at&&t.at.type==="COMBINE"?t.at.combine.draggableId:null;function PLe(){const t=Ti((i,s)=>({x:i,y:s})),e=Ti((i,s,o=null,a=null,l=null)=>({isDragging:!0,isClone:s,isDropAnimating:!!l,dropAnimation:l,mode:i,draggingOver:o,combineWith:a,combineTargetFor:null})),n=Ti((i,s,o,a,l=null,c=null,u=null)=>({mapped:{type:"DRAGGING",dropping:null,draggingOver:l,combineWith:c,mode:s,offset:i,dimension:o,forceShouldAnimate:u,snapshot:e(s,a,l,c,null)}}));return(i,s)=>{if(Wx(i)){if(i.critical.draggable.id!==s.draggableId)return null;const o=i.current.client.offset,a=i.dimensions.draggables[s.draggableId],l=Pa(i.impact),c=ILe(i.impact),u=i.forceShouldAnimate;return n(t(o.x,o.y),i.movementMode,a,s.isClone,l,c,u)}if(i.phase==="DROP_ANIMATING"){const o=i.completed;if(o.result.draggableId!==s.draggableId)return null;const a=s.isClone,l=i.dimensions.draggables[s.draggableId],c=o.result,u=c.mode,d=xoe(c),h=TLe(c),y={duration:i.dropDuration,curve:D4.drop,moveTo:i.newHomeClientOffset,opacity:h?Hx.opacity.drop:null,scale:h?Hx.scale.drop:null};return{mapped:{type:"DRAGGING",offset:i.newHomeClientOffset,dimension:l,dropping:y,draggingOver:d,combineWith:h,mode:u,forceShouldAnimate:null,snapshot:e(u,a,d,h,y)}}}return null}}function woe(t=null){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:t,combineWith:null}}const _Le={mapped:{type:"SECONDARY",offset:_i,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:woe(null)}};function kLe(){const t=Ti((o,a)=>({x:o,y:a})),e=Ti(woe),n=Ti((o,a=null,l)=>({mapped:{type:"SECONDARY",offset:o,combineTargetFor:a,shouldAnimateDisplacement:l,snapshot:e(a)}})),r=o=>o?n(_i,o,!0):null,i=(o,a,l,c)=>{const u=l.displaced.visible[o],d=!!(c.inVirtualList&&c.effected[o]),h=R_(l),f=h&&h.draggableId===o?a:null;if(!u){if(!d)return r(f);if(l.displaced.invisible[o])return null;const v=yv(c.displacedBy.point),x=t(v.x,v.y);return n(x,f,!0)}if(d)return r(f);const y=l.displacedBy.point,b=t(y.x,y.y);return n(b,f,u.shouldAnimate)};return(o,a)=>{if(Wx(o))return o.critical.draggable.id===a.draggableId?null:i(a.draggableId,o.critical.draggable.id,o.impact,o.afterCritical);if(o.phase==="DROP_ANIMATING"){const l=o.completed;return l.result.draggableId===a.draggableId?null:i(a.draggableId,l.result.draggableId,l.impact,l.afterCritical)}return null}}const ALe=()=>{const t=PLe(),e=kLe();return(r,i)=>t(r,i)||e(r,i)||_Le},MLe={dropAnimationFinished:Zse},OLe=Sse(ALe,MLe,null,{context:F4,areStatePropsEqual:boe})(ELe);function Soe(t){return YT(z4).isUsingCloneFor===t.draggableId&&!t.isClone?null:$e.createElement(OLe,t)}function Coe(t){const e=typeof t.isDragDisabled=="boolean"?!t.isDragDisabled:!0,n=!!t.disableInteractiveElementBlocking,r=!!t.shouldRespectForcePress;return $e.createElement(Soe,VT({},t,{isClone:!1,isEnabled:e,canDragInteractiveElements:n,shouldRespectForcePress:r}))}const Eoe=t=>e=>t===e,DLe=Eoe("scroll"),RLe=Eoe("auto"),KW=(t,e)=>e(t.overflowX)||e(t.overflowY),NLe=t=>{const e=window.getComputedStyle(t),n={overflowX:e.overflowX,overflowY:e.overflowY};return KW(n,DLe)||KW(n,RLe)},jLe=()=>!1,Toe=t=>t==null?null:t===document.body?jLe()?t:null:t===document.documentElement?null:NLe(t)?t:Toe(t.parentElement);var VF=t=>({x:t.scrollLeft,y:t.scrollTop});const Ioe=t=>t?window.getComputedStyle(t).position==="fixed"?!0:Ioe(t.parentElement):!1;var LLe=t=>{const e=Toe(t),n=Ioe(t);return{closestScrollable:e,isFixedOnPage:n}},FLe=({descriptor:t,isEnabled:e,isCombineEnabled:n,isFixedOnPage:r,direction:i,client:s,page:o,closest:a})=>{const l=(()=>{if(!a)return null;const{scrollSize:h,client:f}=a,y=noe({scrollHeight:h.scrollHeight,scrollWidth:h.scrollWidth,height:f.paddingBox.height,width:f.paddingBox.width});return{pageMarginBox:a.page.marginBox,frameClient:f,scrollSize:h,shouldClipSubject:a.shouldClipSubject,scroll:{initial:a.scroll,current:a.scroll,max:y,diff:{value:_i,displacement:_i}}}})(),c=i==="vertical"?I4:Nse,u=Py({page:o,withPlaceholder:null,axis:c,frame:l});return{descriptor:t,isCombineEnabled:n,isFixedOnPage:r,axis:c,isEnabled:e,client:s,page:o,frame:l,subject:u}};const $Le=(t,e)=>{const n=Tse(t);if(!e||t!==e)return n;const r=n.paddingBox.top-e.scrollTop,i=n.paddingBox.left-e.scrollLeft,s=r+e.scrollHeight,o=i+e.scrollWidth,l=S4({top:r,right:o,bottom:s,left:i},n.border);return C4({borderBox:l,margin:n.margin,border:n.border,padding:n.padding})};var BLe=({ref:t,descriptor:e,env:n,windowScroll:r,direction:i,isDropDisabled:s,isCombineEnabled:o,shouldClipSubject:a})=>{const l=n.closestScrollable,c=$Le(t,l),u=HT(c,r),d=(()=>{if(!l)return null;const f=Tse(l),y={scrollHeight:l.scrollHeight,scrollWidth:l.scrollWidth};return{client:f,page:HT(f,r),scroll:VF(l),scrollSize:y,shouldClipSubject:a}})();return FLe({descriptor:e,isEnabled:!s,isCombineEnabled:o,isFixedOnPage:n.isFixedOnPage,direction:i,client:c,page:u,closest:d})};const zLe={passive:!1},ULe={passive:!0};var qW=t=>t.shouldPublishImmediately?zLe:ULe;const mC=t=>t&&t.env.closestScrollable||null;function HLe(t){const e=S.useRef(null),n=YT(F_),r=$4("droppable"),{registry:i,marshal:s}=n,o=doe(t),a=en(()=>({id:t.droppableId,type:t.type,mode:t.mode}),[t.droppableId,t.mode,t.type]),l=S.useRef(a),c=en(()=>Ti((I,P)=>{e.current||Le();const _={x:I,y:P};s.updateDroppableScroll(a.id,_)}),[a.id,s]),u=ct(()=>{const I=e.current;return!I||!I.env.closestScrollable?_i:VF(I.env.closestScrollable)},[]),d=ct(()=>{const I=u();c(I.x,I.y)},[u,c]),h=en(()=>$x(d),[d]),f=ct(()=>{const I=e.current,P=mC(I);if(I&&P||Le(),I.scrollOptions.shouldPublishImmediately){d();return}h()},[h,d]),y=ct((I,P)=>{e.current&&Le();const _=o.current,A=_.getDroppableRef();A||Le();const D=LLe(A),L={ref:A,descriptor:a,env:D,scrollOptions:P};e.current=L;const z=BLe({ref:A,descriptor:a,env:D,windowScroll:I,direction:_.direction,isDropDisabled:_.isDropDisabled,isCombineEnabled:_.isCombineEnabled,shouldClipSubject:!_.ignoreContainerClipping}),$=D.closestScrollable;return $&&($.setAttribute(zW.contextId,n.contextId),$.addEventListener("scroll",f,qW(L.scrollOptions))),z},[n.contextId,a,f,o]),b=ct(()=>{const I=e.current,P=mC(I);return I&&P||Le(),VF(P)},[]),v=ct(()=>{const I=e.current;I||Le();const P=mC(I);e.current=null,P&&(h.cancel(),P.removeAttribute(zW.contextId),P.removeEventListener("scroll",f,qW(I.scrollOptions)))},[f,h]),x=ct(I=>{const P=e.current;P||Le();const _=mC(P);_||Le(),_.scrollTop+=I.y,_.scrollLeft+=I.x},[]),C=en(()=>({getDimensionAndWatchScroll:y,getScrollWhileDragging:b,dragStopped:v,scroll:x}),[v,y,b,x]),E=en(()=>({uniqueId:r,descriptor:a,callbacks:C}),[C,a,r]);_a(()=>(l.current=E.descriptor,i.droppable.register(E),()=>{e.current&&v(),i.droppable.unregister(E)}),[C,a,v,E,s,i.droppable]),_a(()=>{e.current&&s.updateDroppableIsEnabled(l.current.id,!t.isDropDisabled)},[t.isDropDisabled,s]),_a(()=>{e.current&&s.updateDroppableIsCombineEnabled(l.current.id,t.isCombineEnabled)},[t.isCombineEnabled,s])}function L2(){}const GW={width:0,height:0,margin:ZDe},VLe=({isAnimatingOpenOnMount:t,placeholder:e,animate:n})=>t||n==="close"?GW:{height:e.client.borderBox.height,width:e.client.borderBox.width,margin:e.client.margin},WLe=({isAnimatingOpenOnMount:t,placeholder:e,animate:n})=>{const r=VLe({isAnimatingOpenOnMount:t,placeholder:e,animate:n});return{display:e.display,boxSizing:"border-box",width:r.width,height:r.height,marginTop:r.margin.top,marginRight:r.margin.right,marginBottom:r.margin.bottom,marginLeft:r.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:n!=="none"?rx.placeholder:null}},KLe=t=>{const e=S.useRef(null),n=ct(()=>{e.current&&(clearTimeout(e.current),e.current=null)},[]),{animate:r,onTransitionEnd:i,onClose:s,contextId:o}=t,[a,l]=S.useState(t.animate==="open");S.useEffect(()=>a?r!=="open"?(n(),l(!1),L2):e.current?L2:(e.current=setTimeout(()=>{e.current=null,l(!1)}),n):L2,[r,a,n]);const c=ct(d=>{d.propertyName==="height"&&(i(),r==="close"&&s())},[r,s,i]),u=WLe({isAnimatingOpenOnMount:a,animate:t.animate,placeholder:t.placeholder});return $e.createElement(t.placeholder.tagName,{style:u,"data-rfd-placeholder-context-id":o,onTransitionEnd:c,ref:t.innerRef})};var qLe=$e.memo(KLe);class GLe extends $e.PureComponent{constructor(...e){super(...e),this.state={isVisible:!!this.props.on,data:this.props.on,animate:this.props.shouldAnimate&&this.props.on?"open":"none"},this.onClose=()=>{this.state.animate==="close"&&this.setState({isVisible:!1})}}static getDerivedStateFromProps(e,n){return e.shouldAnimate?e.on?{isVisible:!0,data:e.on,animate:"open"}:n.isVisible?{isVisible:!0,data:n.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:!!e.on,data:e.on,animate:"none"}}render(){if(!this.state.isVisible)return null;const e={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(e)}}const YLe=t=>{const e=S.useContext(F_);e||Le();const{contextId:n,isMovementAllowed:r}=e,i=S.useRef(null),s=S.useRef(null),{children:o,droppableId:a,type:l,mode:c,direction:u,ignoreContainerClipping:d,isDropDisabled:h,isCombineEnabled:f,snapshot:y,useClone:b,updateViewportMaxScroll:v,getContainerForClone:x}=t,C=ct(()=>i.current,[]),E=ct(($=null)=>{i.current=$},[]);ct(()=>s.current,[]);const I=ct(($=null)=>{s.current=$},[]),P=ct(()=>{r()&&v({maxScroll:ioe()})},[r,v]);HLe({droppableId:a,type:l,mode:c,direction:u,isDropDisabled:h,isCombineEnabled:f,ignoreContainerClipping:d,getDroppableRef:C});const _=en(()=>$e.createElement(GLe,{on:t.placeholder,shouldAnimate:t.shouldAnimatePlaceholder},({onClose:$,data:H,animate:R})=>$e.createElement(qLe,{placeholder:H,onClose:$,innerRef:I,animate:R,contextId:n,onTransitionEnd:P})),[n,P,t.placeholder,t.shouldAnimatePlaceholder,I]),A=en(()=>({innerRef:E,placeholder:_,droppableProps:{"data-rfd-droppable-id":a,"data-rfd-droppable-context-id":n}}),[n,a,_,E]),D=b?b.dragging.draggableId:null,L=en(()=>({droppableId:a,type:l,isUsingCloneFor:D}),[a,D,l]);function z(){if(!b)return null;const{dragging:$,render:H}=b,R=$e.createElement(Soe,{draggableId:$.draggableId,index:$.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},(j,B)=>H(j,B,$));return Lre.createPortal(R,x())}return $e.createElement(z4.Provider,{value:L},o(A,y),z())};function XLe(){return document.body||Le(),document.body}const YW={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:XLe},Poe=t=>{let e={...t},n;for(n in YW)t[n]===void 0&&(e={...e,[n]:YW[n]});return e},F2=(t,e)=>t===e.droppable.type,XW=(t,e)=>e.draggables[t.draggable.id],JLe=()=>{const t={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},e={...t,shouldAnimatePlaceholder:!1},n=Ti(s=>({draggableId:s.id,type:s.type,source:{index:s.index,droppableId:s.droppableId}})),r=Ti((s,o,a,l,c,u)=>{const d=c.descriptor.id;if(c.descriptor.droppableId===s){const y=u?{render:u,dragging:n(c.descriptor)}:null,b={isDraggingOver:a,draggingOverWith:a?d:null,draggingFromThisWith:d,isUsingPlaceholder:!0};return{placeholder:c.placeholder,shouldAnimatePlaceholder:!1,snapshot:b,useClone:y}}if(!o)return e;if(!l)return t;const f={isDraggingOver:a,draggingOverWith:d,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:c.placeholder,shouldAnimatePlaceholder:!0,snapshot:f,useClone:null}});return(s,o)=>{const a=Poe(o),l=a.droppableId,c=a.type,u=!a.isDropDisabled,d=a.renderClone;if(Wx(s)){const h=s.critical;if(!F2(c,h))return e;const f=XW(h,s.dimensions),y=Pa(s.impact)===l;return r(l,u,y,y,f,d)}if(s.phase==="DROP_ANIMATING"){const h=s.completed;if(!F2(c,h.critical))return e;const f=XW(h.critical,s.dimensions);return r(l,u,xoe(h.result)===l,Pa(h.impact)===l,f,d)}if(s.phase==="IDLE"&&s.completed&&!s.shouldFlush){const h=s.completed;if(!F2(c,h.critical))return e;const f=Pa(h.impact)===l,y=!!(h.impact.at&&h.impact.at.type==="COMBINE"),b=h.critical.droppable.id===l;return f?y?t:e:b?t:e}return e}},ZLe={updateViewportMaxScroll:uNe},_oe=Sse(JLe,ZLe,(t,e,n)=>({...Poe(n),...t,...e}),{context:F4,areStatePropsEqual:boe})(YLe);function koe(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=koe(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function si(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=koe(t))&&(r&&(r+=" "),r+=e);return r}var $2={},B2={},JW;function QLe(){return JW||(JW=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n==="__proto__"}t.isUnsafeProperty=e}(B2)),B2}var z2={},ZW;function Aoe(){return ZW||(ZW=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){switch(typeof n){case"number":case"symbol":return!1;case"string":return n.includes(".")||n.includes("[")||n.includes("]")}}t.isDeepKey=e}(z2)),z2}var U2={},QW;function Moe(){return QW||(QW=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){var r;return typeof n=="string"||typeof n=="symbol"?n:Object.is((r=n==null?void 0:n.valueOf)==null?void 0:r.call(n),-0)?"-0":String(n)}t.toKey=e}(U2)),U2}var H2={},eK;function U4(){return eK||(eK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){const r=[],i=n.length;if(i===0)return r;let s=0,o="",a="",l=!1;for(n.charCodeAt(0)===46&&(r.push(""),s++);s<i;){const c=n[s];a?c==="\\"&&s+1<i?(s++,o+=n[s]):c===a?a="":o+=c:l?c==='"'||c==="'"?a=c:c==="]"?(l=!1,r.push(o),o=""):o+=c:c==="["?(l=!0,o&&(r.push(o),o="")):c==="."?o&&(r.push(o),o=""):o+=c,s++}return o&&r.push(o),r}t.toPath=e}(H2)),H2}var tK;function H4(){return tK||(tK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=QLe(),n=Aoe(),r=Moe(),i=U4();function s(a,l,c){if(a==null)return c;switch(typeof l){case"string":{if(e.isUnsafeProperty(l))return c;const u=a[l];return u===void 0?n.isDeepKey(l)?s(a,i.toPath(l),c):c:u}case"number":case"symbol":{typeof l=="number"&&(l=r.toKey(l));const u=a[l];return u===void 0?c:u}default:{if(Array.isArray(l))return o(a,l,c);if(Object.is(l==null?void 0:l.valueOf(),-0)?l="-0":l=String(l),e.isUnsafeProperty(l))return c;const u=a[l];return u===void 0?c:u}}}function o(a,l,c){if(l.length===0)return c;let u=a;for(let d=0;d<l.length;d++){if(u==null||e.isUnsafeProperty(l[d]))return c;u=u[l[d]]}return u===void 0?c:u}t.get=s}($2)),$2}var V2,nK;function eFe(){return nK||(nK=1,V2=H4().get),V2}var tFe=eFe();const Ay=Oi(tFe);var W2={exports:{}},xn={};/**
 * @license React
 * react-is.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rK;function nFe(){if(rK)return xn;rK=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.suspense_list"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),h=Symbol.for("react.view_transition"),f=Symbol.for("react.client.reference");function y(b){if(typeof b=="object"&&b!==null){var v=b.$$typeof;switch(v){case t:switch(b=b.type,b){case n:case i:case r:case l:case c:case h:return b;default:switch(b=b&&b.$$typeof,b){case o:case a:case d:case u:return b;case s:return b;default:return v}}case e:return v}}}return xn.ContextConsumer=s,xn.ContextProvider=o,xn.Element=t,xn.ForwardRef=a,xn.Fragment=n,xn.Lazy=d,xn.Memo=u,xn.Portal=e,xn.Profiler=i,xn.StrictMode=r,xn.Suspense=l,xn.SuspenseList=c,xn.isContextConsumer=function(b){return y(b)===s},xn.isContextProvider=function(b){return y(b)===o},xn.isElement=function(b){return typeof b=="object"&&b!==null&&b.$$typeof===t},xn.isForwardRef=function(b){return y(b)===a},xn.isFragment=function(b){return y(b)===n},xn.isLazy=function(b){return y(b)===d},xn.isMemo=function(b){return y(b)===u},xn.isPortal=function(b){return y(b)===e},xn.isProfiler=function(b){return y(b)===i},xn.isStrictMode=function(b){return y(b)===r},xn.isSuspense=function(b){return y(b)===l},xn.isSuspenseList=function(b){return y(b)===c},xn.isValidElementType=function(b){return typeof b=="string"||typeof b=="function"||b===n||b===i||b===r||b===l||b===c||typeof b=="object"&&b!==null&&(b.$$typeof===d||b.$$typeof===u||b.$$typeof===o||b.$$typeof===s||b.$$typeof===a||b.$$typeof===f||b.getModuleId!==void 0)},xn.typeOf=y,xn}var iK;function rFe(){return iK||(iK=1,W2.exports=nFe()),W2.exports}var iFe=rFe(),ba=t=>t===0?0:t>0?1:-1,bc=t=>typeof t=="number"&&t!=+t,Sb=t=>typeof t=="string"&&t.indexOf("%")===t.length-1,Gt=t=>(typeof t=="number"||t instanceof Number)&&!bc(t),vd=t=>Gt(t)||typeof t=="string",sFe=0,XT=t=>{var e=++sFe;return"".concat(t||"").concat(e)},du=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Gt(e)&&typeof e!="string")return r;var s;if(Sb(e)){if(n==null)return r;var o=e.indexOf("%");s=n*parseFloat(e.slice(0,o))/100}else s=+e;return bc(s)&&(s=r),i&&n!=null&&s>n&&(s=n),s},Ooe=t=>{if(!Array.isArray(t))return!1;for(var e=t.length,n={},r=0;r<e;r++)if(!n[t[r]])n[t[r]]=!0;else return!0;return!1},sK=(t,e)=>Gt(t)&&Gt(e)?n=>t+n*(e-t):()=>e;function oFe(t,e,n){if(!(!t||!t.length))return t.find(r=>r&&(typeof e=="function"?e(r):Ay(r,e))===n)}var ig=t=>t===null||typeof t>"u",iS=t=>ig(t)?t:"".concat(t.charAt(0).toUpperCase()).concat(t.slice(1)),aFe=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function V4(t){if(typeof t!="string")return!1;var e=aFe;return e.includes(t)}var lFe=["viewBox","children"],oK=["points","pathLength"],K2={svg:lFe,polygon:oK,polyline:oK},cFe=(t,e)=>{if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(S.isValidElement(t)&&(n=t.props),typeof n!="object"&&typeof n!="function")return null;var r={};return Object.keys(n).forEach(i=>{V4(i)&&(r[i]=s=>n[i](n,s))}),r},uFe=(t,e,n)=>r=>(t(e,n,r),null),Doe=(t,e,n)=>{if(t===null||typeof t!="object"&&typeof t!="function")return null;var r=null;return Object.keys(t).forEach(i=>{var s=t[i];V4(i)&&typeof s=="function"&&(r||(r={}),r[i]=uFe(s,e,n))}),r},dFe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"];function Roe(t){if(typeof t!="string")return!1;var e=dFe;return e.includes(t)}function B_(t){var e=Object.entries(t).filter(n=>{var[r]=n;return Roe(r)});return Object.fromEntries(e)}var aK=t=>typeof t=="string"?t:t?t.displayName||t.name||"Component":"",lK=null,q2=null,Noe=t=>{if(t===lK&&Array.isArray(q2))return q2;var e=[];return S.Children.forEach(t,n=>{ig(n)||(iFe.isFragment(n)?e=e.concat(Noe(n.props.children)):e.push(n))}),q2=e,lK=t,e};function joe(t,e){var n=[],r=[];return Array.isArray(e)?r=e.map(i=>aK(i)):r=[aK(e)],Noe(t).forEach(i=>{var s=Ay(i,"type.displayName")||Ay(i,"type.name");r.indexOf(s)!==-1&&n.push(i)}),n}var hFe=(t,e,n,r)=>{var i;if(typeof e=="symbol"||typeof e=="number")return!0;var s=(i=r&&(K2==null?void 0:K2[r]))!==null&&i!==void 0?i:[],o=e.startsWith("data-"),a=typeof t!="function"&&(!!r&&s.includes(e)||Roe(e)),l=!!n&&V4(e);return o||a||l},ja=(t,e,n)=>{if(!t||typeof t=="function"||typeof t=="boolean")return null;var r=t;if(S.isValidElement(t)&&(r=t.props),typeof r!="object"&&typeof r!="function")return null;var i={};return Object.keys(r).forEach(s=>{var o;hFe((o=r)===null||o===void 0?void 0:o[s],s,e,n)&&(i[s]=r[s])}),i},fFe=["children","width","height","viewBox","className","style","title","desc"];function WF(){return WF=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},WF.apply(null,arguments)}function pFe(t,e){if(t==null)return{};var n,r,i=gFe(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function gFe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var W4=S.forwardRef((t,e)=>{var{children:n,width:r,height:i,viewBox:s,className:o,style:a,title:l,desc:c}=t,u=pFe(t,fFe),d=s||{width:r,height:i,x:0,y:0},h=si("recharts-surface",o);return S.createElement("svg",WF({},ja(u,!0,"svg"),{className:h,width:r,height:i,style:a,viewBox:"".concat(d.x," ").concat(d.y," ").concat(d.width," ").concat(d.height),ref:e}),S.createElement("title",null,l),S.createElement("desc",null,c),n)}),mFe=["children","className"];function KF(){return KF=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},KF.apply(null,arguments)}function yFe(t,e){if(t==null)return{};var n,r,i=vFe(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function vFe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var My=S.forwardRef((t,e)=>{var{children:n,className:r}=t,i=yFe(t,mFe),s=si("recharts-layer",r);return S.createElement("g",KF({className:s},ja(i,!0),{ref:e}),n)}),Loe=S.createContext(null),bFe=()=>S.useContext(Loe);function Rn(t){return function(){return t}}const Foe=Math.cos,JT=Math.sin,kc=Math.sqrt,ZT=Math.PI,z_=2*ZT,qF=Math.PI,GF=2*qF,mp=1e-6,xFe=GF-mp;function $oe(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function wFe(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return $oe;const n=10**e;return function(r){this._+=r[0];for(let i=1,s=r.length;i<s;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}class SFe{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?$oe:wFe(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,s,o){this._append`C${+e},${+n},${+r},${+i},${this._x1=+s},${this._y1=+o}`}arcTo(e,n,r,i,s){if(e=+e,n=+n,r=+r,i=+i,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,l=r-e,c=i-n,u=o-e,d=a-n,h=u*u+d*d;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(h>mp)if(!(Math.abs(d*l-c*u)>mp)||!s)this._append`L${this._x1=e},${this._y1=n}`;else{let f=r-o,y=i-a,b=l*l+c*c,v=f*f+y*y,x=Math.sqrt(b),C=Math.sqrt(h),E=s*Math.tan((qF-Math.acos((b+h-v)/(2*x*C)))/2),I=E/C,P=E/x;Math.abs(I-1)>mp&&this._append`L${e+I*u},${n+I*d}`,this._append`A${s},${s},0,0,${+(d*f>u*y)},${this._x1=e+P*l},${this._y1=n+P*c}`}}arc(e,n,r,i,s,o){if(e=+e,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),l=r*Math.sin(i),c=e+a,u=n+l,d=1^o,h=o?i-s:s-i;this._x1===null?this._append`M${c},${u}`:(Math.abs(this._x1-c)>mp||Math.abs(this._y1-u)>mp)&&this._append`L${c},${u}`,r&&(h<0&&(h=h%GF+GF),h>xFe?this._append`A${r},${r},0,1,${d},${e-a},${n-l}A${r},${r},0,1,${d},${this._x1=c},${this._y1=u}`:h>mp&&this._append`A${r},${r},0,${+(h>=qF)},${d},${this._x1=e+r*Math.cos(s)},${this._y1=n+r*Math.sin(s)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function K4(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new SFe(e)}function q4(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Boe(t){this._context=t}Boe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function U_(t){return new Boe(t)}function zoe(t){return t[0]}function Uoe(t){return t[1]}function Hoe(t,e){var n=Rn(!0),r=null,i=U_,s=null,o=K4(a);t=typeof t=="function"?t:t===void 0?zoe:Rn(t),e=typeof e=="function"?e:e===void 0?Uoe:Rn(e);function a(l){var c,u=(l=q4(l)).length,d,h=!1,f;for(r==null&&(s=i(f=o())),c=0;c<=u;++c)!(c<u&&n(d=l[c],c,l))===h&&((h=!h)?s.lineStart():s.lineEnd()),h&&s.point(+t(d,c,l),+e(d,c,l));if(f)return s=null,f+""||null}return a.x=function(l){return arguments.length?(t=typeof l=="function"?l:Rn(+l),a):t},a.y=function(l){return arguments.length?(e=typeof l=="function"?l:Rn(+l),a):e},a.defined=function(l){return arguments.length?(n=typeof l=="function"?l:Rn(!!l),a):n},a.curve=function(l){return arguments.length?(i=l,r!=null&&(s=i(r)),a):i},a.context=function(l){return arguments.length?(l==null?r=s=null:s=i(r=l),a):r},a}function yC(t,e,n){var r=null,i=Rn(!0),s=null,o=U_,a=null,l=K4(c);t=typeof t=="function"?t:t===void 0?zoe:Rn(+t),e=typeof e=="function"?e:Rn(e===void 0?0:+e),n=typeof n=="function"?n:n===void 0?Uoe:Rn(+n);function c(d){var h,f,y,b=(d=q4(d)).length,v,x=!1,C,E=new Array(b),I=new Array(b);for(s==null&&(a=o(C=l())),h=0;h<=b;++h){if(!(h<b&&i(v=d[h],h,d))===x)if(x=!x)f=h,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),y=h-1;y>=f;--y)a.point(E[y],I[y]);a.lineEnd(),a.areaEnd()}x&&(E[h]=+t(v,h,d),I[h]=+e(v,h,d),a.point(r?+r(v,h,d):E[h],n?+n(v,h,d):I[h]))}if(C)return a=null,C+""||null}function u(){return Hoe().defined(i).curve(o).context(s)}return c.x=function(d){return arguments.length?(t=typeof d=="function"?d:Rn(+d),r=null,c):t},c.x0=function(d){return arguments.length?(t=typeof d=="function"?d:Rn(+d),c):t},c.x1=function(d){return arguments.length?(r=d==null?null:typeof d=="function"?d:Rn(+d),c):r},c.y=function(d){return arguments.length?(e=typeof d=="function"?d:Rn(+d),n=null,c):e},c.y0=function(d){return arguments.length?(e=typeof d=="function"?d:Rn(+d),c):e},c.y1=function(d){return arguments.length?(n=d==null?null:typeof d=="function"?d:Rn(+d),c):n},c.lineX0=c.lineY0=function(){return u().x(t).y(e)},c.lineY1=function(){return u().x(t).y(n)},c.lineX1=function(){return u().x(r).y(e)},c.defined=function(d){return arguments.length?(i=typeof d=="function"?d:Rn(!!d),c):i},c.curve=function(d){return arguments.length?(o=d,s!=null&&(a=o(s)),c):o},c.context=function(d){return arguments.length?(d==null?s=a=null:a=o(s=d),c):s},c}class Voe{constructor(e,n){this._context=e,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,n){switch(e=+e,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,n,e,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,e,this._y0,e,n);break}}this._x0=e,this._y0=n}}function CFe(t){return new Voe(t,!0)}function EFe(t){return new Voe(t,!1)}const G4={draw(t,e){const n=kc(e/ZT);t.moveTo(n,0),t.arc(0,0,n,0,z_)}},TFe={draw(t,e){const n=kc(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},Woe=kc(1/3),IFe=Woe*2,PFe={draw(t,e){const n=kc(e/IFe),r=n*Woe;t.moveTo(0,-n),t.lineTo(r,0),t.lineTo(0,n),t.lineTo(-r,0),t.closePath()}},_Fe={draw(t,e){const n=kc(e),r=-n/2;t.rect(r,r,n,n)}},kFe=.8908130915292852,Koe=JT(ZT/10)/JT(7*ZT/10),AFe=JT(z_/10)*Koe,MFe=-Foe(z_/10)*Koe,OFe={draw(t,e){const n=kc(e*kFe),r=AFe*n,i=MFe*n;t.moveTo(0,-n),t.lineTo(r,i);for(let s=1;s<5;++s){const o=z_*s/5,a=Foe(o),l=JT(o);t.lineTo(l*n,-a*n),t.lineTo(a*r-l*i,l*r+a*i)}t.closePath()}},G2=kc(3),DFe={draw(t,e){const n=-kc(e/(G2*3));t.moveTo(0,n*2),t.lineTo(-G2*n,-n),t.lineTo(G2*n,-n),t.closePath()}},al=-.5,ll=kc(3)/2,YF=1/kc(12),RFe=(YF/2+1)*3,NFe={draw(t,e){const n=kc(e/RFe),r=n/2,i=n*YF,s=r,o=n*YF+n,a=-s,l=o;t.moveTo(r,i),t.lineTo(s,o),t.lineTo(a,l),t.lineTo(al*r-ll*i,ll*r+al*i),t.lineTo(al*s-ll*o,ll*s+al*o),t.lineTo(al*a-ll*l,ll*a+al*l),t.lineTo(al*r+ll*i,al*i-ll*r),t.lineTo(al*s+ll*o,al*o-ll*s),t.lineTo(al*a+ll*l,al*l-ll*a),t.closePath()}};function jFe(t,e){let n=null,r=K4(i);t=typeof t=="function"?t:Rn(t||G4),e=typeof e=="function"?e:Rn(e===void 0?64:+e);function i(){let s;if(n||(n=s=r()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),s)return n=null,s+""||null}return i.type=function(s){return arguments.length?(t=typeof s=="function"?s:Rn(s),i):t},i.size=function(s){return arguments.length?(e=typeof s=="function"?s:Rn(+s),i):e},i.context=function(s){return arguments.length?(n=s??null,i):n},i}function QT(){}function eI(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function qoe(t){this._context=t}qoe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:eI(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:eI(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function LFe(t){return new qoe(t)}function Goe(t){this._context=t}Goe.prototype={areaStart:QT,areaEnd:QT,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:eI(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function FFe(t){return new Goe(t)}function Yoe(t){this._context=t}Yoe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:eI(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function $Fe(t){return new Yoe(t)}function Xoe(t){this._context=t}Xoe.prototype={areaStart:QT,areaEnd:QT,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function BFe(t){return new Xoe(t)}function cK(t){return t<0?-1:1}function uK(t,e,n){var r=t._x1-t._x0,i=e-t._x1,s=(t._y1-t._y0)/(r||i<0&&-0),o=(n-t._y1)/(i||r<0&&-0),a=(s*i+o*r)/(r+i);return(cK(s)+cK(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function dK(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Y2(t,e,n){var r=t._x0,i=t._y0,s=t._x1,o=t._y1,a=(s-r)/3;t._context.bezierCurveTo(r+a,i+a*e,s-a,o-a*n,s,o)}function tI(t){this._context=t}tI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Y2(this,this._t0,dK(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Y2(this,dK(this,n=uK(this,t,e)),n);break;default:Y2(this,this._t0,n=uK(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};function Joe(t){this._context=new Zoe(t)}(Joe.prototype=Object.create(tI.prototype)).point=function(t,e){tI.prototype.point.call(this,e,t)};function Zoe(t){this._context=t}Zoe.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,s){this._context.bezierCurveTo(e,t,r,n,s,i)}};function zFe(t){return new tI(t)}function UFe(t){return new Joe(t)}function Qoe(t){this._context=t}Qoe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),n===2)this._context.lineTo(t[1],e[1]);else for(var r=hK(t),i=hK(e),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],t[o],e[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function hK(t){var e,n=t.length-1,r,i=new Array(n),s=new Array(n),o=new Array(n);for(i[0]=0,s[0]=2,o[0]=t[0]+2*t[1],e=1;e<n-1;++e)i[e]=1,s[e]=4,o[e]=4*t[e]+2*t[e+1];for(i[n-1]=2,s[n-1]=7,o[n-1]=8*t[n-1]+t[n],e=1;e<n;++e)r=i[e]/s[e-1],s[e]-=r,o[e]-=r*o[e-1];for(i[n-1]=o[n-1]/s[n-1],e=n-2;e>=0;--e)i[e]=(o[e]-i[e+1])/s[e];for(s[n-1]=(t[n]+i[n-1])/2,e=0;e<n-1;++e)s[e]=2*t[e+1]-i[e+1];return[i,s]}function HFe(t){return new Qoe(t)}function H_(t,e){this._context=t,this._t=e}H_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}break}}this._x=t,this._y=e}};function VFe(t){return new H_(t,.5)}function WFe(t){return new H_(t,0)}function KFe(t){return new H_(t,1)}function Oy(t,e){if((o=t.length)>1)for(var n=1,r,i,s=t[e[0]],o,a=s.length;n<o;++n)for(i=s,s=t[e[n]],r=0;r<a;++r)s[r][1]+=s[r][0]=isNaN(i[r][1])?i[r][0]:i[r][1]}function XF(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function qFe(t,e){return t[e]}function GFe(t){const e=[];return e.key=t,e}function YFe(){var t=Rn([]),e=XF,n=Oy,r=qFe;function i(s){var o=Array.from(t.apply(this,arguments),GFe),a,l=o.length,c=-1,u;for(const d of s)for(a=0,++c;a<l;++a)(o[a][c]=[0,+r(d,o[a].key,c,s)]).data=d;for(a=0,u=q4(e(o));a<l;++a)o[u[a]].index=a;return n(o,u),o}return i.keys=function(s){return arguments.length?(t=typeof s=="function"?s:Rn(Array.from(s)),i):t},i.value=function(s){return arguments.length?(r=typeof s=="function"?s:Rn(+s),i):r},i.order=function(s){return arguments.length?(e=s==null?XF:typeof s=="function"?s:Rn(Array.from(s)),i):e},i.offset=function(s){return arguments.length?(n=s??Oy,i):n},i}function XFe(t,e){if((r=t.length)>0){for(var n,r,i=0,s=t[0].length,o;i<s;++i){for(o=n=0;n<r;++n)o+=t[n][i][1]||0;if(o)for(n=0;n<r;++n)t[n][i][1]/=o}Oy(t,e)}}function JFe(t,e){if((i=t.length)>0){for(var n=0,r=t[e[0]],i,s=r.length;n<s;++n){for(var o=0,a=0;o<i;++o)a+=t[o][n][1]||0;r[n][1]+=r[n][0]=-a/2}Oy(t,e)}}function ZFe(t,e){if(!(!((o=t.length)>0)||!((s=(i=t[e[0]]).length)>0))){for(var n=0,r=1,i,s,o;r<s;++r){for(var a=0,l=0,c=0;a<o;++a){for(var u=t[e[a]],d=u[r][1]||0,h=u[r-1][1]||0,f=(d-h)/2,y=0;y<a;++y){var b=t[e[y]],v=b[r][1]||0,x=b[r-1][1]||0;f+=v-x}l+=d,c+=f*d}i[r-1][1]+=i[r-1][0]=n,l&&(n-=c/l)}i[r-1][1]+=i[r-1][0]=n,Oy(t,e)}}var QFe=["type","size","sizeType"];function JF(){return JF=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},JF.apply(null,arguments)}function fK(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function pK(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fK(Object(n),!0).forEach(function(r){e3e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fK(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function e3e(t,e,n){return(e=t3e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function t3e(t){var e=n3e(t,"string");return typeof e=="symbol"?e:e+""}function n3e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function r3e(t,e){if(t==null)return{};var n,r,i=i3e(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function i3e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var eae={symbolCircle:G4,symbolCross:TFe,symbolDiamond:PFe,symbolSquare:_Fe,symbolStar:OFe,symbolTriangle:DFe,symbolWye:NFe},s3e=Math.PI/180,o3e=t=>{var e="symbol".concat(iS(t));return eae[e]||G4},a3e=(t,e,n)=>{if(e==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var r=18*s3e;return 1.25*t*t*(Math.tan(r)-Math.tan(r*2)*Math.tan(r)**2)}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},l3e=(t,e)=>{eae["symbol".concat(iS(t))]=e},Y4=t=>{var{type:e="circle",size:n=64,sizeType:r="area"}=t,i=r3e(t,QFe),s=pK(pK({},i),{},{type:e,size:n,sizeType:r}),o=()=>{var d=o3e(e),h=jFe().type(d).size(a3e(n,r,e));return h()},{className:a,cx:l,cy:c}=s,u=ja(s,!0);return l===+l&&c===+c&&n===+n?S.createElement("path",JF({},u,{className:si("recharts-symbols",a),transform:"translate(".concat(l,", ").concat(c,")"),d:o()})):null};Y4.registerSymbol=l3e;function ZF(){return ZF=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ZF.apply(null,arguments)}function gK(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function c3e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gK(Object(n),!0).forEach(function(r){X4(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gK(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function X4(t,e,n){return(e=u3e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u3e(t){var e=d3e(t,"string");return typeof e=="symbol"?e:e+""}function d3e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var cl=32;class J4 extends S.PureComponent{renderIcon(e,n){var{inactiveColor:r}=this.props,i=cl/2,s=cl/6,o=cl/3,a=e.inactive?r:e.color,l=n??e.type;if(l==="none")return null;if(l==="plainline")return S.createElement("line",{strokeWidth:4,fill:"none",stroke:a,strokeDasharray:e.payload.strokeDasharray,x1:0,y1:i,x2:cl,y2:i,className:"recharts-legend-icon"});if(l==="line")return S.createElement("path",{strokeWidth:4,fill:"none",stroke:a,d:"M0,".concat(i,"h").concat(o,`
            A`).concat(s,",").concat(s,",0,1,1,").concat(2*o,",").concat(i,`
            H`).concat(cl,"M").concat(2*o,",").concat(i,`
            A`).concat(s,",").concat(s,",0,1,1,").concat(o,",").concat(i),className:"recharts-legend-icon"});if(l==="rect")return S.createElement("path",{stroke:"none",fill:a,d:"M0,".concat(cl/8,"h").concat(cl,"v").concat(cl*3/4,"h").concat(-cl,"z"),className:"recharts-legend-icon"});if(S.isValidElement(e.legendIcon)){var c=c3e({},e);return delete c.legendIcon,S.cloneElement(e.legendIcon,c)}return S.createElement(Y4,{fill:a,cx:i,cy:i,size:cl,sizeType:"diameter",type:l})}renderItems(){var{payload:e,iconSize:n,layout:r,formatter:i,inactiveColor:s,iconType:o}=this.props,a={x:0,y:0,width:cl,height:cl},l={display:r==="horizontal"?"inline-block":"block",marginRight:10},c={display:"inline-block",verticalAlign:"middle",marginRight:4};return e.map((u,d)=>{var h=u.formatter||i,f=si({"recharts-legend-item":!0,["legend-item-".concat(d)]:!0,inactive:u.inactive});if(u.type==="none")return null;var y=u.inactive?s:u.color,b=h?h(u.value,u,d):u.value;return S.createElement("li",ZF({className:f,style:l,key:"legend-item-".concat(d)},Doe(this.props,u,d)),S.createElement(W4,{width:n,height:n,viewBox:a,style:c,"aria-label":"".concat(b," legend icon")},this.renderIcon(u,o)),S.createElement("span",{className:"recharts-legend-item-text",style:{color:y}},b))})}render(){var{payload:e,layout:n,align:r}=this.props;if(!e||!e.length)return null;var i={padding:0,margin:0,textAlign:n==="horizontal"?r:"left"};return S.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}X4(J4,"displayName","Legend");X4(J4,"defaultProps",{align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"});var X2={},J2={},mK;function h3e(){return mK||(mK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n,r){const i=new Map;for(let s=0;s<n.length;s++){const o=n[s],a=r(o);i.has(a)||i.set(a,o)}return Array.from(i.values())}t.uniqBy=e}(J2)),J2}var Z2={},yK;function tae(){return yK||(yK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n}t.identity=e}(Z2)),Z2}var Q2={},eD={},tD={},vK;function f3e(){return vK||(vK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return Number.isSafeInteger(n)&&n>=0}t.isLength=e}(tD)),tD}var bK;function nae(){return bK||(bK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=f3e();function n(r){return r!=null&&typeof r!="function"&&e.isLength(r.length)}t.isArrayLike=n}(eD)),eD}var nD={},xK;function p3e(){return xK||(xK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return typeof n=="object"&&n!==null}t.isObjectLike=e}(nD)),nD}var wK;function g3e(){return wK||(wK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=nae(),n=p3e();function r(i){return n.isObjectLike(i)&&e.isArrayLike(i)}t.isArrayLikeObject=r}(Q2)),Q2}var rD={},iD={},SK;function m3e(){return SK||(SK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=H4();function n(r){return function(i){return e.get(i,r)}}t.property=n}(iD)),iD}var sD={},oD={},aD={},lD={},CK;function rae(){return CK||(CK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n!==null&&(typeof n=="object"||typeof n=="function")}t.isObject=e}(lD)),lD}var cD={},EK;function iae(){return EK||(EK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n==null||typeof n!="object"&&typeof n!="function"}t.isPrimitive=e}(cD)),cD}var uD={},TK;function Z4(){return TK||(TK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n,r){return n===r||Number.isNaN(n)&&Number.isNaN(r)}t.eq=e}(uD)),uD}var IK;function y3e(){return IK||(IK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Q4(),n=rae(),r=iae(),i=Z4();function s(d,h,f){return typeof f!="function"?e.isMatch(d,h):o(d,h,function y(b,v,x,C,E,I){const P=f(b,v,x,C,E,I);return P!==void 0?!!P:o(b,v,y,I)},new Map)}function o(d,h,f,y){if(h===d)return!0;switch(typeof h){case"object":return a(d,h,f,y);case"function":return Object.keys(h).length>0?o(d,{...h},f,y):i.eq(d,h);default:return n.isObject(d)?typeof h=="string"?h==="":!0:i.eq(d,h)}}function a(d,h,f,y){if(h==null)return!0;if(Array.isArray(h))return c(d,h,f,y);if(h instanceof Map)return l(d,h,f,y);if(h instanceof Set)return u(d,h,f,y);const b=Object.keys(h);if(d==null)return b.length===0;if(b.length===0)return!0;if(y&&y.has(h))return y.get(h)===d;y&&y.set(h,d);try{for(let v=0;v<b.length;v++){const x=b[v];if(!r.isPrimitive(d)&&!(x in d)||h[x]===void 0&&d[x]!==void 0||h[x]===null&&d[x]!==null||!f(d[x],h[x],x,d,h,y))return!1}return!0}finally{y&&y.delete(h)}}function l(d,h,f,y){if(h.size===0)return!0;if(!(d instanceof Map))return!1;for(const[b,v]of h.entries()){const x=d.get(b);if(f(x,v,b,d,h,y)===!1)return!1}return!0}function c(d,h,f,y){if(h.length===0)return!0;if(!Array.isArray(d))return!1;const b=new Set;for(let v=0;v<h.length;v++){const x=h[v];let C=!1;for(let E=0;E<d.length;E++){if(b.has(E))continue;const I=d[E];let P=!1;if(f(I,x,v,d,h,y)&&(P=!0),P){b.add(E),C=!0;break}}if(!C)return!1}return!0}function u(d,h,f,y){return h.size===0?!0:d instanceof Set?c([...d],[...h],f,y):!1}t.isMatchWith=s,t.isSetMatch=u}(aD)),aD}var PK;function Q4(){return PK||(PK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=y3e();function n(r,i){return e.isMatchWith(r,i,()=>{})}t.isMatch=n}(oD)),oD}var dD={},hD={},fD={},_K;function sae(){return _K||(_K=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return Object.getOwnPropertySymbols(n).filter(r=>Object.prototype.propertyIsEnumerable.call(n,r))}t.getSymbols=e}(fD)),fD}var pD={},kK;function e5(){return kK||(kK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}t.getTag=e}(pD)),pD}var gD={},AK;function t5(){return AK||(AK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e="[object RegExp]",n="[object String]",r="[object Number]",i="[object Boolean]",s="[object Arguments]",o="[object Symbol]",a="[object Date]",l="[object Map]",c="[object Set]",u="[object Array]",d="[object Function]",h="[object ArrayBuffer]",f="[object Object]",y="[object Error]",b="[object DataView]",v="[object Uint8Array]",x="[object Uint8ClampedArray]",C="[object Uint16Array]",E="[object Uint32Array]",I="[object BigUint64Array]",P="[object Int8Array]",_="[object Int16Array]",A="[object Int32Array]",D="[object BigInt64Array]",L="[object Float32Array]",z="[object Float64Array]";t.argumentsTag=s,t.arrayBufferTag=h,t.arrayTag=u,t.bigInt64ArrayTag=D,t.bigUint64ArrayTag=I,t.booleanTag=i,t.dataViewTag=b,t.dateTag=a,t.errorTag=y,t.float32ArrayTag=L,t.float64ArrayTag=z,t.functionTag=d,t.int16ArrayTag=_,t.int32ArrayTag=A,t.int8ArrayTag=P,t.mapTag=l,t.numberTag=r,t.objectTag=f,t.regexpTag=e,t.setTag=c,t.stringTag=n,t.symbolTag=o,t.uint16ArrayTag=C,t.uint32ArrayTag=E,t.uint8ArrayTag=v,t.uint8ClampedArrayTag=x}(gD)),gD}var mD={},MK;function v3e(){return MK||(MK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}t.isTypedArray=e}(mD)),mD}var OK;function oae(){return OK||(OK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=sae(),n=e5(),r=t5(),i=iae(),s=v3e();function o(u,d){return a(u,void 0,u,new Map,d)}function a(u,d,h,f=new Map,y=void 0){const b=y==null?void 0:y(u,d,h,f);if(b!==void 0)return b;if(i.isPrimitive(u))return u;if(f.has(u))return f.get(u);if(Array.isArray(u)){const v=new Array(u.length);f.set(u,v);for(let x=0;x<u.length;x++)v[x]=a(u[x],x,h,f,y);return Object.hasOwn(u,"index")&&(v.index=u.index),Object.hasOwn(u,"input")&&(v.input=u.input),v}if(u instanceof Date)return new Date(u.getTime());if(u instanceof RegExp){const v=new RegExp(u.source,u.flags);return v.lastIndex=u.lastIndex,v}if(u instanceof Map){const v=new Map;f.set(u,v);for(const[x,C]of u)v.set(x,a(C,x,h,f,y));return v}if(u instanceof Set){const v=new Set;f.set(u,v);for(const x of u)v.add(a(x,void 0,h,f,y));return v}if(typeof Buffer<"u"&&Buffer.isBuffer(u))return u.subarray();if(s.isTypedArray(u)){const v=new(Object.getPrototypeOf(u)).constructor(u.length);f.set(u,v);for(let x=0;x<u.length;x++)v[x]=a(u[x],x,h,f,y);return v}if(u instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&u instanceof SharedArrayBuffer)return u.slice(0);if(u instanceof DataView){const v=new DataView(u.buffer.slice(0),u.byteOffset,u.byteLength);return f.set(u,v),l(v,u,h,f,y),v}if(typeof File<"u"&&u instanceof File){const v=new File([u],u.name,{type:u.type});return f.set(u,v),l(v,u,h,f,y),v}if(u instanceof Blob){const v=new Blob([u],{type:u.type});return f.set(u,v),l(v,u,h,f,y),v}if(u instanceof Error){const v=new u.constructor;return f.set(u,v),v.message=u.message,v.name=u.name,v.stack=u.stack,v.cause=u.cause,l(v,u,h,f,y),v}if(typeof u=="object"&&c(u)){const v=Object.create(Object.getPrototypeOf(u));return f.set(u,v),l(v,u,h,f,y),v}return u}function l(u,d,h=u,f,y){const b=[...Object.keys(d),...e.getSymbols(d)];for(let v=0;v<b.length;v++){const x=b[v],C=Object.getOwnPropertyDescriptor(u,x);(C==null||C.writable)&&(u[x]=a(d[x],x,h,f,y))}}function c(u){switch(n.getTag(u)){case r.argumentsTag:case r.arrayTag:case r.arrayBufferTag:case r.dataViewTag:case r.booleanTag:case r.dateTag:case r.float32ArrayTag:case r.float64ArrayTag:case r.int8ArrayTag:case r.int16ArrayTag:case r.int32ArrayTag:case r.mapTag:case r.numberTag:case r.objectTag:case r.regexpTag:case r.setTag:case r.stringTag:case r.symbolTag:case r.uint8ArrayTag:case r.uint8ClampedArrayTag:case r.uint16ArrayTag:case r.uint32ArrayTag:return!0;default:return!1}}t.cloneDeepWith=o,t.cloneDeepWithImpl=a,t.copyProperties=l}(hD)),hD}var DK;function b3e(){return DK||(DK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=oae();function n(r){return e.cloneDeepWithImpl(r,void 0,r,new Map,void 0)}t.cloneDeep=n}(dD)),dD}var RK;function x3e(){return RK||(RK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Q4(),n=b3e();function r(i){return i=n.cloneDeep(i),s=>e.isMatch(s,i)}t.matches=r}(sD)),sD}var yD={},vD={},bD={},NK;function w3e(){return NK||(NK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=oae(),n=t5();function r(i,s){return e.cloneDeepWith(i,(o,a,l,c)=>{const u=s==null?void 0:s(o,a,l,c);if(u!==void 0)return u;if(typeof i=="object")switch(Object.prototype.toString.call(i)){case n.numberTag:case n.stringTag:case n.booleanTag:{const d=new i.constructor(i==null?void 0:i.valueOf());return e.copyProperties(d,i),d}case n.argumentsTag:{const d={};return e.copyProperties(d,i),d.length=i.length,d[Symbol.iterator]=i[Symbol.iterator],d}default:return}})}t.cloneDeepWith=r}(bD)),bD}var jK;function S3e(){return jK||(jK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=w3e();function n(r){return e.cloneDeepWith(r)}t.cloneDeep=n}(vD)),vD}var xD={},wD={},LK;function aae(){return LK||(LK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=/^(?:0|[1-9]\d*)$/;function n(r,i=Number.MAX_SAFE_INTEGER){switch(typeof r){case"number":return Number.isInteger(r)&&r>=0&&r<i;case"symbol":return!1;case"string":return e.test(r)}}t.isIndex=n}(wD)),wD}var SD={},FK;function C3e(){return FK||(FK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=e5();function n(r){return r!==null&&typeof r=="object"&&e.getTag(r)==="[object Arguments]"}t.isArguments=n}(SD)),SD}var $K;function E3e(){return $K||($K=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Aoe(),n=aae(),r=C3e(),i=U4();function s(o,a){let l;if(Array.isArray(a)?l=a:typeof a=="string"&&e.isDeepKey(a)&&(o==null?void 0:o[a])==null?l=i.toPath(a):l=[a],l.length===0)return!1;let c=o;for(let u=0;u<l.length;u++){const d=l[u];if((c==null||!Object.hasOwn(c,d))&&!((Array.isArray(c)||r.isArguments(c))&&n.isIndex(d)&&d<c.length))return!1;c=c[d]}return!0}t.has=s}(xD)),xD}var BK;function T3e(){return BK||(BK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Q4(),n=Moe(),r=S3e(),i=H4(),s=E3e();function o(a,l){switch(typeof a){case"object":{Object.is(a==null?void 0:a.valueOf(),-0)&&(a="-0");break}case"number":{a=n.toKey(a);break}}return l=r.cloneDeep(l),function(c){const u=i.get(c,a);return u===void 0?s.has(c,a):l===void 0?u===void 0:e.isMatch(u,l)}}t.matchesProperty=o}(yD)),yD}var zK;function I3e(){return zK||(zK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=tae(),n=m3e(),r=x3e(),i=T3e();function s(o){if(o==null)return e.identity;switch(typeof o){case"function":return o;case"object":return Array.isArray(o)&&o.length===2?i.matchesProperty(o[0],o[1]):r.matches(o);case"string":case"symbol":case"number":return n.property(o)}}t.iteratee=s}(rD)),rD}var UK;function P3e(){return UK||(UK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=h3e(),n=tae(),r=g3e(),i=I3e();function s(o,a=n.identity){return r.isArrayLikeObject(o)?e.uniqBy(Array.from(o),i.iteratee(a)):[]}t.uniqBy=s}(X2)),X2}var CD,HK;function _3e(){return HK||(HK=1,CD=P3e().uniqBy),CD}var k3e=_3e();const VK=Oi(k3e);function lae(t,e,n){return e===!0?VK(t,n):typeof e=="function"?VK(t,e):t}var ED={exports:{}},TD={},ID={exports:{}},PD={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WK;function A3e(){if(WK)return PD;WK=1;var t=hv();function e(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,i=t.useEffect,s=t.useLayoutEffect,o=t.useDebugValue;function a(d,h){var f=h(),y=r({inst:{value:f,getSnapshot:h}}),b=y[0].inst,v=y[1];return s(function(){b.value=f,b.getSnapshot=h,l(b)&&v({inst:b})},[d,f,h]),i(function(){return l(b)&&v({inst:b}),d(function(){l(b)&&v({inst:b})})},[d]),o(f),f}function l(d){var h=d.getSnapshot;d=d.value;try{var f=h();return!n(d,f)}catch{return!0}}function c(d,h){return h()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return PD.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,PD}var KK;function M3e(){return KK||(KK=1,ID.exports=A3e()),ID.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qK;function O3e(){if(qK)return TD;qK=1;var t=hv(),e=M3e();function n(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var r=typeof Object.is=="function"?Object.is:n,i=e.useSyncExternalStore,s=t.useRef,o=t.useEffect,a=t.useMemo,l=t.useDebugValue;return TD.useSyncExternalStoreWithSelector=function(c,u,d,h,f){var y=s(null);if(y.current===null){var b={hasValue:!1,value:null};y.current=b}else b=y.current;y=a(function(){function x(_){if(!C){if(C=!0,E=_,_=h(_),f!==void 0&&b.hasValue){var A=b.value;if(f(A,_))return I=A}return I=_}if(A=I,r(E,_))return A;var D=h(_);return f!==void 0&&f(A,D)?(E=_,A):(E=_,I=D)}var C=!1,E,I,P=d===void 0?null:d;return[function(){return x(u())},P===null?void 0:function(){return x(P())}]},[u,d,h,f]);var v=i(c,y[0],y[1]);return o(function(){b.hasValue=!0,b.value=v},[v]),l(v),v},TD}var GK;function D3e(){return GK||(GK=1,ED.exports=O3e()),ED.exports}var R3e=D3e(),n5=S.createContext(null),N3e=t=>t,Di=()=>{var t=S.useContext(n5);return t?t.store.dispatch:N3e},UE=()=>{},j3e=()=>UE,L3e=(t,e)=>t===e;function Kt(t){var e=S.useContext(n5);return R3e.useSyncExternalStoreWithSelector(e?e.subscription.addNestedSub:j3e,e?e.store.getState:UE,e?e.store.getState:UE,e?t:UE,L3e)}function F3e(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function $3e(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function B3e(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(n=>typeof n=="function")){const n=t.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${n}]`)}}var YK=t=>Array.isArray(t)?t:[t];function z3e(t){const e=Array.isArray(t[0])?t[0]:t;return B3e(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function U3e(t,e){const n=[],{length:r}=t;for(let i=0;i<r;i++)n.push(t[i].apply(null,e));return n}var H3e=class{constructor(t){this.value=t}deref(){return this.value}},V3e=typeof WeakRef<"u"?WeakRef:H3e,W3e=0,XK=1;function vC(){return{s:W3e,v:void 0,o:null,p:null}}function cae(t,e={}){let n=vC();const{resultEqualityCheck:r}=e;let i,s=0;function o(){var d;let a=n;const{length:l}=arguments;for(let h=0,f=l;h<f;h++){const y=arguments[h];if(typeof y=="function"||typeof y=="object"&&y!==null){let b=a.o;b===null&&(a.o=b=new WeakMap);const v=b.get(y);v===void 0?(a=vC(),b.set(y,a)):a=v}else{let b=a.p;b===null&&(a.p=b=new Map);const v=b.get(y);v===void 0?(a=vC(),b.set(y,a)):a=v}}const c=a;let u;if(a.s===XK)u=a.v;else if(u=t.apply(null,arguments),s++,r){const h=((d=i==null?void 0:i.deref)==null?void 0:d.call(i))??i;h!=null&&r(h,u)&&(u=h,s!==0&&s--),i=typeof u=="object"&&u!==null||typeof u=="function"?new V3e(u):u}return c.s=XK,c.v=u,u}return o.clearCache=()=>{n=vC(),o.resetResultsCount()},o.resultsCount=()=>s,o.resetResultsCount=()=>{s=0},o}function K3e(t,...e){const n=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,r=(...i)=>{let s=0,o=0,a,l={},c=i.pop();typeof c=="object"&&(l=c,c=i.pop()),F3e(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...n,...l},{memoize:d,memoizeOptions:h=[],argsMemoize:f=cae,argsMemoizeOptions:y=[]}=u,b=YK(h),v=YK(y),x=z3e(i),C=d(function(){return s++,c.apply(null,arguments)},...b),E=f(function(){o++;const P=U3e(x,arguments);return a=C.apply(null,P),a},...v);return Object.assign(E,{resultFunc:c,memoizedResultFunc:C,dependencies:x,dependencyRecomputations:()=>o,resetDependencyRecomputations:()=>{o=0},lastResult:()=>a,recomputations:()=>s,resetRecomputations:()=>{s=0},memoize:d,argsMemoize:f})};return Object.assign(r,{withTypes:()=>r}),r}var he=K3e(cae),q3e=Object.assign((t,e=he)=>{$3e(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const n=Object.keys(t),r=n.map(s=>t[s]);return e(r,(...s)=>s.reduce((o,a,l)=>(o[n[l]]=a,o),{}))},{withTypes:()=>q3e}),_D={},kD={},AD={},JK;function G3e(){return JK||(JK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return typeof r=="symbol"?1:r===null?2:r===void 0?3:r!==r?4:0}const n=(r,i,s)=>{if(r!==i){const o=e(r),a=e(i);if(o===a&&o===0){if(r<i)return s==="desc"?1:-1;if(r>i)return s==="desc"?-1:1}return s==="desc"?a-o:o-a}return 0};t.compareValues=n}(AD)),AD}var MD={},OD={},ZK;function uae(){return ZK||(ZK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return typeof n=="symbol"||n instanceof Symbol}t.isSymbol=e}(OD)),OD}var QK;function Y3e(){return QK||(QK=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=uae(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function i(s,o){return Array.isArray(s)?!1:typeof s=="number"||typeof s=="boolean"||s==null||e.isSymbol(s)?!0:typeof s=="string"&&(r.test(s)||!n.test(s))||o!=null&&Object.hasOwn(o,s)}t.isKey=i}(MD)),MD}var eq;function X3e(){return eq||(eq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=G3e(),n=Y3e(),r=U4();function i(s,o,a,l){if(s==null)return[];a=l?void 0:a,Array.isArray(s)||(s=Object.values(s)),Array.isArray(o)||(o=o==null?[null]:[o]),o.length===0&&(o=[null]),Array.isArray(a)||(a=a==null?[]:[a]),a=a.map(f=>String(f));const c=(f,y)=>{let b=f;for(let v=0;v<y.length&&b!=null;++v)b=b[y[v]];return b},u=(f,y)=>y==null||f==null?y:typeof f=="object"&&"key"in f?Object.hasOwn(y,f.key)?y[f.key]:c(y,f.path):typeof f=="function"?f(y):Array.isArray(f)?c(y,f):typeof y=="object"?y[f]:y,d=o.map(f=>(Array.isArray(f)&&f.length===1&&(f=f[0]),f==null||typeof f=="function"||Array.isArray(f)||n.isKey(f)?f:{key:f,path:r.toPath(f)}));return s.map(f=>({original:f,criteria:d.map(y=>u(y,f))})).slice().sort((f,y)=>{for(let b=0;b<d.length;b++){const v=e.compareValues(f.criteria[b],y.criteria[b],a[b]);if(v!==0)return v}return 0}).map(f=>f.original)}t.orderBy=i}(kD)),kD}var DD={},tq;function J3e(){return tq||(tq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n,r=1){const i=[],s=Math.floor(r),o=(a,l)=>{for(let c=0;c<a.length;c++){const u=a[c];Array.isArray(u)&&l<s?o(u,l+1):i.push(u)}};return o(n,0),i}t.flatten=e}(DD)),DD}var RD={},nq;function dae(){return nq||(nq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=aae(),n=nae(),r=rae(),i=Z4();function s(o,a,l){return r.isObject(l)&&(typeof a=="number"&&n.isArrayLike(l)&&e.isIndex(a)&&a<l.length||typeof a=="string"&&a in l)?i.eq(l[a],o):!1}t.isIterateeCall=s}(RD)),RD}var rq;function Z3e(){return rq||(rq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=X3e(),n=J3e(),r=dae();function i(s,...o){const a=o.length;return a>1&&r.isIterateeCall(s,o[0],o[1])?o=[]:a>2&&r.isIterateeCall(o[0],o[1],o[2])&&(o=[o[0]]),e.orderBy(s,n.flatten(o),["asc"])}t.sortBy=i}(_D)),_D}var ND,iq;function Q3e(){return iq||(iq=1,ND=Z3e().sortBy),ND}var e$e=Q3e();const V_=Oi(e$e);var hae=t=>t.legend.settings,t$e=t=>t.legend.size,n$e=t=>t.legend.payload,r$e=he([n$e,hae],(t,e)=>{var{itemSorter:n}=e,r=t.flat(1);return n?V_(r,n):r});function i$e(){return Kt(r$e)}var bC=1;function fae(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[e,n]=S.useState({height:0,left:0,top:0,width:0}),r=S.useCallback(i=>{if(i!=null){var s=i.getBoundingClientRect(),o={height:s.height,left:s.left,top:s.top,width:s.width};(Math.abs(o.height-e.height)>bC||Math.abs(o.left-e.left)>bC||Math.abs(o.top-e.top)>bC||Math.abs(o.width-e.width)>bC)&&n({height:o.height,left:o.left,top:o.top,width:o.width})}},[e.width,e.height,e.top,e.left,...t]);return[e,r]}var pae=Symbol.for("immer-nothing"),sq=Symbol.for("immer-draftable"),La=Symbol.for("immer-state");function nc(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Dy=Object.getPrototypeOf;function sg(t){return!!t&&!!t[La]}function bd(t){var e;return t?gae(t)||Array.isArray(t)||!!t[sq]||!!((e=t.constructor)!=null&&e[sq])||K_(t)||q_(t):!1}var s$e=Object.prototype.constructor.toString();function gae(t){if(!t||typeof t!="object")return!1;const e=Dy(t);if(e===null)return!0;const n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===s$e}function nI(t,e){W_(t)===0?Reflect.ownKeys(t).forEach(n=>{e(n,t[n],t)}):t.forEach((n,r)=>e(r,n,t))}function W_(t){const e=t[La];return e?e.type_:Array.isArray(t)?1:K_(t)?2:q_(t)?3:0}function QF(t,e){return W_(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function mae(t,e,n){const r=W_(t);r===2?t.set(e,n):r===3?t.add(n):t[e]=n}function o$e(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function K_(t){return t instanceof Map}function q_(t){return t instanceof Set}function yp(t){return t.copy_||t.base_}function e3(t,e){if(K_(t))return new Map(t);if(q_(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const n=gae(t);if(e===!0||e==="class_only"&&!n){const r=Object.getOwnPropertyDescriptors(t);delete r[La];let i=Reflect.ownKeys(r);for(let s=0;s<i.length;s++){const o=i[s],a=r[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(r[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[o]})}return Object.create(Dy(t),r)}else{const r=Dy(t);if(r!==null&&n)return{...t};const i=Object.create(r);return Object.assign(i,t)}}function r5(t,e=!1){return G_(t)||sg(t)||!bd(t)||(W_(t)>1&&(t.set=t.add=t.clear=t.delete=a$e),Object.freeze(t),e&&Object.entries(t).forEach(([n,r])=>r5(r,!0))),t}function a$e(){nc(2)}function G_(t){return Object.isFrozen(t)}var l$e={};function og(t){const e=l$e[t];return e||nc(0,t),e}var Kx;function yae(){return Kx}function c$e(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function oq(t,e){e&&(og("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function t3(t){n3(t),t.drafts_.forEach(u$e),t.drafts_=null}function n3(t){t===Kx&&(Kx=t.parent_)}function aq(t){return Kx=c$e(Kx,t)}function u$e(t){const e=t[La];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function lq(t,e){e.unfinalizedDrafts_=e.drafts_.length;const n=e.drafts_[0];return t!==void 0&&t!==n?(n[La].modified_&&(t3(e),nc(4)),bd(t)&&(t=rI(e,t),e.parent_||iI(e,t)),e.patches_&&og("Patches").generateReplacementPatches_(n[La].base_,t,e.patches_,e.inversePatches_)):t=rI(e,n,[]),t3(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==pae?t:void 0}function rI(t,e,n){if(G_(e))return e;const r=e[La];if(!r)return nI(e,(i,s)=>cq(t,r,e,i,s,n)),e;if(r.scope_!==t)return e;if(!r.modified_)return iI(t,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const i=r.copy_;let s=i,o=!1;r.type_===3&&(s=new Set(i),i.clear(),o=!0),nI(s,(a,l)=>cq(t,r,i,a,l,n,o)),iI(t,i,!1),n&&t.patches_&&og("Patches").generatePatches_(r,n,t.patches_,t.inversePatches_)}return r.copy_}function cq(t,e,n,r,i,s,o){if(sg(i)){const a=s&&e&&e.type_!==3&&!QF(e.assigned_,r)?s.concat(r):void 0,l=rI(t,i,a);if(mae(n,r,l),sg(l))t.canAutoFreeze_=!1;else return}else o&&n.add(i);if(bd(i)&&!G_(i)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;rI(t,i),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(n,r)&&iI(t,i)}}function iI(t,e,n=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&r5(e,n)}function d$e(t,e){const n=Array.isArray(t),r={type_:n?1:0,scope_:e?e.scope_:yae(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,s=i5;n&&(i=[r],s=qx);const{revoke:o,proxy:a}=Proxy.revocable(i,s);return r.draft_=a,r.revoke_=o,a}var i5={get(t,e){if(e===La)return t;const n=yp(t);if(!QF(n,e))return h$e(t,n,e);const r=n[e];return t.finalized_||!bd(r)?r:r===jD(t.base_,e)?(LD(t),t.copy_[e]=i3(r,t)):r},has(t,e){return e in yp(t)},ownKeys(t){return Reflect.ownKeys(yp(t))},set(t,e,n){const r=vae(yp(t),e);if(r!=null&&r.set)return r.set.call(t.draft_,n),!0;if(!t.modified_){const i=jD(yp(t),e),s=i==null?void 0:i[La];if(s&&s.base_===n)return t.copy_[e]=n,t.assigned_[e]=!1,!0;if(o$e(n,i)&&(n!==void 0||QF(t.base_,e)))return!0;LD(t),r3(t)}return t.copy_[e]===n&&(n!==void 0||e in t.copy_)||Number.isNaN(n)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=n,t.assigned_[e]=!0),!0},deleteProperty(t,e){return jD(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,LD(t),r3(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const n=yp(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},defineProperty(){nc(11)},getPrototypeOf(t){return Dy(t.base_)},setPrototypeOf(){nc(12)}},qx={};nI(i5,(t,e)=>{qx[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});qx.deleteProperty=function(t,e){return qx.set.call(this,t,e,void 0)};qx.set=function(t,e,n){return i5.set.call(this,t[0],e,n,t[0])};function jD(t,e){const n=t[La];return(n?yp(n):t)[e]}function h$e(t,e,n){var i;const r=vae(e,n);return r?"value"in r?r.value:(i=r.get)==null?void 0:i.call(t.draft_):void 0}function vae(t,e){if(!(e in t))return;let n=Dy(t);for(;n;){const r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Dy(n)}}function r3(t){t.modified_||(t.modified_=!0,t.parent_&&r3(t.parent_))}function LD(t){t.copy_||(t.copy_=e3(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var f$e=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,n,r)=>{if(typeof e=="function"&&typeof n!="function"){const s=n;n=e;const o=this;return function(l=s,...c){return o.produce(l,u=>n.call(this,u,...c))}}typeof n!="function"&&nc(6),r!==void 0&&typeof r!="function"&&nc(7);let i;if(bd(e)){const s=aq(this),o=i3(e,void 0);let a=!0;try{i=n(o),a=!1}finally{a?t3(s):n3(s)}return oq(s,r),lq(i,s)}else if(!e||typeof e!="object"){if(i=n(e),i===void 0&&(i=e),i===pae&&(i=void 0),this.autoFreeze_&&r5(i,!0),r){const s=[],o=[];og("Patches").generateReplacementPatches_(e,i,s,o),r(s,o)}return i}else nc(1,e)},this.produceWithPatches=(e,n)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,l=>e(l,...a));let r,i;return[this.produce(e,n,(o,a)=>{r=o,i=a}),r,i]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){bd(t)||nc(8),sg(t)&&(t=ud(t));const e=aq(this),n=i3(t,void 0);return n[La].isManual_=!0,n3(e),n}finishDraft(t,e){const n=t&&t[La];(!n||!n.isManual_)&&nc(9);const{scope_:r}=n;return oq(r,e),lq(void 0,r)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let n;for(n=e.length-1;n>=0;n--){const i=e[n];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}n>-1&&(e=e.slice(n+1));const r=og("Patches").applyPatches_;return sg(t)?r(t,e):this.produce(t,i=>r(i,e))}};function i3(t,e){const n=K_(t)?og("MapSet").proxyMap_(t,e):q_(t)?og("MapSet").proxySet_(t,e):d$e(t,e);return(e?e.scope_:yae()).drafts_.push(n),n}function ud(t){return sg(t)||nc(10,t),bae(t)}function bae(t){if(!bd(t)||G_(t))return t;const e=t[La];let n;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,n=e3(t,e.scope_.immer_.useStrictShallowCopy_)}else n=e3(t,!0);return nI(n,(r,i)=>{mae(n,r,bae(i))}),e&&(e.finalized_=!1),n}var Fa=new f$e,xae=Fa.produce;Fa.produceWithPatches.bind(Fa);Fa.setAutoFreeze.bind(Fa);Fa.setUseStrictShallowCopy.bind(Fa);Fa.applyPatches.bind(Fa);Fa.createDraft.bind(Fa);Fa.finishDraft.bind(Fa);function wae(t){return({dispatch:n,getState:r})=>i=>s=>typeof s=="function"?s(n,r,t):i(s)}var p$e=wae(),g$e=wae,m$e=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Fx:Fx.apply(null,arguments)};function Ml(t,e){function n(...r){if(e){let i=e(...r);if(!i)throw new Error(ka(0));return{type:t,payload:i.payload,..."meta"in i&&{meta:i.meta},..."error"in i&&{error:i.error}}}return{type:t,payload:r[0]}}return n.toString=()=>`${t}`,n.type=t,n.match=r=>mse(r)&&r.type===t,n}var Sae=class Cb extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Cb.prototype)}static get[Symbol.species](){return Cb}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new Cb(...e[0].concat(this)):new Cb(...e.concat(this))}};function uq(t){return bd(t)?xae(t,()=>{}):t}function xC(t,e,n){return t.has(e)?t.get(e):t.set(e,n(e)).get(e)}function y$e(t){return typeof t=="boolean"}var v$e=()=>function(e){const{thunk:n=!0,immutableCheck:r=!0,serializableCheck:i=!0,actionCreatorCheck:s=!0}=e??{};let o=new Sae;return n&&(y$e(n)?o.push(p$e):o.push(g$e(n.extraArgument))),o},b$e="RTK_autoBatch",dq=t=>e=>{setTimeout(e,t)},x$e=(t={type:"raf"})=>e=>(...n)=>{const r=e(...n);let i=!0,s=!1,o=!1;const a=new Set,l=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:dq(10):t.type==="callback"?t.queueNotification:dq(t.timeout),c=()=>{o=!1,s&&(s=!1,a.forEach(u=>u()))};return Object.assign({},r,{subscribe(u){const d=()=>i&&u(),h=r.subscribe(d);return a.add(u),()=>{h(),a.delete(u)}},dispatch(u){var d;try{return i=!((d=u==null?void 0:u.meta)!=null&&d[b$e]),s=!i,s&&(o||(o=!0,l(c))),r.dispatch(u)}finally{i=!0}}})},w$e=t=>function(n){const{autoBatch:r=!0}=n??{};let i=new Sae(t);return r&&i.push(x$e(typeof r=="object"?r:void 0)),i};function S$e(t){const e=v$e(),{reducer:n=void 0,middleware:r,devTools:i=!0,preloadedState:s=void 0,enhancers:o=void 0}=t||{};let a;if(typeof n=="function")a=n;else if(v4(n))a=pse(n);else throw new Error(ka(1));let l;typeof r=="function"?l=r(e):l=e();let c=Fx;i&&(c=m$e({trace:!1,...typeof i=="object"&&i}));const u=gse(...l),d=w$e(u);let h=typeof o=="function"?o(d):d();const f=c(...h);return b4(a,s,f)}function Cae(t){const e={},n=[];let r;const i={addCase(s,o){const a=typeof s=="string"?s:s.type;if(!a)throw new Error(ka(28));if(a in e)throw new Error(ka(29));return e[a]=o,i},addMatcher(s,o){return n.push({matcher:s,reducer:o}),i},addDefaultCase(s){return r=s,i}};return t(i),[e,n,r]}function C$e(t){return typeof t=="function"}function E$e(t,e){let[n,r,i]=Cae(e),s;if(C$e(t))s=()=>uq(t());else{const a=uq(t);s=()=>a}function o(a=s(),l){let c=[n[l.type],...r.filter(({matcher:u})=>u(l)).map(({reducer:u})=>u)];return c.filter(u=>!!u).length===0&&(c=[i]),c.reduce((u,d)=>{if(d)if(sg(u)){const f=d(u,l);return f===void 0?u:f}else{if(bd(u))return xae(u,h=>d(h,l));{const h=d(u,l);if(h===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return h}}return u},a)}return o.getInitialState=s,o}var T$e="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",I$e=(t=21)=>{let e="",n=t;for(;n--;)e+=T$e[Math.random()*64|0];return e},P$e=Symbol.for("rtk-slice-createasyncthunk");function _$e(t,e){return`${t}/${e}`}function k$e({creators:t}={}){var n;const e=(n=t==null?void 0:t.asyncThunk)==null?void 0:n[P$e];return function(i){const{name:s,reducerPath:o=s}=i;if(!s)throw new Error(ka(11));const a=(typeof i.reducers=="function"?i.reducers(M$e()):i.reducers)||{},l=Object.keys(a),c={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},u={addCase(I,P){const _=typeof I=="string"?I:I.type;if(!_)throw new Error(ka(12));if(_ in c.sliceCaseReducersByType)throw new Error(ka(13));return c.sliceCaseReducersByType[_]=P,u},addMatcher(I,P){return c.sliceMatchers.push({matcher:I,reducer:P}),u},exposeAction(I,P){return c.actionCreators[I]=P,u},exposeCaseReducer(I,P){return c.sliceCaseReducersByName[I]=P,u}};l.forEach(I=>{const P=a[I],_={reducerName:I,type:_$e(s,I),createNotation:typeof i.reducers=="function"};D$e(P)?N$e(_,P,u,e):O$e(_,P,u)});function d(){const[I={},P=[],_=void 0]=typeof i.extraReducers=="function"?Cae(i.extraReducers):[i.extraReducers],A={...I,...c.sliceCaseReducersByType};return E$e(i.initialState,D=>{for(let L in A)D.addCase(L,A[L]);for(let L of c.sliceMatchers)D.addMatcher(L.matcher,L.reducer);for(let L of P)D.addMatcher(L.matcher,L.reducer);_&&D.addDefaultCase(_)})}const h=I=>I,f=new Map,y=new WeakMap;let b;function v(I,P){return b||(b=d()),b(I,P)}function x(){return b||(b=d()),b.getInitialState()}function C(I,P=!1){function _(D){let L=D[I];return typeof L>"u"&&P&&(L=xC(y,_,x)),L}function A(D=h){const L=xC(f,P,()=>new WeakMap);return xC(L,D,()=>{const z={};for(const[$,H]of Object.entries(i.selectors??{}))z[$]=A$e(H,D,()=>xC(y,D,x),P);return z})}return{reducerPath:I,getSelectors:A,get selectors(){return A(_)},selectSlice:_}}const E={name:s,reducer:v,actions:c.actionCreators,caseReducers:c.sliceCaseReducersByName,getInitialState:x,...C(o),injectInto(I,{reducerPath:P,..._}={}){const A=P??o;return I.inject({reducerPath:A,reducer:v},_),{...E,...C(A,!0)}}};return E}}function A$e(t,e,n,r){function i(s,...o){let a=e(s);return typeof a>"u"&&r&&(a=n()),t(a,...o)}return i.unwrapped=t,i}var Ua=k$e();function M$e(){function t(e,n){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...n}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...n){return e(...n)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,n){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:n}},asyncThunk:t}}function O$e({type:t,reducerName:e,createNotation:n},r,i){let s,o;if("reducer"in r){if(n&&!R$e(r))throw new Error(ka(17));s=r.reducer,o=r.prepare}else s=r;i.addCase(t,s).exposeCaseReducer(e,s).exposeAction(e,o?Ml(t,o):Ml(t))}function D$e(t){return t._reducerDefinitionType==="asyncThunk"}function R$e(t){return t._reducerDefinitionType==="reducerWithPrepare"}function N$e({type:t,reducerName:e},n,r,i){if(!i)throw new Error(ka(18));const{payloadCreator:s,fulfilled:o,pending:a,rejected:l,settled:c,options:u}=n,d=i(t,s,u);r.exposeAction(e,d),o&&r.addCase(d.fulfilled,o),a&&r.addCase(d.pending,a),l&&r.addCase(d.rejected,l),c&&r.addMatcher(d.settled,c),r.exposeCaseReducer(e,{fulfilled:o||wC,pending:a||wC,rejected:l||wC,settled:c||wC})}function wC(){}var j$e="task",Eae="listener",Tae="completed",s5="cancelled",L$e=`task-${s5}`,F$e=`task-${Tae}`,s3=`${Eae}-${s5}`,$$e=`${Eae}-${Tae}`,Y_=class{constructor(t){N(this,"name","TaskAbortError");N(this,"message");this.code=t,this.message=`${j$e} ${s5} (reason: ${t})`}},o5=(t,e)=>{if(typeof t!="function")throw new TypeError(ka(32))},sI=()=>{},Iae=(t,e=sI)=>(t.catch(e),t),Pae=(t,e)=>(t.addEventListener("abort",e,{once:!0}),()=>t.removeEventListener("abort",e)),$p=(t,e)=>{const n=t.signal;n.aborted||("reason"in n||Object.defineProperty(n,"reason",{enumerable:!0,value:e,configurable:!0,writable:!0}),t.abort(e))},Bp=t=>{if(t.aborted){const{reason:e}=t;throw new Y_(e)}};function _ae(t,e){let n=sI;return new Promise((r,i)=>{const s=()=>i(new Y_(t.reason));if(t.aborted){s();return}n=Pae(t,s),e.finally(()=>n()).then(r,i)}).finally(()=>{n=sI})}var B$e=async(t,e)=>{try{return await Promise.resolve(),{status:"ok",value:await t()}}catch(n){return{status:n instanceof Y_?"cancelled":"rejected",error:n}}finally{e==null||e()}},oI=t=>e=>Iae(_ae(t,e).then(n=>(Bp(t),n))),kae=t=>{const e=oI(t);return n=>e(new Promise(r=>setTimeout(r,n)))},{assign:ly}=Object,hq={},X_="listenerMiddleware",z$e=(t,e)=>{const n=r=>Pae(t,()=>$p(r,t.reason));return(r,i)=>{o5(r);const s=new AbortController;n(s);const o=B$e(async()=>{Bp(t),Bp(s.signal);const a=await r({pause:oI(s.signal),delay:kae(s.signal),signal:s.signal});return Bp(s.signal),a},()=>$p(s,F$e));return i!=null&&i.autoJoin&&e.push(o.catch(sI)),{result:oI(t)(o),cancel(){$p(s,L$e)}}}},U$e=(t,e)=>{const n=async(r,i)=>{Bp(e);let s=()=>{};const a=[new Promise((l,c)=>{let u=t({predicate:r,effect:(d,h)=>{h.unsubscribe(),l([d,h.getState(),h.getOriginalState()])}});s=()=>{u(),c()}})];i!=null&&a.push(new Promise(l=>setTimeout(l,i,null)));try{const l=await _ae(e,Promise.race(a));return Bp(e),l}finally{s()}};return(r,i)=>Iae(n(r,i))},Aae=t=>{let{type:e,actionCreator:n,matcher:r,predicate:i,effect:s}=t;if(e)i=Ml(e).match;else if(n)e=n.type,i=n.match;else if(r)i=r;else if(!i)throw new Error(ka(21));return o5(s),{predicate:i,type:e,effect:s}},Mae=ly(t=>{const{type:e,predicate:n,effect:r}=Aae(t);return{id:I$e(),effect:r,type:e,predicate:n,pending:new Set,unsubscribe:()=>{throw new Error(ka(22))}}},{withTypes:()=>Mae}),fq=(t,e)=>{const{type:n,effect:r,predicate:i}=Aae(e);return Array.from(t.values()).find(s=>(typeof n=="string"?s.type===n:s.predicate===i)&&s.effect===r)},o3=t=>{t.pending.forEach(e=>{$p(e,s3)})},H$e=t=>()=>{t.forEach(o3),t.clear()},pq=(t,e,n)=>{try{t(e,n)}catch(r){setTimeout(()=>{throw r},0)}},Oae=ly(Ml(`${X_}/add`),{withTypes:()=>Oae}),V$e=Ml(`${X_}/removeAll`),Dae=ly(Ml(`${X_}/remove`),{withTypes:()=>Dae}),W$e=(...t)=>{console.error(`${X_}/error`,...t)},sS=(t={})=>{const e=new Map,{extra:n,onError:r=W$e}=t;o5(r);const i=u=>(u.unsubscribe=()=>e.delete(u.id),e.set(u.id,u),d=>{u.unsubscribe(),d!=null&&d.cancelActive&&o3(u)}),s=u=>{const d=fq(e,u)??Mae(u);return i(d)};ly(s,{withTypes:()=>s});const o=u=>{const d=fq(e,u);return d&&(d.unsubscribe(),u.cancelActive&&o3(d)),!!d};ly(o,{withTypes:()=>o});const a=async(u,d,h,f)=>{const y=new AbortController,b=U$e(s,y.signal),v=[];try{u.pending.add(y),await Promise.resolve(u.effect(d,ly({},h,{getOriginalState:f,condition:(x,C)=>b(x,C).then(Boolean),take:b,delay:kae(y.signal),pause:oI(y.signal),extra:n,signal:y.signal,fork:z$e(y.signal,v),unsubscribe:u.unsubscribe,subscribe:()=>{e.set(u.id,u)},cancelActiveListeners:()=>{u.pending.forEach((x,C,E)=>{x!==y&&($p(x,s3),E.delete(x))})},cancel:()=>{$p(y,s3),u.pending.delete(y)},throwIfCancelled:()=>{Bp(y.signal)}})))}catch(x){x instanceof Y_||pq(r,x,{raisedBy:"effect"})}finally{await Promise.all(v),$p(y,$$e),u.pending.delete(y)}},l=H$e(e);return{middleware:u=>d=>h=>{if(!mse(h))return d(h);if(Oae.match(h))return s(h.payload);if(V$e.match(h)){l();return}if(Dae.match(h))return o(h.payload);let f=u.getState();const y=()=>{if(f===hq)throw new Error(ka(23));return f};let b;try{if(b=d(h),e.size>0){const v=u.getState(),x=Array.from(e.values());for(const C of x){let E=!1;try{E=C.predicate(h,v,f)}catch(I){E=!1,pq(r,I,{raisedBy:"predicate"})}E&&a(C,h,u,y)}}}finally{f=hq}return b},startListening:s,stopListening:o,clearListeners:l}};function ka(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var K$e={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},Rae=Ua({name:"chartLayout",initialState:K$e,reducers:{setLayout(t,e){t.layoutType=e.payload},setChartSize(t,e){t.width=e.payload.width,t.height=e.payload.height},setMargin(t,e){t.margin.top=e.payload.top,t.margin.right=e.payload.right,t.margin.bottom=e.payload.bottom,t.margin.left=e.payload.left},setScale(t,e){t.scale=e.payload}}}),{setMargin:q$e,setLayout:G$e,setChartSize:Y$e,setScale:X$e}=Rae.actions,J$e=Rae.reducer;function gq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function mq(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gq(Object(n),!0).forEach(function(r){Z$e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Z$e(t,e,n){return(e=Q$e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Q$e(t){var e=eBe(t,"string");return typeof e=="symbol"?e:e+""}function eBe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var aI=Math.PI/180,tBe=t=>t*180/Math.PI,As=(t,e,n,r)=>({x:t+Math.cos(-aI*r)*n,y:e+Math.sin(-aI*r)*n}),Nae=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(e-(r.left||0)-(r.right||0)),Math.abs(n-(r.top||0)-(r.bottom||0)))/2},nBe=(t,e)=>{var{x:n,y:r}=t,{x:i,y:s}=e;return Math.sqrt((n-i)**2+(r-s)**2)},rBe=(t,e)=>{var{x:n,y:r}=t,{cx:i,cy:s}=e,o=nBe({x:n,y:r},{x:i,y:s});if(o<=0)return{radius:o,angle:0};var a=(n-i)/o,l=Math.acos(a);return r>s&&(l=2*Math.PI-l),{radius:o,angle:tBe(l),angleInRadian:l}},iBe=t=>{var{startAngle:e,endAngle:n}=t,r=Math.floor(e/360),i=Math.floor(n/360),s=Math.min(r,i);return{startAngle:e-s*360,endAngle:n-s*360}},sBe=(t,e)=>{var{startAngle:n,endAngle:r}=e,i=Math.floor(n/360),s=Math.floor(r/360),o=Math.min(i,s);return t+o*360},oBe=(t,e)=>{var{x:n,y:r}=t,{radius:i,angle:s}=rBe({x:n,y:r},e),{innerRadius:o,outerRadius:a}=e;if(i<o||i>a||i===0)return null;var{startAngle:l,endAngle:c}=iBe(e),u=s,d;if(l<=c){for(;u>c;)u-=360;for(;u<l;)u+=360;d=u>=l&&u<=c}else{for(;u>l;)u-=360;for(;u<c;)u+=360;d=u>=c&&u<=l}return d?mq(mq({},e),{},{radius:i,angle:sBe(u,e)}):null};function jae(t,e,n){return Array.isArray(t)&&t&&e+n!==0?t.slice(e,n+1):t}function yq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ml(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yq(Object(n),!0).forEach(function(r){aBe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function aBe(t,e,n){return(e=lBe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function lBe(t){var e=cBe(t,"string");return typeof e=="symbol"?e:e+""}function cBe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Wr(t,e,n){return ig(t)||ig(e)?n:vd(e)?Ay(t,e,n):typeof e=="function"?e(t):n}var uBe=(t,e,n,r,i)=>{var s,o=-1,a=(s=e==null?void 0:e.length)!==null&&s!==void 0?s:0;if(a<=1||t==null)return 0;if(r==="angleAxis"&&i!=null&&Math.abs(Math.abs(i[1]-i[0])-360)<=1e-6)for(var l=0;l<a;l++){var c=l>0?n[l-1].coordinate:n[a-1].coordinate,u=n[l].coordinate,d=l>=a-1?n[0].coordinate:n[l+1].coordinate,h=void 0;if(ba(u-c)!==ba(d-u)){var f=[];if(ba(d-u)===ba(i[1]-i[0])){h=d;var y=u+i[1]-i[0];f[0]=Math.min(y,(y+c)/2),f[1]=Math.max(y,(y+c)/2)}else{h=c;var b=d+i[1]-i[0];f[0]=Math.min(u,(b+u)/2),f[1]=Math.max(u,(b+u)/2)}var v=[Math.min(u,(h+u)/2),Math.max(u,(h+u)/2)];if(t>v[0]&&t<=v[1]||t>=f[0]&&t<=f[1]){({index:o}=n[l]);break}}else{var x=Math.min(c,d),C=Math.max(c,d);if(t>(x+u)/2&&t<=(C+u)/2){({index:o}=n[l]);break}}}else if(e){for(var E=0;E<a;E++)if(E===0&&t<=(e[E].coordinate+e[E+1].coordinate)/2||E>0&&E<a-1&&t>(e[E].coordinate+e[E-1].coordinate)/2&&t<=(e[E].coordinate+e[E+1].coordinate)/2||E===a-1&&t>(e[E].coordinate+e[E-1].coordinate)/2){({index:o}=e[E]);break}}return o},dBe=(t,e,n)=>{if(e&&n){var{width:r,height:i}=n,{align:s,verticalAlign:o,layout:a}=e;if((a==="vertical"||a==="horizontal"&&o==="middle")&&s!=="center"&&Gt(t[s]))return ml(ml({},t),{},{[s]:t[s]+(r||0)});if((a==="horizontal"||a==="vertical"&&s==="center")&&o!=="middle"&&Gt(t[o]))return ml(ml({},t),{},{[o]:t[o]+(i||0)})}return t},Dg=(t,e)=>t==="horizontal"&&e==="xAxis"||t==="vertical"&&e==="yAxis"||t==="centric"&&e==="angleAxis"||t==="radial"&&e==="radiusAxis",vq=1e-4,hBe=t=>{var e=t.domain();if(!(!e||e.length<=2)){var n=e.length,r=t.range(),i=Math.min(r[0],r[1])-vq,s=Math.max(r[0],r[1])+vq,o=t(e[0]),a=t(e[n-1]);(o<i||o>s||a<i||a>s)&&t.domain([e[0],e[n-1]])}},fBe=t=>{var e=t.length;if(!(e<=0))for(var n=0,r=t[0].length;n<r;++n)for(var i=0,s=0,o=0;o<e;++o){var a=bc(t[o][n][1])?t[o][n][0]:t[o][n][1];a>=0?(t[o][n][0]=i,t[o][n][1]=i+a,i=t[o][n][1]):(t[o][n][0]=s,t[o][n][1]=s+a,s=t[o][n][1])}},pBe=t=>{var e=t.length;if(!(e<=0))for(var n=0,r=t[0].length;n<r;++n)for(var i=0,s=0;s<e;++s){var o=bc(t[s][n][1])?t[s][n][0]:t[s][n][1];o>=0?(t[s][n][0]=i,t[s][n][1]=i+o,i=t[s][n][1]):(t[s][n][0]=0,t[s][n][1]=0)}},gBe={sign:fBe,expand:XFe,none:Oy,silhouette:JFe,wiggle:ZFe,positive:pBe},mBe=(t,e,n)=>{var r=gBe[n],i=YFe().keys(e).value((s,o)=>+Wr(s,o,0)).order(XF).offset(r);return i(t)},yBe=t=>{var e=t.flat(2).filter(Gt);return[Math.min(...e),Math.max(...e)]},vBe=t=>[t[0]===1/0?0:t[0],t[1]===-1/0?0:t[1]],bBe=(t,e,n)=>{if(t!=null)return vBe(Object.keys(t).reduce((r,i)=>{var s=t[i],{stackedData:o}=s,a=o.reduce((l,c)=>{var u=jae(c,e,n),d=yBe(u);return[Math.min(l[0],d[0]),Math.max(l[1],d[1])]},[1/0,-1/0]);return[Math.min(a[0],r[0]),Math.max(a[1],r[1])]},[1/0,-1/0]))},bq=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,xq=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,xBe=(t,e,n)=>{if(t&&t.scale&&t.scale.bandwidth){var r=t.scale.bandwidth();return r}if(t&&e&&e.length>=2){for(var i=V_(e,u=>u.coordinate),s=1/0,o=1,a=i.length;o<a;o++){var l=i[o],c=i[o-1];s=Math.min((l.coordinate||0)-(c.coordinate||0),s)}return s===1/0?0:s}return 0};function wq(t){var{tooltipEntrySettings:e,dataKey:n,payload:r,value:i,name:s}=t;return ml(ml({},e),{},{dataKey:n,payload:r,value:i,name:s})}function Lae(t,e){if(t)return String(t);if(typeof e=="string")return e}function wBe(t,e,n,r,i){if(n==="horizontal"||n==="vertical"){var s=t>=i.left&&t<=i.left+i.width&&e>=i.top&&e<=i.top+i.height;return s?{x:t,y:e}:null}return r?oBe({x:t,y:e},r):null}var SBe=(t,e,n,r)=>{var i=e.find(c=>c&&c.index===n);if(i){if(t==="horizontal")return{x:i.coordinate,y:r.y};if(t==="vertical")return{x:r.x,y:i.coordinate};if(t==="centric"){var s=i.coordinate,{radius:o}=r;return ml(ml(ml({},r),As(r.cx,r.cy,o,s)),{},{angle:s,radius:o})}var a=i.coordinate,{angle:l}=r;return ml(ml(ml({},r),As(r.cx,r.cy,a,l)),{},{angle:l,radius:a})}return{x:0,y:0}},CBe=(t,e)=>e==="horizontal"?t.x:e==="vertical"?t.y:e==="centric"?t.angle:t.radius,Rd=t=>t.layout.width,Nd=t=>t.layout.height,EBe=t=>t.layout.scale,Fae=t=>t.layout.margin,a5=he(t=>t.cartesianAxis.xAxis,t=>Object.values(t)),l5=he(t=>t.cartesianAxis.yAxis,t=>Object.values(t)),$ae="data-recharts-item-index",Bae="data-recharts-item-data-key",J_=60;function Sq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function bh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Sq(Object(n),!0).forEach(function(r){TBe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Sq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function TBe(t,e,n){return(e=IBe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function IBe(t){var e=PBe(t,"string");return typeof e=="symbol"?e:e+""}function PBe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var _Be=t=>t.brush.height,Bs=he([Rd,Nd,Fae,_Be,a5,l5,hae,t$e],(t,e,n,r,i,s,o,a)=>{var l=s.reduce((y,b)=>{var{orientation:v}=b;if(!b.mirror&&!b.hide){var x=typeof b.width=="number"?b.width:J_;return bh(bh({},y),{},{[v]:y[v]+x})}return y},{left:n.left||0,right:n.right||0}),c=i.reduce((y,b)=>{var{orientation:v}=b;return!b.mirror&&!b.hide?bh(bh({},y),{},{[v]:Ay(y,"".concat(v))+b.height}):y},{top:n.top||0,bottom:n.bottom||0}),u=bh(bh({},c),l),d=u.bottom;u.bottom+=r,u=dBe(u,o,a);var h=t-u.left-u.right,f=e-u.top-u.bottom;return bh(bh({brushBottom:d},u),{},{width:Math.max(h,0),height:Math.max(f,0)})}),kBe=he(Bs,t=>({x:t.left,y:t.top,width:t.width,height:t.height}));he(Rd,Nd,(t,e)=>({x:0,y:0,width:t,height:e}));var ABe=S.createContext(null),xv=()=>S.useContext(ABe)!=null,Z_=t=>t.brush,Q_=he([Z_,Bs,Fae],(t,e,n)=>({height:t.height,x:Gt(t.x)?t.x:e.left,y:Gt(t.y)?t.y:e.top+e.height+e.brushBottom-((n==null?void 0:n.bottom)||0),width:Gt(t.width)?t.width:e.width})),zae=()=>{var t,e=xv(),n=Kt(kBe),r=Kt(Q_),i=(t=Kt(Z_))===null||t===void 0?void 0:t.padding;return!e||!r||!i?n:{width:r.width-i.left-i.right,height:r.height-i.top-i.bottom,x:i.left,y:i.top}},MBe={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},OBe=()=>{var t;return(t=Kt(Bs))!==null&&t!==void 0?t:MBe},Uae=()=>Kt(Rd),Hae=()=>Kt(Nd),DBe={top:0,right:0,bottom:0,left:0},RBe=()=>{var t;return(t=Kt(e=>e.layout.margin))!==null&&t!==void 0?t:DBe},jn=t=>t.layout.layoutType,Vae=()=>Kt(jn),NBe={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},Wae=Ua({name:"legend",initialState:NBe,reducers:{setLegendSize(t,e){t.size.width=e.payload.width,t.size.height=e.payload.height},setLegendSettings(t,e){t.settings.align=e.payload.align,t.settings.layout=e.payload.layout,t.settings.verticalAlign=e.payload.verticalAlign,t.settings.itemSorter=e.payload.itemSorter},addLegendPayload(t,e){t.payload.push(e.payload)},removeLegendPayload(t,e){var n=ud(t).payload.indexOf(e.payload);n>-1&&t.payload.splice(n,1)}}}),{setLegendSize:Cq,setLegendSettings:jBe,addLegendPayload:LBe,removeLegendPayload:FBe}=Wae.actions,$Be=Wae.reducer,BBe=["contextPayload"];function a3(){return a3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a3.apply(null,arguments)}function Eq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ry(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Eq(Object(n),!0).forEach(function(r){c5(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Eq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function c5(t,e,n){return(e=zBe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zBe(t){var e=UBe(t,"string");return typeof e=="symbol"?e:e+""}function UBe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function HBe(t,e){if(t==null)return{};var n,r,i=VBe(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function VBe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function WBe(t){return t.value}function KBe(t){var{contextPayload:e}=t,n=HBe(t,BBe),r=lae(e,t.payloadUniqBy,WBe),i=Ry(Ry({},n),{},{payload:r});return S.isValidElement(t.content)?S.cloneElement(t.content,i):typeof t.content=="function"?S.createElement(t.content,i):S.createElement(J4,i)}function qBe(t,e,n,r,i,s){var{layout:o,align:a,verticalAlign:l}=e,c,u;return(!t||(t.left===void 0||t.left===null)&&(t.right===void 0||t.right===null))&&(a==="center"&&o==="vertical"?c={left:((r||0)-s.width)/2}:c=a==="right"?{right:n&&n.right||0}:{left:n&&n.left||0}),(!t||(t.top===void 0||t.top===null)&&(t.bottom===void 0||t.bottom===null))&&(l==="middle"?u={top:((i||0)-s.height)/2}:u=l==="bottom"?{bottom:n&&n.bottom||0}:{top:n&&n.top||0}),Ry(Ry({},c),u)}function GBe(t){var e=Di();return S.useEffect(()=>{e(jBe(t))},[e,t]),null}function YBe(t){var e=Di();return S.useEffect(()=>(e(Cq(t)),()=>{e(Cq({width:0,height:0}))}),[e,t]),null}function XBe(t){var e=i$e(),n=bFe(),r=RBe(),{width:i,height:s,wrapperStyle:o,portal:a}=t,[l,c]=fae([e]),u=Uae(),d=Hae(),h=u-(r.left||0)-(r.right||0),f=wv.getWidthOrHeight(t.layout,s,i,h),y=a?o:Ry(Ry({position:"absolute",width:(f==null?void 0:f.width)||i||"auto",height:(f==null?void 0:f.height)||s||"auto"},qBe(o,t,r,u,d,l)),o),b=a??n;if(b==null)return null;var v=S.createElement("div",{className:"recharts-legend-wrapper",style:y,ref:c},S.createElement(GBe,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),S.createElement(YBe,{width:l.width,height:l.height}),S.createElement(KBe,a3({},t,f,{margin:r,chartWidth:u,chartHeight:d,contextPayload:e})));return _c.createPortal(v,b)}class wv extends S.PureComponent{static getWidthOrHeight(e,n,r,i){return e==="vertical"&&Gt(n)?{height:n}:e==="horizontal"?{width:r||i}:null}render(){return S.createElement(XBe,this.props)}}c5(wv,"displayName","Legend");c5(wv,"defaultProps",{align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"});function l3(){return l3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l3.apply(null,arguments)}function Tq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function FD(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Tq(Object(n),!0).forEach(function(r){JBe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Tq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function JBe(t,e,n){return(e=ZBe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ZBe(t){var e=QBe(t,"string");return typeof e=="symbol"?e:e+""}function QBe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function e4e(t){return Array.isArray(t)&&vd(t[0])&&vd(t[1])?t.join(" ~ "):t}var t4e=t=>{var{separator:e=" : ",contentStyle:n={},itemStyle:r={},labelStyle:i={},payload:s,formatter:o,itemSorter:a,wrapperClassName:l,labelClassName:c,label:u,labelFormatter:d,accessibilityLayer:h=!1}=t,f=()=>{if(s&&s.length){var P={padding:0,margin:0},_=(a?V_(s,a):s).map((A,D)=>{if(A.type==="none")return null;var L=A.formatter||o||e4e,{value:z,name:$}=A,H=z,R=$;if(L){var j=L(z,$,A,D,s);if(Array.isArray(j))[H,R]=j;else if(j!=null)H=j;else return null}var B=FD({display:"block",paddingTop:4,paddingBottom:4,color:A.color||"#000"},r);return S.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(D),style:B},vd(R)?S.createElement("span",{className:"recharts-tooltip-item-name"},R):null,vd(R)?S.createElement("span",{className:"recharts-tooltip-item-separator"},e):null,S.createElement("span",{className:"recharts-tooltip-item-value"},H),S.createElement("span",{className:"recharts-tooltip-item-unit"},A.unit||""))});return S.createElement("ul",{className:"recharts-tooltip-item-list",style:P},_)}return null},y=FD({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},n),b=FD({margin:0},i),v=!ig(u),x=v?u:"",C=si("recharts-default-tooltip",l),E=si("recharts-tooltip-label",c);v&&d&&s!==void 0&&s!==null&&(x=d(u,s));var I=h?{role:"status","aria-live":"assertive"}:{};return S.createElement("div",l3({className:C,style:y},I),S.createElement("p",{className:E,style:b},S.isValidElement(x)?x:"".concat(x)),f())},K0="recharts-tooltip-wrapper",n4e={visibility:"hidden"};function r4e(t){var{coordinate:e,translateX:n,translateY:r}=t;return si(K0,{["".concat(K0,"-right")]:Gt(n)&&e&&Gt(e.x)&&n>=e.x,["".concat(K0,"-left")]:Gt(n)&&e&&Gt(e.x)&&n<e.x,["".concat(K0,"-bottom")]:Gt(r)&&e&&Gt(e.y)&&r>=e.y,["".concat(K0,"-top")]:Gt(r)&&e&&Gt(e.y)&&r<e.y})}function Iq(t){var{allowEscapeViewBox:e,coordinate:n,key:r,offsetTopLeft:i,position:s,reverseDirection:o,tooltipDimension:a,viewBox:l,viewBoxDimension:c}=t;if(s&&Gt(s[r]))return s[r];var u=n[r]-a-(i>0?i:0),d=n[r]+i;if(e[r])return o[r]?u:d;var h=l[r];if(h==null)return 0;if(o[r]){var f=u,y=h;return f<y?Math.max(d,h):Math.max(u,h)}if(c==null)return 0;var b=d+a,v=h+c;return b>v?Math.max(u,h):Math.max(d,h)}function i4e(t){var{translateX:e,translateY:n,useTranslate3d:r}=t;return{transform:r?"translate3d(".concat(e,"px, ").concat(n,"px, 0)"):"translate(".concat(e,"px, ").concat(n,"px)")}}function s4e(t){var{allowEscapeViewBox:e,coordinate:n,offsetTopLeft:r,position:i,reverseDirection:s,tooltipBox:o,useTranslate3d:a,viewBox:l}=t,c,u,d;return o.height>0&&o.width>0&&n?(u=Iq({allowEscapeViewBox:e,coordinate:n,key:"x",offsetTopLeft:r,position:i,reverseDirection:s,tooltipDimension:o.width,viewBox:l,viewBoxDimension:l.width}),d=Iq({allowEscapeViewBox:e,coordinate:n,key:"y",offsetTopLeft:r,position:i,reverseDirection:s,tooltipDimension:o.height,viewBox:l,viewBoxDimension:l.height}),c=i4e({translateX:u,translateY:d,useTranslate3d:a})):c=n4e,{cssProperties:c,cssClasses:r4e({translateX:u,translateY:d,coordinate:n})}}function Pq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function SC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Pq(Object(n),!0).forEach(function(r){c3(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function c3(t,e,n){return(e=o4e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o4e(t){var e=a4e(t,"string");return typeof e=="symbol"?e:e+""}function a4e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class l4e extends S.PureComponent{constructor(){super(...arguments),c3(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),c3(this,"handleKeyDown",e=>{if(e.key==="Escape"){var n,r,i,s;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(n=(r=this.props.coordinate)===null||r===void 0?void 0:r.x)!==null&&n!==void 0?n:0,y:(i=(s=this.props.coordinate)===null||s===void 0?void 0:s.y)!==null&&i!==void 0?i:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var e,n;this.state.dismissed&&(((e=this.props.coordinate)===null||e===void 0?void 0:e.x)!==this.state.dismissedAtCoordinate.x||((n=this.props.coordinate)===null||n===void 0?void 0:n.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:e,allowEscapeViewBox:n,animationDuration:r,animationEasing:i,children:s,coordinate:o,hasPayload:a,isAnimationActive:l,offset:c,position:u,reverseDirection:d,useTranslate3d:h,viewBox:f,wrapperStyle:y,lastBoundingBox:b,innerRef:v,hasPortalFromProps:x}=this.props,{cssClasses:C,cssProperties:E}=s4e({allowEscapeViewBox:n,coordinate:o,offsetTopLeft:c,position:u,reverseDirection:d,tooltipBox:{height:b.height,width:b.width},useTranslate3d:h,viewBox:f}),I=x?{}:SC(SC({transition:l&&e?"transform ".concat(r,"ms ").concat(i):void 0},E),{},{pointerEvents:"none",visibility:!this.state.dismissed&&e&&a?"visible":"hidden",position:"absolute",top:0,left:0}),P=SC(SC({},I),{},{visibility:!this.state.dismissed&&e&&a?"visible":"hidden"},y);return S.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:C,style:P,ref:v},s)}}var c4e=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),ek={isSsr:c4e()},Kae=()=>Kt(t=>t.rootProps.accessibilityLayer);function xc(t){return Number.isFinite(t)}function lI(t){return typeof t=="number"&&t>0&&Number.isFinite(t)}function u3(){return u3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u3.apply(null,arguments)}function _q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function kq(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_q(Object(n),!0).forEach(function(r){u4e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_q(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function u4e(t,e,n){return(e=d4e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d4e(t){var e=h4e(t,"string");return typeof e=="symbol"?e:e+""}function h4e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Aq={curveBasisClosed:FFe,curveBasisOpen:$Fe,curveBasis:LFe,curveBumpX:CFe,curveBumpY:EFe,curveLinearClosed:BFe,curveLinear:U_,curveMonotoneX:zFe,curveMonotoneY:UFe,curveNatural:HFe,curveStep:VFe,curveStepAfter:KFe,curveStepBefore:WFe},CC=t=>xc(t.x)&&xc(t.y),q0=t=>t.x,G0=t=>t.y,f4e=(t,e)=>{if(typeof t=="function")return t;var n="curve".concat(iS(t));return(n==="curveMonotone"||n==="curveBump")&&e?Aq["".concat(n).concat(e==="vertical"?"Y":"X")]:Aq[n]||U_},p4e=t=>{var{type:e="linear",points:n=[],baseLine:r,layout:i,connectNulls:s=!1}=t,o=f4e(e,i),a=s?n.filter(CC):n,l;if(Array.isArray(r)){var c=s?r.filter(d=>CC(d)):r,u=a.map((d,h)=>kq(kq({},d),{},{base:c[h]}));return i==="vertical"?l=yC().y(G0).x1(q0).x0(d=>d.base.x):l=yC().x(q0).y1(G0).y0(d=>d.base.y),l.defined(CC).curve(o),l(u)}return i==="vertical"&&Gt(r)?l=yC().y(G0).x1(q0).x0(r):Gt(r)?l=yC().x(q0).y1(G0).y0(r):l=Hoe().x(q0).y(G0),l.defined(CC).curve(o),l(a)},qae=t=>{var{className:e,points:n,path:r,pathRef:i}=t;if((!n||!n.length)&&!r)return null;var s=n&&n.length?p4e(t):r;return S.createElement("path",u3({},B_(t),cFe(t),{className:si("recharts-curve",e),d:s===null?void 0:s,ref:i}))},g4e=["x","y","top","left","width","height","className"];function d3(){return d3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},d3.apply(null,arguments)}function Mq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function m4e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Mq(Object(n),!0).forEach(function(r){y4e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function y4e(t,e,n){return(e=v4e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v4e(t){var e=b4e(t,"string");return typeof e=="symbol"?e:e+""}function b4e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function x4e(t,e){if(t==null)return{};var n,r,i=w4e(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function w4e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var S4e=(t,e,n,r,i,s)=>"M".concat(t,",").concat(i,"v").concat(r,"M").concat(s,",").concat(e,"h").concat(n),C4e=t=>{var{x:e=0,y:n=0,top:r=0,left:i=0,width:s=0,height:o=0,className:a}=t,l=x4e(t,g4e),c=m4e({x:e,y:n,top:r,left:i,width:s,height:o},l);return!Gt(e)||!Gt(n)||!Gt(s)||!Gt(o)||!Gt(r)||!Gt(i)?null:S.createElement("path",d3({},ja(c,!0),{className:si("recharts-cross",a),d:S4e(e,n,s,o,r,i)}))};function E4e(t,e,n,r){var i=r/2;return{stroke:"none",fill:"#ccc",x:t==="horizontal"?e.x-i:n.left+.5,y:t==="horizontal"?n.top+.5:e.y-i,width:t==="horizontal"?r:n.width-1,height:t==="horizontal"?n.height-1:r}}function Oq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function T4e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Oq(Object(n),!0).forEach(function(r){I4e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Oq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function I4e(t,e,n){return(e=P4e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function P4e(t){var e=_4e(t,"string");return typeof e=="symbol"?e:e+""}function _4e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function If(t,e){var n=T4e({},t),r=e,i=Object.keys(e),s=i.reduce((o,a)=>(o[a]===void 0&&r[a]!==void 0&&(o[a]=r[a]),o),n);return s}var $D={},BD={},zD={},Dq;function k4e(){return Dq||(Dq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){if(!n||typeof n!="object")return!1;const r=Object.getPrototypeOf(n);return r===null||r===Object.prototype||Object.getPrototypeOf(r)===null?Object.prototype.toString.call(n)==="[object Object]":!1}t.isPlainObject=e}(zD)),zD}var Rq;function A4e(){return Rq||(Rq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=k4e(),n=sae(),r=e5(),i=t5(),s=Z4();function o(c,u,d){return a(c,u,void 0,void 0,void 0,void 0,d)}function a(c,u,d,h,f,y,b){const v=b(c,u,d,h,f,y);if(v!==void 0)return v;if(typeof c==typeof u)switch(typeof c){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return c===u;case"number":return c===u||Object.is(c,u);case"function":return c===u;case"object":return l(c,u,y,b)}return l(c,u,y,b)}function l(c,u,d,h){if(Object.is(c,u))return!0;let f=r.getTag(c),y=r.getTag(u);if(f===i.argumentsTag&&(f=i.objectTag),y===i.argumentsTag&&(y=i.objectTag),f!==y)return!1;switch(f){case i.stringTag:return c.toString()===u.toString();case i.numberTag:{const x=c.valueOf(),C=u.valueOf();return s.eq(x,C)}case i.booleanTag:case i.dateTag:case i.symbolTag:return Object.is(c.valueOf(),u.valueOf());case i.regexpTag:return c.source===u.source&&c.flags===u.flags;case i.functionTag:return c===u}d=d??new Map;const b=d.get(c),v=d.get(u);if(b!=null&&v!=null)return b===u;d.set(c,u),d.set(u,c);try{switch(f){case i.mapTag:{if(c.size!==u.size)return!1;for(const[x,C]of c.entries())if(!u.has(x)||!a(C,u.get(x),x,c,u,d,h))return!1;return!0}case i.setTag:{if(c.size!==u.size)return!1;const x=Array.from(c.values()),C=Array.from(u.values());for(let E=0;E<x.length;E++){const I=x[E],P=C.findIndex(_=>a(I,_,void 0,c,u,d,h));if(P===-1)return!1;C.splice(P,1)}return!0}case i.arrayTag:case i.uint8ArrayTag:case i.uint8ClampedArrayTag:case i.uint16ArrayTag:case i.uint32ArrayTag:case i.bigUint64ArrayTag:case i.int8ArrayTag:case i.int16ArrayTag:case i.int32ArrayTag:case i.bigInt64ArrayTag:case i.float32ArrayTag:case i.float64ArrayTag:{if(typeof Buffer<"u"&&Buffer.isBuffer(c)!==Buffer.isBuffer(u)||c.length!==u.length)return!1;for(let x=0;x<c.length;x++)if(!a(c[x],u[x],x,c,u,d,h))return!1;return!0}case i.arrayBufferTag:return c.byteLength!==u.byteLength?!1:l(new Uint8Array(c),new Uint8Array(u),d,h);case i.dataViewTag:return c.byteLength!==u.byteLength||c.byteOffset!==u.byteOffset?!1:l(new Uint8Array(c),new Uint8Array(u),d,h);case i.errorTag:return c.name===u.name&&c.message===u.message;case i.objectTag:{if(!(l(c.constructor,u.constructor,d,h)||e.isPlainObject(c)&&e.isPlainObject(u)))return!1;const C=[...Object.keys(c),...n.getSymbols(c)],E=[...Object.keys(u),...n.getSymbols(u)];if(C.length!==E.length)return!1;for(let I=0;I<C.length;I++){const P=C[I],_=c[P];if(!Object.hasOwn(u,P))return!1;const A=u[P];if(!a(_,A,P,c,u,d,h))return!1}return!0}default:return!1}}finally{d.delete(c),d.delete(u)}}t.isEqualWith=o}(BD)),BD}var UD={},Nq;function M4e(){return Nq||(Nq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(){}t.noop=e}(UD)),UD}var jq;function O4e(){return jq||(jq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=A4e(),n=M4e();function r(i,s){return e.isEqualWith(i,s,n.noop)}t.isEqual=r}($D)),$D}var HD,Lq;function D4e(){return Lq||(Lq=1,HD=O4e().isEqual),HD}var R4e=D4e();const N4e=Oi(R4e);var cI=1e-4,Gae=(t,e)=>[0,3*t,3*e-6*t,3*t-3*e+1],Yae=(t,e)=>t.map((n,r)=>n*e**r).reduce((n,r)=>n+r),Fq=(t,e)=>n=>{var r=Gae(t,e);return Yae(r,n)},j4e=(t,e)=>n=>{var r=Gae(t,e),i=[...r.map((s,o)=>s*o).slice(1),0];return Yae(i,n)},$q=function(){for(var e,n,r,i,s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];if(o.length===1)switch(o[0]){case"linear":[e,r,n,i]=[0,0,1,1];break;case"ease":[e,r,n,i]=[.25,.1,.25,1];break;case"ease-in":[e,r,n,i]=[.42,0,1,1];break;case"ease-out":[e,r,n,i]=[.42,0,.58,1];break;case"ease-in-out":[e,r,n,i]=[0,0,.58,1];break;default:{var l=o[0].split("(");l[0]==="cubic-bezier"&&l[1].split(")")[0].split(",").length===4&&([e,r,n,i]=l[1].split(")")[0].split(",").map(y=>parseFloat(y)))}}else o.length===4&&([e,r,n,i]=o);var c=Fq(e,n),u=Fq(r,i),d=j4e(e,n),h=y=>y>1?1:y<0?0:y,f=y=>{for(var b=y>1?1:y,v=b,x=0;x<8;++x){var C=c(v)-b,E=d(v);if(Math.abs(C-b)<cI||E<cI)return u(v);v=h(v-C/E)}return u(v)};return f.isStepper=!1,f},L4e=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:n=100,damping:r=8,dt:i=17}=e,s=(o,a,l)=>{var c=-(o-a)*n,u=l*r,d=l+(c-u)*i/1e3,h=l*i/1e3+o;return Math.abs(h-a)<cI&&Math.abs(d)<cI?[a,0]:[h,d]};return s.isStepper=!0,s.dt=i,s},Xae=t=>{if(typeof t=="string")switch(t){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return $q(t);case"spring":return L4e();default:if(t.split("(")[0]==="cubic-bezier")return $q(t)}return typeof t=="function"?t:null};function Bq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function zq(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Bq(Object(n),!0).forEach(function(r){F4e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function F4e(t,e,n){return(e=$4e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $4e(t){var e=B4e(t,"string");return typeof e=="symbol"?e:e+""}function B4e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var z4e=t=>t.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase())),U4e=(t,e,n)=>t.map(r=>"".concat(z4e(r)," ").concat(e,"ms ").concat(n)).join(","),H4e=(t,e)=>[Object.keys(t),Object.keys(e)].reduce((n,r)=>n.filter(i=>r.includes(i))),Gx=(t,e)=>Object.keys(e).reduce((n,r)=>zq(zq({},n),{},{[r]:t(r,e[r])}),{});function Uq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ki(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Uq(Object(n),!0).forEach(function(r){V4e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Uq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function V4e(t,e,n){return(e=W4e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function W4e(t){var e=K4e(t,"string");return typeof e=="symbol"?e:e+""}function K4e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var uI=(t,e,n)=>t+(e-t)*n,h3=t=>{var{from:e,to:n}=t;return e!==n},Jae=(t,e,n)=>{var r=Gx((i,s)=>{if(h3(s)){var[o,a]=t(s.from,s.to,s.velocity);return Ki(Ki({},s),{},{from:o,velocity:a})}return s},e);return n<1?Gx((i,s)=>h3(s)?Ki(Ki({},s),{},{velocity:uI(s.velocity,r[i].velocity,n),from:uI(s.from,r[i].from,n)}):s,e):Jae(t,r,n-1)};function q4e(t,e,n,r,i,s){var o,a=r.reduce((h,f)=>Ki(Ki({},h),{},{[f]:{from:t[f],velocity:0,to:e[f]}}),{}),l=()=>Gx((h,f)=>f.from,a),c=()=>!Object.values(a).filter(h3).length,u=null,d=h=>{o||(o=h);var f=h-o,y=f/n.dt;a=Jae(n,a,y),i(Ki(Ki(Ki({},t),e),l())),o=h,c()||(u=s.setTimeout(d))};return()=>(u=s.setTimeout(d),()=>{u()})}function G4e(t,e,n,r,i,s,o){var a=null,l=i.reduce((d,h)=>Ki(Ki({},d),{},{[h]:[t[h],e[h]]}),{}),c,u=d=>{c||(c=d);var h=(d-c)/r,f=Gx((b,v)=>uI(...v,n(h)),l);if(s(Ki(Ki(Ki({},t),e),f)),h<1)a=o.setTimeout(u);else{var y=Gx((b,v)=>uI(...v,n(1)),l);s(Ki(Ki(Ki({},t),e),y))}};return()=>(a=o.setTimeout(u),()=>{a()})}const Zae=(t,e,n,r,i,s)=>{var o=H4e(t,e);return n.isStepper===!0?q4e(t,e,n,o,i,s):G4e(t,e,n,r,o,i,s)};function Y4e(t){var e,n=()=>null,r=!1,i=null,s=o=>{if(!r){if(Array.isArray(o)){if(!o.length)return;var a=o,[l,...c]=a;if(typeof l=="number"){i=t.setTimeout(s.bind(null,c),l);return}s(l),i=t.setTimeout(s.bind(null,c));return}typeof o=="string"&&(e=o,n(e)),typeof o=="object"&&(e=o,n(e)),typeof o=="function"&&o()}};return{stop:()=>{r=!0},start:o=>{r=!1,i&&(i(),i=null),s(o)},subscribe:o=>(n=o,()=>{n=()=>null}),getTimeoutController:()=>t}}class X4e{setTimeout(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=performance.now(),i=null,s=o=>{o-r>=n?e(o):typeof requestAnimationFrame=="function"&&(i=requestAnimationFrame(s))};return i=requestAnimationFrame(s),()=>{cancelAnimationFrame(i)}}}function J4e(){return Y4e(new X4e)}var Z4e=S.createContext(J4e);function Qae(t,e){var n=S.useContext(Z4e);return S.useMemo(()=>e??n(t),[t,e,n])}var Q4e=["children","begin","duration","attributeName","easing","isActive","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart","animationManager"];function f3(){return f3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},f3.apply(null,arguments)}function e5e(t,e){if(t==null)return{};var n,r,i=t5e(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function t5e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function Hq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function xh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Hq(Object(n),!0).forEach(function(r){Tp(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Hq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Tp(t,e,n){return(e=n5e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n5e(t){var e=r5e(t,"string");return typeof e=="symbol"?e:e+""}function r5e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class u5 extends S.PureComponent{constructor(e,n){super(e,n),Tp(this,"mounted",!1),Tp(this,"manager",void 0),Tp(this,"stopJSAnimation",null),Tp(this,"unSubscribe",null);var{isActive:r,attributeName:i,from:s,to:o,children:a,duration:l,animationManager:c}=this.props;if(this.manager=c,this.handleStyleChange=this.handleStyleChange.bind(this),this.changeStyle=this.changeStyle.bind(this),!r||l<=0){this.state={style:{}},typeof a=="function"&&(this.state={style:o});return}if(s){if(typeof a=="function"){this.state={style:s};return}this.state={style:i?{[i]:s}:s}}else this.state={style:{}}}componentDidMount(){var{isActive:e,canBegin:n}=this.props;this.mounted=!0,!(!e||!n)&&this.runAnimation(this.props)}componentDidUpdate(e){var{isActive:n,canBegin:r,attributeName:i,shouldReAnimate:s,to:o,from:a}=this.props,{style:l}=this.state;if(r){if(!n){var c={style:i?{[i]:o}:o};this.state&&l&&(i&&l[i]!==o||!i&&l!==o)&&this.setState(c);return}if(!(N4e(e.to,o)&&e.canBegin&&e.isActive)){var u=!e.canBegin||!e.isActive;this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var d=u||s?a:e.to;if(this.state&&l){var h={style:i?{[i]:d}:d};(i&&l[i]!==d||!i&&l!==d)&&this.setState(h)}this.runAnimation(xh(xh({},this.props),{},{from:d,begin:0}))}}}componentWillUnmount(){this.mounted=!1;var{onAnimationEnd:e}=this.props;this.unSubscribe&&this.unSubscribe(),this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation(),e&&e()}handleStyleChange(e){this.changeStyle(e)}changeStyle(e){this.mounted&&this.setState({style:e})}runJSAnimation(e){var{from:n,to:r,duration:i,easing:s,begin:o,onAnimationEnd:a,onAnimationStart:l}=e,c=Zae(n,r,Xae(s),i,this.changeStyle,this.manager.getTimeoutController()),u=()=>{this.stopJSAnimation=c()};this.manager.start([l,o,u,i,a])}runAnimation(e){var{begin:n,duration:r,attributeName:i,to:s,easing:o,onAnimationStart:a,onAnimationEnd:l,children:c}=e;if(this.unSubscribe=this.manager.subscribe(this.handleStyleChange),typeof o=="function"||typeof c=="function"||o==="spring"){this.runJSAnimation(e);return}var u=i?{[i]:s}:s,d=U4e(Object.keys(u),r,o);this.manager.start([a,n,xh(xh({},u),{},{transition:d}),r,l])}render(){var e=this.props,{children:n,begin:r,duration:i,attributeName:s,easing:o,isActive:a,from:l,to:c,canBegin:u,onAnimationEnd:d,shouldReAnimate:h,onAnimationReStart:f,animationManager:y}=e,b=e5e(e,Q4e),v=S.Children.count(n),x=this.state.style;if(typeof n=="function")return n(x);if(!a||v===0||i<=0)return n;var C=E=>{var{style:I={},className:P}=E.props,_=S.cloneElement(E,xh(xh({},b),{},{style:xh(xh({},I),x),className:P}));return _};return v===1?C(S.Children.only(n)):S.createElement("div",null,S.Children.map(n,E=>C(E)))}}Tp(u5,"displayName","Animate");Tp(u5,"defaultProps",{begin:0,duration:1e3,attributeName:"",easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}});function dI(t){var e,n=Qae((e=t.attributeName)!==null&&e!==void 0?e:Object.keys(t.to).join(","),t.animationManager);return S.createElement(u5,f3({},t,{animationManager:n}))}function hI(){return hI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},hI.apply(null,arguments)}var Vq=(t,e,n,r,i)=>{var s=Math.min(Math.abs(n)/2,Math.abs(r)/2),o=r>=0?1:-1,a=n>=0?1:-1,l=r>=0&&n>=0||r<0&&n<0?1:0,c;if(s>0&&i instanceof Array){for(var u=[0,0,0,0],d=0,h=4;d<h;d++)u[d]=i[d]>s?s:i[d];c="M".concat(t,",").concat(e+o*u[0]),u[0]>0&&(c+="A ".concat(u[0],",").concat(u[0],",0,0,").concat(l,",").concat(t+a*u[0],",").concat(e)),c+="L ".concat(t+n-a*u[1],",").concat(e),u[1]>0&&(c+="A ".concat(u[1],",").concat(u[1],",0,0,").concat(l,`,
        `).concat(t+n,",").concat(e+o*u[1])),c+="L ".concat(t+n,",").concat(e+r-o*u[2]),u[2]>0&&(c+="A ".concat(u[2],",").concat(u[2],",0,0,").concat(l,`,
        `).concat(t+n-a*u[2],",").concat(e+r)),c+="L ".concat(t+a*u[3],",").concat(e+r),u[3]>0&&(c+="A ".concat(u[3],",").concat(u[3],",0,0,").concat(l,`,
        `).concat(t,",").concat(e+r-o*u[3])),c+="Z"}else if(s>0&&i===+i&&i>0){var f=Math.min(s,i);c="M ".concat(t,",").concat(e+o*f,`
            A `).concat(f,",").concat(f,",0,0,").concat(l,",").concat(t+a*f,",").concat(e,`
            L `).concat(t+n-a*f,",").concat(e,`
            A `).concat(f,",").concat(f,",0,0,").concat(l,",").concat(t+n,",").concat(e+o*f,`
            L `).concat(t+n,",").concat(e+r-o*f,`
            A `).concat(f,",").concat(f,",0,0,").concat(l,",").concat(t+n-a*f,",").concat(e+r,`
            L `).concat(t+a*f,",").concat(e+r,`
            A `).concat(f,",").concat(f,",0,0,").concat(l,",").concat(t,",").concat(e+r-o*f," Z")}else c="M ".concat(t,",").concat(e," h ").concat(n," v ").concat(r," h ").concat(-n," Z");return c},i5e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},ele=t=>{var e=If(t,i5e),n=S.useRef(null),[r,i]=S.useState(-1);S.useEffect(()=>{if(n.current&&n.current.getTotalLength)try{var x=n.current.getTotalLength();x&&i(x)}catch{}},[]);var{x:s,y:o,width:a,height:l,radius:c,className:u}=e,{animationEasing:d,animationDuration:h,animationBegin:f,isAnimationActive:y,isUpdateAnimationActive:b}=e;if(s!==+s||o!==+o||a!==+a||l!==+l||a===0||l===0)return null;var v=si("recharts-rectangle",u);return b?S.createElement(dI,{canBegin:r>0,from:{width:a,height:l,x:s,y:o},to:{width:a,height:l,x:s,y:o},duration:h,animationEasing:d,isActive:b},x=>{var{width:C,height:E,x:I,y:P}=x;return S.createElement(dI,{canBegin:r>0,from:"0px ".concat(r===-1?1:r,"px"),to:"".concat(r,"px 0px"),attributeName:"strokeDasharray",begin:f,duration:h,isActive:y,easing:d},S.createElement("path",hI({},ja(e,!0),{className:v,d:Vq(I,P,C,E,c),ref:n})))}):S.createElement("path",hI({},ja(e,!0),{className:v,d:Vq(s,o,a,l,c)}))};function tle(t){var{cx:e,cy:n,radius:r,startAngle:i,endAngle:s}=t,o=As(e,n,r,i),a=As(e,n,r,s);return{points:[o,a],cx:e,cy:n,radius:r,startAngle:i,endAngle:s}}function p3(){return p3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p3.apply(null,arguments)}var s5e=(t,e)=>{var n=ba(e-t),r=Math.min(Math.abs(e-t),359.999);return n*r},EC=t=>{var{cx:e,cy:n,radius:r,angle:i,sign:s,isExternal:o,cornerRadius:a,cornerIsExternal:l}=t,c=a*(o?1:-1)+r,u=Math.asin(a/c)/aI,d=l?i:i+s*u,h=As(e,n,c,d),f=As(e,n,r,d),y=l?i-s*u:i,b=As(e,n,c*Math.cos(u*aI),y);return{center:h,circleTangency:f,lineTangency:b,theta:u}},nle=t=>{var{cx:e,cy:n,innerRadius:r,outerRadius:i,startAngle:s,endAngle:o}=t,a=s5e(s,o),l=s+a,c=As(e,n,i,s),u=As(e,n,i,l),d="M ".concat(c.x,",").concat(c.y,`
    A `).concat(i,",").concat(i,`,0,
    `).concat(+(Math.abs(a)>180),",").concat(+(s>l),`,
    `).concat(u.x,",").concat(u.y,`
  `);if(r>0){var h=As(e,n,r,s),f=As(e,n,r,l);d+="L ".concat(f.x,",").concat(f.y,`
            A `).concat(r,",").concat(r,`,0,
            `).concat(+(Math.abs(a)>180),",").concat(+(s<=l),`,
            `).concat(h.x,",").concat(h.y," Z")}else d+="L ".concat(e,",").concat(n," Z");return d},o5e=t=>{var{cx:e,cy:n,innerRadius:r,outerRadius:i,cornerRadius:s,forceCornerRadius:o,cornerIsExternal:a,startAngle:l,endAngle:c}=t,u=ba(c-l),{circleTangency:d,lineTangency:h,theta:f}=EC({cx:e,cy:n,radius:i,angle:l,sign:u,cornerRadius:s,cornerIsExternal:a}),{circleTangency:y,lineTangency:b,theta:v}=EC({cx:e,cy:n,radius:i,angle:c,sign:-u,cornerRadius:s,cornerIsExternal:a}),x=a?Math.abs(l-c):Math.abs(l-c)-f-v;if(x<0)return o?"M ".concat(h.x,",").concat(h.y,`
        a`).concat(s,",").concat(s,",0,0,1,").concat(s*2,`,0
        a`).concat(s,",").concat(s,",0,0,1,").concat(-s*2,`,0
      `):nle({cx:e,cy:n,innerRadius:r,outerRadius:i,startAngle:l,endAngle:c});var C="M ".concat(h.x,",").concat(h.y,`
    A`).concat(s,",").concat(s,",0,0,").concat(+(u<0),",").concat(d.x,",").concat(d.y,`
    A`).concat(i,",").concat(i,",0,").concat(+(x>180),",").concat(+(u<0),",").concat(y.x,",").concat(y.y,`
    A`).concat(s,",").concat(s,",0,0,").concat(+(u<0),",").concat(b.x,",").concat(b.y,`
  `);if(r>0){var{circleTangency:E,lineTangency:I,theta:P}=EC({cx:e,cy:n,radius:r,angle:l,sign:u,isExternal:!0,cornerRadius:s,cornerIsExternal:a}),{circleTangency:_,lineTangency:A,theta:D}=EC({cx:e,cy:n,radius:r,angle:c,sign:-u,isExternal:!0,cornerRadius:s,cornerIsExternal:a}),L=a?Math.abs(l-c):Math.abs(l-c)-P-D;if(L<0&&s===0)return"".concat(C,"L").concat(e,",").concat(n,"Z");C+="L".concat(A.x,",").concat(A.y,`
      A`).concat(s,",").concat(s,",0,0,").concat(+(u<0),",").concat(_.x,",").concat(_.y,`
      A`).concat(r,",").concat(r,",0,").concat(+(L>180),",").concat(+(u>0),",").concat(E.x,",").concat(E.y,`
      A`).concat(s,",").concat(s,",0,0,").concat(+(u<0),",").concat(I.x,",").concat(I.y,"Z")}else C+="L".concat(e,",").concat(n,"Z");return C},a5e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},rle=t=>{var e=If(t,a5e),{cx:n,cy:r,innerRadius:i,outerRadius:s,cornerRadius:o,forceCornerRadius:a,cornerIsExternal:l,startAngle:c,endAngle:u,className:d}=e;if(s<i||c===u)return null;var h=si("recharts-sector",d),f=s-i,y=du(o,f,0,!0),b;return y>0&&Math.abs(c-u)<360?b=o5e({cx:n,cy:r,innerRadius:i,outerRadius:s,cornerRadius:Math.min(y,f/2),forceCornerRadius:a,cornerIsExternal:l,startAngle:c,endAngle:u}):b=nle({cx:n,cy:r,innerRadius:i,outerRadius:s,startAngle:c,endAngle:u}),S.createElement("path",p3({},ja(e,!0),{className:h,d:b}))};function l5e(t,e,n){var r,i,s,o;if(t==="horizontal")r=e.x,s=r,i=n.top,o=n.top+n.height;else if(t==="vertical")i=e.y,o=i,r=n.left,s=n.left+n.width;else if(e.cx!=null&&e.cy!=null)if(t==="centric"){var{cx:a,cy:l,innerRadius:c,outerRadius:u,angle:d}=e,h=As(a,l,c,d),f=As(a,l,u,d);r=h.x,i=h.y,s=f.x,o=f.y}else return tle(e);return[{x:r,y:i},{x:s,y:o}]}var VD={},WD={},KD={},Wq;function c5e(){return Wq||(Wq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=uae();function n(r){return e.isSymbol(r)?NaN:Number(r)}t.toNumber=n}(KD)),KD}var Kq;function u5e(){return Kq||(Kq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=c5e();function n(r){return r?(r=e.toNumber(r),r===1/0||r===-1/0?(r<0?-1:1)*Number.MAX_VALUE:r===r?r:0):r===0?r:0}t.toFinite=n}(WD)),WD}var qq;function d5e(){return qq||(qq=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=dae(),n=u5e();function r(i,s,o){o&&typeof o!="number"&&e.isIterateeCall(i,s,o)&&(s=o=void 0),i=n.toFinite(i),s===void 0?(s=i,i=0):s=n.toFinite(s),o=o===void 0?i<s?1:-1:n.toFinite(o);const a=Math.max(Math.ceil((s-i)/(o||1)),0),l=new Array(a);for(let c=0;c<a;c++)l[c]=i,i+=o;return l}t.range=r}(VD)),VD}var qD,Gq;function h5e(){return Gq||(Gq=1,qD=d5e().range),qD}var f5e=h5e();const ile=Oi(f5e);function rf(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function p5e(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function d5(t){let e,n,r;t.length!==2?(e=rf,n=(a,l)=>rf(t(a),l),r=(a,l)=>t(a)-l):(e=t===rf||t===p5e?t:g5e,n=t,r=t);function i(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const d=c+u>>>1;n(a[d],l)<0?c=d+1:u=d}while(c<u)}return c}function s(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const d=c+u>>>1;n(a[d],l)<=0?c=d+1:u=d}while(c<u)}return c}function o(a,l,c=0,u=a.length){const d=i(a,l,c,u-1);return d>c&&r(a[d-1],l)>-r(a[d],l)?d-1:d}return{left:i,center:o,right:s}}function g5e(){return 0}function sle(t){return t===null?NaN:+t}function*m5e(t,e){for(let n of t)n!=null&&(n=+n)>=n&&(yield n)}const y5e=d5(rf),oS=y5e.right;d5(sle).center;class Yq extends Map{constructor(e,n=x5e){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(Xq(this,e))}has(e){return super.has(Xq(this,e))}set(e,n){return super.set(v5e(this,e),n)}delete(e){return super.delete(b5e(this,e))}}function Xq({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function v5e({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function b5e({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function x5e(t){return t!==null&&typeof t=="object"?t.valueOf():t}function w5e(t=rf){if(t===rf)return ole;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,n)=>{const r=t(e,n);return r||r===0?r:(t(n,n)===0)-(t(e,e)===0)}}function ole(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}const S5e=Math.sqrt(50),C5e=Math.sqrt(10),E5e=Math.sqrt(2);function fI(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=S5e?10:s>=C5e?5:s>=E5e?2:1;let a,l,c;return i<0?(c=Math.pow(10,-i)/o,a=Math.round(t*c),l=Math.round(e*c),a/c<t&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,i)*o,a=Math.round(t/c),l=Math.round(e/c),a*c<t&&++a,l*c>e&&--l),l<a&&.5<=n&&n<2?fI(t,e,n*2):[a,l,c]}function g3(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,s,o]=r?fI(e,t,n):fI(t,e,n);if(!(s>=i))return[];const a=s-i+1,l=new Array(a);if(r)if(o<0)for(let c=0;c<a;++c)l[c]=(s-c)/-o;else for(let c=0;c<a;++c)l[c]=(s-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(i+c)/-o;else for(let c=0;c<a;++c)l[c]=(i+c)*o;return l}function m3(t,e,n){return e=+e,t=+t,n=+n,fI(t,e,n)[2]}function y3(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?m3(e,t,n):m3(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function Jq(t,e){let n;for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);return n}function Zq(t,e){let n;for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);return n}function ale(t,e,n=0,r=1/0,i){if(e=Math.floor(e),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(t.length-1,r)),!(n<=e&&e<=r))return t;for(i=i===void 0?ole:w5e(i);r>n;){if(r-n>600){const l=r-n+1,c=e-n+1,u=Math.log(l),d=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*d*(l-d)/l)*(c-l/2<0?-1:1),f=Math.max(n,Math.floor(e-c*d/l+h)),y=Math.min(r,Math.floor(e+(l-c)*d/l+h));ale(t,e,f,y,i)}const s=t[e];let o=n,a=r;for(Y0(t,n,e),i(t[r],s)>0&&Y0(t,n,r);o<a;){for(Y0(t,o,a),++o,--a;i(t[o],s)<0;)++o;for(;i(t[a],s)>0;)--a}i(t[n],s)===0?Y0(t,n,a):(++a,Y0(t,a,r)),a<=e&&(n=a+1),e<=a&&(r=a-1)}return t}function Y0(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function T5e(t,e,n){if(t=Float64Array.from(m5e(t)),!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return Zq(t);if(e>=1)return Jq(t);var r,i=(r-1)*e,s=Math.floor(i),o=Jq(ale(t,s).subarray(0,s+1)),a=Zq(t.subarray(s+1));return o+(a-o)*(i-s)}}function I5e(t,e,n=sle){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,s=Math.floor(i),o=+n(t[s],s,t),a=+n(t[s+1],s+1,t);return o+(a-o)*(i-s)}}function P5e(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(i);++r<i;)s[r]=t+r*n;return s}function Nl(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function jd(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const v3=Symbol("implicit");function h5(){var t=new Yq,e=[],n=[],r=v3;function i(s){let o=t.get(s);if(o===void 0){if(r!==v3)return r;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return i.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new Yq;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return h5(e,n).unknown(r)},Nl.apply(i,arguments),i}function f5(){var t=h5().unknown(void 0),e=t.domain,n=t.range,r=0,i=1,s,o,a=!1,l=0,c=0,u=.5;delete t.unknown;function d(){var h=e().length,f=i<r,y=f?i:r,b=f?r:i;s=(b-y)/Math.max(1,h-l+c*2),a&&(s=Math.floor(s)),y+=(b-y-s*(h-l))*u,o=s*(1-l),a&&(y=Math.round(y),o=Math.round(o));var v=P5e(h).map(function(x){return y+s*x});return n(f?v.reverse():v)}return t.domain=function(h){return arguments.length?(e(h),d()):e()},t.range=function(h){return arguments.length?([r,i]=h,r=+r,i=+i,d()):[r,i]},t.rangeRound=function(h){return[r,i]=h,r=+r,i=+i,a=!0,d()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(h){return arguments.length?(a=!!h,d()):a},t.padding=function(h){return arguments.length?(l=Math.min(1,c=+h),d()):l},t.paddingInner=function(h){return arguments.length?(l=Math.min(1,h),d()):l},t.paddingOuter=function(h){return arguments.length?(c=+h,d()):c},t.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),d()):u},t.copy=function(){return f5(e(),[r,i]).round(a).paddingInner(l).paddingOuter(c).align(u)},Nl.apply(d(),arguments)}function lle(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return lle(e())},t}function _5e(){return lle(f5.apply(null,arguments).paddingInner(1))}function p5(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function cle(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function aS(){}var Yx=.7,pI=1/Yx,cy="\\s*([+-]?\\d+)\\s*",Xx="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",hu="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",k5e=/^#([0-9a-f]{3,8})$/,A5e=new RegExp(`^rgb\\(${cy},${cy},${cy}\\)$`),M5e=new RegExp(`^rgb\\(${hu},${hu},${hu}\\)$`),O5e=new RegExp(`^rgba\\(${cy},${cy},${cy},${Xx}\\)$`),D5e=new RegExp(`^rgba\\(${hu},${hu},${hu},${Xx}\\)$`),R5e=new RegExp(`^hsl\\(${Xx},${hu},${hu}\\)$`),N5e=new RegExp(`^hsla\\(${Xx},${hu},${hu},${Xx}\\)$`),Qq={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};p5(aS,Jx,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:eG,formatHex:eG,formatHex8:j5e,formatHsl:L5e,formatRgb:tG,toString:tG});function eG(){return this.rgb().formatHex()}function j5e(){return this.rgb().formatHex8()}function L5e(){return ule(this).formatHsl()}function tG(){return this.rgb().formatRgb()}function Jx(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=k5e.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?nG(e):n===3?new Go(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?TC(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?TC(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=A5e.exec(t))?new Go(e[1],e[2],e[3],1):(e=M5e.exec(t))?new Go(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=O5e.exec(t))?TC(e[1],e[2],e[3],e[4]):(e=D5e.exec(t))?TC(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=R5e.exec(t))?sG(e[1],e[2]/100,e[3]/100,1):(e=N5e.exec(t))?sG(e[1],e[2]/100,e[3]/100,e[4]):Qq.hasOwnProperty(t)?nG(Qq[t]):t==="transparent"?new Go(NaN,NaN,NaN,0):null}function nG(t){return new Go(t>>16&255,t>>8&255,t&255,1)}function TC(t,e,n,r){return r<=0&&(t=e=n=NaN),new Go(t,e,n,r)}function F5e(t){return t instanceof aS||(t=Jx(t)),t?(t=t.rgb(),new Go(t.r,t.g,t.b,t.opacity)):new Go}function b3(t,e,n,r){return arguments.length===1?F5e(t):new Go(t,e,n,r??1)}function Go(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}p5(Go,b3,cle(aS,{brighter(t){return t=t==null?pI:Math.pow(pI,t),new Go(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Yx:Math.pow(Yx,t),new Go(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Go(zp(this.r),zp(this.g),zp(this.b),gI(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rG,formatHex:rG,formatHex8:$5e,formatRgb:iG,toString:iG}));function rG(){return`#${Ip(this.r)}${Ip(this.g)}${Ip(this.b)}`}function $5e(){return`#${Ip(this.r)}${Ip(this.g)}${Ip(this.b)}${Ip((isNaN(this.opacity)?1:this.opacity)*255)}`}function iG(){const t=gI(this.opacity);return`${t===1?"rgb(":"rgba("}${zp(this.r)}, ${zp(this.g)}, ${zp(this.b)}${t===1?")":`, ${t})`}`}function gI(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function zp(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ip(t){return t=zp(t),(t<16?"0":"")+t.toString(16)}function sG(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new rc(t,e,n,r)}function ule(t){if(t instanceof rc)return new rc(t.h,t.s,t.l,t.opacity);if(t instanceof aS||(t=Jx(t)),!t)return new rc;if(t instanceof rc)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(e===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-e)/a+2:o=(e-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new rc(o,a,l,t.opacity)}function B5e(t,e,n,r){return arguments.length===1?ule(t):new rc(t,e,n,r??1)}function rc(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}p5(rc,B5e,cle(aS,{brighter(t){return t=t==null?pI:Math.pow(pI,t),new rc(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Yx:Math.pow(Yx,t),new rc(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Go(GD(t>=240?t-240:t+120,i,r),GD(t,i,r),GD(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new rc(oG(this.h),IC(this.s),IC(this.l),gI(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=gI(this.opacity);return`${t===1?"hsl(":"hsla("}${oG(this.h)}, ${IC(this.s)*100}%, ${IC(this.l)*100}%${t===1?")":`, ${t})`}`}}));function oG(t){return t=(t||0)%360,t<0?t+360:t}function IC(t){return Math.max(0,Math.min(1,t||0))}function GD(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const g5=t=>()=>t;function z5e(t,e){return function(n){return t+n*e}}function U5e(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function H5e(t){return(t=+t)==1?dle:function(e,n){return n-e?U5e(e,n,t):g5(isNaN(e)?n:e)}}function dle(t,e){var n=e-t;return n?z5e(t,n):g5(isNaN(t)?e:t)}const aG=function t(e){var n=H5e(e);function r(i,s){var o=n((i=b3(i)).r,(s=b3(s)).r),a=n(i.g,s.g),l=n(i.b,s.b),c=dle(i.opacity,s.opacity);return function(u){return i.r=o(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return r.gamma=t,r}(1);function V5e(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=t[i]*(1-s)+e[i]*s;return r}}function W5e(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function K5e(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Sv(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function q5e(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function mI(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function G5e(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Sv(t[i],e[i]):r[i]=e[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var x3=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,YD=new RegExp(x3.source,"g");function Y5e(t){return function(){return t}}function X5e(t){return function(e){return t(e)+""}}function J5e(t,e){var n=x3.lastIndex=YD.lastIndex=0,r,i,s,o=-1,a=[],l=[];for(t=t+"",e=e+"";(r=x3.exec(t))&&(i=YD.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:mI(r,i)})),n=YD.lastIndex;return n<e.length&&(s=e.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?X5e(l[0].x):Y5e(e):(e=l.length,function(c){for(var u=0,d;u<e;++u)a[(d=l[u]).i]=d.x(c);return a.join("")})}function Sv(t,e){var n=typeof e,r;return e==null||n==="boolean"?g5(e):(n==="number"?mI:n==="string"?(r=Jx(e))?(e=r,aG):J5e:e instanceof Jx?aG:e instanceof Date?q5e:W5e(e)?V5e:Array.isArray(e)?K5e:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?G5e:mI)(t,e)}function m5(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Z5e(t,e){e===void 0&&(e=t,t=Sv);for(var n=0,r=e.length-1,i=e[0],s=new Array(r<0?0:r);n<r;)s[n]=t(i,i=e[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function Q5e(t){return function(){return t}}function yI(t){return+t}var lG=[0,1];function lo(t){return t}function w3(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Q5e(isNaN(e)?NaN:.5)}function eze(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function tze(t,e,n){var r=t[0],i=t[1],s=e[0],o=e[1];return i<r?(r=w3(i,r),s=n(o,s)):(r=w3(r,i),s=n(s,o)),function(a){return s(r(a))}}function nze(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=w3(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(a){var l=oS(t,a,1,r)-1;return s[l](i[l](a))}}function lS(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function tk(){var t=lG,e=lG,n=Sv,r,i,s,o=lo,a,l,c;function u(){var h=Math.min(t.length,e.length);return o!==lo&&(o=eze(t[0],t[h-1])),a=h>2?nze:tze,l=c=null,d}function d(h){return h==null||isNaN(h=+h)?s:(l||(l=a(t.map(r),e,n)))(r(o(h)))}return d.invert=function(h){return o(i((c||(c=a(e,t.map(r),mI)))(h)))},d.domain=function(h){return arguments.length?(t=Array.from(h,yI),u()):t.slice()},d.range=function(h){return arguments.length?(e=Array.from(h),u()):e.slice()},d.rangeRound=function(h){return e=Array.from(h),n=m5,u()},d.clamp=function(h){return arguments.length?(o=h?!0:lo,u()):o!==lo},d.interpolate=function(h){return arguments.length?(n=h,u()):n},d.unknown=function(h){return arguments.length?(s=h,d):s},function(h,f){return r=h,i=f,u()}}function y5(){return tk()(lo,lo)}function rze(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function vI(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Ny(t){return t=vI(Math.abs(t)),t?t[1]:NaN}function ize(t,e){return function(n,r){for(var i=n.length,s=[],o=0,a=t[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function sze(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var oze=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Zx(t){if(!(e=oze.exec(t)))throw new Error("invalid format: "+t);var e;return new v5({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Zx.prototype=v5.prototype;function v5(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}v5.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function aze(t){e:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var hle;function lze(t,e){var n=vI(t,e);if(!n)return t+"";var r=n[0],i=n[1],s=i-(hle=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+vI(t,Math.max(0,e+s-1))[0]}function cG(t,e){var n=vI(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const uG={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:rze,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>cG(t*100,e),r:cG,s:lze,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function dG(t){return t}var hG=Array.prototype.map,fG=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function cze(t){var e=t.grouping===void 0||t.thousands===void 0?dG:ize(hG.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?dG:sze(hG.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"−":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(d){d=Zx(d);var h=d.fill,f=d.align,y=d.sign,b=d.symbol,v=d.zero,x=d.width,C=d.comma,E=d.precision,I=d.trim,P=d.type;P==="n"?(C=!0,P="g"):uG[P]||(E===void 0&&(E=12),I=!0,P="g"),(v||h==="0"&&f==="=")&&(v=!0,h="0",f="=");var _=b==="$"?n:b==="#"&&/[boxX]/.test(P)?"0"+P.toLowerCase():"",A=b==="$"?r:/[%p]/.test(P)?o:"",D=uG[P],L=/[defgprs%]/.test(P);E=E===void 0?6:/[gprs]/.test(P)?Math.max(1,Math.min(21,E)):Math.max(0,Math.min(20,E));function z($){var H=_,R=A,j,B,K;if(P==="c")R=D($)+R,$="";else{$=+$;var G=$<0||1/$<0;if($=isNaN($)?l:D(Math.abs($),E),I&&($=aze($)),G&&+$==0&&y!=="+"&&(G=!1),H=(G?y==="("?y:a:y==="-"||y==="("?"":y)+H,R=(P==="s"?fG[8+hle/3]:"")+R+(G&&y==="("?")":""),L){for(j=-1,B=$.length;++j<B;)if(K=$.charCodeAt(j),48>K||K>57){R=(K===46?i+$.slice(j+1):$.slice(j))+R,$=$.slice(0,j);break}}}C&&!v&&($=e($,1/0));var V=H.length+$.length+R.length,W=V<x?new Array(x-V+1).join(h):"";switch(C&&v&&($=e(W+$,W.length?x-R.length:1/0),W=""),f){case"<":$=H+$+R+W;break;case"=":$=H+W+$+R;break;case"^":$=W.slice(0,V=W.length>>1)+H+$+R+W.slice(V);break;default:$=W+H+$+R;break}return s($)}return z.toString=function(){return d+""},z}function u(d,h){var f=c((d=Zx(d),d.type="f",d)),y=Math.max(-8,Math.min(8,Math.floor(Ny(h)/3)))*3,b=Math.pow(10,-y),v=fG[8+y/3];return function(x){return f(b*x)+v}}return{format:c,formatPrefix:u}}var PC,b5,fle;uze({thousands:",",grouping:[3],currency:["$",""]});function uze(t){return PC=cze(t),b5=PC.format,fle=PC.formatPrefix,PC}function dze(t){return Math.max(0,-Ny(Math.abs(t)))}function hze(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ny(e)/3)))*3-Ny(Math.abs(t)))}function fze(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ny(e)-Ny(t))+1}function ple(t,e,n,r){var i=y3(t,e,n),s;switch(r=Zx(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(s=hze(i,o))&&(r.precision=s),fle(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=fze(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=dze(i))&&(r.precision=s-(r.type==="%")*2);break}}return b5(r)}function Pf(t){var e=t.domain;return t.ticks=function(n){var r=e();return g3(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return ple(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,s=r.length-1,o=r[i],a=r[s],l,c,u=10;for(a<o&&(c=o,o=a,a=c,c=i,i=s,s=c);u-- >0;){if(c=m3(o,a,n),c===l)return r[i]=o,r[s]=a,e(r);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;l=c}return t},t}function gle(){var t=y5();return t.copy=function(){return lS(t,gle())},Nl.apply(t,arguments),Pf(t)}function mle(t){var e;function n(r){return r==null||isNaN(r=+r)?e:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(t=Array.from(r,yI),n):t.slice()},n.unknown=function(r){return arguments.length?(e=r,n):e},n.copy=function(){return mle(t).unknown(e)},t=arguments.length?Array.from(t,yI):[0,1],Pf(n)}function yle(t,e){t=t.slice();var n=0,r=t.length-1,i=t[n],s=t[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),t[n]=e.floor(i),t[r]=e.ceil(s),t}function pG(t){return Math.log(t)}function gG(t){return Math.exp(t)}function pze(t){return-Math.log(-t)}function gze(t){return-Math.exp(-t)}function mze(t){return isFinite(t)?+("1e"+t):t<0?0:t}function yze(t){return t===10?mze:t===Math.E?Math.exp:e=>Math.pow(t,e)}function vze(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function mG(t){return(e,n)=>-t(-e,n)}function x5(t){const e=t(pG,gG),n=e.domain;let r=10,i,s;function o(){return i=vze(r),s=yze(r),n()[0]<0?(i=mG(i),s=mG(s),t(pze,gze)):t(pG,gG),e}return e.base=function(a){return arguments.length?(r=+a,o()):r},e.domain=function(a){return arguments.length?(n(a),o()):n()},e.ticks=a=>{const l=n();let c=l[0],u=l[l.length-1];const d=u<c;d&&([c,u]=[u,c]);let h=i(c),f=i(u),y,b;const v=a==null?10:+a;let x=[];if(!(r%1)&&f-h<v){if(h=Math.floor(h),f=Math.ceil(f),c>0){for(;h<=f;++h)for(y=1;y<r;++y)if(b=h<0?y/s(-h):y*s(h),!(b<c)){if(b>u)break;x.push(b)}}else for(;h<=f;++h)for(y=r-1;y>=1;--y)if(b=h>0?y/s(-h):y*s(h),!(b<c)){if(b>u)break;x.push(b)}x.length*2<v&&(x=g3(c,u,v))}else x=g3(h,f,Math.min(f-h,v)).map(s);return d?x.reverse():x},e.tickFormat=(a,l)=>{if(a==null&&(a=10),l==null&&(l=r===10?"s":","),typeof l!="function"&&(!(r%1)&&(l=Zx(l)).precision==null&&(l.trim=!0),l=b5(l)),a===1/0)return l;const c=Math.max(1,r*a/e.ticks().length);return u=>{let d=u/s(Math.round(i(u)));return d*r<r-.5&&(d*=r),d<=c?l(u):""}},e.nice=()=>n(yle(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),e}function vle(){const t=x5(tk()).domain([1,10]);return t.copy=()=>lS(t,vle()).base(t.base()),Nl.apply(t,arguments),t}function yG(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function vG(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function w5(t){var e=1,n=t(yG(e),vG(e));return n.constant=function(r){return arguments.length?t(yG(e=+r),vG(e)):e},Pf(n)}function ble(){var t=w5(tk());return t.copy=function(){return lS(t,ble()).constant(t.constant())},Nl.apply(t,arguments)}function bG(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function bze(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function xze(t){return t<0?-t*t:t*t}function S5(t){var e=t(lo,lo),n=1;function r(){return n===1?t(lo,lo):n===.5?t(bze,xze):t(bG(n),bG(1/n))}return e.exponent=function(i){return arguments.length?(n=+i,r()):n},Pf(e)}function C5(){var t=S5(tk());return t.copy=function(){return lS(t,C5()).exponent(t.exponent())},Nl.apply(t,arguments),t}function wze(){return C5.apply(null,arguments).exponent(.5)}function xG(t){return Math.sign(t)*t*t}function Sze(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function xle(){var t=y5(),e=[0,1],n=!1,r;function i(s){var o=Sze(t(s));return isNaN(o)?r:n?Math.round(o):o}return i.invert=function(s){return t.invert(xG(s))},i.domain=function(s){return arguments.length?(t.domain(s),i):t.domain()},i.range=function(s){return arguments.length?(t.range((e=Array.from(s,yI)).map(xG)),i):e.slice()},i.rangeRound=function(s){return i.range(s).round(!0)},i.round=function(s){return arguments.length?(n=!!s,i):n},i.clamp=function(s){return arguments.length?(t.clamp(s),i):t.clamp()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return xle(t.domain(),e).round(n).clamp(t.clamp()).unknown(r)},Nl.apply(i,arguments),Pf(i)}function wle(){var t=[],e=[],n=[],r;function i(){var o=0,a=Math.max(1,e.length);for(n=new Array(a-1);++o<a;)n[o-1]=I5e(t,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:e[oS(n,o)]}return s.invertExtent=function(o){var a=e.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:t[0],a<n.length?n[a]:t[t.length-1]]},s.domain=function(o){if(!arguments.length)return t.slice();t=[];for(let a of o)a!=null&&!isNaN(a=+a)&&t.push(a);return t.sort(rf),i()},s.range=function(o){return arguments.length?(e=Array.from(o),i()):e.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return wle().domain(t).range(e).unknown(r)},Nl.apply(s,arguments)}function Sle(){var t=0,e=1,n=1,r=[.5],i=[0,1],s;function o(l){return l!=null&&l<=l?i[oS(r,l,0,n)]:s}function a(){var l=-1;for(r=new Array(n);++l<n;)r[l]=((l+1)*e-(l-n)*t)/(n+1);return o}return o.domain=function(l){return arguments.length?([t,e]=l,t=+t,e=+e,a()):[t,e]},o.range=function(l){return arguments.length?(n=(i=Array.from(l)).length-1,a()):i.slice()},o.invertExtent=function(l){var c=i.indexOf(l);return c<0?[NaN,NaN]:c<1?[t,r[0]]:c>=n?[r[n-1],e]:[r[c-1],r[c]]},o.unknown=function(l){return arguments.length&&(s=l),o},o.thresholds=function(){return r.slice()},o.copy=function(){return Sle().domain([t,e]).range(i).unknown(s)},Nl.apply(Pf(o),arguments)}function Cle(){var t=[.5],e=[0,1],n,r=1;function i(s){return s!=null&&s<=s?e[oS(t,s,0,r)]:n}return i.domain=function(s){return arguments.length?(t=Array.from(s),r=Math.min(t.length,e.length-1),i):t.slice()},i.range=function(s){return arguments.length?(e=Array.from(s),r=Math.min(t.length,e.length-1),i):e.slice()},i.invertExtent=function(s){var o=e.indexOf(s);return[t[o-1],t[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return Cle().domain(t).range(e).unknown(n)},Nl.apply(i,arguments)}const XD=new Date,JD=new Date;function oi(t,e,n,r){function i(s){return t(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(t(s=new Date(+s)),s),i.ceil=s=>(t(s=new Date(s-1)),e(s,1),t(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(e(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const l=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return l;let c;do l.push(c=new Date(+s)),e(s,a),t(s);while(c<s&&s<o);return l},i.filter=s=>oi(o=>{if(o>=o)for(;t(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;e(o,-1),!s(o););else for(;--a>=0;)for(;e(o,1),!s(o););}),n&&(i.count=(s,o)=>(XD.setTime(+s),JD.setTime(+o),t(XD),t(JD),Math.floor(n(XD,JD))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const bI=oi(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);bI.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?oi(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):bI);bI.range;const id=1e3,Sl=id*60,sd=Sl*60,xd=sd*24,E5=xd*7,wG=xd*30,ZD=xd*365,Pp=oi(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*id)},(t,e)=>(e-t)/id,t=>t.getUTCSeconds());Pp.range;const T5=oi(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*id)},(t,e)=>{t.setTime(+t+e*Sl)},(t,e)=>(e-t)/Sl,t=>t.getMinutes());T5.range;const I5=oi(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*Sl)},(t,e)=>(e-t)/Sl,t=>t.getUTCMinutes());I5.range;const P5=oi(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*id-t.getMinutes()*Sl)},(t,e)=>{t.setTime(+t+e*sd)},(t,e)=>(e-t)/sd,t=>t.getHours());P5.range;const _5=oi(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*sd)},(t,e)=>(e-t)/sd,t=>t.getUTCHours());_5.range;const cS=oi(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Sl)/xd,t=>t.getDate()-1);cS.range;const nk=oi(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/xd,t=>t.getUTCDate()-1);nk.range;const Ele=oi(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/xd,t=>Math.floor(t/xd));Ele.range;function Rg(t){return oi(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*Sl)/E5)}const rk=Rg(0),xI=Rg(1),Cze=Rg(2),Eze=Rg(3),jy=Rg(4),Tze=Rg(5),Ize=Rg(6);rk.range;xI.range;Cze.range;Eze.range;jy.range;Tze.range;Ize.range;function Ng(t){return oi(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/E5)}const ik=Ng(0),wI=Ng(1),Pze=Ng(2),_ze=Ng(3),Ly=Ng(4),kze=Ng(5),Aze=Ng(6);ik.range;wI.range;Pze.range;_ze.range;Ly.range;kze.range;Aze.range;const k5=oi(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());k5.range;const A5=oi(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());A5.range;const wd=oi(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());wd.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:oi(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});wd.range;const Sd=oi(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());Sd.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:oi(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});Sd.range;function Tle(t,e,n,r,i,s){const o=[[Pp,1,id],[Pp,5,5*id],[Pp,15,15*id],[Pp,30,30*id],[s,1,Sl],[s,5,5*Sl],[s,15,15*Sl],[s,30,30*Sl],[i,1,sd],[i,3,3*sd],[i,6,6*sd],[i,12,12*sd],[r,1,xd],[r,2,2*xd],[n,1,E5],[e,1,wG],[e,3,3*wG],[t,1,ZD]];function a(c,u,d){const h=u<c;h&&([c,u]=[u,c]);const f=d&&typeof d.range=="function"?d:l(c,u,d),y=f?f.range(c,+u+1):[];return h?y.reverse():y}function l(c,u,d){const h=Math.abs(u-c)/d,f=d5(([,,v])=>v).right(o,h);if(f===o.length)return t.every(y3(c/ZD,u/ZD,d));if(f===0)return bI.every(Math.max(y3(c,u,d),1));const[y,b]=o[h/o[f-1][2]<o[f][2]/h?f-1:f];return y.every(b)}return[a,l]}const[Mze,Oze]=Tle(Sd,A5,ik,Ele,_5,I5),[Dze,Rze]=Tle(wd,k5,rk,cS,P5,T5);function QD(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function eR(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function X0(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function Nze(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,s=t.days,o=t.shortDays,a=t.months,l=t.shortMonths,c=J0(i),u=Z0(i),d=J0(s),h=Z0(s),f=J0(o),y=Z0(o),b=J0(a),v=Z0(a),x=J0(l),C=Z0(l),E={a:G,A:V,b:W,B:Z,c:null,d:PG,e:PG,f:iUe,g:pUe,G:mUe,H:tUe,I:nUe,j:rUe,L:Ile,m:sUe,M:oUe,p:U,q:J,Q:AG,s:MG,S:aUe,u:lUe,U:cUe,V:uUe,w:dUe,W:hUe,x:null,X:null,y:fUe,Y:gUe,Z:yUe,"%":kG},I={a:ge,A:_e,b:fe,B:je,c:null,d:_G,e:_G,f:wUe,g:MUe,G:DUe,H:vUe,I:bUe,j:xUe,L:_le,m:SUe,M:CUe,p:Ae,q:ke,Q:AG,s:MG,S:EUe,u:TUe,U:IUe,V:PUe,w:_Ue,W:kUe,x:null,X:null,y:AUe,Y:OUe,Z:RUe,"%":kG},P={a:z,A:$,b:H,B:R,c:j,d:TG,e:TG,f:Jze,g:EG,G:CG,H:IG,I:IG,j:qze,L:Xze,m:Kze,M:Gze,p:L,q:Wze,Q:Qze,s:eUe,S:Yze,u:Bze,U:zze,V:Uze,w:$ze,W:Hze,x:B,X:K,y:EG,Y:CG,Z:Vze,"%":Zze};E.x=_(n,E),E.X=_(r,E),E.c=_(e,E),I.x=_(n,I),I.X=_(r,I),I.c=_(e,I);function _(le,ve){return function(qe){var de=[],pe=-1,Se=0,Fe=le.length,ut,Tt,pn;for(qe instanceof Date||(qe=new Date(+qe));++pe<Fe;)le.charCodeAt(pe)===37&&(de.push(le.slice(Se,pe)),(Tt=SG[ut=le.charAt(++pe)])!=null?ut=le.charAt(++pe):Tt=ut==="e"?" ":"0",(pn=ve[ut])&&(ut=pn(qe,Tt)),de.push(ut),Se=pe+1);return de.push(le.slice(Se,pe)),de.join("")}}function A(le,ve){return function(qe){var de=X0(1900,void 0,1),pe=D(de,le,qe+="",0),Se,Fe;if(pe!=qe.length)return null;if("Q"in de)return new Date(de.Q);if("s"in de)return new Date(de.s*1e3+("L"in de?de.L:0));if(ve&&!("Z"in de)&&(de.Z=0),"p"in de&&(de.H=de.H%12+de.p*12),de.m===void 0&&(de.m="q"in de?de.q:0),"V"in de){if(de.V<1||de.V>53)return null;"w"in de||(de.w=1),"Z"in de?(Se=eR(X0(de.y,0,1)),Fe=Se.getUTCDay(),Se=Fe>4||Fe===0?wI.ceil(Se):wI(Se),Se=nk.offset(Se,(de.V-1)*7),de.y=Se.getUTCFullYear(),de.m=Se.getUTCMonth(),de.d=Se.getUTCDate()+(de.w+6)%7):(Se=QD(X0(de.y,0,1)),Fe=Se.getDay(),Se=Fe>4||Fe===0?xI.ceil(Se):xI(Se),Se=cS.offset(Se,(de.V-1)*7),de.y=Se.getFullYear(),de.m=Se.getMonth(),de.d=Se.getDate()+(de.w+6)%7)}else("W"in de||"U"in de)&&("w"in de||(de.w="u"in de?de.u%7:"W"in de?1:0),Fe="Z"in de?eR(X0(de.y,0,1)).getUTCDay():QD(X0(de.y,0,1)).getDay(),de.m=0,de.d="W"in de?(de.w+6)%7+de.W*7-(Fe+5)%7:de.w+de.U*7-(Fe+6)%7);return"Z"in de?(de.H+=de.Z/100|0,de.M+=de.Z%100,eR(de)):QD(de)}}function D(le,ve,qe,de){for(var pe=0,Se=ve.length,Fe=qe.length,ut,Tt;pe<Se;){if(de>=Fe)return-1;if(ut=ve.charCodeAt(pe++),ut===37){if(ut=ve.charAt(pe++),Tt=P[ut in SG?ve.charAt(pe++):ut],!Tt||(de=Tt(le,qe,de))<0)return-1}else if(ut!=qe.charCodeAt(de++))return-1}return de}function L(le,ve,qe){var de=c.exec(ve.slice(qe));return de?(le.p=u.get(de[0].toLowerCase()),qe+de[0].length):-1}function z(le,ve,qe){var de=f.exec(ve.slice(qe));return de?(le.w=y.get(de[0].toLowerCase()),qe+de[0].length):-1}function $(le,ve,qe){var de=d.exec(ve.slice(qe));return de?(le.w=h.get(de[0].toLowerCase()),qe+de[0].length):-1}function H(le,ve,qe){var de=x.exec(ve.slice(qe));return de?(le.m=C.get(de[0].toLowerCase()),qe+de[0].length):-1}function R(le,ve,qe){var de=b.exec(ve.slice(qe));return de?(le.m=v.get(de[0].toLowerCase()),qe+de[0].length):-1}function j(le,ve,qe){return D(le,e,ve,qe)}function B(le,ve,qe){return D(le,n,ve,qe)}function K(le,ve,qe){return D(le,r,ve,qe)}function G(le){return o[le.getDay()]}function V(le){return s[le.getDay()]}function W(le){return l[le.getMonth()]}function Z(le){return a[le.getMonth()]}function U(le){return i[+(le.getHours()>=12)]}function J(le){return 1+~~(le.getMonth()/3)}function ge(le){return o[le.getUTCDay()]}function _e(le){return s[le.getUTCDay()]}function fe(le){return l[le.getUTCMonth()]}function je(le){return a[le.getUTCMonth()]}function Ae(le){return i[+(le.getUTCHours()>=12)]}function ke(le){return 1+~~(le.getUTCMonth()/3)}return{format:function(le){var ve=_(le+="",E);return ve.toString=function(){return le},ve},parse:function(le){var ve=A(le+="",!1);return ve.toString=function(){return le},ve},utcFormat:function(le){var ve=_(le+="",I);return ve.toString=function(){return le},ve},utcParse:function(le){var ve=A(le+="",!0);return ve.toString=function(){return le},ve}}}var SG={"-":"",_:" ",0:"0"},Ri=/^\s*\d+/,jze=/^%/,Lze=/[\\^$*+?|[\]().{}]/g;function dn(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(e)+i:i)}function Fze(t){return t.replace(Lze,"\\$&")}function J0(t){return new RegExp("^(?:"+t.map(Fze).join("|")+")","i")}function Z0(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function $ze(t,e,n){var r=Ri.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Bze(t,e,n){var r=Ri.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function zze(t,e,n){var r=Ri.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function Uze(t,e,n){var r=Ri.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function Hze(t,e,n){var r=Ri.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function CG(t,e,n){var r=Ri.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function EG(t,e,n){var r=Ri.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Vze(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Wze(t,e,n){var r=Ri.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function Kze(t,e,n){var r=Ri.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function TG(t,e,n){var r=Ri.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function qze(t,e,n){var r=Ri.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function IG(t,e,n){var r=Ri.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Gze(t,e,n){var r=Ri.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Yze(t,e,n){var r=Ri.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Xze(t,e,n){var r=Ri.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Jze(t,e,n){var r=Ri.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Zze(t,e,n){var r=jze.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function Qze(t,e,n){var r=Ri.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function eUe(t,e,n){var r=Ri.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function PG(t,e){return dn(t.getDate(),e,2)}function tUe(t,e){return dn(t.getHours(),e,2)}function nUe(t,e){return dn(t.getHours()%12||12,e,2)}function rUe(t,e){return dn(1+cS.count(wd(t),t),e,3)}function Ile(t,e){return dn(t.getMilliseconds(),e,3)}function iUe(t,e){return Ile(t,e)+"000"}function sUe(t,e){return dn(t.getMonth()+1,e,2)}function oUe(t,e){return dn(t.getMinutes(),e,2)}function aUe(t,e){return dn(t.getSeconds(),e,2)}function lUe(t){var e=t.getDay();return e===0?7:e}function cUe(t,e){return dn(rk.count(wd(t)-1,t),e,2)}function Ple(t){var e=t.getDay();return e>=4||e===0?jy(t):jy.ceil(t)}function uUe(t,e){return t=Ple(t),dn(jy.count(wd(t),t)+(wd(t).getDay()===4),e,2)}function dUe(t){return t.getDay()}function hUe(t,e){return dn(xI.count(wd(t)-1,t),e,2)}function fUe(t,e){return dn(t.getFullYear()%100,e,2)}function pUe(t,e){return t=Ple(t),dn(t.getFullYear()%100,e,2)}function gUe(t,e){return dn(t.getFullYear()%1e4,e,4)}function mUe(t,e){var n=t.getDay();return t=n>=4||n===0?jy(t):jy.ceil(t),dn(t.getFullYear()%1e4,e,4)}function yUe(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+dn(e/60|0,"0",2)+dn(e%60,"0",2)}function _G(t,e){return dn(t.getUTCDate(),e,2)}function vUe(t,e){return dn(t.getUTCHours(),e,2)}function bUe(t,e){return dn(t.getUTCHours()%12||12,e,2)}function xUe(t,e){return dn(1+nk.count(Sd(t),t),e,3)}function _le(t,e){return dn(t.getUTCMilliseconds(),e,3)}function wUe(t,e){return _le(t,e)+"000"}function SUe(t,e){return dn(t.getUTCMonth()+1,e,2)}function CUe(t,e){return dn(t.getUTCMinutes(),e,2)}function EUe(t,e){return dn(t.getUTCSeconds(),e,2)}function TUe(t){var e=t.getUTCDay();return e===0?7:e}function IUe(t,e){return dn(ik.count(Sd(t)-1,t),e,2)}function kle(t){var e=t.getUTCDay();return e>=4||e===0?Ly(t):Ly.ceil(t)}function PUe(t,e){return t=kle(t),dn(Ly.count(Sd(t),t)+(Sd(t).getUTCDay()===4),e,2)}function _Ue(t){return t.getUTCDay()}function kUe(t,e){return dn(wI.count(Sd(t)-1,t),e,2)}function AUe(t,e){return dn(t.getUTCFullYear()%100,e,2)}function MUe(t,e){return t=kle(t),dn(t.getUTCFullYear()%100,e,2)}function OUe(t,e){return dn(t.getUTCFullYear()%1e4,e,4)}function DUe(t,e){var n=t.getUTCDay();return t=n>=4||n===0?Ly(t):Ly.ceil(t),dn(t.getUTCFullYear()%1e4,e,4)}function RUe(){return"+0000"}function kG(){return"%"}function AG(t){return+t}function MG(t){return Math.floor(+t/1e3)}var Tm,Ale,Mle;NUe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function NUe(t){return Tm=Nze(t),Ale=Tm.format,Tm.parse,Mle=Tm.utcFormat,Tm.utcParse,Tm}function jUe(t){return new Date(t)}function LUe(t){return t instanceof Date?+t:+new Date(+t)}function M5(t,e,n,r,i,s,o,a,l,c){var u=y5(),d=u.invert,h=u.domain,f=c(".%L"),y=c(":%S"),b=c("%I:%M"),v=c("%I %p"),x=c("%a %d"),C=c("%b %d"),E=c("%B"),I=c("%Y");function P(_){return(l(_)<_?f:a(_)<_?y:o(_)<_?b:s(_)<_?v:r(_)<_?i(_)<_?x:C:n(_)<_?E:I)(_)}return u.invert=function(_){return new Date(d(_))},u.domain=function(_){return arguments.length?h(Array.from(_,LUe)):h().map(jUe)},u.ticks=function(_){var A=h();return t(A[0],A[A.length-1],_??10)},u.tickFormat=function(_,A){return A==null?P:c(A)},u.nice=function(_){var A=h();return(!_||typeof _.range!="function")&&(_=e(A[0],A[A.length-1],_??10)),_?h(yle(A,_)):u},u.copy=function(){return lS(u,M5(t,e,n,r,i,s,o,a,l,c))},u}function FUe(){return Nl.apply(M5(Dze,Rze,wd,k5,rk,cS,P5,T5,Pp,Ale).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function $Ue(){return Nl.apply(M5(Mze,Oze,Sd,A5,ik,nk,_5,I5,Pp,Mle).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function sk(){var t=0,e=1,n,r,i,s,o=lo,a=!1,l;function c(d){return d==null||isNaN(d=+d)?l:o(i===0?.5:(d=(s(d)-n)*i,a?Math.max(0,Math.min(1,d)):d))}c.domain=function(d){return arguments.length?([t,e]=d,n=s(t=+t),r=s(e=+e),i=n===r?0:1/(r-n),c):[t,e]},c.clamp=function(d){return arguments.length?(a=!!d,c):a},c.interpolator=function(d){return arguments.length?(o=d,c):o};function u(d){return function(h){var f,y;return arguments.length?([f,y]=h,o=d(f,y),c):[o(0),o(1)]}}return c.range=u(Sv),c.rangeRound=u(m5),c.unknown=function(d){return arguments.length?(l=d,c):l},function(d){return s=d,n=d(t),r=d(e),i=n===r?0:1/(r-n),c}}function _f(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Ole(){var t=Pf(sk()(lo));return t.copy=function(){return _f(t,Ole())},jd.apply(t,arguments)}function Dle(){var t=x5(sk()).domain([1,10]);return t.copy=function(){return _f(t,Dle()).base(t.base())},jd.apply(t,arguments)}function Rle(){var t=w5(sk());return t.copy=function(){return _f(t,Rle()).constant(t.constant())},jd.apply(t,arguments)}function O5(){var t=S5(sk());return t.copy=function(){return _f(t,O5()).exponent(t.exponent())},jd.apply(t,arguments)}function BUe(){return O5.apply(null,arguments).exponent(.5)}function Nle(){var t=[],e=lo;function n(r){if(r!=null&&!isNaN(r=+r))return e((oS(t,r,1)-1)/(t.length-1))}return n.domain=function(r){if(!arguments.length)return t.slice();t=[];for(let i of r)i!=null&&!isNaN(i=+i)&&t.push(i);return t.sort(rf),n},n.interpolator=function(r){return arguments.length?(e=r,n):e},n.range=function(){return t.map((r,i)=>e(i/(t.length-1)))},n.quantiles=function(r){return Array.from({length:r+1},(i,s)=>T5e(t,s/r))},n.copy=function(){return Nle(e).domain(t)},jd.apply(n,arguments)}function ok(){var t=0,e=.5,n=1,r=1,i,s,o,a,l,c=lo,u,d=!1,h;function f(b){return isNaN(b=+b)?h:(b=.5+((b=+u(b))-s)*(r*b<r*s?a:l),c(d?Math.max(0,Math.min(1,b)):b))}f.domain=function(b){return arguments.length?([t,e,n]=b,i=u(t=+t),s=u(e=+e),o=u(n=+n),a=i===s?0:.5/(s-i),l=s===o?0:.5/(o-s),r=s<i?-1:1,f):[t,e,n]},f.clamp=function(b){return arguments.length?(d=!!b,f):d},f.interpolator=function(b){return arguments.length?(c=b,f):c};function y(b){return function(v){var x,C,E;return arguments.length?([x,C,E]=v,c=Z5e(b,[x,C,E]),f):[c(0),c(.5),c(1)]}}return f.range=y(Sv),f.rangeRound=y(m5),f.unknown=function(b){return arguments.length?(h=b,f):h},function(b){return u=b,i=b(t),s=b(e),o=b(n),a=i===s?0:.5/(s-i),l=s===o?0:.5/(o-s),r=s<i?-1:1,f}}function jle(){var t=Pf(ok()(lo));return t.copy=function(){return _f(t,jle())},jd.apply(t,arguments)}function Lle(){var t=x5(ok()).domain([.1,1,10]);return t.copy=function(){return _f(t,Lle()).base(t.base())},jd.apply(t,arguments)}function Fle(){var t=w5(ok());return t.copy=function(){return _f(t,Fle()).constant(t.constant())},jd.apply(t,arguments)}function D5(){var t=S5(ok());return t.copy=function(){return _f(t,D5()).exponent(t.exponent())},jd.apply(t,arguments)}function zUe(){return D5.apply(null,arguments).exponent(.5)}const Eb=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:f5,scaleDiverging:jle,scaleDivergingLog:Lle,scaleDivergingPow:D5,scaleDivergingSqrt:zUe,scaleDivergingSymlog:Fle,scaleIdentity:mle,scaleImplicit:v3,scaleLinear:gle,scaleLog:vle,scaleOrdinal:h5,scalePoint:_5e,scalePow:C5,scaleQuantile:wle,scaleQuantize:Sle,scaleRadial:xle,scaleSequential:Ole,scaleSequentialLog:Dle,scaleSequentialPow:O5,scaleSequentialQuantile:Nle,scaleSequentialSqrt:BUe,scaleSequentialSymlog:Rle,scaleSqrt:wze,scaleSymlog:ble,scaleThreshold:Cle,scaleTime:FUe,scaleUtc:$Ue,tickFormat:ple},Symbol.toStringTag,{value:"Module"}));var kf=t=>t.chartData,R5=he([kf],t=>{var e=t.chartData!=null?t.chartData.length-1:0;return{chartData:t.chartData,computedData:t.computedData,dataEndIndex:e,dataStartIndex:0}}),$le=(t,e,n,r)=>r?R5(t):kf(t);function Fy(t){if(Array.isArray(t)&&t.length===2){var[e,n]=t;if(xc(e)&&xc(n))return!0}return!1}function OG(t,e,n){return n?t:[Math.min(t[0],e[0]),Math.max(t[1],e[1])]}function UUe(t,e){if(e&&typeof t!="function"&&Array.isArray(t)&&t.length===2){var[n,r]=t,i,s;if(xc(n))i=n;else if(typeof n=="function")return;if(xc(r))s=r;else if(typeof r=="function")return;var o=[i,s];if(Fy(o))return o}}function HUe(t,e,n){if(!(!n&&e==null)){if(typeof t=="function"&&e!=null)try{var r=t(e,n);if(Fy(r))return OG(r,e,n)}catch{}if(Array.isArray(t)&&t.length===2){var[i,s]=t,o,a;if(i==="auto")e!=null&&(o=Math.min(...e));else if(Gt(i))o=i;else if(typeof i=="function")try{e!=null&&(o=i(e==null?void 0:e[0]))}catch{}else if(typeof i=="string"&&bq.test(i)){var l=bq.exec(i);if(l==null||e==null)o=void 0;else{var c=+l[1];o=e[0]-c}}else o=e==null?void 0:e[0];if(s==="auto")e!=null&&(a=Math.max(...e));else if(Gt(s))a=s;else if(typeof s=="function")try{e!=null&&(a=s(e==null?void 0:e[1]))}catch{}else if(typeof s=="string"&&xq.test(s)){var u=xq.exec(s);if(u==null||e==null)a=void 0;else{var d=+u[1];a=e[1]+d}}else a=e==null?void 0:e[1];var h=[o,a];if(Fy(h))return e==null?h:OG(h,e,n)}}}var Cv=1e9,VUe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},j5,Qn=!0,Ol="[DecimalError] ",Up=Ol+"Invalid argument: ",N5=Ol+"Exponent out of range: ",Ev=Math.floor,vp=Math.pow,WUe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ma,vi=1e7,Hn=7,Ble=9007199254740991,SI=Ev(Ble/Hn),Ze={};Ze.absoluteValue=Ze.abs=function(){var t=new this.constructor(this);return t.s&&(t.s=1),t};Ze.comparedTo=Ze.cmp=function(t){var e,n,r,i,s=this;if(t=new s.constructor(t),s.s!==t.s)return s.s||-t.s;if(s.e!==t.e)return s.e>t.e^s.s<0?1:-1;for(r=s.d.length,i=t.d.length,e=0,n=r<i?r:i;e<n;++e)if(s.d[e]!==t.d[e])return s.d[e]>t.d[e]^s.s<0?1:-1;return r===i?0:r>i^s.s<0?1:-1};Ze.decimalPlaces=Ze.dp=function(){var t=this,e=t.d.length-1,n=(e-t.e)*Hn;if(e=t.d[e],e)for(;e%10==0;e/=10)n--;return n<0?0:n};Ze.dividedBy=Ze.div=function(t){return dd(this,new this.constructor(t))};Ze.dividedToIntegerBy=Ze.idiv=function(t){var e=this,n=e.constructor;return In(dd(e,new n(t),0,1),n.precision)};Ze.equals=Ze.eq=function(t){return!this.cmp(t)};Ze.exponent=function(){return Gr(this)};Ze.greaterThan=Ze.gt=function(t){return this.cmp(t)>0};Ze.greaterThanOrEqualTo=Ze.gte=function(t){return this.cmp(t)>=0};Ze.isInteger=Ze.isint=function(){return this.e>this.d.length-2};Ze.isNegative=Ze.isneg=function(){return this.s<0};Ze.isPositive=Ze.ispos=function(){return this.s>0};Ze.isZero=function(){return this.s===0};Ze.lessThan=Ze.lt=function(t){return this.cmp(t)<0};Ze.lessThanOrEqualTo=Ze.lte=function(t){return this.cmp(t)<1};Ze.logarithm=Ze.log=function(t){var e,n=this,r=n.constructor,i=r.precision,s=i+5;if(t===void 0)t=new r(10);else if(t=new r(t),t.s<1||t.eq(ma))throw Error(Ol+"NaN");if(n.s<1)throw Error(Ol+(n.s?"NaN":"-Infinity"));return n.eq(ma)?new r(0):(Qn=!1,e=dd(Qx(n,s),Qx(t,s),s),Qn=!0,In(e,i))};Ze.minus=Ze.sub=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?Hle(e,t):zle(e,(t.s=-t.s,t))};Ze.modulo=Ze.mod=function(t){var e,n=this,r=n.constructor,i=r.precision;if(t=new r(t),!t.s)throw Error(Ol+"NaN");return n.s?(Qn=!1,e=dd(n,t,0,1).times(t),Qn=!0,n.minus(e)):In(new r(n),i)};Ze.naturalExponential=Ze.exp=function(){return Ule(this)};Ze.naturalLogarithm=Ze.ln=function(){return Qx(this)};Ze.negated=Ze.neg=function(){var t=new this.constructor(this);return t.s=-t.s||0,t};Ze.plus=Ze.add=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?zle(e,t):Hle(e,(t.s=-t.s,t))};Ze.precision=Ze.sd=function(t){var e,n,r,i=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(Up+t);if(e=Gr(i)+1,r=i.d.length-1,n=r*Hn+1,r=i.d[r],r){for(;r%10==0;r/=10)n--;for(r=i.d[0];r>=10;r/=10)n++}return t&&e>n?e:n};Ze.squareRoot=Ze.sqrt=function(){var t,e,n,r,i,s,o,a=this,l=a.constructor;if(a.s<1){if(!a.s)return new l(0);throw Error(Ol+"NaN")}for(t=Gr(a),Qn=!1,i=Math.sqrt(+a),i==0||i==1/0?(e=nu(a.d),(e.length+t)%2==0&&(e+="0"),i=Math.sqrt(e),t=Ev((t+1)/2)-(t<0||t%2),i==1/0?e="5e"+t:(e=i.toExponential(),e=e.slice(0,e.indexOf("e")+1)+t),r=new l(e)):r=new l(i.toString()),n=l.precision,i=o=n+3;;)if(s=r,r=s.plus(dd(a,s,o+2)).times(.5),nu(s.d).slice(0,o)===(e=nu(r.d)).slice(0,o)){if(e=e.slice(o-3,o+1),i==o&&e=="4999"){if(In(s,n+1,0),s.times(s).eq(a)){r=s;break}}else if(e!="9999")break;o+=4}return Qn=!0,In(r,n)};Ze.times=Ze.mul=function(t){var e,n,r,i,s,o,a,l,c,u=this,d=u.constructor,h=u.d,f=(t=new d(t)).d;if(!u.s||!t.s)return new d(0);for(t.s*=u.s,n=u.e+t.e,l=h.length,c=f.length,l<c&&(s=h,h=f,f=s,o=l,l=c,c=o),s=[],o=l+c,r=o;r--;)s.push(0);for(r=c;--r>=0;){for(e=0,i=l+r;i>r;)a=s[i]+f[r]*h[i-r-1]+e,s[i--]=a%vi|0,e=a/vi|0;s[i]=(s[i]+e)%vi|0}for(;!s[--o];)s.pop();return e?++n:s.shift(),t.d=s,t.e=n,Qn?In(t,d.precision):t};Ze.toDecimalPlaces=Ze.todp=function(t,e){var n=this,r=n.constructor;return n=new r(n),t===void 0?n:(mu(t,0,Cv),e===void 0?e=r.rounding:mu(e,0,8),In(n,t+Gr(n)+1,e))};Ze.toExponential=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=ag(r,!0):(mu(t,0,Cv),e===void 0?e=i.rounding:mu(e,0,8),r=In(new i(r),t+1,e),n=ag(r,!0,t+1)),n};Ze.toFixed=function(t,e){var n,r,i=this,s=i.constructor;return t===void 0?ag(i):(mu(t,0,Cv),e===void 0?e=s.rounding:mu(e,0,8),r=In(new s(i),t+Gr(i)+1,e),n=ag(r.abs(),!1,t+Gr(r)+1),i.isneg()&&!i.isZero()?"-"+n:n)};Ze.toInteger=Ze.toint=function(){var t=this,e=t.constructor;return In(new e(t),Gr(t)+1,e.rounding)};Ze.toNumber=function(){return+this};Ze.toPower=Ze.pow=function(t){var e,n,r,i,s,o,a=this,l=a.constructor,c=12,u=+(t=new l(t));if(!t.s)return new l(ma);if(a=new l(a),!a.s){if(t.s<1)throw Error(Ol+"Infinity");return a}if(a.eq(ma))return a;if(r=l.precision,t.eq(ma))return In(a,r);if(e=t.e,n=t.d.length-1,o=e>=n,s=a.s,o){if((n=u<0?-u:u)<=Ble){for(i=new l(ma),e=Math.ceil(r/Hn+4),Qn=!1;n%2&&(i=i.times(a),RG(i.d,e)),n=Ev(n/2),n!==0;)a=a.times(a),RG(a.d,e);return Qn=!0,t.s<0?new l(ma).div(i):In(i,r)}}else if(s<0)throw Error(Ol+"NaN");return s=s<0&&t.d[Math.max(e,n)]&1?-1:1,a.s=1,Qn=!1,i=t.times(Qx(a,r+c)),Qn=!0,i=Ule(i),i.s=s,i};Ze.toPrecision=function(t,e){var n,r,i=this,s=i.constructor;return t===void 0?(n=Gr(i),r=ag(i,n<=s.toExpNeg||n>=s.toExpPos)):(mu(t,1,Cv),e===void 0?e=s.rounding:mu(e,0,8),i=In(new s(i),t,e),n=Gr(i),r=ag(i,t<=n||n<=s.toExpNeg,t)),r};Ze.toSignificantDigits=Ze.tosd=function(t,e){var n=this,r=n.constructor;return t===void 0?(t=r.precision,e=r.rounding):(mu(t,1,Cv),e===void 0?e=r.rounding:mu(e,0,8)),In(new r(n),t,e)};Ze.toString=Ze.valueOf=Ze.val=Ze.toJSON=Ze[Symbol.for("nodejs.util.inspect.custom")]=function(){var t=this,e=Gr(t),n=t.constructor;return ag(t,e<=n.toExpNeg||e>=n.toExpPos)};function zle(t,e){var n,r,i,s,o,a,l,c,u=t.constructor,d=u.precision;if(!t.s||!e.s)return e.s||(e=new u(t)),Qn?In(e,d):e;if(l=t.d,c=e.d,o=t.e,i=e.e,l=l.slice(),s=o-i,s){for(s<0?(r=l,s=-s,a=c.length):(r=c,i=o,a=l.length),o=Math.ceil(d/Hn),a=o>a?o+1:a+1,s>a&&(s=a,r.length=1),r.reverse();s--;)r.push(0);r.reverse()}for(a=l.length,s=c.length,a-s<0&&(s=a,r=c,c=l,l=r),n=0;s;)n=(l[--s]=l[s]+c[s]+n)/vi|0,l[s]%=vi;for(n&&(l.unshift(n),++i),a=l.length;l[--a]==0;)l.pop();return e.d=l,e.e=i,Qn?In(e,d):e}function mu(t,e,n){if(t!==~~t||t<e||t>n)throw Error(Up+t)}function nu(t){var e,n,r,i=t.length-1,s="",o=t[0];if(i>0){for(s+=o,e=1;e<i;e++)r=t[e]+"",n=Hn-r.length,n&&(s+=Mh(n)),s+=r;o=t[e],r=o+"",n=Hn-r.length,n&&(s+=Mh(n))}else if(o===0)return"0";for(;o%10===0;)o/=10;return s+o}var dd=function(){function t(r,i){var s,o=0,a=r.length;for(r=r.slice();a--;)s=r[a]*i+o,r[a]=s%vi|0,o=s/vi|0;return o&&r.unshift(o),r}function e(r,i,s,o){var a,l;if(s!=o)l=s>o?1:-1;else for(a=l=0;a<s;a++)if(r[a]!=i[a]){l=r[a]>i[a]?1:-1;break}return l}function n(r,i,s){for(var o=0;s--;)r[s]-=o,o=r[s]<i[s]?1:0,r[s]=o*vi+r[s]-i[s];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,s,o){var a,l,c,u,d,h,f,y,b,v,x,C,E,I,P,_,A,D,L=r.constructor,z=r.s==i.s?1:-1,$=r.d,H=i.d;if(!r.s)return new L(r);if(!i.s)throw Error(Ol+"Division by zero");for(l=r.e-i.e,A=H.length,P=$.length,f=new L(z),y=f.d=[],c=0;H[c]==($[c]||0);)++c;if(H[c]>($[c]||0)&&--l,s==null?C=s=L.precision:o?C=s+(Gr(r)-Gr(i))+1:C=s,C<0)return new L(0);if(C=C/Hn+2|0,c=0,A==1)for(u=0,H=H[0],C++;(c<P||u)&&C--;c++)E=u*vi+($[c]||0),y[c]=E/H|0,u=E%H|0;else{for(u=vi/(H[0]+1)|0,u>1&&(H=t(H,u),$=t($,u),A=H.length,P=$.length),I=A,b=$.slice(0,A),v=b.length;v<A;)b[v++]=0;D=H.slice(),D.unshift(0),_=H[0],H[1]>=vi/2&&++_;do u=0,a=e(H,b,A,v),a<0?(x=b[0],A!=v&&(x=x*vi+(b[1]||0)),u=x/_|0,u>1?(u>=vi&&(u=vi-1),d=t(H,u),h=d.length,v=b.length,a=e(d,b,h,v),a==1&&(u--,n(d,A<h?D:H,h))):(u==0&&(a=u=1),d=H.slice()),h=d.length,h<v&&d.unshift(0),n(b,d,v),a==-1&&(v=b.length,a=e(H,b,A,v),a<1&&(u++,n(b,A<v?D:H,v))),v=b.length):a===0&&(u++,b=[0]),y[c++]=u,a&&b[0]?b[v++]=$[I]||0:(b=[$[I]],v=1);while((I++<P||b[0]!==void 0)&&C--)}return y[0]||y.shift(),f.e=l,In(f,o?s+Gr(f)+1:s)}}();function Ule(t,e){var n,r,i,s,o,a,l=0,c=0,u=t.constructor,d=u.precision;if(Gr(t)>16)throw Error(N5+Gr(t));if(!t.s)return new u(ma);for(Qn=!1,a=d,o=new u(.03125);t.abs().gte(.1);)t=t.times(o),c+=5;for(r=Math.log(vp(2,c))/Math.LN10*2+5|0,a+=r,n=i=s=new u(ma),u.precision=a;;){if(i=In(i.times(t),a),n=n.times(++l),o=s.plus(dd(i,n,a)),nu(o.d).slice(0,a)===nu(s.d).slice(0,a)){for(;c--;)s=In(s.times(s),a);return u.precision=d,e==null?(Qn=!0,In(s,d)):s}s=o}}function Gr(t){for(var e=t.e*Hn,n=t.d[0];n>=10;n/=10)e++;return e}function tR(t,e,n){if(e>t.LN10.sd())throw Qn=!0,n&&(t.precision=n),Error(Ol+"LN10 precision limit exceeded");return In(new t(t.LN10),e)}function Mh(t){for(var e="";t--;)e+="0";return e}function Qx(t,e){var n,r,i,s,o,a,l,c,u,d=1,h=10,f=t,y=f.d,b=f.constructor,v=b.precision;if(f.s<1)throw Error(Ol+(f.s?"NaN":"-Infinity"));if(f.eq(ma))return new b(0);if(e==null?(Qn=!1,c=v):c=e,f.eq(10))return e==null&&(Qn=!0),tR(b,c);if(c+=h,b.precision=c,n=nu(y),r=n.charAt(0),s=Gr(f),Math.abs(s)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)f=f.times(t),n=nu(f.d),r=n.charAt(0),d++;s=Gr(f),r>1?(f=new b("0."+n),s++):f=new b(r+"."+n.slice(1))}else return l=tR(b,c+2,v).times(s+""),f=Qx(new b(r+"."+n.slice(1)),c-h).plus(l),b.precision=v,e==null?(Qn=!0,In(f,v)):f;for(a=o=f=dd(f.minus(ma),f.plus(ma),c),u=In(f.times(f),c),i=3;;){if(o=In(o.times(u),c),l=a.plus(dd(o,new b(i),c)),nu(l.d).slice(0,c)===nu(a.d).slice(0,c))return a=a.times(2),s!==0&&(a=a.plus(tR(b,c+2,v).times(s+""))),a=dd(a,new b(d),c),b.precision=v,e==null?(Qn=!0,In(a,v)):a;a=l,i+=2}}function DG(t,e){var n,r,i;for((n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),r=0;e.charCodeAt(r)===48;)++r;for(i=e.length;e.charCodeAt(i-1)===48;)--i;if(e=e.slice(r,i),e){if(i-=r,n=n-r-1,t.e=Ev(n/Hn),t.d=[],r=(n+1)%Hn,n<0&&(r+=Hn),r<i){for(r&&t.d.push(+e.slice(0,r)),i-=Hn;r<i;)t.d.push(+e.slice(r,r+=Hn));e=e.slice(r),r=Hn-e.length}else r-=i;for(;r--;)e+="0";if(t.d.push(+e),Qn&&(t.e>SI||t.e<-SI))throw Error(N5+n)}else t.s=0,t.e=0,t.d=[0];return t}function In(t,e,n){var r,i,s,o,a,l,c,u,d=t.d;for(o=1,s=d[0];s>=10;s/=10)o++;if(r=e-o,r<0)r+=Hn,i=e,c=d[u=0];else{if(u=Math.ceil((r+1)/Hn),s=d.length,u>=s)return t;for(c=s=d[u],o=1;s>=10;s/=10)o++;r%=Hn,i=r-Hn+o}if(n!==void 0&&(s=vp(10,o-i-1),a=c/s%10|0,l=e<0||d[u+1]!==void 0||c%s,l=n<4?(a||l)&&(n==0||n==(t.s<0?3:2)):a>5||a==5&&(n==4||l||n==6&&(r>0?i>0?c/vp(10,o-i):0:d[u-1])%10&1||n==(t.s<0?8:7))),e<1||!d[0])return l?(s=Gr(t),d.length=1,e=e-s-1,d[0]=vp(10,(Hn-e%Hn)%Hn),t.e=Ev(-e/Hn)||0):(d.length=1,d[0]=t.e=t.s=0),t;if(r==0?(d.length=u,s=1,u--):(d.length=u+1,s=vp(10,Hn-r),d[u]=i>0?(c/vp(10,o-i)%vp(10,i)|0)*s:0),l)for(;;)if(u==0){(d[0]+=s)==vi&&(d[0]=1,++t.e);break}else{if(d[u]+=s,d[u]!=vi)break;d[u--]=0,s=1}for(r=d.length;d[--r]===0;)d.pop();if(Qn&&(t.e>SI||t.e<-SI))throw Error(N5+Gr(t));return t}function Hle(t,e){var n,r,i,s,o,a,l,c,u,d,h=t.constructor,f=h.precision;if(!t.s||!e.s)return e.s?e.s=-e.s:e=new h(t),Qn?In(e,f):e;if(l=t.d,d=e.d,r=e.e,c=t.e,l=l.slice(),o=c-r,o){for(u=o<0,u?(n=l,o=-o,a=d.length):(n=d,r=c,a=l.length),i=Math.max(Math.ceil(f/Hn),a)+2,o>i&&(o=i,n.length=1),n.reverse(),i=o;i--;)n.push(0);n.reverse()}else{for(i=l.length,a=d.length,u=i<a,u&&(a=i),i=0;i<a;i++)if(l[i]!=d[i]){u=l[i]<d[i];break}o=0}for(u&&(n=l,l=d,d=n,e.s=-e.s),a=l.length,i=d.length-a;i>0;--i)l[a++]=0;for(i=d.length;i>o;){if(l[--i]<d[i]){for(s=i;s&&l[--s]===0;)l[s]=vi-1;--l[s],l[i]+=vi}l[i]-=d[i]}for(;l[--a]===0;)l.pop();for(;l[0]===0;l.shift())--r;return l[0]?(e.d=l,e.e=r,Qn?In(e,f):e):new h(0)}function ag(t,e,n){var r,i=Gr(t),s=nu(t.d),o=s.length;return e?(n&&(r=n-o)>0?s=s.charAt(0)+"."+s.slice(1)+Mh(r):o>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(i<0?"e":"e+")+i):i<0?(s="0."+Mh(-i-1)+s,n&&(r=n-o)>0&&(s+=Mh(r))):i>=o?(s+=Mh(i+1-o),n&&(r=n-i-1)>0&&(s=s+"."+Mh(r))):((r=i+1)<o&&(s=s.slice(0,r)+"."+s.slice(r)),n&&(r=n-o)>0&&(i+1===o&&(s+="."),s+=Mh(r))),t.s<0?"-"+s:s}function RG(t,e){if(t.length>e)return t.length=e,!0}function Vle(t){var e,n,r;function i(s){var o=this;if(!(o instanceof i))return new i(s);if(o.constructor=i,s instanceof i){o.s=s.s,o.e=s.e,o.d=(s=s.d)?s.slice():s;return}if(typeof s=="number"){if(s*0!==0)throw Error(Up+s);if(s>0)o.s=1;else if(s<0)s=-s,o.s=-1;else{o.s=0,o.e=0,o.d=[0];return}if(s===~~s&&s<1e7){o.e=0,o.d=[s];return}return DG(o,s.toString())}else if(typeof s!="string")throw Error(Up+s);if(s.charCodeAt(0)===45?(s=s.slice(1),o.s=-1):o.s=1,WUe.test(s))DG(o,s);else throw Error(Up+s)}if(i.prototype=Ze,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=Vle,i.config=i.set=KUe,t===void 0&&(t={}),t)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<r.length;)t.hasOwnProperty(n=r[e++])||(t[n]=this[n]);return i.config(t),i}function KUe(t){if(!t||typeof t!="object")throw Error(Ol+"Object expected");var e,n,r,i=["precision",1,Cv,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<i.length;e+=3)if((r=t[n=i[e]])!==void 0)if(Ev(r)===r&&r>=i[e+1]&&r<=i[e+2])this[n]=r;else throw Error(Up+n+": "+r);if((r=t[n="LN10"])!==void 0)if(r==Math.LN10)this[n]=new this(r);else throw Error(Up+n+": "+r);return this}var j5=Vle(VUe);ma=new j5(1);const vn=j5;var qUe=t=>t,Wle={},Kle=t=>t===Wle,NG=t=>function e(){return arguments.length===0||arguments.length===1&&Kle(arguments.length<=0?void 0:arguments[0])?e:t(...arguments)},qle=(t,e)=>t===1?e:NG(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var s=r.filter(o=>o!==Wle).length;return s>=t?e(...r):qle(t-s,NG(function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];var c=r.map(u=>Kle(u)?a.shift():u);return e(...c,...a)}))}),ak=t=>qle(t.length,t),S3=(t,e)=>{for(var n=[],r=t;r<e;++r)n[r-t]=r;return n},GUe=ak((t,e)=>Array.isArray(e)?e.map(t):Object.keys(e).map(n=>e[n]).map(t)),YUe=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!n.length)return qUe;var i=n.reverse(),s=i[0],o=i.slice(1);return function(){return o.reduce((a,l)=>l(a),s(...arguments))}},C3=t=>Array.isArray(t)?t.reverse():t.split("").reverse().join(""),Gle=t=>{var e=null,n=null;return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return e&&i.every((o,a)=>{var l;return o===((l=e)===null||l===void 0?void 0:l[a])})||(e=i,n=t(...i)),n}};function Yle(t){var e;return t===0?e=1:e=Math.floor(new vn(t).abs().log(10).toNumber())+1,e}function Xle(t,e,n){for(var r=new vn(t),i=0,s=[];r.lt(e)&&i<1e5;)s.push(r.toNumber()),r=r.add(n),i++;return s}ak((t,e,n)=>{var r=+t,i=+e;return r+n*(i-r)});ak((t,e,n)=>{var r=e-+t;return r=r||1/0,(n-t)/r});ak((t,e,n)=>{var r=e-+t;return r=r||1/0,Math.max(0,Math.min(1,(n-t)/r))});var Jle=t=>{var[e,n]=t,[r,i]=[e,n];return e>n&&([r,i]=[n,e]),[r,i]},Zle=(t,e,n)=>{if(t.lte(0))return new vn(0);var r=Yle(t.toNumber()),i=new vn(10).pow(r),s=t.div(i),o=r!==1?.05:.1,a=new vn(Math.ceil(s.div(o).toNumber())).add(n).mul(o),l=a.mul(i);return e?new vn(l.toNumber()):new vn(Math.ceil(l.toNumber()))},XUe=(t,e,n)=>{var r=new vn(1),i=new vn(t);if(!i.isint()&&n){var s=Math.abs(t);s<1?(r=new vn(10).pow(Yle(t)-1),i=new vn(Math.floor(i.div(r).toNumber())).mul(r)):s>1&&(i=new vn(Math.floor(t)))}else t===0?i=new vn(Math.floor((e-1)/2)):n||(i=new vn(Math.floor(t)));var o=Math.floor((e-1)/2),a=YUe(GUe(l=>i.add(new vn(l-o).mul(r)).toNumber()),S3);return a(0,e)},Qle=function(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-e)/(r-1)))return{step:new vn(0),tickMin:new vn(0),tickMax:new vn(0)};var o=Zle(new vn(n).sub(e).div(r-1),i,s),a;e<=0&&n>=0?a=new vn(0):(a=new vn(e).add(n).div(2),a=a.sub(new vn(a).mod(o)));var l=Math.ceil(a.sub(e).div(o).toNumber()),c=Math.ceil(new vn(n).sub(a).div(o).toNumber()),u=l+c+1;return u>r?Qle(e,n,r,i,s+1):(u<r&&(c=n>0?c+(r-u):c,l=n>0?l:l+(r-u)),{step:o,tickMin:a.sub(new vn(l).mul(o)),tickMax:a.add(new vn(c).mul(o))})};function JUe(t){var[e,n]=t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=Math.max(r,2),[o,a]=Jle([e,n]);if(o===-1/0||a===1/0){var l=a===1/0?[o,...S3(0,r-1).map(()=>1/0)]:[...S3(0,r-1).map(()=>-1/0),a];return e>n?C3(l):l}if(o===a)return XUe(o,r,i);var{step:c,tickMin:u,tickMax:d}=Qle(o,a,s,i,0),h=Xle(u,d.add(new vn(.1).mul(c)),c);return e>n?C3(h):h}function ZUe(t,e){var[n,r]=t,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[s,o]=Jle([n,r]);if(s===-1/0||o===1/0)return[n,r];if(s===o)return[s];var a=Math.max(e,2),l=Zle(new vn(o).sub(s).div(a-1),i,0),c=[...Xle(new vn(s),new vn(o),l),o];return i===!1&&(c=c.map(u=>Math.round(u))),n>r?C3(c):c}var QUe=Gle(JUe),e6e=Gle(ZUe),t6e=t=>t.rootProps.barCategoryGap,uS=t=>t.rootProps.stackOffset,L5=t=>t.options.chartName,F5=t=>t.rootProps.syncId,ece=t=>t.rootProps.syncMethod,$5=t=>t.options.eventEmitter,td={allowDuplicatedCategory:!0,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"category"},pa={allowDataOverflow:!1,allowDuplicatedCategory:!0,radiusAxisId:0,scale:"auto",tick:!0,tickCount:5,type:"number"},lk=(t,e)=>{if(!(!t||!e))return t!=null&&t.reversed?[e[1],e[0]]:e},n6e={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:td.angleAxisId,includeHidden:!1,name:void 0,reversed:td.reversed,scale:td.scale,tick:td.tick,tickCount:void 0,ticks:void 0,type:td.type,unit:void 0},r6e={allowDataOverflow:pa.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:pa.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:pa.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:pa.scale,tick:pa.tick,tickCount:pa.tickCount,ticks:void 0,type:pa.type,unit:void 0},i6e={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:td.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:td.angleAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:td.scale,tick:td.tick,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},s6e={allowDataOverflow:pa.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:pa.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:pa.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:pa.scale,tick:pa.tick,tickCount:pa.tickCount,ticks:void 0,type:"category",unit:void 0},B5=(t,e)=>t.polarAxis.angleAxis[e]!=null?t.polarAxis.angleAxis[e]:t.layout.layoutType==="radial"?i6e:n6e,z5=(t,e)=>t.polarAxis.radiusAxis[e]!=null?t.polarAxis.radiusAxis[e]:t.layout.layoutType==="radial"?s6e:r6e,ck=t=>t.polarOptions,U5=he([Rd,Nd,Bs],Nae),tce=he([ck,U5],(t,e)=>{if(t!=null)return du(t.innerRadius,e,0)}),nce=he([ck,U5],(t,e)=>{if(t!=null)return du(t.outerRadius,e,e*.8)}),o6e=t=>{if(t==null)return[0,0];var{startAngle:e,endAngle:n}=t;return[e,n]},rce=he([ck],o6e);he([B5,rce],lk);var ice=he([U5,tce,nce],(t,e,n)=>{if(!(t==null||e==null||n==null))return[e,n]});he([z5,ice],lk);var a6e=he([jn,ck,tce,nce,Rd,Nd],(t,e,n,r,i,s)=>{if(!(t!=="centric"&&t!=="radial"||e==null||n==null||r==null)){var{cx:o,cy:a,startAngle:l,endAngle:c}=e;return{cx:du(o,i,i/2),cy:du(a,s,s/2),innerRadius:n,outerRadius:r,startAngle:l,endAngle:c,clockWise:!1}}}),nr=(t,e)=>e,dS=(t,e,n)=>n;function sce(t){return t==null?void 0:t.id}var ai=t=>{var e=jn(t);return e==="horizontal"?"xAxis":e==="vertical"?"yAxis":e==="centric"?"angleAxis":"radiusAxis"},Tv=t=>t.tooltip.settings.axisId,li=t=>{var e=ai(t),n=Tv(t);return hS(t,e,n)};function oce(t,e,n){var{chartData:r=[]}=e,i=n==null?void 0:n.dataKey,s=new Map;return t.forEach(o=>{var a,l=(a=o.data)!==null&&a!==void 0?a:r;if(!(l==null||l.length===0)){var c=sce(o);l.forEach((u,d)=>{var h=i==null?d:String(Wr(u,i,null)),f=Wr(u,o.dataKey,0),y;s.has(h)?y=s.get(h):y={},Object.assign(y,{[c]:f}),s.set(h,y)})}}),Array.from(s.values())}function H5(t){return t.stackId!=null&&t.dataKey!=null}function jG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function CI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jG(Object(n),!0).forEach(function(r){l6e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function l6e(t,e,n){return(e=c6e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c6e(t){var e=u6e(t,"string");return typeof e=="symbol"?e:e+""}function u6e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var E3=[0,"auto"],d6e={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},Iv=(t,e)=>{var n=t.cartesianAxis.xAxis[e];return n??d6e},h6e={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:E3,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:J_},Pv=(t,e)=>{var n=t.cartesianAxis.yAxis[e];return n??h6e},f6e={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},V5=(t,e)=>{var n=t.cartesianAxis.zAxis[e];return n??f6e},jr=(t,e,n)=>{switch(e){case"xAxis":return Iv(t,n);case"yAxis":return Pv(t,n);case"zAxis":return V5(t,n);case"angleAxis":return B5(t,n);case"radiusAxis":return z5(t,n);default:throw new Error("Unexpected axis type: ".concat(e))}},p6e=(t,e,n)=>{switch(e){case"xAxis":return Iv(t,n);case"yAxis":return Pv(t,n);default:throw new Error("Unexpected axis type: ".concat(e))}},hS=(t,e,n)=>{switch(e){case"xAxis":return Iv(t,n);case"yAxis":return Pv(t,n);case"angleAxis":return B5(t,n);case"radiusAxis":return z5(t,n);default:throw new Error("Unexpected axis type: ".concat(e))}},ace=t=>t.graphicalItems.cartesianItems.some(e=>e.type==="bar")||t.graphicalItems.polarItems.some(e=>e.type==="radialBar");function W5(t,e){return n=>{switch(t){case"xAxis":return"xAxisId"in n&&n.xAxisId===e;case"yAxis":return"yAxisId"in n&&n.yAxisId===e;case"zAxis":return"zAxisId"in n&&n.zAxisId===e;case"angleAxis":return"angleAxisId"in n&&n.angleAxisId===e;case"radiusAxis":return"radiusAxisId"in n&&n.radiusAxisId===e;default:return!1}}}var g6e=t=>t.graphicalItems.cartesianItems,m6e=he([nr,dS],W5),K5=(t,e,n)=>t.filter(n).filter(r=>(e==null?void 0:e.includeHidden)===!0?!0:!r.hide),fS=he([g6e,jr,m6e],K5),lce=he([fS],t=>t.filter(e=>e.type==="area"||e.type==="bar").filter(H5)),cce=t=>t.filter(e=>!("stackId"in e)||e.stackId===void 0),uce=he([fS],cce),q5=t=>t.map(e=>e.data).filter(Boolean).flat(1),y6e=he([fS],q5),G5=(t,e)=>{var{chartData:n=[],dataStartIndex:r,dataEndIndex:i}=e;return t.length>0?t:n.slice(r,i+1)},Y5=he([y6e,$le],G5),X5=(t,e,n)=>(e==null?void 0:e.dataKey)!=null?t.map(r=>({value:Wr(r,e.dataKey)})):n.length>0?n.map(r=>r.dataKey).flatMap(r=>t.map(i=>({value:Wr(i,r)}))):t.map(r=>({value:r})),uk=he([Y5,jr,fS],X5);function dce(t,e){switch(t){case"xAxis":return e.direction==="x";case"yAxis":return e.direction==="y";default:return!1}}function jg(t){return t.filter(e=>vd(e)||e instanceof Date).map(Number).filter(e=>bc(e)===!1)}function v6e(t,e,n){return!n||typeof e!="number"||bc(e)?[]:n.length?jg(n.flatMap(r=>{var i=Wr(t,r.dataKey),s,o;if(Array.isArray(i)?[s,o]=i:s=o=i,!(!xc(s)||!xc(o)))return[e-s,e+o]})):[]}var b6e=he([lce,$le,li],oce),hce=(t,e,n)=>{var r={},i=e.reduce((s,o)=>(o.stackId==null||(s[o.stackId]==null&&(s[o.stackId]=[]),s[o.stackId].push(o)),s),r);return Object.fromEntries(Object.entries(i).map(s=>{var[o,a]=s,l=a.map(sce);return[o,{stackedData:mBe(t,l,n),graphicalItems:a}]}))},x6e=he([b6e,lce,uS],hce),fce=(t,e,n)=>{var{dataStartIndex:r,dataEndIndex:i}=e;if(n!=="zAxis"){var s=bBe(t,r,i);if(!(s!=null&&s[0]===0&&s[1]===0))return s}},w6e=he([x6e,kf,nr],fce),pce=(t,e,n,r,i)=>n.length>0?t.flatMap(s=>n.flatMap(o=>{var a,l,c=(a=r[o.id])===null||a===void 0?void 0:a.filter(d=>dce(i,d)),u=Wr(s,(l=e.dataKey)!==null&&l!==void 0?l:o.dataKey);return{value:u,errorDomain:v6e(s,u,c)}})).filter(Boolean):(e==null?void 0:e.dataKey)!=null?t.map(s=>({value:Wr(s,e.dataKey),errorDomain:[]})):t.map(s=>({value:s,errorDomain:[]})),dk=t=>t.errorBars,gce=(t,e,n)=>t.flatMap(r=>e[r.id]).filter(Boolean).filter(r=>dce(n,r));he([uce,dk,nr],gce);var S6e=he([Y5,jr,uce,dk,nr],pce);function C6e(t){var{value:e}=t;if(vd(e)||e instanceof Date)return e}var LG=t=>{var e=t.flatMap(r=>[r.value,r.errorDomain]).flat(1),n=jg(e);if(n.length!==0)return[Math.min(...n),Math.max(...n)]},E6e=(t,e,n)=>{var r=t.map(C6e).filter(i=>i!=null);return n&&(e.dataKey==null||e.allowDuplicatedCategory&&Ooe(r))?ile(0,t.length):e.allowDuplicatedCategory?r:Array.from(new Set(r))},J5=t=>{var e;if(t==null||!("domain"in t))return E3;if(t.domain!=null)return t.domain;if(t.ticks!=null){if(t.type==="number"){var n=jg(t.ticks);return[Math.min(...n),Math.max(...n)]}if(t.type==="category")return t.ticks.map(String)}return(e=t==null?void 0:t.domain)!==null&&e!==void 0?e:E3},EI=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=n.filter(Boolean);if(i.length!==0){var s=i.flat(),o=Math.min(...s),a=Math.max(...s);return[o,a]}},mce=t=>t.referenceElements.dots,_v=(t,e,n)=>t.filter(r=>r.ifOverflow==="extendDomain").filter(r=>e==="xAxis"?r.xAxisId===n:r.yAxisId===n),T6e=he([mce,nr,dS],_v),yce=t=>t.referenceElements.areas,I6e=he([yce,nr,dS],_v),vce=t=>t.referenceElements.lines,P6e=he([vce,nr,dS],_v),bce=(t,e)=>{var n=jg(t.map(r=>e==="xAxis"?r.x:r.y));if(n.length!==0)return[Math.min(...n),Math.max(...n)]},_6e=he(T6e,nr,bce),xce=(t,e)=>{var n=jg(t.flatMap(r=>[e==="xAxis"?r.x1:r.y1,e==="xAxis"?r.x2:r.y2]));if(n.length!==0)return[Math.min(...n),Math.max(...n)]},k6e=he([I6e,nr],xce),wce=(t,e)=>{var n=jg(t.map(r=>e==="xAxis"?r.x:r.y));if(n.length!==0)return[Math.min(...n),Math.max(...n)]},A6e=he(P6e,nr,wce),M6e=he(_6e,A6e,k6e,(t,e,n)=>EI(t,n,e)),Sce=he([jr],J5),Z5=(t,e,n,r,i,s,o)=>{var a=UUe(e,t.allowDataOverflow);if(a!=null)return a;var l=s==="vertical"&&o==="xAxis"||s==="horizontal"&&o==="yAxis",c=l?EI(n,i,LG(r)):EI(i,LG(r));return HUe(e,c,t.allowDataOverflow)},O6e=he([jr,Sce,w6e,S6e,M6e,jn,nr],Z5),D6e=[0,1],Q5=(t,e,n,r,i,s,o)=>{if(!((t==null||n==null||n.length===0)&&o===void 0)){var{dataKey:a,type:l}=t,c=Dg(e,s);return c&&a==null?ile(0,n.length):l==="category"?E6e(r,t,c):i==="expand"?D6e:o}},ez=he([jr,jn,Y5,uk,uS,nr,O6e],Q5),Cce=(t,e,n,r,i)=>{if(t!=null){var{scale:s,type:o}=t;if(s==="auto")return e==="radial"&&i==="radiusAxis"?"band":e==="radial"&&i==="angleAxis"?"linear":o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?"point":o==="category"?"band":"linear";if(typeof s=="string"){var a="scale".concat(iS(s));return a in Eb?a:"point"}}},kv=he([jr,jn,ace,L5,nr],Cce);function R6e(t){if(t!=null){if(t in Eb)return Eb[t]();var e="scale".concat(iS(t));if(e in Eb)return Eb[e]()}}function tz(t,e,n,r){if(!(n==null||r==null)){if(typeof t.scale=="function")return t.scale.copy().domain(n).range(r);var i=R6e(e);if(i!=null){var s=i.domain(n).range(r);return hBe(s),s}}}var nz=(t,e,n)=>{var r=J5(e);if(!(n!=="auto"&&n!=="linear")){if(e!=null&&e.tickCount&&Array.isArray(r)&&(r[0]==="auto"||r[1]==="auto")&&Fy(t))return QUe(t,e.tickCount,e.allowDecimals);if(e!=null&&e.tickCount&&e.type==="number"&&Fy(t))return e6e(t,e.tickCount,e.allowDecimals)}},rz=he([ez,hS,kv],nz),iz=(t,e,n,r)=>{if(r!=="angleAxis"&&(t==null?void 0:t.type)==="number"&&Fy(e)&&Array.isArray(n)&&n.length>0){var i=e[0],s=n[0],o=e[1],a=n[n.length-1];return[Math.min(i,s),Math.max(o,a)]}return e},N6e=he([jr,ez,rz,nr],iz),j6e=he(uk,jr,(t,e)=>{if(!(!e||e.type!=="number")){var n=1/0,r=Array.from(jg(t.map(a=>a.value))).sort((a,l)=>a-l);if(r.length<2)return 1/0;var i=r[r.length-1]-r[0];if(i===0)return 1/0;for(var s=0;s<r.length-1;s++){var o=r[s+1]-r[s];n=Math.min(n,o)}return n/i}}),Ece=he(j6e,jn,t6e,Bs,(t,e,n,r)=>r,(t,e,n,r,i)=>{if(!xc(t))return 0;var s=e==="vertical"?r.height:r.width;if(i==="gap")return t*s/2;if(i==="no-gap"){var o=du(n,t*s),a=t*s/2;return a-o-(a-o)/s*o}return 0}),L6e=(t,e)=>{var n=Iv(t,e);return n==null||typeof n.padding!="string"?0:Ece(t,"xAxis",e,n.padding)},F6e=(t,e)=>{var n=Pv(t,e);return n==null||typeof n.padding!="string"?0:Ece(t,"yAxis",e,n.padding)},$6e=he(Iv,L6e,(t,e)=>{var n,r;if(t==null)return{left:0,right:0};var{padding:i}=t;return typeof i=="string"?{left:e,right:e}:{left:((n=i.left)!==null&&n!==void 0?n:0)+e,right:((r=i.right)!==null&&r!==void 0?r:0)+e}}),B6e=he(Pv,F6e,(t,e)=>{var n,r;if(t==null)return{top:0,bottom:0};var{padding:i}=t;return typeof i=="string"?{top:e,bottom:e}:{top:((n=i.top)!==null&&n!==void 0?n:0)+e,bottom:((r=i.bottom)!==null&&r!==void 0?r:0)+e}}),z6e=he([Bs,$6e,Q_,Z_,(t,e,n)=>n],(t,e,n,r,i)=>{var{padding:s}=r;return i?[s.left,n.width-s.right]:[t.left+e.left,t.left+t.width-e.right]}),U6e=he([Bs,jn,B6e,Q_,Z_,(t,e,n)=>n],(t,e,n,r,i,s)=>{var{padding:o}=i;return s?[r.height-o.bottom,o.top]:e==="horizontal"?[t.top+t.height-n.bottom,t.top+n.top]:[t.top+n.top,t.top+t.height-n.bottom]}),pS=(t,e,n,r)=>{var i;switch(e){case"xAxis":return z6e(t,n,r);case"yAxis":return U6e(t,n,r);case"zAxis":return(i=V5(t,n))===null||i===void 0?void 0:i.range;case"angleAxis":return rce(t);case"radiusAxis":return ice(t,n);default:return}},Tce=he([jr,pS],lk),hk=he([jr,kv,N6e,Tce],tz);he([fS,dk,nr],gce);function Ice(t,e){return t.id<e.id?-1:t.id>e.id?1:0}var fk=(t,e)=>e,pk=(t,e,n)=>n,H6e=he(a5,fk,pk,(t,e,n)=>t.filter(r=>r.orientation===e).filter(r=>r.mirror===n).sort(Ice)),V6e=he(l5,fk,pk,(t,e,n)=>t.filter(r=>r.orientation===e).filter(r=>r.mirror===n).sort(Ice)),Pce=(t,e)=>({width:t.width,height:e.height}),W6e=(t,e)=>{var n=typeof e.width=="number"?e.width:J_;return{width:n,height:t.height}};he(Bs,Iv,Pce);var K6e=(t,e,n)=>{switch(e){case"top":return t.top;case"bottom":return n-t.bottom;default:return 0}},q6e=(t,e,n)=>{switch(e){case"left":return t.left;case"right":return n-t.right;default:return 0}};he(Nd,Bs,H6e,fk,pk,(t,e,n,r,i)=>{var s={},o;return n.forEach(a=>{var l=Pce(e,a);o==null&&(o=K6e(e,r,t));var c=r==="top"&&!i||r==="bottom"&&i;s[a.id]=o-Number(c)*l.height,o+=(c?-1:1)*l.height}),s});he(Rd,Bs,V6e,fk,pk,(t,e,n,r,i)=>{var s={},o;return n.forEach(a=>{var l=W6e(e,a);o==null&&(o=q6e(e,r,t));var c=r==="left"&&!i||r==="right"&&i;s[a.id]=o-Number(c)*l.width,o+=(c?-1:1)*l.width}),s});he(Bs,Pv,(t,e)=>{var n=typeof e.width=="number"?e.width:J_;return{width:n,height:t.height}});var _ce=(t,e,n,r)=>{if(n!=null){var{allowDuplicatedCategory:i,type:s,dataKey:o}=n,a=Dg(t,r),l=e.map(c=>c.value);if(o&&a&&s==="category"&&i&&Ooe(l))return l}},sz=he([jn,uk,jr,nr],_ce),kce=(t,e,n,r)=>{if(!(n==null||n.dataKey==null)){var{type:i,scale:s}=n,o=Dg(t,r);if(o&&(i==="number"||s!=="auto"))return e.map(a=>a.value)}},oz=he([jn,uk,hS,nr],kce);he([jn,p6e,kv,hk,sz,oz,pS,rz,nr],(t,e,n,r,i,s,o,a,l)=>{if(e==null)return null;var c=Dg(t,l);return{angle:e.angle,interval:e.interval,minTickGap:e.minTickGap,orientation:e.orientation,tick:e.tick,tickCount:e.tickCount,tickFormatter:e.tickFormatter,ticks:e.ticks,type:e.type,unit:e.unit,axisType:l,categoricalDomain:s,duplicateDomain:i,isCategorical:c,niceTicks:a,range:o,realScaleType:n,scale:r}});var G6e=(t,e,n,r,i,s,o,a,l)=>{if(!(e==null||r==null)){var c=Dg(t,l),{type:u,ticks:d,tickCount:h}=e,f=n==="scaleBand"&&typeof r.bandwidth=="function"?r.bandwidth()/2:2,y=u==="category"&&r.bandwidth?r.bandwidth()/f:0;y=l==="angleAxis"&&s!=null&&s.length>=2?ba(s[0]-s[1])*2*y:y;var b=d||i;if(b){var v=b.map((x,C)=>{var E=o?o.indexOf(x):x;return{index:C,coordinate:r(E)+y,value:x,offset:y}});return v.filter(x=>!bc(x.coordinate))}return c&&a?a.map((x,C)=>({coordinate:r(x)+y,value:x,index:C,offset:y})):r.ticks?r.ticks(h).map(x=>({coordinate:r(x)+y,value:x,offset:y})):r.domain().map((x,C)=>({coordinate:r(x)+y,value:o?o[x]:x,index:C,offset:y}))}};he([jn,hS,kv,hk,rz,pS,sz,oz,nr],G6e);var Y6e=(t,e,n,r,i,s,o)=>{if(!(e==null||n==null||r==null||r[0]===r[1])){var a=Dg(t,o),{tickCount:l}=e,c=0;return c=o==="angleAxis"&&(r==null?void 0:r.length)>=2?ba(r[0]-r[1])*2*c:c,a&&s?s.map((u,d)=>({coordinate:n(u)+c,value:u,index:d,offset:c})):n.ticks?n.ticks(l).map(u=>({coordinate:n(u)+c,value:u,offset:c})):n.domain().map((u,d)=>({coordinate:n(u)+c,value:i?i[u]:u,index:d,offset:c}))}};he([jn,hS,hk,pS,sz,oz,nr],Y6e);he(jr,hk,(t,e)=>{if(!(t==null||e==null))return CI(CI({},t),{},{scale:e})});var X6e=he([jr,kv,ez,Tce],tz);he((t,e,n)=>V5(t,n),X6e,(t,e)=>{if(!(t==null||e==null))return CI(CI({},t),{},{scale:e})});var J6e=he([jn,a5,l5],(t,e,n)=>{switch(t){case"horizontal":return e.some(r=>r.reversed)?"right-to-left":"left-to-right";case"vertical":return n.some(r=>r.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),Ace=t=>t.options.defaultTooltipEventType,Mce=t=>t.options.validateTooltipEventTypes;function Oce(t,e,n){if(t==null)return e;var r=t?"axis":"item";return n==null?e:n.includes(r)?r:e}function az(t,e){var n=Ace(t),r=Mce(t);return Oce(e,n,r)}function Z6e(t){return Kt(e=>az(e,t))}var Dce=(t,e)=>{var n,r=Number(e);if(!(bc(r)||e==null))return r>=0?t==null||(n=t[r])===null||n===void 0?void 0:n.value:void 0},Q6e=t=>t.tooltip.settings,$h={active:!1,index:null,dataKey:void 0,coordinate:void 0},e9e={itemInteraction:{click:$h,hover:$h},axisInteraction:{click:$h,hover:$h},keyboardInteraction:$h,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},Rce=Ua({name:"tooltip",initialState:e9e,reducers:{addTooltipEntrySettings(t,e){t.tooltipItemPayloads.push(e.payload)},removeTooltipEntrySettings(t,e){var n=ud(t).tooltipItemPayloads.indexOf(e.payload);n>-1&&t.tooltipItemPayloads.splice(n,1)},setTooltipSettingsState(t,e){t.settings=e.payload},setActiveMouseOverItemIndex(t,e){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.itemInteraction.hover.active=!0,t.itemInteraction.hover.index=e.payload.activeIndex,t.itemInteraction.hover.dataKey=e.payload.activeDataKey,t.itemInteraction.hover.coordinate=e.payload.activeCoordinate},mouseLeaveChart(t){t.itemInteraction.hover.active=!1,t.axisInteraction.hover.active=!1},mouseLeaveItem(t){t.itemInteraction.hover.active=!1},setActiveClickItemIndex(t,e){t.syncInteraction.active=!1,t.itemInteraction.click.active=!0,t.keyboardInteraction.active=!1,t.itemInteraction.click.index=e.payload.activeIndex,t.itemInteraction.click.dataKey=e.payload.activeDataKey,t.itemInteraction.click.coordinate=e.payload.activeCoordinate},setMouseOverAxisIndex(t,e){t.syncInteraction.active=!1,t.axisInteraction.hover.active=!0,t.keyboardInteraction.active=!1,t.axisInteraction.hover.index=e.payload.activeIndex,t.axisInteraction.hover.dataKey=e.payload.activeDataKey,t.axisInteraction.hover.coordinate=e.payload.activeCoordinate},setMouseClickAxisIndex(t,e){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.axisInteraction.click.active=!0,t.axisInteraction.click.index=e.payload.activeIndex,t.axisInteraction.click.dataKey=e.payload.activeDataKey,t.axisInteraction.click.coordinate=e.payload.activeCoordinate},setSyncInteraction(t,e){t.syncInteraction=e.payload},setKeyboardInteraction(t,e){t.keyboardInteraction.active=e.payload.active,t.keyboardInteraction.index=e.payload.activeIndex,t.keyboardInteraction.coordinate=e.payload.activeCoordinate,t.keyboardInteraction.dataKey=e.payload.activeDataKey}}}),{addTooltipEntrySettings:t9e,removeTooltipEntrySettings:n9e,setTooltipSettingsState:r9e,setActiveMouseOverItemIndex:Nce,mouseLeaveItem:i9e,mouseLeaveChart:jce,setActiveClickItemIndex:s9e,setMouseOverAxisIndex:Lce,setMouseClickAxisIndex:o9e,setSyncInteraction:T3,setKeyboardInteraction:I3}=Rce.actions,a9e=Rce.reducer;function FG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function _C(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?FG(Object(n),!0).forEach(function(r){l9e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):FG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function l9e(t,e,n){return(e=c9e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c9e(t){var e=u9e(t,"string");return typeof e=="symbol"?e:e+""}function u9e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function d9e(t,e,n){return e==="axis"?n==="click"?t.axisInteraction.click:t.axisInteraction.hover:n==="click"?t.itemInteraction.click:t.itemInteraction.hover}function h9e(t){return t.index!=null}var Fce=(t,e,n,r)=>{if(e==null)return $h;var i=d9e(t,e,n);if(i==null)return $h;if(i.active)return i;if(t.keyboardInteraction.active)return t.keyboardInteraction;if(t.syncInteraction.active&&t.syncInteraction.index!=null)return t.syncInteraction;var s=t.settings.active===!0;if(h9e(i)){if(s)return _C(_C({},i),{},{active:!0})}else if(r!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:r};return _C(_C({},$h),{},{coordinate:i.coordinate})},lz=(t,e)=>{var n=t==null?void 0:t.index;if(n==null)return null;var r=Number(n);if(!xc(r))return n;var i=0,s=1/0;return e.length>0&&(s=e.length-1),String(Math.max(i,Math.min(r,s)))},$ce=(t,e,n,r,i,s,o,a)=>{if(!(s==null||a==null)){var l=o[0],c=l==null?void 0:a(l.positions,s);if(c!=null)return c;var u=i==null?void 0:i[Number(s)];if(u)switch(n){case"horizontal":return{x:u.coordinate,y:(r.top+e)/2};default:return{x:(r.left+t)/2,y:u.coordinate}}}},Bce=(t,e,n,r)=>{if(e==="axis")return t.tooltipItemPayloads;if(t.tooltipItemPayloads.length===0)return[];var i;return n==="hover"?i=t.itemInteraction.hover.dataKey:i=t.itemInteraction.click.dataKey,i==null&&r!=null?[t.tooltipItemPayloads[0]]:t.tooltipItemPayloads.filter(s=>{var o;return((o=s.settings)===null||o===void 0?void 0:o.dataKey)===i})},gS=t=>t.options.tooltipPayloadSearcher,Av=t=>t.tooltip;function $G(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function BG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$G(Object(n),!0).forEach(function(r){f9e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$G(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function f9e(t,e,n){return(e=p9e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p9e(t){var e=g9e(t,"string");return typeof e=="symbol"?e:e+""}function g9e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function m9e(t,e){return t??e}var zce=(t,e,n,r,i,s,o)=>{if(!(e==null||s==null)){var{chartData:a,computedData:l,dataStartIndex:c,dataEndIndex:u}=n,d=[];return t.reduce((h,f)=>{var y,{dataDefinedOnItem:b,settings:v}=f,x=m9e(b,a),C=Array.isArray(x)?jae(x,c,u):x,E=(y=v==null?void 0:v.dataKey)!==null&&y!==void 0?y:r==null?void 0:r.dataKey,I=v==null?void 0:v.nameKey,P;if(r!=null&&r.dataKey&&Array.isArray(C)&&!Array.isArray(C[0])&&o==="axis"?P=oFe(C,r.dataKey,i):P=s(C,e,l,I),Array.isArray(P))P.forEach(A=>{var D=BG(BG({},v),{},{name:A.name,unit:A.unit,color:void 0,fill:void 0});h.push(wq({tooltipEntrySettings:D,dataKey:A.dataKey,payload:A.payload,value:Wr(A.payload,A.dataKey),name:A.name}))});else{var _;h.push(wq({tooltipEntrySettings:v,dataKey:E,payload:P,value:Wr(P,E),name:(_=Wr(P,I))!==null&&_!==void 0?_:v==null?void 0:v.name}))}return h},d)}},cz=he([li,jn,ace,L5,ai],Cce),y9e=he([t=>t.graphicalItems.cartesianItems,t=>t.graphicalItems.polarItems],(t,e)=>[...t,...e]),v9e=he([ai,Tv],W5),mS=he([y9e,li,v9e],K5),b9e=he([mS],t=>t.filter(H5)),x9e=he([mS],q5),Mv=he([x9e,kf],G5),w9e=he([b9e,kf,li],oce),uz=he([Mv,li,mS],X5),S9e=he([li],J5),C9e=he([mS],t=>t.filter(H5)),E9e=he([w9e,C9e,uS],hce),T9e=he([E9e,kf,ai],fce),I9e=he([mS],cce),P9e=he([Mv,li,I9e,dk,ai],pce),_9e=he([mce,ai,Tv],_v),k9e=he([_9e,ai],bce),A9e=he([yce,ai,Tv],_v),M9e=he([A9e,ai],xce),O9e=he([vce,ai,Tv],_v),D9e=he([O9e,ai],wce),R9e=he([k9e,D9e,M9e],EI),N9e=he([li,S9e,T9e,P9e,R9e,jn,ai],Z5),Uce=he([li,jn,Mv,uz,uS,ai,N9e],Q5),j9e=he([Uce,li,cz],nz),L9e=he([li,Uce,j9e,ai],iz),Hce=t=>{var e=ai(t),n=Tv(t),r=!1;return pS(t,e,n,r)},Vce=he([li,Hce],lk),Wce=he([li,cz,L9e,Vce],tz),F9e=he([jn,uz,li,ai],_ce),$9e=he([jn,uz,li,ai],kce),B9e=(t,e,n,r,i,s,o,a)=>{if(e){var{type:l}=e,c=Dg(t,a);if(r){var u=n==="scaleBand"&&r.bandwidth?r.bandwidth()/2:2,d=l==="category"&&r.bandwidth?r.bandwidth()/u:0;return d=a==="angleAxis"&&i!=null&&(i==null?void 0:i.length)>=2?ba(i[0]-i[1])*2*d:d,c&&o?o.map((h,f)=>({coordinate:r(h)+d,value:h,index:f,offset:d})):r.domain().map((h,f)=>({coordinate:r(h)+d,value:s?s[h]:h,index:f,offset:d}))}}},Ld=he([jn,li,cz,Wce,Hce,F9e,$9e,ai],B9e),dz=he([Ace,Mce,Q6e],(t,e,n)=>Oce(n.shared,t,e)),Kce=t=>t.tooltip.settings.trigger,hz=t=>t.tooltip.settings.defaultIndex,gk=he([Av,dz,Kce,hz],Fce),ew=he([gk,Mv],lz),qce=he([Ld,ew],Dce),z9e=he([gk],t=>{if(t)return t.dataKey}),Gce=he([Av,dz,Kce,hz],Bce),U9e=he([Rd,Nd,jn,Bs,Ld,hz,Gce,gS],$ce),H9e=he([gk,U9e],(t,e)=>t!=null&&t.coordinate?t.coordinate:e),V9e=he([gk],t=>t.active),W9e=he([Gce,ew,kf,li,qce,gS,dz],zce);he([W9e],t=>{if(t!=null){var e=t.map(n=>n.payload).filter(n=>n!=null);return Array.from(new Set(e))}});function zG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function UG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zG(Object(n),!0).forEach(function(r){K9e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function K9e(t,e,n){return(e=q9e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function q9e(t){var e=G9e(t,"string");return typeof e=="symbol"?e:e+""}function G9e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Y9e=()=>Kt(li),X9e=()=>{var t=Y9e(),e=Kt(Ld),n=Kt(Wce);return xBe(UG(UG({},t),{},{scale:n}),e)},J9e=()=>Kt(L5),fz=(t,e)=>e,Yce=(t,e,n)=>n,pz=(t,e,n,r)=>r,Z9e=he(Ld,t=>V_(t,e=>e.coordinate)),gz=he([Av,fz,Yce,pz],Fce),Xce=he([gz,Mv],lz),Q9e=(t,e,n)=>{if(e!=null){var r=Av(t);return e==="axis"?n==="hover"?r.axisInteraction.hover.dataKey:r.axisInteraction.click.dataKey:n==="hover"?r.itemInteraction.hover.dataKey:r.itemInteraction.click.dataKey}},Jce=he([Av,fz,Yce,pz],Bce),TI=he([Rd,Nd,jn,Bs,Ld,pz,Jce,gS],$ce),e8e=he([gz,TI],(t,e)=>{var n;return(n=t.coordinate)!==null&&n!==void 0?n:e}),Zce=he(Ld,Xce,Dce),t8e=he([Jce,Xce,kf,li,Zce,gS,fz],zce),n8e=he([gz],t=>({isActive:t.active,activeIndex:t.index})),r8e=(t,e,n,r,i,s,o,a)=>{if(!(!t||!e||!r||!i||!s)){var l=wBe(t.chartX,t.chartY,e,n,a);if(l){var c=CBe(l,e),u=uBe(c,o,s,r,i),d=SBe(e,s,u,l);return{activeIndex:String(u),activeCoordinate:d}}}};function P3(){return P3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},P3.apply(null,arguments)}function HG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function kC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?HG(Object(n),!0).forEach(function(r){i8e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):HG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function i8e(t,e,n){return(e=s8e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s8e(t){var e=o8e(t,"string");return typeof e=="symbol"?e:e+""}function o8e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function a8e(t){var{coordinate:e,payload:n,index:r,offset:i,tooltipAxisBandSize:s,layout:o,cursor:a,tooltipEventType:l,chartName:c}=t,u=e,d=n,h=r;if(!a||!u||c!=="ScatterChart"&&l!=="axis")return null;var f,y;if(c==="ScatterChart")f=u,y=C4e;else if(c==="BarChart")f=E4e(o,u,i,s),y=ele;else if(o==="radial"){var{cx:b,cy:v,radius:x,startAngle:C,endAngle:E}=tle(u);f={cx:b,cy:v,startAngle:C,endAngle:E,innerRadius:x,outerRadius:x},y=rle}else f={points:l5e(o,u,i)},y=qae;var I=typeof a=="object"&&"className"in a?a.className:void 0,P=kC(kC(kC(kC({stroke:"#ccc",pointerEvents:"none"},i),f),ja(a,!1)),{},{payload:d,payloadIndex:h,className:si("recharts-tooltip-cursor",I)});return S.isValidElement(a)?S.cloneElement(a,P):S.createElement(y,P)}function l8e(t){var e=X9e(),n=OBe(),r=Vae(),i=J9e();return S.createElement(a8e,P3({},t,{coordinate:t.coordinate,index:t.index,payload:t.payload,offset:n,layout:r,tooltipAxisBandSize:e,chartName:i}))}var Qce=S.createContext(null),c8e=()=>S.useContext(Qce),nR={exports:{}},VG;function u8e(){return VG||(VG=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,d||l,h),y=n?n+c:c;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],f]:l._events[y].push(f):(l._events[y]=f,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=n?n+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,y=new Array(f);h<f;h++)y[h]=d[h].fn;return y},a.prototype.listenerCount=function(c){var u=n?n+c:c,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,h,f,y){var b=n?n+c:c;if(!this._events[b])return!1;var v=this._events[b],x=arguments.length,C,E;if(v.fn){switch(v.once&&this.removeListener(c,v.fn,void 0,!0),x){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,d),!0;case 4:return v.fn.call(v.context,u,d,h),!0;case 5:return v.fn.call(v.context,u,d,h,f),!0;case 6:return v.fn.call(v.context,u,d,h,f,y),!0}for(E=1,C=new Array(x-1);E<x;E++)C[E-1]=arguments[E];v.fn.apply(v.context,C)}else{var I=v.length,P;for(E=0;E<I;E++)switch(v[E].once&&this.removeListener(c,v[E].fn,void 0,!0),x){case 1:v[E].fn.call(v[E].context);break;case 2:v[E].fn.call(v[E].context,u);break;case 3:v[E].fn.call(v[E].context,u,d);break;case 4:v[E].fn.call(v[E].context,u,d,h);break;default:if(!C)for(P=1,C=new Array(x-1);P<x;P++)C[P-1]=arguments[P];v[E].fn.apply(v[E].context,C)}}return!0},a.prototype.on=function(c,u,d){return s(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return s(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,h){var f=n?n+c:c;if(!this._events[f])return this;if(!u)return o(this,f),this;var y=this._events[f];if(y.fn)y.fn===u&&(!h||y.once)&&(!d||y.context===d)&&o(this,f);else{for(var b=0,v=[],x=y.length;b<x;b++)(y[b].fn!==u||h&&!y[b].once||d&&y[b].context!==d)&&v.push(y[b]);v.length?this._events[f]=v.length===1?v[0]:v:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=n?n+c:c,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}(nR)),nR.exports}var d8e=u8e();const h8e=Oi(d8e);var tw=new h8e,_3="recharts.syncEvent.tooltip",WG="recharts.syncEvent.brush";function f8e(t,e){if(e){var n=Number.parseInt(e,10);if(!bc(n))return t==null?void 0:t[n]}}var p8e={chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},eue=Ua({name:"options",initialState:p8e,reducers:{createEventEmitter:t=>{t.eventEmitter==null&&(t.eventEmitter=Symbol("rechartsEventEmitter"))}}}),g8e=eue.reducer,{createEventEmitter:m8e}=eue.actions;function y8e(t){return t.tooltip.syncInteraction}var v8e={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},tue=Ua({name:"chartData",initialState:v8e,reducers:{setChartData(t,e){if(t.chartData=e.payload,e.payload==null){t.dataStartIndex=0,t.dataEndIndex=0;return}e.payload.length>0&&t.dataEndIndex!==e.payload.length-1&&(t.dataEndIndex=e.payload.length-1)},setComputedData(t,e){t.computedData=e.payload},setDataStartEndIndexes(t,e){var{startIndex:n,endIndex:r}=e.payload;n!=null&&(t.dataStartIndex=n),r!=null&&(t.dataEndIndex=r)}}}),{setChartData:KG,setDataStartEndIndexes:b8e,setComputedData:wPt}=tue.actions,x8e=tue.reducer,nue=()=>{};function w8e(){var t=Kt(F5),e=Kt($5),n=Di(),r=Kt(ece),i=Kt(Ld),s=Vae(),o=zae(),a=Kt(l=>l.rootProps.className);S.useEffect(()=>{if(t==null)return nue;var l=(c,u,d)=>{if(e!==d&&t===c){if(r==="index"){n(u);return}if(i!=null){var h;if(typeof r=="function"){var f={activeTooltipIndex:u.payload.index==null?void 0:Number(u.payload.index),isTooltipActive:u.payload.active,activeIndex:u.payload.index==null?void 0:Number(u.payload.index),activeLabel:u.payload.label,activeDataKey:u.payload.dataKey,activeCoordinate:u.payload.coordinate},y=r(i,f);h=i[y]}else r==="value"&&(h=i.find(_=>String(_.value)===u.payload.label));var{coordinate:b}=u.payload;if(h==null||u.payload.active===!1||b==null||o==null){n(T3({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0}));return}var{x:v,y:x}=b,C=Math.min(v,o.x+o.width),E=Math.min(x,o.y+o.height),I={x:s==="horizontal"?h.coordinate:C,y:s==="horizontal"?E:h.coordinate},P=T3({active:u.payload.active,coordinate:I,dataKey:u.payload.dataKey,index:String(h.index),label:u.payload.label});n(P)}}};return tw.on(_3,l),()=>{tw.off(_3,l)}},[a,n,e,t,r,i,s,o])}function S8e(){var t=Kt(F5),e=Kt($5),n=Di();S.useEffect(()=>{if(t==null)return nue;var r=(i,s,o)=>{e!==o&&t===i&&n(b8e(s))};return tw.on(WG,r),()=>{tw.off(WG,r)}},[n,e,t])}function C8e(){var t=Di();S.useEffect(()=>{t(m8e())},[t]),w8e(),S8e()}function E8e(t,e,n,r,i,s){var o=Kt(h=>Q9e(h,t,e)),a=Kt($5),l=Kt(F5),c=Kt(ece),u=Kt(y8e),d=u==null?void 0:u.active;S.useEffect(()=>{if(!d&&l!=null&&a!=null){var h=T3({active:s,coordinate:n,dataKey:o,index:i,label:typeof r=="number"?String(r):r});tw.emit(_3,l,h,a)}},[d,n,o,i,r,a,l,c,s])}function qG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function GG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qG(Object(n),!0).forEach(function(r){T8e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function T8e(t,e,n){return(e=I8e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function I8e(t){var e=P8e(t,"string");return typeof e=="symbol"?e:e+""}function P8e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _8e(t){return t.dataKey}function k8e(t,e){return S.isValidElement(t)?S.cloneElement(t,e):typeof t=="function"?S.createElement(t,e):S.createElement(t4e,e)}var YG=[],A8e={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:!ek.isSsr,itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function mz(t){var e=If(t,A8e),{active:n,allowEscapeViewBox:r,animationDuration:i,animationEasing:s,content:o,filterNull:a,isAnimationActive:l,offset:c,payloadUniqBy:u,position:d,reverseDirection:h,useTranslate3d:f,wrapperStyle:y,cursor:b,shared:v,trigger:x,defaultIndex:C,portal:E,axisId:I}=e,P=Di(),_=typeof C=="number"?String(C):C;S.useEffect(()=>{P(r9e({shared:v,trigger:x,axisId:I,active:n,defaultIndex:_}))},[P,v,x,I,n,_]);var A=zae(),D=Kae(),L=Z6e(v),{activeIndex:z,isActive:$}=Kt(fe=>n8e(fe,L,x,_)),H=Kt(fe=>t8e(fe,L,x,_)),R=Kt(fe=>Zce(fe,L,x,_)),j=Kt(fe=>e8e(fe,L,x,_)),B=H,K=c8e(),G=n??$,[V,W]=fae([B,G]),Z=L==="axis"?R:void 0;E8e(L,x,j,Z,z,G);var U=E??K;if(U==null)return null;var J=B??YG;G||(J=YG),a&&J.length&&(J=lae(B.filter(fe=>fe.value!=null&&(fe.hide!==!0||e.includeHidden)),u,_8e));var ge=J.length>0,_e=S.createElement(l4e,{allowEscapeViewBox:r,animationDuration:i,animationEasing:s,isAnimationActive:l,active:G,coordinate:j,hasPayload:ge,offset:c,position:d,reverseDirection:h,useTranslate3d:f,viewBox:A,wrapperStyle:y,lastBoundingBox:V,innerRef:W,hasPortalFromProps:!!E},k8e(o,GG(GG({},e),{},{payload:J,label:Z,active:G,coordinate:j,accessibilityLayer:D})));return S.createElement(S.Fragment,null,_c.createPortal(_e,U),G&&S.createElement(l8e,{cursor:b,tooltipEventType:L,coordinate:j,payload:B,index:z}))}var rR={},iR={},sR={},XG;function M8e(){return XG||(XG=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n,r,{signal:i,edges:s}={}){let o,a=null;const l=s!=null&&s.includes("leading"),c=s==null||s.includes("trailing"),u=()=>{a!==null&&(n.apply(o,a),o=void 0,a=null)},d=()=>{c&&u(),b()};let h=null;const f=()=>{h!=null&&clearTimeout(h),h=setTimeout(()=>{h=null,d()},r)},y=()=>{h!==null&&(clearTimeout(h),h=null)},b=()=>{y(),o=void 0,a=null},v=()=>{u()},x=function(...C){if(i!=null&&i.aborted)return;o=this,a=C;const E=h==null;f(),l&&E&&u()};return x.schedule=f,x.cancel=b,x.flush=v,i==null||i.addEventListener("abort",b,{once:!0}),x}t.debounce=e}(sR)),sR}var JG;function O8e(){return JG||(JG=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=M8e();function n(r,i=0,s={}){typeof s!="object"&&(s={});const{leading:o=!1,trailing:a=!0,maxWait:l}=s,c=Array(2);o&&(c[0]="leading"),a&&(c[1]="trailing");let u,d=null;const h=e.debounce(function(...b){u=r.apply(this,b),d=null},i,{edges:c}),f=function(...b){return l!=null&&(d===null&&(d=Date.now()),Date.now()-d>=l)?(u=r.apply(this,b),d=Date.now(),h.cancel(),h.schedule(),u):(h.apply(this,b),u)},y=()=>(h.flush(),u);return f.cancel=h.cancel,f.flush=y,f}t.debounce=n}(iR)),iR}var ZG;function D8e(){return ZG||(ZG=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=O8e();function n(r,i=0,s={}){const{leading:o=!0,trailing:a=!0}=s;return e.debounce(r,i,{leading:o,maxWait:i,trailing:a})}t.throttle=n}(rR)),rR}var oR,QG;function R8e(){return QG||(QG=1,oR=D8e().throttle),oR}var N8e=R8e();const j8e=Oi(N8e);var aR=function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s]};function eY(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function lR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?eY(Object(n),!0).forEach(function(r){L8e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eY(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function L8e(t,e,n){return(e=F8e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function F8e(t){var e=$8e(t,"string");return typeof e=="symbol"?e:e+""}function $8e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var mk=S.forwardRef((t,e)=>{var{aspect:n,initialDimension:r={width:-1,height:-1},width:i="100%",height:s="100%",minWidth:o=0,minHeight:a,maxHeight:l,children:c,debounce:u=0,id:d,className:h,onResize:f,style:y={}}=t,b=S.useRef(null),v=S.useRef();v.current=f,S.useImperativeHandle(e,()=>b.current);var[x,C]=S.useState({containerWidth:r.width,containerHeight:r.height}),E=S.useCallback((P,_)=>{C(A=>{var D=Math.round(P),L=Math.round(_);return A.containerWidth===D&&A.containerHeight===L?A:{containerWidth:D,containerHeight:L}})},[]);S.useEffect(()=>{var P=L=>{var z,{width:$,height:H}=L[0].contentRect;E($,H),(z=v.current)===null||z===void 0||z.call(v,$,H)};u>0&&(P=j8e(P,u,{trailing:!0,leading:!1}));var _=new ResizeObserver(P),{width:A,height:D}=b.current.getBoundingClientRect();return E(A,D),_.observe(b.current),()=>{_.disconnect()}},[E,u]);var I=S.useMemo(()=>{var{containerWidth:P,containerHeight:_}=x;if(P<0||_<0)return null;aR(Sb(i)||Sb(s),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,i,s),aR(!n||n>0,"The aspect(%s) must be greater than zero.",n);var A=Sb(i)?P:i,D=Sb(s)?_:s;return n&&n>0&&(A?D=A/n:D&&(A=D*n),l&&D>l&&(D=l)),aR(A>0||D>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,A,D,i,s,o,a,n),S.Children.map(c,L=>S.cloneElement(L,{width:A,height:D,style:lR({width:A,height:D},L.props.style)}))},[n,c,s,l,a,o,x,i]);return S.createElement("div",{id:d?"".concat(d):void 0,className:si("recharts-responsive-container",h),style:lR(lR({},y),{},{width:i,height:s,minWidth:o,minHeight:a,maxHeight:l}),ref:b},S.createElement("div",{style:{width:0,height:0,overflow:"visible"}},I))}),Lg=t=>null;Lg.displayName="Cell";function B8e(t,e,n){return(e=z8e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function z8e(t){var e=U8e(t,"string");return typeof e=="symbol"?e:e+""}function U8e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class H8e{constructor(e){B8e(this,"cache",new Map),this.maxSize=e}get(e){var n=this.cache.get(e);return n!==void 0&&(this.cache.delete(e),this.cache.set(e,n)),n}set(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){var r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,n)}clear(){this.cache.clear()}size(){return this.cache.size}}function tY(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function V8e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tY(Object(n),!0).forEach(function(r){W8e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tY(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function W8e(t,e,n){return(e=K8e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function K8e(t){var e=q8e(t,"string");return typeof e=="symbol"?e:e+""}function q8e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var G8e={cacheSize:2e3,enableCache:!0},rue=V8e({},G8e),nY=new H8e(rue.cacheSize),Y8e={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},rY="recharts_measurement_span";function X8e(t,e){var n=e.fontSize||"",r=e.fontFamily||"",i=e.fontWeight||"",s=e.fontStyle||"",o=e.letterSpacing||"",a=e.textTransform||"";return"".concat(t,"|").concat(n,"|").concat(r,"|").concat(i,"|").concat(s,"|").concat(o,"|").concat(a)}var iY=(t,e)=>{try{var n=document.getElementById(rY);n||(n=document.createElement("span"),n.setAttribute("id",rY),n.setAttribute("aria-hidden","true"),document.body.appendChild(n)),Object.assign(n.style,Y8e,e),n.textContent="".concat(t);var r=n.getBoundingClientRect();return{width:r.width,height:r.height}}catch{return{width:0,height:0}}},sY=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||ek.isSsr)return{width:0,height:0};if(!rue.enableCache)return iY(e,n);var r=X8e(e,n),i=nY.get(r);if(i)return i;var s=iY(e,n);return nY.set(r,s),s},oY=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,aY=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,J8e=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,Z8e=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,iue={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},Q8e=Object.keys(iue),Jm="NaN";function eHe(t,e){return t*iue[e]}class Bo{static parse(e){var n,[,r,i]=(n=Z8e.exec(e))!==null&&n!==void 0?n:[];return new Bo(parseFloat(r),i??"")}constructor(e,n){this.num=e,this.unit=n,this.num=e,this.unit=n,bc(e)&&(this.unit=""),n!==""&&!J8e.test(n)&&(this.num=NaN,this.unit=""),Q8e.includes(n)&&(this.num=eHe(e,n),this.unit="px")}add(e){return this.unit!==e.unit?new Bo(NaN,""):new Bo(this.num+e.num,this.unit)}subtract(e){return this.unit!==e.unit?new Bo(NaN,""):new Bo(this.num-e.num,this.unit)}multiply(e){return this.unit!==""&&e.unit!==""&&this.unit!==e.unit?new Bo(NaN,""):new Bo(this.num*e.num,this.unit||e.unit)}divide(e){return this.unit!==""&&e.unit!==""&&this.unit!==e.unit?new Bo(NaN,""):new Bo(this.num/e.num,this.unit||e.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return bc(this.num)}}function sue(t){if(t.includes(Jm))return Jm;for(var e=t;e.includes("*")||e.includes("/");){var n,[,r,i,s]=(n=oY.exec(e))!==null&&n!==void 0?n:[],o=Bo.parse(r??""),a=Bo.parse(s??""),l=i==="*"?o.multiply(a):o.divide(a);if(l.isNaN())return Jm;e=e.replace(oY,l.toString())}for(;e.includes("+")||/.-\d+(?:\.\d+)?/.test(e);){var c,[,u,d,h]=(c=aY.exec(e))!==null&&c!==void 0?c:[],f=Bo.parse(u??""),y=Bo.parse(h??""),b=d==="+"?f.add(y):f.subtract(y);if(b.isNaN())return Jm;e=e.replace(aY,b.toString())}return e}var lY=/\(([^()]*)\)/;function tHe(t){for(var e=t,n;(n=lY.exec(e))!=null;){var[,r]=n;e=e.replace(lY,sue(r))}return e}function nHe(t){var e=t.replace(/\s+/g,"");return e=tHe(e),e=sue(e),e}function rHe(t){try{return nHe(t)}catch{return Jm}}function cR(t){var e=rHe(t.slice(5,-1));return e===Jm?"":e}var iHe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],sHe=["dx","dy","angle","className","breakAll"];function k3(){return k3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},k3.apply(null,arguments)}function cY(t,e){if(t==null)return{};var n,r,i=oHe(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function oHe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var oue=/[ \f\n\r\t\v\u2028\u2029]+/,aue=t=>{var{children:e,breakAll:n,style:r}=t;try{var i=[];ig(e)||(n?i=e.toString().split(""):i=e.toString().split(oue));var s=i.map(a=>({word:a,width:sY(a,r).width})),o=n?0:sY(" ",r).width;return{wordsWithComputedWidth:s,spaceWidth:o}}catch{return null}},aHe=(t,e,n,r,i)=>{var{maxLines:s,children:o,style:a,breakAll:l}=t,c=Gt(s),u=o,d=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return $.reduce((H,R)=>{var{word:j,width:B}=R,K=H[H.length-1];if(K&&(r==null||i||K.width+B+n<Number(r)))K.words.push(j),K.width+=B+n;else{var G={words:[j],width:B};H.push(G)}return H},[])},h=d(e),f=z=>z.reduce(($,H)=>$.width>H.width?$:H);if(!c||i)return h;var y=h.length>s||f(h).width>Number(r);if(!y)return h;for(var b="…",v=z=>{var $=u.slice(0,z),H=aue({breakAll:l,style:a,children:$+b}).wordsWithComputedWidth,R=d(H),j=R.length>s||f(R).width>Number(r);return[j,R]},x=0,C=u.length-1,E=0,I;x<=C&&E<=u.length-1;){var P=Math.floor((x+C)/2),_=P-1,[A,D]=v(_),[L]=v(P);if(!A&&!L&&(x=P+1),A&&L&&(C=P-1),!A&&L){I=D;break}E++}return I||h},uY=t=>{var e=ig(t)?[]:t.toString().split(oue);return[{words:e}]},lHe=t=>{var{width:e,scaleToFit:n,children:r,style:i,breakAll:s,maxLines:o}=t;if((e||n)&&!ek.isSsr){var a,l,c=aue({breakAll:s,children:r,style:i});if(c){var{wordsWithComputedWidth:u,spaceWidth:d}=c;a=u,l=d}else return uY(r);return aHe({breakAll:s,children:r,maxLines:o,style:i},a,l,e,n)}return uY(r)},dY="#808080",lue=S.forwardRef((t,e)=>{var{x:n=0,y:r=0,lineHeight:i="1em",capHeight:s="0.71em",scaleToFit:o=!1,textAnchor:a="start",verticalAnchor:l="end",fill:c=dY}=t,u=cY(t,iHe),d=S.useMemo(()=>lHe({breakAll:u.breakAll,children:u.children,maxLines:u.maxLines,scaleToFit:o,style:u.style,width:u.width}),[u.breakAll,u.children,u.maxLines,o,u.style,u.width]),{dx:h,dy:f,angle:y,className:b,breakAll:v}=u,x=cY(u,sHe);if(!vd(n)||!vd(r))return null;var C=n+(Gt(h)?h:0),E=r+(Gt(f)?f:0),I;switch(l){case"start":I=cR("calc(".concat(s,")"));break;case"middle":I=cR("calc(".concat((d.length-1)/2," * -").concat(i," + (").concat(s," / 2))"));break;default:I=cR("calc(".concat(d.length-1," * -").concat(i,")"));break}var P=[];if(o){var _=d[0].width,{width:A}=u;P.push("scale(".concat(Gt(A)?A/_:1,")"))}return y&&P.push("rotate(".concat(y,", ").concat(C,", ").concat(E,")")),P.length&&(x.transform=P.join(" ")),S.createElement("text",k3({},ja(x,!0),{ref:e,x:C,y:E,className:si("recharts-text",b),textAnchor:a,fill:c.includes("url")?dY:c}),d.map((D,L)=>{var z=D.words.join(v?"":" ");return S.createElement("tspan",{x:C,dy:L===0?I:i,key:"".concat(z,"-").concat(L)},z)}))});lue.displayName="Text";var cue=t=>t.graphicalItems.polarItems,cHe=he([nr,dS],W5),yz=he([cue,jr,cHe],K5),uHe=he([yz],q5),vz=he([uHe,R5],G5),dHe=he([vz,jr,yz],X5),hHe=he([vz,jr,yz],(t,e,n)=>n.length>0?t.flatMap(r=>n.flatMap(i=>{var s,o=Wr(r,(s=e.dataKey)!==null&&s!==void 0?s:i.dataKey);return{value:o,errorDomain:[]}})).filter(Boolean):(e==null?void 0:e.dataKey)!=null?t.map(r=>({value:Wr(r,e.dataKey),errorDomain:[]})):t.map(r=>({value:r,errorDomain:[]}))),hY=()=>{},fHe=he([jr,Sce,hY,hHe,hY,jn,nr],Z5),uue=he([jr,jn,vz,dHe,uS,nr,fHe],Q5),pHe=he([uue,jr,kv],nz);he([jr,uue,pHe,nr],iz);var gHe={radiusAxis:{},angleAxis:{}},due=Ua({name:"polarAxis",initialState:gHe,reducers:{addRadiusAxis(t,e){t.radiusAxis[e.payload.id]=e.payload},removeRadiusAxis(t,e){delete t.radiusAxis[e.payload.id]},addAngleAxis(t,e){t.angleAxis[e.payload.id]=e.payload},removeAngleAxis(t,e){delete t.angleAxis[e.payload.id]}}}),{addRadiusAxis:SPt,removeRadiusAxis:CPt,addAngleAxis:EPt,removeAngleAxis:TPt}=due.actions,mHe=due.reducer;function fY(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function pY(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fY(Object(n),!0).forEach(function(r){yHe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fY(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function yHe(t,e,n){return(e=vHe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function vHe(t){var e=bHe(t,"string");return typeof e=="symbol"?e:e+""}function bHe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var xHe=(t,e)=>e,bz=he([cue,xHe],(t,e)=>t.filter(n=>n.type==="pie").find(n=>n.id===e)),wHe=[],xz=(t,e,n)=>(n==null?void 0:n.length)===0?wHe:n,hue=he([R5,bz,xz],(t,e,n)=>{var{chartData:r}=t;if(e!=null){var i;if((e==null?void 0:e.data)!=null&&e.data.length>0?i=e.data:i=r,(!i||!i.length)&&n!=null&&(i=n.map(s=>pY(pY({},e.presentationProps),s.props))),i!=null)return i}}),SHe=he([hue,bz,xz],(t,e,n)=>{if(!(t==null||e==null))return t.map((r,i)=>{var s,o=Wr(r,e.nameKey,e.name),a;return n!=null&&(s=n[i])!==null&&s!==void 0&&(s=s.props)!==null&&s!==void 0&&s.fill?a=n[i].props.fill:typeof r=="object"&&r!=null&&"fill"in r?a=r.fill:a=e.fill,{value:Lae(o,e.dataKey),color:a,payload:r,type:e.legendType}})}),CHe=he([hue,bz,xz,Bs],(t,e,n,r)=>{if(!(e==null||t==null))return S7e({offset:r,pieSettings:e,displayedData:t,cells:n})}),uR={},gY;function EHe(){return gY||(gY=1,function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){var i;if(typeof n!="object"||n==null)return!1;if(Object.getPrototypeOf(n)===null)return!0;if(Object.prototype.toString.call(n)!=="[object Object]"){const s=n[Symbol.toStringTag];return s==null||!((i=Object.getOwnPropertyDescriptor(n,Symbol.toStringTag))!=null&&i.writable)?!1:n.toString()===`[object ${s}]`}let r=n;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(n)===r}t.isPlainObject=e}(uR)),uR}var dR,mY;function THe(){return mY||(mY=1,dR=EHe().isPlainObject),dR}var IHe=THe();const PHe=Oi(IHe);function II(){return II=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},II.apply(null,arguments)}var yY=(t,e,n,r,i)=>{var s=n-r,o;return o="M ".concat(t,",").concat(e),o+="L ".concat(t+n,",").concat(e),o+="L ".concat(t+n-s/2,",").concat(e+i),o+="L ".concat(t+n-s/2-r,",").concat(e+i),o+="L ".concat(t,",").concat(e," Z"),o},_He={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},kHe=t=>{var e=If(t,_He),n=S.useRef(),[r,i]=S.useState(-1);S.useEffect(()=>{if(n.current&&n.current.getTotalLength)try{var v=n.current.getTotalLength();v&&i(v)}catch{}},[]);var{x:s,y:o,upperWidth:a,lowerWidth:l,height:c,className:u}=e,{animationEasing:d,animationDuration:h,animationBegin:f,isUpdateAnimationActive:y}=e;if(s!==+s||o!==+o||a!==+a||l!==+l||c!==+c||a===0&&l===0||c===0)return null;var b=si("recharts-trapezoid",u);return y?S.createElement(dI,{canBegin:r>0,from:{upperWidth:0,lowerWidth:0,height:c,x:s,y:o},to:{upperWidth:a,lowerWidth:l,height:c,x:s,y:o},duration:h,animationEasing:d,isActive:y},v=>{var{upperWidth:x,lowerWidth:C,height:E,x:I,y:P}=v;return S.createElement(dI,{canBegin:r>0,from:"0px ".concat(r===-1?1:r,"px"),to:"".concat(r,"px 0px"),attributeName:"strokeDasharray",begin:f,duration:h,easing:d},S.createElement("path",II({},ja(e,!0),{className:b,d:yY(I,P,x,C,E),ref:n})))}):S.createElement("g",null,S.createElement("path",II({},ja(e,!0),{className:b,d:yY(s,o,a,l,c)})))},AHe=["option","shapeType","propTransformer","activeClassName","isActive"];function MHe(t,e){if(t==null)return{};var n,r,i=OHe(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function OHe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function vY(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function PI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vY(Object(n),!0).forEach(function(r){DHe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vY(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function DHe(t,e,n){return(e=RHe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function RHe(t){var e=NHe(t,"string");return typeof e=="symbol"?e:e+""}function NHe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function jHe(t,e){return PI(PI({},e),t)}function LHe(t,e){return t==="symbols"}function bY(t){var{shapeType:e,elementProps:n}=t;switch(e){case"rectangle":return S.createElement(ele,n);case"trapezoid":return S.createElement(kHe,n);case"sector":return S.createElement(rle,n);case"symbols":if(LHe(e))return S.createElement(Y4,n);break;default:return null}}function FHe(t){return S.isValidElement(t)?t.props:t}function $He(t){var{option:e,shapeType:n,propTransformer:r=jHe,activeClassName:i="recharts-active-shape",isActive:s}=t,o=MHe(t,AHe),a;if(S.isValidElement(e))a=S.cloneElement(e,PI(PI({},o),FHe(e)));else if(typeof e=="function")a=e(o);else if(PHe(e)&&typeof e!="boolean"){var l=r(e,o);a=S.createElement(bY,{shapeType:n,elementProps:l})}else{var c=o;a=S.createElement(bY,{shapeType:n,elementProps:c})}return s?S.createElement(My,{className:i},a):a}var BHe=(t,e)=>{var n=Di();return(r,i)=>s=>{t==null||t(r,i,s),n(Nce({activeIndex:String(i),activeDataKey:e,activeCoordinate:r.tooltipPosition}))}},zHe=t=>{var e=Di();return(n,r)=>i=>{t==null||t(n,r,i),e(i9e())}},UHe=(t,e)=>{var n=Di();return(r,i)=>s=>{t==null||t(r,i,s),n(s9e({activeIndex:String(i),activeDataKey:e,activeCoordinate:r.tooltipPosition}))}};function HHe(t){var{fn:e,args:n}=t,r=Di(),i=xv();return S.useEffect(()=>{if(!i){var s=e(n);return r(t9e(s)),()=>{r(n9e(s))}}},[e,n,r,i]),null}var VHe=()=>{};function WHe(t){var{legendPayload:e}=t,n=Di(),r=Kt(jn);return S.useEffect(()=>r!=="centric"&&r!=="radial"?VHe:(n(LBe(e)),()=>{n(FBe(e))}),[n,r,e]),null}function KHe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",n=S.useRef(XT(e)),r=S.useRef(t);return r.current!==t&&(n.current=XT(e),r.current=t),n.current}var hR,qHe=()=>{var[t]=S.useState(()=>XT("uid-"));return t},GHe=(hR=S_.useId)!==null&&hR!==void 0?hR:qHe;function YHe(t,e){var n=GHe();return e||(t?"".concat(t,"-").concat(n):n)}var XHe=S.createContext(void 0),JHe=t=>{var{id:e,type:n,children:r}=t,i=YHe("recharts-".concat(n),e);return S.createElement(XHe.Provider,{value:i},r(i))},ZHe={cartesianItems:[],polarItems:[]},fue=Ua({name:"graphicalItems",initialState:ZHe,reducers:{addCartesianGraphicalItem(t,e){t.cartesianItems.push(e.payload)},replaceCartesianGraphicalItem(t,e){var{prev:n,next:r}=e.payload,i=ud(t).cartesianItems.indexOf(n);i>-1&&(t.cartesianItems[i]=r)},removeCartesianGraphicalItem(t,e){var n=ud(t).cartesianItems.indexOf(e.payload);n>-1&&t.cartesianItems.splice(n,1)},addPolarGraphicalItem(t,e){t.polarItems.push(e.payload)},removePolarGraphicalItem(t,e){var n=ud(t).polarItems.indexOf(e.payload);n>-1&&t.polarItems.splice(n,1)}}}),{addCartesianGraphicalItem:IPt,replaceCartesianGraphicalItem:PPt,removeCartesianGraphicalItem:_Pt,addPolarGraphicalItem:QHe,removePolarGraphicalItem:e7e}=fue.actions,t7e=fue.reducer;function n7e(t){var e=Di();return S.useEffect(()=>(e(QHe(t)),()=>{e(e7e(t))}),[e,t]),null}function r7e(){}var i7e={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},xY={t:0},fR={t:1};function s7e(t){var e=If(t,i7e),{isActive:n,canBegin:r,duration:i,easing:s,begin:o,onAnimationEnd:a,onAnimationStart:l,children:c}=e,u=Qae("JavascriptAnimate",e.animationManager),[d,h]=S.useState(n?xY:fR),f=S.useRef(null);return S.useEffect(()=>{n||h(fR)},[n]),S.useEffect(()=>{if(!n||!r)return r7e;var y=Zae(xY,fR,Xae(s),i,h,u.getTimeoutController()),b=()=>{f.current=y()};return u.start([l,o,b,i,a]),()=>{u.stop(),f.current&&f.current(),a()}},[n,r,i,s,o,l,a,u]),c(d.t)}var o7e=["onMouseEnter","onClick","onMouseLeave"],a7e=["id"],l7e=["id"];function wz(t,e){if(t==null)return{};var n,r,i=c7e(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function c7e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function wY(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function vr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?wY(Object(n),!0).forEach(function(r){u7e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wY(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function u7e(t,e,n){return(e=d7e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d7e(t){var e=h7e(t,"string");return typeof e=="symbol"?e:e+""}function h7e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Cd(){return Cd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Cd.apply(null,arguments)}function f7e(t){var e=S.useMemo(()=>joe(t.children,Lg),[t.children]),n=Kt(r=>SHe(r,t.id,e));return n==null?null:S.createElement(WHe,{legendPayload:n})}function p7e(t){var{dataKey:e,nameKey:n,sectors:r,stroke:i,strokeWidth:s,fill:o,name:a,hide:l,tooltipType:c}=t;return{dataDefinedOnItem:r==null?void 0:r.map(u=>u.tooltipPayload),positions:r==null?void 0:r.map(u=>u.tooltipPosition),settings:{stroke:i,strokeWidth:s,fill:o,dataKey:e,nameKey:n,name:Lae(a,e),hide:l,type:c,color:o,unit:""}}}var g7e=(t,e)=>t>e?"start":t<e?"end":"middle",m7e=(t,e,n)=>typeof e=="function"?e(t):du(e,n,n*.8),y7e=(t,e,n)=>{var{top:r,left:i,width:s,height:o}=e,a=Nae(s,o),l=i+du(t.cx,s,s/2),c=r+du(t.cy,o,o/2),u=du(t.innerRadius,a,0),d=m7e(n,t.outerRadius,a),h=t.maxRadius||Math.sqrt(s*s+o*o)/2;return{cx:l,cy:c,innerRadius:u,outerRadius:d,maxRadius:h}},v7e=(t,e)=>{var n=ba(e-t),r=Math.min(Math.abs(e-t),360);return n*r},b7e=(t,e)=>{if(S.isValidElement(t))return S.cloneElement(t,e);if(typeof t=="function")return t(e);var n=si("recharts-pie-label-line",typeof t!="boolean"?t.className:"");return S.createElement(qae,Cd({},e,{type:"linear",className:n}))},x7e=(t,e,n)=>{if(S.isValidElement(t))return S.cloneElement(t,e);var r=n;if(typeof t=="function"&&(r=t(e),S.isValidElement(r)))return r;var i=si("recharts-pie-label-text",typeof t!="boolean"&&typeof t!="function"?t.className:"");return S.createElement(lue,Cd({},e,{alignmentBaseline:"middle",className:i}),r)};function w7e(t){var{sectors:e,props:n,showLabels:r}=t,{label:i,labelLine:s,dataKey:o}=n;if(!r||!i||!e)return null;var a=B_(n),l=ja(i,!1),c=ja(s,!1),u=typeof i=="object"&&"offsetRadius"in i&&i.offsetRadius||20,d=e.map((h,f)=>{var y=(h.startAngle+h.endAngle)/2,b=As(h.cx,h.cy,h.outerRadius+u,y),v=vr(vr(vr(vr({},a),h),{},{stroke:"none"},l),{},{index:f,textAnchor:g7e(b.x,h.cx)},b),x=vr(vr(vr(vr({},a),h),{},{fill:"none",stroke:h.fill},c),{},{index:f,points:[As(h.cx,h.cy,h.outerRadius,y),b],key:"line"});return S.createElement(My,{key:"label-".concat(h.startAngle,"-").concat(h.endAngle,"-").concat(h.midAngle,"-").concat(f)},s&&b7e(s,x),x7e(i,v,Wr(h,o)))});return S.createElement(My,{className:"recharts-pie-labels"},d)}function pue(t){var{sectors:e,activeShape:n,inactiveShape:r,allOtherPieProps:i,showLabels:s}=t,o=Kt(ew),{onMouseEnter:a,onClick:l,onMouseLeave:c}=i,u=wz(i,o7e),d=BHe(a,i.dataKey),h=zHe(c),f=UHe(l,i.dataKey);return e==null?null:S.createElement(S.Fragment,null,e.map((y,b)=>{if((y==null?void 0:y.startAngle)===0&&(y==null?void 0:y.endAngle)===0&&e.length!==1)return null;var v=n&&String(b)===o,x=o?r:null,C=v?n:x,E=vr(vr({},y),{},{stroke:y.stroke,tabIndex:-1,[$ae]:b,[Bae]:i.dataKey});return S.createElement(My,Cd({tabIndex:-1,className:"recharts-pie-sector"},Doe(u,y,b),{onMouseEnter:d(y,b),onMouseLeave:h(y,b),onClick:f(y,b),key:"sector-".concat(y==null?void 0:y.startAngle,"-").concat(y==null?void 0:y.endAngle,"-").concat(y.midAngle,"-").concat(b)}),S.createElement($He,Cd({option:C,isActive:v,shapeType:"sector"},E)))}),S.createElement(w7e,{sectors:e,props:i,showLabels:s}))}function S7e(t){var e,{pieSettings:n,displayedData:r,cells:i,offset:s}=t,{cornerRadius:o,startAngle:a,endAngle:l,dataKey:c,nameKey:u,tooltipType:d}=n,h=Math.abs(n.minAngle),f=v7e(a,l),y=Math.abs(f),b=r.length<=1?0:(e=n.paddingAngle)!==null&&e!==void 0?e:0,v=r.filter(_=>Wr(_,c,0)!==0).length,x=(y>=360?v:v-1)*b,C=y-v*h-x,E=r.reduce((_,A)=>{var D=Wr(A,c,0);return _+(Gt(D)?D:0)},0),I;if(E>0){var P;I=r.map((_,A)=>{var D=Wr(_,c,0),L=Wr(_,u,A),z=y7e(n,s,_),$=(Gt(D)?D:0)/E,H,R=vr(vr({},_),i&&i[A]&&i[A].props);A?H=P.endAngle+ba(f)*b*(D!==0?1:0):H=a;var j=H+ba(f)*((D!==0?h:0)+$*C),B=(H+j)/2,K=(z.innerRadius+z.outerRadius)/2,G=[{name:L,value:D,payload:R,dataKey:c,type:d}],V=As(z.cx,z.cy,K,B);return P=vr(vr(vr(vr({},n.presentationProps),{},{percent:$,cornerRadius:o,name:L,tooltipPayload:G,midAngle:B,middleRadius:K,tooltipPosition:V},R),z),{},{value:Wr(_,c),startAngle:H,endAngle:j,payload:R,paddingAngle:ba(f)*b}),P})}return I}function C7e(t){var{props:e,previousSectorsRef:n}=t,{sectors:r,isAnimationActive:i,animationBegin:s,animationDuration:o,animationEasing:a,activeShape:l,inactiveShape:c,onAnimationStart:u,onAnimationEnd:d}=e,h=KHe(e,"recharts-pie-"),f=n.current,[y,b]=S.useState(!0),v=S.useCallback(()=>{typeof d=="function"&&d(),b(!1)},[d]),x=S.useCallback(()=>{typeof u=="function"&&u(),b(!0)},[u]);return S.createElement(s7e,{begin:s,duration:o,isActive:i,easing:a,onAnimationStart:x,onAnimationEnd:v,key:h},C=>{var E=[],I=r&&r[0],P=I.startAngle;return r.forEach((_,A)=>{var D=f&&f[A],L=A>0?Ay(_,"paddingAngle",0):0;if(D){var z=sK(D.endAngle-D.startAngle,_.endAngle-_.startAngle),$=vr(vr({},_),{},{startAngle:P+L,endAngle:P+z(C)+L});E.push($),P=$.endAngle}else{var{endAngle:H,startAngle:R}=_,j=sK(0,H-R),B=j(C),K=vr(vr({},_),{},{startAngle:P+L,endAngle:P+B+L});E.push(K),P=K.endAngle}}),n.current=E,S.createElement(My,null,S.createElement(pue,{sectors:E,activeShape:l,inactiveShape:c,allOtherPieProps:e,showLabels:!y}))})}function E7e(t){var{sectors:e,isAnimationActive:n,activeShape:r,inactiveShape:i}=t,s=S.useRef(null),o=s.current;return n&&e&&e.length&&(!o||o!==e)?S.createElement(C7e,{props:t,previousSectorsRef:s}):S.createElement(pue,{sectors:e,activeShape:r,inactiveShape:i,allOtherPieProps:t,showLabels:!0})}function T7e(t){var{hide:e,className:n,rootTabIndex:r}=t,i=si("recharts-pie",n);return e?null:S.createElement(My,{tabIndex:r,className:i},S.createElement(E7e,t))}var I7e={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:!ek.isSsr,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff"};function P7e(t){var{id:e}=t,n=wz(t,a7e),r=S.useMemo(()=>joe(t.children,Lg),[t.children]),i=Kt(s=>CHe(s,e,r));return S.createElement(S.Fragment,null,S.createElement(HHe,{fn:p7e,args:vr(vr({},t),{},{sectors:i})}),S.createElement(T7e,Cd({},n,{sectors:i})))}function yS(t){var e=If(t,I7e),{id:n}=e,r=wz(e,l7e),i=B_(r);return S.createElement(JHe,{id:n,type:"pie"},s=>S.createElement(S.Fragment,null,S.createElement(n7e,{type:"pie",id:s,data:r.data,dataKey:r.dataKey,hide:r.hide,angleAxisId:0,radiusAxisId:0,name:r.name,nameKey:r.nameKey,tooltipType:r.tooltipType,legendType:r.legendType,fill:r.fill,cx:r.cx,cy:r.cy,startAngle:r.startAngle,endAngle:r.endAngle,paddingAngle:r.paddingAngle,minAngle:r.minAngle,innerRadius:r.innerRadius,outerRadius:r.outerRadius,cornerRadius:r.cornerRadius,presentationProps:i}),S.createElement(f7e,Cd({},r,{id:s})),S.createElement(P7e,Cd({},r,{id:s})),r.children))}yS.displayName="Pie";var _7e=he([Bs],t=>{if(t)return{top:t.top,bottom:t.bottom,left:t.left,right:t.right}}),k7e=he([_7e,Rd,Nd],(t,e,n)=>{if(!(!t||e==null||n==null))return{x:t.left,y:t.top,width:Math.max(0,e-t.left-t.right),height:Math.max(0,n-t.top-t.bottom)}}),A7e=()=>Kt(k7e),M7e={},gue=Ua({name:"errorBars",initialState:M7e,reducers:{addErrorBar:(t,e)=>{var{itemId:n,errorBar:r}=e.payload;t[n]||(t[n]=[]),t[n].push(r)},removeErrorBar:(t,e)=>{var{itemId:n,errorBar:r}=e.payload;t[n]&&(t[n]=t[n].filter(i=>i.dataKey!==r.dataKey||i.direction!==r.direction))}}}),{addErrorBar:kPt,removeErrorBar:APt}=gue.actions,O7e=gue.reducer,D7e=t=>{var{chartData:e}=t,n=Di(),r=xv();return S.useEffect(()=>r?()=>{}:(n(KG(e)),()=>{n(KG(void 0))}),[e,n,r]),null},SY={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},mue=Ua({name:"brush",initialState:SY,reducers:{setBrushSettings(t,e){return e.payload==null?SY:e.payload}}}),{setBrushSettings:MPt}=mue.actions,R7e=mue.reducer,N7e={dots:[],areas:[],lines:[]},yue=Ua({name:"referenceElements",initialState:N7e,reducers:{addDot:(t,e)=>{t.dots.push(e.payload)},removeDot:(t,e)=>{var n=ud(t).dots.findIndex(r=>r===e.payload);n!==-1&&t.dots.splice(n,1)},addArea:(t,e)=>{t.areas.push(e.payload)},removeArea:(t,e)=>{var n=ud(t).areas.findIndex(r=>r===e.payload);n!==-1&&t.areas.splice(n,1)},addLine:(t,e)=>{t.lines.push(e.payload)},removeLine:(t,e)=>{var n=ud(t).lines.findIndex(r=>r===e.payload);n!==-1&&t.lines.splice(n,1)}}}),{addDot:OPt,removeDot:DPt,addArea:RPt,removeArea:NPt,addLine:jPt,removeLine:LPt}=yue.actions,j7e=yue.reducer,L7e=S.createContext(void 0),F7e=t=>{var{children:e}=t,[n]=S.useState("".concat(XT("recharts"),"-clip")),r=A7e();if(r==null)return null;var{x:i,y:s,width:o,height:a}=r;return S.createElement(L7e.Provider,{value:n},S.createElement("defs",null,S.createElement("clipPath",{id:n},S.createElement("rect",{x:i,y:s,height:a,width:o}))),e)};function CY(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function EY(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?CY(Object(n),!0).forEach(function(r){$7e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):CY(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function $7e(t,e,n){return(e=B7e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function B7e(t){var e=z7e(t,"string");return typeof e=="symbol"?e:e+""}function z7e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var U7e={xAxis:{},yAxis:{},zAxis:{}},vue=Ua({name:"cartesianAxis",initialState:U7e,reducers:{addXAxis(t,e){t.xAxis[e.payload.id]=e.payload},removeXAxis(t,e){delete t.xAxis[e.payload.id]},addYAxis(t,e){t.yAxis[e.payload.id]=e.payload},removeYAxis(t,e){delete t.yAxis[e.payload.id]},addZAxis(t,e){t.zAxis[e.payload.id]=e.payload},removeZAxis(t,e){delete t.zAxis[e.payload.id]},updateYAxisWidth(t,e){var{id:n,width:r}=e.payload;t.yAxis[n]&&(t.yAxis[n]=EY(EY({},t.yAxis[n]),{},{width:r}))}}}),{addXAxis:FPt,removeXAxis:$Pt,addYAxis:BPt,removeYAxis:zPt,addZAxis:UPt,removeZAxis:HPt,updateYAxisWidth:VPt}=vue.actions,H7e=vue.reducer,V7e=(t,e)=>e,Sz=he([V7e,jn,a6e,ai,Vce,Ld,Z9e,Bs],r8e),Cz=t=>{var e=t.currentTarget.getBoundingClientRect(),n=e.width/t.currentTarget.offsetWidth,r=e.height/t.currentTarget.offsetHeight;return{chartX:Math.round((t.clientX-e.left)/n),chartY:Math.round((t.clientY-e.top)/r)}},bue=Ml("mouseClick"),xue=sS();xue.startListening({actionCreator:bue,effect:(t,e)=>{var n=t.payload,r=Sz(e.getState(),Cz(n));(r==null?void 0:r.activeIndex)!=null&&e.dispatch(o9e({activeIndex:r.activeIndex,activeDataKey:void 0,activeCoordinate:r.activeCoordinate}))}});var A3=Ml("mouseMove"),wue=sS();wue.startListening({actionCreator:A3,effect:(t,e)=>{var n=t.payload,r=e.getState(),i=az(r,r.tooltip.settings.shared),s=Sz(r,Cz(n));i==="axis"&&((s==null?void 0:s.activeIndex)!=null?e.dispatch(Lce({activeIndex:s.activeIndex,activeDataKey:void 0,activeCoordinate:s.activeCoordinate})):e.dispatch(jce()))}});function W7e(t,e){return e instanceof HTMLElement?"HTMLElement <".concat(e.tagName,' class="').concat(e.className,'">'):e===window?"global.window":e}var TY={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index"},Sue=Ua({name:"rootProps",initialState:TY,reducers:{updateOptions:(t,e)=>{var n;t.accessibilityLayer=e.payload.accessibilityLayer,t.barCategoryGap=e.payload.barCategoryGap,t.barGap=(n=e.payload.barGap)!==null&&n!==void 0?n:TY.barGap,t.barSize=e.payload.barSize,t.maxBarSize=e.payload.maxBarSize,t.stackOffset=e.payload.stackOffset,t.syncId=e.payload.syncId,t.syncMethod=e.payload.syncMethod,t.className=e.payload.className}}}),K7e=Sue.reducer,{updateOptions:q7e}=Sue.actions,Cue=Ua({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(t,e)=>e.payload}}),{updatePolarOptions:G7e}=Cue.actions,Y7e=Cue.reducer,Eue=Ml("keyDown"),Tue=Ml("focus"),Ez=sS();Ez.startListening({actionCreator:Eue,effect:(t,e)=>{var n=e.getState(),r=n.rootProps.accessibilityLayer!==!1;if(r){var{keyboardInteraction:i}=n.tooltip,s=t.payload;if(!(s!=="ArrowRight"&&s!=="ArrowLeft"&&s!=="Enter")){var o=Number(lz(i,Mv(n))),a=Ld(n);if(s==="Enter"){var l=TI(n,"axis","hover",String(i.index));e.dispatch(I3({active:!i.active,activeIndex:i.index,activeDataKey:i.dataKey,activeCoordinate:l}));return}var c=J6e(n),u=c==="left-to-right"?1:-1,d=s==="ArrowRight"?1:-1,h=o+d*u;if(!(a==null||h>=a.length||h<0)){var f=TI(n,"axis","hover",String(h));e.dispatch(I3({active:!0,activeIndex:h.toString(),activeDataKey:void 0,activeCoordinate:f}))}}}}});Ez.startListening({actionCreator:Tue,effect:(t,e)=>{var n=e.getState(),r=n.rootProps.accessibilityLayer!==!1;if(r){var{keyboardInteraction:i}=n.tooltip;if(!i.active&&i.index==null){var s="0",o=TI(n,"axis","hover",String(s));e.dispatch(I3({activeDataKey:void 0,active:!0,activeIndex:s,activeCoordinate:o}))}}}});var dl=Ml("externalEvent"),Iue=sS();Iue.startListening({actionCreator:dl,effect:(t,e)=>{if(t.payload.handler!=null){var n=e.getState(),r={activeCoordinate:H9e(n),activeDataKey:z9e(n),activeIndex:ew(n),activeLabel:qce(n),activeTooltipIndex:ew(n),isTooltipActive:V9e(n)};t.payload.handler(r,t.payload.reactEvent)}}});var X7e=he([Av],t=>t.tooltipItemPayloads),J7e=he([X7e,gS,(t,e,n)=>e,(t,e,n)=>n],(t,e,n,r)=>{var i=t.find(a=>a.settings.dataKey===r);if(i!=null){var{positions:s}=i;if(s!=null){var o=e(s,n);return o}}}),Pue=Ml("touchMove"),_ue=sS();_ue.startListening({actionCreator:Pue,effect:(t,e)=>{var n=t.payload,r=e.getState(),i=az(r,r.tooltip.settings.shared);if(i==="axis"){var s=Sz(r,Cz({clientX:n.touches[0].clientX,clientY:n.touches[0].clientY,currentTarget:n.currentTarget}));(s==null?void 0:s.activeIndex)!=null&&e.dispatch(Lce({activeIndex:s.activeIndex,activeDataKey:void 0,activeCoordinate:s.activeCoordinate}))}else if(i==="item"){var o,a=n.touches[0],l=document.elementFromPoint(a.clientX,a.clientY);if(!l||!l.getAttribute)return;var c=l.getAttribute($ae),u=(o=l.getAttribute(Bae))!==null&&o!==void 0?o:void 0,d=J7e(e.getState(),c,u);e.dispatch(Nce({activeDataKey:u,activeIndex:c,activeCoordinate:d}))}}});var Z7e=pse({brush:R7e,cartesianAxis:H7e,chartData:x8e,errorBars:O7e,graphicalItems:t7e,layout:J$e,legend:$Be,options:g8e,polarAxis:mHe,polarOptions:Y7e,referenceElements:j7e,rootProps:K7e,tooltip:a9e}),Q7e=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Chart";return S$e({reducer:Z7e,preloadedState:e,middleware:r=>r({serializableCheck:!1}).concat([xue.middleware,wue.middleware,Ez.middleware,Iue.middleware,_ue.middleware]),devTools:{serialize:{replacer:W7e},name:"recharts-".concat(n)}})};function eVe(t){var{preloadedState:e,children:n,reduxStoreName:r}=t,i=xv(),s=S.useRef(null);if(i)return n;s.current==null&&(s.current=Q7e(e,r));var o=n5;return S.createElement(Cse,{context:o,store:s.current},n)}function tVe(t){var{layout:e,width:n,height:r,margin:i}=t,s=Di(),o=xv();return S.useEffect(()=>{o||(s(G$e(e)),s(Y$e({width:n,height:r})),s(q$e(i)))},[s,o,e,n,r,i]),null}function nVe(t){var e=Di();return S.useEffect(()=>{e(q7e(t))},[e,t]),null}var rVe=["children"];function iVe(t,e){if(t==null)return{};var n,r,i=sVe(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function sVe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function _I(){return _I=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},_I.apply(null,arguments)}var oVe={width:"100%",height:"100%"},aVe=S.forwardRef((t,e)=>{var n=Uae(),r=Hae(),i=Kae();if(!lI(n)||!lI(r))return null;var{children:s,otherAttributes:o,title:a,desc:l}=t,c,u;return typeof o.tabIndex=="number"?c=o.tabIndex:c=i?0:void 0,typeof o.role=="string"?u=o.role:u=i?"application":void 0,S.createElement(W4,_I({},o,{title:a,desc:l,role:u,tabIndex:c,width:n,height:r,style:oVe,ref:e}),s)}),lVe=t=>{var{children:e}=t,n=Kt(Q_);if(!n)return null;var{width:r,height:i,y:s,x:o}=n;return S.createElement(W4,{width:r,height:i,x:o,y:s},e)},IY=S.forwardRef((t,e)=>{var{children:n}=t,r=iVe(t,rVe),i=xv();return i?S.createElement(lVe,null,n):S.createElement(aVe,_I({ref:e},r),n)});function cVe(){var t=Di(),[e,n]=S.useState(null),r=Kt(EBe);return S.useEffect(()=>{if(e!=null){var i=e.getBoundingClientRect(),s=i.width/e.offsetWidth;xc(s)&&s!==r&&t(X$e(s))}},[e,t,r]),n}function PY(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function uVe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?PY(Object(n),!0).forEach(function(r){dVe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):PY(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function dVe(t,e,n){return(e=hVe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function hVe(t){var e=fVe(t,"string");return typeof e=="symbol"?e:e+""}function fVe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var pVe=S.forwardRef((t,e)=>{var{children:n,className:r,height:i,onClick:s,onContextMenu:o,onDoubleClick:a,onMouseDown:l,onMouseEnter:c,onMouseLeave:u,onMouseMove:d,onMouseUp:h,onTouchEnd:f,onTouchMove:y,onTouchStart:b,style:v,width:x}=t,C=Di(),[E,I]=S.useState(null),[P,_]=S.useState(null);C8e();var A=cVe(),D=S.useCallback(J=>{A(J),typeof e=="function"&&e(J),I(J),_(J)},[A,e,I,_]),L=S.useCallback(J=>{C(bue(J)),C(dl({handler:s,reactEvent:J}))},[C,s]),z=S.useCallback(J=>{C(A3(J)),C(dl({handler:c,reactEvent:J}))},[C,c]),$=S.useCallback(J=>{C(jce()),C(dl({handler:u,reactEvent:J}))},[C,u]),H=S.useCallback(J=>{C(A3(J)),C(dl({handler:d,reactEvent:J}))},[C,d]),R=S.useCallback(()=>{C(Tue())},[C]),j=S.useCallback(J=>{C(Eue(J.key))},[C]),B=S.useCallback(J=>{C(dl({handler:o,reactEvent:J}))},[C,o]),K=S.useCallback(J=>{C(dl({handler:a,reactEvent:J}))},[C,a]),G=S.useCallback(J=>{C(dl({handler:l,reactEvent:J}))},[C,l]),V=S.useCallback(J=>{C(dl({handler:h,reactEvent:J}))},[C,h]),W=S.useCallback(J=>{C(dl({handler:b,reactEvent:J}))},[C,b]),Z=S.useCallback(J=>{C(Pue(J)),C(dl({handler:y,reactEvent:J}))},[C,y]),U=S.useCallback(J=>{C(dl({handler:f,reactEvent:J}))},[C,f]);return S.createElement(Qce.Provider,{value:E},S.createElement(Loe.Provider,{value:P},S.createElement("div",{className:si("recharts-wrapper",r),style:uVe({position:"relative",cursor:"default",width:x,height:i},v),onClick:L,onContextMenu:B,onDoubleClick:K,onFocus:R,onKeyDown:j,onMouseDown:G,onMouseEnter:z,onMouseLeave:$,onMouseMove:H,onMouseUp:V,onTouchEnd:U,onTouchMove:Z,onTouchStart:W,ref:D},n)))}),gVe=["children","className","width","height","style","compact","title","desc"];function mVe(t,e){if(t==null)return{};var n,r,i=yVe(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function yVe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var vVe=S.forwardRef((t,e)=>{var{children:n,className:r,width:i,height:s,style:o,compact:a,title:l,desc:c}=t,u=mVe(t,gVe),d=B_(u);return a?S.createElement(IY,{otherAttributes:d,title:l,desc:c},n):S.createElement(pVe,{className:r,style:o,width:i,height:s,onClick:t.onClick,onMouseLeave:t.onMouseLeave,onMouseEnter:t.onMouseEnter,onMouseMove:t.onMouseMove,onMouseDown:t.onMouseDown,onMouseUp:t.onMouseUp,onContextMenu:t.onContextMenu,onDoubleClick:t.onDoubleClick,onTouchStart:t.onTouchStart,onTouchMove:t.onTouchMove,onTouchEnd:t.onTouchEnd},S.createElement(IY,{otherAttributes:d,title:l,desc:c,ref:e},S.createElement(F7e,null,n)))});function bVe(t){var e=Di();return S.useEffect(()=>{e(G7e(t))},[e,t]),null}var xVe=["width","height","layout"];function M3(){return M3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},M3.apply(null,arguments)}function wVe(t,e){if(t==null)return{};var n,r,i=SVe(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function SVe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var CVe={top:5,right:5,bottom:5,left:5},EVe={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:CVe,reverseStackOrder:!1,syncMethod:"index",layout:"radial"},TVe=S.forwardRef(function(e,n){var r,i=If(e.categoricalChartProps,EVe),{width:s,height:o,layout:a}=i,l=wVe(i,xVe);if(!lI(s)||!lI(o))return null;var{chartName:c,defaultTooltipEventType:u,validateTooltipEventTypes:d,tooltipPayloadSearcher:h}=e,f={chartName:c,defaultTooltipEventType:u,validateTooltipEventTypes:d,tooltipPayloadSearcher:h,eventEmitter:void 0};return S.createElement(eVe,{preloadedState:{options:f},reduxStoreName:(r=i.id)!==null&&r!==void 0?r:c},S.createElement(D7e,{chartData:i.data}),S.createElement(tVe,{width:s,height:o,layout:a,margin:i.margin}),S.createElement(nVe,{accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className}),S.createElement(bVe,{cx:i.cx,cy:i.cy,startAngle:i.startAngle,endAngle:i.endAngle,innerRadius:i.innerRadius,outerRadius:i.outerRadius}),S.createElement(vVe,M3({width:s,height:o},l,{ref:n})))}),IVe=["item"],PVe={layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},yk=S.forwardRef((t,e)=>{var n=If(t,PVe);return S.createElement(TVe,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:IVe,tooltipPayloadSearcher:f8e,categoricalChartProps:n,ref:e})});const pR="__TLDRAW_LIBRARY_VERSIONS__";function _Ve(){if(globalThis[pR])return globalThis[pR];const t={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,pR,{value:t,writable:!1,configurable:!1,enumerable:!1}),t}function Fd(t,e,n){if(!t||!e||!n)throw new Error("Missing name/version/module system in built version of tldraw library");const r=_Ve();if(r.versions.push({name:t,version:e,modules:n}),!r.scheduledNotice)try{r.scheduledNotice=setTimeout(()=>{r.scheduledNotice=null,_Y(r)},100)}catch{_Y(r)}}function _Y(t){if(!t.versions.length||t.didWarn)return;const e=t.versions.sort((a,l)=>kY(a.version,l.version)),n=e[e.length-1].version,r=new Set,i=new Map;for(const a of e){if(i.has(a.name)){r.delete(a.name),gR(i,a.name,new Set).add(a.version);continue}a.version===n?r.add(a.name):(r.delete(a.name),gR(i,a.name,new Set).add(a.version))}if(i.size>0){const a=[`${Hu("[tldraw]",["bold","bgRed","textWhite"])} ${Hu("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${Hu(`v${n}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(r,l=>`  • ✅ ${Hu(l,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(i,([l,c])=>{const u=Array.from(c).sort(kY).map(d=>Hu(`v${d}`,d===n?["textGreen"]:["textRed"]));return`  • ❌ ${Hu(l,["bold"])} (${u.join(", ")})`})];console.log(a.join(`
`)),t.didWarn=!0;return}const s=new Map;for(const a of e)gR(s,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const o=new Map;for(const[a,l]of s)l.modules.length>1&&o.set(a,l);if(o.size>0){const a=[`${Hu("[tldraw]",["bold","bgRed","textWhite"])} ${Hu("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(o,([l,c])=>{const u=c.modules.map((d,h)=>d==="esm"?`      ${h+1}. ES Modules`:`      ${h+1}. CommonJS`).join(`
`);return`  • ❌ ${Hu(l,["bold"])} v${c.version}: 
${u}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),t.didWarn=!0;return}}function kY(t,e){const n=t.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),r=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!n||!r?t.localeCompare(e):n[1]!==r[1]?Number(n[1])-Number(r[1]):n[2]!==r[2]?Number(n[2])-Number(r[2]):n[3]!==r[3]?Number(n[3])-Number(r[3]):n[4]&&r[4]?n[4].localeCompare(r[4]):n[4]?1:r[4]?-1:0}const kVe={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function Hu(t,e=[]){return`\x1B[${e.map(n=>kVe[n]).join(";")}m${t}\x1B[m`}function gR(t,e,n){return t.has(e)?t.get(e):(t.set(e,n),n)}var Tb={exports:{}};Tb.exports;var AY;function AVe(){return AY||(AY=1,function(t,e){var n=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",h="[object Error]",f="[object Function]",y="[object GeneratorFunction]",b="[object Map]",v="[object Number]",x="[object Null]",C="[object Object]",E="[object Promise]",I="[object Proxy]",P="[object RegExp]",_="[object Set]",A="[object String]",D="[object Symbol]",L="[object Undefined]",z="[object WeakMap]",$="[object ArrayBuffer]",H="[object DataView]",R="[object Float32Array]",j="[object Float64Array]",B="[object Int8Array]",K="[object Int16Array]",G="[object Int32Array]",V="[object Uint8Array]",W="[object Uint8ClampedArray]",Z="[object Uint16Array]",U="[object Uint32Array]",J=/[\\^$.*+?()[\]{}|]/g,ge=/^\[object .+?Constructor\]$/,_e=/^(?:0|[1-9]\d*)$/,fe={};fe[R]=fe[j]=fe[B]=fe[K]=fe[G]=fe[V]=fe[W]=fe[Z]=fe[U]=!0,fe[a]=fe[l]=fe[$]=fe[u]=fe[H]=fe[d]=fe[h]=fe[f]=fe[b]=fe[v]=fe[C]=fe[P]=fe[_]=fe[A]=fe[z]=!1;var je=typeof Ci=="object"&&Ci&&Ci.Object===Object&&Ci,Ae=typeof self=="object"&&self&&self.Object===Object&&self,ke=je||Ae||Function("return this")(),le=e&&!e.nodeType&&e,ve=le&&!0&&t&&!t.nodeType&&t,qe=ve&&ve.exports===le,de=qe&&je.process,pe=function(){try{return de&&de.binding&&de.binding("util")}catch{}}(),Se=pe&&pe.isTypedArray;function Fe(q,ne){for(var be=-1,Ge=q==null?0:q.length,mn=0,Pt=[];++be<Ge;){var Mn=q[be];ne(Mn,be,q)&&(Pt[mn++]=Mn)}return Pt}function ut(q,ne){for(var be=-1,Ge=ne.length,mn=q.length;++be<Ge;)q[mn+be]=ne[be];return q}function Tt(q,ne){for(var be=-1,Ge=q==null?0:q.length;++be<Ge;)if(ne(q[be],be,q))return!0;return!1}function pn(q,ne){for(var be=-1,Ge=Array(q);++be<q;)Ge[be]=ne(be);return Ge}function qn(q){return function(ne){return q(ne)}}function ci(q,ne){return q.has(ne)}function Yr(q,ne){return q==null?void 0:q[ne]}function zl(q){var ne=-1,be=Array(q.size);return q.forEach(function(Ge,mn){be[++ne]=[mn,Ge]}),be}function Au(q,ne){return function(be){return q(ne(be))}}function Mu(q){var ne=-1,be=Array(q.size);return q.forEach(function(Ge){be[++ne]=Ge}),be}var cs=Array.prototype,Ga=Function.prototype,Ya=Object.prototype,Po=ke["__core-js_shared__"],Nc=Ga.toString,ue=Ya.hasOwnProperty,Re=function(){var q=/[^.]+$/.exec(Po&&Po.keys&&Po.keys.IE_PROTO||"");return q?"Symbol(src)_1."+q:""}(),ft=Ya.toString,on=RegExp("^"+Nc.call(ue).replace(J,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ui=qe?ke.Buffer:void 0,di=ke.Symbol,ra=ke.Uint8Array,Fi=Ya.propertyIsEnumerable,Xr=cs.splice,us=di?di.toStringTag:void 0,Xs=Object.getOwnPropertySymbols,ds=ui?ui.isBuffer:void 0,ia=Au(Object.keys,Object),Yd=Za(ke,"DataView"),Ul=Za(ke,"Map"),jc=Za(ke,"Promise"),_o=Za(ke,"Set"),Xd=Za(ke,"WeakMap"),Hl=Za(Object,"create"),Jg=He(Yd),Ou=He(Ul),qf=He(jc),$i=He(_o),o0=He(Xd),Lc=di?di.prototype:void 0,Fc=Lc?Lc.valueOf:void 0;function ko(q){var ne=-1,be=q==null?0:q.length;for(this.clear();++ne<be;){var Ge=q[ne];this.set(Ge[0],Ge[1])}}function Gf(){this.__data__=Hl?Hl(null):{},this.size=0}function Vl(q){var ne=this.has(q)&&delete this.__data__[q];return this.size-=ne?1:0,ne}function a0(q){var ne=this.__data__;if(Hl){var be=ne[q];return be===r?void 0:be}return ue.call(ne,q)?ne[q]:void 0}function l0(q){var ne=this.__data__;return Hl?ne[q]!==void 0:ue.call(ne,q)}function Wl(q,ne){var be=this.__data__;return this.size+=this.has(q)?0:1,be[q]=Hl&&ne===void 0?r:ne,this}ko.prototype.clear=Gf,ko.prototype.delete=Vl,ko.prototype.get=a0,ko.prototype.has=l0,ko.prototype.set=Wl;function Ao(q){var ne=-1,be=q==null?0:q.length;for(this.clear();++ne<be;){var Ge=q[ne];this.set(Ge[0],Ge[1])}}function Zg(){this.__data__=[],this.size=0}function Jd(q){var ne=this.__data__,be=Kl(ne,q);if(be<0)return!1;var Ge=ne.length-1;return be==Ge?ne.pop():Xr.call(ne,be,1),--this.size,!0}function Qg(q){var ne=this.__data__,be=Kl(ne,q);return be<0?void 0:ne[be][1]}function em(q){return Kl(this.__data__,q)>-1}function sa(q,ne){var be=this.__data__,Ge=Kl(be,q);return Ge<0?(++this.size,be.push([q,ne])):be[Ge][1]=ne,this}Ao.prototype.clear=Zg,Ao.prototype.delete=Jd,Ao.prototype.get=Qg,Ao.prototype.has=em,Ao.prototype.set=sa;function Xa(q){var ne=-1,be=q==null?0:q.length;for(this.clear();++ne<be;){var Ge=q[ne];this.set(Ge[0],Ge[1])}}function c0(){this.size=0,this.__data__={hash:new ko,map:new(Ul||Ao),string:new ko}}function u0(q){var ne=qt(this,q).delete(q);return this.size-=ne?1:0,ne}function Ln(q){return qt(this,q).get(q)}function d0(q){return qt(this,q).has(q)}function Yf(q,ne){var be=qt(this,q),Ge=be.size;return be.set(q,ne),this.size+=be.size==Ge?0:1,this}Xa.prototype.clear=c0,Xa.prototype.delete=u0,Xa.prototype.get=Ln,Xa.prototype.has=d0,Xa.prototype.set=Yf;function Ja(q){var ne=-1,be=q==null?0:q.length;for(this.__data__=new Xa;++ne<be;)this.add(q[ne])}function Zd(q){return this.__data__.set(q,r),this}function tm(q){return this.__data__.has(q)}Ja.prototype.add=Ja.prototype.push=Zd,Ja.prototype.has=tm;function oa(q){var ne=this.__data__=new Ao(q);this.size=ne.size}function Qd(){this.__data__=new Ao,this.size=0}function Mo(q){var ne=this.__data__,be=ne.delete(q);return this.size=ne.size,be}function h0(q){return this.__data__.get(q)}function hs(q){return this.__data__.has(q)}function f0(q,ne){var be=this.__data__;if(be instanceof Ao){var Ge=be.__data__;if(!Ul||Ge.length<n-1)return Ge.push([q,ne]),this.size=++be.size,this;be=this.__data__=new Xa(Ge)}return be.set(q,ne),this.size=be.size,this}oa.prototype.clear=Qd,oa.prototype.delete=Mo,oa.prototype.get=h0,oa.prototype.has=hs,oa.prototype.set=f0;function p0(q,ne){var be=An(q),Ge=!be&&Et(q),mn=!be&&!Ge&&fr(q),Pt=!be&&!Ge&&!mn&&hi(q),Mn=be||Ge||mn||Pt,Pr=Mn?pn(q.length,String):[],On=Pr.length;for(var En in q)ue.call(q,En)&&!(Mn&&(En=="length"||mn&&(En=="offset"||En=="parent")||Pt&&(En=="buffer"||En=="byteLength"||En=="byteOffset")||rm(En,On)))&&Pr.push(En);return Pr}function Kl(q,ne){for(var be=q.length;be--;)if(tn(q[be][0],ne))return be;return-1}function aa(q,ne,be){var Ge=ne(q);return An(q)?Ge:ut(Ge,be(q))}function Jr(q){return q==null?q===void 0?L:x:us&&us in Object(q)?Jf(q):Ie(q)}function $c(q){return rr(q)&&Jr(q)==a}function Du(q,ne,be,Ge,mn){return q===ne?!0:q==null||ne==null||!rr(q)&&!rr(ne)?q!==q&&ne!==ne:g0(q,ne,be,Ge,Du,mn)}function g0(q,ne,be,Ge,mn,Pt){var Mn=An(q),Pr=An(ne),On=Mn?l:Js(q),En=Pr?l:Js(ne);On=On==a?C:On,En=En==a?C:En;var fi=On==C,Oo=En==C,_r=On==En;if(_r&&fr(q)){if(!fr(ne))return!1;Mn=!0,fi=!1}if(_r&&!fi)return Pt||(Pt=new oa),Mn||hi(q)?eh(q,ne,be,Ge,mn,Pt):ql(q,ne,On,be,Ge,mn,Pt);if(!(be&i)){var zi=fi&&ue.call(q,"__wrapped__"),Qs=Oo&&ue.call(ne,"__wrapped__");if(zi||Qs){var pr=zi?q.value():q,ps=Qs?ne.value():ne;return Pt||(Pt=new oa),mn(pr,ps,be,Ge,Pt)}}return _r?(Pt||(Pt=new oa),nm(q,ne,be,Ge,mn,Pt)):!1}function m0(q){if(!Ir(q)||X(q))return!1;var ne=Tr(q)?on:ge;return ne.test(He(q))}function la(q){return rr(q)&&fs(q.length)&&!!fe[Jr(q)]}function Xf(q){if(!se(q))return ia(q);var ne=[];for(var be in Object(q))ue.call(q,be)&&be!="constructor"&&ne.push(be);return ne}function eh(q,ne,be,Ge,mn,Pt){var Mn=be&i,Pr=q.length,On=ne.length;if(Pr!=On&&!(Mn&&On>Pr))return!1;var En=Pt.get(q);if(En&&Pt.get(ne))return En==ne;var fi=-1,Oo=!0,_r=be&s?new Ja:void 0;for(Pt.set(q,ne),Pt.set(ne,q);++fi<Pr;){var zi=q[fi],Qs=ne[fi];if(Ge)var pr=Mn?Ge(Qs,zi,fi,ne,q,Pt):Ge(zi,Qs,fi,q,ne,Pt);if(pr!==void 0){if(pr)continue;Oo=!1;break}if(_r){if(!Tt(ne,function(ps,Gl){if(!ci(_r,Gl)&&(zi===ps||mn(zi,ps,be,Ge,Pt)))return _r.push(Gl)})){Oo=!1;break}}else if(!(zi===Qs||mn(zi,Qs,be,Ge,Pt))){Oo=!1;break}}return Pt.delete(q),Pt.delete(ne),Oo}function ql(q,ne,be,Ge,mn,Pt,Mn){switch(be){case H:if(q.byteLength!=ne.byteLength||q.byteOffset!=ne.byteOffset)return!1;q=q.buffer,ne=ne.buffer;case $:return!(q.byteLength!=ne.byteLength||!Pt(new ra(q),new ra(ne)));case u:case d:case v:return tn(+q,+ne);case h:return q.name==ne.name&&q.message==ne.message;case P:case A:return q==ne+"";case b:var Pr=zl;case _:var On=Ge&i;if(Pr||(Pr=Mu),q.size!=ne.size&&!On)return!1;var En=Mn.get(q);if(En)return En==ne;Ge|=s,Mn.set(q,ne);var fi=eh(Pr(q),Pr(ne),Ge,mn,Pt,Mn);return Mn.delete(q),fi;case D:if(Fc)return Fc.call(q)==Fc.call(ne)}return!1}function nm(q,ne,be,Ge,mn,Pt){var Mn=be&i,Pr=th(q),On=Pr.length,En=th(ne),fi=En.length;if(On!=fi&&!Mn)return!1;for(var Oo=On;Oo--;){var _r=Pr[Oo];if(!(Mn?_r in ne:ue.call(ne,_r)))return!1}var zi=Pt.get(q);if(zi&&Pt.get(ne))return zi==ne;var Qs=!0;Pt.set(q,ne),Pt.set(ne,q);for(var pr=Mn;++Oo<On;){_r=Pr[Oo];var ps=q[_r],Gl=ne[_r];if(Ge)var nh=Mn?Ge(Gl,ps,_r,ne,q,Pt):Ge(ps,Gl,_r,q,ne,Pt);if(!(nh===void 0?ps===Gl||mn(ps,Gl,be,Ge,Pt):nh)){Qs=!1;break}pr||(pr=_r=="constructor")}if(Qs&&!pr){var im=q.constructor,rh=ne.constructor;im!=rh&&"constructor"in q&&"constructor"in ne&&!(typeof im=="function"&&im instanceof im&&typeof rh=="function"&&rh instanceof rh)&&(Qs=!1)}return Pt.delete(q),Pt.delete(ne),Qs}function th(q){return aa(q,Qa,Ru)}function qt(q,ne){var be=q.__data__;return Zf(ne)?be[typeof ne=="string"?"string":"hash"]:be.map}function Za(q,ne){var be=Yr(q,ne);return m0(be)?be:void 0}function Jf(q){var ne=ue.call(q,us),be=q[us];try{q[us]=void 0;var Ge=!0}catch{}var mn=ft.call(q);return Ge&&(ne?q[us]=be:delete q[us]),mn}var Ru=Xs?function(q){return q==null?[]:(q=Object(q),Fe(Xs(q),function(ne){return Fi.call(q,ne)}))}:Bi,Js=Jr;(Yd&&Js(new Yd(new ArrayBuffer(1)))!=H||Ul&&Js(new Ul)!=b||jc&&Js(jc.resolve())!=E||_o&&Js(new _o)!=_||Xd&&Js(new Xd)!=z)&&(Js=function(q){var ne=Jr(q),be=ne==C?q.constructor:void 0,Ge=be?He(be):"";if(Ge)switch(Ge){case Jg:return H;case Ou:return b;case qf:return E;case $i:return _;case o0:return z}return ne});function rm(q,ne){return ne=ne??o,!!ne&&(typeof q=="number"||_e.test(q))&&q>-1&&q%1==0&&q<ne}function Zf(q){var ne=typeof q;return ne=="string"||ne=="number"||ne=="symbol"||ne=="boolean"?q!=="__proto__":q===null}function X(q){return!!Re&&Re in q}function se(q){var ne=q&&q.constructor,be=typeof ne=="function"&&ne.prototype||Ya;return q===be}function Ie(q){return ft.call(q)}function He(q){if(q!=null){try{return Nc.call(q)}catch{}try{return q+""}catch{}}return""}function tn(q,ne){return q===ne||q!==q&&ne!==ne}var Et=$c(function(){return arguments}())?$c:function(q){return rr(q)&&ue.call(q,"callee")&&!Fi.call(q,"callee")},An=Array.isArray;function Fn(q){return q!=null&&fs(q.length)&&!Tr(q)}var fr=ds||Zs;function Zr(q,ne){return Du(q,ne)}function Tr(q){if(!Ir(q))return!1;var ne=Jr(q);return ne==f||ne==y||ne==c||ne==I}function fs(q){return typeof q=="number"&&q>-1&&q%1==0&&q<=o}function Ir(q){var ne=typeof q;return q!=null&&(ne=="object"||ne=="function")}function rr(q){return q!=null&&typeof q=="object"}var hi=Se?qn(Se):la;function Qa(q){return Fn(q)?p0(q):Xf(q)}function Bi(){return[]}function Zs(){return!1}t.exports=Zr}(Tb,Tb.exports)),Tb.exports}var MVe=AVe();const Af=Oi(MVe);var Ib={exports:{}};Ib.exports;var MY;function OVe(){return MY||(MY=1,function(t,e){var n=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object Boolean]",u="[object Date]",d="[object Error]",h="[object Function]",f="[object GeneratorFunction]",y="[object Map]",b="[object Number]",v="[object Object]",x="[object Promise]",C="[object RegExp]",E="[object Set]",I="[object String]",P="[object Symbol]",_="[object WeakMap]",A="[object ArrayBuffer]",D="[object DataView]",L="[object Float32Array]",z="[object Float64Array]",$="[object Int8Array]",H="[object Int16Array]",R="[object Int32Array]",j="[object Uint8Array]",B="[object Uint8ClampedArray]",K="[object Uint16Array]",G="[object Uint32Array]",V=/[\\^$.*+?()[\]{}|]/g,W=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,U={};U[L]=U[z]=U[$]=U[H]=U[R]=U[j]=U[B]=U[K]=U[G]=!0,U[a]=U[l]=U[A]=U[c]=U[D]=U[u]=U[d]=U[h]=U[y]=U[b]=U[v]=U[C]=U[E]=U[I]=U[_]=!1;var J=typeof Ci=="object"&&Ci&&Ci.Object===Object&&Ci,ge=typeof self=="object"&&self&&self.Object===Object&&self,_e=J||ge||Function("return this")(),fe=e&&!e.nodeType&&e,je=fe&&!0&&t&&!t.nodeType&&t,Ae=je&&je.exports===fe,ke=Ae&&J.process,le=function(){try{return ke&&ke.binding("util")}catch{}}(),ve=le&&le.isTypedArray;function qe(X,se){for(var Ie=-1,He=X?X.length:0;++Ie<He;)if(se(X[Ie],Ie,X))return!0;return!1}function de(X,se){for(var Ie=-1,He=Array(X);++Ie<X;)He[Ie]=se(Ie);return He}function pe(X){return function(se){return X(se)}}function Se(X,se){return X==null?void 0:X[se]}function Fe(X){var se=!1;if(X!=null&&typeof X.toString!="function")try{se=!!(X+"")}catch{}return se}function ut(X){var se=-1,Ie=Array(X.size);return X.forEach(function(He,tn){Ie[++se]=[tn,He]}),Ie}function Tt(X,se){return function(Ie){return X(se(Ie))}}function pn(X){var se=-1,Ie=Array(X.size);return X.forEach(function(He){Ie[++se]=He}),Ie}var qn=Array.prototype,ci=Function.prototype,Yr=Object.prototype,zl=_e["__core-js_shared__"],Au=function(){var X=/[^.]+$/.exec(zl&&zl.keys&&zl.keys.IE_PROTO||"");return X?"Symbol(src)_1."+X:""}(),Mu=ci.toString,cs=Yr.hasOwnProperty,Ga=Yr.toString,Ya=RegExp("^"+Mu.call(cs).replace(V,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Po=_e.Symbol,Nc=_e.Uint8Array,ue=Yr.propertyIsEnumerable,Re=qn.splice,ft=Tt(Object.keys,Object),on=aa(_e,"DataView"),ui=aa(_e,"Map"),di=aa(_e,"Promise"),ra=aa(_e,"Set"),Fi=aa(_e,"WeakMap"),Xr=aa(Object,"create"),us=la(on),Xs=la(ui),ds=la(di),ia=la(ra),Yd=la(Fi),Ul=Po?Po.prototype:void 0,jc=Ul?Ul.valueOf:void 0;function _o(X){var se=-1,Ie=X?X.length:0;for(this.clear();++se<Ie;){var He=X[se];this.set(He[0],He[1])}}function Xd(){this.__data__=Xr?Xr(null):{}}function Hl(X){return this.has(X)&&delete this.__data__[X]}function Jg(X){var se=this.__data__;if(Xr){var Ie=se[X];return Ie===r?void 0:Ie}return cs.call(se,X)?se[X]:void 0}function Ou(X){var se=this.__data__;return Xr?se[X]!==void 0:cs.call(se,X)}function qf(X,se){var Ie=this.__data__;return Ie[X]=Xr&&se===void 0?r:se,this}_o.prototype.clear=Xd,_o.prototype.delete=Hl,_o.prototype.get=Jg,_o.prototype.has=Ou,_o.prototype.set=qf;function $i(X){var se=-1,Ie=X?X.length:0;for(this.clear();++se<Ie;){var He=X[se];this.set(He[0],He[1])}}function o0(){this.__data__=[]}function Lc(X){var se=this.__data__,Ie=Ja(se,X);if(Ie<0)return!1;var He=se.length-1;return Ie==He?se.pop():Re.call(se,Ie,1),!0}function Fc(X){var se=this.__data__,Ie=Ja(se,X);return Ie<0?void 0:se[Ie][1]}function ko(X){return Ja(this.__data__,X)>-1}function Gf(X,se){var Ie=this.__data__,He=Ja(Ie,X);return He<0?Ie.push([X,se]):Ie[He][1]=se,this}$i.prototype.clear=o0,$i.prototype.delete=Lc,$i.prototype.get=Fc,$i.prototype.has=ko,$i.prototype.set=Gf;function Vl(X){var se=-1,Ie=X?X.length:0;for(this.clear();++se<Ie;){var He=X[se];this.set(He[0],He[1])}}function a0(){this.__data__={hash:new _o,map:new(ui||$i),string:new _o}}function l0(X){return Kl(this,X).delete(X)}function Wl(X){return Kl(this,X).get(X)}function Ao(X){return Kl(this,X).has(X)}function Zg(X,se){return Kl(this,X).set(X,se),this}Vl.prototype.clear=a0,Vl.prototype.delete=l0,Vl.prototype.get=Wl,Vl.prototype.has=Ao,Vl.prototype.set=Zg;function Jd(X){var se=-1,Ie=X?X.length:0;for(this.__data__=new Vl;++se<Ie;)this.add(X[se])}function Qg(X){return this.__data__.set(X,r),this}function em(X){return this.__data__.has(X)}Jd.prototype.add=Jd.prototype.push=Qg,Jd.prototype.has=em;function sa(X){this.__data__=new $i(X)}function Xa(){this.__data__=new $i}function c0(X){return this.__data__.delete(X)}function u0(X){return this.__data__.get(X)}function Ln(X){return this.__data__.has(X)}function d0(X,se){var Ie=this.__data__;if(Ie instanceof $i){var He=Ie.__data__;if(!ui||He.length<n-1)return He.push([X,se]),this;Ie=this.__data__=new Vl(He)}return Ie.set(X,se),this}sa.prototype.clear=Xa,sa.prototype.delete=c0,sa.prototype.get=u0,sa.prototype.has=Ln,sa.prototype.set=d0;function Yf(X,se){var Ie=ql(X)||eh(X)?de(X.length,String):[],He=Ie.length,tn=!!He;for(var Et in X)cs.call(X,Et)&&!(tn&&(Et=="length"||$c(Et,He)))&&Ie.push(Et);return Ie}function Ja(X,se){for(var Ie=X.length;Ie--;)if(Xf(X[Ie][0],se))return Ie;return-1}function Zd(X){return Ga.call(X)}function tm(X,se,Ie,He,tn){return X===se?!0:X==null||se==null||!Ru(X)&&!Js(se)?X!==X&&se!==se:oa(X,se,tm,Ie,He,tn)}function oa(X,se,Ie,He,tn,Et){var An=ql(X),Fn=ql(se),fr=l,Zr=l;An||(fr=Jr(X),fr=fr==a?v:fr),Fn||(Zr=Jr(se),Zr=Zr==a?v:Zr);var Tr=fr==v&&!Fe(X),fs=Zr==v&&!Fe(se),Ir=fr==Zr;if(Ir&&!Tr)return Et||(Et=new sa),An||rm(X)?hs(X,se,Ie,He,tn,Et):f0(X,se,fr,Ie,He,tn,Et);if(!(tn&s)){var rr=Tr&&cs.call(X,"__wrapped__"),hi=fs&&cs.call(se,"__wrapped__");if(rr||hi){var Qa=rr?X.value():X,Bi=hi?se.value():se;return Et||(Et=new sa),Ie(Qa,Bi,He,tn,Et)}}return Ir?(Et||(Et=new sa),p0(X,se,Ie,He,tn,Et)):!1}function Qd(X){if(!Ru(X)||g0(X))return!1;var se=Za(X)||Fe(X)?Ya:W;return se.test(la(X))}function Mo(X){return Js(X)&&Jf(X.length)&&!!U[Ga.call(X)]}function h0(X){if(!m0(X))return ft(X);var se=[];for(var Ie in Object(X))cs.call(X,Ie)&&Ie!="constructor"&&se.push(Ie);return se}function hs(X,se,Ie,He,tn,Et){var An=tn&s,Fn=X.length,fr=se.length;if(Fn!=fr&&!(An&&fr>Fn))return!1;var Zr=Et.get(X);if(Zr&&Et.get(se))return Zr==se;var Tr=-1,fs=!0,Ir=tn&i?new Jd:void 0;for(Et.set(X,se),Et.set(se,X);++Tr<Fn;){var rr=X[Tr],hi=se[Tr];if(He)var Qa=An?He(hi,rr,Tr,se,X,Et):He(rr,hi,Tr,X,se,Et);if(Qa!==void 0){if(Qa)continue;fs=!1;break}if(Ir){if(!qe(se,function(Bi,Zs){if(!Ir.has(Zs)&&(rr===Bi||Ie(rr,Bi,He,tn,Et)))return Ir.add(Zs)})){fs=!1;break}}else if(!(rr===hi||Ie(rr,hi,He,tn,Et))){fs=!1;break}}return Et.delete(X),Et.delete(se),fs}function f0(X,se,Ie,He,tn,Et,An){switch(Ie){case D:if(X.byteLength!=se.byteLength||X.byteOffset!=se.byteOffset)return!1;X=X.buffer,se=se.buffer;case A:return!(X.byteLength!=se.byteLength||!He(new Nc(X),new Nc(se)));case c:case u:case b:return Xf(+X,+se);case d:return X.name==se.name&&X.message==se.message;case C:case I:return X==se+"";case y:var Fn=ut;case E:var fr=Et&s;if(Fn||(Fn=pn),X.size!=se.size&&!fr)return!1;var Zr=An.get(X);if(Zr)return Zr==se;Et|=i,An.set(X,se);var Tr=hs(Fn(X),Fn(se),He,tn,Et,An);return An.delete(X),Tr;case P:if(jc)return jc.call(X)==jc.call(se)}return!1}function p0(X,se,Ie,He,tn,Et){var An=tn&s,Fn=Zf(X),fr=Fn.length,Zr=Zf(se),Tr=Zr.length;if(fr!=Tr&&!An)return!1;for(var fs=fr;fs--;){var Ir=Fn[fs];if(!(An?Ir in se:cs.call(se,Ir)))return!1}var rr=Et.get(X);if(rr&&Et.get(se))return rr==se;var hi=!0;Et.set(X,se),Et.set(se,X);for(var Qa=An;++fs<fr;){Ir=Fn[fs];var Bi=X[Ir],Zs=se[Ir];if(He)var q=An?He(Zs,Bi,Ir,se,X,Et):He(Bi,Zs,Ir,X,se,Et);if(!(q===void 0?Bi===Zs||Ie(Bi,Zs,He,tn,Et):q)){hi=!1;break}Qa||(Qa=Ir=="constructor")}if(hi&&!Qa){var ne=X.constructor,be=se.constructor;ne!=be&&"constructor"in X&&"constructor"in se&&!(typeof ne=="function"&&ne instanceof ne&&typeof be=="function"&&be instanceof be)&&(hi=!1)}return Et.delete(X),Et.delete(se),hi}function Kl(X,se){var Ie=X.__data__;return Du(se)?Ie[typeof se=="string"?"string":"hash"]:Ie.map}function aa(X,se){var Ie=Se(X,se);return Qd(Ie)?Ie:void 0}var Jr=Zd;(on&&Jr(new on(new ArrayBuffer(1)))!=D||ui&&Jr(new ui)!=y||di&&Jr(di.resolve())!=x||ra&&Jr(new ra)!=E||Fi&&Jr(new Fi)!=_)&&(Jr=function(X){var se=Ga.call(X),Ie=se==v?X.constructor:void 0,He=Ie?la(Ie):void 0;if(He)switch(He){case us:return D;case Xs:return y;case ds:return x;case ia:return E;case Yd:return _}return se});function $c(X,se){return se=se??o,!!se&&(typeof X=="number"||Z.test(X))&&X>-1&&X%1==0&&X<se}function Du(X){var se=typeof X;return se=="string"||se=="number"||se=="symbol"||se=="boolean"?X!=="__proto__":X===null}function g0(X){return!!Au&&Au in X}function m0(X){var se=X&&X.constructor,Ie=typeof se=="function"&&se.prototype||Yr;return X===Ie}function la(X){if(X!=null){try{return Mu.call(X)}catch{}try{return X+""}catch{}}return""}function Xf(X,se){return X===se||X!==X&&se!==se}function eh(X){return th(X)&&cs.call(X,"callee")&&(!ue.call(X,"callee")||Ga.call(X)==a)}var ql=Array.isArray;function nm(X){return X!=null&&Jf(X.length)&&!Za(X)}function th(X){return Js(X)&&nm(X)}function qt(X,se,Ie){Ie=typeof Ie=="function"?Ie:void 0;var He=Ie?Ie(X,se):void 0;return He===void 0?tm(X,se,Ie):!!He}function Za(X){var se=Ru(X)?Ga.call(X):"";return se==h||se==f}function Jf(X){return typeof X=="number"&&X>-1&&X%1==0&&X<=o}function Ru(X){var se=typeof X;return!!X&&(se=="object"||se=="function")}function Js(X){return!!X&&typeof X=="object"}var rm=ve?pe(ve):Mo;function Zf(X){return nm(X)?Yf(X):h0(X)}t.exports=qt}(Ib,Ib.exports)),Ib.exports}var DVe=OVe();const RVe=Oi(DVe);var mR,OY;function NVe(){if(OY)return mR;OY=1;var t="Expected a function",e=NaN,n="[object Symbol]",r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,l=typeof Ci=="object"&&Ci&&Ci.Object===Object&&Ci,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),d=Object.prototype,h=d.toString,f=Math.max,y=Math.min,b=function(){return u.Date.now()};function v(_,A,D){var L,z,$,H,R,j,B=0,K=!1,G=!1,V=!0;if(typeof _!="function")throw new TypeError(t);A=P(A)||0,C(D)&&(K=!!D.leading,G="maxWait"in D,$=G?f(P(D.maxWait)||0,A):$,V="trailing"in D?!!D.trailing:V);function W(ke){var le=L,ve=z;return L=z=void 0,B=ke,H=_.apply(ve,le),H}function Z(ke){return B=ke,R=setTimeout(ge,A),K?W(ke):H}function U(ke){var le=ke-j,ve=ke-B,qe=A-le;return G?y(qe,$-ve):qe}function J(ke){var le=ke-j,ve=ke-B;return j===void 0||le>=A||le<0||G&&ve>=$}function ge(){var ke=b();if(J(ke))return _e(ke);R=setTimeout(ge,U(ke))}function _e(ke){return R=void 0,V&&L?W(ke):(L=z=void 0,H)}function fe(){R!==void 0&&clearTimeout(R),B=0,L=j=z=R=void 0}function je(){return R===void 0?H:_e(b())}function Ae(){var ke=b(),le=J(ke);if(L=arguments,z=this,j=ke,le){if(R===void 0)return Z(j);if(G)return R=setTimeout(ge,A),W(j)}return R===void 0&&(R=setTimeout(ge,A)),H}return Ae.cancel=fe,Ae.flush=je,Ae}function x(_,A,D){var L=!0,z=!0;if(typeof _!="function")throw new TypeError(t);return C(D)&&(L="leading"in D?!!D.leading:L,z="trailing"in D?!!D.trailing:z),v(_,A,{leading:L,maxWait:A,trailing:z})}function C(_){var A=typeof _;return!!_&&(A=="object"||A=="function")}function E(_){return!!_&&typeof _=="object"}function I(_){return typeof _=="symbol"||E(_)&&h.call(_)==n}function P(_){if(typeof _=="number")return _;if(I(_))return e;if(C(_)){var A=typeof _.valueOf=="function"?_.valueOf():_;_=C(A)?A+"":A}if(typeof _!="string")return _===0?_:+_;_=_.replace(r,"");var D=s.test(_);return D||o.test(_)?a(_.slice(2),D?2:8):i.test(_)?e:+_}return mR=x,mR}var jVe=NVe();const kue=Oi(jVe);var yR,DY;function LVe(){if(DY)return yR;DY=1;var t=200,e="__lodash_hash_undefined__",n=1/0,r="[object Function]",i="[object GeneratorFunction]",s=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,a=typeof Ci=="object"&&Ci&&Ci.Object===Object&&Ci,l=typeof self=="object"&&self&&self.Object===Object&&self,c=a||l||Function("return this")();function u(ue,Re){var ft=ue?ue.length:0;return!!ft&&h(ue,Re,0)>-1}function d(ue,Re,ft,on){for(var ui=ue.length,di=ft+-1;++di<ui;)if(Re(ue[di],di,ue))return di;return-1}function h(ue,Re,ft){if(Re!==Re)return d(ue,f,ft);for(var on=ft-1,ui=ue.length;++on<ui;)if(ue[on]===Re)return on;return-1}function f(ue){return ue!==ue}function y(ue,Re){return ue.has(Re)}function b(ue,Re){return ue==null?void 0:ue[Re]}function v(ue){var Re=!1;if(ue!=null&&typeof ue.toString!="function")try{Re=!!(ue+"")}catch{}return Re}function x(ue){var Re=-1,ft=Array(ue.size);return ue.forEach(function(on){ft[++Re]=on}),ft}var C=Array.prototype,E=Function.prototype,I=Object.prototype,P=c["__core-js_shared__"],_=function(){var ue=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||"");return ue?"Symbol(src)_1."+ue:""}(),A=E.toString,D=I.hasOwnProperty,L=I.toString,z=RegExp("^"+A.call(D).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$=C.splice,H=Yr(c,"Map"),R=Yr(c,"Set"),j=Yr(Object,"create");function B(ue){var Re=-1,ft=ue?ue.length:0;for(this.clear();++Re<ft;){var on=ue[Re];this.set(on[0],on[1])}}function K(){this.__data__=j?j(null):{}}function G(ue){return this.has(ue)&&delete this.__data__[ue]}function V(ue){var Re=this.__data__;if(j){var ft=Re[ue];return ft===e?void 0:ft}return D.call(Re,ue)?Re[ue]:void 0}function W(ue){var Re=this.__data__;return j?Re[ue]!==void 0:D.call(Re,ue)}function Z(ue,Re){var ft=this.__data__;return ft[ue]=j&&Re===void 0?e:Re,this}B.prototype.clear=K,B.prototype.delete=G,B.prototype.get=V,B.prototype.has=W,B.prototype.set=Z;function U(ue){var Re=-1,ft=ue?ue.length:0;for(this.clear();++Re<ft;){var on=ue[Re];this.set(on[0],on[1])}}function J(){this.__data__=[]}function ge(ue){var Re=this.__data__,ft=ut(Re,ue);if(ft<0)return!1;var on=Re.length-1;return ft==on?Re.pop():$.call(Re,ft,1),!0}function _e(ue){var Re=this.__data__,ft=ut(Re,ue);return ft<0?void 0:Re[ft][1]}function fe(ue){return ut(this.__data__,ue)>-1}function je(ue,Re){var ft=this.__data__,on=ut(ft,ue);return on<0?ft.push([ue,Re]):ft[on][1]=Re,this}U.prototype.clear=J,U.prototype.delete=ge,U.prototype.get=_e,U.prototype.has=fe,U.prototype.set=je;function Ae(ue){var Re=-1,ft=ue?ue.length:0;for(this.clear();++Re<ft;){var on=ue[Re];this.set(on[0],on[1])}}function ke(){this.__data__={hash:new B,map:new(H||U),string:new B}}function le(ue){return ci(this,ue).delete(ue)}function ve(ue){return ci(this,ue).get(ue)}function qe(ue){return ci(this,ue).has(ue)}function de(ue,Re){return ci(this,ue).set(ue,Re),this}Ae.prototype.clear=ke,Ae.prototype.delete=le,Ae.prototype.get=ve,Ae.prototype.has=qe,Ae.prototype.set=de;function pe(ue){var Re=-1,ft=ue?ue.length:0;for(this.__data__=new Ae;++Re<ft;)this.add(ue[Re])}function Se(ue){return this.__data__.set(ue,e),this}function Fe(ue){return this.__data__.has(ue)}pe.prototype.add=pe.prototype.push=Se,pe.prototype.has=Fe;function ut(ue,Re){for(var ft=ue.length;ft--;)if(Ga(ue[ft][0],Re))return ft;return-1}function Tt(ue){if(!Po(ue)||Au(ue))return!1;var Re=Ya(ue)||v(ue)?z:o;return Re.test(Mu(ue))}function pn(ue,Re,ft){var on=-1,ui=u,di=ue.length,ra=!0,Fi=[],Xr=Fi;if(di>=t){var us=qn(ue);if(us)return x(us);ra=!1,ui=y,Xr=new pe}else Xr=Fi;e:for(;++on<di;){var Xs=ue[on],ds=Xs;if(Xs=Xs!==0?Xs:0,ra&&ds===ds){for(var ia=Xr.length;ia--;)if(Xr[ia]===ds)continue e;Fi.push(Xs)}else ui(Xr,ds,ft)||(Xr!==Fi&&Xr.push(ds),Fi.push(Xs))}return Fi}var qn=R&&1/x(new R([,-0]))[1]==n?function(ue){return new R(ue)}:Nc;function ci(ue,Re){var ft=ue.__data__;return zl(Re)?ft[typeof Re=="string"?"string":"hash"]:ft.map}function Yr(ue,Re){var ft=b(ue,Re);return Tt(ft)?ft:void 0}function zl(ue){var Re=typeof ue;return Re=="string"||Re=="number"||Re=="symbol"||Re=="boolean"?ue!=="__proto__":ue===null}function Au(ue){return!!_&&_ in ue}function Mu(ue){if(ue!=null){try{return A.call(ue)}catch{}try{return ue+""}catch{}}return""}function cs(ue){return ue&&ue.length?pn(ue):[]}function Ga(ue,Re){return ue===Re||ue!==ue&&Re!==Re}function Ya(ue){var Re=Po(ue)?L.call(ue):"";return Re==r||Re==i}function Po(ue){var Re=typeof ue;return!!ue&&(Re=="object"||Re=="function")}function Nc(){}return yR=cs,yR}var FVe=LVe();const $Ve=Oi(FVe);function Tz(t,e){const n=[];e:for(const r of t){for(const i of n)if(e?e(r,i):r===i)continue e;n.push(r)}return n}function bt(t){return t.filter(e=>e!=null)}function Yi(t){return t[t.length-1]}function Aue(t,e){let n,r=1/0;for(const i of t){const s=e(i);s<r&&(n=i,r=s)}return n}function BVe(t,e){let n,r=-1/0;for(const i of t){const s=e(i);s>r&&(n=i,r=s)}return n}function kI(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Object.is(t[n],e[n]))return!1;return!0}function ix(t,e,n){const r=new Set(e.map(s=>s[t])),i=[];for(const s of n)r.has(s[t])||i.push(s);for(const s of e)i.push(s);return i}function Mue(t){const e=(...n)=>{try{return t(...n)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}const nw=()=>{},sf={ok(t){return{ok:!0,value:t}},err(t){return{ok:!1,error:t}}};function Yt(t,e){const n=e&&t&&typeof t=="object"&&e in t?t[e]:t;throw new Error(`Unknown switch case ${n}`)}const it=Mue((t,e)=>{if(!t)throw new Error(e||"Assertion Error")}),Ps=Mue((t,e)=>{if(t==null)throw new Error(e??"value must be defined");return t});function Iz(){let t,e;const n=new Promise((r,i)=>{t=r,e=i});return Object.assign(n,{resolve:t,reject:e})}function O3(t){return new Promise(e=>setTimeout(e,t))}/*!
 * MIT License: https://github.com/NoHomey/bind-decorator/blob/master/License
 * Copyright (c) 2016 Ivo Stratev
 */function Yo(...t){if(t.length===2){const[e,n]=t;n.addInitializer(function(){it(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const i=e.bind(this),s=Reflect.defineProperty(this,n.name,{value:i,writable:!0,configurable:!0});it(s,"Cannot bind a non-configurable class method.")})}else{const[e,n,r]=t;if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${n}> is not a method!`);return{configurable:!0,get(){const i=r.value.bind(this);return Object.defineProperty(this,n,{value:i,configurable:!0,writable:!0}),i}}}}class zs{constructor(){N(this,"items",new WeakMap)}get(e,n){return this.items.has(e)||this.items.set(e,n(e)),this.items.get(e)}}function vk(t,e){let n;const r=(...i)=>(n||(n={},n.promise=new Promise((s,o)=>{n.resolve=s,n.reject=o})),clearTimeout(n.timeout),n.latestArgs=i,n.timeout=setTimeout(()=>{const s=n;n=void 0;try{s.resolve(t(...s.latestArgs))}catch(o){s.reject(o)}},e),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}const RY=new WeakMap;function Pz(t,e){if(typeof t!="object"||t===null)return;let n=RY.get(t);n||(n={tags:{},extras:{}},RY.set(t,n)),e.tags&&(n.tags={...n.tags,...e.tags}),e.extras&&(n.extras={...n.extras,...e.extras})}async function hc(t,e){return window.fetch(t,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const rw=(t,e)=>{const n=new window.Image(t,e);return n.referrerPolicy="strict-origin-when-cross-origin",n};class co{static async dataUrlToArrayBuffer(e){return hc(e).then(function(n){return n.arrayBuffer()})}static async urlToArrayBuffer(e){return await(await hc(e)).arrayBuffer()}static async urlToBlob(e){return await(await hc(e)).blob()}static async urlToDataUrl(e){if(e.startsWith("data:"))return e;const n=await co.urlToBlob(e);return await co.blobToDataUrl(n)}static async blobToDataUrl(e){return await new Promise((n,r)=>{if(e){const i=new FileReader;i.onload=()=>n(i.result),i.onerror=s=>r(s),i.onabort=s=>r(s),i.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((n,r)=>{if(e){const i=new FileReader;i.onload=()=>n(i.result),i.onerror=s=>r(s),i.onabort=s=>r(s),i.readAsText(e)}})}static rewriteMimeType(e,n){return e.type===n?e:e instanceof File?new File([e],e.name,{type:n}):new Blob([e],{type:n})}}function _z(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e+""}function Oue(t){const e=new DataView(t);let n=0;for(let r=0;r<e.byteLength;r++)n=(n<<5)-n+e.getUint8(r),n|=0;return n+""}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */const NY=globalThis.crypto,zVe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",UVe=128;let bp,Zm;function HVe(t){!bp||bp.length<t?(bp=new Uint8Array(t*UVe),NY.getRandomValues(bp),Zm=0):Zm+t>bp.length&&(NY.getRandomValues(bp),Zm=0),Zm+=t}function VVe(t=21){HVe(t-=0);let e="";for(let n=Zm-t;n<Zm;n++)e+=zVe[bp[n]&63];return e}let WVe=VVe;function fn(t){return WVe(t)}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function KVe(t){const e=new Uint8Array(t);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function r(s,o,a,l,c=1024){if(!o)return-1;o=new RegExp(o,"g");const u=o.source.length,d=new TextDecoder,h=s.length;if(typeof l>"u"&&(l=h),a>=h||l<=0||a>=l)return-1;s=s.subarray(a,l);let f=-1,y=0,b=0,v="";e:for(;y<s.length;){const x=y+c,C=s.subarray(y,x),E=d.decode(C,{stream:!0}),I=v+E;let P,_=-1;for(;(P=o.exec(I))!==null;){_=P.index-v.length,f=b+_;break e}y=x,b+=E.length;const A=_>-1?_+u:E.length-u;v=E.slice(A)}return f>=0&&(f+=a>=0?a:h+a),f}const i=r(e,"IDAT",12);return i>=12?r(e,"acTL",8,i)>=8:!1}const qVe=t=>new Uint8Array(t)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
 */function jY(t,e){let n=0;for(;t[e+n];)n+=t[e+n]+1;return n+1}function GVe(t){return new TextDecoder("ascii").decode(t.slice(0,3))==="GIF"}function YVe(t){const e=new Uint8Array(t);let n,r,i=0,s=0;if(!GVe(t))return!1;for(n=e[10]&128,r=e[10]&7,i+=6,i+=7,i+=n?3*Math.pow(2,r+1):0;s<2&&i<e.length;)switch(e[i]){case 44:s+=1,n=e[i+9]&128,r=e[i+9]&7,i+=10,i+=n?3*Math.pow(2,r+1):0,i+=jY(e,i+1)+1;break;case 33:i+=2,i+=jY(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return s>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let D3=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(D3=new Int32Array(D3));const XVe=(t,e)=>{let n=-1;for(let r=0;r<t.length;r++)n=D3[(n^t[r])&255]^n>>>8;return n^-1},LY=4,FY=4;class eu{static isPng(e,n){return e.getUint8(n+0)===137&&e.getUint8(n+1)===80&&e.getUint8(n+2)===78&&e.getUint8(n+3)===71&&e.getUint8(n+4)===13&&e.getUint8(n+5)===10&&e.getUint8(n+6)===26&&e.getUint8(n+7)===10}static getChunkType(e,n){return[String.fromCharCode(e.getUint8(n)),String.fromCharCode(e.getUint8(n+1)),String.fromCharCode(e.getUint8(n+2)),String.fromCharCode(e.getUint8(n+3))].join("")}static readChunks(e,n=0){const r={};if(!eu.isPng(e,n))throw new Error("Not a PNG");for(n+=8;n<=e.buffer.byteLength;){const i=n,s=e.getInt32(n);n+=4;const o=eu.getChunkType(e,n);if(o==="IDAT"&&r[o]){n+=s+LY+FY;continue}if(o==="IEND")break;r[o]={start:i,dataOffset:n+4,size:s},n+=s+LY+FY}return r}static parsePhys(e,n){return{ppux:e.getUint32(n),ppuy:e.getUint32(n+4),unit:e.getUint8(n+4)}}static findChunk(e,n){return eu.readChunks(e)[n]}static setPhysChunk(e,n=1,r){let i=46,s=0;const o=eu.findChunk(e,"pHYs");o&&(i=o.start,s=o.size);const a=eu.findChunk(e,"IDAT");a&&(i=a.start,s=0);const l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,112),c.setUint8(5,72),c.setUint8(6,89),c.setUint8(7,115);const u=2835.5;c.setInt32(8,u*n),c.setInt32(12,u*n),c.setInt8(16,1);const d=new Uint8Array(l.slice(4,17));c.setInt32(17,XVe(d));const h=e.buffer.slice(0,i),f=e.buffer.slice(i+s);return new Blob([h,l,f],r)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function JVe(t){return!t||t.length<12?!1:t[8]===87&&t[9]===69&&t[10]===66&&t[11]===80}function ZVe(t){const e=new Uint8Array(t);return!JVe(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const Due=Object.freeze(["image/svg+xml"]),Rue=Object.freeze(["image/jpeg","image/png","image/webp"]),Nue=Object.freeze(["image/gif","image/apng","image/avif"]),Ov=Object.freeze([...Rue,...Due,...Nue]),bk=Object.freeze(["video/mp4","video/webm","video/quicktime"]),QVe=Object.freeze([...Ov,...bk]);QVe.join(",");class xa{static loadVideo(e){return new Promise((n,r)=>{const i=document.createElement("video");i.onloadeddata=()=>n(i),i.onerror=s=>{console.error(s),r(new Error("Could not load video"))},i.crossOrigin="anonymous",i.src=e})}static async getVideoFrameAsDataUrl(e,n=0){const r=Iz();let i=!1;const s=()=>{if(!i)if(e.readyState>=e.HAVE_METADATA)i=!0,e.currentTime=n;else return;if(e.readyState>=e.HAVE_CURRENT_DATA){const a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight;const l=a.getContext("2d");if(!l)throw new Error("Could not get 2d context");l.drawImage(e,0,0),r.resolve(a.toDataURL())}},o=a=>{console.error(a),r.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",s),e.addEventListener("loadeddata",s),e.addEventListener("canplay",s),e.addEventListener("seeked",s),e.addEventListener("error",o),e.addEventListener("stalled",o),s();try{return await r}finally{e.removeEventListener("loadedmetadata",s),e.removeEventListener("loadeddata",s),e.removeEventListener("canplay",s),e.removeEventListener("seeked",s),e.removeEventListener("error",o),e.removeEventListener("stalled",o)}}static getImageAndDimensions(e){return new Promise((n,r)=>{const i=rw();i.onload=()=>{let s;i.naturalWidth?s={w:i.naturalWidth,h:i.naturalHeight}:(document.body.appendChild(i),s={w:i.clientWidth,h:i.clientHeight},document.body.removeChild(i)),n({...s,image:i})},i.onerror=s=>{console.error(s),r(new Error("Could not load image"))},i.crossOrigin="anonymous",i.referrerPolicy="strict-origin-when-cross-origin",i.style.visibility="hidden",i.style.position="absolute",i.style.opacity="0",i.style.zIndex="-9999",i.src=e})}static async getVideoSize(e){return xa.usingObjectURL(e,async n=>{const r=await xa.loadVideo(n);return{w:r.videoWidth,h:r.videoHeight}})}static async getImageSize(e){const{w:n,h:r}=await xa.usingObjectURL(e,xa.getImageAndDimensions);try{if(e.type==="image/png"){const i=new DataView(await e.arrayBuffer());if(eu.isPng(i,0)){const s=eu.findChunk(i,"pHYs");if(s){const o=eu.parsePhys(i,s.dataOffset);if(o.unit===0&&o.ppux===o.ppuy){const l=Math.max(o.ppux/2834.645669291339,1);return{w:Math.round(n/l),h:Math.round(r/l)}}}}}}catch(i){return console.error(i),{w:n,h:r}}return{w:n,h:r}}static async isAnimated(e){return e.type==="image/gif"?YVe(await e.arrayBuffer()):e.type==="image/avif"?qVe(await e.arrayBuffer()):e.type==="image/webp"?ZVe(await e.arrayBuffer()):e.type==="image/apng"?KVe(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return Nue.includes(e||"")}static isStaticImageType(e){return Rue.includes(e||"")}static isVectorImageType(e){return Due.includes(e||"")}static isImageType(e){return Ov.includes(e||"")}static async usingObjectURL(e,n){const r=URL.createObjectURL(e);try{return await n(r)}finally{URL.revokeObjectURL(r)}}}function At(t,e,n){return t+(e-t)*n}function iw(t,e,n){return(n-t)/(e-t)}function Fg(t=""){let e=0,n=0,r=0,i=0;function s(){const o=e^e<<11;return e=n,n=r,r=i,i^=(i>>>19^o^o>>>8)>>>0,i/4294967296*2}for(let o=0;o<t.length+64;o++)e^=t.charCodeAt(o)|0,s();return s}function yu(t,e,n,r=!1){const[i,s]=e,[o,a]=n,l=o+(t-i)/(s-i)*(a-o);return r?o<a?Math.max(Math.min(l,a),o):Math.max(Math.min(l,o),a):l}function Il(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ar(t,e){if(Il(t,e))return t[e]}function sx(t){return Object.keys(t)}function yr(t){return Object.values(t)}function ho(t){return Object.entries(t)}function jue(t){return Object.fromEntries(t)}function ox(t,e){const n={};let r=!1;for(const[i,s]of ho(t))e(i,s)?n[i]=s:r=!0;return r?n:t}function Mf(t,e){const n={};for(const[r,i]of ho(t)){const s=e(r,i);n[r]=s}return n}function Lue(t,e){if(t===e)return!0;const n=new Set(Object.keys(t)),r=new Set(Object.keys(e));if(n.size!==r.size)return!1;for(const i of n)if(!r.has(i)||!Object.is(t[i],e[i]))return!1;return!0}function eWe(t,e){const n=[];for(const r in t)Object.is(t[r],e[r])||n.push(r);return n}function tWe(t,e,n=1e-6){return RVe(t,e,(r,i)=>{if(typeof r=="number"&&typeof i=="number")return Math.abs(r-i)<n})}const Pb={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},nWe=Pb.Good;class Fue{constructor(){N(this,"startTime",0);N(this,"name","");N(this,"frames",0);N(this,"started",!1);N(this,"frame",null);N(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,n=e===0?0:Math.floor(this.frames/e),r=n>55?Pb.Good:n>30?Pb.Mid:Pb.Poor,i=r===Pb.Mid?"black":"white",s=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${s} %c${n}%c fps`,`color: white; background: ${nWe};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${r};color: ${i};`,"font-weight: normal")}isStarted(){return this.started}}function rWe(t){const e=iWe(t.chars),n=sWe(e,t.firstPositive,t.mostPositive,t.mostNegative),r=t.jitterRange??Math.floor(Math.pow(e.length,3)/5),i=oWe(r,e.length);return{chars:t.chars,byChar:e.byChar,byCode:e.byCode,length:e.length,first:e.byCode[0],last:e.byCode[e.length-1],firstPositive:n.firstPositive,mostPositive:n.mostPositive,firstNegative:n.firstNegative,mostNegative:n.mostNegative,jitterRange:r,paddingDict:i}}function iWe(t){const e={},n={},r=t.length;for(let i=0;i<r;i++){const s=t[i];e[i]=s,n[s]=i}return{byCode:e,byChar:n,length:r}}function sWe(t,e,n,r){const i=t.byChar[e],s=t.byChar[n],o=t.byChar[r];if(i===void 0||s===void 0||o===void 0)throw new Error("invalid charSet");if(s-i<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(i-o<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:t.byCode[i],mostPositive:t.byCode[s],firstNegative:t.byCode[i-1],mostNegative:t.byCode[o]}}function oWe(t,e){const n={};for(let r=0;r<100&&(n[r]=Math.pow(e,r),!(n[r]>t));r++);return n}var vR=null;function kz(){return vR||(vR=rWe({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function Wh(t,e,n){const r=n.byChar[t],i=n.byChar[e];return Math.abs(r-i)}function Az(t,e){const n=t[0];if(n>e.mostPositive||n<e.mostNegative)throw new Error("invalid firstChar on key");return n===e.mostPositive?Wh(n,e.firstPositive,e)+1+AI(t.slice(1),"positive",e):n===e.mostNegative?Wh(n,e.firstNegative,e)+1+AI(t.slice(1),"negative",e):n>=e.firstPositive?Wh(n,e.firstPositive,e)+2:Wh(n,e.firstNegative,e)+2}function AI(t,e,n){const r=t[0];if(r>n.mostPositive||r<n.mostNegative)throw new Error("invalid firstChar on key");return r===n.mostPositive&&e==="positive"?Wh(r,n.mostNegative,n)+1+AI(t.slice(1),e,n):r===n.mostNegative&&e==="negative"?Wh(r,n.mostPositive,n)+1+AI(t.slice(1),e,n):e==="positive"?Wh(r,n.mostNegative,n)+2:Wh(r,n.mostPositive,n)+2}function xk(t,e,n,r,i){const s=Math.max(t.length,e.length);return n==="start"?[t.padStart(s,r),e.padStart(s,r)]:[t.padEnd(s,r),e.padEnd(s,r)]}function aWe(t,e,n){let[r,i]=xk(t,e,"end",n.first),s=R3(r,i,n);s===1&&(r=r.padEnd(r.length+1,n.first),s=n.length);const o=zue(Math.floor(s/2),n);return Mz(r,o,n)}function R3(t,e,n){const[r,i]=xk(t,e,"end",n.first).sort(),s=$ue(i,r,n);return lWe(s,n)}function Mz(t,e,n){const r=n.length,[i,s]=xk(t,e,"start",n.first),o=[];let a=0;for(let l=i.length-1;l>=0;l--){const c=n.byChar[i[l]],u=n.byChar[s[l]],d=c+u+a;a=Math.floor(d/r);const h=d%r;o.unshift(n.byCode[h])}return a>0&&o.unshift(n.byCode[a]),o.join("")}function $ue(t,e,n,r=!0){const i=n.length,[s,o]=xk(t,e,"start",n.first),a=[];let l=0;for(let c=s.length-1;c>=0;c--){let u=n.byChar[s[c]];const d=n.byChar[o[c]]+l;u<d?(l=1,u+=i):l=0;const h=u-d;a.unshift(n.byCode[h])}if(l>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;r&&a.length>1&&a[0]===n.first;)a.shift();return a.join("")}function Bue(t,e){return Mz(t,e.byCode[1],e)}function N3(t,e){return $ue(t,e.byCode[1],e,!1)}function zue(t,e){if(t===0)return e.byCode[0];let n="";const r=e.length;for(;t>0;)n=e.byCode[t%r]+n,t=Math.floor(t/r);return n}function lWe(t,e){let n=0;const r=t.length,i=e.length;for(let s=0;s<r;s++)n+=e.byChar[t[s]]*Math.pow(i,r-s-1);return n}function cWe(t){return t.firstPositive+t.byCode[0]}function uWe(t,e){return Az(t,e)===t.length}function $Y(t,e){MI(t,e)}function MI(t,e){const n=Vue(t,e),r=Az(n,e);if(r>t.length)throw new Error("invalid order key length: "+t);return t.slice(0,r)}function Uue(t,e){if(!uWe(t,e))throw new Error("invalid integer length: "+t)}function Hue(t,e){Uue(t,e);const[n,r]=Wue(t,e);if(r.split("").some(o=>o!==e.byCode[e.length-1])){const o=Bue(r,e);return n+o}const s=hWe(n,e);return Kue(s,"lower",e)}function dWe(t,e){Uue(t,e);const[n,r]=Wue(t,e);if(r.split("").some(o=>o!==e.byCode[0])){const o=N3(r,e);return n+o}const s=fWe(n,e);return Kue(s,"upper",e)}function Vue(t,e){let n=0;if(t[0]===e.mostPositive)for(;t[n]===e.mostPositive;)n=n+1;if(t[0]===e.mostNegative)for(;t[n]===e.mostNegative;)n=n+1;return t.slice(0,n+1)}function Wue(t,e){const n=Vue(t,e),r=t.slice(n.length);return[n,r]}function hWe(t,e){const n=t>=e.firstPositive,r=Bue(t,e),i=t[t.length-1]===e.mostPositive,s=r[r.length-1]===e.mostPositive;return n&&s?r+e.mostNegative:!n&&i?t.slice(0,t.length-1):r}function fWe(t,e){const n=t>=e.firstPositive,r=t[t.length-1]===e.mostNegative;if(n&&r){const i=t.slice(0,t.length-1);return N3(i,e)}return!n&&r?t+e.mostPositive:N3(t,e)}function Kue(t,e,n){const r=Az(t,n),i=e==="upper"?n.byCode[n.length-1]:n.byCode[0];return t+i.repeat(r-t.length)}function que(t,e){const n=zue(Math.floor(Math.random()*e.jitterRange),e);return Mz(t,n,e)}function pWe(t,e,n){const r=t.padEnd(t.length+e,n.first);return que(r,n)}function gWe(t,e,n){const r=MI(t,n),i=Hue(r,n);let s=0;if(e!==null){const a=R3(t,e,n);a<n.jitterRange+1&&(s=Math.max(s,BY(a,n)))}const o=R3(t,i,n);return o<n.jitterRange+1&&(s=Math.max(s,BY(o,n))),s}function BY(t,e){const n=e.jitterRange-t,r=Object.entries(e.paddingDict).find(([i,s])=>s>n);return r?parseInt(r[0]):0}function mWe(t,e,n=kz()){if(t!==null&&$Y(t,n),e!==null&&$Y(e,n),t===null&&e===null)return cWe(n);if(t===null){const r=MI(e,n);return dWe(r,n)}if(e===null){const r=MI(t,n);return Hue(r,n)}if(t>=e)throw new Error(t+" >= "+e);return aWe(t,e,n)}function Gue(t,e,n=kz()){const r=mWe(t,e,n),i=gWe(r,e,n);return i?pWe(r,i,n):que(r,n)}function Yue(t,e,n,r=kz()){return yWe(t,e,n,r,Gue,Yue)}function yWe(t,e,n,r,i,s){if(n===0)return[];if(n===1)return[i(t,e,r)];if(e==null){let l=i(t,e,r);const c=[l];for(let u=0;u<n-1;u++)l=i(l,e,r),c.push(l);return c}if(t==null){let l=i(t,e,r);const c=[l];for(let u=0;u<n-1;u++)l=i(t,l,r),c.push(l);return c.reverse(),c}const o=Math.floor(n/2),a=i(t,e,r);return[...s(t,a,o,r),a,...s(a,e,n-o-1,r)]}const Dv=Yue,Xue="a0";function vWe(t){try{Gue(t,null)}catch{throw new Error("invalid index: "+t)}}function $y(t,e,n){return Dv(t??null,e??null,n)}function bR(t,e){return Dv(t??null,null,e)}function By(t,e){return Dv(t??null,e??null,1)[0]}function ac(t=null){return Dv(t,null,1)[0]}function bWe(t=null){return Dv(null,t,1)[0]}function sw(t,e="a1"){return[e,...Dv(e,null,t)]}function Xi(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function xWe(t,e){return t.id>e.id?1:-1}function Oz(t){try{return localStorage.getItem(t)}catch{return null}}function Dz(t,e){try{localStorage.setItem(t,e)}catch{}}function wWe(){try{localStorage.clear()}catch{}}function Jue(t){try{return sessionStorage.getItem(t)}catch{return null}}function Rz(t,e){try{sessionStorage.setItem(t,e)}catch{}}function Zue(t){try{sessionStorage.removeItem(t)}catch{}}function SWe(){try{sessionStorage.clear()}catch{}}const Qm=[],CWe=60,Que=Math.floor(1e3/CWe)*.9;let xR,AC,wR=-Que;const zY=()=>{const t=Qm.splice(0,Qm.length);for(const e of t)e()};function ede(t=!1){if(xR)return;const e=Date.now();if(e-wR<Que){xR=requestAnimationFrame(()=>{xR=void 0,ede(!0)});return}if(t){if(AC)return;wR=e,zY()}else{if(AC)return;AC=requestAnimationFrame(()=>{AC=void 0,wR=e,zY()})}}function Nz(t){return Qm.includes(t)||(Qm.push(t),ede()),()=>{const e=Qm.indexOf(t);e>-1&&Qm.splice(e,1)}}class EWe{constructor(){N(this,"timeouts",new Map);N(this,"intervals",new Map);N(this,"rafs",new Map);this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,n,r,...i){const s=window.setTimeout(n,r,i),o=this.timeouts.get(e)??[];return this.timeouts.set(e,[...o,s]),s}setInterval(e,n,r,...i){const s=window.setInterval(n,r,i),o=this.intervals.get(e)??[];return this.intervals.set(e,[...o,s]),s}requestAnimationFrame(e,n){const r=window.requestAnimationFrame(n),i=this.rafs.get(e)??[];return this.rafs.set(e,[...i,r]),r}dispose(e){var n,r,i;(n=this.timeouts.get(e))==null||n.forEach(s=>clearTimeout(s)),(r=this.intervals.get(e))==null||r.forEach(s=>clearInterval(s)),(i=this.rafs.get(e))==null||i.forEach(s=>cancelAnimationFrame(s)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(n,r,...i)=>this.setTimeout(e,n,r,i),setInterval:(n,r,...i)=>this.setInterval(e,n,r,i),requestAnimationFrame:n=>this.requestAnimationFrame(e,n),dispose:()=>this.dispose(e)}}}const wt=(t,e)=>{try{return new URL(t,e)}catch{return}};function TWe(t){return t!==void 0}function IWe(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[t=>t&&JSON.parse(JSON.stringify(t)),!1]}const tde=IWe(),ar=tde[0];tde[1];const PWe=Object.getPrototypeOf(ar({}));Fd("@tldraw/utils","3.15.3","esm");var UY={},Q0,HY;function Us(){if(HY)return Q0;HY=1;var t=function(e){return e&&e.Math===Math&&e};return Q0=t(typeof globalThis=="object"&&globalThis)||t(typeof window=="object"&&window)||t(typeof self=="object"&&self)||t(typeof Ci=="object"&&Ci)||t(typeof Q0=="object"&&Q0)||function(){return this}()||Function("return this")(),Q0}var SR={},CR,VY;function Hs(){return VY||(VY=1,CR=function(t){try{return!!t()}catch{return!0}}),CR}var ER,WY;function Of(){if(WY)return ER;WY=1;var t=Hs();return ER=!t(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ER}var TR,KY;function wk(){if(KY)return TR;KY=1;var t=Hs();return TR=!t(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),TR}var IR,qY;function $d(){if(qY)return IR;qY=1;var t=wk(),e=Function.prototype.call;return IR=t?e.bind(e):function(){return e.apply(e,arguments)},IR}var PR={},GY;function _We(){if(GY)return PR;GY=1;var t={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,n=e&&!t.call({1:2},1);return PR.f=n?function(i){var s=e(this,i);return!!s&&s.enumerable}:t,PR}var _R,YY;function nde(){return YY||(YY=1,_R=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}}),_R}var kR,XY;function Ni(){if(XY)return kR;XY=1;var t=wk(),e=Function.prototype,n=e.call,r=t&&e.bind.bind(n,n);return kR=t?r:function(i){return function(){return n.apply(i,arguments)}},kR}var AR,JY;function Rv(){if(JY)return AR;JY=1;var t=Ni(),e=t({}.toString),n=t("".slice);return AR=function(r){return n(e(r),8,-1)},AR}var MR,ZY;function kWe(){if(ZY)return MR;ZY=1;var t=Ni(),e=Hs(),n=Rv(),r=Object,i=t("".split);return MR=e(function(){return!r("z").propertyIsEnumerable(0)})?function(s){return n(s)==="String"?i(s,""):r(s)}:r,MR}var OR,QY;function rde(){return QY||(QY=1,OR=function(t){return t==null}),OR}var DR,eX;function Nv(){if(eX)return DR;eX=1;var t=rde(),e=TypeError;return DR=function(n){if(t(n))throw new e("Can't call method on "+n);return n},DR}var RR,tX;function Sk(){if(tX)return RR;tX=1;var t=kWe(),e=Nv();return RR=function(n){return t(e(n))},RR}var NR,nX;function Eo(){if(nX)return NR;nX=1;var t=typeof document=="object"&&document.all;return NR=typeof t>"u"&&t!==void 0?function(e){return typeof e=="function"||e===t}:function(e){return typeof e=="function"},NR}var jR,rX;function Bd(){if(rX)return jR;rX=1;var t=Eo();return jR=function(e){return typeof e=="object"?e!==null:t(e)},jR}var LR,iX;function Ck(){if(iX)return LR;iX=1;var t=Us(),e=Eo(),n=function(r){return e(r)?r:void 0};return LR=function(r,i){return arguments.length<2?n(t[r]):t[r]&&t[r][i]},LR}var FR,sX;function ide(){if(sX)return FR;sX=1;var t=Ni();return FR=t({}.isPrototypeOf),FR}var $R,oX;function AWe(){if(oX)return $R;oX=1;var t=Us(),e=t.navigator,n=e&&e.userAgent;return $R=n?String(n):"",$R}var BR,aX;function MWe(){if(aX)return BR;aX=1;var t=Us(),e=AWe(),n=t.process,r=t.Deno,i=n&&n.versions||r&&r.version,s=i&&i.v8,o,a;return s&&(o=s.split("."),a=o[0]>0&&o[0]<4?1:+(o[0]+o[1])),!a&&e&&(o=e.match(/Edge\/(\d+)/),(!o||o[1]>=74)&&(o=e.match(/Chrome\/(\d+)/),o&&(a=+o[1]))),BR=a,BR}var zR,lX;function sde(){if(lX)return zR;lX=1;var t=MWe(),e=Hs(),n=Us(),r=n.String;return zR=!!Object.getOwnPropertySymbols&&!e(function(){var i=Symbol("symbol detection");return!r(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&t&&t<41}),zR}var UR,cX;function ode(){if(cX)return UR;cX=1;var t=sde();return UR=t&&!Symbol.sham&&typeof Symbol.iterator=="symbol",UR}var HR,uX;function ade(){if(uX)return HR;uX=1;var t=Ck(),e=Eo(),n=ide(),r=ode(),i=Object;return HR=r?function(s){return typeof s=="symbol"}:function(s){var o=t("Symbol");return e(o)&&n(o.prototype,i(s))},HR}var VR,dX;function OWe(){if(dX)return VR;dX=1;var t=String;return VR=function(e){try{return t(e)}catch{return"Object"}},VR}var WR,hX;function jz(){if(hX)return WR;hX=1;var t=Eo(),e=OWe(),n=TypeError;return WR=function(r){if(t(r))return r;throw new n(e(r)+" is not a function")},WR}var KR,fX;function Lz(){if(fX)return KR;fX=1;var t=jz(),e=rde();return KR=function(n,r){var i=n[r];return e(i)?void 0:t(i)},KR}var qR,pX;function DWe(){if(pX)return qR;pX=1;var t=$d(),e=Eo(),n=Bd(),r=TypeError;return qR=function(i,s){var o,a;if(s==="string"&&e(o=i.toString)&&!n(a=t(o,i))||e(o=i.valueOf)&&!n(a=t(o,i))||s!=="string"&&e(o=i.toString)&&!n(a=t(o,i)))return a;throw new r("Can't convert object to primitive value")},qR}var GR={exports:{}},YR,gX;function lde(){return gX||(gX=1,YR=!1),YR}var XR,mX;function Fz(){if(mX)return XR;mX=1;var t=Us(),e=Object.defineProperty;return XR=function(n,r){try{e(t,n,{value:r,configurable:!0,writable:!0})}catch{t[n]=r}return r},XR}var yX;function $z(){if(yX)return GR.exports;yX=1;var t=lde(),e=Us(),n=Fz(),r="__core-js_shared__",i=GR.exports=e[r]||n(r,{});return(i.versions||(i.versions=[])).push({version:"3.45.1",mode:t?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.45.1/LICENSE",source:"https://github.com/zloirock/core-js"}),GR.exports}var JR,vX;function Bz(){if(vX)return JR;vX=1;var t=$z();return JR=function(e,n){return t[e]||(t[e]=n||{})},JR}var ZR,bX;function vS(){if(bX)return ZR;bX=1;var t=Nv(),e=Object;return ZR=function(n){return e(t(n))},ZR}var QR,xX;function Df(){if(xX)return QR;xX=1;var t=Ni(),e=vS(),n=t({}.hasOwnProperty);return QR=Object.hasOwn||function(i,s){return n(e(i),s)},QR}var eN,wX;function cde(){if(wX)return eN;wX=1;var t=Ni(),e=0,n=Math.random(),r=t(1.1.toString);return eN=function(i){return"Symbol("+(i===void 0?"":i)+")_"+r(++e+n,36)},eN}var tN,SX;function zd(){if(SX)return tN;SX=1;var t=Us(),e=Bz(),n=Df(),r=cde(),i=sde(),s=ode(),o=t.Symbol,a=e("wks"),l=s?o.for||o:o&&o.withoutSetter||r;return tN=function(c){return n(a,c)||(a[c]=i&&n(o,c)?o[c]:l("Symbol."+c)),a[c]},tN}var nN,CX;function RWe(){if(CX)return nN;CX=1;var t=$d(),e=Bd(),n=ade(),r=Lz(),i=DWe(),s=zd(),o=TypeError,a=s("toPrimitive");return nN=function(l,c){if(!e(l)||n(l))return l;var u=r(l,a),d;if(u){if(c===void 0&&(c="default"),d=t(u,l,c),!e(d)||n(d))return d;throw new o("Can't convert object to primitive value")}return c===void 0&&(c="number"),i(l,c)},nN}var rN,EX;function ude(){if(EX)return rN;EX=1;var t=RWe(),e=ade();return rN=function(n){var r=t(n,"string");return e(r)?r:r+""},rN}var iN,TX;function dde(){if(TX)return iN;TX=1;var t=Us(),e=Bd(),n=t.document,r=e(n)&&e(n.createElement);return iN=function(i){return r?n.createElement(i):{}},iN}var sN,IX;function hde(){if(IX)return sN;IX=1;var t=Of(),e=Hs(),n=dde();return sN=!t&&!e(function(){return Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a!==7}),sN}var PX;function fde(){if(PX)return SR;PX=1;var t=Of(),e=$d(),n=_We(),r=nde(),i=Sk(),s=ude(),o=Df(),a=hde(),l=Object.getOwnPropertyDescriptor;return SR.f=t?l:function(u,d){if(u=i(u),d=s(d),a)try{return l(u,d)}catch{}if(o(u,d))return r(!e(n.f,u,d),u[d])},SR}var oN={},aN,_X;function pde(){if(_X)return aN;_X=1;var t=Of(),e=Hs();return aN=t&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),aN}var lN,kX;function $g(){if(kX)return lN;kX=1;var t=Bd(),e=String,n=TypeError;return lN=function(r){if(t(r))return r;throw new n(e(r)+" is not an object")},lN}var AX;function bS(){if(AX)return oN;AX=1;var t=Of(),e=hde(),n=pde(),r=$g(),i=ude(),s=TypeError,o=Object.defineProperty,a=Object.getOwnPropertyDescriptor,l="enumerable",c="configurable",u="writable";return oN.f=t?n?function(h,f,y){if(r(h),f=i(f),r(y),typeof h=="function"&&f==="prototype"&&"value"in y&&u in y&&!y[u]){var b=a(h,f);b&&b[u]&&(h[f]=y.value,y={configurable:c in y?y[c]:b[c],enumerable:l in y?y[l]:b[l],writable:!1})}return o(h,f,y)}:o:function(h,f,y){if(r(h),f=i(f),r(y),e)try{return o(h,f,y)}catch{}if("get"in y||"set"in y)throw new s("Accessors not supported");return"value"in y&&(h[f]=y.value),h},oN}var cN,MX;function zz(){if(MX)return cN;MX=1;var t=Of(),e=bS(),n=nde();return cN=t?function(r,i,s){return e.f(r,i,n(1,s))}:function(r,i,s){return r[i]=s,r},cN}var uN={exports:{}},dN,OX;function NWe(){if(OX)return dN;OX=1;var t=Of(),e=Df(),n=Function.prototype,r=t&&Object.getOwnPropertyDescriptor,i=e(n,"name"),s=i&&(function(){}).name==="something",o=i&&(!t||t&&r(n,"name").configurable);return dN={EXISTS:i,PROPER:s,CONFIGURABLE:o},dN}var hN,DX;function gde(){if(DX)return hN;DX=1;var t=Ni(),e=Eo(),n=$z(),r=t(Function.toString);return e(n.inspectSource)||(n.inspectSource=function(i){return r(i)}),hN=n.inspectSource,hN}var fN,RX;function jWe(){if(RX)return fN;RX=1;var t=Us(),e=Eo(),n=t.WeakMap;return fN=e(n)&&/native code/.test(String(n)),fN}var pN,NX;function mde(){if(NX)return pN;NX=1;var t=Bz(),e=cde(),n=t("keys");return pN=function(r){return n[r]||(n[r]=e(r))},pN}var gN,jX;function Uz(){return jX||(jX=1,gN={}),gN}var mN,LX;function yde(){if(LX)return mN;LX=1;var t=jWe(),e=Us(),n=Bd(),r=zz(),i=Df(),s=$z(),o=mde(),a=Uz(),l="Object already initialized",c=e.TypeError,u=e.WeakMap,d,h,f,y=function(C){return f(C)?h(C):d(C,{})},b=function(C){return function(E){var I;if(!n(E)||(I=h(E)).type!==C)throw new c("Incompatible receiver, "+C+" required");return I}};if(t||s.state){var v=s.state||(s.state=new u);v.get=v.get,v.has=v.has,v.set=v.set,d=function(C,E){if(v.has(C))throw new c(l);return E.facade=C,v.set(C,E),E},h=function(C){return v.get(C)||{}},f=function(C){return v.has(C)}}else{var x=o("state");a[x]=!0,d=function(C,E){if(i(C,x))throw new c(l);return E.facade=C,r(C,x,E),E},h=function(C){return i(C,x)?C[x]:{}},f=function(C){return i(C,x)}}return mN={set:d,get:h,has:f,enforce:y,getterFor:b},mN}var FX;function LWe(){if(FX)return uN.exports;FX=1;var t=Ni(),e=Hs(),n=Eo(),r=Df(),i=Of(),s=NWe().CONFIGURABLE,o=gde(),a=yde(),l=a.enforce,c=a.get,u=String,d=Object.defineProperty,h=t("".slice),f=t("".replace),y=t([].join),b=i&&!e(function(){return d(function(){},"length",{value:8}).length!==8}),v=String(String).split("String"),x=uN.exports=function(C,E,I){h(u(E),0,7)==="Symbol("&&(E="["+f(u(E),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),I&&I.getter&&(E="get "+E),I&&I.setter&&(E="set "+E),(!r(C,"name")||s&&C.name!==E)&&(i?d(C,"name",{value:E,configurable:!0}):C.name=E),b&&I&&r(I,"arity")&&C.length!==I.arity&&d(C,"length",{value:I.arity});try{I&&r(I,"constructor")&&I.constructor?i&&d(C,"prototype",{writable:!1}):C.prototype&&(C.prototype=void 0)}catch{}var P=l(C);return r(P,"source")||(P.source=y(v,typeof E=="string"?E:"")),C};return Function.prototype.toString=x(function(){return n(this)&&c(this).source||o(this)},"toString"),uN.exports}var yN,$X;function vde(){if($X)return yN;$X=1;var t=Eo(),e=bS(),n=LWe(),r=Fz();return yN=function(i,s,o,a){a||(a={});var l=a.enumerable,c=a.name!==void 0?a.name:s;if(t(o)&&n(o,c,a),a.global)l?i[s]=o:r(s,o);else{try{a.unsafe?i[s]&&(l=!0):delete i[s]}catch{}l?i[s]=o:e.f(i,s,{value:o,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return i},yN}var vN={},bN,BX;function FWe(){if(BX)return bN;BX=1;var t=Math.ceil,e=Math.floor;return bN=Math.trunc||function(r){var i=+r;return(i>0?e:t)(i)},bN}var xN,zX;function Bg(){if(zX)return xN;zX=1;var t=FWe();return xN=function(e){var n=+e;return n!==n||n===0?0:t(n)},xN}var wN,UX;function $We(){if(UX)return wN;UX=1;var t=Bg(),e=Math.max,n=Math.min;return wN=function(r,i){var s=t(r);return s<0?e(s+i,0):n(s,i)},wN}var SN,HX;function bde(){if(HX)return SN;HX=1;var t=Bg(),e=Math.min;return SN=function(n){var r=t(n);return r>0?e(r,9007199254740991):0},SN}var CN,VX;function xS(){if(VX)return CN;VX=1;var t=bde();return CN=function(e){return t(e.length)},CN}var EN,WX;function BWe(){if(WX)return EN;WX=1;var t=Sk(),e=$We(),n=xS(),r=function(i){return function(s,o,a){var l=t(s),c=n(l);if(c===0)return!i&&-1;var u=e(a,c),d;if(i&&o!==o){for(;c>u;)if(d=l[u++],d!==d)return!0}else for(;c>u;u++)if((i||u in l)&&l[u]===o)return i||u||0;return!i&&-1}};return EN={includes:r(!0),indexOf:r(!1)},EN}var TN,KX;function xde(){if(KX)return TN;KX=1;var t=Ni(),e=Df(),n=Sk(),r=BWe().indexOf,i=Uz(),s=t([].push);return TN=function(o,a){var l=n(o),c=0,u=[],d;for(d in l)!e(i,d)&&e(l,d)&&s(u,d);for(;a.length>c;)e(l,d=a[c++])&&(~r(u,d)||s(u,d));return u},TN}var IN,qX;function Hz(){return qX||(qX=1,IN=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),IN}var GX;function zWe(){if(GX)return vN;GX=1;var t=xde(),e=Hz(),n=e.concat("length","prototype");return vN.f=Object.getOwnPropertyNames||function(i){return t(i,n)},vN}var PN={},YX;function UWe(){return YX||(YX=1,PN.f=Object.getOwnPropertySymbols),PN}var _N,XX;function HWe(){if(XX)return _N;XX=1;var t=Ck(),e=Ni(),n=zWe(),r=UWe(),i=$g(),s=e([].concat);return _N=t("Reflect","ownKeys")||function(a){var l=n.f(i(a)),c=r.f;return c?s(l,c(a)):l},_N}var kN,JX;function VWe(){if(JX)return kN;JX=1;var t=Df(),e=HWe(),n=fde(),r=bS();return kN=function(i,s,o){for(var a=e(s),l=r.f,c=n.f,u=0;u<a.length;u++){var d=a[u];!t(i,d)&&!(o&&t(o,d))&&l(i,d,c(s,d))}},kN}var AN,ZX;function WWe(){if(ZX)return AN;ZX=1;var t=Hs(),e=Eo(),n=/#|\.prototype\./,r=function(l,c){var u=s[i(l)];return u===a?!0:u===o?!1:e(c)?t(c):!!c},i=r.normalize=function(l){return String(l).replace(n,".").toLowerCase()},s=r.data={},o=r.NATIVE="N",a=r.POLYFILL="P";return AN=r,AN}var MN,QX;function jv(){if(QX)return MN;QX=1;var t=Us(),e=fde().f,n=zz(),r=vde(),i=Fz(),s=VWe(),o=WWe();return MN=function(a,l){var c=a.target,u=a.global,d=a.stat,h,f,y,b,v,x;if(u?f=t:d?f=t[c]||i(c,{}):f=t[c]&&t[c].prototype,f)for(y in l){if(v=l[y],a.dontCallGetSet?(x=e(f,y),b=x&&x.value):b=f[y],h=o(u?y:c+(d?".":"#")+y,a.forced),!h&&b!==void 0){if(typeof v==typeof b)continue;s(v,b)}(a.sham||b&&b.sham)&&n(v,"sham",!0),r(f,y,v,a)}},MN}var ON={},DN,eJ;function KWe(){if(eJ)return DN;eJ=1;var t=xde(),e=Hz();return DN=Object.keys||function(r){return t(r,e)},DN}var tJ;function qWe(){if(tJ)return ON;tJ=1;var t=Of(),e=pde(),n=bS(),r=$g(),i=Sk(),s=KWe();return ON.f=t&&!e?Object.defineProperties:function(a,l){r(a);for(var c=i(l),u=s(l),d=u.length,h=0,f;d>h;)n.f(a,f=u[h++],c[f]);return a},ON}var RN,nJ;function GWe(){if(nJ)return RN;nJ=1;var t=Ck();return RN=t("document","documentElement"),RN}var NN,rJ;function wde(){if(rJ)return NN;rJ=1;var t=$g(),e=qWe(),n=Hz(),r=Uz(),i=GWe(),s=dde(),o=mde(),a=">",l="<",c="prototype",u="script",d=o("IE_PROTO"),h=function(){},f=function(C){return l+u+a+C+l+"/"+u+a},y=function(C){C.write(f("")),C.close();var E=C.parentWindow.Object;return C=null,E},b=function(){var C=s("iframe"),E="java"+u+":",I;return C.style.display="none",i.appendChild(C),C.src=String(E),I=C.contentWindow.document,I.open(),I.write(f("document.F=Object")),I.close(),I.F},v,x=function(){try{v=new ActiveXObject("htmlfile")}catch{}x=typeof document<"u"?document.domain&&v?y(v):b():y(v);for(var C=n.length;C--;)delete x[c][n[C]];return x()};return r[d]=!0,NN=Object.create||function(E,I){var P;return E!==null?(h[c]=t(E),P=new h,h[c]=null,P[d]=E):P=x(),I===void 0?P:e.f(P,I)},NN}var jN,iJ;function Vz(){if(iJ)return jN;iJ=1;var t=zd(),e=wde(),n=bS().f,r=t("unscopables"),i=Array.prototype;return i[r]===void 0&&n(i,r,{configurable:!0,value:e(null)}),jN=function(s){i[r][s]=!0},jN}var sJ;function YWe(){if(sJ)return UY;sJ=1;var t=jv(),e=vS(),n=xS(),r=Bg(),i=Vz();return t({target:"Array",proto:!0},{at:function(o){var a=e(this),l=n(a),c=r(o),u=c>=0?c:l+c;return u<0||u>=l?void 0:a[u]}}),i("at"),UY}var LN,oJ;function wS(){if(oJ)return LN;oJ=1;var t=Us(),e=Ni();return LN=function(n,r){return e(t[n].prototype[r])},LN}var FN,aJ;function XWe(){if(aJ)return FN;aJ=1,YWe();var t=wS();return FN=t("Array","at"),FN}var $N,lJ;function JWe(){if(lJ)return $N;lJ=1;var t=XWe();return $N=t,$N}JWe();var cJ={},BN,uJ;function Sde(){if(uJ)return BN;uJ=1;var t=Rv();return BN=Array.isArray||function(n){return t(n)==="Array"},BN}var zN,dJ;function ZWe(){if(dJ)return zN;dJ=1;var t=TypeError,e=9007199254740991;return zN=function(n){if(n>e)throw t("Maximum allowed index exceeded");return n},zN}var UN,hJ;function QWe(){if(hJ)return UN;hJ=1;var t=Rv(),e=Ni();return UN=function(n){if(t(n)==="Function")return e(n)},UN}var HN,fJ;function eKe(){if(fJ)return HN;fJ=1;var t=QWe(),e=jz(),n=wk(),r=t(t.bind);return HN=function(i,s){return e(i),s===void 0?i:n?r(i,s):function(){return i.apply(s,arguments)}},HN}var VN,pJ;function Cde(){if(pJ)return VN;pJ=1;var t=Sde(),e=xS(),n=ZWe(),r=eKe(),i=function(s,o,a,l,c,u,d,h){for(var f=c,y=0,b=d?r(d,h):!1,v,x;y<l;)y in a&&(v=b?b(a[y],y,o):a[y],u>0&&t(v)?(x=e(v),f=i(s,o,v,x,f,u-1)-1):(n(f+1),s[f]=v),f++),y++;return f};return VN=i,VN}var WN,gJ;function tKe(){if(gJ)return WN;gJ=1;var t=zd(),e=t("toStringTag"),n={};return n[e]="z",WN=String(n)==="[object z]",WN}var KN,mJ;function Ede(){if(mJ)return KN;mJ=1;var t=tKe(),e=Eo(),n=Rv(),r=zd(),i=r("toStringTag"),s=Object,o=n(function(){return arguments}())==="Arguments",a=function(l,c){try{return l[c]}catch{}};return KN=t?n:function(l){var c,u,d;return l===void 0?"Undefined":l===null?"Null":typeof(u=a(c=s(l),i))=="string"?u:o?n(c):(d=n(c))==="Object"&&e(c.callee)?"Arguments":d},KN}var qN,yJ;function nKe(){if(yJ)return qN;yJ=1;var t=Ni(),e=Hs(),n=Eo(),r=Ede(),i=Ck(),s=gde(),o=function(){},a=i("Reflect","construct"),l=/^\s*(?:class|function)\b/,c=t(l.exec),u=!l.test(o),d=function(y){if(!n(y))return!1;try{return a(o,[],y),!0}catch{return!1}},h=function(y){if(!n(y))return!1;switch(r(y)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return u||!!c(l,s(y))}catch{return!0}};return h.sham=!0,qN=!a||e(function(){var f;return d(d.call)||!d(Object)||!d(function(){f=!0})||f})?h:d,qN}var GN,vJ;function rKe(){if(vJ)return GN;vJ=1;var t=Sde(),e=nKe(),n=Bd(),r=zd(),i=r("species"),s=Array;return GN=function(o){var a;return t(o)&&(a=o.constructor,e(a)&&(a===s||t(a.prototype))?a=void 0:n(a)&&(a=a[i],a===null&&(a=void 0))),a===void 0?s:a},GN}var YN,bJ;function Tde(){if(bJ)return YN;bJ=1;var t=rKe();return YN=function(e,n){return new(t(e))(n===0?0:n)},YN}var xJ;function iKe(){if(xJ)return cJ;xJ=1;var t=jv(),e=Cde(),n=jz(),r=vS(),i=xS(),s=Tde();return t({target:"Array",proto:!0},{flatMap:function(a){var l=r(this),c=i(l),u;return n(a),u=s(l,0),u.length=e(u,l,l,c,0,1,a,arguments.length>1?arguments[1]:void 0),u}}),cJ}var wJ={},SJ;function sKe(){if(SJ)return wJ;SJ=1;var t=Vz();return t("flatMap"),wJ}var XN,CJ;function oKe(){if(CJ)return XN;CJ=1,iKe(),sKe();var t=wS();return XN=t("Array","flatMap"),XN}var JN,EJ;function aKe(){if(EJ)return JN;EJ=1;var t=oKe();return JN=t,JN}aKe();var TJ={},IJ;function lKe(){if(IJ)return TJ;IJ=1;var t=jv(),e=Cde(),n=vS(),r=xS(),i=Bg(),s=Tde();return t({target:"Array",proto:!0},{flat:function(){var a=arguments.length?arguments[0]:void 0,l=n(this),c=r(l),u=s(l,0);return u.length=e(u,l,l,c,0,a===void 0?1:i(a)),u}}),TJ}var PJ={},_J;function cKe(){if(_J)return PJ;_J=1;var t=Vz();return t("flat"),PJ}var ZN,kJ;function uKe(){if(kJ)return ZN;kJ=1,lKe(),cKe();var t=wS();return ZN=t("Array","flat"),ZN}var QN,AJ;function dKe(){if(AJ)return QN;AJ=1;var t=uKe();return QN=t,QN}dKe();var MJ={},ej,OJ;function SS(){if(OJ)return ej;OJ=1;var t=Ede(),e=String;return ej=function(n){if(t(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(n)},ej}var DJ;function hKe(){if(DJ)return MJ;DJ=1;var t=jv(),e=Ni(),n=Nv(),r=Bg(),i=SS(),s=Hs(),o=e("".charAt),a=s(function(){return"𠮷".at(-2)!=="\uD842"});return t({target:"String",proto:!0,forced:a},{at:function(c){var u=i(n(this)),d=u.length,h=r(c),f=h>=0?h:d+h;return f<0||f>=d?void 0:o(u,f)}}),MJ}var tj,RJ;function fKe(){if(RJ)return tj;RJ=1,hKe();var t=wS();return tj=t("String","at"),tj}var nj,NJ;function pKe(){if(NJ)return nj;NJ=1;var t=fKe();return nj=t,nj}pKe();var jJ={},rj,LJ;function Ide(){if(LJ)return rj;LJ=1;var t=$g();return rj=function(){var e=t(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},rj}var ij,FJ;function gKe(){if(FJ)return ij;FJ=1;var t=Hs(),e=Us(),n=e.RegExp,r=t(function(){var o=n("a","y");return o.lastIndex=2,o.exec("abcd")!==null}),i=r||t(function(){return!n("a","y").sticky}),s=r||t(function(){var o=n("^r","gy");return o.lastIndex=2,o.exec("str")!==null});return ij={BROKEN_CARET:s,MISSED_STICKY:i,UNSUPPORTED_Y:r},ij}var sj,$J;function mKe(){if($J)return sj;$J=1;var t=Hs(),e=Us(),n=e.RegExp;return sj=t(function(){var r=n(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),sj}var oj,BJ;function yKe(){if(BJ)return oj;BJ=1;var t=Hs(),e=Us(),n=e.RegExp;return oj=t(function(){var r=n("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),oj}var aj,zJ;function Wz(){if(zJ)return aj;zJ=1;var t=$d(),e=Ni(),n=SS(),r=Ide(),i=gKe(),s=Bz(),o=wde(),a=yde().get,l=mKe(),c=yKe(),u=s("native-string-replace",String.prototype.replace),d=RegExp.prototype.exec,h=d,f=e("".charAt),y=e("".indexOf),b=e("".replace),v=e("".slice),x=function(){var P=/a/,_=/b*/g;return t(d,P,"a"),t(d,_,"a"),P.lastIndex!==0||_.lastIndex!==0}(),C=i.BROKEN_CARET,E=/()??/.exec("")[1]!==void 0,I=x||E||C||l||c;return I&&(h=function(_){var A=this,D=a(A),L=n(_),z=D.raw,$,H,R,j,B,K,G;if(z)return z.lastIndex=A.lastIndex,$=t(h,z,L),A.lastIndex=z.lastIndex,$;var V=D.groups,W=C&&A.sticky,Z=t(r,A),U=A.source,J=0,ge=L;if(W&&(Z=b(Z,"y",""),y(Z,"g")===-1&&(Z+="g"),ge=v(L,A.lastIndex),A.lastIndex>0&&(!A.multiline||A.multiline&&f(L,A.lastIndex-1)!==`
`)&&(U="(?: "+U+")",ge=" "+ge,J++),H=new RegExp("^(?:"+U+")",Z)),E&&(H=new RegExp("^"+U+"$(?!\\s)",Z)),x&&(R=A.lastIndex),j=t(d,W?H:A,ge),W?j?(j.input=v(j.input,J),j[0]=v(j[0],J),j.index=A.lastIndex,A.lastIndex+=j[0].length):A.lastIndex=0:x&&j&&(A.lastIndex=A.global?j.index+j[0].length:R),E&&j&&j.length>1&&t(u,j[0],H,function(){for(B=1;B<arguments.length-2;B++)arguments[B]===void 0&&(j[B]=void 0)}),j&&V)for(j.groups=K=o(null),B=0;B<V.length;B++)G=V[B],K[G[0]]=j[G[1]];return j}),aj=h,aj}var UJ;function Pde(){if(UJ)return jJ;UJ=1;var t=jv(),e=Wz();return t({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),jJ}var HJ={},lj,VJ;function vKe(){if(VJ)return lj;VJ=1;var t=wk(),e=Function.prototype,n=e.apply,r=e.call;return lj=typeof Reflect=="object"&&Reflect.apply||(t?r.bind(n):function(){return r.apply(n,arguments)}),lj}var cj,WJ;function bKe(){if(WJ)return cj;WJ=1,Pde();var t=$d(),e=vde(),n=Wz(),r=Hs(),i=zd(),s=zz(),o=i("species"),a=RegExp.prototype;return cj=function(l,c,u,d){var h=i(l),f=!r(function(){var x={};return x[h]=function(){return 7},""[l](x)!==7}),y=f&&!r(function(){var x=!1,C=/a/;return l==="split"&&(C={},C.constructor={},C.constructor[o]=function(){return C},C.flags="",C[h]=/./[h]),C.exec=function(){return x=!0,null},C[h](""),!x});if(!f||!y||u){var b=/./[h],v=c(h,""[l],function(x,C,E,I,P){var _=C.exec;return _===n||_===a.exec?f&&!P?{done:!0,value:t(b,C,E,I)}:{done:!0,value:t(x,E,C,I)}:{done:!1}});e(String.prototype,l,v[0]),e(a,h,v[1])}d&&s(a[h],"sham",!0)},cj}var uj,KJ;function xKe(){if(KJ)return uj;KJ=1;var t=Ni(),e=Bg(),n=SS(),r=Nv(),i=t("".charAt),s=t("".charCodeAt),o=t("".slice),a=function(l){return function(c,u){var d=n(r(c)),h=e(u),f=d.length,y,b;return h<0||h>=f?l?"":void 0:(y=s(d,h),y<55296||y>56319||h+1===f||(b=s(d,h+1))<56320||b>57343?l?i(d,h):y:l?o(d,h,h+2):(y-55296<<10)+(b-56320)+65536)}};return uj={codeAt:a(!1),charAt:a(!0)},uj}var dj,qJ;function wKe(){if(qJ)return dj;qJ=1;var t=xKe().charAt;return dj=function(e,n,r){return n+(r?t(e,n).length:1)},dj}var hj,GJ;function _de(){if(GJ)return hj;GJ=1;var t=Ni(),e=vS(),n=Math.floor,r=t("".charAt),i=t("".replace),s=t("".slice),o=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;return hj=function(l,c,u,d,h,f){var y=u+l.length,b=d.length,v=a;return h!==void 0&&(h=e(h),v=o),i(f,v,function(x,C){var E;switch(r(C,0)){case"$":return"$";case"&":return l;case"`":return s(c,0,u);case"'":return s(c,y);case"<":E=h[s(C,1,-1)];break;default:var I=+C;if(I===0)return x;if(I>b){var P=n(I/10);return P===0?x:P<=b?d[P-1]===void 0?r(C,1):d[P-1]+r(C,1):x}E=d[I-1]}return E===void 0?"":E})},hj}var fj,YJ;function SKe(){if(YJ)return fj;YJ=1;var t=Us(),e=Hs(),n=t.RegExp,r=!e(function(){var i=!0;try{n(".","d")}catch{i=!1}var s={},o="",a=i?"dgimsy":"gimsy",l=function(h,f){Object.defineProperty(s,h,{get:function(){return o+=f,!0}})},c={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};i&&(c.hasIndices="d");for(var u in c)l(u,c[u]);var d=Object.getOwnPropertyDescriptor(n.prototype,"flags").get.call(s);return d!==a||o!==a});return fj={correct:r},fj}var pj,XJ;function kde(){if(XJ)return pj;XJ=1;var t=$d(),e=Df(),n=ide(),r=SKe(),i=Ide(),s=RegExp.prototype;return pj=r.correct?function(o){return o.flags}:function(o){return!r.correct&&n(s,o)&&!e(o,"flags")?t(i,o):o.flags},pj}var gj,JJ;function CKe(){if(JJ)return gj;JJ=1;var t=$d(),e=$g(),n=Eo(),r=Rv(),i=Wz(),s=TypeError;return gj=function(o,a){var l=o.exec;if(n(l)){var c=t(l,o,a);return c!==null&&e(c),c}if(r(o)==="RegExp")return t(i,o,a);throw new s("RegExp#exec called on incompatible receiver")},gj}var ZJ;function EKe(){if(ZJ)return HJ;ZJ=1;var t=vKe(),e=$d(),n=Ni(),r=bKe(),i=Hs(),s=$g(),o=Eo(),a=Bd(),l=Bg(),c=bde(),u=SS(),d=Nv(),h=wKe(),f=Lz(),y=_de(),b=kde(),v=CKe(),x=zd(),C=x("replace"),E=Math.max,I=Math.min,P=n([].concat),_=n([].push),A=n("".indexOf),D=n("".slice),L=function(R){return R===void 0?R:String(R)},z=function(){return"a".replace(/./,"$0")==="$0"}(),$=function(){return/./[C]?/./[C]("a","$0")==="":!1}(),H=!i(function(){var R=/./;return R.exec=function(){var j=[];return j.groups={a:"7"},j},"".replace(R,"$<a>")!=="7"});return r("replace",function(R,j,B){var K=$?"$":"$0";return[function(V,W){var Z=d(this),U=a(V)?f(V,C):void 0;return U?e(U,V,Z,W):e(j,u(Z),V,W)},function(G,V){var W=s(this),Z=u(G);if(typeof V=="string"&&A(V,K)===-1&&A(V,"$<")===-1){var U=B(j,W,Z,V);if(U.done)return U.value}var J=o(V);J||(V=u(V));var ge=u(b(W)),_e=A(ge,"g")!==-1,fe;_e&&(fe=A(ge,"u")!==-1,W.lastIndex=0);for(var je=[],Ae;Ae=v(W,Z),!(Ae===null||(_(je,Ae),!_e));){var ke=u(Ae[0]);ke===""&&(W.lastIndex=h(Z,c(W.lastIndex),fe))}for(var le="",ve=0,qe=0;qe<je.length;qe++){Ae=je[qe];for(var de=u(Ae[0]),pe=E(I(l(Ae.index),Z.length),0),Se=[],Fe,ut=1;ut<Ae.length;ut++)_(Se,L(Ae[ut]));var Tt=Ae.groups;if(J){var pn=P([de],Se,pe,Z);Tt!==void 0&&_(pn,Tt),Fe=u(t(V,void 0,pn))}else Fe=y(de,Z,pe,Se,Tt,V);pe>=ve&&(le+=D(Z,ve,pe)+Fe,ve=pe+de.length)}return le+D(Z,ve)}]},!H||!z||$),HJ}var QJ={},mj,eZ;function TKe(){if(eZ)return mj;eZ=1;var t=Bd(),e=Rv(),n=zd(),r=n("match");return mj=function(i){var s;return t(i)&&((s=i[r])!==void 0?!!s:e(i)==="RegExp")},mj}var tZ;function IKe(){if(tZ)return QJ;tZ=1;var t=jv(),e=$d(),n=Ni(),r=Nv(),i=Eo(),s=Bd(),o=TKe(),a=SS(),l=Lz(),c=kde(),u=_de(),d=zd(),h=lde(),f=d("replace"),y=TypeError,b=n("".indexOf),v=n("".replace),x=n("".slice),C=Math.max;return t({target:"String",proto:!0},{replaceAll:function(I,P){var _=r(this),A,D,L,z,$,H,R,j,B,K,G=0,V="";if(s(I)){if(A=o(I),A&&(D=a(r(c(I))),!~b(D,"g")))throw new y("`.replaceAll` does not allow non-global regexes");if(L=l(I,f),L)return e(L,I,_,P);if(h&&A)return v(a(_),I,P)}for(z=a(_),$=a(I),H=i(P),H||(P=a(P)),R=$.length,j=C(1,R),B=b(z,$);B!==-1;)K=H?a(P($,B,z)):u($,z,B,[],void 0,P),V+=x(z,G,B)+K,G=B+R,B=B+j>z.length?-1:b(z,$,B+j);return G<z.length&&(V+=x(z,G)),V}}),QJ}var yj,nZ;function PKe(){if(nZ)return yj;nZ=1,Pde(),EKe(),IKe();var t=wS();return yj=t("String","replaceAll"),yj}var vj,rZ;function _Ke(){if(rZ)return vj;rZ=1;var t=PKe();return vj=t,vj}_Ke();function Ade(t){return t&&typeof t=="object"&&"parents"in t}function Mde(t){for(let e=0,n=t.parents.length;e<n;e++)if(t.parents[e].__unsafe__getWithoutCapture(!0),t.parents[e].lastChangedEpoch!==t.parentEpochs[e])return!0;return!1}function OI(t,e){if(t.children.remove(e)&&t.children.isEmpty&&Ade(t))for(let n=0,r=t.parents.length;n<r;n++)OI(t.parents[n],t)}function Kz(t,e){if(t.children.add(e)&&Ade(t))for(let n=0,r=t.parents.length;n<r;n++)Kz(t.parents[n],t)}function Ode(t,e){return t===e||Object.is(t,e)||!!(t&&e&&typeof t.equals=="function"&&t.equals(e))}function Rf(t,e){const n=Symbol.for(`com.tldraw.state/${t}`),r=globalThis;return r[n]??(r[n]=e()),r[n]}const Mr=Rf("empty_array",()=>Object.freeze([])),iZ=8;class DI{constructor(){N(this,"arraySize",0);N(this,"array",Array(iZ));N(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<iZ?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const n=this.array.indexOf(e);return n===-1?!1:(this.array[n]=void 0,this.arraySize--,n!==this.arraySize&&(this.array[n]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let n=0;n<this.arraySize;n++){const r=this.array[n];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}*[Symbol.iterator](){if(this.array)for(let e=0;e<this.arraySize;e++){const n=this.array[e];typeof n<"u"&&(yield n)}else if(this.set)yield*this.set;else throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const Aa=Symbol.for("com.tldraw.state/RESET_VALUE");class Dde{constructor(e){N(this,"index",0);N(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,n,r){if(r!==void 0){if(r===Aa){this.clear();return}this.buffer[this.index]=[e,n,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:n,capacity:r,buffer:i}=this;for(let s=0;s<r;s++){const o=(n-1+r-s)%r,a=i[o];if(!a)return Aa;const[l,c]=a;if(s===0&&e>=c)return[];if(l<=e&&e<c){const u=s+1,d=new Array(u);for(let h=0;h<u;h++)d[h]=i[(o+h)%r][2];return d}}return Aa}}const Kh=-1;class kKe{constructor(e,n,r){N(this,"_isActivelyListening",!1);N(this,"lastTraversedEpoch",Kh);N(this,"lastReactedEpoch",Kh);N(this,"_scheduleCount",0);N(this,"__debug_ancestor_epochs__",null);N(this,"parentSet",new DI);N(this,"parentEpochs",[]);N(this,"parents",[]);N(this,"_scheduleEffect");N(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=n,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Ho()){if(this.parents.length&&!Mde(this)){this.lastReactedEpoch=Ho();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,n=this.parents.length;e<n;e++)Kz(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,n=this.parents.length;e<n;e++)OI(this.parents[e],this)}execute(){try{Lde(this);const e=Ho(),n=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,n}finally{Fde()}}}const zg=Rf("EffectScheduler",()=>kKe);function Ma(t,e,n){const r=new zg(t,e,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function AKe(t,e,n){const r=new zg(t,e,n);return{scheduler:r,start:i=>{const s=(i==null?void 0:i.force)??!1;r.attach(),s?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}let MKe=class{constructor(e,n){N(this,"asyncProcessCount",0);N(this,"initialAtomValues",new Map);this.parent=e,this.isSync=n}get isRoot(){return this.parent===null}commit(){if(ln.globalIsReacting)for(const e of this.initialAtomValues.keys())Nde(e);else this.isRoot?Rde(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,n)=>{this.parent.initialAtomValues.has(n)||this.parent.initialAtomValues.set(n,e)})}abort(){ln.globalEpoch++,this.initialAtomValues.forEach((e,n)=>{var r;n.set(e),(r=n.historyBuffer)==null||r.clear()}),this.commit()}};const ln=Rf("transactions",()=>({globalEpoch:Kh+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:Kh+1}));function OKe(){return ln.reactionEpoch}function Ho(){return ln.globalEpoch}function DKe(){return ln.globalIsReacting}function qz(t,e){e.lastTraversedEpoch!==ln.globalEpoch&&(e.lastTraversedEpoch=ln.globalEpoch,e instanceof zg?t.add(e):e.children.visit(n=>qz(t,n)))}function Rde(t){var n;if(ln.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const e=ln.currentTransaction;try{ln.currentTransaction=null,ln.globalIsReacting=!0,ln.reactionEpoch=ln.globalEpoch;const r=new Set;for(const s of t)s.children.visit(o=>qz(r,o));for(const s of r)s.maybeScheduleEffect();let i=0;for(;(n=ln.cleanupReactors)!=null&&n.size;){if(i++>1e3)throw new Error("Reaction update depth limit exceeded");const s=ln.cleanupReactors;ln.cleanupReactors=null;for(const o of s)o.maybeScheduleEffect()}}finally{ln.cleanupReactors=null,ln.globalIsReacting=!1,ln.currentTransaction=e}}function RKe(t,e){ln.currentTransaction?ln.currentTransaction.initialAtomValues.has(t)||ln.currentTransaction.initialAtomValues.set(t,e):ln.globalIsReacting?Nde(t):Rde([t])}function Nde(t){const e=ln.cleanupReactors??(ln.cleanupReactors=new Set);t.children.visit(n=>qz(e,n))}function NKe(){ln.globalEpoch++}function jKe(t){const e=new MKe(ln.currentTransaction,!0);ln.currentTransaction=e;try{let n,r=!1;try{n=t(()=>r=!0)}catch(i){throw e.abort(),i}if(ln.currentTransaction!==e)throw new Error("Transaction boundaries overlap");return r?e.abort():e.commit(),n}finally{ln.currentTransaction=e.parent}}function Oa(t){return ln.currentTransaction?t():jKe(t)}let sZ=!1;function LKe(){sZ||(sZ=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const Cs=Symbol.for("com.tldraw.state/UNINITIALIZED");function Hp(t){return t===Cs}const j3=Rf("WithDiff",()=>class{constructor(e,n){this.value=e,this.diff=n}});function _b(t,e){return new j3(t,e)}class FKe{constructor(e,n,r){N(this,"lastChangedEpoch",Kh);N(this,"lastTraversedEpoch",Kh);N(this,"__debug_ancestor_epochs__",null);N(this,"lastCheckedEpoch",Kh);N(this,"parentSet",new DI);N(this,"parents",[]);N(this,"parentEpochs",[]);N(this,"children",new DI);N(this,"historyBuffer");N(this,"state",Cs);N(this,"error",null);N(this,"computeDiff");N(this,"isEqual");this.name=e,this.derive=n,r!=null&&r.historyLength&&(this.historyBuffer=new Dde(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??Ode}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var i;const n=this.lastChangedEpoch===Kh,r=Ho();if(!n&&(this.lastCheckedEpoch===r||this.isActivelyListening&&DKe()&&this.lastTraversedEpoch<OKe()||!Mde(this)))if(this.lastCheckedEpoch=r,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{Lde(this);const s=this.derive(this.state,this.lastCheckedEpoch),o=s instanceof j3?s.value:s,a=this.state===Cs;if(a||!this.isEqual(o,this.state)){if(this.historyBuffer&&!a){const l=s instanceof j3?s.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Ho(),l??((i=this.computeDiff)==null?void 0:i.call(this,this.state,o,this.lastCheckedEpoch,Ho()))??Aa)}this.lastChangedEpoch=Ho(),this.state=o}return this.error=null,this.lastCheckedEpoch=Ho(),this.state}catch(s){if(this.state!==Cs&&(this.state=Cs,this.lastChangedEpoch=Ho()),this.lastCheckedEpoch=Ho(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:s},!e)throw s;return this.state}finally{Fde()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{RI(this)}}getDiffSince(e){var n;return this.__unsafe__getWithoutCapture(!0),RI(this),e>=this.lastChangedEpoch?Mr:((n=this.historyBuffer)==null?void 0:n.getChangesSince(e))??Aa}}const CS=Rf("Computed",()=>FKe);function $Ke(t={},e,n,r){const i=r.value,s=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let o=this[s];return o||(o=new CS(n,i.bind(this),t),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r.value[jde]=!0,r}function BKe(t={},e,n,r){const i=r.get,s=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let o=this[s];return o||(o=new CS(n,i.bind(this),t),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r}function zKe(t,e,n){it(n.kind==="method","@computed can only be used on methods");const r=Symbol.for("__@tldraw/state__computed__"+String(n.name)),i=function(){let s=this[r];return s||(s=new CS(String(n.name),e.bind(this),t),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()};return i[jde]=!0,i}function oZ(t={},e){if(e.length===2){const[n,r]=e;return zKe(t,n,r)}else{const[n,r,i]=e;return i.get?(LKe(),BKe(t,n,r,i)):$Ke(t,n,r,i)}}const jde="@@__isComputedMethod__@@";function me(){if(arguments.length===1){const t=arguments[0];return(...e)=>oZ(t,e)}else return typeof arguments[0]=="string"?new CS(arguments[0],arguments[1],arguments[2]):oZ(void 0,arguments)}function Gz(t){return t&&t instanceof CS}class UKe{constructor(e,n){N(this,"offset",0);N(this,"maybeRemoved");this.below=e,this.child=n}}const Yn=Rf("capture",()=>({stack:null}));function kb(t){const e=Yn.stack;Yn.stack=null;try{return t()}finally{Yn.stack=e}}function Lde(t){if(Yn.stack=new UKe(Yn.stack,t),t.__debug_ancestor_epochs__){const e=t.__debug_ancestor_epochs__;t.__debug_ancestor_epochs__=null;for(const n of t.parents)n.__unsafe__getWithoutCapture(!0);HKe(t,e)}t.parentSet.clear()}function Fde(){const t=Yn.stack;if(Yn.stack=t.below,t.offset<t.child.parents.length){for(let e=t.offset;e<t.child.parents.length;e++){const n=t.child.parents[e];t.child.parentSet.has(n)||OI(n,t.child)}t.child.parents.length=t.offset,t.child.parentEpochs.length=t.offset}if(t.maybeRemoved)for(let e=0;e<t.maybeRemoved.length;e++){const n=t.maybeRemoved[e];t.child.parentSet.has(n)||OI(n,t.child)}t.child.__debug_ancestor_epochs__&&$de(t.child,t.child.__debug_ancestor_epochs__)}function RI(t){if(Yn.stack){if(Yn.stack.child.parentSet.has(t))return;if(Yn.stack.child.parentSet.add(t),Yn.stack.child.isActivelyListening&&Kz(t,Yn.stack.child),Yn.stack.offset<Yn.stack.child.parents.length){const n=Yn.stack.child.parents[Yn.stack.offset];n!==t&&(Yn.stack.maybeRemoved?Yn.stack.maybeRemoved.push(n):Yn.stack.maybeRemoved=[n])}Yn.stack.child.parents[Yn.stack.offset]=t,Yn.stack.child.parentEpochs[Yn.stack.offset]=t.lastChangedEpoch,Yn.stack.offset++}}function $de(t,e){for(let n=0;n<t.parents.length;n++){const r=t.parents[n],i=t.parentEpochs[n];e.set(r,i),Gz(r)&&$de(r,e)}return e}function Bde(t,e){const n={};for(let r=0;r<t.parents.length;r++){const i=t.parents[r];if(!e.has(i))continue;const s=e.get(i);i.lastChangedEpoch!==s&&(Gz(i)?n[i.name]=Bde(i,e):n[i.name]=null)}return n}function HKe(t,e){const n=Bde(t,e);if(Object.keys(n).length===0){console.log(`Effect(${t.name}) was executed manually.`);return}let r=Gz(t)?`Computed(${t.name}) is recomputing because:`:`Effect(${t.name}) is executing because:`;function i(s,o){const a=`
`+" ".repeat(o)+"↳ ";for(const[l,c]of Object.entries(s))c?(r+=`${a}Computed(${l}) changed`,i(c,o+2)):r+=`${a}Atom(${l}) changed`}i(n,1),console.log(r)}class VKe{constructor(e,n,r){N(this,"isEqual");N(this,"computeDiff");N(this,"lastChangedEpoch",Ho());N(this,"children",new DI);N(this,"historyBuffer");this.name=e,this.current=n,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new Dde(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return RI(this),this.current}set(e,n){var i,s;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,e))??Ode(this.current,e))return this.current;NKe(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Ho(),n??((s=this.computeDiff)==null?void 0:s.call(this,this.current,e,this.lastChangedEpoch,Ho()))??Aa),this.lastChangedEpoch=Ho();const r=this.current;return this.current=e,RKe(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var n;return RI(this),e>=this.lastChangedEpoch?Mr:((n=this.historyBuffer)==null?void 0:n.getChangesSince(e))??Aa}}const WKe=Rf("Atom",()=>VKe);function lr(t,e,n){return new WKe(t,e,n)}const zde=1,KKe=Rf("apiVersion",()=>zde);if(KKe!==zde)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");Fd("@tldraw/state","3.15.3","esm");function Ek(t,e,n=[]){const r=$e.useRef(e);r.current=e;const[i,s,o]=$e.useMemo(()=>{let a=null;const l=d=>(a=d,()=>{a=null}),c=new zg(`useStateTracking(${t})`,()=>{var d;return(d=r.current)==null?void 0:d.call(r)},{scheduleEffect(){a==null||a()}});return[c,l,()=>c.scheduleCount]},[t,...n]);return $e.useSyncExternalStore(s,o,o),$e.useEffect(()=>(i.attach(),i.maybeScheduleEffect(),()=>{i.detach()}),[i]),i.execute()}const aZ={apply(t,e,n){return Ek(t.displayName??t.name??"tracked(???)",()=>t.apply(e,n))}},qKe=Symbol.for("react.memo"),GKe=Symbol.for("react.forward_ref");function Lr(t){let e=null;const n=t.$$typeof;return n===qKe&&(t=t.type,e=t.compare),n===GKe?S.memo(S.forwardRef(new Proxy(t.render,aZ))):S.memo(new Proxy(t,aZ),e)}function ES(t,e,n){return S.useState(()=>{const r=typeof e=="function"?e():e;return lr(`useAtom(${t})`,r,n)})[0]}function YKe(){const t=arguments[0],e=arguments[1],n=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return S.useMemo(()=>me(`useComputed(${t})`,e,n),r)}function lg(t,e,n=Mr){S.useEffect(()=>{const r=new zg(t,e);return r.attach(),r.execute(),()=>{r.detach()}},n)}function Yz(t,e,n=[]){S.useEffect(()=>{let r;const i=new zg(t,e,{scheduleEffect:s=>{r=Nz(s)}});return i.attach(),i.execute(),()=>{i.detach(),r==null||r()}},n)}function ie(){const t=arguments,e=t.length===3?t[2]:[t[0]],n=t.length===3?t[0]:`useValue(${t[0].name})`,{$val:r,subscribe:i,getSnapshot:s}=S.useMemo(()=>{const o=t.length===1?t[0]:me(n,t[1]);return{$val:o,subscribe:a=>Ma(`useValue(${n})`,()=>{try{o.get()}catch{}a()}),getSnapshot:()=>o.lastChangedEpoch}},e);return S.useSyncExternalStore(i,s,s),r.__unsafe__getWithoutCapture()}Fd("@tldraw/state-react","3.15.3","esm");/*!
 * This file was lovingly and delicately extracted from Immutable.js
 * MIT License: https://github.com/immutable-js/immutable-js/blob/main/LICENSE
 * Copyright (c) 2014-present, Lee Byron and other contributors.
 */function Xz(t){return t>>>1&1073741824|t&3221225471}const XKe=Object.prototype.valueOf;function cg(t){if(t==null)return lZ(t);if(typeof t.hashCode=="function")return Xz(t.hashCode(t));const e=tqe(t);if(e==null)return lZ(e);switch(typeof e){case"boolean":return e?1108378657:1108378656;case"number":return JKe(e);case"string":return e.length>nqe?ZKe(e):L3(e);case"object":case"function":return eqe(e);case"symbol":return QKe(e);default:if(typeof e.toString=="function")return L3(e.toString());throw new Error("Value type "+typeof e+" cannot be hashed.")}}function lZ(t){return t===null?1108378658:1108378659}function JKe(t){if(t!==t||t===1/0)return 0;let e=t|0;for(e!==t&&(e^=t*4294967295);t>4294967295;)t/=4294967295,e^=t;return Xz(e)}function ZKe(t){let e=wj[t];return e===void 0&&(e=L3(t),xj===rqe&&(xj=0,wj={}),xj++,wj[t]=e),e}function L3(t){let e=0;for(let n=0;n<t.length;n++)e=31*e+t.charCodeAt(n)|0;return Xz(e)}function QKe(t){let e=uZ[t];return e!==void 0||(e=Ude(),uZ[t]=e),e}function eqe(t){let e=cZ.get(t);return e!==void 0||(e=Ude(),cZ.set(t,e)),e}function tqe(t){return t.valueOf!==XKe&&typeof t.valueOf=="function"?t.valueOf(t):t}function Ude(){const t=++bj;return bj&1073741824&&(bj=0),t}const cZ=new WeakMap,uZ=Object.create(null);let bj=0;const nqe=16,rqe=255;let xj=0,wj={};const zy=5,TS=1<<zy,Uy=TS-1,Ed={};function dZ(){return{value:!1}}function lc(t){t&&(t.value=!0)}function Jz(t,e){e=e||0;const n=Math.max(0,t.length-e),r=new Array(n);for(let i=0;i<n;i++)r[i]=t[i+e];return r}const Hy=Object.is;class Hde{}class Zz{constructor(e){N(this,"_root");N(this,"size");N(this,"__ownerID");N(this,"__hash");N(this,"__altered");return e==null?uy():e instanceof Zz?e:uy().withMutations(n=>{for(const[r,i]of e)n.set(r,i)})}get(e,n){return this._root?this._root.get(0,void 0,e,n):n}set(e,n){return pZ(this,e,n)}delete(e){return pZ(this,e,Ed)}deleteAll(e){return this.withMutations(n=>{for(const r of e)n.delete(r)})}__ensureOwner(e){return e===this.__ownerID?this:e?tU(this.size,this._root,e,this.__hash):this.size===0?uy():(this.__ownerID=e,this.__altered=!1,this)}withMutations(e){const n=this.asMutable();return e(n),n.wasAltered()?n.__ensureOwner(this.__ownerID):this}wasAltered(){return this.__altered}asMutable(){return this.__ownerID?this:this.__ensureOwner(new Hde)}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}entries(){return new Sj(this,iqe,!1)}keys(){return new Sj(this,Vde,!1)}values(){return new Sj(this,Wde,!1)}}class Qz{constructor(e,n){this.ownerID=e,this.entries=n}get(e,n,r,i){const s=this.entries;for(let o=0,a=s.length;o<a;o++)if(Hy(r,s[o][0]))return s[o][1];return i}update(e,n,r,i,s,o,a){const l=s===Ed,c=this.entries;let u=0;const d=c.length;for(;u<d&&!Hy(i,c[u][0]);u++);const h=u<d;if(h?c[u][1]===s:l)return this;if(lc(a),(l||!h)&&lc(o),l&&c.length===1)return;if(!h&&!l&&c.length>=hqe)return aqe(e,c,i,s);const f=e&&e===this.ownerID,y=f?c:Jz(c);return h?l?u===d-1?y.pop():y[u]=y.pop():y[u]=[i,s]:y.push([i,s]),f?(this.entries=y,this):new Qz(e,y)}}class Tk{constructor(e,n,r){this.ownerID=e,this.bitmap=n,this.nodes=r}get(e,n,r,i){n===void 0&&(n=cg(r));const s=1<<((e===0?n:n>>>e)&Uy),o=this.bitmap;return(o&s)===0?i:this.nodes[mZ(o&s-1)].get(e+zy,n,r,i)}update(e,n,r,i,s,o,a){r===void 0&&(r=cg(i));const l=(n===0?r:r>>>n)&Uy,c=1<<l,u=this.bitmap,d=(u&c)!==0;if(!d&&s===Ed)return this;const h=mZ(u&c-1),f=this.nodes,y=d?f[h]:void 0,b=nU(y,e,n+zy,r,i,s,o,a);if(b===y)return this;if(!d&&b&&f.length>=fqe)return cqe(e,f,u,l,b);if(d&&!b&&f.length===2&&gZ(f[h^1]))return f[h^1];if(d&&b&&f.length===1&&gZ(b))return b;const v=e&&e===this.ownerID,x=d?b?u:u^c:u|c,C=d?b?Kde(f,h,b,v):dqe(f,h,v):uqe(f,h,b,v);return v?(this.bitmap=x,this.nodes=C,this):new Tk(e,x,C)}}class eU{constructor(e,n,r){this.ownerID=e,this.count=n,this.nodes=r}get(e,n,r,i){n===void 0&&(n=cg(r));const s=(e===0?n:n>>>e)&Uy,o=this.nodes[s];return o?o.get(e+zy,n,r,i):i}update(e,n,r,i,s,o,a){r===void 0&&(r=cg(i));const l=(n===0?r:r>>>n)&Uy,c=s===Ed,u=this.nodes,d=u[l];if(c&&!d)return this;const h=nU(d,e,n+zy,r,i,s,o,a);if(h===d)return this;let f=this.count;if(!d)f++;else if(!h&&(f--,f<pqe))return lqe(e,u,f,l);const y=e&&e===this.ownerID,b=Kde(u,l,h,y);return y?(this.count=f,this.nodes=b,this):new eU(e,f,b)}}class Ik{constructor(e,n,r){this.ownerID=e,this.keyHash=n,this.entries=r}get(e,n,r,i){const s=this.entries;for(let o=0,a=s.length;o<a;o++)if(Hy(r,s[o][0]))return s[o][1];return i}update(e,n,r,i,s,o,a){r===void 0&&(r=cg(i));const l=s===Ed;if(r!==this.keyHash)return l?this:(lc(a),lc(o),rU(this,e,n,r,[i,s]));const c=this.entries;let u=0;const d=c.length;for(;u<d&&!Hy(i,c[u][0]);u++);const h=u<d;if(h?c[u][1]===s:l)return this;if(lc(a),(l||!h)&&lc(o),l&&d===2)return new Ug(e,this.keyHash,c[u^1]);const f=e&&e===this.ownerID,y=f?c:Jz(c);return h?l?u===d-1?y.pop():y[u]=y.pop():y[u]=[i,s]:y.push([i,s]),f?(this.entries=y,this):new Ik(e,this.keyHash,y)}}class Ug{constructor(e,n,r){this.ownerID=e,this.keyHash=n,this.entry=r}get(e,n,r,i){return Hy(r,this.entry[0])?this.entry[1]:i}update(e,n,r,i,s,o,a){const l=s===Ed,c=Hy(i,this.entry[0]);if(c?s===this.entry[1]:l)return this;if(lc(a),l){lc(o);return}return c?e&&e===this.ownerID?(this.entry[1]=s,this):new Ug(e,this.keyHash,[i,s]):(lc(o),rU(this,e,n,cg(i),[i,s]))}}class Sj{constructor(e,n,r){N(this,"_stack");this._type=n,this._reverse=r,this._stack=e._root&&hZ(e._root)}[Symbol.iterator](){return this}next(){const e=this._type;let n=this._stack;for(;n;){const r=n.node,i=n.index++;let s;if(r.entry){if(i===0)return Cj(e,r.entry)}else if("entries"in r&&r.entries){if(s=r.entries.length-1,i<=s)return Cj(e,r.entries[this._reverse?s-i:i])}else if(s=r.nodes.length-1,i<=s){const o=r.nodes[this._reverse?s-i:i];if(o){if(o.entry)return Cj(e,o.entry);n=this._stack=hZ(o,n)}continue}n=this._stack=this._stack.__prev}return oqe()}}function Cj(t,e){return sqe(t,e[0],e[1])}function hZ(t,e){return{node:t,index:0,__prev:e}}const Vde=0,Wde=1,iqe=2;function sqe(t,e,n,r){const i=t===Vde?e:t===Wde?n:[e,n];return r?r.value=i:r={value:i,done:!1},r}function oqe(){return{value:void 0,done:!0}}function tU(t,e,n,r){const i=Object.create(Zz.prototype);return i.size=t,i._root=e,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}let fZ;function uy(){return fZ||(fZ=tU(0))}function pZ(t,e,n){let r,i;if(t._root){const s=dZ(),o=dZ();if(r=nU(t._root,t.__ownerID,0,void 0,e,n,s,o),!o.value)return t;i=t.size+(s.value?n===Ed?-1:1:0)}else{if(n===Ed)return t;i=1,r=new Qz(t.__ownerID,[[e,n]])}return t.__ownerID?(t.size=i,t._root=r,t.__hash=void 0,t.__altered=!0,t):r?tU(i,r):uy()}function nU(t,e,n,r,i,s,o,a){return t?t.update(e,n,r,i,s,o,a):s===Ed?t:(lc(a),lc(o),new Ug(e,r,[i,s]))}function gZ(t){return t.constructor===Ug||t.constructor===Ik}function rU(t,e,n,r,i){if(t.keyHash===r)return new Ik(e,r,[t.entry,i]);const s=(n===0?t.keyHash:t.keyHash>>>n)&Uy,o=(n===0?r:r>>>n)&Uy;let a;const l=s===o?[rU(t,e,n+zy,r,i)]:(a=new Ug(e,r,i),s<o?[t,a]:[a,t]);return new Tk(e,1<<s|1<<o,l)}function aqe(t,e,n,r){t||(t=new Hde);let i=new Ug(t,cg(n),[n,r]);for(let s=0;s<e.length;s++){const o=e[s];i=i.update(t,0,void 0,o[0],o[1])}return i}function lqe(t,e,n,r){let i=0,s=0;const o=new Array(n);for(let a=0,l=1,c=e.length;a<c;a++,l<<=1){const u=e[a];u!==void 0&&a!==r&&(i|=l,o[s++]=u)}return new Tk(t,i,o)}function cqe(t,e,n,r,i){let s=0;const o=new Array(TS);for(let a=0;n!==0;a++,n>>>=1)o[a]=n&1?e[s++]:void 0;return o[r]=i,new eU(t,s+1,o)}function mZ(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,t&127}function Kde(t,e,n,r){const i=r?t:Jz(t);return i[e]=n,i}function uqe(t,e,n,r){const i=t.length+1;if(r&&e+1===i)return t[e]=n,t;const s=new Array(i);let o=0;for(let a=0;a<i;a++)a===e?(s[a]=n,o=-1):s[a]=t[a+o];return s}function dqe(t,e,n){const r=t.length-1;if(n&&e===r)return t.pop(),t;const i=new Array(r);let s=0;for(let o=0;o<r;o++)o===e&&(s=1),i[o]=t[o+s];return i}const hqe=TS/4,fqe=TS/2,pqe=TS/4;var Dre,Rre;class F3{constructor(e,n){N(this,"atoms");N(this,Dre,"AtomMap");this.name=e;let r=uy();n&&(r=r.withMutations(i=>{for(const[s,o]of n)i.set(s,lr(`${e}:${String(s)}`,o))})),this.atoms=lr(`${e}:atoms`,r)}getAtom(e){const n=this.atoms.__unsafe__getWithoutCapture().get(e);if(!n){this.atoms.get();return}return n}get(e){var r;const n=(r=this.getAtom(e))==null?void 0:r.get();return it(n!==Cs),n}__unsafe__getWithoutCapture(e){const n=this.atoms.__unsafe__getWithoutCapture().get(e);if(!n)return;const r=n.__unsafe__getWithoutCapture();return it(r!==Cs),r}has(e){const n=this.getAtom(e);return n?n.get()!==Cs:!1}__unsafe__hasWithoutCapture(e){const n=this.atoms.__unsafe__getWithoutCapture().get(e);return n?(it(n.__unsafe__getWithoutCapture()!==Cs),!0):!1}set(e,n){const r=this.atoms.__unsafe__getWithoutCapture().get(e);return r?r.set(n):this.atoms.update(i=>i.set(e,lr(`${this.name}:${String(e)}`,n))),this}update(e,n){const r=this.atoms.__unsafe__getWithoutCapture().get(e);if(!r)throw new Error(`AtomMap: key ${e} not found`);const i=r.__unsafe__getWithoutCapture();it(i!==Cs),r.set(n(i))}delete(e){const n=this.atoms.__unsafe__getWithoutCapture().get(e);return n?(Oa(()=>{n.set(Cs),this.atoms.update(r=>r.delete(e))}),!0):!1}deleteMany(e){return Oa(()=>{const n=[],r=this.atoms.get().withMutations(i=>{for(const s of e){const o=i.get(s);if(!o)continue;const a=o.get();it(a!==Cs),n.push([s,a]),i.delete(s),o.set(Cs)}});return n.length&&this.atoms.set(r),n})}clear(){return Oa(()=>{for(const e of this.atoms.__unsafe__getWithoutCapture().values())e.set(Cs);this.atoms.set(uy())})}*entries(){for(const[e,n]of this.atoms.get()){const r=n.get();it(r!==Cs),yield[e,r]}}*keys(){for(const e of this.atoms.get().keys())yield e}*values(){for(const e of this.atoms.get().values()){const n=e.get();it(n!==Cs),yield n}}get size(){return this.atoms.get().size}forEach(e,n){for(const[r,i]of this.entries())e.call(n,i,r,this)}[(Rre=Symbol.iterator,Dre=Symbol.toStringTag,Rre)](){return this.entries()}}class HE{constructor(e){N(this,"nextValue");N(this,"diff");this.previousValue=e}get(){var r,i,s,o;const e=((i=(r=this.diff)==null?void 0:r.removed)==null?void 0:i.size)??0,n=((o=(s=this.diff)==null?void 0:s.added)==null?void 0:o.size)??0;if(!(e===0&&n===0))return{value:this.nextValue,diff:this.diff}}_add(e,n){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),n?(r=this.diff.removed)==null||r.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var i,s,o;const n=this.previousValue.has(e);if(n)return((s=(i=this.diff)==null?void 0:i.removed)==null?void 0:s.has(e))?this._add(e,n):void 0;(o=this.nextValue)!=null&&o.has(e)||this._add(e,n)}_remove(e,n){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),n?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(i=this.diff.added)==null||i.delete(e)}remove(e){var i,s,o,a;const n=this.previousValue.has(e);if(!n)return((s=(i=this.diff)==null?void 0:i.added)==null?void 0:s.has(e))?this._remove(e,n):void 0;(a=(o=this.diff)==null?void 0:o.removed)!=null&&a.has(e)||this._remove(e,n)}}function gqe(t){const e=[];for(let n=t.length-1;n>=0;n--){const r=t[n];if("id"in r)e.unshift(r);else{const i=r.dependsOn,s=e[0];s&&(e[0]={...s,dependsOn:i.concat(s.dependsOn??[])})}}return e}function dy({sequence:t,sequenceId:e,retroactive:n=!0}){const r={sequenceId:e,retroactive:n,sequence:gqe(t)};return qde(r),r}function ea(t,e){return Object.fromEntries(ho(e).map(([n,r])=>[n,`${t}/${r}`]))}function Ha(t){const e=t.sequenceId;return dy({sequenceId:e,retroactive:t.retroactive??!0,sequence:t.sequence.map(n=>"id"in n?{...n,scope:"record",filter:r=>{var i,s;return r.typeName===t.recordType&&(((i=n.filter)==null?void 0:i.call(n,r))??!0)&&(((s=t.filter)==null?void 0:s.call(t,r))??!0)}}:n)})}function mqe(t){const e=new Map(t.map(s=>[s.id,s])),n=new Set,r=[];function i(s){it(!n.has(s.id),`Circular dependency in migrations: ${s.id}`),n.add(s.id);const{version:o,sequenceId:a}=NI(s.id),l=e.get(`${a}/${o-1}`);if(l&&i(l),s.dependsOn)for(const c of s.dependsOn){const u=e.get(c);u&&i(u)}e.delete(s.id),r.push(s)}for(const s of e.values())i(s);return r}function NI(t){const[e,n]=t.split("/");return{sequenceId:e,version:parseInt(n)}}function yZ(t,e){e&&it(t.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${t}'`),it(t.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${t}'`)}function qde(t){if(it(!t.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${t.sequenceId}`),it(t.sequenceId.length,"sequenceId must be a non-empty string"),t.sequence.length===0)return;yZ(t.sequence[0].id,t.sequenceId);let e=NI(t.sequence[0].id).version;it(e===1,`Expected the first migrationId to be '${t.sequenceId}/1' but got '${t.sequence[0].id}'`);for(let n=1;n<t.sequence.length;n++){const r=t.sequence[n].id;yZ(r,t.sequenceId);const i=NI(r).version;it(i===e+1,`Migration id numbers must increase in increments of 1, expected ${t.sequenceId}/${e+1} but got '${t.sequence[n].id}'`),e=i}}var Ph=(t=>(t.IncompatibleSubtype="incompatible-subtype",t.UnknownType="unknown-type",t.TargetVersionTooNew="target-version-too-new",t.TargetVersionTooOld="target-version-too-old",t.MigrationError="migration-error",t.UnrecognizedSubtype="unrecognized-subtype",t))(Ph||{});function jI(){return{added:{},updated:{},removed:{}}}function $3(t){const e={added:t.removed,removed:t.added,updated:{}};for(const[n,r]of Object.values(t.updated))e.updated[n.id]=[r,n];return e}function Gde(t){return Object.keys(t.added).length===0&&Object.keys(t.updated).length===0&&Object.keys(t.removed).length===0}function iU(t){const e={added:{},removed:{},updated:{}};return ax(e,t),e}function ax(t,e){for(const n of e){for(const[r,i]of ho(n.added))if(t.removed[r]){const s=t.removed[r];delete t.removed[r],s!==i&&(t.updated[r]=[s,i])}else t.added[r]=i;for(const[r,[i,s]]of ho(n.updated)){if(t.added[r]){t.added[r]=s,delete t.updated[r],delete t.removed[r];continue}if(t.updated[r]){t.updated[r]=[t.updated[r][0],s],delete t.removed[r];continue}t.updated[r]=n.updated[r],delete t.removed[r]}for(const[r,i]of ho(n.removed))t.added[r]?delete t.added[r]:t.updated[r]?(t.removed[r]=t.updated[r][0],delete t.updated[r]):t.removed[r]=i}}class Pk{constructor(e,n){N(this,"createDefaultProperties");N(this,"validator");N(this,"ephemeralKeys");N(this,"ephemeralKeySet");N(this,"scope");this.typeName=e,this.createDefaultProperties=n.createDefaultProperties,this.validator=n.validator??{validate:i=>i},this.scope=n.scope??"document",this.ephemeralKeys=n.ephemeralKeys;const r=new Set;if(n.ephemeralKeys)for(const[i,s]of ho(n.ephemeralKeys))s&&r.add(i);this.ephemeralKeySet=r}create(e){const n={...this.createDefaultProperties(),id:"id"in e?e.id:this.createId()};for(const[r,i]of Object.entries(e))i!==void 0&&(n[r]=i);return n.typeName=this.typeName,n}clone(e){return{...ar(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??fn())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return(e==null?void 0:e.typeName)===this.typeName}isId(e){if(!e)return!1;for(let n=0;n<this.typeName.length;n++)if(e[n]!==this.typeName[n])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new Pk(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,n){return n&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(n,e):this.validator.validate(e)}}function Iu(t,e){return new Pk(t,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function yqe(t){if(t.length===0)return new Set;const e=t[0],n=t.slice(1),r=new Set;for(const i of e)n.every(s=>s.has(i))&&r.add(i);return r}function vqe(t,e){const n={};for(const r of e)t.has(r)||(n.added??(n.added=new Set),n.added.add(r));for(const r of t)e.has(r)||(n.removed??(n.removed=new Set),n.removed.add(r));return n.added||n.removed?n:void 0}function vZ(t,e){for(const[n,r]of Object.entries(t)){const i=r,s=e[n];if("eq"in i&&s!==i.eq||"neq"in i&&s===i.neq||"gt"in i&&(typeof s!="number"||s<=i.gt))return!1}return!0}function bZ(t,e,n){const r=Object.fromEntries(Object.keys(n).map(i=>[i,new Set]));for(const[i,s]of Object.entries(n))if("eq"in s){const a=t.index(e,i).get().get(s.eq);if(a)for(const l of a)r[i].add(l)}else if("neq"in s){const o=t.index(e,i);for(const[a,l]of o.get())if(a!==s.neq)for(const c of l)r[i].add(c)}else if("gt"in s){const o=t.index(e,i);for(const[a,l]of o.get())if(a>s.gt)for(const c of l)r[i].add(c)}return yqe(Object.values(r))}class bqe{constructor(e,n){N(this,"indexCache",new Map);N(this,"historyCache",new Map);this.recordMap=e,this.history=n}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const n=me("filterHistory:"+e,(r,i)=>{if(Hp(r))return this.history.get();const s=this.history.getDiffSince(i);if(s===Aa)return this.history.get();const o={added:{},removed:{},updated:{}};let a=0,l=0,c=0;for(const u of s){for(const d of yr(u.added))if(d.typeName===e)if(o.removed[d.id]){const h=o.removed[d.id];delete o.removed[d.id],l--,h!==d&&(o.updated[d.id]=[h,d],c++)}else o.added[d.id]=d,a++;for(const[d,h]of yr(u.updated))h.typeName===e&&(o.added[h.id]?o.added[h.id]=h:o.updated[h.id]?o.updated[h.id]=[o.updated[h.id][0],h]:(o.updated[h.id]=[d,h],c++));for(const d of yr(u.removed))d.typeName===e&&(o.added[d.id]?(delete o.added[d.id],a--):o.updated[d.id]?(o.removed[d.id]=o.updated[d.id][0],delete o.updated[d.id],c--,l++):(o.removed[d.id]=d,l++))}return a||l||c?_b(this.history.get(),o):r},{historyLength:100});return this.historyCache.set(e,n),n}index(e,n){const r=e+":"+n;if(this.indexCache.has(r))return this.indexCache.get(r);const i=this.__uncached_createIndex(e,n);return this.indexCache.set(r,i),i}__uncached_createIndex(e,n){const r=this.filterHistory(e),i=()=>{r.get();const s=new Map;for(const o of this.recordMap.values())if(o.typeName===e){const a=o[n];s.has(a)||s.set(a,new Set),s.get(a).add(o.id)}return s};return me("index:"+e+":"+n,(s,o)=>{if(Hp(s))return i();const a=r.getDiffSince(o);if(a===Aa)return i();const l=new Map,c=(f,y)=>{let b=l.get(f);b||(b=new HE(s.get(f)??new Set)),b.add(y),l.set(f,b)},u=(f,y)=>{let b=l.get(f);b||(b=new HE(s.get(f)??new Set)),b.remove(y),l.set(f,b)};for(const f of a){for(const y of yr(f.added))if(y.typeName===e){const b=y[n];c(b,y.id)}for(const[y,b]of yr(f.updated))if(b.typeName===e){const v=y[n],x=b[n];v!==x&&(u(v,b.id),c(x,b.id))}for(const y of yr(f.removed))if(y.typeName===e){const b=y[n];u(b,y.id)}}let d,h;for(const[f,y]of l){const b=y.get();b&&(d||(d=new Map(s)),h||(h=new Map),b.value.size===0?d.delete(f):d.set(f,b.value),h.set(f,b.diff))}return d&&h?_b(d,h):s},{historyLength:100})}record(e,n=()=>({}),r="record:"+e+(n?":"+n.toString():"")){const i=this.ids(e,n,r);return me(r,()=>{for(const s of i.get())return this.recordMap.get(s)})}records(e,n=()=>({}),r="records:"+e+(n?":"+n.toString():"")){const i=this.ids(e,n,"ids:"+r);return me(r,()=>Array.from(i.get(),s=>this.recordMap.get(s)),{isEqual:kI})}ids(e,n=()=>({}),r="ids:"+e+(n?":"+n.toString():"")){const i=this.filterHistory(e),s=()=>{i.get();const l=n();if(Object.keys(l).length===0){const c=new Set;for(const u of this.recordMap.values())u.typeName===e&&c.add(u.id);return c}return bZ(this,e,l)},o=l=>{const c=s(),u=vqe(l,c);return u?_b(c,u):l},a=me("ids_query:"+r,n,{isEqual:Af});return me("query:"+r,(l,c)=>{const u=a.get();if(Hp(l))return s();if(c<a.lastChangedEpoch)return o(l);const d=i.getDiffSince(c);if(d===Aa)return o(l);const h=new HE(l);for(const y of d){for(const b of yr(y.added))b.typeName===e&&vZ(u,b)&&h.add(b.id);for(const[b,v]of yr(y.updated))v.typeName===e&&(vZ(u,v)?h.add(v.id):h.remove(v.id));for(const b of yr(y.removed))b.typeName===e&&h.remove(b.id)}const f=h.get();return f?_b(f.value,f.diff):l},{historyLength:50})}exec(e,n){const r=bZ(this,e,n);return r.size===0?Mr:Array.from(r,i=>this.recordMap.get(i))}}class xqe{constructor(e){N(this,"_beforeCreateHandlers",{});N(this,"_afterCreateHandlers",{});N(this,"_beforeChangeHandlers",{});N(this,"_afterChangeHandlers",{});N(this,"_beforeDeleteHandlers",{});N(this,"_afterDeleteHandlers",{});N(this,"_operationCompleteHandlers",[]);N(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,n){if(!this._isEnabled)return e;const r=this._beforeCreateHandlers[e.typeName];if(r){let i=e;for(const s of r)i=s(i,n);return i}return e}handleAfterCreate(e,n){if(!this._isEnabled)return;const r=this._afterCreateHandlers[e.typeName];if(r)for(const i of r)i(e,n)}handleBeforeChange(e,n,r){if(!this._isEnabled)return n;const i=this._beforeChangeHandlers[n.typeName];if(i){let s=n;for(const o of i)s=o(e,s,r);return s}return n}handleAfterChange(e,n,r){if(!this._isEnabled)return;const i=this._afterChangeHandlers[n.typeName];if(i)for(const s of i)s(e,n,r)}handleBeforeDelete(e,n){if(!this._isEnabled)return!0;const r=this._beforeDeleteHandlers[e.typeName];if(r){for(const i of r)if(i(e,n)===!1)return!1}return!0}handleAfterDelete(e,n){if(!this._isEnabled)return;const r=this._afterDeleteHandlers[e.typeName];if(r)for(const i of r)i(e,n)}handleOperationComplete(e){if(this._isEnabled)for(const n of this._operationCompleteHandlers)n(e)}register(e){const n=[];for(const[r,i]of Object.entries(e))i!=null&&i.beforeCreate&&n.push(this.registerBeforeCreateHandler(r,i.beforeCreate)),i!=null&&i.afterCreate&&n.push(this.registerAfterCreateHandler(r,i.afterCreate)),i!=null&&i.beforeChange&&n.push(this.registerBeforeChangeHandler(r,i.beforeChange)),i!=null&&i.afterChange&&n.push(this.registerAfterChangeHandler(r,i.afterChange)),i!=null&&i.beforeDelete&&n.push(this.registerBeforeDeleteHandler(r,i.beforeDelete)),i!=null&&i.afterDelete&&n.push(this.registerAfterDeleteHandler(r,i.afterDelete));return()=>{for(const r of n)r()}}registerBeforeCreateHandler(e,n){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(n),()=>hp(this._beforeCreateHandlers[e],n)}registerAfterCreateHandler(e,n){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(n),()=>hp(this._afterCreateHandlers[e],n)}registerBeforeChangeHandler(e,n){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(n),()=>hp(this._beforeChangeHandlers[e],n)}registerAfterChangeHandler(e,n){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(n),()=>hp(this._afterChangeHandlers[e],n)}registerBeforeDeleteHandler(e,n){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(n),()=>hp(this._beforeDeleteHandlers[e],n)}registerAfterDeleteHandler(e,n){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(n),()=>hp(this._afterDeleteHandlers[e],n)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>hp(this._operationCompleteHandlers,e)}}function hp(t,e){const n=t.indexOf(e);n>=0&&t.splice(n,1)}class sU{constructor(e){N(this,"id");N(this,"records");N(this,"history",lr("history",0,{historyLength:1e3}));N(this,"query");N(this,"listeners",new Set);N(this,"historyAccumulator",new Sqe);N(this,"historyReactor");N(this,"schema");N(this,"props");N(this,"scopedTypes");N(this,"sideEffects",new xqe(this));N(this,"isMergingRemoteChanges",!1);N(this,"_integrityChecker");N(this,"_isPossiblyCorrupted",!1);N(this,"pendingAfterEvents",null);N(this,"_isInAtomicOp",!1);const{initialData:n,schema:r,id:i}=e;this.id=i??fn(),this.schema=r,this.props=e.props,n?this.records=new F3("store",ho(n).map(([s,o])=>[s,this.schema.validateRecord(this,o,"initialize",null)])):this.records=new F3("store"),this.query=new bqe(this.records,this.history),this.historyReactor=AKe("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:s=>this.cancelHistoryReactor=Nz(s)}),this.scopedTypes={document:new Set(yr(this.schema.types).filter(s=>s.scope==="document").map(s=>s.typeName)),session:new Set(yr(this.schema.types).filter(s=>s.scope==="session").map(s=>s.typeName)),presence:new Set(yr(this.schema.types).filter(s=>s.scope==="presence").map(s=>s.typeName))}}cancelHistoryReactor(){}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:n,source:r}of e){let i=null,s=null,o=null;for(const{onHistory:a,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==r))if(l.scope!=="all")if(l.scope==="document"){if(s??(s=this.filterChangesByScope(n,"document")),!s)continue;a({changes:s,source:r})}else if(l.scope==="session"){if(i??(i=this.filterChangesByScope(n,"session")),!i)continue;a({changes:i,source:r})}else{if(o??(o=this.filterChangesByScope(n,"presence")),!o)continue;a({changes:o,source:r})}else a({changes:n,source:r})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,n){const r={added:ox(e.added,(i,s)=>this.scopedTypes[n].has(s.typeName)),updated:ox(e.updated,(i,s)=>this.scopedTypes[n].has(s[1].typeName)),removed:ox(e.removed,(i,s)=>this.scopedTypes[n].has(s.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(n=>this.schema.validateRecord(this,n,e,null))}put(e,n){this.atomic(()=>{const r={},i={};let s,o=!1;const a=this.isMergingRemoteChanges?"remote":"user";for(let l=0,c=e.length;l<c;l++){s=e[l];const u=this.records.__unsafe__getWithoutCapture(s.id);if(u){if(s=this.sideEffects.handleBeforeChange(u,s,a),this.schema.validateRecord(this,s,n??"updateRecord",u)===u)continue;s=s,this.records.set(s.id,s),o=!0,r[s.id]=[u,s],this.addDiffForAfterEvent(u,s)}else s=this.sideEffects.handleBeforeCreate(s,a),o=!0,s=this.schema.validateRecord(this,s,n??"createRecord",null),s=s,i[s.id]=s,this.addDiffForAfterEvent(null,s),this.records.set(s.id,s)}o&&this.updateHistory({added:i,updated:r,removed:{}})})}remove(e){this.atomic(()=>{const n=new Set(e),r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const o of e){const a=this.records.__unsafe__getWithoutCapture(o);a&&this.sideEffects.handleBeforeDelete(a,r)===!1&&n.delete(o)}const i=this.records.deleteMany(n);if(i.length===0)return;const s={};for(const[o,a]of i)s[o]=a,this.addDiffForAfterEvent(a,null);this.updateHistory({added:{},updated:{},removed:s})})}get(e){return this.records.get(e)}unsafeGetWithoutCapture(e){return this.records.__unsafe__getWithoutCapture(e)}serialize(e="document"){const n={};for(const[r,i]of this.records)(e==="all"||this.scopedTypes[e].has(i.typeName))&&(n[r]=i);return n}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);return{store:n.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);const r=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(n.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(r)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords(){return Array.from(this.records.values())}clear(){this.remove(Array.from(this.records.keys()))}update(e,n){const r=this.unsafeGetWithoutCapture(e);if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([n(r)])}has(e){return this.records.has(e)}listen(e,n){this._flushHistory();const r={onHistory:e,filters:{source:(n==null?void 0:n.source)??"all",scope:(n==null?void 0:n.scope)??"all"}};return this.historyReactor.scheduler.isActivelyListening||(this.historyReactor.start(),this.historyReactor.scheduler.execute()),this.listeners.add(r),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}}mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.atomic(e,!0,!0)}finally{this.ensureStoreIsUsable()}}extractingChanges(e){const n=[],r=this.historyAccumulator.addInterceptor(i=>n.push(i.changes));try{return Oa(e),iU(n)}finally{r()}}applyDiff(e,{runCallbacks:n=!0,ignoreEphemeralKeys:r=!1}={}){this.atomic(()=>{const i=yr(e.added);for(const[o,a]of yr(e.updated)){const l=this.schema.getType(a.typeName);if(r&&l.ephemeralKeySet.size){const c=this.get(a.id);if(!c){i.push(a);continue}let u=null;for(const[d,h]of Object.entries(a))l.ephemeralKeySet.has(d)||Object.is(h,Ar(c,d))||(u||(u={...c}),u[d]=h);u&&i.push(u)}else i.push(a)}const s=sx(e.removed);i.length&&this.put(i),s.length&&this.remove(s)},n)}createCache(e){const n=new zs;return{get:r=>{const i=this.records.getAtom(r);if(i)return n.get(i,()=>e(r,i)).get()}}}createComputedCache(e,n,r){return this.createCache((i,s)=>{const o=r!=null&&r.areRecordsEqual?me(`${e}:${i}:isEqual`,()=>s.get(),{isEqual:r.areRecordsEqual}):s;return me(e+":"+i,()=>n(o.get()),{isEqual:r==null?void 0:r.areResultsEqual})})}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,n){if(it(this.pendingAfterEvents,"must be in event operation"),e===n||(e&&n&&it(e.id===n.id),!e&&!n))return;const r=(e||n).id,i=this.pendingAfterEvents.get(r);i?i.after=n:this.pendingAfterEvents.set(r,{before:e,after:n})}flushAtomicCallbacks(e){let n=0,r=e?"remote":"user";for(;this.pendingAfterEvents;){const i=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(n++,n>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:s,after:o}of i.values())s&&o&&s!==o&&!Af(s,o)?this.sideEffects.handleAfterChange(s,o,r):s&&!o?this.sideEffects.handleAfterDelete(s,r):!s&&o&&this.sideEffects.handleAfterCreate(o,r);this.pendingAfterEvents?r="user":this.sideEffects.handleOperationComplete(r)}}}atomic(e,n=!0,r=!1){return Oa(()=>{if(this._isInAtomicOp){this.pendingAfterEvents||(this.pendingAfterEvents=new Map);const s=this.sideEffects.isEnabled();it(!r,"cannot call mergeRemoteChanges while in atomic operation");try{return s&&!n&&this.sideEffects.setIsEnabled(!1),e()}finally{this.sideEffects.setIsEnabled(s)}}this.pendingAfterEvents=new Map;const i=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(n??i),this._isInAtomicOp=!0,r&&(this.isMergingRemoteChanges=!0);try{const s=e();return this.isMergingRemoteChanges=!1,this.flushAtomicCallbacks(r),s}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(i),this._isInAtomicOp=!1,this.isMergingRemoteChanges=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(n=>e(n,this.isMergingRemoteChanges?"remote":"user"))}}function wqe(t){if(t.length===0)return[];const e=[];let n=[t[0]],r;for(let i=1,s=t.length;i<s;i++)r=t[i],n[0].source!==r.source&&(e.push(n),n=[]),n.push(r);return e.push(n),e.map(i=>({source:i[0].source,changes:iU(i.map(s=>s.changes))}))}class Sqe{constructor(){N(this,"_history",[]);N(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const n of this._interceptors)n(e)}flush(){const e=wqe(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function _k(t,e,n){const r=new zs;return{get(i,s){return r.get(i,()=>(i instanceof sU?i:i.store).createComputedCache(t,l=>e(i,l),n)).get(s)}}}function Cqe(t){if(t.schemaVersion>2||t.schemaVersion<1)return sf.err("Bad schema version");if(t.schemaVersion===2)return sf.ok(t);const e={schemaVersion:2,sequences:{"com.tldraw.store":t.storeVersion}};for(const[n,r]of Object.entries(t.recordVersions))if(e.sequences[`com.tldraw.${n}`]=r.version,"subTypeKey"in r)for(const[i,s]of Object.entries(r.subTypeVersions))e.sequences[`com.tldraw.${n}.${i}`]=s;return sf.ok(e)}class oU{constructor(e,n){N(this,"migrations",{});N(this,"sortedMigrations");var i;this.types=e,this.options=n;for(const s of n.migrations??[])it(!this.migrations[s.sequenceId],`Duplicate migration sequenceId ${s.sequenceId}`),qde(s),this.migrations[s.sequenceId]=s;const r=Object.values(this.migrations).flatMap(s=>s.sequence);this.sortedMigrations=mqe(r);for(const s of this.sortedMigrations)if((i=s.dependsOn)!=null&&i.length)for(const o of s.dependsOn){const a=r.find(l=>l.id===o);it(a,`Migration '${s.id}' depends on missing migration '${o}'`)}}static create(e,n){return new oU(e,n??{})}validateRecord(e,n,r,i){try{const s=Ar(this.types,n.typeName);if(!s)throw new Error(`Missing definition for record type ${n.typeName}`);return s.validate(n,i??void 0)}catch(s){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:n,phase:r,recordBefore:i,error:s});throw s}}getMigrationsSince(e){const n=Cqe(e);if(!n.ok)return n;const r=n.value,i=new Set(Object.keys(r.sequences).filter(o=>this.migrations[o]));for(const o in this.migrations)r.sequences[o]===void 0&&this.migrations[o].retroactive&&i.add(o);if(i.size===0)return sf.ok([]);const s=new Set;for(const o of i){const a=r.sequences[o];if(typeof a!="number"&&this.migrations[o].retroactive||a===0){for(const u of this.migrations[o].sequence)s.add(u.id);continue}const l=`${o}/${a}`,c=this.migrations[o].sequence.findIndex(u=>u.id===l);if(c===-1)return sf.err("Incompatible schema?");for(const u of this.migrations[o].sequence.slice(c+1))s.add(u.id)}return sf.ok(this.sortedMigrations.filter(({id:o})=>s.has(o)))}migratePersistedRecord(e,n,r="up"){const i=this.getMigrationsSince(n);if(!i.ok)return console.error("Error migrating record",i.error),{type:"error",reason:Ph.MigrationError};let s=i.value;if(s.length===0)return{type:"success",value:e};if(s.some(o=>o.scope==="store"))return{type:"error",reason:r==="down"?Ph.TargetVersionTooOld:Ph.TargetVersionTooNew};if(r==="down"){if(!s.every(o=>o.down))return{type:"error",reason:Ph.TargetVersionTooOld};s=s.slice().reverse()}e=ar(e);try{for(const o of s){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(e):!0))continue;const l=o[r](e);l&&(e=ar(l))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:Ph.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:n}=e;const r=this.getMigrationsSince(e.schema);if(!r.ok)return console.error("Error migrating store",r.error),{type:"error",reason:Ph.MigrationError};const i=r.value;if(i.length===0)return{type:"success",value:n};n=ar(n);try{for(const s of i)if(s.scope==="record")for(const[o,a]of Object.entries(n)){if(!(s.filter?s.filter(a):!0))continue;const c=s.up(a);c&&(n[o]=ar(c))}else if(s.scope==="store"){const o=s.up(n);o&&(n=ar(o))}else Yt(s)}catch(s){return console.error("Error migrating store",s),{type:"error",reason:Ph.MigrationError}}return{type:"success",value:n}}createIntegrityChecker(e){var n,r;return((r=(n=this.options).createIntegrityChecker)==null?void 0:r.call(n,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:n})=>[e,n.length?NI(n.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const n=Ar(this.types,e);return it(n,"record type does not exists"),n}}Fd("@tldraw/store","3.15.3","esm");function Eqe(t){if(!t.length)return null;let e="";for(const n of t)typeof n=="number"?e+=`.${n}`:n.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${n.slice(1)}`:e+=n:e+=`.${n}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class Zt extends Error{constructor(n,r=[]){const i=Eqe(r),s=n.split(`
`).map((o,a)=>a===0?o:`  ${o}`).join(`
`);super(r?`At ${i}: ${s}`:s);N(this,"name","ValidationError");this.rawMessage=n,this.path=r}}function Zo(t,e){try{return e()}catch(n){throw n instanceof Zt?new Zt(n.rawMessage,[t,...n.path]):new Zt(n.toString(),[t])}}function ff(t){if(t===null)return"null";if(Array.isArray(t))return"an array";const e=typeof t;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:Yt(e)}}class Vs{constructor(e,n){this.validationFn=e,this.validateUsingKnownGoodVersionFn=n}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,n){return Object.is(e,n)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,n):this.validate(n)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return Mqe(this)}optional(){return Xde(this)}refine(e){return new Vs(n=>e(this.validate(n)),(n,r)=>{const i=this.validateUsingKnownGoodVersion(n,r);return Object.is(n,i)?n:e(i)})}check(e,n){return typeof e=="string"?this.refine(r=>(Zo(`(check ${e})`,()=>n(r)),r)):this.refine(r=>(e(r),r))}}class Tqe extends Vs{constructor(e){super(n=>{const r=xZ.validate(n);for(let i=0;i<r.length;i++)Zo(i,()=>e.validate(r[i]));return r},(n,r)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(r);const i=xZ.validate(r);let s=n.length!==i.length;for(let o=0;o<i.length;o++){const a=i[o];if(o>=n.length){s=!0,Zo(o,()=>e.validate(a));continue}if(Object.is(n[o],a))continue;const l=Zo(o,()=>e.validateUsingKnownGoodVersion(n[o],a));Object.is(l,n[o])||(s=!0)}return s?r:n}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Zt("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Zt("Expected an array with length greater than 1")})}}class LI extends Vs{constructor(e,n=!1){super(r=>{if(typeof r!="object"||r===null)throw new Zt(`Expected object, got ${ff(r)}`);for(const[i,s]of Object.entries(e))Zo(i,()=>{s.validate(Ar(r,i))});if(!n){for(const i of Object.keys(r))if(!Il(e,i))throw new Zt("Unexpected property",[i])}return r},(r,i)=>{if(typeof i!="object"||i===null)throw new Zt(`Expected object, got ${ff(i)}`);let s=!1;for(const[o,a]of Object.entries(e)){const l=Ar(r,o),c=Ar(i,o);if(Object.is(l,c))continue;const u=Zo(o,()=>{const d=a;return d.validateUsingKnownGoodVersion?d.validateUsingKnownGoodVersion(l,c):d.validate(c)});Object.is(u,l)||(s=!0)}if(!n){for(const o of Object.keys(i))if(!Il(e,o))throw new Zt("Unexpected property",[o])}for(const o of Object.keys(r))if(!Il(i,o)){s=!0;break}return s?i:r}),this.config=e,this.shouldAllowUnknownProperties=n}allowUnknownProperties(){return new LI(this.config,!0)}extend(e){return new LI({...this.config,...e})}}class kk extends Vs{constructor(e,n,r,i){super(s=>{this.expectObject(s);const{matchingSchema:o,variant:a}=this.getMatchingSchemaAndVariant(s);return o===void 0?this.unknownValueValidation(s,a):Zo(`(${e} = ${a})`,()=>o.validate(s))},(s,o)=>{this.expectObject(o),this.expectObject(s);const{matchingSchema:a,variant:l}=this.getMatchingSchemaAndVariant(o);return a===void 0?this.unknownValueValidation(o,l):Ar(s,e)!==Ar(o,e)?Zo(`(${e} = ${l})`,()=>a.validate(o)):Zo(`(${e} = ${l})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(s,o):a.validate(o))}),this.key=e,this.config=n,this.unknownValueValidation=r,this.useNumberKeys=i}expectObject(e){if(typeof e!="object"||e===null)throw new Zt(`Expected an object, got ${ff(e)}`,[])}getMatchingSchemaAndVariant(e){const n=Ar(e,this.key);if(!this.useNumberKeys&&typeof n!="string")throw new Zt(`Expected a string for key "${this.key}", got ${ff(n)}`);if(this.useNumberKeys&&!Number.isFinite(Number(n)))throw new Zt(`Expected a number for key "${this.key}", got "${n}"`);return{matchingSchema:Il(this.config,n)?this.config[n]:void 0,variant:n}}validateUnknownVariants(e){return new kk(this.key,this.config,e,this.useNumberKeys)}}class Iqe extends Vs{constructor(e,n){super(r=>{if(typeof r!="object"||r===null)throw new Zt(`Expected object, got ${ff(r)}`);for(const[i,s]of Object.entries(r))Zo(i,()=>{e.validate(i),n.validate(s)});return r},(r,i)=>{if(typeof i!="object"||i===null)throw new Zt(`Expected object, got ${ff(i)}`);let s=!1;for(const[o,a]of Object.entries(i)){if(!Il(r,o)){s=!0,Zo(o,()=>{e.validate(o),n.validate(a)});continue}const l=Ar(r,o),c=a;if(Object.is(l,c))continue;const u=Zo(o,()=>n.validateUsingKnownGoodVersion?n.validateUsingKnownGoodVersion(l,c):n.validate(c));Object.is(u,l)||(s=!0)}for(const o of Object.keys(r))if(!Il(i,o)){s=!0;break}return s?i:r}),this.keyValidator=e,this.valueValidator=n}}function aU(t){return new Vs(e=>{if(typeof e!==t)throw new Zt(`Expected ${t}, got ${ff(e)}`);return e})}const Pqe=new Vs(t=>t),_qe=new Vs(t=>t),Rt=aU("string"),yt=aU("number").check(t=>{if(Number.isNaN(t))throw new Zt("Expected a number, got NaN");if(!Number.isFinite(t))throw new Zt(`Expected a finite number, got ${t}`)}),FI=yt.check(t=>{if(t<0)throw new Zt(`Expected a positive number, got ${t}`)}),Rr=yt.check(t=>{if(t<=0)throw new Zt(`Expected a non-zero positive number, got ${t}`)}),Yde=yt.check(t=>{if(!Number.isInteger(t))throw new Zt(`Expected an integer, got ${t}`)}),VE=Yde.check(t=>{if(t<0)throw new Zt(`Expected a positive integer, got ${t}`)}),kqe=Yde.check(t=>{if(t<=0)throw new Zt(`Expected a non-zero positive integer, got ${t}`)}),Ft=aU("boolean");function Fs(t){return new Vs(e=>{if(e!==t)throw new Zt(`Expected ${t}, got ${JSON.stringify(e)}`);return t})}const xZ=new Vs(t=>{if(!Array.isArray(t))throw new Zt(`Expected an array, got ${ff(t)}`);return t});function Si(t){return new Tqe(t)}function Vt(t){return new LI(t)}function B3(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null||Object.getPrototypeOf(t)===PWe)}function z3(t){return t===null||typeof t=="number"||typeof t=="string"||typeof t=="boolean"?!0:Array.isArray(t)?t.every(z3):B3(t)?Object.values(t).every(z3):!1}const ts=new Vs(t=>{if(z3(t))return t;throw new Zt(`Expected json serializable value, got ${typeof t}`)},(t,e)=>{if(Array.isArray(t)&&Array.isArray(e)){let n=t.length!==e.length;for(let r=0;r<e.length;r++){if(r>=t.length){n=!0,ts.validate(e[r]);continue}const i=t[r],s=e[r];if(Object.is(i,s))continue;const o=ts.validateUsingKnownGoodVersion(i,s);Object.is(o,i)||(n=!0)}return n?e:t}else if(B3(t)&&B3(e)){let n=!1;for(const r of Object.keys(e)){if(!Il(t,r)){n=!0,ts.validate(e[r]);continue}const i=t[r],s=e[r];if(Object.is(i,s))continue;const o=ts.validateUsingKnownGoodVersion(i,s);Object.is(o,i)||(n=!0)}for(const r of Object.keys(t))if(!Il(e,r)){n=!0;break}return n?e:t}else return ts.validate(e)});function $I(t,e){return new Iqe(t,e)}function lU(t,e){return new kk(t,e,(n,r)=>{throw new Zt(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[t])},!1)}function Aqe(t,e){return new kk(t,e,(n,r)=>{throw new Zt(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[t])},!0)}function Pu(t,e){return new Vs(n=>Zo(t,()=>e.validate(n)),(n,r)=>Zo(t,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(n,r):e.validate(r)))}function Ak(t){return new Vs(e=>{if(!t.has(e)){const n=Array.from(t,r=>JSON.stringify(r)).join(" or ");throw new Zt(`Expected ${n}, got ${e}`)}return e})}function Xde(t){return new Vs(e=>{if(e!==void 0)return t.validate(e)},(e,n)=>{if(!(e===void 0&&n===void 0)&&n!==void 0)return t.validateUsingKnownGoodVersion&&e!==void 0?t.validateUsingKnownGoodVersion(e,n):t.validate(n)})}function Mqe(t){return new Vs(e=>e===null?null:t.validate(e),(e,n)=>n===null?null:t.validateUsingKnownGoodVersion&&e!==null?t.validateUsingKnownGoodVersion(e,n):t.validate(n))}function Lv(...t){return Ak(new Set(t))}function cU(t){try{return new URL(t)}catch{if(t.startsWith("/")||t.startsWith("./"))try{return new URL(t,"http://example.com")}catch{throw new Zt(`Expected a valid url, got ${JSON.stringify(t)}`)}throw new Zt(`Expected a valid url, got ${JSON.stringify(t)}`)}}const Oqe=new Set(["http:","https:","mailto:"]),$a=Rt.check(t=>{if(t==="")return;const e=cU(t);if(!Oqe.has(e.protocol.toLowerCase()))throw new Zt(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)}),Dqe=new Set(["http:","https:","data:","asset:"]),ug=Rt.check(t=>{if(t==="")return;const e=cU(t);if(!Dqe.has(e.protocol.toLowerCase()))throw new Zt(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});Rt.check(t=>{if(t==="")return;if(!cU(t).protocol.toLowerCase().match(/^https?:$/))throw new Zt(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});const uU=Rt.refine(t=>{try{return vWe(t),t}catch{throw new Zt(`Expected an index key, got ${JSON.stringify(t)}`)}});Fd("@tldraw/validate","3.15.3","esm");function Da(t){return Rt.refine(e=>{if(!e.startsWith(`${t}:`))throw new Error(`${t} ID must start with "${t}:"`);return e})}const Mk=Da("asset");function dU(t,e){return Vt({id:Mk,typeName:Fs("asset"),type:Fs(t),props:e,meta:ts})}const dg=Vt({x:yt,y:yt,z:yt.optional()}),lx=Vt({x:yt,y:yt,w:yt,h:yt}),Jde=yt.check(t=>{if(t<0||t>1)throw new Zt("Opacity must be between 0 and 1")}),Rqe=Rt.refine(t=>{if(!t.startsWith("page:")&&!t.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return t}),pl=Da("shape");function Nqe(t,e,n){return Vt({id:pl,typeName:Fs("shape"),x:yt,y:yt,rotation:yt,index:uU,parentId:Rqe,type:Fs(t),isLocked:Ft,opacity:Jde,props:e?Vt(e):ts,meta:n?Vt(n):ts})}const jqe=Da("binding");function Lqe(t,e,n){return Vt({id:jqe,typeName:Fs("binding"),type:Fs(t),fromId:pl,toId:pl,props:e?Vt(e):ts,meta:n?Vt(n):ts})}ea("com.tldraw.binding",{});Ha({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Vp(t){return`binding:${fn()}`}function Fqe(t,e){return Mf(e,(n,r)=>`com.tldraw.binding.${t}/${r}`)}function $qe(t){return Iu("binding",{scope:"document",validator:Pu("binding",lU("type",Mf(t,(e,{props:n,meta:r})=>Lqe(e,n,r))))}).withDefaultProperties(()=>({meta:{}}))}class ji{constructor(e,n,r){this.id=e,this.defaultValue=n,this.type=r}static define(e,n){const{defaultValue:r,type:i=_qe}=n;return new ji(e,r,i)}static defineEnum(e,n){const{defaultValue:r,values:i}=n;return new Bqe(e,r,i)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,n){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,n):this.validate(n)}}class Bqe extends ji{constructor(e,n,r){super(e,n,Lv(...r)),this.values=r}}const MC=ea("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),zqe=Ha({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:MC.AddIsLocked,up:t=>{t.isLocked=!1},down:t=>{delete t.isLocked}},{id:MC.HoistOpacity,up:t=>{t.opacity=Number(t.props.opacity??"1"),delete t.props.opacity},down:t=>{const e=t.opacity;delete t.opacity,t.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:MC.AddMeta,up:t=>{t.meta={}}},{id:MC.AddWhite,up:t=>{},down:t=>{t.props.color==="white"&&(t.props.color="black")}}]});function ey(t){return t?t.typeName==="shape":!1}function io(t){return t?t.startsWith("shape:"):!1}function Sn(t){return`shape:${t??fn()}`}function Zde(t){const e=new Map;for(const[n,r]of Object.entries(t))if(r instanceof ji){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,n)}return e}function jl(t,e){return Mf(e,(n,r)=>`com.tldraw.shape.${t}/${r}`)}function Uqe(t){return Iu("shape",{scope:"document",validator:Pu("shape",lU("type",Mf(t,(e,{props:n,meta:r})=>Nqe(e,n,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function wZ(t,e){const n=[];for(const[r,{migrations:i}]of Object.entries(e)){const s=`com.tldraw.${t}.${r}`;i?"sequenceId"in i?(it(s===i.sequenceId,`sequenceId mismatch for ${r} ${Pk} migrations. Expected '${s}', got '${i.sequenceId}'`),n.push(i)):"sequence"in i?n.push(dy({sequenceId:s,retroactive:!0,sequence:i.sequence.map(o=>"id"in o?Qde(t,r,o):o)})):n.push(dy({sequenceId:s,retroactive:!0,sequence:Object.keys(i.migrators).map(o=>Number(o)).sort((o,a)=>o-a).map(o=>({id:`${s}/${o}`,scope:"record",filter:a=>a.typeName===t&&a.type===r,up:a=>{const l=i.migrators[o].up(a);if(l)return l},down:a=>{const l=i.migrators[o].down(a);if(l)return l}}))})):n.push(dy({sequenceId:s,retroactive:!0,sequence:[]}))}return n}function Qde(t,e,n){return{id:n.id,dependsOn:n.dependsOn,scope:"record",filter:r=>r.typeName===t&&r.type===e,up:r=>{const i=n.up(r.props);i&&(r.props=i)},down:typeof n.down=="function"?r=>{const i=n.down(r.props);i&&(r.props=i)}:void 0}}const ehe=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],BI={lightMode:{id:"light",text:"#000000",background:"#f9fafb",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",frame:{headingStroke:"#717171",headingFill:"#ffffff",stroke:"#717171",fill:"#ffffff",text:"#000000"},note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8205 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",frame:{headingStroke:"#6681ec",headingFill:"#f9fafe",stroke:"#6681ec",fill:"#f9fafe",text:"#000000"},note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",frame:{headingStroke:"#37a684",headingFill:"#f8fcfa",stroke:"#37a684",fill:"#f8fcfa",text:"#000000"},note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",frame:{headingStroke:"#aaaaab",headingFill:"#fbfcfc",stroke:"#aaaaab",fill:"#fcfcfd",text:"#000000"},note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",frame:{headingStroke:"#6cb2f3",headingFill:"#f8fbfe",stroke:"#6cb2f3",fill:"#fafcff",text:"#000000"},note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",frame:{headingStroke:"#6dbe7c",headingFill:"#f8fcf9",stroke:"#6dbe7c",fill:"#fafdfa",text:"#000000"},note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",frame:{headingStroke:"#f89090",headingFill:"#fffafa",stroke:"#f89090",fill:"#fffbfb",text:"#000000"},note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",frame:{headingStroke:"#e59bf5",headingFill:"#fefaff",stroke:"#e59bf5",fill:"#fefbff",text:"#000000"},note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",frame:{headingStroke:"#e68544",headingFill:"#fef9f6",stroke:"#e68544",fill:"#fef9f6",text:"#000000"},note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",frame:{headingStroke:"#e55757",headingFill:"#fef7f7",stroke:"#e55757",fill:"#fef9f9",text:"#000000"},note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",frame:{headingStroke:"#bc62d3",headingFill:"#fcf7fd",stroke:"#bc62d3",fill:"#fdf9fd",text:"#000000"},note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",frame:{headingStroke:"#f3bb6c",headingFill:"#fefcf8",stroke:"#f3bb6c",fill:"#fffdfa",text:"#000000"},note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",frame:{headingStroke:"#7d7d7d",headingFill:"#ffffff",stroke:"#7d7d7d",fill:"#ffffff",text:"#000000"},note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",frame:{headingStroke:"#5c5c5c",headingFill:"#252525",stroke:"#5c5c5c",fill:"#0c0c0c",text:"#f2f2f2"},note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.6225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",frame:{headingStroke:"#384994",headingFill:"#1C2036",stroke:"#384994",fill:"#11141f",text:"#f2f2f2"},note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",frame:{headingStroke:"#10513C",headingFill:"#14241f",stroke:"#10513C",fill:"#0E1614",text:"#f2f2f2"},note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",frame:{headingStroke:"#42474D",headingFill:"#23262A",stroke:"#42474D",fill:"#151719",text:"#f2f2f2"},note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",frame:{headingStroke:"#075797",headingFill:"#142839",stroke:"#075797",fill:"#0B1823",text:"#f2f2f2"},note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",frame:{headingStroke:"#1C5427",headingFill:"#18251A",stroke:"#1C5427",fill:"#0F1911",text:"#f2f2f2"},note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",frame:{headingStroke:"#6f3232",headingFill:"#341818",stroke:"#6f3232",fill:"#181212",text:"#f2f2f2"},note:{fill:"#7a3333",text:"#f2f2f2"},semi:"#3c2b2b",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",frame:{headingStroke:"#6c367a",headingFill:"#2D2230",stroke:"#6c367a",fill:"#1C151E",text:"#f2f2f2"},note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",frame:{headingStroke:"#773a0e",headingFill:"#2f1d13",stroke:"#773a0e",fill:"#1c1512",text:"#f2f2f2"},note:{fill:"#7c3905",text:"#f2f2f2"},semi:"#3b2e27",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",frame:{headingStroke:"#701e1e",headingFill:"#301616",stroke:"#701e1e",fill:"#1b1313",text:"#f2f2f2"},note:{fill:"#7e201f",text:"#f2f2f2"},semi:"#382726",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",frame:{headingStroke:"#6d1583",headingFill:"#27152e",stroke:"#6d1583",fill:"#1b0f21",text:"#f2f2f2"},note:{fill:"#5f1c70",text:"#f2f2f2"},semi:"#342938",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",frame:{headingStroke:"#684e12",headingFill:"#2a2113",stroke:"#684e12",fill:"#1e1911",text:"#f2f2f2"},note:{fill:"#8a5e1c",text:"#f2f2f2"},semi:"#3b352b",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",frame:{headingStroke:"#ffffff",headingFill:"#ffffff",stroke:"#ffffff",fill:"#ffffff",text:"#000000"},note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function Ud(t){return t.isDarkMode?BI.darkMode:BI.lightMode}const mo=ji.defineEnum("tldraw:color",{defaultValue:"black",values:ehe}),hU=ji.defineEnum("tldraw:labelColor",{defaultValue:"black",values:ehe}),hg=ji.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),fg=ji.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),Td=ji.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),the={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},vu=ji.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),Hqe=["arc","elbow"],ow=ji.defineEnum("tldraw:arrowKind",{defaultValue:"arc",values:Hqe}),nhe=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],zI=ji.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:nhe}),UI=ji.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:nhe}),rhe={kind:ow,labelColor:hU,color:mo,fill:fg,dash:hg,size:vu,arrowheadStart:zI,arrowheadEnd:UI,font:Td,start:dg,end:dg,bend:yt,text:Rt,labelPosition:yt,scale:Rr,elbowMidPoint:yt},xp=jl("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5,AddElbow:6});function eb(t){return Qde("shape","arrow",t)}const ihe=dy({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[eb({id:xp.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"}),eb({id:xp.AddIsPrecise,up:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise=!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),eb({id:xp.AddLabelPosition,up:t=>{t.labelPosition=.5},down:t=>{delete t.labelPosition}}),{id:xp.ExtractBindings,scope:"store",up:t=>{const e=Object.values(t).filter(n=>n.typeName==="shape"&&n.type==="arrow");for(const n of e){const{start:r,end:i}=n.props;if(r.type==="binding"){const s=Vp(),o={typeName:"binding",id:s,type:"arrow",fromId:n.id,toId:r.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};t[s]=o,n.props.start={x:0,y:0}}else delete n.props.start.type;if(i.type==="binding"){const s=Vp(),o={typeName:"binding",id:s,type:"arrow",fromId:n.id,toId:i.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};t[s]=o,n.props.end={x:0,y:0}}else delete n.props.end.type}}},eb({id:xp.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}),eb({id:xp.AddElbow,up:t=>{t.kind="arc",t.elbowMidPoint=.5},down:t=>{delete t.kind,delete t.elbowMidPoint}})]}),Vqe=Lv("center","edge-point","edge","none"),she={terminal:Lv("start","end"),normalizedAnchor:dg,isExact:Ft,isPrecise:Ft,snap:Vqe},Wqe=Fqe("arrow",{AddSnap:1}),ohe={sequence:[{dependsOn:[xp.ExtractBindings]},{id:Wqe.AddSnap,up:t=>{t.snap="none"},down:t=>{delete t.snap}}]},Kqe=Pu("camera",Vt({typeName:Fs("camera"),id:Da("camera"),x:yt,y:yt,z:yt,meta:ts})),qqe=ea("com.tldraw.camera",{AddMeta:1}),Gqe=Ha({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:qqe.AddMeta,up:t=>{t.meta={}}}]}),ru=Iu("camera",{validator:Kqe,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),Yqe=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),ahe=Ak(Yqe),Xqe=Vt({type:ahe,rotation:yt}),Jqe=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),Zqe=Ak(Jqe),Qqe=new Set(["starting","paused","active","stopping"]),lhe=Vt({id:Rt,points:Si(dg),size:FI,color:Zqe,opacity:yt,state:Ak(Qqe),delay:yt,shrink:yt,taper:Ft}),aw=Da("page"),eGe=Pu("page",Vt({typeName:Fs("page"),id:aw,name:Rt,index:uU,meta:ts})),tGe=ea("com.tldraw.page",{AddMeta:1}),nGe=Ha({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:tGe.AddMeta,up:t=>{t.meta={}}}]}),fo=Iu("page",{validator:eGe,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Vi(t){return fo.isId(t)}const rGe={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function che(t){return t?ox(t,e=>rGe[e]):null}Da("instance");function iGe(t){const e={};for(const[r,i]of t)e[r]=Xde(i);const n=Pu("instance",Vt({typeName:Fs("instance"),id:Da("instance"),currentPageId:aw,followingUserId:Rt.nullable(),brush:lx.nullable(),opacityForNextShape:Jde,stylesForNextShape:Vt(e),cursor:Xqe,scribbles:Si(lhe),isFocusMode:Ft,isDebugMode:Ft,isToolLocked:Ft,exportBackground:Ft,screenBounds:lx,insets:Si(Ft),zoomBrush:lx.nullable(),isPenMode:Ft,isGridMode:Ft,chatMessage:Rt,isChatting:Ft,highlightedUserIds:Si(Rt),isFocused:Ft,devicePixelRatio:yt,isCoarsePointer:Ft,isHoveringCanvas:Ft.nullable(),openMenus:Si(Rt),isChangingStyle:Ft,isReadonly:Ft,meta:ts,duplicateProps:Vt({shapeIds:Si(Da("shape")),offset:Vt({x:yt,y:yt})}).nullable()}));return Iu("instance",{validator:n,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const zn=ea("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),sGe=Ha({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:zn.AddTransparentExportBgs,up:t=>({...t,exportBackground:!0})},{id:zn.RemoveDialog,up:({dialog:t,...e})=>e},{id:zn.AddToolLockMode,up:t=>({...t,isToolLocked:!1})},{id:zn.RemoveExtraPropsForNextShape,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(t).filter(([n])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(n)))})},{id:zn.AddLabelColor,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:{...t,labelColor:"black"}})},{id:zn.AddFollowingUserId,up:t=>({...t,followingUserId:null})},{id:zn.RemoveAlignJustify,up:t=>{let e=t.propsForNextShape.align;return e==="justify"&&(e="start"),{...t,propsForNextShape:{...t.propsForNextShape,align:e}}}},{id:zn.AddZoom,up:t=>({...t,zoomBrush:null})},{id:zn.AddVerticalAlign,up:t=>({...t,propsForNextShape:{...t.propsForNextShape,verticalAlign:"middle"}})},{id:zn.AddScribbleDelay,up:t=>t.scribble!==null?{...t,scribble:{...t.scribble,delay:0}}:{...t}},{id:zn.RemoveUserId,up:({userId:t,...e})=>e},{id:zn.AddIsPenModeAndIsGridMode,up:t=>({...t,isPenMode:!1,isGridMode:!1})},{id:zn.HoistOpacity,up:({propsForNextShape:{opacity:t,...e},...n})=>({...n,opacityForNextShape:Number(t??"1"),propsForNextShape:e})},{id:zn.AddChat,up:t=>({...t,chatMessage:"",isChatting:!1})},{id:zn.AddHighlightedUserIds,up:t=>({...t,highlightedUserIds:[]})},{id:zn.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:t,...e})=>({...e,stylesForNextShape:{}})},{id:zn.AddMeta,up:t=>({...t,meta:{}})},{id:zn.RemoveCursorColor,up:t=>{const{color:e,...n}=t.cursor;return{...t,cursor:n}}},{id:zn.AddLonelyProperties,up:t=>({...t,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:zn.ReadOnlyReadonly,up:({isReadOnly:t,...e})=>({...e,isReadonly:t})},{id:zn.AddHoveringCanvas,up:t=>({...t,isHoveringCanvas:null})},{id:zn.AddScribbles,up:({scribble:t,...e})=>({...e,scribbles:[]})},{id:zn.AddInset,up:t=>({...t,insets:[!1,!1,!1,!1]}),down:({insets:t,...e})=>({...e})},{id:zn.AddDuplicateProps,up:t=>({...t,duplicateProps:null}),down:({duplicateProps:t,...e})=>({...e})},{id:zn.RemoveCanMoveCamera,up:({canMoveCamera:t,...e})=>({...e}),down:t=>({...t,canMoveCamera:!0})}]}),so="instance:instance",oGe=Pu("instance_page_state",Vt({typeName:Fs("instance_page_state"),id:Da("instance_page_state"),pageId:aw,selectedShapeIds:Si(pl),hintingShapeIds:Si(pl),erasingShapeIds:Si(pl),hoveredShapeId:pl.nullable(),editingShapeId:pl.nullable(),croppingShapeId:pl.nullable(),focusedGroupId:pl.nullable(),meta:ts})),tb=ea("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),aGe=Ha({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:tb.AddCroppingId,up(t){t.croppingShapeId=null}},{id:tb.RemoveInstanceIdAndCameraId,up(t){delete t.instanceId,delete t.cameraId}},{id:tb.AddMeta,up:t=>{t.meta={}}},{id:tb.RenameProperties,up:t=>{},down:t=>{}},{id:tb.RenamePropertiesAgain,up:t=>{t.selectedShapeIds=t.selectedIds,delete t.selectedIds,t.hintingShapeIds=t.hintingIds,delete t.hintingIds,t.erasingShapeIds=t.erasingIds,delete t.erasingIds,t.hoveredShapeId=t.hoveredId,delete t.hoveredId,t.editingShapeId=t.editingId,delete t.editingId,t.croppingShapeId=t.croppingShapeId??t.croppingId??null,delete t.croppingId,t.focusedGroupId=t.focusLayerId,delete t.focusLayerId},down:t=>{t.selectedIds=t.selectedShapeIds,delete t.selectedShapeIds,t.hintingIds=t.hintingShapeIds,delete t.hintingShapeIds,t.erasingIds=t.erasingShapeIds,delete t.erasingShapeIds,t.hoveredId=t.hoveredShapeId,delete t.hoveredShapeId,t.editingId=t.editingShapeId,delete t.editingShapeId,t.croppingId=t.croppingShapeId,delete t.croppingShapeId,t.focusLayerId=t.focusedGroupId,delete t.focusedGroupId}}]}),cc=Iu("instance_page_state",{validator:oGe,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),lGe=Pu("pointer",Vt({typeName:Fs("pointer"),id:Da("pointer"),x:yt,y:yt,lastActivityTimestamp:yt,meta:ts})),cGe=ea("com.tldraw.pointer",{AddMeta:1}),uGe=Ha({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:cGe.AddMeta,up:t=>{t.meta={}}}]}),fU=Iu("pointer",{validator:lGe,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),HI=fU.createId("pointer"),dGe=Pu("instance_presence",Vt({typeName:Fs("instance_presence"),id:Da("instance_presence"),userId:Rt,userName:Rt,lastActivityTimestamp:yt.nullable(),followingUserId:Rt.nullable(),cursor:Vt({x:yt,y:yt,type:ahe,rotation:yt}).nullable(),color:Rt,camera:Vt({x:yt,y:yt,z:yt}).nullable(),screenBounds:lx.nullable(),selectedShapeIds:Si(Da("shape")),currentPageId:Da("page"),brush:lx.nullable(),scribbles:Si(lhe),chatMessage:Rt,meta:ts})),Im=ea("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),hGe=Ha({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:Im.AddScribbleDelay,up:t=>{t.scribble!==null&&(t.scribble.delay=0)}},{id:Im.RemoveInstanceId,up:t=>{delete t.instanceId}},{id:Im.AddChatMessage,up:t=>{t.chatMessage=""}},{id:Im.AddMeta,up:t=>{t.meta={}}},{id:Im.RenameSelectedShapeIds,up:t=>{}},{id:Im.NullableCameraCursor,up:t=>{},down:t=>{t.camera===null&&(t.camera={x:0,y:0,z:1}),t.lastActivityTimestamp===null&&(t.lastActivityTimestamp=0),t.cursor===null&&(t.cursor={type:"default",x:0,y:0,rotation:0}),t.screenBounds===null&&(t.screenBounds={x:0,y:0,w:1,h:1})}}]}),fGe=Iu("instance_presence",{validator:dGe,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),pGe=Pu("document",Vt({typeName:Fs("document"),id:Fs("document:document"),gridSize:yt,name:Rt,meta:ts})),SZ=ea("com.tldraw.document",{AddName:1,AddMeta:2}),gGe=Ha({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:SZ.AddName,up:t=>{t.name=""},down:t=>{delete t.name}},{id:SZ.AddMeta,up:t=>{t.meta={}}}]}),pU=Iu("document",{validator:pGe,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),U3=pU.createId("document");function mGe(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function CZ(t){t.typeName==="asset"&&("src"in t&&(t.src="<redacted>"),"src"in t.props&&(t.props.src="<redacted>"))}function yGe({error:t,phase:e,record:n,recordBefore:r}){throw Pz(t,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?CZ(ar(r)):void 0,recordAfter:CZ(ar(n))}}),t}function vGe(){return[fo.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function bGe(t){const e=t.query.ids("page"),n=t.query.records("instance_page_state"),r=()=>{if(!t.has(U3))return t.put([pU.create({id:U3,name:t.props.defaultName})]),r();if(!t.has(HI))return t.put([fU.create({id:HI})]),r();const i=e.get();if(i.size===0)return t.put(vGe()),r();const s=()=>[...i].map(u=>t.get(u)).sort(mGe)[0].id,o=t.get(so);if(o){if(!i.has(o.currentPageId))return t.put([{...o,currentPageId:s()}]),r()}else return t.put([t.schema.types.instance.create({id:so,currentPageId:s(),exportBackground:!0})]),r();const a=new Set,l=new Set;for(const u of i){const d=cc.createId(u);t.get(d)||a.add(d);const f=ru.createId(u);t.has(f)||l.add(f)}a.size>0&&t.put([...a].map(u=>cc.create({id:u,pageId:cc.parseId(u)}))),l.size>0&&t.put([...l].map(u=>ru.create({id:u})));const c=n.get();for(const u of c){if(!i.has(u.pageId)){t.remove([u.id]);continue}if(u.croppingShapeId&&!t.has(u.croppingShapeId))return t.put([{...u,croppingShapeId:null}]),r();if(u.focusedGroupId&&!t.has(u.focusedGroupId))return t.put([{...u,focusedGroupId:null}]),r();if(u.hoveredShapeId&&!t.has(u.hoveredShapeId))return t.put([{...u,hoveredShapeId:null}]),r();const d=u.selectedShapeIds.filter(y=>t.has(y));if(d.length!==u.selectedShapeIds.length)return t.put([{...u,selectedShapeIds:d}]),r();const h=u.hintingShapeIds.filter(y=>t.has(y));if(h.length!==u.hintingShapeIds.length)return t.put([{...u,hintingShapeIds:h}]),r();const f=u.erasingShapeIds.filter(y=>t.has(y));if(f.length!==u.erasingShapeIds.length)return t.put([{...u,erasingShapeIds:f}]),r()}};return r}const xGe=dU("bookmark",Vt({title:Rt,description:Rt,image:Rt,favicon:Rt,src:ug.nullable()})),EZ=ea("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),wGe=Ha({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:t=>t.type==="bookmark",sequence:[{id:EZ.MakeUrlsValid,up:t=>{ug.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:EZ.AddFavicon,up:t=>{ug.isValid(t.props.favicon)||(t.props.favicon="")},down:t=>{delete t.props.favicon}}]}),SGe=dU("image",Vt({w:yt,h:yt,name:Rt,isAnimated:Ft,mimeType:Rt.nullable(),src:ug.nullable(),fileSize:Rr.optional()})),nb=ea("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),CGe=Ha({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:t=>t.type==="image",sequence:[{id:nb.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:nb.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:nb.MakeUrlsValid,up:t=>{ug.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:nb.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:nb.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),EGe=dU("video",Vt({w:yt,h:yt,name:Rt,isAnimated:Ft,mimeType:Rt.nullable(),src:ug.nullable(),fileSize:yt.optional()})),rb=ea("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),TGe=Ha({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:t=>t.type==="video",sequence:[{id:rb.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:rb.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:rb.MakeUrlsValid,up:t=>{ug.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:rb.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:rb.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),IGe=Pu("asset",lU("type",{image:SGe,video:EGe,bookmark:xGe})),PGe=ea("com.tldraw.asset",{AddMeta:1}),_Ge=Ha({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:PGe.AddMeta,up:t=>{t.meta={}}}]}),Nf=Iu("asset",{validator:IGe,scope:"document"}).withDefaultProperties(()=>({meta:{}})),uhe={w:Rr,h:Rr,assetId:Mk.nullable(),url:$a},TZ=jl("bookmark",{NullAssetId:1,MakeUrlsValid:2}),dhe={sequence:[{id:TZ.NullAssetId,up:t=>{t.assetId===void 0&&(t.assetId=null)},down:"retired"},{id:TZ.MakeUrlsValid,up:t=>{$a.isValid(t.url)||(t.url="")},down:t=>{}}]},hhe=Vt({type:Lv("free","straight"),points:Si(dg)}),fhe={color:mo,fill:fg,dash:hg,size:vu,segments:Si(hhe),isComplete:Ft,isClosed:Ft,isPen:Ft,scale:Rr},IZ=jl("draw",{AddInPen:1,AddScale:2}),phe={sequence:[{id:IZ.AddInPen,up:t=>{const{points:e}=t.segments[0];if(e.length===0){t.isPen=!1;return}let n=!(e[0].z===0||e[0].z===.5);e[1]&&(n=n&&!(e[1].z===0||e[1].z===.5)),t.isPen=n},down:"retired"},{id:IZ.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},kGe=/(^\/r\/[^/]+\/?$)/,AGe=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(kGe))return t}},{hostnames:["figma.com"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/embed\/?$/)){const n=e.searchParams.get("url");if(n)return n}}},{hostnames:["google.*"],fromEmbedUrl:t=>{const e=wt(t);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[i,s]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${s},${r}z`}}},{hostnames:["val.town"],fromEmbedUrl:t=>{const e=wt(t),n=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:t=>{const e=wt(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,i,s]=n;return`https://codepen.io/${i}/pen/${s}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:t=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,i]=n;return`https://scratch.mit.edu/projects/${i}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:t=>{const e=wt(t);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:t=>{const e=wt(t),n=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&n){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",n),e.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:t=>{const e=wt(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0}},{hostnames:["replit.com"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{hostnames:["felt.com"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.hostname==="player.vimeo.com"){const n=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.hash.match(/#room=/))return t}},{hostnames:["observablehq.com"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:t=>{const e=wt(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return t.replace("?embed","")}}],ghe={w:Rr,h:Rr,url:Rt},OC=jl("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),mhe={sequence:[{id:OC.GenOriginalUrlInEmbed,up:t=>{try{const e=t.url,n=new URL(e).host.replace("www.","");let r;for(const i of AGe)if(i.hostnames.includes(n))try{r=i.fromEmbedUrl(e)}catch(s){console.warn(s)}t.tmpOldUrl=t.url,t.url=r??""}catch{t.url="",t.tmpOldUrl=t.url}},down:"retired"},{id:OC.RemoveDoesResize,up:t=>{delete t.doesResize},down:"retired"},{id:OC.RemoveTmpOldUrl,up:t=>{delete t.tmpOldUrl},down:"retired"},{id:OC.RemovePermissionOverrides,up:t=>{delete t.overridePermissions},down:"retired"}]},yhe={w:Rr,h:Rr,name:Rt,color:Lv(...mo.values)},MGe=jl("frame",{AddColorProp:1}),vhe={sequence:[{id:MGe.AddColorProp,up:t=>{t.color="black"},down:t=>{delete t.color}}]},gU=Vt({type:Rt,content:Si(Pqe)});function Dl(t){return{type:"doc",content:t.split(`
`).map(r=>r?{type:"paragraph",content:[{type:"text",text:r}]}:{type:"paragraph"})}}const VI=ji.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),WI=ji.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),uc=ji.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),bhe={geo:uc,dash:hg,url:$a,w:Rr,h:Rr,growY:FI,scale:Rr,labelColor:hU,color:mo,fill:fg,size:vu,font:Td,align:VI,verticalAlign:WI,richText:gU},Vc=jl("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9,AddRichText:10}),xhe={sequence:[{id:Vc.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Vc.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"},{id:Vc.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:Vc.AddCheckBox,up:t=>{},down:"retired"},{id:Vc.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:Vc.MigrateLegacyAlign,up:t=>{let e;switch(t.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}t.align=e},down:"retired"},{id:Vc.AddCloud,up:t=>{},down:"retired"},{id:Vc.MakeUrlsValid,up:t=>{$a.isValid(t.url)||(t.url="")},down:t=>{}},{id:Vc.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}},{id:Vc.AddRichText,up:t=>{t.richText=Dl(t.text),delete t.text}}]},whe={},She={sequence:[]},Che={color:mo,size:vu,segments:Si(hhe),isComplete:Ft,isPen:Ft,scale:Rr},OGe=jl("highlight",{AddScale:1}),Ehe={sequence:[{id:OGe.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},DGe=Vt({topLeft:dg,bottomRight:dg,isCircle:Ft.optional()}),The={w:Rr,h:Rr,playing:Ft,url:$a,assetId:Mk.nullable(),crop:DGe.nullable(),flipX:Ft,flipY:Ft,altText:Rt},ib=jl("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4,AddAltText:5}),Ihe={sequence:[{id:ib.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:ib.AddCropProp,up:t=>{t.crop=null},down:t=>{delete t.crop}},{id:ib.MakeUrlsValid,up:t=>{$a.isValid(t.url)||(t.url="")},down:t=>{}},{id:ib.AddFlipProps,up:t=>{t.flipX=!1,t.flipY=!1},down:t=>{delete t.flipX,delete t.flipY}},{id:ib.AddAltText,up:t=>{t.altText=""},down:t=>{delete t.altText}}]},KI=ji.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),RGe=Vt({id:Rt,index:uU,x:yt,y:yt}),Phe={color:mo,dash:hg,size:vu,spline:KI,points:$I(Rt,RGe),scale:Rr},sb=jl("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),_he={sequence:[{id:sb.AddSnapHandles,up:t=>{for(const e of Object.values(t.handles))e.canSnap=!0},down:"retired"},{id:sb.RemoveExtraHandleProps,up:t=>{t.handles=jue(Object.values(t.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:t=>{const e=Object.entries(t.handles).map(([n,r])=>({index:n,...r})).sort(Xi);t.handles=Object.fromEntries(e.map((n,r)=>{const i=r===0?"start":r===e.length-1?"end":`handle:${n.index}`;return[i,{id:i,type:"vertex",canBind:!1,canSnap:!0,index:n.index,x:n.x,y:n.y}]}))}},{id:sb.HandlesToPoints,up:t=>{const e=Object.entries(t.handles).map(([n,{x:r,y:i}])=>({x:r,y:i,index:n})).sort(Xi);t.points=e.map(({x:n,y:r})=>({x:n,y:r})),delete t.handles},down:t=>{const e=sw(t.points.length);t.handles=Object.fromEntries(t.points.map((n,r)=>[e[r],{x:n.x,y:n.y}])),delete t.points}},{id:sb.PointIndexIds,up:t=>{const e=sw(t.points.length);t.points=Object.fromEntries(t.points.map((n,r)=>{const i=e[r];return[i,{id:i,index:i,x:n.x,y:n.y}]}))},down:t=>{const e=Object.values(t.points).sort(Xi);t.points=e.map(({x:n,y:r})=>({x:n,y:r}))}},{id:sb.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},khe={color:mo,labelColor:hU,size:vu,font:Td,fontSizeAdjustment:FI,align:VI,verticalAlign:WI,growY:FI,url:$a,richText:gU,scale:Rr},Vu=jl("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8,AddRichText:9}),Ahe={sequence:[{id:Vu.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Vu.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:Vu.MigrateLegacyAlign,up:t=>{switch(t.align){case"start":t.align="start-legacy";return;case"end":t.align="end-legacy";return;default:t.align="middle-legacy";return}},down:"retired"},{id:Vu.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:Vu.MakeUrlsValid,up:t=>{$a.isValid(t.url)||(t.url="")},down:t=>{}},{id:Vu.AddFontSizeAdjustment,up:t=>{t.fontSizeAdjustment=0},down:t=>{delete t.fontSizeAdjustment}},{id:Vu.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}},{id:Vu.AddLabelColor,up:t=>{t.labelColor="black"},down:t=>{delete t.labelColor}},{id:Vu.AddRichText,up:t=>{t.richText=Dl(t.text),delete t.text}}]},H3=ji.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),Mhe={color:mo,size:vu,font:Td,textAlign:H3,w:Rr,richText:gU,scale:Rr,autoSize:Ft},Ej=jl("text",{RemoveJustify:1,AddTextAlign:2,AddRichText:3}),Ohe={sequence:[{id:Ej.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:Ej.AddTextAlign,up:t=>{t.textAlign=t.align,delete t.align},down:t=>{t.align=t.textAlign,delete t.textAlign}},{id:Ej.AddRichText,up:t=>{t.richText=Dl(t.text),delete t.text}}]},Dhe={w:Rr,h:Rr,time:yt,playing:Ft,autoplay:Ft,url:$a,assetId:Mk.nullable(),altText:Rt},DC=jl("video",{AddUrlProp:1,MakeUrlsValid:2,AddAltText:3,AddAutoplay:4}),Rhe={sequence:[{id:DC.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:DC.MakeUrlsValid,up:t=>{$a.isValid(t.url)||(t.url="")},down:t=>{}},{id:DC.AddAltText,up:t=>{t.altText=""},down:t=>{delete t.altText}},{id:DC.AddAutoplay,up:t=>{t.autoplay=!0},down:t=>{delete t.autoplay}}]},RC=ea("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),NGe=dy({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:RC.RemoveCodeAndIconShapeTypes,scope:"store",up:t=>{for(const[e,n]of ho(t))n.typeName==="shape"&&(n.type==="icon"||n.type==="code")&&delete t[e]}},{id:RC.AddInstancePresenceType,scope:"store",up(t){}},{id:RC.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:t=>{for(const[e,n]of ho(t))n.typeName.match(/^(user|user_presence)$/)&&delete t[e]}},{id:RC.RemoveUserDocument,scope:"store",up:t=>{for(const[e,n]of ho(t))n.typeName.match("user_document")&&delete t[e]}}]}),jGe={arrow:{migrations:ihe,props:rhe},bookmark:{migrations:dhe,props:uhe},draw:{migrations:phe,props:fhe},embed:{migrations:mhe,props:ghe},frame:{migrations:vhe,props:yhe},geo:{migrations:xhe,props:bhe},group:{migrations:She,props:whe},highlight:{migrations:Ehe,props:Che},image:{migrations:Ihe,props:The},line:{migrations:_he,props:Phe},note:{migrations:Ahe,props:khe},text:{migrations:Ohe,props:Mhe},video:{migrations:Rhe,props:Dhe}},LGe={arrow:{migrations:ohe,props:she}};function FGe({shapes:t=jGe,bindings:e=LGe,migrations:n}={}){const r=new Map;for(const a of yr(t))for(const l of Zde(a.props??{}).keys()){if(r.has(l.id)&&r.get(l.id)!==l)throw new Error(`Multiple StyleProp instances with the same id: ${l.id}`);r.set(l.id,l)}const i=Uqe(t),s=$qe(e),o=iGe(r);return oU.create({asset:Nf,binding:s,camera:ru,document:pU,instance:o,instance_page_state:cc,page:fo,instance_presence:fGe,pointer:fU,shape:i},{migrations:[NGe,_Ge,Gqe,gGe,sGe,aGe,nGe,hGe,uGe,zqe,wGe,CGe,TGe,...wZ("shape",t),...wZ("binding",e),...n??[]],onValidationFailure:yGe,createIntegrityChecker:bGe})}const lw=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ms",label:"Bahasa Melayu"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"tl",label:"Filipino"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"nl",label:"Nederlands"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"sl",label:"Slovenščina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiếng Việt"},{locale:"tr",label:"Türkçe"},{locale:"el",label:"Ελληνικά"},{locale:"ru",label:"Русский"},{locale:"uk",label:"Українська"},{locale:"he",label:"עברית"},{locale:"ur",label:"اردو"},{locale:"ar",label:"عربي"},{locale:"fa",label:"فارسی"},{locale:"ne",label:"नेपाली"},{locale:"mr",label:"मराठी"},{locale:"hi-in",label:"हिन्दी"},{locale:"bn",label:"বাংলা"},{locale:"pa",label:"ਪੰਜਾਬੀ"},{locale:"gu-in",label:"ગુજરાતી"},{locale:"ta",label:"தமிழ்"},{locale:"te",label:"తెలుగు"},{locale:"kn",label:"ಕನ್ನಡ"},{locale:"ml",label:"മലയാളം"},{locale:"th",label:"ภาษาไทย"},{locale:"km-kh",label:"ភាសាខ្មែរ"},{locale:"ko-kr",label:"한국어"},{locale:"ja",label:"日本語"},{locale:"zh-cn",label:"简体中文"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function $Ge(){const t=typeof window<"u"?window.navigator.languages??["en"]:["en"];return BGe(t)}function BGe(t){for(const e of t){const n=zGe(e);if(n)return n}return"en"}const PZ={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function zGe(t){const e=lw.find(i=>i.locale===t.toLowerCase());if(e)return e.locale;const[n,r]=t.split(/[-_]/).map(i=>i.toLowerCase());if(r){const i=lw.find(s=>s.locale===n);if(i)return i.locale}return n in PZ?PZ[n]:null}Fd("@tldraw/tlschema","3.15.3","esm");function UGe(){return g.jsx("div",{className:"tl-background"})}function IS(t,e,n,r,i,s){S.useLayoutEffect(()=>{const o=t.current;if(!o||e===void 0)return;let a=`translate(${e}px, ${n}px)`;r!==void 0&&(a+=` scale(${r})`),i!==void 0&&(a+=` rotate(${i}rad)`),s&&(a+=` translate(${s.x}px, ${s.y}px)`),o.style.transform=a})}const Ms={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:-1+(4-2*t)*t,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t<=0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t>=1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t<=0?0:t>=1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2};class M{constructor(e=0,n=0,r=1){this.x=e,this.y=n,this.z=r}get pressure(){return this.z}set(e=this.x,n=this.y,r=this.z){return this.x=e,this.y=n,this.z=r,this}setTo({x:e=0,y:n=0,z:r=1}){return this.x=e,this.y=n,this.z=r,this}rot(e){if(e===0)return this;const{x:n,y:r}=this,i=Math.sin(e),s=Math.cos(e);return this.x=n*s-r*i,this.y=n*i+r*s,this}rotWith(e,n){if(n===0)return this;const r=this.x-e.x,i=this.y-e.y,s=Math.sin(n),o=Math.cos(n);return this.x=e.x+(r*o-i*s),this.y=e.y+(r*s+i*o),this}clone(){const{x:e,y:n,z:r}=this;return new M(e,n,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,n){return this.x-=e,this.y-=n,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,n){return this.x+=e,this.y+=n,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,n){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),n!==void 0&&(this.x=Math.min(this.x,n),this.y=Math.min(this.y,n)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,n){const r=M.Tan(e,this);return this.add(r.mul(n))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return M.Dpr(this,e)}cpr(e){return M.Cpr(this,e)}len2(){return M.Len2(this)}len(){return M.Len(this)}pry(e){return M.Pry(this,e)}per(){const{x:e,y:n}=this;return this.x=n,this.y=-e,this}uni(){const e=this.len();return e===0?this:(this.x/=e,this.y/=e,this)}tan(e){return this.sub(e).uni()}dist(e){return M.Dist(this,e)}distanceToLineSegment(e,n){return M.DistanceToLineSegment(e,n,this)}slope(e){return M.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return M.Angle(this,e)}toAngle(){return M.ToAngle(this)}lrp(e,n){return this.x=this.x+(e.x-this.x)*n,this.y=this.y+(e.y-this.y)*n,this}equals(e){return M.Equals(this,e)}equalsXY(e,n){return M.EqualsXY(this,e,n)}norm(){return this.uni()}toFixed(){return this.x=ic(this.x),this.y=ic(this.y),this}toString(){return M.ToString(M.ToFixed(this))}toJson(){return M.ToJson(this)}toArray(){return M.ToArray(this)}static Add(e,n){return new M(e.x+n.x,e.y+n.y)}static AddXY(e,n,r){return new M(e.x+n,e.y+r)}static Sub(e,n){return new M(e.x-n.x,e.y-n.y)}static SubXY(e,n,r){return new M(e.x-n,e.y-r)}static AddScalar(e,n){return new M(e.x+n,e.y+n)}static SubScalar(e,n){return new M(e.x-n,e.y-n)}static Div(e,n){return new M(e.x/n,e.y/n)}static Mul(e,n){return new M(e.x*n,e.y*n)}static DivV(e,n){return new M(e.x/n.x,e.y/n.y)}static MulV(e,n){return new M(e.x*n.x,e.y*n.y)}static Neg(e){return new M(-e.x,-e.y)}static Per(e){return new M(e.y,-e.x)}static Abs(e){return new M(Math.abs(e.x),Math.abs(e.y))}static Dist(e,n){return((e.y-n.y)**2+(e.x-n.x)**2)**.5}static ManhattanDist(e,n){return Math.abs(e.x-n.x)+Math.abs(e.y-n.y)}static DistMin(e,n,r){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)<r**2}static Dist2(e,n){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)}static Dpr(e,n){return e.x*n.x+e.y*n.y}static Cross(e,n){return new M(e.y*n.z-e.z*n.y,e.z*n.x-e.x*n.z)}static Cpr(e,n){return e.x*n.y-n.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,n){return M.Dpr(e,n)/M.Len(n)}static Uni(e){const n=M.Len(e);return new M(n===0?0:e.x/n,n===0?0:e.y/n)}static Tan(e,n){return M.Uni(M.Sub(e,n))}static Min(e,n){return new M(Math.min(e.x,n.x),Math.min(e.y,n.y))}static Max(e,n){return new M(Math.max(e.x,n.x),Math.max(e.y,n.y))}static From({x:e,y:n,z:r=1}){return new M(e,n,r)}static FromArray(e){return new M(e[0],e[1])}static Rot(e,n=0){const r=Math.sin(n),i=Math.cos(n);return new M(e.x*i-e.y*r,e.x*r+e.y*i)}static RotWith(e,n,r){const i=e.x-n.x,s=e.y-n.y,o=Math.sin(r),a=Math.cos(r);return new M(n.x+(i*a-s*o),n.y+(i*o+s*a))}static NearestPointOnLineThroughPoint(e,n,r){return M.Mul(n,M.Sub(r,e).pry(n)).add(e)}static NearestPointOnLineSegment(e,n,r,i=!0){if(M.Equals(e,r)||M.Equals(n,r))return M.From(r);const s=M.Tan(n,e),o=M.Add(e,M.Mul(s,M.Sub(r,e).pry(s)));if(i){if(o.x<Math.min(e.x,n.x))return M.Cast(e.x<n.x?e:n);if(o.x>Math.max(e.x,n.x))return M.Cast(e.x>n.x?e:n);if(o.y<Math.min(e.y,n.y))return M.Cast(e.y<n.y?e:n);if(o.y>Math.max(e.y,n.y))return M.Cast(e.y>n.y?e:n)}return o}static DistanceToLineThroughPoint(e,n,r){return M.Dist(r,M.NearestPointOnLineThroughPoint(e,n,r))}static DistanceToLineSegment(e,n,r,i=!0){return M.Dist(r,M.NearestPointOnLineSegment(e,n,r,i))}static Snap(e,n=1){return new M(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}static Cast(e){return e instanceof M?e:M.From(e)}static Slope(e,n){return e.x===n.y?NaN:(e.y-n.y)/(e.x-n.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,n){return Math.atan2(n.y-e.y,n.x-e.x)}static AngleBetween(e,n){const r=e.x*n.x+e.y*n.y,i=Math.sqrt((Math.pow(e.x,2)+Math.pow(e.y,2))*(Math.pow(n.x,2)+Math.pow(n.y,2)));return(e.x*n.y-e.y*n.x<0?-1:1)*Math.acos(Ct(r/i,-1,1))}static Lrp(e,n,r){return M.Sub(n,e).mul(r).add(e)}static Med(e,n){return new M((e.x+n.x)/2,(e.y+n.y)/2)}static Equals(e,n){return Math.abs(e.x-n.x)<1e-4&&Math.abs(e.y-n.y)<1e-4}static EqualsXY(e,n,r){return e.x===n&&e.y===r}static Clockwise(e,n,r){return(r.x-e.x)*(n.y-e.y)-(n.x-e.x)*(r.y-e.y)<0}static Rescale(e,n){const r=M.Len(e);return new M(n*e.x/r,n*e.y/r)}static ScaleWithOrigin(e,n,r){return M.Sub(e,r).mul(n).add(r)}static ToFixed(e){return new M(ic(e.x),ic(e.y))}static ToInt(e){return new M(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,n,r){return M.Add(e,M.Tan(n,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let n=Math.atan2(e.y,e.x);return n<0&&(n+=Math.PI*2),n}static FromAngle(e,n=1){return new M(Math.cos(e)*n,Math.sin(e)*n)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:n,y:r,z:i}=e;return{x:n,y:r,z:i}}static Average(e){const n=e.length,r=new M(0,0);if(n===0)return r;for(let i=0;i<n;i++)r.add(e[i]);return r.div(n)}static Clamp(e,n,r){return r===void 0?new M(Math.min(Math.max(e.x,n)),Math.min(Math.max(e.y,n))):new M(Math.min(Math.max(e.x,n),r),Math.min(Math.max(e.y,n),r))}static PointsBetween(e,n,r=6){const i=[];for(let s=0;s<r;s++){const o=Ms.easeInQuad(s/(r-1)),a=M.Lrp(e,n,o);a.z=Math.min(1,.5+Math.abs(.5-HGe(o))*.65),i.push(a)}return i}static SnapToGrid(e,n=8){return new M(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}}const HGe=t=>t<.5?2*t*t:-1+(4-2*t)*t;function Ji(t){return`${te(t.x)},${te(t.y)} `}function Vo(t,e){return`${te((t.x+e.x)/2)},${te((t.y+e.y)/2)} `}const un=Math.PI,Zn=un/2,Pn=un*2,VGe=Math.sin;function Ct(t,e,n){return Math.max(e,typeof n<"u"?Math.min(t,n):t)}function NC(t,e=1e10){return t?Math.round(t*e)/e:0}function Nr(t,e,n=1e-6){return Math.abs(t-e)<=n}function jC(t,e,n=1e-6){return t<e||Nr(t,e,n)}function WGe(t,e){const n=Math.pow(t-e,2)/Math.pow(t+e,2);return un*(t+e)*(1+3*n/(10+Math.sqrt(4-3*n)))}function qI(t){return t=t%Pn,t<0?t=t+Pn:t===0&&(t=0),t}function mU(t,e){return t=qI(t),e=qI(e),t>e&&(e+=Pn),e-t}function KGe(t,e){return Pn-mU(t,e)}function WE(t,e){const n=(e-t)%Pn;return 2*n%Pn-n}function V3(t){return(Pn+t)%Pn}function GI(t,e){const n=Pn/e;let r=Math.floor((V3(t)+n/2)/n)*n%Pn;return r<un&&(r+=Pn),r>un&&(r-=Pn),r}function Nhe(t,e){return t===e||Nr(t%(Math.PI/2)-e%(Math.PI/2),0)}function qGe(t){return t*un/180}function GGe(t){return t*180/un}function yU(t,e,n){return new M(t.x,t.y).add(M.FromAngle(n,e))}function Tj(t,e,n){const r=t/2,i=e/2,s=[];let o=1/0,a=-1/0,l=1/0,c=-1/0;for(let y=0;y<n;y++){const b=Pn/n,v=-Zn+y*b,x=r+r*Math.cos(v),C=i+i*Math.sin(v);x<o&&(o=x),C<l&&(l=C),x>a&&(a=x),C>c&&(c=C),s.push(new M(x,C))}const u=a-o,d=c-l,h=t-u,f=e-d;if(h!==0||f!==0)for(let y=0;y<s.length;y++){const b=s[y];b.x=(b.x-o)/u*t,b.y=(b.y-l)/d*e}return s}function ob(t,e,n,r){return t<r&&n<e}function tc(t,e,n,r){const i=Math.max(t,n),s=Math.min(e,r);return i<=s?[i,s]:null}function _Z(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}function po(t,e){let n=0,r,i;for(let s=0;s<e.length;s++){if(r=e[s],r.x===t.x&&r.y===t.y||(i=e[(s+1)%e.length],M.Dist(t,r)+M.Dist(t,i)===M.Dist(r,i)))return!0;r.y<=t.y?i.y>t.y&&_Z(r,i,t)>0&&(n+=1):i.y<=t.y&&_Z(r,i,t)<0&&(n-=1)}return n!==0}function te(t){return Math.round(t*1e4)/1e4}function ic(t){return Math.round(t*100)/100}const kZ=t=>Math.abs(t)<Number.MAX_SAFE_INTEGER;function AZ(t,e,n,r){let i;if(Math.abs(t)>un){i=WE(e,r);const s=WE(r,n);return Math.abs(i)<Math.abs(s)?i/t:(t-s)/t}else{i=WE(e,r);const s=i/t;return Math.sign(i)!==Math.sign(t)?Math.abs(s)>.5?1:0:s}}function YGe(t,e,n,r){const i=2*((e-t)%Pn)%Pn-(e-t)%Pn;return r?(Pn-Math.abs(i))*(n?1:-1):i}function jhe(t,e,n){const r=-2*(t.x*(e.y-n.y)-t.y*(e.x-n.x)+e.x*n.y-n.x*e.y),i=((t.x*t.x+t.y*t.y)*(n.y-e.y)+(e.x*e.x+e.y*e.y)*(t.y-n.y)+(n.x*n.x+n.y*n.y)*(e.y-t.y))/r,s=((t.x*t.x+t.y*t.y)*(e.x-n.x)+(e.x*e.x+e.y*e.y)*(n.x-t.x)+(n.x*n.x+n.y*n.y)*(t.x-e.x))/r;return!Number.isFinite(i)||!Number.isFinite(s)?null:new M(i,s)}const Ij=({brush:t,color:e,opacity:n,className:r})=>{const i=S.useRef(null);IS(i,t.x,t.y);const s=te(Math.max(1,t.w)),o=te(Math.max(1,t.h));return g.jsx("svg",{className:"tl-overlays__item",ref:i,"aria-hidden":"true",children:e?g.jsxs("g",{className:"tl-brush",opacity:n,children:[g.jsx("rect",{width:s,height:o,fill:e,opacity:.75}),g.jsx("rect",{width:s,height:o,fill:"none",stroke:e,opacity:.1})]}):g.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:s,height:o})})};var Pj={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var MZ;function XGe(){return MZ||(MZ=1,function(t){(function(){var e={}.hasOwnProperty;function n(){for(var s="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(s=i(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return n.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var a in s)e.call(s,a)&&s[a]&&(o=i(o,a));return o}function i(s,o){return o?s?s+" "+o:s+o:s}t.exports?(n.default=n,t.exports=n):window.classNames=n})()}(Pj)),Pj.exports}var JGe=XGe();const nt=Oi(JGe),sn={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1,hasCanvasSupport:!1};typeof window<"u"&&"navigator"in window&&(sn.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),sn.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),sn.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),sn.isFirefox=/firefox/i.test(navigator.userAgent),sn.isAndroid=/android/i.test(navigator.userAgent),sn.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,sn.hasCanvasSupport=typeof window<"u"&&"Promise"in window&&"HTMLCanvasElement"in window);const OZ={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.05,.1,.25,.5,1,2,4,8]},_j={duration:0,easing:Ms.easeInOutCubic},DZ={CAMERA_MOVE:-10},ZGe=["top","right","bottom","left"],RZ=0,vU=2,LC=1,NZ=5,QGe=128;var kj={};const eYe={},Lhe=ws("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),Jn={logPreventDefaults:ws("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:ws("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:ws("logElementRemoves",{defaults:{all:!1}}),debugSvg:ws("debugSvg",{defaults:{all:!1}}),showFps:ws("showFps",{defaults:{all:!1}}),measurePerformance:ws("measurePerformance",{defaults:{all:!1}}),throwToBlob:ws("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:ws("reconnectOnPing",{defaults:{all:!1}}),debugCursors:ws("debugCursors",{defaults:{all:!1}}),forceSrgb:ws("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:ws("debugGeometry",{defaults:{all:!1}}),hideShapes:ws("hideShapes",{defaults:{all:!1}}),editOnType:ws("editOnType",{defaults:{all:!1}}),a11y:ws("a11y",{defaults:{all:!1}}),debugElbowArrows:ws("debugElbowArrows",{defaults:{all:!1}})};if(typeof Element<"u"){const t=Element.prototype.removeChild;Ma("element removal logging",()=>{Jn.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),t.call(this,e)}:Element.prototype.removeChild=t})}function ws(t,{defaults:e,shouldStoreForSession:n=!0}){return tYe({name:t,defaults:e,shouldStoreForSession:n})}function tYe(t){const e=rYe(t),n=t.shouldStoreForSession?nYe(t.name):null,r=lr(`debug:${t.name}`,n??e);return typeof window<"u"&&(t.shouldStoreForSession&&Ma(`debug:${t.name}`,()=>{const i=r.get();i===e?Zue(`tldraw_debug:${t.name}`):Rz(`tldraw_debug:${t.name}`,JSON.stringify(i))}),Object.defineProperty(window,`tldraw${t.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return r.get()},set(i){r.set(i)},configurable:!0})),Object.assign(r,t,{reset:()=>r.set(e)})}function nYe(t){try{return JSON.parse(Jue(`tldraw_debug:${t}`)??"null")}catch{return null}}function Aj(t){try{return t()}catch{return null}}function rYe(t){switch(Aj(()=>kj.TLDRAW_ENV)??Aj(()=>kj.VERCEL_PUBLIC_TLDRAW_ENV)??Aj(()=>kj.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return t.defaults.production??t.defaults.all;case"preview":case"staging":return t.defaults.staging??t.defaults.all;default:return t.defaults.development??t.defaults.all}}function YI(t){if(t.nodeType===Node.ELEMENT_NODE)return t;if(t.parentElement)return YI(t.parentElement);throw Error("Could not find a parent element of an HTML type!")}function St(t){t.preventDefault(),Jn.logPreventDefaults.get()&&console.warn("preventDefault called on event:",t)}function PS(t,e){if(t.setPointerCapture(e.pointerId),Jn.logPointerCaptures.get()){const n=Lhe.get();n.set(t,(n.get(t)??0)+1),console.warn("setPointerCapture called on element:",t,e)}}function _S(t,e){if(t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),Jn.logPointerCaptures.get())){const n=Lhe.get();n.get(t)===1?n.delete(t):n.has(t)?n.set(t,n.get(t)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",t,e)}}const tr=t=>t.stopPropagation(),Ss=(t,e,n)=>{t&&t.style.setProperty(e,n)};function Fhe(t=!1){const{activeElement:e}=document,n=t?["input","textarea"]:["input","select","button","textarea"];return!!(e&&(e.isContentEditable||n.indexOf(e.tagName.toLowerCase())>-1||e.classList.contains("tlui-slider__thumb")))}const ni=t=>sn.isDarwin?t.metaKey:t.ctrlKey||t.metaKey;function wa(t){return t.isKilled=!0,{point:{x:t.clientX,y:t.clientY,z:t.pressure},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,metaKey:t.metaKey,accelKey:ni(t),pointerId:t.pointerId,button:t.button,isPen:t.pointerType==="pen"}}function bU(t,e){return Ok(`${t}_${e}`)}function Hg(t){return Ok(`${S.useId()}${t??""}`)}function fc(t){const e=Ps(S.useContext($he));return Ok(`${e}_${t}`)}function Ok(t){return t.replace(/:/g,"_")}const $he=S.createContext(null);function iYe({children:t}){const e=Hg();return g.jsx($he.Provider,{value:e,children:t})}const xU=S.createContext(null);function re(){const t=$e.useContext(xU);if(!t)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return t}function as(){return $e.useContext(xU)}function wU({editor:t,children:e}){return g.jsx(xU.Provider,{value:t,children:g.jsx(iYe,{children:e})})}function SU(){const t=re(),e=ie("current tool",()=>t.getCurrentTool(),[t]);return S.useMemo(function(){let i,s;function o(v){if(!v.isKilled){if(v.button===vU){t.dispatch({type:"pointer",target:"canvas",name:"right_click",...wa(v)});return}v.button!==0&&v.button!==1&&v.button!==5||(PS(v.currentTarget,v),t.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...wa(v)}))}}function a(v){if(v.isKilled||v.clientX===i&&v.clientY===s)return;i=v.clientX,s=v.clientY;const x=e.useCoalescedEvents&&v.nativeEvent.getCoalescedEvents?v.nativeEvent.getCoalescedEvents():[v];for(const C of x)t.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...wa(C)})}function l(v){v.isKilled||v.button!==0&&v.button!==1&&v.button!==2&&v.button!==5||(i=v.clientX,s=v.clientY,_S(v.currentTarget,v),t.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...wa(v)}))}function c(v){if(v.isKilled||t.getInstanceState().isPenMode&&v.pointerType!=="pen")return;const x=v.pointerType==="mouse"||v.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:x?!0:null})}function u(v){if(v.isKilled||t.getInstanceState().isPenMode&&v.pointerType!=="pen")return;const x=v.pointerType==="mouse"||v.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:x?!1:null})}function d(v){v.isKilled=!0,St(v)}function h(v){v.isKilled=!0,v.target instanceof HTMLElement&&v.target.tagName!=="A"&&v.target.tagName!=="TEXTAREA"&&!v.target.isContentEditable&&!(t.getEditingShape()&&v.target.className.includes("tl-text-content"))&&St(v)}function f(v){St(v)}async function y(v){var C,E;if(St(v),tr(v),(E=(C=v.dataTransfer)==null?void 0:C.files)!=null&&E.length){const I=Array.from(v.dataTransfer.files);await t.putExternalContent({type:"files",files:I,point:t.screenToPage({x:v.clientX,y:v.clientY})});return}const x=v.dataTransfer.getData("url");if(x){await t.putExternalContent({type:"url",url:x,point:t.screenToPage({x:v.clientX,y:v.clientY})});return}}function b(v){tr(v)}return{onPointerDown:o,onPointerMove:a,onPointerUp:l,onPointerEnter:c,onPointerLeave:u,onDragOver:f,onDrop:y,onTouchStart:d,onTouchEnd:h,onClick:b}},[t,e])}function sYe(){const t=re();S.useEffect(()=>{let e=t.getInstanceState().isCoarsePointer;const n=o=>{const a=o.pointerType!=="mouse";e!==a&&(e=a,t.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",n,{capture:!0});const r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),i=sn.isFirefox&&!sn.isAndroid&&!sn.isIos,s=()=>{const o=i?!1:r.matches;e===o&&(e=o,t.updateInstanceState({isCoarsePointer:o}))};return r&&(r.addEventListener("change",s),s()),()=>{window.removeEventListener("pointerdown",n,{capture:!0}),r&&r.removeEventListener("change",s)}},[t])}const Bhe=S.createContext(null);function zhe({container:t,children:e}){return g.jsx(Bhe.Provider,{value:t,children:e})}function Fr(){return Ps(S.useContext(Bhe),"useContainer used outside of <Tldraw />")}function oYe(){const t=re(),e=Fr(),n=ie("isEditing",()=>t.getEditingShapeId(),[t]),r=ie("isFocused",()=>t.getIsFocused(),[t]);S.useEffect(()=>{if(!e)return;function i(s){if(s.isSpecialRedispatchedEvent)return;St(s),tr(s);const o=e.querySelector(".tl-canvas");if(!o)return;const a=new DragEvent(s.type,s);a.isSpecialRedispatchedEvent=!0,o.dispatchEvent(a)}return e.addEventListener("dragover",i),e.addEventListener("drop",i),()=>{e.removeEventListener("dragover",i),e.removeEventListener("drop",i)}},[e]),S.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let i=null;const s=()=>{i!=null&&i();const o=`(resolution: ${window.devicePixelRatio}dppx)`,a=matchMedia(o),l=c=>{c.type==="change"&&s()};a.addEventListener?a.addEventListener("change",s):a.addListener&&a.addListener(l),i=()=>{a.removeEventListener?a.removeEventListener("change",s):a.removeListener&&a.removeListener(l)},t.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return s(),()=>{i==null||i()}},[t]),S.useEffect(()=>{if(!r)return;const i=l=>{if(l.altKey&&(t.isIn("zoom")||!t.getPath().endsWith(".idle"))&&!ab(t)&&St(l),l.isKilled)return;l.isKilled=!0;const c=!!t.getSelectedShapeIds().length;switch(l.key){case"=":case"-":case"0":{if(l.metaKey||l.ctrlKey){St(l);return}break}case"Tab":{if(ab(t))return;c&&!n&&St(l);break}case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{if(ab(t))return;c&&(l.metaKey||l.ctrlKey)&&St(l);break}case",":return;case"Escape":{if((t.getEditingShape()||t.getSelectedShapeIds().length>0)&&St(l),t.menus.getOpenMenus().length>0)return;t.inputs.keys.has("Escape")||(t.inputs.keys.add("Escape"),t.cancel(),e.focus());return}default:if(ab(t))return}const u={type:"keyboard",name:l.repeat?"key_repeat":"key_down",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:ni(l)};t.dispatch(u)},s=l=>{if(l.isKilled||(l.isKilled=!0,ab(t))||l.key===",")return;const c={type:"keyboard",name:"key_up",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:ni(l)};t.dispatch(c)};function o(l){var c,u;if(e.contains(l.target)){const d=l.touches[0].pageX,h=l.touches[0].radiusX||0;(d-h<10||d+h>t.getViewportScreenBounds().width-10)&&(((c=l.target)==null?void 0:c.tagName)==="BUTTON"&&((u=l.target)==null||u.click()),St(l))}}const a=l=>{e.contains(l.target)&&(l.ctrlKey||l.metaKey)&&St(l)};return e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("wheel",a,{passive:!1}),document.addEventListener("gesturestart",St),document.addEventListener("gesturechange",St),document.addEventListener("gestureend",St),e.addEventListener("keydown",i),e.addEventListener("keyup",s),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("wheel",a),document.removeEventListener("gesturestart",St),document.removeEventListener("gesturechange",St),document.removeEventListener("gestureend",St),e.removeEventListener("keydown",i),e.removeEventListener("keyup",s)}},[t,e,r,n])}function ab(t){return t.menus.hasOpenMenus()||Fhe()}function aYe({className:t,zoom:e,point:n,color:r,viewport:i,opacity:s=1}){const o=S.useRef(null);IS(o,Ct(n.x,i.minX+5/e,i.maxX-5/e),Ct(n.y,i.minY+5/e,i.maxY-5/e),1/e,M.Angle(i.center,n));const a=fc("cursor_hint");return g.jsxs("svg",{ref:o,className:nt("tl-overlays__item",t),"aria-hidden":"true",children:[g.jsx("use",{href:`#${a}`,color:r,strokeWidth:3,stroke:"var(--color-background)"}),g.jsx("use",{href:`#${a}`,color:r,opacity:s})]})}const jZ=S.memo(function({className:e,zoom:n,point:r,color:i,name:s,chatMessage:o}){const a=S.useRef(null);IS(a,r==null?void 0:r.x,r==null?void 0:r.y,1/n);const l=fc("cursor");return r?g.jsxs("div",{ref:a,className:nt("tl-overlays__item",e),children:[g.jsx("svg",{className:"tl-cursor","aria-hidden":"true",children:g.jsx("use",{href:`#${l}`,color:i})}),o?g.jsxs(g.Fragment,{children:[s&&g.jsx("div",{className:"tl-nametag-title",style:{color:i},children:s}),g.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:o})]}):s&&g.jsx("div",{className:"tl-nametag",style:{backgroundColor:i},children:s})]}):null}),Dk={openWindow(t,e){window.open(t,e,"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){var t;return await((t=window.__tldraw__hardReset)==null?void 0:t.call(window))}};function Uhe(){Dk.hardReset()}function lYe(){Dk.refreshPage()}const cYe={error:null};class CU extends S.Component{constructor(){super(...arguments);N(this,"state",cYe)}static getDerivedStateFromError(n){return{error:n}}componentDidCatch(n){var r,i;(i=(r=this.props).onError)==null||i.call(r,n)}render(){const{error:n}=this.state;if(n!==null){const{fallback:r}=this.props;return g.jsx(r,{error:n})}return this.props.children}}function cw({children:t,fallback:e,...n}){return e===null?t:g.jsx(CU,{fallback:e,...n,children:t})}const uYe="https://github.com/tldraw/tldraw/issues/new",Hhe=({error:t,editor:e})=>{const n=S.useRef(null),[r,i]=S.useState(!1),[s,o]=S.useState(!1),[a,l]=S.useState(!1);let c=null;try{c=Cn().Canvas??null}catch{}const u=t instanceof Error?t.message:String(t),d=t instanceof Error?t.stack:null,h=ie("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[f,y]=S.useState(null);S.useLayoutEffect(()=>{var P;h!==null&&y(h);let E=(P=n.current)==null?void 0:P.parentElement,I=!1;for(;E;){if(E.classList.contains("tl-theme__dark")||E.classList.contains("tl-theme__light")){I=!0;break}E=E.parentElement}if(I){y(null);return}typeof window<"u"&&"matchMedia"in window&&y(window.matchMedia("(prefers-color-scheme: dark)").matches)},[h]),S.useEffect(()=>{if(s){const E=e==null?void 0:e.timers.setTimeout(()=>{o(!1)},2e3);return()=>clearTimeout(E)}},[s,e]);const b=()=>{const E=document.createElement("textarea");E.value=d??u,document.body.appendChild(E),E.select(),document.execCommand("copy"),E.remove(),o(!0)},v=()=>{lYe()},x=async()=>{Uhe()},C=new URL(uYe);return C.searchParams.set("title",u),C.searchParams.set("labels","bug"),C.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${d??u}
\`\`\`

My browser: ${navigator.userAgent}`),g.jsxs("div",{ref:n,className:nt("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[g.jsx("div",{className:"tl-error-boundary__overlay"}),e&&g.jsx(CU,{onError:nw,fallback:()=>null,children:g.jsx(wU,{editor:e,children:g.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:c?g.jsx(c,{}):null})})}),g.jsx("div",{className:nt("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Are you sure?"}),g.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{className:"tlui-button",onClick:()=>l(!1),children:"Cancel"}),g.jsx("button",{className:"tlui-button tl-error-boundary__reset",onClick:x,children:"Reset data"})]})]}):g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Something went wrong"}),g.jsx("p",{children:"Please refresh your browser."}),g.jsx("p",{children:"If the issue continues after refreshing, you may need to reset the tldraw data stored on your device."}),g.jsxs("p",{children:[g.jsx("strong",{children:"Note:"})," Resetting will erase your current project and any unsaved work."]}),!1,r&&g.jsxs(g.Fragment,{children:["Message:",g.jsx("h4",{children:g.jsx("code",{children:u})}),"Stack trace:",g.jsxs("div",{className:"tl-error-boundary__content__error",children:[g.jsx("pre",{children:g.jsx("code",{children:d??u})}),g.jsx("button",{className:"tlui-button",onClick:b,children:s?"Copied!":"Copy"})]})]}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{className:"tlui-button",onClick:()=>i(!r),children:r?"Hide details":"Show details"}),g.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[g.jsx("button",{className:"tlui-button tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),g.jsx("button",{className:"tlui-button tl-error-boundary__refresh",onClick:v,children:"Refresh Page"})]})]})]})})]})};function dYe({x:t,y:e,z:n,size:r}){const i=Hg("grid"),s=re(),{gridSteps:o}=s.options;return g.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[g.jsx("defs",{children:o.map(({min:a,mid:l,step:c},u)=>{const d=c*r*n,h=.5+t*n,f=.5+e*n,y=h>0?h%d:d+h%d,b=f>0?f%d:d+f%d,v=n<l?yu(n,[a,l],[0,1]):1;return g.jsx("pattern",{id:bU(i,`${c}`),width:d,height:d,patternUnits:"userSpaceOnUse",children:g.jsx("circle",{className:"tl-grid-dot",cx:y,cy:b,r:1,opacity:v})},u)})}),o.map(({step:a},l)=>g.jsx("rect",{width:"100%",height:"100%",fill:`url(#${i}_${a})`},l))]})}function hYe({handle:t,isCoarse:e,className:n,zoom:r}){const i=re(),s=(e?i.options.coarseHandleRadius:i.options.handleRadius)/r;if(t.type==="clone"){const a=3/r,l=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,c=ZGe.indexOf(t.id);return g.jsxs("g",{className:nt(`tl-handle tl-handle__${t.type}`,n),children:[g.jsx("circle",{className:"tl-handle__bg",r:s}),g.jsx("path",{className:"tl-handle__fg",d:l,transform:`rotate(${-90+90*c})`})]})}const o=(t.type==="create"&&e?3:4)/Math.max(r,.25);return g.jsxs("g",{className:nt(`tl-handle tl-handle__${t.type}`,n),children:[g.jsx("circle",{className:"tl-handle__bg",r:s}),g.jsx("circle",{className:"tl-handle__fg",r:o})]})}const fYe=({children:t})=>g.jsx("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:t}),Vhe="3.15.3",LZ={major:"2024-09-13T14:36:29.063Z",minor:"2025-07-30T09:07:27.887Z"};function Whe(t,e){const n=S.useRef(t);return e(t,n.current)?n.current:(n.current=t,t)}const pYe=(t,e)=>(t??(t=null),e??(e=null),t===e?!0:!t||!e?!1:kI(t,e));function Bh(t){return Whe(t,pYe)}const gYe=(t,e)=>(t??(t=null),e??(e=null),t===e?!0:!t||!e?!1:Lue(t,e));function Fv(t){return Whe(t,gYe)}const Khe="TLDRAW_USER_DATA_v3",qhe=Vt({id:Rt,name:Rt.nullable().optional(),color:Rt.nullable().optional(),locale:Rt.nullable().optional(),animationSpeed:yt.nullable().optional(),areKeyboardShortcutsEnabled:Ft.nullable().optional(),edgeScrollSpeed:yt.nullable().optional(),colorScheme:Lv("light","dark","system").optional(),isSnapMode:Ft.nullable().optional(),isWrapMode:Ft.nullable().optional(),isDynamicSizeMode:Ft.nullable().optional(),isPasteAtCursorMode:Ft.nullable().optional()}),qc={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8,AddKeyboardShortcuts:9},EU=Math.max(...Object.values(qc));function mYe(t){t.version<qc.AddAnimationSpeed&&(t.user.animationSpeed=1),t.version<qc.AddIsSnapMode&&(t.user.isSnapMode=!1),t.version<qc.MakeFieldsNullable,t.version<qc.AddEdgeScrollSpeed&&(t.user.edgeScrollSpeed=1),t.version<qc.AddExcalidrawSelectMode&&(t.user.isWrapMode=!1),t.version<qc.AllowSystemColorScheme&&(t.user.isDarkMode===!0?t.user.colorScheme="dark":t.user.isDarkMode===!1&&(t.user.colorScheme="light"),delete t.user.isDarkMode),t.version<qc.AddDynamicSizeMode&&(t.user.isDynamicSizeMode=!1),t.version<qc.AddPasteAtCursor&&(t.user.isPasteAtCursorMode=!1),t.version<qc.AddKeyboardShortcuts&&(t.user.areKeyboardShortcutsEnabled=!0),t.version=EU}const W3=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function Ghe(){return W3[Math.floor(Math.random()*W3.length)]}function yYe(){var t,e;return typeof window<"u"&&"matchMedia"in window?((e=(t=window.matchMedia)==null?void 0:t.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const hl=Object.freeze({name:"",locale:$Ge(),color:Ghe(),edgeScrollSpeed:1,animationSpeed:yYe()?0:1,areKeyboardShortcutsEnabled:!0,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"light"});function Mj(){return{id:fn(),color:Ghe()}}function Yhe(t){if(t===null||typeof t!="object"||!("version"in t)||!("user"in t)||typeof t.version!="number")return Mj();const e=ar(t);mYe(e);try{return qhe.validate(e.user)}catch{return Mj()}}function vYe(){const t=JSON.parse(Oz(Khe)||"null")??null;return Yhe(t)}const Rk=lr("globalUserData",null);function bYe(){Dz(Khe,JSON.stringify({version:EU,user:Rk.get()}))}function Xhe(t){qhe.validate(t),Rk.set(t),bYe(),xYe()}const hy=typeof BroadcastChannel<"u"?new BroadcastChannel("tldraw-user-sync"):null;hy==null||hy.addEventListener("message",t=>{const e=t.data;(e==null?void 0:e.type)===Zhe&&(e==null?void 0:e.origin)!==Jhe()&&Rk.set(Yhe(e.data))});let Oj=null;function Jhe(){return Oj===null&&(Oj=fn()),Oj}const Zhe="tldraw-user-preferences-change";function xYe(){hy==null||hy.postMessage({type:Zhe,origin:Jhe(),data:{user:Qhe(),version:EU}})}function Qhe(){let t=Rk.get();return t||(t=vYe(),Xhe(t)),t}const wYe=me("defaultLocalStorageUserPrefs",()=>Qhe());function efe(t={}){return{userPreferences:t.userPreferences??wYe,setUserPreferences:t.setUserPreferences??Xhe}}var Dj={exports:{}},FZ;function SYe(){return FZ||(FZ=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,d||l,h),y=n?n+c:c;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],f]:l._events[y].push(f):(l._events[y]=f,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=n?n+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,y=new Array(f);h<f;h++)y[h]=d[h].fn;return y},a.prototype.listenerCount=function(c){var u=n?n+c:c,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,h,f,y){var b=n?n+c:c;if(!this._events[b])return!1;var v=this._events[b],x=arguments.length,C,E;if(v.fn){switch(v.once&&this.removeListener(c,v.fn,void 0,!0),x){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,d),!0;case 4:return v.fn.call(v.context,u,d,h),!0;case 5:return v.fn.call(v.context,u,d,h,f),!0;case 6:return v.fn.call(v.context,u,d,h,f,y),!0}for(E=1,C=new Array(x-1);E<x;E++)C[E-1]=arguments[E];v.fn.apply(v.context,C)}else{var I=v.length,P;for(E=0;E<I;E++)switch(v[E].once&&this.removeListener(c,v[E].fn,void 0,!0),x){case 1:v[E].fn.call(v[E].context);break;case 2:v[E].fn.call(v[E].context,u);break;case 3:v[E].fn.call(v[E].context,u,d);break;case 4:v[E].fn.call(v[E].context,u,d,h);break;default:if(!C)for(P=1,C=new Array(x-1);P<x;P++)C[P-1]=arguments[P];v[E].fn.apply(v[E].context,C)}}return!0},a.prototype.on=function(c,u,d){return s(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return s(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,h){var f=n?n+c:c;if(!this._events[f])return this;if(!u)return o(this,f),this;var y=this._events[f];if(y.fn)y.fn===u&&(!h||y.once)&&(!d||y.context===d)&&o(this,f);else{for(var b=0,v=[],x=y.length;b<x;b++)(y[b].fn!==u||h&&!y[b].once||d&&y[b].context!==d)&&v.push(y[b]);v.length?this._events[f]=v.length===1?v[0]:v:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=n?n+c:c,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}(Dj)),Dj.exports}var CYe=SYe();const EYe=Oi(CYe),fy="TLDRAW_TAB_ID_v2",hd=globalThis.window;function TYe(){return hd?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(hd.navigator.platform)||sn.isDarwin&&"ontouchend"in document:!1}const XI=hd?hd[fy]??Jue(fy)??"TLDRAW_INSTANCE_STATE_V1_"+fn():"<error>";hd&&(hd[fy]=XI,TYe()?Rz(fy,XI):Zue(fy));hd==null||hd.addEventListener("beforeunload",()=>{Rz(fy,XI)});const tfe={Initial:0},Nk=Math.max(...Object.values(tfe));function IYe(t){t.version<tfe.Initial,t.version=Nk}const nfe=Vt({version:yt,currentPageId:aw.optional(),isFocusMode:Ft.optional(),exportBackground:Ft.optional(),isDebugMode:Ft.optional(),isToolLocked:Ft.optional(),isGridMode:Ft.optional(),pageStates:Si(Vt({pageId:aw,camera:Vt({x:yt,y:yt,z:yt}).optional(),selectedShapeIds:Si(pl).optional(),focusedGroupId:pl.nullable().optional()})).optional()});function PYe(t){if(!t||typeof t!="object")return console.warn("Invalid instance state"),null;if(!("version"in t)||typeof t.version!="number")return console.warn("No version in instance state"),null;t.version!==Nk&&(t=ar(t),IYe(t));try{return nfe.validate(t)}catch(e){return console.warn(e),null}}function TU(t){const e=t.query.ids("page");return me("sessionStateSnapshot",()=>{const n=t.get(so);if(!n)return null;const r=[...e.get()];return{version:Nk,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(i=>{const s=t.get(cc.createId(i)),o=t.get(ru.createId(i));return{pageId:i,camera:{x:(o==null?void 0:o.x)??0,y:(o==null?void 0:o.y)??0,z:(o==null?void 0:o.z)??1},selectedShapeIds:(s==null?void 0:s.selectedShapeIds)??[],focusedGroupId:(s==null?void 0:s.focusedGroupId)??null}})}},{isEqual:Af})}function K3(t,e,n){const r=PYe(e);if(!r)return;const i=che(t.get(so)),s=n!=null&&n.forceOverwrite?r:i,o=n!=null&&n.forceOverwrite?i:r,a=t.schema.types.instance.create({id:so,...i,currentPageId:r.currentPageId,isDebugMode:(s==null?void 0:s.isDebugMode)??(o==null?void 0:o.isDebugMode),isFocusMode:(s==null?void 0:s.isFocusMode)??(o==null?void 0:o.isFocusMode),isToolLocked:(s==null?void 0:s.isToolLocked)??(o==null?void 0:o.isToolLocked),isGridMode:(s==null?void 0:s.isGridMode)??(o==null?void 0:o.isGridMode),exportBackground:(s==null?void 0:s.exportBackground)??(o==null?void 0:o.exportBackground)});t.atomic(()=>{var l,c,u;for(const d of r.pageStates??[]){if(!t.has(d.pageId))continue;const h=ru.createId(d.pageId),f=cc.createId(d.pageId),y=t.get(h),b=t.get(f);t.put([ru.create({id:h,x:((l=d.camera)==null?void 0:l.x)??(y==null?void 0:y.x),y:((c=d.camera)==null?void 0:c.y)??(y==null?void 0:y.y),z:((u=d.camera)==null?void 0:u.z)??(y==null?void 0:y.z)}),cc.create({id:f,pageId:d.pageId,selectedShapeIds:d.selectedShapeIds??(b==null?void 0:b.selectedShapeIds),focusedGroupId:d.focusedGroupId??(b==null?void 0:b.focusedGroupId)})])}t.put([a]),t.ensureStoreIsUsable()})}function _Ye(t){var i;const e=[];for(const s of Object.values(t))(i=s.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&e.push(s);const n=e.filter(s=>s.typeName==="instance"&&s.id!==so)[0];if(!n)return null;const r={version:Nk,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:e.filter(s=>s.typeName==="instance_page_state"&&s.instanceId===n.id).map(s=>{const o=t[s.cameraId]??{x:0,y:0,z:1};return{pageId:s.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId}})};try{return nfe.validate(r),r}catch{return null}}function IU(t,e,n){let r={};if("store"in e){const o=t.schema.migrateStoreSnapshot(e);if(o.type!=="success")throw new Error("Failed to migrate store snapshot: "+o.reason);r.document={schema:t.schema.serialize(),store:ox(o.value,(a,{typeName:l})=>t.scopedTypes.document.has(l))}}else r=e;const i=che(t.get(so)),s=rfe.get(t,TU).get();t.atomic(()=>{r.document&&t.loadStoreSnapshot(r.document),i&&t.update(so,o=>({...o,...i})),s&&K3(t,s),r.session&&K3(t,r.session,{forceOverwrite:n==null?void 0:n.forceOverwriteSessionState})})}const rfe=new zs;function ife(t){const n=rfe.get(t,TU).get();if(!n)throw new Error("Session state is not ready yet");return{document:t.getStoreSnapshot(),session:n}}function sfe(t){const e=[],n=new Set;for(const r of t){if(n.has(r.type))throw new Error(`Binding type "${r.type}" is defined more than once`);e.push(r),n.add(r.type)}return e}function pf({children:t,className:e="",...n}){return g.jsx("svg",{...n,className:nt("tl-svg-container",e),"aria-hidden":"true",children:t})}class Ee{constructor(e=0,n=0,r=0,i=0){N(this,"x",0);N(this,"y",0);N(this,"w",0);N(this,"h",0);this.x=e,this.y=n,this.w=r,this.h=i}get point(){return new M(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get left(){return this.x}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get right(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get top(){return this.y}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get bottom(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new M(this.x+this.w/2,this.y+this.h/2)}set center(e){this.x=e.x-this.w/2,this.y=e.y-this.h/2}get corners(){return[new M(this.x,this.y),new M(this.x+this.w,this.y),new M(this.x+this.w,this.y+this.h),new M(this.x,this.y+this.h)]}get cornersAndCenter(){return[new M(this.x,this.y),new M(this.x+this.w,this.y),new M(this.x+this.w,this.y+this.h),new M(this.x,this.y+this.h),new M(this.x+this.w/2,this.y+this.h/2)]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new M(this.w,this.h)}toFixed(){return this.x=NC(this.x),this.y=NC(this.y),this.w=NC(this.w),this.h=NC(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,n=0,r=0,i=0){return this.x=e,this.y=n,this.w=r,this.h=i,this}expand(e){const n=Math.min(this.x,e.x),r=Math.min(this.y,e.y),i=Math.max(this.x+this.w,e.x+e.w),s=Math.max(this.y+this.h,e.y+e.h);return this.x=n,this.y=r,this.w=i-n,this.h=s-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:n,w:r,h:i}=this;return new Ee(e,n,r,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const n=Math.round(this.x/e)*e,r=Math.round(this.y/e)*e,i=Math.round((this.x+this.w)/e)*e,s=Math.round((this.y+this.h)/e)*e;this.minX=n,this.minY=r,this.width=Math.max(1,i-n),this.height=Math.max(1,s-r)}collides(e){return Ee.Collides(this,e)}contains(e){return Ee.Contains(this,e)}includes(e){return Ee.Includes(this,e)}containsPoint(e,n=0){return Ee.ContainsPoint(this,e,n)}getHandlePoint(e){switch(e){case"top_left":return new M(this.x,this.y);case"top_right":return new M(this.x+this.w,this.y);case"bottom_left":return new M(this.x,this.y+this.h);case"bottom_right":return new M(this.x+this.w,this.y+this.h);case"top":return new M(this.x+this.w/2,this.y);case"right":return new M(this.x+this.w,this.y+this.h/2);case"bottom":return new M(this.x+this.w/2,this.y+this.h);case"left":return new M(this.x,this.y+this.h/2)}}toJson(){return{x:this.x,y:this.y,w:this.w,h:this.h}}resize(e,n,r){const{minX:i,minY:s,maxX:o,maxY:a}=this;let{minX:l,minY:c,maxX:u,maxY:d}=this;switch(e){case"left":case"top_left":case"bottom_left":{l+=n;break}case"right":case"top_right":case"bottom_right":{u+=n;break}}switch(e){case"top":case"top_left":case"top_right":{c+=r;break}case"bottom":case"bottom_left":case"bottom_right":{d+=r;break}}const h=(u-l)/(o-i),f=(d-c)/(a-s),y=h<0,b=f<0;if(y){const v=u;u=l,l=v}if(b){const v=d;d=c,c=v}this.minX=l,this.minY=c,this.width=Math.abs(u-l),this.height=Math.abs(d-c)}union(e){const n=Math.min(this.x,e.x),r=Math.min(this.y,e.y),i=Math.max(this.x+this.w,e.x+e.w),s=Math.max(this.y+this.h,e.y+e.h);return this.x=n,this.y=r,this.width=i-n,this.height=s-r,this}static From(e){return new Ee(e.x,e.y,e.w,e.h)}static FromCenter(e,n){return new Ee(e.x-n.x/2,e.y-n.y/2,n.x,n.y)}static FromPoints(e){if(e.length===0)return new Ee;let n=1/0,r=1/0,i=-1/0,s=-1/0,o;for(let a=0,l=e.length;a<l;a++)o=e[a],n=Math.min(o.x,n),r=Math.min(o.y,r),i=Math.max(o.x,i),s=Math.max(o.y,s);return new Ee(n,r,i-n,s-r)}static Expand(e,n){const r=Math.min(n.minX,e.minX),i=Math.min(n.minY,e.minY),s=Math.max(n.maxX,e.maxX),o=Math.max(n.maxY,e.maxY);return new Ee(r,i,s-r,o-i)}static ExpandBy(e,n){return new Ee(e.minX-n,e.minY-n,e.width+n*2,e.height+n*2)}static Collides(e,n){return!(e.maxX<n.minX||e.minX>n.maxX||e.maxY<n.minY||e.minY>n.maxY)}static Contains(e,n){return e.minX<n.minX&&e.minY<n.minY&&e.maxY>n.maxY&&e.maxX>n.maxX}static Includes(e,n){return Ee.Collides(e,n)||Ee.Contains(e,n)}static ContainsPoint(e,n,r=0){return!(n.x<e.minX-r||n.y<e.minY-r||n.x>e.maxX+r||n.y>e.maxY+r)}static Common(e){let n=1/0,r=1/0,i=-1/0,s=-1/0;for(let o=0;o<e.length;o++){const a=e[o];n=Math.min(n,a.minX),r=Math.min(r,a.minY),i=Math.max(i,a.maxX),s=Math.max(s,a.maxY)}return new Ee(n,r,i-n,s-r)}static Sides(e,n=0){const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]}static Resize(e,n,r,i,s=!1){const{minX:o,minY:a,maxX:l,maxY:c}=e;let{minX:u,minY:d,maxX:h,maxY:f}=e;switch(n){case"left":case"top_left":case"bottom_left":{u+=r;break}case"right":case"top_right":case"bottom_right":{h+=r;break}}switch(n){case"top":case"top_left":case"top_right":{d+=i;break}case"bottom":case"bottom_left":case"bottom_right":{f+=i;break}}const y=(h-u)/(l-o),b=(f-d)/(c-a),v=y<0,x=b<0;if(s){const E=(l-o)/(c-a),I=Math.abs(h-u),P=Math.abs(f-d),_=I*(b<0?1:-1)*(1/E),A=P*(y<0?1:-1)*E,D=E<I/P;switch(n){case"top_left":{D?d=f+_:u=h+A;break}case"top_right":{D?d=f+_:h=u-A;break}case"bottom_right":{D?f=d-_:h=u-A;break}case"bottom_left":{D?f=d-_:u=h+A;break}case"bottom":case"top":{const L=(u+h)/2,z=P*E;u=L-z/2,h=L+z/2;break}case"left":case"right":{const L=(d+f)/2,z=I/E;d=L-z/2,f=L+z/2;break}}}if(v){const E=h;h=u,u=E}if(x){const E=f;f=d,d=E}const C=new Ee(u,d,Math.abs(h-u),Math.abs(f-d));return{box:C,scaleX:+(C.width/e.width*(y>0?1:-1)).toFixed(5),scaleY:+(C.height/e.height*(b>0?1:-1)).toFixed(5)}}equals(e){return Ee.Equals(this,e)}static Equals(e,n){return n.x===e.x&&n.y===e.y&&n.w===e.w&&n.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new Ee(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function kYe(t){switch(t){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return t}}function AYe(t){switch(t){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return t}}function MYe(t){return t==="top_left"||t==="top_right"||t==="bottom_right"||t==="bottom_left"}class xe{constructor(e,n,r,i,s,o){N(this,"a",1);N(this,"b",0);N(this,"c",0);N(this,"d",1);N(this,"e",0);N(this,"f",0);this.a=e,this.b=n,this.c=r,this.d=i,this.e=s,this.f=o}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const n=e,{a:r,b:i,c:s,d:o,e:a,f:l}=this;return this.a=r*n.a+s*n.b,this.c=r*n.c+s*n.d,this.e=r*n.e+s*n.f+a,this.b=i*n.a+o*n.b,this.d=i*n.c+o*n.d,this.f=i*n.e+o*n.f+l,this}rotate(e,n,r){return e===0?this:n===void 0?this.multiply(xe.Rotate(e)):this.translate(n,r).multiply(xe.Rotate(e)).translate(-n,-r)}translate(e,n){return this.multiply(xe.Translate(e,n))}scale(e,n){return this.multiply(xe.Scale(e,n))}invert(){const{a:e,b:n,c:r,d:i,e:s,f:o}=this,a=e*i-n*r;return this.a=i/a,this.b=n/-a,this.c=r/-a,this.d=e/a,this.e=(i*s-r*o)/-a,this.f=(n*s-e*o)/a,this}applyToPoint(e){return xe.applyToPoint(this,e)}applyToPoints(e){return xe.applyToPoints(this,e)}rotation(){return xe.Rotation(this)}point(){return xe.Point(this)}decomposed(){return xe.Decompose(this)}toCssString(){return xe.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return xe.Decompose(this)}clone(){return new xe(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new xe(1,0,0,1,0,0)}static Translate(e,n){return new xe(1,0,0,1,e,n)}static Rotate(e,n,r){if(e===0)return xe.Identity();const i=Math.cos(e),s=Math.sin(e),o=new xe(i,s,-s,i,0,0);return n===void 0?o:xe.Compose(xe.Translate(n,r),o,xe.Translate(-n,-r))}static Scale(e,n,r,i){const s=new xe(e,0,0,n,0,0);return r===void 0?s:xe.Translate(r,i).multiply(s).translate(-r,-i)}static Multiply(e,n){return{a:e.a*n.a+e.c*n.b,c:e.a*n.c+e.c*n.d,e:e.a*n.e+e.c*n.f+e.e,b:e.b*n.a+e.d*n.b,d:e.b*n.c+e.d*n.d,f:e.b*n.e+e.d*n.f+e.f}}static Inverse(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/-n,f:(e.b*e.e-e.a*e.f)/n}}static Absolute(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/n,f:(e.b*e.e-e.a*e.f)/-n}}static Compose(...e){const n=xe.Identity();for(let r=0,i=e.length;r<i;r++)n.multiply(e[r]);return n}static Point(e){return new M(e.e,e.f)}static Rotation(e){let n;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;n=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;n=Zn+Math.acos(e.b/r)*(e.d>0?-1:1)}else n=0;return V3(n)}static Decompose(e){let n,r,i;if(e.a!==0||e.c!==0){const s=(e.a*e.a+e.c*e.c)**.5;n=s,r=(e.a*e.d-e.b*e.c)/s,i=Math.acos(e.a/s)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const s=(e.b*e.b+e.d*e.d)**.5;n=(e.a*e.d-e.b*e.c)/s,r=s,i=Zn+Math.acos(e.b/s)*(e.d>0?-1:1)}else n=0,r=0,i=0;return{x:e.e,y:e.f,scaleX:n,scaleY:r,rotation:V3(i)}}static Smooth(e,n=1e10){return e.a=Math.round(e.a*n)/n,e.b=Math.round(e.b*n)/n,e.c=Math.round(e.c*n)/n,e.d=Math.round(e.d*n)/n,e.e=Math.round(e.e*n)/n,e.f=Math.round(e.f*n)/n,e}static toCssString(e){return`matrix(${te(e.a)}, ${te(e.b)}, ${te(e.c)}, ${te(e.d)}, ${te(e.e)}, ${te(e.f)})`}static applyToPoint(e,n){return new M(e.a*n.x+e.c*n.y+e.e,e.b*n.x+e.d*n.y+e.f,n.z)}static applyToXY(e,n,r){return[e.a*n+e.c*r+e.e,e.b*n+e.d*r+e.f]}static applyToPoints(e,n){return n.map(r=>new M(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,n){return new Ee(e.e+n.minX,e.f+n.minY,n.width,n.height)}static From(e){return new xe(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof xe?e:xe.From(e)}}function jk(t,e,n,r,i=1e-10){const s=t.x-n.x,o=t.y-n.y,a=r.x-n.x,l=r.y-n.y,c=e.x-t.x,u=e.y-t.y,d=a*o-l*s,h=c*o-u*s,f=l*c-a*u;if(Nr(d,0,i)||Nr(h,0,i)||Nr(f,0,i))return null;if(f!==0){const y=d/f,b=h/f;if(jC(0,y,i)&&jC(y,1,i)&&jC(0,b,i)&&jC(b,1,i))return M.AddXY(t,y*c,y*u)}return null}function kS(t,e,n,r){const i=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y),s=2*((e.x-t.x)*(t.x-n.x)+(e.y-t.y)*(t.y-n.y)),o=n.x*n.x+n.y*n.y+t.x*t.x+t.y*t.y-2*(n.x*t.x+n.y*t.y)-r*r,a=s*s-4*i*o;if(a<0||a===0)return null;const l=Math.sqrt(a),c=(-s+l)/(2*i),u=(-s-l)/(2*i);if((c<0||c>1)&&(u<0||u>1))return null;const d=[];return 0<=c&&c<=1&&d.push(M.Lrp(t,e,c)),0<=u&&u<=1&&d.push(M.Lrp(t,e,u)),d.length===0?null:d}function OYe(t,e,n){const r=[];let i;for(let s=0,o=n.length-1;s<o;s++)i=jk(t,e,n[s],n[s+1]),i&&r.push(i);return r.length===0?null:r}function ofe(t,e,n){const r=[];let i;for(let s=1,o=n.length;s<o+1;s++)i=jk(t,e,n[s-1],n[s%n.length]),i&&r.push(i);return r.length===0?null:r}function DYe(t,e,n,r){let i=n.x-t.x,s=n.y-t.y;const o=Math.sqrt(i*i+s*s),a=(o*o-r*r+e*e)/(2*o),l=Math.sqrt(e*e-a*a);return i/=o,s/=o,[new M(t.x+i*a-s*l,t.y+s*a+i*l),new M(t.x+i*a+s*l,t.y+s*a-i*l)]}function RYe(t,e,n){const r=[];let i,s,o;for(let a=0,l=n.length;a<l;a++)i=n[a],s=n[(a+1)%n.length],o=kS(i,s,t,e),o&&r.push(...o);return r.length===0?null:r}function NYe(t,e,n){const r=[];let i,s,o;for(let a=1,l=n.length;a<l;a++)i=n[a-1],s=n[a],o=kS(i,s,t,e),o&&r.push(...o);return r.length===0?null:r}function FC(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function PU(t,e,n,r){return FC(t,n,r)!==FC(e,n,r)&&FC(t,e,n)!==FC(t,e,r)}function JI(t,e){const n=new Map;let r,i,s,o;for(let a=0,l=t.length;a<l;a++)if(r=t[a],po(r,e)){const c=KE(r);n.has(c)||n.set(c,r)}for(let a=0,l=e.length;a<l;a++)if(r=e[a],po(r,t)){const c=KE(r);n.has(c)||n.set(c,r)}for(let a=0,l=t.length;a<l;a++){r=t[a],i=t[(a+1)%t.length];for(let c=0,u=e.length;c<u;c++){s=e[c],o=e[(c+1)%e.length];const d=jk(r,i,s,o);if(d!==null){const h=KE(d);n.has(h)||n.set(h,d)}}}return n.size===0?null:jYe([...n.values()])}function $Z(t,e,n,r){const i=new Map;for(let s=0,o=n?t.length:t.length-1;s<o;s++){const a=t[s],l=t[(s+1)%t.length];for(let c=0,u=r?e.length:e.length-1;c<u;c++){const d=e[c],h=e[(c+1)%e.length],f=jk(a,l,d,h);if(f!==null){const y=KE(f);i.has(y)||i.set(y,f)}}}return[...i.values()]}function KE(t){return`${t.x},${t.y}`}function jYe(t){const e=M.Average(t);return t.sort((n,r)=>M.Angle(e,n)-M.Angle(e,r))}function afe(t,e){let n,r,i,s;for(let o=0,a=t.length;o<a;o++){n=t[o],r=t[(o+1)%a];for(let l=0,c=e.length;l<c;l++)if(i=e[l],s=e[(l+1)%c],PU(n,r,i,s))return!0}return!1}function LYe(t,e){let n,r,i,s;for(let o=0,a=t.length;o<a;o++){n=t[o],r=t[(o+1)%a];for(let l=1,c=e.length;l<c;l++)if(i=e[l-1],s=e[l],PU(n,r,i,s))return!0}return!1}const fu={EXCLUDE_NON_STANDARD:{includeLabels:!1,includeInternal:!1},EXCLUDE_LABELS:{includeLabels:!1,includeInternal:!0}};class jf{constructor(e){N(this,"isFilled",!1);N(this,"isClosed",!0);N(this,"isLabel",!1);N(this,"isEmptyLabel",!1);N(this,"isInternal",!1);N(this,"debugColor");N(this,"ignore");N(this,"_vertices");N(this,"_bounds");N(this,"_area");N(this,"_length");const{isLabel:n=!1,isEmptyLabel:r=!1,isInternal:i=!1}=e;this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.debugColor=e.debugColor,this.ignore=e.ignore,this.isLabel=n,this.isEmptyLabel=r,this.isInternal=i}isExcludedByFilter(e){return e?!!(this.isLabel&&!e.includeLabels||this.isInternal&&!e.includeInternal):!1}hitTestPoint(e,n=0,r=!1,i){return this.isClosed&&(this.isFilled||r)&&po(e,this.vertices)?!0:M.Dist2(e,this.nearestPoint(e))<=n*n}distanceToPoint(e,n=!1,r){return M.Dist(e,this.nearestPoint(e,r))*(this.isClosed&&(this.isFilled||n)&&po(e,this.vertices)?-1:1)}distanceToLineSegment(e,n,r){if(M.Equals(e,n))return this.distanceToPoint(e,!1,r);const{vertices:i}=this;let s,o=1/0,a,l,c;const u=this.isClosed?i.length:i.length-1;for(let d=0;d<i.length;d++){if(l=i[d],d<u){const h=i[(d+1)%i.length];if(PU(e,n,l,h))return 0}c=M.NearestPointOnLineSegment(e,n,l,!0),a=M.Dist2(l,c),a<o&&(o=a,s=c)}if(!s)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&po(s,this.vertices)?-o:o}hitTestLineSegment(e,n,r=0,i){return this.distanceToLineSegment(e,n,i)<=r}intersectLineSegment(e,n,r){return(this.isClosed?ofe(e,n,this.vertices):OYe(e,n,this.vertices))??[]}intersectCircle(e,n,r){return(this.isClosed?RYe(e,n,this.vertices):NYe(e,n,this.vertices))??[]}intersectPolygon(e,n){return $Z(e,this.vertices,!0,this.isClosed)}intersectPolyline(e,n){return $Z(e,this.vertices,!1,this.isClosed)}interpolateAlongEdge(e,n){const{vertices:r}=this;if(e<=0)return r[0];const i=e*this.length;let s=0;for(let o=0;o<(this.isClosed?r.length:r.length-1);o++){const a=r[o],l=r[(o+1)%r.length],c=M.Dist(a,l),u=s+c;if(u>=i)return M.Lrp(a,l,iw(s,u,i));s=u}return this.isClosed?r[0]:r[r.length-1]}uninterpolateAlongEdge(e,n){const{vertices:r,length:i}=this;let s=null,o=1/0,a=0;for(let c=0;c<(this.isClosed?r.length:r.length-1);c++){const u=r[c],d=r[(c+1)%r.length],h=M.NearestPointOnLineSegment(u,d,e,!0),f=M.Dist(h,e);f<o&&(o=f,s={start:u,end:d,nearestPoint:h,distanceToStart:a}),a+=M.Dist(u,d)}return it(s),(s.distanceToStart+M.Dist(s.start,s.nearestPoint))/i}nearestPointOnLineSegment(e,n){const{vertices:r}=this;let i,s=1/0,o,a,l;for(let c=0;c<r.length;c++)a=r[c],l=M.NearestPointOnLineSegment(e,n,a,!0),o=M.Dist2(a,l),o<s&&(s=o,i=l);if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,n=0){const{bounds:r}=this;return!(e.x<r.minX-n||e.y<r.minY-n||e.x>r.maxX+n||e.y>r.maxY+n)}transform(e,n){return new _U(this,e,n)}get vertices(){return this._vertices||(this._vertices=this.getVertices(fu.EXCLUDE_LABELS)),this._vertices}getBounds(){return Ee.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let n=0;for(let r=0,i=e.length;r<i;r++){const s=e[r],o=e[(r+1)%i];n+=s.x*o.y-o.x*s.y}return n/2}toSimpleSvgPath(){let e="";const{vertices:n}=this,r=n.length;if(r===0)return e;e+=`M${n[0].x},${n[0].y}`;for(let i=1;i<r;i++)e+=`L${n[i].x},${n[i].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(fu.EXCLUDE_LABELS),this._length)}getLength(e){const n=this.getVertices(e??fu.EXCLUDE_LABELS);if(n.length===0)return 0;let r=n[0],i=0;for(let s=1;s<n.length;s++){const o=n[s];i+=M.Dist(r,o),r=o}return this.isClosed&&(i+=M.Dist(n[n.length-1],n[0])),i}}class _U extends jf{constructor(n,r,i){super(n);N(this,"inverse");N(this,"decomposed");this.geometry=n,this.matrix=r,this.inverse=xe.Inverse(r),this.decomposed=xe.Decompose(r),i&&(i.isLabel!=null&&(this.isLabel=i.isLabel),i.isInternal!=null&&(this.isInternal=i.isInternal),i.debugColor!=null&&(this.debugColor=i.debugColor),i.ignore!=null&&(this.ignore=i.ignore)),it(Nr(this.decomposed.scaleX,this.decomposed.scaleY),"non-uniform scaling is not yet supported")}getVertices(n){return this.geometry.getVertices(n).map(r=>xe.applyToPoint(this.matrix,r))}nearestPoint(n,r){return xe.applyToPoint(this.matrix,this.geometry.nearestPoint(xe.applyToPoint(this.inverse,n),r))}hitTestPoint(n,r=0,i,s){return this.geometry.hitTestPoint(xe.applyToPoint(this.inverse,n),r/this.decomposed.scaleX,i,s)}distanceToPoint(n,r=!1,i){return this.geometry.distanceToPoint(xe.applyToPoint(this.inverse,n),r,i)*this.decomposed.scaleX}distanceToLineSegment(n,r,i){return this.geometry.distanceToLineSegment(xe.applyToPoint(this.inverse,n),xe.applyToPoint(this.inverse,r),i)*this.decomposed.scaleX}hitTestLineSegment(n,r,i=0,s){return this.geometry.hitTestLineSegment(xe.applyToPoint(this.inverse,n),xe.applyToPoint(this.inverse,r),i/this.decomposed.scaleX,s)}intersectLineSegment(n,r,i){return xe.applyToPoints(this.matrix,this.geometry.intersectLineSegment(xe.applyToPoint(this.inverse,n),xe.applyToPoint(this.inverse,r),i))}intersectCircle(n,r,i){return xe.applyToPoints(this.matrix,this.geometry.intersectCircle(xe.applyToPoint(this.inverse,n),r/this.decomposed.scaleX,i))}intersectPolygon(n,r){return xe.applyToPoints(this.matrix,this.geometry.intersectPolygon(xe.applyToPoints(this.inverse,n),r))}intersectPolyline(n,r){return xe.applyToPoints(this.matrix,this.geometry.intersectPolyline(xe.applyToPoints(this.inverse,n),r))}transform(n,r){return new _U(this.geometry,xe.Multiply(n,this.matrix),{isLabel:(r==null?void 0:r.isLabel)??this.isLabel,isInternal:(r==null?void 0:r.isInternal)??this.isInternal,debugColor:(r==null?void 0:r.debugColor)??this.debugColor,ignore:(r==null?void 0:r.ignore)??this.ignore})}getSvgPathData(){throw new Error("Cannot get SVG path data for transformed geometry.")}}class yo extends jf{constructor(n){super({...n,isClosed:!0,isFilled:!1});N(this,"children",[]);N(this,"ignoredChildren",[]);const r=i=>{for(const s of i)s instanceof yo?r(s.children):s.ignore?this.ignoredChildren.push(s):this.children.push(s)};if(r(n.children),this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(n){return this.isExcludedByFilter(n)?[]:this.children.filter(r=>!r.isExcludedByFilter(n)).flatMap(r=>r.getVertices(n))}nearestPoint(n,r){let i=1/0,s;const{children:o}=this;if(o.length===0)throw Error("no children");let a,l;for(const c of o)c.isExcludedByFilter(r)||(a=c.nearestPoint(n,r),l=M.Dist2(a,n),l<i&&(i=l,s=a));if(!s)throw Error("nearest point not found");return s}distanceToPoint(n,r=!1,i){let s=1/0;for(const o of this.children){if(o.isExcludedByFilter(i))continue;const a=o.distanceToPoint(n,r,i);a<s&&(s=a)}return s}hitTestPoint(n,r,i,s=fu.EXCLUDE_LABELS){return!!this.children.filter(o=>!o.isExcludedByFilter(s)).find(o=>o.hitTestPoint(n,r,i))}hitTestLineSegment(n,r,i,s=fu.EXCLUDE_LABELS){return!!this.children.filter(o=>!o.isExcludedByFilter(s)).find(o=>o.hitTestLineSegment(n,r,i))}intersectLineSegment(n,r,i){return this.children.flatMap(s=>s.isExcludedByFilter(i)?Mr:s.intersectLineSegment(n,r,i))}intersectCircle(n,r,i){return this.children.flatMap(s=>s.isExcludedByFilter(i)?Mr:s.intersectCircle(n,r,i))}intersectPolygon(n,r){return this.children.flatMap(i=>i.isExcludedByFilter(r)?Mr:i.intersectPolygon(n,r))}intersectPolyline(n,r){return this.children.flatMap(i=>i.isExcludedByFilter(r)?Mr:i.intersectPolyline(n,r))}interpolateAlongEdge(n,r){const i=this.getLength(r),s=n*i;let o=0;for(const a of this.children){if(a.isExcludedByFilter(r))continue;const l=a.length,c=o+l;if(c>=s)return a.interpolateAlongEdge(iw(o,c,s),r);o=c}return this.children[this.children.length-1].interpolateAlongEdge(1,r)}uninterpolateAlongEdge(n,r){const i=this.getLength(r);let s=null,o=1/0,a=0;for(const u of this.children){if(u.isExcludedByFilter(r))continue;const d=u.getLength(r),h=a+d,f=u.distanceToPoint(n,!1,r);f<o&&(o=f,s={startLength:a,endLength:h,child:u}),a=h}it(s);const l=s.child.uninterpolateAlongEdge(n,r);return At(s.startLength,s.endLength,l)/i}transform(n){return new yo({children:this.children.map(r=>r.transform(n)),isLabel:this.isLabel,debugColor:this.debugColor,ignore:this.ignore})}getArea(){return this.children[0].area}toSimpleSvgPath(){let n="";for(const i of this.children)n+=i.toSimpleSvgPath();const r=Ee.FromPoints(this.vertices).corners;for(let i=0,s=r.length;i<s;i++){const o=r[i],a=r[(i-1+s)%s],l=o.dist(a),c=r[(i+1)%s],u=o.dist(c),d=o.clone().lrp(a,4/l),h=o,f=o.clone().lrp(c,4/u);n+=`M${d.x},${d.y} L${h.x},${h.y} L${f.x},${f.y} `}return n}getLength(n){let r=0;for(const i of this.children)i.isExcludedByFilter(n)||(r+=i.length);return r}getSvgPathData(){return this.children.map((n,r)=>n.isLabel?"":n.getSvgPathData(r===0)).join(" ")}}class Vy extends jf{constructor(n){super({...n,isClosed:!1,isFilled:!1});N(this,"_start");N(this,"_end");N(this,"_d");N(this,"_u");N(this,"_ul");const{start:r,end:i}=n;this._start=r,this._end=i,this._d=r.clone().sub(i),this._u=this._d.clone().uni(),this._ul=this._u.len()}getLength(){return this._d.len()}getVertices(){return[this._start,this._end]}nearestPoint(n){const{_start:r,_end:i,_d:s,_u:o,_ul:a}=this;if(s.len()===0||a===0)return r;const l=M.Sub(n,r).dpr(o)/a,c=r.x+o.x*l;if(c<Math.min(r.x,i.x))return r.x<i.x?r:i;if(c>Math.max(r.x,i.x))return r.x>i.x?r:i;const u=r.y+o.y*l;return u<Math.min(r.y,i.y)?r.y<i.y?r:i:u>Math.max(r.y,i.y)?r.y>i.y?r:i:new M(c,u)}getSvgPathData(n=!0){const{_start:r,_end:i}=this;return`${n?`M${r.toFixed()}`:""} L${i.toFixed()}`}}class AS extends jf{constructor(n){super({isClosed:!1,isFilled:!1,...n});N(this,"_points");N(this,"_segments");const{points:r}=n;if(this._points=r,r.length<2)throw new Error("Polyline2d: points must be an array of at least 2 points")}get segments(){if(!this._segments){this._segments=[];const{vertices:n}=this;for(let r=0,i=n.length-1;r<i;r++){const s=n[r],o=n[r+1];this._segments.push(new Vy({start:s,end:o}))}this.isClosed&&this._segments.push(new Vy({start:n[n.length-1],end:n[0]}))}return this._segments}getLength(){return this.segments.reduce((n,r)=>n+r.length,0)}getVertices(){return this._points}nearestPoint(n){const{segments:r}=this;let i=this._points[0],s=1/0,o,a;for(let l=0;l<r.length;l++)o=r[l].nearestPoint(n),a=M.Dist2(o,n),a<s&&(i=o,s=a);if(!i)throw Error("nearest point not found");return i}hitTestLineSegment(n,r,i=0){const{segments:s}=this;for(let o=0,a=s.length;o<a;o++)if(s[o].hitTestLineSegment(n,r,i))return!0;return!1}getSvgPathData(){const{vertices:n}=this;return n.length<2?"":n.reduce((r,i,s)=>s===0?`M ${i.x} ${i.y}`:`${r} L ${i.x} ${i.y}`,"")}}class uw extends AS{constructor(e){if(super({...e}),this.isClosed=!0,e.points.length<3)throw new Error("Polygon2d: points must be an array of at least 3 points")}}class bu extends uw{constructor(n){const{x:r=0,y:i=0,width:s,height:o}=n;super({...n,points:[new M(r,i),new M(r+s,i),new M(r+s,i+o),new M(r,i+o)]});N(this,"_x");N(this,"_y");N(this,"_w");N(this,"_h");this._x=r,this._y=i,this._w=s,this._h=o}getBounds(){return new Ee(this._x,this._y,this._w,this._h)}getSvgPathData(){const{_x:n,_y:r,_w:i,_h:s}=this;return this.negativeZeroFix(),`M${n},${r} h${i} v${s} h${-i}z`}negativeZeroFix(){this._x=$C(this._x),this._y=$C(this._y),this._w=$C(this._w),this._h=$C(this._h)}}function $C(t){return Object.is(t,-0)?0:t}class pc{constructor(e){N(this,"options",{});this.editor=e}static configure(e){return class extends this{constructor(){super(...arguments);N(this,"options",{...this.options,...e})}}}getFontFaces(e){return Mr}canSnap(e){return!0}canTabTo(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canResizeChildren(e){return!0}canEditInReadonly(e){return!1}canCrop(e){return!1}canBeLaidOut(e,n){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}canReceiveNewChildrenOfType(e,n){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}getAriaDescriptor(e){}}N(pc,"props"),N(pc,"migrations"),N(pc,"type");function lfe(t,e,n={}){const{closed:r=!1,snap:i=1,start:s="outset",end:o="outset",lengthRatio:a=2,style:l="dashed",forceSolid:c=!1}=n;let u=0,d=0,h=1,f=0,y=0;if(c)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(l){case"dashed":{h=1,u=Math.min(e*a,t/4);break}case"dotted":{h=100,u=e/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(s==="outset"?(t+=u/2,y+=u/2):s==="skip"&&(t-=u,y-=u),o==="outset"?t+=u/2:o==="skip"&&(t-=u)),d=Math.floor(t/u/(2*h)),d-=d%i,d<3&&l==="dashed"?t/e<4?(u=t,d=1,f=0):(u=t*(1/3),f=t*(1/3)):(u=t/d/(2*h),r?(y=u/2,f=(t-d*u)/d):f=(t-d*u)/Math.max(1,d-1)),{strokeDasharray:[u,f].join(" "),strokeDashoffset:y.toString()}}function BZ({bounds:t,className:e}){const n=re(),r=ie("zoom level",()=>n.getZoomLevel(),[n]);return g.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:t.sides.map((i,s)=>{const{strokeDasharray:o,strokeDashoffset:a}=lfe(i[0].dist(i[1]),1/r,{style:"dashed",lengthRatio:4});return g.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:o,strokeDashoffset:a},s)})})}class qE extends pc{hideSelectionBoundsFg(){return!0}canBind(){return!1}canResize(){return!0}canResizeChildren(){return!0}getDefaultProps(){return{}}getGeometry(e){const n=this.editor.getSortedChildIdsForParent(e.id);return n.length===0?new bu({width:1,height:1,isFilled:!1}):new yo({children:n.map(r=>{const i=this.editor.getShape(r);return this.editor.getShapeGeometry(r).transform(this.editor.getShapeLocalTransform(i),{isLabel:!1})})})}component(e){const n=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:r}=this.editor.getCurrentPageState(),i=r.length>0&&r.some(a=>a!==e.id&&this.editor.isShapeOfType(this.editor.getShape(a),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!n&&(s||i))return null;const o=this.editor.getShapeGeometry(e).bounds;return g.jsx(pf,{children:g.jsx(BZ,{className:"tl-group",bounds:o})})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds;return g.jsx(BZ,{className:"",bounds:n})}onChildrenChange(e){const n=this.editor.getSortedChildIdsForParent(e.id);if(n.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(n.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(n,e.parentId),this.editor.deleteShapes([e.id]);return}}}N(qE,"type","group"),N(qE,"props",whe),N(qE,"migrations",She);const cfe=[qE],FYe=new Set(cfe.map(t=>t.type));function ufe(t){const e=[...cfe],n=new Set;for(const r of t){if(FYe.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),n.add(r.type)}return e}function dfe(t,e){const n=new Map;return async function(i){const s=n.get(i);if(s)return s;const o=(async()=>{try{const a=await hc(i,e);return it(a.ok),await t(a)}catch(a){return console.error(a),null}})();return n.set(i,o),o}}const Lk=dfe(async t=>await co.blobToDataUrl(await t.blob())),$Ye=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,BYe=/@font-face\s*{([^}]+)}/gi,hfe=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,zYe=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function UYe(t){return Array.from(t.matchAll($Ye),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]}))}function ffe(t,e){return Array.from(t.matchAll(BYe),n=>{const r=n[1],i=Array.from(r.matchAll(hfe),o=>{var l;const a=o[1]||o[2]||o[3];return{original:a,resolved:((l=wt(a,e))==null?void 0:l.href)??null}}),s=new Set(Array.from(r.matchAll(zYe),o=>(o[1]||o[2]||o[3]).toLowerCase()));return{fontFace:r,urls:i,fontFamilies:s}})}function HYe(t){const e=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,n=/\s*,\s*/gi,r=new Set;for(;;){const i=e.exec(t);if(!i)break;const s=i[1]||i[2]||i[3];if(r.add(s.toLowerCase()),n.lastIndex=e.lastIndex,!n.exec(t))break;e.lastIndex=n.lastIndex}return r}function pfe(t){return!(t.startsWith("-")||t.startsWith("animation")||t.startsWith("transition")||t==="cursor"||t==="pointer-events"||t==="user-select"||t==="touch-action")}function VYe(t,e){return{imports:UYe(t),fontFaces:ffe(t,e)}}function WYe(t){return Array.from(t.matchAll(hfe),e=>({original:e[0],url:e[1]||e[2]||e[3]}))}var KYe=Object.create,gfe=Object.defineProperty,qYe=Object.getOwnPropertyDescriptor,GYe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),mfe=t=>{throw TypeError(t)},yfe=(t,e,n)=>e in t?gfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,YYe=t=>[,,,KYe(null)],vfe=["class","method","getter","setter","accessor","field","value","get","set"],bfe=t=>t!==void 0&&typeof t!="function"?mfe("Function expected"):t,XYe=(t,e,n,r,i)=>({kind:vfe[t],name:e,metadata:r,addInitializer:s=>n._?mfe("Already initialized"):i.push(bfe(s||null))}),JYe=(t,e)=>yfe(e,GYe("metadata"),t[3]),ZYe=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},QYe=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=vfe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,qYe(i,n)),x=r.length-1;x>=0;x--)l=XYe(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,bfe(o)&&(v[y]=o);return v&&gfe(i,n,v),i},BC=(t,e,n)=>yfe(t,typeof e!="symbol"?e+"":e,n),xfe,Fk;const wfe="tldraw-svg-export";xfe=[Yo];class kU{constructor(){ZYe(Fk,5,this),BC(this,"fontFacesPromise",null),BC(this,"foundFontNames",new Set),BC(this,"fontFacesToEmbed",new Set),BC(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){it(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=eXe()}onFontFamilyValue(e){it(this.fontFacesPromise,"FontEmbedder not started");const n=HYe(e);for(const r of n){if(this.foundFontNames.has(r))return;this.foundFontNames.add(r),this.pendingPromises.push(this.fontFacesPromise.then(i=>{const s=i.filter(o=>o.fontFamilies.has(r));for(const o of s)if(!this.fontFacesToEmbed.has(o)){this.fontFacesToEmbed.add(o);for(const a of o.urls)!a.resolved||a.embedded||(a.embedded=Lk(a.resolved))}}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const n of this.fontFacesToEmbed){let r=`@font-face {${n.fontFace}}`;for(const i of n.urls){if(!i.embedded)continue;const s=await i.embedded;s&&(r=r.replace(i.original,s))}e+=r}return e}}Fk=YYe();QYe(Fk,1,"onFontFamilyValue",xfe,kU);JYe(Fk,kU);async function eXe(){var n;const t=[],e=Array.from(document.styleSheets).filter(r=>{var i;return!((i=r.ownerNode)!=null&&i.closest(`.${wfe}`))});for(const r of e){let i;try{i=r.cssRules}catch{}if(i){for(const s of r.cssRules)if(s instanceof CSSFontFaceRule)t.push(ffe(s.cssText,r.href??document.baseURI));else if(s instanceof CSSImportRule){const o=new URL(s.href,((n=s.parentStyleSheet)==null?void 0:n.href)??document.baseURI);t.push(q3(o.href))}}else r.href&&t.push(q3(r.href))}return bt(await Promise.all(t)).flat()}const q3=dfe(async t=>{const e=VYe(await t.text(),t.url),n=await Promise.all(e.imports.map(({url:r})=>q3(new URL(r,t.url).href)));return[...e.fontFaces,...bt(n).flat()]}),ha=(t,e,{currentColor:n})=>t==="currentColor"||t===n,zt=(t,e,{parentStyles:n})=>n[e]===t,or=t=>(e,n,{getStyle:r})=>{const i=r(`border-${t}-width`),s=r(`border-${t}-style`);return i==="0px"||s==="none"},Sfe={"border-block-end-color":ha,"border-block-start-color":ha,"border-bottom-color":ha,"border-inline-end-color":ha,"border-inline-start-color":ha,"border-left-color":ha,"border-right-color":ha,"border-top-color":ha,"caret-color":ha,"column-rule-color":ha,"outline-color":ha,"text-decoration":(t,e,{currentColor:n})=>t==="none solid currentColor"||t==="none solid "+n,"text-decoration-color":ha,"text-emphasis-color":ha,"border-collapse":zt,"border-spacing":zt,"caption-side":zt,cursor:zt,direction:zt,"empty-cells":zt,"font-family":zt,"font-size":zt,"font-style":zt,"font-variant":zt,"font-weight":zt,"font-size-adjust":zt,"font-stretch":zt,font:zt,"letter-spacing":zt,"line-height":zt,"list-style-image":zt,"list-style-position":zt,"list-style-type":zt,"list-style":zt,orphans:zt,"overflow-wrap":zt,quotes:zt,"stroke-linecap":zt,"stroke-linejoin":zt,"tab-size":zt,"text-align":zt,"text-align-last":zt,"text-indent":zt,"text-justify":zt,"text-shadow":zt,"text-transform":zt,visibility:zt,"white-space":zt,"white-space-collapse":zt,widows:zt,"word-break":zt,"word-spacing":zt,"word-wrap":zt,"border-top":or("top"),"border-right":or("right"),"border-bottom":or("bottom"),"border-left":or("left"),"border-block-end":or("block-end"),"border-block-start":or("block-start"),"border-inline-end":or("inline-end"),"border-inline-start":or("inline-start"),"border-top-style":or("top"),"border-right-style":or("right"),"border-bottom-style":or("bottom"),"border-left-style":or("left"),"border-block-end-style":or("block-end"),"border-block-start-style":or("block-start"),"border-inline-end-style":or("inline-end"),"border-inline-start-style":or("inline-start"),"border-top-width":or("top"),"border-right-width":or("right"),"border-bottom-width":or("bottom"),"border-left-width":or("left"),"border-block-end-width":or("block-end"),"border-block-start-width":or("block-start"),"border-inline-end-width":or("inline-end")};function Cfe(t){if(t.shadowRoot)return t.shadowRoot.childNodes;if(iXe(t)){const e=t.assignedNodes();if(e!=null&&e.length)return e}return t.childNodes}function*G3(t){for(const e of Cfe(t))tXe(e)&&(yield e)}function $k(t){var e;return((e=t.ownerDocument)==null?void 0:e.defaultView)??globalThis}function tXe(t){return t instanceof $k(t).Element}function nXe(t){return t instanceof $k(t).ShadowRoot}function rXe(t){return"getRootNode"in t&&nXe(t.getRootNode())}function iXe(t){return rXe(t)&&t instanceof $k(t).HTMLSlotElement}function sXe(t){return t.style}function AU(t,e){return $k(t).getComputedStyle(t,e)}const Wy={};class oXe{constructor(e){N(this,"styles",new Map);N(this,"fonts",new kU);this.root=e}readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const n=Array.from(G3(e));for(;n.length;){const r=n.pop();n.push(...G3(r)),this.readElementStyles(r,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:n=!0,shouldSkipInheritedParentStyles:r=!0}){var a;const i=n?uXe(e.tagName.toLowerCase()):Wy,s=Object.assign({},Wy);if(r){let l=e.parentElement;for(;l;){const c=(a=this.styles.get(l))==null?void 0:a.self;for(const u in c)s[u]||(s[u]=c[u]);l=l.parentElement}}const o={self:aXe(e,{defaultStyles:i,parentStyles:s}),before:zZ(e,"::before"),after:zZ(e,"::after")};this.styles.set(e,o)}fetchResources(){const e=[];for(const n of this.styles.values())for(const r of yr(n))if(r)for(const[i,s]of Object.entries(r)){if(!s)continue;i==="font-family"&&this.fonts.onFontFamilyValue(s);const o=WYe(s);o.length!==0&&e.push(...o.map(async({url:a,original:l})=>{const c=await Lk(a)??"data:";r[i]=s.replace(l,`url("${c}")`)}))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,n=(r,i)=>{if(e.has(r))return;e.add(r);const s=r.shadowRoot;if(s){const o=document.createElement("div");this.styles.set(o,this.styles.get(r)),o.setAttribute("data-tl-custom-element",r.tagName),(i??r.parentElement).appendChild(o);for(const a of s.childNodes)a instanceof Element?n(a,o):o.appendChild(a.cloneNode(!0));r.remove()}else if(i){if(r.tagName.toLowerCase()==="style")return;const o=r.cloneNode(!1);this.styles.set(o,this.styles.get(r)),i.appendChild(o);for(const a of Cfe(r))a instanceof Element?n(a,o):o.appendChild(a.cloneNode(!0))}};for(const r of this.styles.keys())n(r,null)}embedStyles(){let e="";for(const[n,r]of this.styles){if(r.after||r.before){const s=`pseudo-${fn()}`;n.classList.add(s),r.before&&(e+=`.${s}::before {${UZ(r.before)}}
`),r.after&&(e+=`.${s}::after {${UZ(r.after)}}
`)}const i=sXe(n);for(const[s,o]of Object.entries(r.self))o&&i.setProperty(s,o);i.fontKerning==="auto"&&(i.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){cXe()}}function aXe(t,{defaultStyles:e,parentStyles:n}){return t.computedStyleMap?Efe(t.computedStyleMap(),{defaultStyles:e,parentStyles:n}):MU(AU(t),{defaultStyles:e,parentStyles:n})}function zZ(t,e){const n=AU(t,e),r=n.getPropertyValue("content");if(!(r===""||r==="none"))return MU(n,{defaultStyles:Wy,parentStyles:Wy})}function Efe(t,{defaultStyles:e,parentStyles:n}){var o;const r={},s={currentColor:((o=t.get("color"))==null?void 0:o.toString())||"",parentStyles:n,defaultStyles:e,getStyle:a=>{var l;return((l=t.get(a))==null?void 0:l.toString())??""}};for(const a of t.keys()){if(!pfe(a))continue;const l=t.get(a).toString();if(e[a]===l)continue;const c=Ar(Sfe,a);c&&c(l,a,s)||(r[a]=l)}return r}function MU(t,{defaultStyles:e,parentStyles:n}){const r={},s={currentColor:t.color,parentStyles:n,defaultStyles:e,getStyle:o=>t.getPropertyValue(o)};for(const o in t){if(!pfe(o))continue;const a=t.getPropertyValue(o);if(e[o]===a)continue;const l=Ar(Sfe,o);l&&l(a,o,s)||(r[o]=a)}return r}function UZ(t){let e="";for(const[n,r]of Object.entries(t))e+=`${n}: ${r};`;return e}let py;const HZ={};function lXe(){if(!py){const t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t);const e=Ps(t.contentDocument,"frame must have a document"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");n.appendChild(r),e.body.appendChild(n),py={iframe:t,foreignObject:r,document:e}}return py}function cXe(){py&&(document.body.removeChild(py.iframe),py=void 0)}const VZ={defaultStyles:Wy,parentStyles:Wy};function uXe(t){let e=HZ[t];if(!e){const{foreignObject:n,document:r}=lXe(),i=r.createElement(t);n.appendChild(i),e=i.computedStyleMap?Efe(i.computedStyleMap(),VZ):MU(AU(i),VZ),n.removeChild(i),HZ[t]=e}return e}function dXe(t,e){Array.from(t.attributes).forEach(r=>{e.setAttribute(r.name,r.value)})}function WZ(t,e){return t.replaceWith(e),e}async function cx(t,e){const n=document.createElement("img");e&&dXe(e,n),n.setAttribute("src",t??"data:"),n.setAttribute("decoding","sync"),n.setAttribute("loading","eager");try{await n.decode()}catch{}return n}async function hXe(t){try{const e=t.toDataURL();return await cx(e,t)}catch{return await cx(null,t)}}async function fXe(t){try{const e=await xa.getVideoFrameAsDataUrl(t);return cx(e,t)}catch(e){console.error("Could not get video frame",e)}if(t.poster){const e=await Lk(t.poster);return cx(e,t)}return cx(null,t)}async function Tfe(t){if(t instanceof HTMLCanvasElement)return WZ(t,await hXe(t));if(t instanceof HTMLVideoElement)return WZ(t,await fXe(t));if(t instanceof HTMLImageElement){const e=t.currentSrc||t.src,n=await Lk(e);t.setAttribute("src",n??"data:"),t.setAttribute("decoding","sync"),t.setAttribute("loading","eager");try{await t.decode()}catch{}return t}else t instanceof HTMLInputElement?t.setAttribute("value",t.value):t instanceof HTMLTextAreaElement&&(t.textContent=t.value);await Promise.all(Array.from(G3(t),e=>Tfe(e)))}const Y3=(t,e)=>t.props===e.props&&t.meta===e.meta,Ife=S.memo(function({id:e,shape:n,util:r,index:i,backgroundIndex:s,opacity:o,dprMultiple:a}){const l=re(),{ShapeErrorFallback:c}=Cn(),u=S.useRef(null),d=S.useRef(null);S.useEffect(()=>Ma("load fonts",()=>{const b=l.fonts.getShapeFontFaces(e);l.fonts.requestFonts(b)}),[l,e]);const h=S.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});lg("set shape stuff",()=>{const b=l.getShape(e);if(!b)return;const v=h.current,x=l.getShapeClipPath(e)??"none";x!==v.clipPath&&(Ss(u.current,"clip-path",x),Ss(d.current,"clip-path",x),v.clipPath=x);const C=l.getShapePageTransform(e),E=xe.toCssString(C),I=l.getShapeGeometry(b).bounds;E!==v.transform&&(Ss(u.current,"transform",E),Ss(d.current,"transform",E),v.transform=E);const P=I.w%a,_=I.h%a,A=P===0?I.w:I.w+(a-P),D=_===0?I.h:I.h+(a-_);(A!==v.width||D!==v.height)&&(Ss(u.current,"width",Math.max(A,a)+"px"),Ss(u.current,"height",Math.max(D,a)+"px"),Ss(d.current,"width",Math.max(A,a)+"px"),Ss(d.current,"height",Math.max(D,a)+"px"),v.width=A,v.height=D)},[l]),S.useLayoutEffect(()=>{const b=u.current,v=d.current;Ss(b,"opacity",o),Ss(v,"opacity",o),Ss(b,"z-index",i),Ss(v,"z-index",s)},[o,i,s]),lg("set display",()=>{if(!l.getShape(e))return;const x=l.getCulledShapes().has(e);x!==h.current.isCulled&&(Ss(u.current,"display",x?"none":"block"),Ss(d.current,"display",x?"none":"block"),h.current.isCulled=x)},[l]);const f=S.useCallback(b=>l.annotateError(b,{origin:"shape",willCrashApp:!1}),[l]);if(!n)return null;const y="fill"in n.props&&n.props.fill!=="none";return g.jsxs(g.Fragment,{children:[r.backgroundComponent&&g.jsx("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":n.type,"data-shape-id":n.id,draggable:!1,children:g.jsx(cw,{fallback:c,onError:f,children:g.jsx(_fe,{shape:n,util:r})})}),g.jsx("div",{ref:u,className:"tl-shape","data-shape-type":n.type,"data-shape-is-filled":y,"data-shape-id":n.id,draggable:!1,children:g.jsx(cw,{fallback:c,onError:f,children:g.jsx(Pfe,{shape:n,util:r})})})]})}),Pfe=S.memo(function({shape:e,util:n}){return Ek("InnerShape:"+e.type,()=>n.component(n.editor.store.unsafeGetWithoutCapture(e.id)),[n,e.id])},(t,e)=>Y3(t.shape,e.shape)&&t.util===e.util),_fe=S.memo(function({shape:e,util:n}){return Ek("InnerShape:"+e.type,()=>{var r;return(r=n.backgroundComponent)==null?void 0:r.call(n,n.editor.store.unsafeGetWithoutCapture(e.id))},[n,e.id])},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta&&t.util===e.util);function Zc(t){const e=S.useRef();return S.useLayoutEffect(()=>{e.current=t}),S.useDebugValue(t),S.useCallback((...n)=>{const r=e.current;return it(r,"fn does not exist"),r(...n)},[])}const OU=S.createContext(null);function pXe({context:t,editor:e,children:n}){const r=e.options.exportProvider;return g.jsx(wU,{editor:e,children:g.jsx(zhe,{container:e.getContainer(),children:g.jsx(OU.Provider,{value:t,children:g.jsx(r,{children:n})})})})}function MS(){return S.useContext(OU)}function gXe(){const t=S.useContext(OU),[e]=S.useState(Iz);return S.useEffect(()=>(t==null||t.waitUntil(e),()=>{e.resolve()}),[e,t]),Zc(()=>{e.resolve()})}var mXe=Object.create,kfe=Object.defineProperty,yXe=Object.getOwnPropertyDescriptor,vXe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Afe=t=>{throw TypeError(t)},Mfe=(t,e,n)=>e in t?kfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,bXe=t=>[,,,mXe(null)],Ofe=["class","method","getter","setter","accessor","field","value","get","set"],Dfe=t=>t!==void 0&&typeof t!="function"?Afe("Function expected"):t,xXe=(t,e,n,r,i)=>({kind:Ofe[t],name:e,metadata:r,addInitializer:s=>n._?Afe("Already initialized"):i.push(Dfe(s||null))}),wXe=(t,e)=>Mfe(e,vXe("metadata"),t[3]),SXe=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},CXe=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=Ofe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,yXe(i,n)),x=r.length-1;x>=0;x--)l=xXe(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,Dfe(o)&&(v[y]=o);return v&&kfe(i,n,v),i},KZ=(t,e,n)=>Mfe(t,typeof e!="symbol"?e+"":e,n),Rfe,Bk;Rfe=[Yo];class DU{constructor(e){this.maxDelayTimeMs=e,SXe(Bk,5,this),KZ(this,"isResolved",!1),KZ(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(n=>console.error("Error while waiting for export:",n)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await O3(0)}async resolve(){const e=O3(this.maxDelayTimeMs).then(()=>"timeout"),n=this.resolvePromises().then(()=>"resolved");await Promise.race([e,n])==="timeout"&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}Bk=bXe();CXe(Bk,1,"waitUntil",Rfe,DU);wXe(Bk,DU);function EXe(t,e,n={}){var x,C;if(!window.document)throw Error("No document");const{scale:r=1,background:i=t.getInstanceState().exportBackground,padding:s=t.options.defaultSvgPadding,preserveAspectRatio:o}=n,a=n.darkMode??t.user.getIsDarkMode(),l=t.getShapeAndDescendantIds(e),c=t.getUnorderedRenderingShapes(!1).filter(({id:E})=>l.has(E));let u=null;if(n.bounds)u=n.bounds;else for(const{id:E}of c){const I=t.getShapeMaskedPageBounds(E);I&&(u?u.union(I):u=I.clone())}if(!u)return;const d=e.length===1&&t.isShapeOfType(t.getShape(e[0]),"frame")?e[0]:null;d||u.expandBy(s);const h=u.width*r,f=u.height*r;try{(C=(x=document.body).focus)==null||C.call(x)}catch{}const y=new DU(t.options.maxExportDelayMs),b=Iz();return y.waitUntil(b),{jsx:g.jsx(TXe,{editor:t,preserveAspectRatio:o,scale:r,pixelRatio:n.pixelRatio??null,bbox:u,background:i,singleFrameShapeId:d,isDarkMode:a,renderingShapes:c,onMount:b.resolve,waitUntil:y.waitUntil}),width:h,height:f,exportDelay:y}}function TXe({editor:t,preserveAspectRatio:e,scale:n,pixelRatio:r,bbox:i,background:s,singleFrameShapeId:o,isDarkMode:a,renderingShapes:l,onMount:c,waitUntil:u}){const d=Hg(),h=Ud({isDarkMode:a}),f=ES("export state",{defsById:{},shapeElements:null}),{defsById:y,shapeElements:b}=ie(f),v=Zc(I=>{f.update(P=>{if(Il(P.defsById,I.key))return P;const _=Promise.resolve(I.getElement());return u(_.then(A=>{f.update(D=>({...D,defsById:{...D.defsById,[I.key]:{pending:!1,element:A}}}))})),{...P,defsById:{...P.defsById,[I.key]:{pending:!0,element:_}}}})}),x=S.useMemo(()=>({isDarkMode:a,waitUntil:u,addExportDef:v,scale:n,pixelRatio:r,async resolveAssetUrl(I,P){const _=t.getAsset(I);return!_||_.type!=="image"&&_.type!=="video"?null:await t.resolveAssetUrl(I,{screenScale:n*(P/_.props.w),shouldResolveToOriginal:r===null,dpr:r??void 0})}}),[a,u,v,n,r,t]),C=S.useRef(!1);S.useLayoutEffect(()=>{if(C.current)throw new Error("SvgExport should only render once - do not use with react strict mode");C.current=!0,(async()=>{const I={},P=l.map(async({id:A,opacity:D,index:L,backgroundIndex:z})=>{var j,B;if(A===o)return[];const $=t.getShape(A);if(t.isShapeOfType($,"group"))return[];const H=[],R=t.getShapeUtil($);if(R.toSvg||R.toBackgroundSvg){const[K,G]=await Promise.all([(j=R.toSvg)==null?void 0:j.call(R,$,x),(B=R.toBackgroundSvg)==null?void 0:B.call(R,$,x)]),V=t.getShapePageTransform($);let W=V.toCssString(),Z=1;"scale"in $.props&&$.props.scale!==1&&(Z=$.props.scale,W=`${W} scale(${$.props.scale}, ${$.props.scale})`);const U=t.getShapeMask($.id),J=U?xe.From(xe.Inverse(V)).applyToPoints(U):null,ge=bU(d,$.id);J&&(I[ge]={pending:!1,element:g.jsx("clipPath",{id:ge,children:g.jsx("path",{d:`M${J.map(({x:_e,y:fe})=>`${_e/Z},${fe/Z}`).join("L")}Z`})})}),K&&H.push({zIndex:L,element:g.jsx("g",{transform:W,opacity:D,clipPath:U?`url(#${ge})`:void 0,children:K},`fg_${$.id}`)}),G&&H.push({zIndex:z,element:g.jsx("g",{transform:W,opacity:D,clipPath:U?`url(#${ge})`:void 0,children:G},`bg_${$.id}`)})}else H.push({zIndex:L,element:g.jsx(qZ,{shape:$,util:R,component:Pfe,className:"tl-shape",bbox:i,opacity:D},`fg_${$.id}`)}),R.backgroundComponent&&H.push({zIndex:z,element:g.jsx(qZ,{shape:$,util:R,component:_fe,className:"tl-shape tl-shape-background",bbox:i,opacity:D},`bg_${$.id}`)});return H}),_=(await Promise.all(P)).flat();_c.flushSync(()=>{f.update(A=>({...A,shapeElements:_.sort((D,L)=>D.zIndex-L.zIndex).map(({element:D})=>D),defsById:{...A.defsById,...I}}))})})()},[i,t,x,d,l,o,f]),S.useEffect(()=>{const I=new Set;for(const{id:P}of l)for(const _ of t.fonts.getShapeFontFaces(P))I.add(_);for(const P of I)v({key:fn(),getElement:async()=>{const _=await t.fonts.toEmbeddedCssDeclaration(P);return g.jsx("style",{nonce:t.options.nonce,children:_})}})},[t,l,v]),S.useEffect(()=>{b!==null&&c()},[c,b]);let E=s?h.background:"transparent";if(o&&s){const I=t.getShapeUtil("frame");if(I!=null&&I.options.showColors){const P=t.getShape(o);E=h[P.props.color].frame.fill}else E=h.solid}return g.jsx(pXe,{editor:t,context:x,children:g.jsxs("svg",{preserveAspectRatio:e,direction:"ltr",width:i.width*n,height:i.height*n,viewBox:`${i.minX} ${i.minY} ${i.width} ${i.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:E},"data-color-mode":a?"dark":"light",className:`tl-container tl-theme__force-sRGB ${a?"tl-theme__dark":"tl-theme__light"}`,children:[g.jsx("defs",{children:Object.entries(y).map(([I,P])=>P.pending?null:g.jsx(S.Fragment,{children:P.element},I))}),b]})})}function qZ({shape:t,util:e,className:n,component:r,bbox:i,opacity:s}){const o=re(),a=xe.Translate(-i.minX,-i.minY).multiply(o.getShapePageTransform(t.id)),l=o.getShapeGeometry(t.id).bounds,c=Math.max(l.width,1),u=Math.max(l.height,1);return g.jsx(CU,{fallback:()=>null,children:g.jsx("foreignObject",{x:i.minX,y:i.minY,width:i.w,height:i.h,className:"tl-shape-foreign-object tl-export-embed-styles",children:g.jsx("div",{className:n,"data-shape-type":t.type,style:{clipPath:o.getShapeClipPath(t.id),transform:a.toCssString(),width:c,height:u,opacity:s},children:g.jsx(r,{shape:t,util:e})})})})}let IXe=1;async function PXe(t,e,n={}){const r=EXe(t,e,n);if(!r)return;const i=t.getContainer(),s=document.createElement("div");s.className=wfe,s.inert=!0,s.tabIndex=-1,Object.assign(s.style,{position:"absolute",top:"0px",left:"0px",width:r.width+"px",height:r.height+"px",pointerEvents:"none",opacity:0}),i.appendChild(s);const o=jre.createRoot(s,{identifierPrefix:`export_${IXe++}_`});try{await Promise.resolve(),_c.flushSync(()=>{o.render(r.jsx)}),await r.exportDelay.resolve();const a=s.firstElementChild;return it(a instanceof SVGSVGElement,"Expected an SVG element"),await _Xe(a),{svg:a,width:r.width,height:r.height}}finally{setTimeout(()=>{o.unmount(),i.removeChild(s)},0)}}async function _Xe(t){const e=[...t.querySelectorAll("foreignObject.tl-export-embed-styles > *")];if(!e.length)return;const n=new oXe(t);try{n.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(e.map(s=>Tfe(s)));for(const s of e)n.readRootElementStyles(s);await n.fetchResources();const r=await n.getFontFaceCss();n.unwrapCustomElements();const i=n.embedStyles();if(r||i){const s=document.createElementNS("http://www.w3.org/2000/svg","style");s.textContent=`${r}
${i}`,t.prepend(s)}}finally{n.dispose()}}let Rj=null;function kXe(){return Rj||(Rj={maxWidth:Nj("width"),maxHeight:Nj("height"),maxArea:Nj("area")}),Rj}/*!
 * Extracted from https://github.com/jhildenbiddle/canvas-size
 * MIT License: https://github.com/jhildenbiddle/canvas-size/blob/master/LICENSE
 * Copyright (c) John Hildenbiddle
 */const GZ=8192,AXe=4096*4096,MXe={area:[16384,14188,11402,11180,10836,8192,4096],height:[8388607,65535,32767,16384,8192,4096],width:[4194303,65535,32767,16384,8192,4096]};function Nj(t){const e=document.createElement("canvas");e.width=1,e.height=1;const n=e.getContext("2d");for(const r of MXe[t]){const i=t==="height"?1:r,s=t==="width"?1:r,o=document.createElement("canvas");o.width=i,o.height=s,o.getContext("2d").fillRect(i-1,s-1,1,1),n.drawImage(o,i-1,s-1,1,1,0,0,1,1);const l=n.getImageData(0,0,1,1).data[3]!==0;if(o.width=0,o.height=0,l)return e.width=0,e.height=0,t==="area"?r*r:r}throw e.width=0,e.height=0,Error("Failed to determine maximum canvas dimension")}function OXe(t,e){if(t<=GZ&&e<=GZ&&t*e<=AXe)return[t,e];const{maxWidth:n,maxHeight:r,maxArea:i}=kXe(),s=t/e;if(t>n&&(t=n,e=t/s),e>r&&(e=r,t=e*s),t*e>i){const o=Math.sqrt(i/(t*e));t*=o,e*=o}return[t,e]}async function DXe(t,e){const{type:n,width:r,height:i,quality:s=1,pixelRatio:o=2}=e;let[a,l]=OXe(r*o,i*o);a=Math.floor(a),l=Math.floor(l);const c=a/r,u=await co.blobToDataUrl(new Blob([t],{type:"image/svg+xml"})),d=await new Promise(f=>{const y=rw();y.crossOrigin="anonymous",y.onload=async()=>{sn.isSafari&&await O3(250);const b=document.createElement("canvas"),v=b.getContext("2d");b.width=a,b.height=l,v.imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.drawImage(y,0,0,a,l),URL.revokeObjectURL(u),f(b)},y.onerror=()=>{f(null)},y.src=u});if(!d)return null;const h=await new Promise(f=>d.toBlob(y=>{(!y||Jn.throwToBlob.get())&&f(null),f(y)},"image/"+n,s));if(!h)return null;if(n==="png"){const f=new DataView(await h.arrayBuffer());return eu.setPhysChunk(f,c,{type:"image/"+n})}else return h}const oo={menus:lr("open menus",[]),getOpenMenus(t){return t?this.menus.get().filter(e=>e.endsWith("-"+t)):this.menus.get()},addOpenMenu(t,e=""){const n=e?`${t}-${e}`:t,r=new Set(this.menus.get());r.has(n)||(r.add(n),this.menus.set([...r]))},deleteOpenMenu(t,e=""){const n=e?`${t}-${e}`:t,r=new Set(this.menus.get());r.has(n)&&(r.delete(n),this.menus.set([...r]))},clearOpenMenus(t){this.menus.set(t?this.menus.get().filter(e=>!e.endsWith("-"+t)):[])},_hiddenMenus:[],hideOpenMenus(t){if(this._hiddenMenus=[...this.getOpenMenus(t)],this._hiddenMenus.length!==0)for(const e of this._hiddenMenus)this.deleteOpenMenu(e,t)},showOpenMenus(t){if(this._hiddenMenus.length!==0){for(const e of this._hiddenMenus)this.addOpenMenu(e,t);this._hiddenMenus=[]}},isMenuOpen(t,e){return this.getOpenMenus(e).includes(t)},hasOpenMenus(t){return this.getOpenMenus(t).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(t){return{getOpenMenus:()=>this.getOpenMenus(t),addOpenMenu:e=>this.addOpenMenu(e,t),deleteOpenMenu:e=>this.deleteOpenMenu(e,t),clearOpenMenus:()=>this.clearOpenMenus(t),isMenuOpen:e=>this.isMenuOpen(e,t),hasOpenMenus:()=>this.hasOpenMenus(t),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},X3=new EWe,RXe={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:S.Fragment,enableToolbarKeyboardShortcuts:!0,maxFontsToLoadBeforeRender:1/0,nonce:void 0};function YZ(t,e){if(!e)return!1;switch(t.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&t.value===e.value;default:throw Yt(t)}}class NXe{constructor(e){N(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const n=this.get(e);if(n&&n.type!=="mixed")return n.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const n=new Set;for(const[r,i]of this){if(!YZ(i,e.get(r)))return!1;n.add(r)}for(const[r,i]of e)if(!n.has(r)&&!YZ(i,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class J3 extends NXe{set(e,n){this.map.set(e,n)}applyValue(e,n){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:n});return}switch(r.type){case"mixed":return;case"shared":r.value!==n&&this.set(e,{type:"mixed"});return;default:Yt(r,"type")}}}function jXe(t,e,n){return hc(t).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:n})})}const LXe="https://cdn.tldraw.com";function zr(){return`${LXe}/${Vhe}`}function FXe(t){switch(t.type){case"shapes":return`s${t.shapeIds.map(n=>jj(n.slice(6))).join(".")}`;case"page":return"p"+jj(fo.parseId(t.pageId));case"viewport":{const{bounds:e,pageId:n}=t;let r=`v${Math.round(e.x)}.${Math.round(e.y)}.${Math.round(e.w)}.${Math.round(e.h)}`;return n&&(r+="."+jj(fo.parseId(n))),r}default:Yt(t)}}function $Xe(t){switch(t[0]){case"s":return{type:"shapes",shapeIds:t.slice(1).split(".").filter(Boolean).map(r=>Sn(decodeURIComponent(r)))};case"p":return{type:"page",pageId:fo.createId(decodeURIComponent(t.slice(1)))};case"v":{const[n,r,i,s,o]=t.slice(1).split(".");return{type:"viewport",bounds:new Ee(Number(n),Number(r),Number(i),Number(s)),pageId:o?fo.createId(decodeURIComponent(o)):void 0}}default:throw Error("Invalid deep link string")}}function jj(t){return encodeURIComponent(t).replace(/\./g,"%2E")}function BXe(t,e){var i;let n=t;const r=new Set(e);for(;r.has(n);)n=(i=/^.*(\d+)$/.exec(n))!=null&&i[1]?n.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${n} 1`;return n}function zC(t,e,n,r){if(n.length===0)return[];const i=new Map;for(const o of bt(n.map(a=>t.getShape(a)))){const{parentId:a}=o;i.has(a)||i.set(a,{children:bt(t.getSortedChildIdsForParent(a).map(l=>t.getShape(l))),moving:new Set}),i.get(a).moving.add(o)}const s=[];switch(e){case"toBack":{i.forEach(({moving:o,children:a})=>zXe(o,a,s));break}case"toFront":{i.forEach(({moving:o,children:a})=>UXe(o,a,s));break}case"forward":{i.forEach(({moving:o,children:a})=>HXe(t,o,a,s,r));break}case"backward":{i.forEach(({moving:o,children:a})=>VXe(t,o,a,s,r));break}}return s}function zXe(t,e,n){const r=e.length;if(t.size===r)return;let i,s;for(let o=0;o<r;o++){const a=e[o];if(t.has(a))i=a.index,t.delete(a);else{s=a.index;break}}if(t.size!==0){const o=$y(i,s,t.size);n.push(...Array.from(t.values()).sort(Xi).map((a,l)=>({...a,index:o[l]})))}}function UXe(t,e,n){const r=e.length;if(t.size===r)return;let i,s;for(let o=r-1;o>-1;o--){const a=e[o];if(t.has(a))s=a.index,t.delete(a);else{i=a.index;break}}if(t.size!==0){const o=$y(i,s,t.size);n.push(...Array.from(t.values()).sort(Xi).map((a,l)=>({...a,index:o[l]})))}}function Nfe(t,e){const n=bt(Array.from(e).map(i=>{const s=t.getShapePageBounds(i);return s?{shape:i,bounds:s}:null}));return i=>{const s=t.getShapePageBounds(i);return s?n.some(o=>o.bounds.includes(s)):!1}}function HXe(t,e,n,r,i){var l;const s=Nfe(t,e),o=n.length;if(e.size===o)return;let a={name:"skipping"};for(let c=0;c<o;c++){const u=e.has(n[c]);switch(a.name){case"skipping":{if(!u)continue;a={name:"selecting",selectIndex:c};break}case"selecting":{if(u||!(i!=null&&i.considerAllShapes)&&!s(n[c]))continue;const{selectIndex:d}=a;$y(n[c].index,(l=n[c+1])==null?void 0:l.index,c-d).forEach((h,f)=>{const y=n[d+f];e.has(y)&&r.push({...y,index:h})}),a={name:"skipping"};break}}}}function VXe(t,e,n,r,i){var l;const s=Nfe(t,e),o=n.length;if(e.size===o)return;let a={name:"skipping"};for(let c=o-1;c>-1;c--){const u=e.has(n[c]);switch(a.name){case"skipping":{if(!u)continue;a={name:"selecting",selectIndex:c};break}case"selecting":{if(u||!(i!=null&&i.considerAllShapes)&&!s(n[c]))continue;$y((l=n[c-1])==null?void 0:l.index,n[c].index,a.selectIndex-c).forEach((d,h)=>{const f=n[c+h+1];e.has(f)&&r.push({...f,index:d})}),a={name:"skipping"};break}}}}function jfe({editor:t,ids:e}){const n=bt(e.map(o=>t.getShape(o))),r=t.getShapesSharedRotation(e),i=t.getShapesRotatedPageBounds(e);if(!i)return null;const s=i.center.clone().rotWith(i.point,r);return{initialPageCenter:s,initialCursorAngle:s.angle(t.inputs.originPagePoint),initialShapesRotation:r,shapeSnapshots:n.map(o=>({shape:o,initialPagePoint:t.getShapePageTransform(o.id).point()}))}}function GE({delta:t,editor:e,snapshot:n,stage:r,centerOverride:i}){const{initialPageCenter:s,shapeSnapshots:o}=n;e.updateShapes(o.map(({shape:l,initialPagePoint:c})=>{const u=io(l.parentId)?e.getShapePageTransform(l.parentId):xe.Identity(),d=M.RotWith(c,i??s,t),h=xe.applyToPoint(xe.Inverse(u),d),f=qI(l.rotation+t);return{id:l.id,type:l.type,x:h.x,y:h.y,rotation:f}}));const a=[];o.forEach(({shape:l})=>{var h,f,y;const c=e.getShape(l.id);if(!c)return;const u=e.getShapeUtil(l);if(r==="start"||r==="one-off"){const b=(h=u.onRotateStart)==null?void 0:h.call(u,l);b&&a.push(b)}const d=(f=u.onRotate)==null?void 0:f.call(u,l,c);if(d&&a.push(d),r==="end"||r==="one-off"){const b=(y=u.onRotateEnd)==null?void 0:y.call(u,l,c);b&&a.push(b)}}),a.length>0&&e.updateShapes(a)}function XZ(t){const e=t.get(),n=new Map;for(const r of e){const{fromId:i,toId:s}=r,o=n.get(i);o?o.push(r):n.set(i,[r]);const a=n.get(s);a?a.push(r):n.set(s,[r])}return n}const WXe=t=>{const{store:e}=t,n=e.query.filterHistory("binding"),r=e.query.records("binding");return me("arrowBindingsIndex",(i,s)=>{if(Hp(i))return XZ(r);const o=i,a=n.getDiffSince(s);if(a===Aa)return XZ(r);let l;function c(h){l??(l=new Map(o));const f=l.get(h.fromId),y=f==null?void 0:f.filter(x=>x.id!==h.id);y!=null&&y.length?l.set(h.fromId,y):l.delete(h.fromId);const b=l.get(h.toId),v=b==null?void 0:b.filter(x=>x.id!==h.id);v!=null&&v.length?l.set(h.toId,v):l.delete(h.toId)}function u(h){l??(l=new Map(o));let f=l.get(h);return f?f===o.get(h)&&(f=f.slice(0),l.set(h,f)):(f=[],l.set(h,f)),f}function d(h){u(h.fromId).push(h),u(h.toId).push(h)}for(const h of a){for(const f of yr(h.added))d(f);for(const[f,y]of yr(h.updated))c(f),d(y);for(const f of yr(h.removed))c(f)}return l??o})};function KXe(t){const e=t.getCurrentPageShapeIds(),n=t.getViewportPageBounds(),r=new Set;return e.forEach(i=>{const s=t.getShapePageBounds(i);(s===void 0||!n.includes(s))&&r.add(i)}),r}function qXe(t){return me("notVisibleShapes",function(n){const r=KXe(t);if(Hp(n)||n.size!==r.size)return r;for(const i of n)if(!r.has(i))return r;return n})}function JZ(t,e){const n={},r=t.get(),i=Array(r.size);return r.forEach(s=>i.push(e.get(s))),i.sort(Xi),i.forEach(s=>{n[s.parentId]||(n[s.parentId]=[]),n[s.parentId].push(s.id)}),n}const GXe=t=>{const e=t.query.ids("shape"),n=t.query.filterHistory("shape");return me("parentsToChildrenWithIndexes",(r,i)=>{if(Hp(r))return JZ(e,t);const s=n.getDiffSince(i);if(s===Aa)return JZ(e,t);if(s.length===0)return r;let o=null;const a=u=>{o||(o={...r}),o[u]?o[u]===r[u]&&(o[u]=[...o[u]]):o[u]=[]},l=new Set;let c;for(let u=0,d=s.length;u<d;u++){c=s[u];for(const h of Object.values(c.added))ey(h)&&(a(h.parentId),o[h.parentId].push(h.id),l.add(o[h.parentId]));for(const[h,f]of Object.values(c.updated))if(ey(f)&&ey(h)){if(h.parentId!==f.parentId)a(h.parentId),a(f.parentId),o[h.parentId].splice(o[h.parentId].indexOf(f.id),1),o[f.parentId].push(f.id),l.add(o[f.parentId]);else if(h.index!==f.index){a(f.parentId);const y=o[f.parentId].indexOf(f.id);o[f.parentId][y]=f.id,l.add(o[f.parentId])}}for(const h of Object.values(c.removed))ey(h)&&(a(h.parentId),o[h.parentId].splice(o[h.parentId].indexOf(h.id),1))}for(const u of l){const d=bt(u.map(h=>t.get(h)));d.sort(Xi),u.splice(0,u.length,...d.map(h=>h.id))}return o??r})},Lj=(t,e,n)=>{for(;!Vi(n.parentId);){const r=t.get(n.parentId);if(!r)return!1;n=r}return n.parentId===e},YXe=(t,e)=>{const n=t.query.ids("shape");let r=null;function i(){const s=e();return r=s,new Set([...n.get()].filter(o=>Lj(t,s,t.get(o))))}return me("_shapeIdsInCurrentPage",(s,o)=>{if(Hp(s))return i();const a=e();if(a!==r)return i();const l=t.history.getDiffSince(o);if(l===Aa)return i();const c=new HE(s);for(const d of l){for(const h of Object.values(d.added))ey(h)&&Lj(t,a,h)&&c.add(h.id);for(const[h,f]of Object.values(d.updated))ey(f)&&(Lj(t,a,f)?c.add(f.id):c.remove(f.id));for(const h of Object.keys(d.removed))io(h)&&c.remove(h)}const u=c.get();return u?_b(u.value,u.diff):s})};var XXe=Object.create,Lfe=Object.defineProperty,JXe=Object.getOwnPropertyDescriptor,ZXe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Ffe=t=>{throw TypeError(t)},$fe=(t,e,n)=>e in t?Lfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,QXe=t=>[,,,XXe(null)],Bfe=["class","method","getter","setter","accessor","field","value","get","set"],zfe=t=>t!==void 0&&typeof t!="function"?Ffe("Function expected"):t,eJe=(t,e,n,r,i)=>({kind:Bfe[t],name:e,metadata:r,addInitializer:s=>n._?Ffe("Already initialized"):i.push(zfe(s||null))}),tJe=(t,e)=>$fe(e,ZXe("metadata"),t[3]),nJe=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},Ufe=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=Bfe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,JXe(i,n)),x=r.length-1;x>=0;x--)l=eJe(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,zfe(o)&&(v[y]=o);return v&&Lfe(i,n,v),i},Pm=(t,e,n)=>$fe(t,typeof e!="symbol"?e+"":e,n),Hfe,Vfe,OS;const rJe=40;Vfe=[Yo],Hfe=[Yo];class zk{constructor(e){this.editor=e,nJe(OS,5,this),Pm(this,"_clickId",""),Pm(this,"_clickTimeout"),Pm(this,"_clickScreenPoint"),Pm(this,"_previousScreenPoint"),Pm(this,"_clickState","idle"),Pm(this,"lastPointerInfo",{})}_getClickTimeout(e,n=fn()){this._clickId=n,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===n){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=M.From(e.point),this._previousScreenPoint&&M.Dist2(this._previousScreenPoint,this._clickScreenPoint)>rJe**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=M.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&M.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}OS=QXe();Ufe(OS,1,"_getClickTimeout",Vfe,zk);Ufe(OS,1,"cancelDoubleClickTimeout",Hfe,zk);tJe(OS,zk);class iJe{constructor(e){N(this,"_isEdgeScrolling",!1);N(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:n}=this,r=this.getEdgeScroll();if(r.x===0&&r.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>n.options.edgeScrollDelay){const i=n.options.edgeScrollEaseDuration>0?Ms.easeInCubic(Math.min(1,this._edgeScrollDuration/(n.options.edgeScrollDelay+n.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:r.x*i,y:r.y*i})}}getEdgeProximityFactors(e,n,r,i,s){const{editor:o}=this,a=o.options.edgeScrollDistance,l=r?o.options.coarsePointerWidth:0,c=e-l,u=e+l,d=i?0:a,h=s?n:n-a;return c<d?Math.min(1,(d-c)/a):u>h?-Math.min(1,(u-h)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:n,y:r}}}=e,i=e.getViewportScreenBounds(),{isCoarsePointer:s,insets:[o,a,l,c]}=e.getInstanceState(),u=this.getEdgeProximityFactors(n,i.w,s,c,a),d=this.getEdgeProximityFactors(r,i.h,s,o,l);return{x:u,y:d}}moveCameraWhenCloseToEdge(e){const{editor:n}=this;if(!n.inputs.isDragging||n.inputs.isPanning||n.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const r=n.getViewportScreenBounds(),i=r.w<1e3?.612:1,s=r.h<1e3?.612:1,o=n.getZoomLevel(),a=n.user.getEdgeScrollSpeed()*n.options.edgeScrollSpeed,l=a*e.x*i/o,c=a*e.y*s/o,{x:u,y:d,z:h}=n.getCamera();n.setCamera(new M(u+l,d+c,h))}}class sJe{constructor(e,n){N(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(i,s)=>{i.isFocused!==s.isFocused&&this.updateContainerClass()});const r=e.getInstanceState().isFocused;n!==r&&e.updateInstanceState({isFocused:!!n}),this.updateContainerClass(),document.body.addEventListener("keydown",this.handleKeyDown.bind(this)),document.body.addEventListener("mousedown",this.handleMouseDown.bind(this))}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused"),e.classList.add("tl-container__no-focus-ring")}handleKeyDown(e){const n=this.editor.getContainer();this.editor.isIn("select.editing_shape")||document.activeElement===n&&this.editor.getSelectedShapeIds().length>0||["Tab","ArrowUp","ArrowDown"].includes(e.key)&&n.classList.remove("tl-container__no-focus-ring")}handleMouseDown(){this.editor.getContainer().classList.add("tl-container__no-focus-ring")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;document.body.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.body.removeEventListener("mousedown",this.handleMouseDown.bind(this)),(e=this.disposeSideEffectListener)==null||e.call(this)}}class oJe{constructor(e,n){N(this,"shapeFontFacesCache");N(this,"shapeFontLoadStateCache");N(this,"fontStates",new F3("font states"));N(this,"fontsToLoad",new Set);this.editor=e,this.assetUrls=n,this.shapeFontFacesCache=e.store.createComputedCache("shape font faces",r=>this.editor.getShapeUtil(r).getFontFaces(r),{areResultsEqual:kI,areRecordsEqual:(r,i)=>r.props===i.props&&r.meta===i.meta}),this.shapeFontLoadStateCache=e.store.createCache(r=>{const i=me("font faces",()=>this.getShapeFontFaces(r));return me("font load state",()=>i.get().map(o=>this.getFontState(o)),{isEqual:kI})})}getShapeFontFaces(e){const n=typeof e=="string"?e:e.id;return this.shapeFontFacesCache.get(n)??Mr}trackFontsForShape(e){const n=typeof e=="string"?e:e.id;this.shapeFontLoadStateCache.get(n)}async loadRequiredFontsForCurrentPage(e=1/0){const n=new Set;for(const i of this.editor.getCurrentPageShapeIds())for(const s of this.getShapeFontFaces(this.editor.getShape(i)))n.add(s);if(n.size>e)return;const r=Array.from(n,i=>this.ensureFontIsLoaded(i));await Promise.all(r)}getFontState(e){return this.fontStates.get(e)??null}ensureFontIsLoaded(e){const n=this.getFontState(e);if(n)return n.loadingPromise;const r=this.findOrCreateFontFace(e),i={state:"loading",instance:r,loadingPromise:r.load().then(()=>{document.fonts.add(r),this.fontStates.update(e,s=>({...s,state:"ready"}))}).catch(s=>{console.error(s),this.fontStates.update(e,o=>({...o,state:"error"}))})};return this.fontStates.set(e,i),i.loadingPromise}requestFonts(e){this.fontsToLoad.size||queueMicrotask(()=>{if(this.editor.isDisposed)return;const n=this.fontsToLoad;this.fontsToLoad=new Set,Oa(()=>{for(const r of n)this.ensureFontIsLoaded(r)})});for(const n of e)this.fontsToLoad.add(n)}findOrCreateFontFace(e){var i;for(const s of document.fonts)if(s.family===e.family&&ho(ZZ).every(([o,a])=>s[o]===(e[o]??a)))return s;const n=((i=this.assetUrls)==null?void 0:i[e.src.url])??e.src.url,r=new FontFace(e.family,`url(${JSON.stringify(n)})`,{...Mf(ZZ,s=>e[s]),display:"swap"});return document.fonts.add(r),r}async toEmbeddedCssDeclaration(e){var s;const n=((s=this.assetUrls)==null?void 0:s[e.src.url])??e.src.url,r=await co.urlToDataUrl(n),i=bt([`url("${r}")`,e.src.format?`format(${e.src.format})`:null,e.src.tech?`tech(${e.src.tech})`:null]).join(" ");return bt(["@font-face {",`  font-family: "${e.family}";`,e.ascentOverride?`  ascent-override: ${e.ascentOverride};`:null,e.descentOverride?`  descent-override: ${e.descentOverride};`:null,e.stretch?`  font-stretch: ${e.stretch};`:null,e.style?`  font-style: ${e.style};`:null,e.weight?`  font-weight: ${e.weight};`:null,e.featureSettings?`  font-feature-settings: ${e.featureSettings};`:null,e.lineGapOverride?`  line-gap-override: ${e.lineGapOverride};`:null,e.unicodeRange?`  unicode-range: ${e.unicodeRange};`:null,`  src: ${i};`,"}"]).join(`
`)}}const ZZ={style:"normal",weight:"normal",stretch:"normal",unicodeRange:"U+0-10FFFF",featureSettings:"normal",ascentOverride:"normal",descentOverride:"normal",lineGapOverride:"normal"};class aJe{constructor(e){N(this,"store");N(this,"dispose");N(this,"state","recording");N(this,"pendingDiff",new cJe);N(this,"stacks",lr("HistoryManager.stacks",{undos:lb(),redos:lb()},{isEqual:(e,n)=>e.undos===n.undos&&e.redos===n.redos}));N(this,"annotateError");N(this,"_isInBatch",!1);this.store=e.store,this.annotateError=e.annotateError??nw,this.dispose=this.store.addHistoryInterceptor((n,r)=>{if(r==="user")switch(this.state){case"recording":this.pendingDiff.apply(n.changes),this.stacks.update(({undos:i})=>({undos:i,redos:lb()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(n.changes);break;case"paused":break;default:Yt(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:n,redos:r})=>({undos:n.push({type:"diff",diff:e}),redos:r}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}batch(e,n){const r=this.state;r!=="paused"&&(n!=null&&n.history)&&(this.state=lJe[n.history]);try{if(this._isInBatch)return Oa(e),this;this._isInBatch=!0;try{Oa(e)}catch(i){throw this.annotateError(i),i}finally{this._isInBatch=!1}return this}finally{this.state=r}}_undo({pushToRedoStack:e,toMark:n=void 0}){var i;const r=this.state;this.state="paused";try{let{undos:s,redos:o}=this.stacks.get();const a=this.pendingDiff.clear(),l=Gde(a),c=$3(a);e&&!l&&(o=o.push({type:"diff",diff:a}));let u=!1;if(l)for(;((i=s.head)==null?void 0:i.type)==="stop";){const d=s.head;if(s=s.tail,e&&(o=o.push(d)),d.id===n){u=!0;break}}if(!u)e:for(;s.head;){const d=s.head;switch(s=s.tail,e&&(o=o.push(d)),d.type){case"diff":ax(c,[$3(d.diff)]);break;case"stop":if(!n)break e;if(d.id===n){u=!0;break e}break;default:Yt(d)}}if(!u&&n)return this;this.store.applyDiff(c,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:o})}finally{this.state=r}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){var n;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:r,redos:i}=this.stacks.get();if(i.length===0)return this;for(;((n=i.head)==null?void 0:n.type)==="stop";)r=r.push(i.head),i=i.tail;const s=jI();for(;i.head;){const o=i.head;if(r=r.push(o),i=i.tail,o.type==="diff")ax(s,[o.diff]);else break}this.store.applyDiff(s,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:i})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return e&&this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){var s;let n=this.stacks.get().undos;const r=[];for(;n.head&&!(n.head.type==="stop"&&n.head.id===e);)n.head.type==="diff"&&r.push(n.head.diff),n=n.tail;if(!n.head||((s=n.head)==null?void 0:s.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(r.length===0)return this;const i=jI();return ax(i,r.reverse()),this.stacks.update(({redos:o})=>({undos:n.push({type:"diff",diff:i}),redos:o})),this}_mark(e){Oa(()=>{this.flushPendingDiff(),this.stacks.update(({undos:n,redos:r})=>({undos:n.push({type:"stop",id:e}),redos:r}))})}clear(){this.stacks.set({undos:lb(),redos:lb()}),this.pendingDiff.clear()}getMarkIdMatching(e){let n=this.stacks.get().undos;for(;n.head;){if(n.head.type==="stop"&&n.head.id.includes(e))return n.head.id;n=n.tail}return null}debug(){const{undos:e,redos:n}=this.stacks.get();return{undos:e.toArray(),redos:n.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const lJe={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class cJe{constructor(){N(this,"diff",jI());N(this,"isEmptyAtom",lr("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=jI(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){ax(this.diff,[e]),this.isEmptyAtom.set(Gde(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}function lb(t){return dJe}class uJe{constructor(){N(this,"length",0);N(this,"head",null);N(this,"tail",this)}push(e){return new RU(e,this)}toArray(){return Mr}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const dJe=new uJe;class RU{constructor(e,n){N(this,"length");this.head=e,this.tail=n,this.length=n.length+1}push(e){return new RU(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const n=e.head;return e=e.tail,{value:n,done:!1}}else return{value:void 0,done:!0}}}}}class hJe{constructor(e){N(this,"scribbleItems",new Map);N(this,"state","paused");this.editor=e}addScribble(e,n=fn()){const r={id:n,scribble:{id:n,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(n,r),r}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const n=this.scribbleItems.get(e);if(!n)throw Error(`Scribble with id ${e} not found`);return n.delayRemaining=Math.min(n.delayRemaining,200),n.scribble.state="stopping",n}addPoint(e,n,r,i=.5){const s=this.scribbleItems.get(e);if(!s)throw Error(`Scribble with id ${e} not found`);const{prev:o}=s,a={x:n,y:r,z:i};return(!o||M.Dist(o,a)>=1)&&(s.next=a),s}tick(e){this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(n=>{if(n.scribble.state==="starting"){const{next:l,prev:c}=n;l&&l!==c&&(n.prev=l,n.scribble.points.push(l)),n.scribble.points.length>8&&(n.scribble.state="active");return}n.delayRemaining>0&&(n.delayRemaining=Math.max(0,n.delayRemaining-e)),n.timeoutMs+=e,n.timeoutMs>=16&&(n.timeoutMs=0);const{delayRemaining:r,timeoutMs:i,prev:s,next:o,scribble:a}=n;switch(a.state){case"active":{o&&o!==s?(n.prev=o,a.points.push(o),r===0&&a.points.length>8&&a.points.shift()):i===0&&(a.points.length>1?a.points.shift():n.delayRemaining=a.delay);break}case"stopping":{if(n.delayRemaining===0&&i===0){if(a.points.length===1){this.scribbleItems.delete(n.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:n})=>({...n,points:[...n.points]})).slice(-5)})})}}var fJe=Object.create,Wfe=Object.defineProperty,pJe=Object.getOwnPropertyDescriptor,gJe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Kfe=t=>{throw TypeError(t)},qfe=(t,e,n)=>e in t?Wfe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mJe=t=>[,,,fJe(null)],Gfe=["class","method","getter","setter","accessor","field","value","get","set"],Yfe=t=>t!==void 0&&typeof t!="function"?Kfe("Function expected"):t,yJe=(t,e,n,r,i)=>({kind:Gfe[t],name:e,metadata:r,addInitializer:s=>n._?Kfe("Already initialized"):i.push(Yfe(s||null))}),vJe=(t,e)=>qfe(e,gJe("metadata"),t[3]),bJe=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},Uk=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=Gfe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,pJe(i,n)),x=r.length-1;x>=0;x--)l=yJe(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,Yfe(o)&&(v[y]=o);return v&&Wfe(i,n,v),i},xJe=(t,e,n)=>qfe(t,e+"",n),Xfe,Jfe,Zfe,Qfe,Vg;const mt=t=>Math.round(t*10**8)/10**8;function Xu(t,e,n,r,i){const s=t.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&mt(a.length)===mt(n)&&tc(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));if(s.length===0)return[];const o=new Set;return s.forEach(a=>{const l=r==="forward"?a.endNode.id:a.startNode.id;if(!o.has(l)){o.add(l);const c=Xu(t,l,n,r,tc(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));s.push(...c)}}),s}function wJe(t){t.sort((e,n)=>n.gaps.length-e.gaps.length);for(let e=t.length-1;e>0;e--){const n=t[e];for(let r=e-1;r>=0;r--){const i=t[r];if(i.direction===n.direction&&n.gaps.every(s=>i.gaps.some(o=>mt(s.startEdge[0].x)===mt(o.startEdge[0].x)&&mt(s.startEdge[0].y)===mt(o.startEdge[0].y)&&mt(s.startEdge[1].x)===mt(o.startEdge[1].x)&&mt(s.startEdge[1].y)===mt(o.startEdge[1].y))&&i.gaps.some(o=>mt(s.endEdge[0].x)===mt(o.endEdge[0].x)&&mt(s.endEdge[0].y)===mt(o.endEdge[0].y)&&mt(s.endEdge[1].x)===mt(o.endEdge[1].x)&&mt(s.endEdge[1].y)===mt(o.endEdge[1].y)))){t.splice(e,1);break}}}}Qfe=[me],Zfe=[me],Jfe=[me],Xfe=[me];class $v{constructor(e){this.manager=e,bJe(Vg,5,this),xJe(this,"editor"),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",n=>{const r=e.getShapePageTransform(n.id);if(!r)return;const s=e.getShapeUtil(n).getBoundsSnapGeometry(n).points??e.getShapeGeometry(n).bounds.cornersAndCenter;if(!(!r||!s))return s.map((o,a)=>{const{x:l,y:c}=xe.applyToPoint(r,o);return{x:l,y:c,id:`${n.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),n=this.manager.getSnappableShapes(),r=[];for(const i of n){const s=e.get(i);s&&r.push(...s)}return r}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:Ps(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],n=[];let r,i;const s=this.getSnappableGapNodes().sort((a,l)=>a.pageBounds.minX-l.pageBounds.minX);for(let a=0;a<s.length;a++){r=s[a];for(let l=a+1;l<s.length;l++)i=s[l],r.pageBounds.maxX<i.pageBounds.minX&&ob(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:r,endNode:i,startEdge:[new M(r.pageBounds.maxX,r.pageBounds.minY),new M(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new M(i.pageBounds.minX,i.pageBounds.minY),new M(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:tc(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const o=s.sort((a,l)=>a.pageBounds.minY-l.pageBounds.minY);for(let a=0;a<o.length;a++){r=o[a];for(let l=a+1;l<o.length;l++)i=o[l],r.pageBounds.maxY<i.pageBounds.minY&&ob(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&n.push({startNode:r,endNode:i,startEdge:[new M(r.pageBounds.minX,r.pageBounds.maxY),new M(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new M(i.pageBounds.minX,i.pageBounds.minY),new M(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:tc(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:n}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:n,initialSelectionSnapPoints:r,dragDelta:i}){var v,x;const s=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),a=n.clone().translate(i),l=r.map(({x:C,y:E},I)=>({id:"selection:"+I,x:C+i.x,y:E+i.y})),c=o,u=[],d=[],h=new M(s,s);this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const f=new M(e==="x"?0:((v=u[0])==null?void 0:v.nudge)??0,e==="y"?0:((x=d[0])==null?void 0:x.nudge)??0);h.x=0,h.y=0,u.length=0,d.length=0,l.forEach(C=>{C.x+=f.x,C.y+=f.y}),a.translate(f),this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const y=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:d}),b=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d});return this.manager.setIndicators([...b,...y]),{nudge:f}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:n,handle:r,isAspectRatioLocked:i,isResizingFromCenter:s}){var A,D;const o=this.manager.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=Ee.Resize(e,r,s?n.x*2:n.x,s?n.y*2:n.y,i);let u=r;l<0&&(u=AYe(u)),c<0&&(u=kYe(u)),s&&(a.center=e.center);const d=u==="top"||u==="bottom",h=u==="left"||u==="right",f=QZ(u,a),y=this.getSnappablePoints(),b=[],v=[],x=new M(o,o);this.collectPointSnaps({minOffset:x,nearestSnapsX:b,nearestSnapsY:v,otherNodeSnapPoints:y,selectionSnapPoints:f});const C=new M(d?0:((A=b[0])==null?void 0:A.nudge)??0,h?0:((D=v[0])==null?void 0:D.nudge)??0);if(i&&MYe(u)&&C.len()!==0){const L=b.length&&v.length?Math.abs(C.x)<Math.abs(C.y)?"x":"y":b.length?"x":"y",z=e.aspectRatio;L==="x"?(v.length=0,C.y=C.x/z,(u==="bottom_left"||u==="top_right")&&(C.y=-C.y)):(b.length=0,C.x=C.y*z,(u==="bottom_left"||u==="top_right")&&(C.x=-C.x))}const E=M.Add(n,C),{box:I}=Ee.Resize(e,r,s?E.x*2:E.x,s?E.y*2:E.y,i);s&&(I.center=e.center);const P=QZ("any",I);b.length=0,v.length=0,x.x=0,x.y=0,this.collectPointSnaps({minOffset:x,nearestSnapsX:b,nearestSnapsY:v,otherNodeSnapPoints:y,selectionSnapPoints:P});const _=this.getPointSnapLines({nearestSnapsX:b,nearestSnapsY:v});return this.manager.setIndicators([..._]),{nudge:C}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:n,minOffset:r,nearestSnapsX:i,nearestSnapsY:s}){for(const o of e)for(const a of n){const l=M.Sub(o,a),c=Math.abs(l.x),u=Math.abs(l.y);mt(c)<=mt(r.x)&&(mt(c)<mt(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.x-o.x}),r.x=c),mt(u)<=mt(r.y)&&(mt(u)<mt(r.y)&&(s.length=0),s.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.y-o.y}),r.y=u)}}collectGapSnaps({selectionPageBounds:e,minOffset:n,nearestSnapsX:r,nearestSnapsY:i}){const{horizontal:s,vertical:o}=this.getVisibleGaps();for(const a of s){if(!ob(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const c=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&mt(Math.abs(c))<=mt(n.x)){mt(Math.abs(c))<mt(n.x)&&(r.length=0),n.x=Math.abs(c);const x={type:"gap_center",gap:a,nudge:c},C=r.find(({type:I})=>I==="gap_center"),E=C&&tc(a.breadthIntersection[0],a.breadthIntersection[1],C.gap.breadthIntersection[0],C.gap.breadthIntersection[1]);C&&C.gap.length>a.length&&E?r[r.indexOf(C)]=x:(!C||!E)&&r.push(x)}const d=a.startNode.pageBounds.minX-a.length,h=e.maxX,f=d-h;mt(Math.abs(f))<=mt(n.x)&&(mt(Math.abs(f))<mt(n.x)&&(r.length=0),n.x=Math.abs(f),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:f}));const y=a.endNode.pageBounds.maxX+a.length,b=e.minX,v=y-b;mt(Math.abs(v))<=mt(n.x)&&(mt(Math.abs(v))<mt(n.x)&&(r.length=0),n.x=Math.abs(v),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:v}))}for(const a of o){if(!ob(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const c=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&mt(Math.abs(c))<=mt(n.y)){mt(Math.abs(c))<mt(n.y)&&(i.length=0),n.y=Math.abs(c);const x={type:"gap_center",gap:a,nudge:c},C=i.find(({type:I})=>I==="gap_center"),E=C&&ob(C.gap.breadthIntersection[0],C.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);C&&C.gap.length>a.length&&E?i[i.indexOf(C)]=x:(!C||!E)&&i.push(x);continue}const d=a.startNode.pageBounds.minY-a.length,h=e.maxY,f=d-h;mt(Math.abs(f))<=mt(n.y)&&(mt(Math.abs(f))<mt(n.y)&&(i.length=0),n.y=Math.abs(f),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:f}));const y=a.endNode.pageBounds.maxY+a.length,b=e.minY,v=y-b;mt(Math.abs(v))<=mt(n.y)&&(mt(Math.abs(v))<mt(n.y)&&(i.length=0),n.y=Math.abs(v),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:v}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:n}){const r={},i={};if(e.length>0){for(const s of e)if(s.type==="points"){const o=mt(s.points.otherPoint.x);r[o]||(r[o]=[]),r[o].push(s.points)}}if(n.length>0){for(const s of n)if(s.type==="points"){const o=mt(s.points.otherPoint.y);i[o]||(i[o]=[]),i[o].push(s.points)}}return Object.values(r).concat(Object.values(i)).map(s=>({id:fn(),type:"points",points:Tz(s.map(o=>M.From(o.otherPoint)).concat(s.map(o=>M.From(o.thisPoint))),(o,a)=>o.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:n,nearestSnapsY:r}){const{vertical:i,horizontal:s}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(n.length>0)for(const l of n){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:f,endEdge:y}}=l;switch(l.type){case"gap_center":{const b=(f-e.width)/2,v=tc(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:fn(),gaps:[...Xu(s,d.id,b,"backward",v),{startEdge:u,endEdge:o.left},{startEdge:o.right,endEdge:y},...Xu(s,h.id,b,"forward",v)]});break}case"gap_duplicate":{const b=tc(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:fn(),gaps:l.protrusionDirection==="left"?[{startEdge:o.right,endEdge:u.map(v=>v.clone().addXY(-d.pageBounds.width,0))},{startEdge:u,endEdge:y},...Xu(s,h.id,f,"forward",b)]:[...Xu(s,d.id,f,"backward",b),{startEdge:u,endEdge:y},{startEdge:y.map(v=>v.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:o.left}]});break}}}if(r.length>0)for(const l of r){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:f,endEdge:y}}=l;switch(l.type){case"gap_center":{const b=(f-e.height)/2,v=tc(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:fn(),gaps:[...Xu(i,d.id,b,"backward",v),{startEdge:u,endEdge:o.top},{startEdge:o.bottom,endEdge:y},...Xu(i,l.gap.endNode.id,b,"forward",v)]});break}case"gap_duplicate":{const b=tc(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:fn(),gaps:l.protrusionDirection==="top"?[{startEdge:o.bottom,endEdge:u.map(v=>v.clone().addXY(0,-d.pageBounds.height))},{startEdge:u,endEdge:y},...Xu(i,h.id,f,"forward",b)]:[...Xu(i,d.id,f,"backward",b),{startEdge:u,endEdge:y},{startEdge:y.map(v=>v.clone().addXY(0,h.pageBounds.height)),endEdge:o.top}]})}break}}return wJe(a),a}}Vg=mJe();Uk(Vg,1,"getSnapPointsCache",Qfe,$v);Uk(Vg,1,"getSnappablePoints",Zfe,$v);Uk(Vg,1,"getSnappableGapNodes",Jfe,$v);Uk(Vg,1,"getVisibleGaps",Xfe,$v);vJe(Vg,$v);function QZ(t,e){const{minX:n,maxX:r,minY:i,maxY:s}=e,o=[];switch(t){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(t){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(t){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:r,y:s})}switch(t){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:n,y:s})}return o}var SJe=Object.create,epe=Object.defineProperty,CJe=Object.getOwnPropertyDescriptor,EJe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),tpe=t=>{throw TypeError(t)},npe=(t,e,n)=>e in t?epe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,TJe=t=>[,,,SJe(null)],rpe=["class","method","getter","setter","accessor","field","value","get","set"],ipe=t=>t!==void 0&&typeof t!="function"?tpe("Function expected"):t,IJe=(t,e,n,r,i)=>({kind:rpe[t],name:e,metadata:r,addInitializer:s=>n._?tpe("Already initialized"):i.push(ipe(s||null))}),PJe=(t,e)=>npe(e,EJe("metadata"),t[3]),_Je=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},kJe=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=rpe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,CJe(i,n)),x=r.length-1;x>=0;x--)l=IJe(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,ipe(o)&&(v[y]=o);return v&&epe(i,n,v),i},AJe=(t,e,n)=>npe(t,e+"",n),spe,Hk;const MJe=()=>null,OJe=()=>[];spe=[me];class NU{constructor(e){this.manager=e,_Je(Hk,5,this),AJe(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",n=>{const r=e.getShapeUtil(n).getHandleSnapGeometry(n),i=r.getSelfSnapOutline?r.getSelfSnapOutline.bind(r):MJe,s=r.getSelfSnapPoints?r.getSelfSnapPoints.bind(r):OJe;return{outline:r.outline===void 0?e.getShapeGeometry(n):r.outline,points:r.points??[],getSelfSnapOutline:i,getSelfSnapPoints:s}})}*iterateSnapPointsInPageSpace(e,n){var i,s;const r=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapPoints(n);if(r&&r.length){const o=Ps(this.editor.getShapePageTransform(e));for(const a of r)yield o.applyToPoint(a)}for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const a=(s=this.getSnapGeometryCache().get(o))==null?void 0:s.points;if(!a||!a.length)continue;const l=Ps(this.editor.getShapePageTransform(o));for(const c of a)yield l.applyToPoint(c)}}*iterateSnapOutlines(e,n){var i,s;const r=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapOutline(n);r&&(yield{shapeId:e,outline:r});for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const a=(s=this.getSnapGeometryCache().get(o))==null?void 0:s.outline;a&&(yield{shapeId:o,outline:a})}}getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:r}){const i=this.manager.getSnapThreshold();let s=i,o=null;for(const c of this.iterateSnapPointsInPageSpace(e,n))M.DistMin(r,c,s)&&(s=M.Dist(r,c),o=c);if(o)return o;let a=i,l=null;for(const{shapeId:c,outline:u}of this.iterateSnapOutlines(e,n)){const d=Ps(this.editor.getShapePageTransform(c)),h=this.editor.getPointInShapeSpace(c,r),f=u.nearestPoint(h),y=d.applyToPoint(f);M.DistMin(r,y,a)&&(a=M.Dist(r,y),l=y)}return l||null}snapHandle({currentShapeId:e,handle:n}){const i=Ps(this.editor.getShapePageTransform(e)).applyToPoint(n),s=this.getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:i});return s?(this.manager.setIndicators([{id:fn(),type:"points",points:[s]}]),{nudge:M.Sub(s,i)}):null}}Hk=TJe();kJe(Hk,1,"getSnapGeometryCache",spe,NU);PJe(Hk,NU);var DJe=Object.create,ope=Object.defineProperty,RJe=Object.getOwnPropertyDescriptor,NJe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),ape=t=>{throw TypeError(t)},lpe=(t,e,n)=>e in t?ope(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,jJe=t=>[,,,DJe(null)],cpe=["class","method","getter","setter","accessor","field","value","get","set"],upe=t=>t!==void 0&&typeof t!="function"?ape("Function expected"):t,LJe=(t,e,n,r,i)=>({kind:cpe[t],name:e,metadata:r,addInitializer:s=>n._?ape("Already initialized"):i.push(upe(s||null))}),FJe=(t,e)=>lpe(e,NJe("metadata"),t[3]),$Je=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},jU=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=cpe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,RJe(i,n)),x=r.length-1;x>=0;x--)l=LJe(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,upe(o)&&(v[y]=o);return v&&ope(i,n,v),i},Fj=(t,e,n)=>lpe(t,typeof e!="symbol"?e+"":e,n),dpe,hpe,fpe,Bv;fpe=[me],hpe=[me],dpe=[me];class DS{constructor(e){this.editor=e,$Je(Bv,5,this),Fj(this,"shapeBounds"),Fj(this,"handles"),Fj(this,"_snapIndicators",lr("snapLines",void 0)),this.shapeBounds=new $v(this),this.handles=new NU(this)}getIndicators(){return this._snapIndicators.get()??Mr}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,n=e.getViewportPageBounds(),r=e.getSelectedShapeIds(),i=new Set,s=o=>{if(io(o)){const l=e.getShape(o);l&&e.isShapeOfType(l,"frame")&&i.add(o)}const a=e.getSortedChildIdsForParent(o);for(const l of a){if(r.includes(l))continue;const c=e.getShape(l);if(!c||!e.getShapeUtil(c).canSnap(c))continue;const d=e.getShapePageBounds(l);if(d&&n.includes(d)){if(e.isShapeOfType(c,"group")){s(l);continue}i.add(l)}}};return s(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}Bv=jJe();jU(Bv,1,"getSnapThreshold",fpe,DS);jU(Bv,1,"getSnappableShapes",hpe,DS);jU(Bv,1,"getCurrentCommonAncestor",dpe,DS);FJe(Bv,DS);const BJe=/\r?\n|\r/g;function eQ(t){return t.replace(BJe,`
`).split(`
`).map(e=>e||" ").join(`
`)}const zJe={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},UJe=/\s/,tQ=Object.freeze({"overflow-wrap":"break-word","word-break":"auto",width:null,height:null,"max-width":null,"min-width":null});class HJe{constructor(e){N(this,"elm");this.editor=e;const n=document.createElement("div");n.classList.add("tl-text"),n.classList.add("tl-text-measure"),n.setAttribute("dir","auto"),n.tabIndex=-1,this.editor.getContainer().appendChild(n),this.elm=n;for(const r of sx(tQ))n.style.setProperty(r,tQ[r])}setElementStyles(e){const n={};for(const r of sx(e))if(typeof e[r]=="string"){const i=this.elm.style.getPropertyValue(r);if(i===e[r])continue;n[r]=i,this.elm.style.setProperty(r,e[r])}return()=>{for(const r of sx(n))this.elm.style.setProperty(r,n[r])}}dispose(){return this.elm.remove()}measureText(e,n){const r=document.createElement("div");return r.textContent=eQ(e),this.measureHtml(r.innerHTML,n)}measureHtml(e,n){const{elm:r}=this,i={"font-family":n.fontFamily,"font-style":n.fontStyle,"font-weight":n.fontWeight,"font-size":n.fontSize+"px","line-height":n.lineHeight.toString(),padding:n.padding,"max-width":n.maxWidth?n.maxWidth+"px":void 0,"min-width":n.minWidth?n.minWidth+"px":void 0,"overflow-wrap":n.disableOverflowWrapBreaking?"normal":void 0,...n.otherStyles},s=this.setElementStyles(i);try{r.innerHTML=e;const o=n.measureScrollWidth?r.scrollWidth:0,a=r.getBoundingClientRect();return{x:0,y:0,w:a.width,h:a.height,scrollWidth:o}}finally{s()}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:n=!1}={}){const r=[],i=e.getBoundingClientRect(),s=-i.left,o=-i.top,a=new Range,l=e.childNodes[0];let c=0,u=null,d=null,h=0,f=0,y=!1;for(const b of e.childNodes)if(b.nodeType===Node.TEXT_NODE)for(const v of b.textContent??""){a.setStart(l,c),a.setEnd(l,c+v.length);const x=a.getClientRects(),C=x[x.length-1],E=C.top+o,I=C.left+s,P=C.right+s,_=I<f,A=UJe.test(v);if(A!==d||E!==h||!u){if(u){if(n&&E!==h){y=!0;break}r.push(u)}u={box:{x:I,y:E,w:C.width,h:C.height},text:v},f=I}else _&&(u.box.x=I),u.box.w=_?u.box.w+C.width:P-u.box.x,u.text+=v;v===`
`&&(f=0),d=A,h=E,c+=v.length}return u&&r.push(u),{spans:r,didTruncate:y}}measureTextSpans(e,n){if(e==="")return[];const{elm:r}=this,i=n.overflow==="truncate-ellipsis"||n.overflow==="truncate-clip",s=Math.ceil(n.width-n.padding*2),o={"font-family":n.fontFamily,"font-style":n.fontStyle,"font-weight":n.fontWeight,"font-size":n.fontSize+"px","line-height":n.lineHeight.toString(),width:`${s}px`,height:"min-content","text-align":zJe[n.textAlign],"overflow-wrap":i?"anywhere":void 0,"word-break":i?"break-all":void 0,...n.otherStyles},a=this.setElementStyles(o);try{const l=eQ(e);r.textContent=l;const{spans:c,didTruncate:u}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:i});if(n.overflow==="truncate-ellipsis"&&u){r.textContent="…";const d=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width",`${s-d}px`),r.textContent=l;const h=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,f=h[h.length-1];return h.push({text:"…",box:{x:Math.min(f.box.x+f.box.w,n.width-n.padding-d),y:f.box.y,w:d,h:f.box.h}}),h}return c}finally{a()}}}var VJe=Object.create,ppe=Object.defineProperty,WJe=Object.getOwnPropertyDescriptor,KJe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),gpe=t=>{throw TypeError(t)},mpe=(t,e,n)=>e in t?ppe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,qJe=t=>[,,,VJe(null)],ype=["class","method","getter","setter","accessor","field","value","get","set"],vpe=t=>t!==void 0&&typeof t!="function"?gpe("Function expected"):t,GJe=(t,e,n,r,i)=>({kind:ype[t],name:e,metadata:r,addInitializer:s=>n._?gpe("Already initialized"):i.push(vpe(s||null))}),YJe=(t,e)=>mpe(e,KJe("metadata"),t[3]),XJe=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},bpe=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=ype[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,WJe(i,n)),x=r.length-1;x>=0;x--)l=GJe(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,vpe(o)&&(v[y]=o);return v&&ppe(i,n,v),i},UC=(t,e,n)=>mpe(t,typeof e!="symbol"?e+"":e,n),xpe,wpe,RS;const nQ=Nz;wpe=[Yo],xpe=[Yo];class Vk{constructor(e){this.editor=e,XJe(RS,5,this),UC(this,"cancelRaf"),UC(this,"isPaused",!0),UC(this,"now",0),UC(this,"prevPoint",new M),this.editor.disposables.add(this.dispose),this.start()}start(){var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=nQ(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),n=e-this.now;this.now=e,this.updatePointerVelocity(n),this.editor.emit("frame",n),this.editor.emit("tick",n),this.cancelRaf=nQ(this.tick)}dispose(){var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)}updatePointerVelocity(e){const{prevPoint:n,editor:{inputs:{currentScreenPoint:r,pointerVelocity:i}}}=this;if(e===0)return;const s=M.Sub(r,n);this.prevPoint=r.clone();const o=s.len(),a=o?s.div(o):new M(0,0),l=i.clone().lrp(a.mul(o/e),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),i.equals(l)||(this.editor.inputs.pointerVelocity=l)}}RS=qJe();bpe(RS,1,"tick",wpe,Vk);bpe(RS,1,"dispose",xpe,Vk);YJe(RS,Vk);var JJe=Object.create,Spe=Object.defineProperty,ZJe=Object.getOwnPropertyDescriptor,QJe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Cpe=t=>{throw TypeError(t)},Epe=(t,e,n)=>e in t?Spe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,eZe=t=>[,,,JJe(null)],Tpe=["class","method","getter","setter","accessor","field","value","get","set"],Ipe=t=>t!==void 0&&typeof t!="function"?Cpe("Function expected"):t,tZe=(t,e,n,r,i)=>({kind:Tpe[t],name:e,metadata:r,addInitializer:s=>n._?Cpe("Already initialized"):i.push(Ipe(s||null))}),nZe=(t,e)=>Epe(e,QJe("metadata"),t[3]),rZe=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},Va=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=Tpe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,ZJe(i,n)),x=r.length-1;x>=0;x--)l=tZe(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,Ipe(o)&&(v[y]=o);return v&&Spe(i,n,v),i},rQ=(t,e,n)=>Epe(t,typeof e!="symbol"?e+"":e,n),Ppe,_pe,kpe,Ape,Mpe,Ope,Dpe,Rpe,Npe,jpe,Lpe,Fpe,$pe,Ws;$pe=[me],Fpe=[me],Lpe=[me],jpe=[me],Npe=[me],Rpe=[me],Dpe=[me],Ope=[me],Mpe=[me],Ape=[me],kpe=[me],_pe=[me],Ppe=[me];class To{constructor(e,n){if(this.user=e,this.inferDarkMode=n,rZe(Ws,5,this),rQ(this,"systemColorScheme",lr("systemColorScheme","light")),rQ(this,"disposables",new Set),typeof window>"u"||!("matchMedia"in window))return;const r=window.matchMedia("(prefers-color-scheme: dark)");r!=null&&r.matches&&this.systemColorScheme.set("dark");const i=s=>{s.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};r==null||r.addEventListener("change",i),this.disposables.add(()=>r==null?void 0:r.removeEventListener("change",i))}dispose(){this.disposables.forEach(e=>e())}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),areKeyboardShortcutsEnabled:this.getAreKeyboardShortcutsEnabled(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??hl.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??hl.animationSpeed}getAreKeyboardShortcutsEnabled(){return this.user.userPreferences.get().areKeyboardShortcutsEnabled??hl.areKeyboardShortcutsEnabled}getId(){return this.user.userPreferences.get().id}getName(){var e;return((e=this.user.userPreferences.get().name)==null?void 0:e.trim())??hl.name}getLocale(){return this.user.userPreferences.get().locale??hl.locale}getColor(){return this.user.userPreferences.get().color??hl.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??hl.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??hl.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??hl.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??hl.isPasteAtCursorMode}}Ws=eZe();Va(Ws,1,"getUserPreferences",$pe,To);Va(Ws,1,"getIsDarkMode",Fpe,To);Va(Ws,1,"getEdgeScrollSpeed",Lpe,To);Va(Ws,1,"getAnimationSpeed",jpe,To);Va(Ws,1,"getAreKeyboardShortcutsEnabled",Npe,To);Va(Ws,1,"getId",Rpe,To);Va(Ws,1,"getName",Dpe,To);Va(Ws,1,"getLocale",Ope,To);Va(Ws,1,"getColor",Mpe,To);Va(Ws,1,"getIsSnapMode",Ape,To);Va(Ws,1,"getIsWrapMode",kpe,To);Va(Ws,1,"getIsDynamicResizeMode",_pe,To);Va(Ws,1,"getIsPasteAtCursorMode",Ppe,To);nZe(Ws,To);const iZe={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},sZe=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class Qe{constructor(e,n){N(this,"performanceTracker");N(this,"id");N(this,"type");N(this,"shapeType");N(this,"initial");N(this,"children");N(this,"isLockable");N(this,"useCoalescedEvents");N(this,"parent");N(this,"_path");N(this,"_current");N(this,"_isActive");N(this,"_currentToolIdMask",lr("curent tool id mask",void 0));this.editor=e;const{id:r,children:i,initial:s,isLockable:o,useCoalescedEvents:a}=this.constructor;this.id=r,this._isActive=lr("toolIsActive"+this.id,!1),this._current=lr("toolState"+this.id,void 0),this._path=me("toolPath"+this.id,()=>{const l=this.getCurrent();return this.id+(l?`.${l.getPath()}`:"")}),this.parent=n??{},n?i&&s?(this.type="branch",this.initial=s,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&s&&(this.initial=s,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=o,this.useCoalescedEvents=a,this.performanceTracker=new Fue}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}transition(e,n={}){var s;const r=e.split(".");let i=this;for(let o=0;o<r.length;o++){const a=r[o],l=i.getCurrent(),c=(s=i.children)==null?void 0:s[a];if(!c)throw Error(`${i.id} - no child state exists with the id ${a}.`);if((l==null?void 0:l.id)!==c.id&&(l==null||l.exit(n,a),i._current.set(c),c.enter(n,(l==null?void 0:l.id)||"initial"),!c.getIsActive()))break;i=c}return this}handleEvent(e){var i;const n=iZe[e.name],r=this._current.__unsafe__getWithoutCapture();(i=this[n])==null||i.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&r&&r===this._current.__unsafe__getWithoutCapture()&&r.handleEvent(e)}enter(e,n){var r;if(Jn.measurePerformance.get()&&sZe.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,n),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,n)}}exit(e,n){var r,i;Jn.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(r=this.onExit)==null||r.call(this,e,n),this.getIsActive()||(i=this.getCurrent())==null||i.exit(e,n)}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}addChild(e){if(this.type==="leaf")throw new Error("StateNode.addChild: cannot add child to a leaf node");this.children||(this.children={});const n=new e(this.editor,this);if(this.children[n.id])throw new Error(`StateNode.addChild: a child with id '${n.id}' already exists`);return this.children[n.id]=n,this}}N(Qe,"id"),N(Qe,"initial"),N(Qe,"children"),N(Qe,"isLockable",!0),N(Qe,"useCoalescedEvents",!1);class Z3 extends Qe{static children(){return[]}onKeyDown(e){var n;switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const r=this.getCurrent();r&&((n=r.getCurrent())==null?void 0:n.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:r.id})}break}}}}N(Z3,"id","root"),N(Z3,"initial","");var oZe=Object.create,Bpe=Object.defineProperty,aZe=Object.getOwnPropertyDescriptor,zpe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Upe=t=>{throw TypeError(t)},Hpe=(t,e,n)=>e in t?Bpe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lZe=t=>[,,,oZe((t==null?void 0:t[zpe("metadata")])??null)],Vpe=["class","method","getter","setter","accessor","field","value","get","set"],Wpe=t=>t!==void 0&&typeof t!="function"?Upe("Function expected"):t,cZe=(t,e,n,r,i)=>({kind:Vpe[t],name:e,metadata:r,addInitializer:s=>n._?Upe("Already initialized"):i.push(Wpe(s||null))}),uZe=(t,e)=>Hpe(e,zpe("metadata"),t[3]),dZe=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},Ve=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=Vpe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,aZe(i,n)),x=r.length-1;x>=0;x--)l=cZe(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,Wpe(o)&&(v[y]=o);return v&&Bpe(i,n,v),i},at=(t,e,n)=>Hpe(t,typeof e!="symbol"?e+"":e,n),Kpe,qpe,Gpe,Ype,Xpe,Jpe,Zpe,Qpe,ege,tge,nge,rge,ige,sge,oge,age,lge,cge,uge,dge,hge,fge,pge,gge,mge,yge,vge,bge,xge,wge,Sge,Cge,Ege,Tge,Ige,Pge,_ge,kge,Age,Mge,Oge,Dge,Rge,Nge,jge,Lge,Fge,$ge,Bge,zge,Uge,Hge,Vge,Wge,Kge,qge,Gge,Yge,Xge,Jge,Zge,Qge,eme,tme,nme,rme,ime,sme,ome,ame,lme,cme,ume,Q3,ze;let Be=class extends(Q3=EYe,ume=[me],cme=[me],lme=[me],ame=[me],ome=[me],sme=[me],ime=[me],rme=[me],nme=[me],tme=[me],eme=[me],Qge=[me],Zge=[me],Jge=[me],Xge=[me],Yge=[me],Gge=[me],qge=[me],Kge=[me],Wge=[me],Vge=[me],Hge=[me],Uge=[me],zge=[me],Bge=[me],$ge=[me],Fge=[me],Lge=[me],jge=[me],Nge=[me],Rge=[me],Dge=[me],Oge=[me],Mge=[me],Age=[me],kge=[me],_ge=[me],Pge=[me],Ige=[me],Tge=[me],Ege=[me],Cge=[me],Sge=[me],wge=[me],xge=[me],bge=[me],vge=[me],yge=[me],mge=[me],gge=[me],pge=[me],fge=[me],hge=[me],dge=[me],uge=[me],cge=[me],lge=[me],age=[me],oge=[me],sge=[me],ige=[me],rge=[me],nge=[me],tge=[me],ege=[me],Qpe=[me({isEqual:(e,n)=>e.equals(n)})],Zpe=[me],Jpe=[me],Xpe=[me],Ype=[Yo],Gpe=[Yo],qpe=[Yo],Kpe=[Yo],Q3){constructor({store:e,user:n,shapeUtils:r,bindingUtils:i,tools:s,getContainer:o,cameraOptions:a,textOptions:l,initialState:c,autoFocus:u,inferDarkMode:d,options:h,isShapeHidden:f,getShapeVisibility:y,fontAssetUrls:b}){var H;super(),dZe(ze,5,this),at(this,"id",fn()),at(this,"_getShapeVisibility"),at(this,"options"),at(this,"contextId",fn()),at(this,"store"),at(this,"root"),at(this,"disposables",new Set),at(this,"isDisposed",!1),at(this,"_tickManager"),at(this,"snaps"),at(this,"timers",X3.forContext(this.contextId)),at(this,"user"),at(this,"textMeasure"),at(this,"fonts"),at(this,"environment",sn),at(this,"scribbles"),at(this,"sideEffects"),at(this,"edgeScrollManager"),at(this,"focusManager"),at(this,"getContainer"),at(this,"shapeUtils"),at(this,"styleProps"),at(this,"bindingUtils"),at(this,"history"),at(this,"_shouldIgnoreShapeLock",!1),at(this,"_crashingError",null),at(this,"_isChangingStyleTimeout",-1),at(this,"menus",oo.forContext(this.contextId)),at(this,"_currentRichTextEditor",lr("rich text editor",null)),at(this,"_textOptions"),at(this,"_cameraOptions",lr("camera options",OZ)),at(this,"_viewportAnimation",null),at(this,"_willSetInitialBounds",!0),at(this,"_isLockedOnFollowingUser",lr("isLockedOnFollowingUser",!1)),at(this,"_cameraState",lr("camera state","idle")),at(this,"_cameraStateTimeoutRemaining",0),at(this,"_currentPageShapeIds"),at(this,"_shapeGeometryCaches",{}),at(this,"_notVisibleShapes",qXe(this)),at(this,"_parentIdsToChildIds"),at(this,"animatingShapes",new Map),at(this,"externalAssetContentHandlers",{file:null,url:null}),at(this,"temporaryAssetPreview",new Map),at(this,"externalContentHandlers",{text:null,files:null,"file-replace":null,embed:null,"svg-text":null,url:null,tldraw:null,excalidraw:null}),at(this,"inputs",{originPagePoint:new M,originScreenPoint:new M,previousPagePoint:new M,previousScreenPoint:new M,currentPagePoint:new M,currentScreenPoint:new M,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new M}),at(this,"_clickManager",new zk(this)),at(this,"_prevCursor","default"),at(this,"_shiftKeyTimeout",-1),at(this,"_altKeyTimeout",-1),at(this,"_ctrlKeyTimeout",-1),at(this,"_metaKeyTimeout",-1),at(this,"_restoreToolId","select"),at(this,"_pinchStart",1),at(this,"_didPinch",!1),at(this,"_selectedShapeIdsAtPointerDown",[]),at(this,"_longPressTimeout",-1),at(this,"capturedPointerId",null),at(this,"performanceTracker"),at(this,"performanceTrackerTimeout",-1),at(this,"_pendingEventsForNextTick",[]),it(!(f&&y),"Cannot use both isShapeHidden and getShapeVisibility"),this._getShapeVisibility=f?(R,j)=>f(R,j)?"hidden":"inherit":y,this.options={...RXe,...h},this.store=e,this.history=new aJe({store:e,annotateError:R=>{this.annotateError(R,{origin:"history.batch",willCrashApp:!0}),this.crash(R)}}),this.snaps=new DS(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...OZ,...a}),this._textOptions=lr("text options",l??null),this.user=new To(n??efe(),d??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=o,this.textMeasure=new HJe(this),this.disposables.add(()=>this.textMeasure.dispose()),this.fonts=new oJe(this,b),this._tickManager=new Vk(this);class v extends Z3{}N(v,"initial",c??""),this.root=new v(this),this.root.children={};const x=ufe(r),C={},E={},I=new Map;for(const R of x){const j=new R(this);C[R.type]=j;const B=Zde(R.props??{});E[R.type]=B;for(const K of B.keys())if(!I.has(K.id))I.set(K.id,K);else if(I.get(K.id)!==K)throw Error(`Multiple style props with id "${K.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=C,this.styleProps=E;const P=sfe(i),_={};for(const R of P){const j=new R(this);_[R.type]=j}this.bindingUtils=_;for(const R of[...s]){if(Il(this.root.children,R.id))throw Error(`Can't override tool with id "${R.id}"`);this.root.children[R.id]=new R(this,this.root)}this.scribbles=new hJe(this);const A=(R,j)=>{let B=null;const K=R.selectedShapeIds.filter(W=>!j.has(W));K.length!==R.selectedShapeIds.length&&(B||(B={...R}),B.selectedShapeIds=K);const G=R.erasingShapeIds.filter(W=>!j.has(W));G.length!==R.erasingShapeIds.length&&(B||(B={...R}),B.erasingShapeIds=G),R.hoveredShapeId&&j.has(R.hoveredShapeId)&&(B||(B={...R}),B.hoveredShapeId=null),R.editingShapeId&&j.has(R.editingShapeId)&&(B||(B={...R}),B.editingShapeId=null);const V=R.hintingShapeIds.filter(W=>!j.has(W));return V.length!==R.hintingShapeIds.length&&(B||(B={...R}),B.hintingShapeIds=V),R.focusedGroupId&&j.has(R.focusedGroupId)&&(B||(B={...R}),B.focusedGroupId=null),B};this.sideEffects=this.store.sideEffects;let D=new Map;const L=new Set,z=new Set;let $=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var R,j,B,K;L.clear();for(const G of z){z.delete(G);const V=this.getShape(G);if(!V)continue;const W=this.getShapeUtil(V),Z=(R=W.onChildrenChange)==null?void 0:R.call(W,V);Z!=null&&Z.length&&this.updateShapes(Z)}if($.size){const G=$;$=new Set;for(const V of G){const W=this.getBindingUtil(V);(j=W.onOperationComplete)==null||j.call(W)}}if(D.size){const G=D;D=new Map;for(const V of G.values())(K=(B=this.getBindingUtil(V.binding)).onAfterDelete)==null||K.call(B,V)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(R,j)=>{var B,K,G,V;for(const W of this.getBindingsInvolvingShape(j))$.add(W.type),W.fromId===j.id&&((K=(B=this.getBindingUtil(W)).onAfterChangeFromShape)==null||K.call(B,{binding:W,shapeBefore:R,shapeAfter:j,reason:"self"})),W.toId===j.id&&((V=(G=this.getBindingUtil(W)).onAfterChangeToShape)==null||V.call(G,{binding:W,shapeBefore:R,shapeAfter:j,reason:"self"}));if(R.parentId!==j.parentId){const W=Z=>{var J,ge,_e,fe;const U=this.getShape(Z);if(U)for(const je of this.getBindingsInvolvingShape(U))$.add(je.type),je.fromId===U.id&&((ge=(J=this.getBindingUtil(je)).onAfterChangeFromShape)==null||ge.call(J,{binding:je,shapeBefore:U,shapeAfter:U,reason:"ancestry"})),je.toId===U.id&&((fe=(_e=this.getBindingUtil(je)).onAfterChangeToShape)==null||fe.call(_e,{binding:je,shapeBefore:U,shapeAfter:U,reason:"ancestry"}))};W(j.id),this.visitDescendants(j.id,W)}if(R.parentId!==j.parentId&&Vi(j.parentId)){const W=new Set([R.id]);this.visitDescendants(R.id,Z=>{W.add(Z)});for(const Z of this.getPageStates()){if(Z.pageId===j.parentId)continue;const U=A(Z,W);U&&this.store.put([U])}}R.parentId&&io(R.parentId)&&z.add(R.parentId),j.parentId!==R.parentId&&io(j.parentId)&&z.add(j.parentId)},beforeDelete:R=>{var G,V,W,Z;if(L.has(R.id))return;R.parentId&&io(R.parentId)&&z.add(R.parentId),L.add(R.id);const j=[];for(const U of this.getBindingsInvolvingShape(R)){$.add(U.type),j.push(U.id);const J=this.getBindingUtil(U);U.fromId===R.id?((G=J.onBeforeIsolateToShape)==null||G.call(J,{binding:U,removedShape:R}),(V=J.onBeforeDeleteFromShape)==null||V.call(J,{binding:U,shape:R})):((W=J.onBeforeIsolateFromShape)==null||W.call(J,{binding:U,removedShape:R}),(Z=J.onBeforeDeleteToShape)==null||Z.call(J,{binding:U,shape:R}))}j.length&&this.deleteBindings(j);const B=new Set([R.id]),K=bt(this.getPageStates().map(U=>A(U,B)));K.length&&this.store.put(K)}},binding:{beforeCreate:R=>{var B,K;const j=(K=(B=this.getBindingUtil(R)).onBeforeCreate)==null?void 0:K.call(B,{binding:R});return j||R},afterCreate:R=>{var j,B;$.add(R.type),(B=(j=this.getBindingUtil(R)).onAfterCreate)==null||B.call(j,{binding:R})},beforeChange:(R,j)=>{var K,G;const B=(G=(K=this.getBindingUtil(j)).onBeforeChange)==null?void 0:G.call(K,{bindingBefore:R,bindingAfter:j});return B||j},afterChange:(R,j)=>{var B,K;$.add(j.type),(K=(B=this.getBindingUtil(j)).onAfterChange)==null||K.call(B,{bindingBefore:R,bindingAfter:j})},beforeDelete:R=>{var j,B;(B=(j=this.getBindingUtil(R)).onBeforeDelete)==null||B.call(j,{binding:R})},afterDelete:R=>{var j,B;(B=(j=this.getBindingUtil(R)).onAfterDelete)==null||B.call(j,{binding:R}),$.add(R.type)}},page:{afterCreate:R=>{const j=ru.createId(R.id),B=cc.createId(R.id);this.store.has(j)||this.store.put([ru.create({id:j})]),this.store.has(B)||this.store.put([cc.create({id:B,pageId:R.id})])},afterDelete:(R,j)=>{var G,V;if(((G=this.getInstanceState())==null?void 0:G.currentPageId)===R.id){const W=(V=this.getPages().find(Z=>Z.id!==R.id))==null?void 0:V.id;W?this.store.put([{...this.getInstanceState(),currentPageId:W}]):j==="user"&&this.store.ensureStoreIsUsable()}const B=ru.createId(R.id),K=cc.createId(R.id);this.store.remove([B,K])}},instance:{afterChange:(R,j,B)=>{var K;if(!this.store.has(j.currentPageId)){const G=this.store.has(R.currentPageId)?R.currentPageId:(K=this.getPages()[0])==null?void 0:K.id;G?this.store.update(j.id,V=>({...V,currentPageId:G})):B==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(R,j)=>{if((R==null?void 0:R.selectedShapeIds)!==(j==null?void 0:j.selectedShapeIds)){const B=j.selectedShapeIds.filter(G=>{var W,Z;let V=(W=this.getShape(G))==null?void 0:W.parentId;for(;io(V);){if(j.selectedShapeIds.includes(V))return!1;V=(Z=this.getShape(V))==null?void 0:Z.parentId}return!0});let K=null;if(B.length>0){const G=this.findCommonAncestor(bt(B.map(V=>this.getShape(V))),V=>this.isShapeOfType(V,"group"));G&&(K=G)}else j!=null&&j.focusedGroupId&&(K=j.focusedGroupId);(B.length!==j.selectedShapeIds.length||K!==j.focusedGroupId)&&this.store.put([{...j,selectedShapeIds:B,focusedGroupId:K??null}])}}}})),this._currentPageShapeIds=YXe(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=GXe(this.store),this.disposables.add(this.store.listen(R=>{this.emit("change",R)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),c&&this.root.children[c]===void 0)throw Error(`No state found for initialState "${c}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new iJe(this),this.focusManager=new sJe(this,u),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new Fue,(H=this.store.props.collaboration)!=null&&H.mode){const R=this.store.props.collaboration.mode;this.disposables.add(Ma("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:R.get()==="readonly"}])}))}}getIsShapeHiddenCache(){return this._getShapeVisibility?this.store.createComputedCache("isShapeHidden",e=>{const n=this._getShapeVisibility(e,this);return(fo.isId(e.parentId)?!1:this.isShapeHidden(e.parentId))?n!=="visible":n==="hidden"}):null}isShapeHidden(e){return this._getShapeVisibility?!!this.getIsShapeHiddenCache().get(typeof e=="string"?e:e.id):!1}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.store.dispose(),this.isDisposed=!0}getShapeUtil(e){const n=typeof e=="string"?e:e.type,r=Ar(this.shapeUtils,n);return it(r,`No shape util found for type "${n}"`),r}hasShapeUtil(e){const n=typeof e=="string"?e:e.type;return Il(this.shapeUtils,n)}getBindingUtil(e){const n=typeof e=="string"?e:e.type,r=Ar(this.bindingUtils,n);return it(r,`No binding util found for type "${n}"`),r}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return console.warn(typeof e=="string"?`[tldraw] \`editor.history.mark("${e}")\` is deprecated. Please use \`const myMarkId = editor.markHistoryStoppingPoint()\` instead.`:"[tldraw] `editor.mark()` is deprecated. Use `editor.markHistoryStoppingPoint()` instead."),this.history._mark(e??fn()),this}markHistoryStoppingPoint(e){const n=`[${e??"stop"}]_${fn()}`;return this.history._mark(n),n}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,n){const r=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(n==null?void 0:n.ignoreShapeLock)??r;try{this.history.batch(e,n)}finally{this._shouldIgnoreShapeLock=r}return this}batch(e,n){return this.run(e,n)}annotateError(e,{origin:n,willCrashApp:r,tags:i,extras:s}){const o=this.createErrorAnnotations(n,r);return Pz(e,{tags:{...o.tags,...i},extras:{...o.extras,...s}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,n){try{const r=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:n},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes().map(i=>{const{props:s,...o}=i,{text:a,richText:l,...c}=s;return{...o,props:c}}),selectionCount:this.getSelectedShapes().length,editingShape:r?this.getShape(r):void 0,inputs:this.inputs,pageState:this.getCurrentPageState(),instanceState:this.getInstanceState(),collaboratorCount:this.getCollaboratorsOnCurrentPage().length}}}catch{return{tags:{origin:e,willCrashApp:n},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const n=e.split(".").reverse();let r=this.root;for(;n.length>0;){const i=n.pop();if(!i)return!0;const s=r.getCurrent();if((s==null?void 0:s.id)===i){if(n.length===0)return!0;r=s;continue}else return!1}return!1}isInAny(...e){return e.some(n=>this.isIn(n))}setCurrentTool(e,n={}){return this.root.transition(e,n),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){var i;const n=e.split(".").reverse();let r=this.root;for(;n.length>0;){const s=n.pop();if(!s)return r;const o=(i=r.children)==null?void 0:i[s];if(!o)return;r=o}return r}getDocumentSettings(){return this.store.get(U3)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(so)}updateInstanceState(e,n){return this._updateInstanceState(e,{history:"ignore",...n}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},1e3))),this}_updateInstanceState(e,n){this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},n)}getOpenMenus(){return this.menus.getOpenMenus()}addOpenMenu(e){return this.menus.addOpenMenu(e),this}deleteOpenMenu(e){return this.menus.deleteOpenMenu(e),this}clearOpenMenus(){return this.menus.clearOpenMenus(),this}getIsMenuOpen(){return this.menus.hasAnyOpenMenus()}setCursor(e){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return cc.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){this.store.update(e.id??this.getCurrentPageState().id,n=>({...n,...e}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){return bt(this.getSelectedShapeIds().map(e=>this.store.get(e)))}setSelectedShapes(e){return this.run(()=>{const n=e.map(s=>typeof s=="string"?s:s.id),{selectedShapeIds:r}=this.getCurrentPageState(),i=new Set(r);if(n.length===i.size&&n.every(s=>i.has(s)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:n}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null,r=this.getShape(n);if(!r)return!1;const i=this.getSelectedShapeIds();return!!this.findShapeAncestor(r,s=>i.includes(s.id))}select(...e){const n=typeof e[0]=="string"?e:e.map(r=>r.id);return this.setSelectedShapes(n),this}deselect(...e){const n=typeof e[0]=="string"?e:e.map(i=>i.id),r=this.getSelectedShapeIds();return r.length>0&&n.length>0&&this.setSelectedShapes(r.filter(i=>!n.includes(i))),this}selectAll(){let e=null;const n=this.getSelectedShapeIds();if(n.length>0)for(const i of n){const s=this.getShape(i);if(s){if(e===null)e=s.parentId;else if(e!==s.parentId)return this}}e||(e=this.getCurrentPageId());const r=this.getSortedChildIdsForParent(e);return r.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(r)),this)}selectAdjacentShape(e){var u,d;const n=this.getSelectedShapeIds(),r=n[0]?(u=this.getShape(n[0]))==null?void 0:u.parentId:null,i=r&&n.every(h=>{var f;return((f=this.getShape(h))==null?void 0:f.parentId)===r})&&!Vi(r),s=i?this.getCurrentPageShapes().filter(h=>h.parentId===r):this.getCurrentPageShapes().filter(h=>Vi(h.parentId)),o=i?this._getShapesInReadingOrder(s):this.getCurrentPageShapesInReadingOrder(),a=n.length===1?n[0]:(d=o.find(h=>n.includes(h.id)))==null?void 0:d.id;let l;if(e==="next"||e==="prev"){const h=o.map(b=>b.id),y=((a?h.indexOf(a):-1)+(e==="next"?1:-1)+h.length)%h.length;l=h[y]}else{if(!a)return;l=this.getNearestAdjacentShape(s,a,e)}const c=this.getShape(l);c&&this._selectShapesAndZoom([c.id])}getCurrentPageShapesInReadingOrder(){const e=this.getCurrentPageShapes().filter(n=>Vi(n.parentId));return this._getShapesInReadingOrder(e)}_getShapesInReadingOrder(e){const i=e.filter(a=>this.getShapeUtil(a).canTabTo(a));if(i.length<=1)return i;const s=i.map(a=>({shape:a,center:this.getShapePageBounds(a).center}));s.sort((a,l)=>a.center.y-l.center.y);const o=[];for(const a of s){let l=-1;for(let c=o.length-1;c>=0;c--){const u=o[c],d=u[u.length-1];if(Math.abs(a.center.y-d.center.y)<100){l=c;break}}l===-1?o.push([a]):o[l].push(a)}for(const a of o)a.sort((l,c)=>l.center.x-c.center.x);for(const a of o)if(!(a.length<=2))for(let l=0;l<a.length-2;l++){const c=a[l],u=a[l+1],d=a[l+2],h=M.Dist2(c.center,u.center);M.Dist2(c.center,d.center)<h*.9&&Math.abs(M.Angle(c.center,d.center)*(180/Math.PI))<=20&&([a[l+1],a[l+2]]=[a[l+2],a[l+1]])}return o.flat().map(a=>a.shape)}getNearestAdjacentShape(e,n,r){const i={right:0,left:180,down:90,up:270},s=this.getShape(n);if(!s)return n;const o=e.filter(d=>this.getShapeUtil(d).canTabTo(d)&&d.id!==n);if(!o.length)return n;const a=this.getShapePageBounds(s).center,c=o.map(d=>({shape:d,center:this.getShapePageBounds(d).center})).filter(({center:d})=>{const h=d.x>a.x,f=d.y>a.y,y=d.x-a.x,b=d.y-a.y,v=Math.abs(b)<Math.abs(y)*2,x=Math.abs(y)<Math.abs(b)*2;if(r==="left"||r==="right")return v&&(r==="right"?h:!h);if(r==="up"||r==="down")return x&&(r==="down"?f:!f)});return c.length===0?n:Aue(c,({center:d})=>{const h=M.Dist2(a,d),f=["left","right"].includes(r)?"x":"y",y=Math.abs(d[f]-a[f]),b=["left","right"].includes(r)?"y":"x",v=Math.abs(d[b]-a[b]),x=Math.abs(M.Angle(a,d)*(180/Math.PI)),C=Math.abs(x-i[r]);return h*1+v*2+(h-y)*1.5+C*.5}).shape.id}selectParentShape(){const e=this.getOnlySelectedShape();if(!e)return;const n=this.getShape(e.parentId);n&&this._selectShapesAndZoom([n.id])}selectFirstChildShape(){const e=this.getSelectedShapes();if(!e.length)return;const n=e[0],r=this.getSortedChildIdsForParent(n.id).map(s=>this.getShape(s)).filter(s=>s),i=this._getShapesInReadingOrder(r);i.length!==0&&this._selectShapesAndZoom([i[0].id])}_selectShapesAndZoom(e){this.setSelectedShapes(e),this.zoomToSelectionIfOffscreen(256,{animation:{duration:this.options.animationMediumMs},inset:0})}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e;return((e=this.getOnlySelectedShape())==null?void 0:e.id)??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getShapesPageBounds(e){const n=bt(e.map(r=>this.getShapePageBounds(r)));return n.length===0?null:Ee.Common(n)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getSelectionScreenBounds(){const e=this.getSelectionPageBounds();if(!e)return;const{x:n,y:r}=this.pageToScreen(e.point),i=this.getZoomLevel();return new Ee(n,r,e.width*i,e.height*i)}getShapesSharedRotation(e){let n=!1,r=0;for(let i=0,s=e.length;i<s;i++){const o=this.getShapePageTransform(e[i]);if(o)if(n){if(o.rotation()!==r)return 0}else n=!0,r=o.rotation()}return r}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(e.length===0)return;const n=this.getShapesSharedRotation(e);if(n===0)return this.getShapesPageBounds(e)??void 0;if(e.length===1){const i=this.getShapeGeometry(e[0]).bounds.clone(),s=this.getShapePageTransform(e[0]);return i.point=s.applyToPoint(i.point),i}const r=Ee.FromPoints(e.flatMap(i=>{const s=this.getShapePageTransform(i);return s?s.applyToPoints(this.getShapeGeometry(i).bounds.corners):[]}).map(i=>i.rot(-n)));return r.point=r.point.rot(n),r}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:n,y:r}=this.pageToScreen(e.point),i=this.getZoomLevel();return new Ee(n,r,e.width*i,e.height*i)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(n!==null){const r=this.getShape(n);if(!r)throw Error(`Editor.setFocusedGroup: Shape with id ${n} does not exist`);if(!this.isShapeOfType(r,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${r.type}`)}return n===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:n}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const n=this.findShapeAncestor(e,r=>this.isShapeOfType(r,"group"));this.setFocusedGroup((n==null?void 0:n.id)??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null;this.setRichTextEditor(null);const r=this.getEditingShapeId();if(n!==r){if(n){const i=this.getShape(n);if(i&&this.getShapeUtil(i).canEdit(i))return this.run(()=>{var s,o,a,l;if(this._updateCurrentPageState({editingShapeId:n}),r){const c=this.getShape(r);c&&((o=(s=this.getShapeUtil(c)).onEditEnd)==null||o.call(s,c))}(l=(a=this.getShapeUtil(i)).onEditStart)==null||l.call(a,i)},{history:"ignore"}),this}this.run(()=>{var i,s;if(this._updateCurrentPageState({editingShapeId:null}),this._currentRichTextEditor.set(null),r){const o=this.getShape(r);o&&((s=(i=this.getShapeUtil(o)).onEditEnd)==null||s.call(i,o))}},{history:"ignore"})}return this}getRichTextEditor(){return this._currentRichTextEditor.get()}setRichTextEditor(e){return this._currentRichTextEditor.set(e),this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null;return n===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:n})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return bt(e.map(n=>this.getShape(n)))}setHintingShapes(e){const n=typeof e[0]=="string"?e:e.map(r=>r.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:Tz(n)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return bt(e.map(n=>this.getShape(n)))}setErasingShapes(e){const n=typeof e[0]=="string"?e:e.map(i=>i.id);n.sort();const r=this.getErasingShapeIds();return this.run(()=>{if(n.length===r.length){for(let i=0;i<n.length;i++)if(n[i]!==r[i]){this._updateCurrentPageState({erasingShapeIds:n});break}}else this._updateCurrentPageState({erasingShapeIds:n})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null;return n!==this.getCroppingShapeId()&&this.run(()=>{if(!n)this.updateCurrentPageState({croppingShapeId:null});else{const r=this.getShape(n),i=this.getShapeUtil(r);r&&i.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:n})}},{history:"ignore"}),this}getTextOptions(){return Ps(this._textOptions.get(),"Cannot use text without setting textOptions")}_unsafe_getCameraId(){return ru.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const n=this.getCameraForFollowing();if(n)return{...e,...n}}return e}_getFollowingPresence(e){const n=[this.user.getId()],r=this.getCollaborators();let i=null;for(;e&&!n.includes(e);)i=r.find(s=>s.userId===e)??null,e=(i==null?void 0:i.followingUserId)??null,i&&n.push(i.userId);return i}getViewportPageBoundsForFollowing(){const e=this._getFollowingPresence(this.getInstanceState().followingUserId);if(!(e!=null&&e.camera)||!(e!=null&&e.screenBounds))return null;const{w:n,h:r}=e.screenBounds,{x:i,y:s,z:o}=e.camera,a=new Ee(-i,-s,n/o,r/o),l=this.getViewportScreenBounds().clone(),c=l.width/l.height;return l.width=a.width,l.height=l.width/c,l.height<a.height&&(l.height=a.height,l.width=l.height*c),l.center=a.center,l}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:n,zy:r}=sQ(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(n,r);case"fit-max":return Math.min(n,r);case"fit-x":return n;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(n,r));case"fit-max-100":return Math.min(1,Math.min(n,r));case"fit-x-100":return Math.min(1,n);case"fit-y-100":return Math.min(1,r);default:throw Yt(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:n,zy:r}=sQ(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(n,r);case"fit-max":return Math.min(n,r);case"fit-x":return n;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(n,r));case"fit-max-100":return Math.min(1,Math.min(n,r));case"fit-x-100":return Math.min(1,n);case"fit-y-100":return Math.min(1,r);default:throw Yt(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var r;const n=ar({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return((r=n.zoomSteps)==null?void 0:r.length)<1&&(n.zoomSteps=[1]),this._cameraOptions.set(n),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,n){const r=this.getCamera();let{x:i,y:s,z:o=r.z}=e;if(!(n!=null&&n.force)){const a=this.getCameraOptions(),l=a.zoomSteps[0],c=Yi(a.zoomSteps),u=this.getViewportScreenBounds();if(a.constraints){const{constraints:d}=a,h=Math.min(d.padding.y,u.w/2),f=Math.min(d.padding.x,u.h/2),y=Ee.From(a.constraints.bounds),b=(u.w-f*2)/y.w,v=(u.h-h*2)/y.h,x=this.getBaseZoom(),C=c*x,E=l*x;if(n!=null&&n.reset&&(o=this.getInitialZoom()),o<E||o>C){const{x:H,y:R,z:j}=r,B=-H+u.w/j/2,K=-R+u.h/j/2;o=Ct(o,E,C);const G=-H+u.w/o/2,V=-R+u.h/o/2;i=H+G-B,s=R+V-K}const I=f/o-y.x,P=h/o-y.y,_=(u.w-f*2)/o-y.w,A=(u.h-h*2)/o-y.h,D=I+_*d.origin.x,L=P+A*d.origin.y,z=typeof d.behavior=="string"?d.behavior:d.behavior.x,$=typeof d.behavior=="string"?d.behavior:d.behavior.y;if(n!=null&&n.reset)i=D,s=L;else{switch(z){case"fixed":{i=D;break}case"contain":{o<b?i=D:i=Ct(i,I+_,I);break}case"inside":{o<b?i=Ct(i,I,(u.w-f)/o-y.w):i=Ct(i,I+_,I);break}case"outside":{i=Ct(i,f/o-y.w,(u.w-f)/o);break}case"free":break;default:throw Yt(z)}switch($){case"fixed":{s=L;break}case"contain":{o<v?s=L:s=Ct(s,P+A,P);break}case"inside":{o<v?s=Ct(s,P,(u.h-h)/o-y.h):s=Ct(s,P+A,P);break}case"outside":{s=Ct(s,h/o-y.h,(u.h-h)/o);break}case"free":break;default:throw Yt($)}}}else if(o>c||o<l){const{x:d,y:h,z:f}=r;o=Ct(o,l,c),i=d+(-d+u.w/o/2)-(-d+u.w/f/2),s=h+(-h+u.h/o/2)-(-h+u.h/f/2)}}return{x:i,y:s,z:o}}_setCamera(e,n){const r=this.getCamera(),{x:i,y:s,z:o}=this.getConstrainedCamera(e,n);return r.x===i&&r.y===s&&r.z===o?this:(Oa(()=>{const a={...r,x:i,y:s,z:o};this.run(()=>{this.store.put([a])},{history:"ignore"});const{currentScreenPoint:l,currentPagePoint:c}=this.inputs,{screenBounds:u}=this.store.unsafeGetWithoutCapture(so);if(l.x/o-i!==c.x||l.y/o-s!==c.y){const d={type:"pointer",target:"canvas",name:"pointer_move",point:M.AddXY(l,u.x,u.y),pointerId:DZ.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,metaKey:this.inputs.metaKey,accelKey:ni(this.inputs),button:0,isPen:this.getInstanceState().isPenMode??!1};n!=null&&n.immediate?this._flushEventForTick(d):this.dispatch(d)}this._tickCameraState()}),this)}setCamera(e,n){const{isLocked:r}=this._cameraOptions.__unsafe__getWithoutCapture();if(r&&!(n!=null&&n.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const i=M.Cast(e);Number.isFinite(i.x)||(i.x=0),Number.isFinite(i.y)||(i.y=0),(i.z===void 0||!Number.isFinite(i.z))&&(e.z=this.getZoomLevel());const s=this.getConstrainedCamera(i,n);if(n!=null&&n.animation){const{width:o,height:a}=this.getViewportScreenBounds();this._animateToViewport(new Ee(-s.x,-s.y,o/s.z,a/s.z),n)}else this._setCamera(s,{...n,force:!0});return this}centerOnPoint(e,n){const{isLocked:r}=this.getCameraOptions();if(r&&!(n!=null&&n.force))return this;const{width:i,height:s}=this.getViewportPageBounds();return this.setCamera(new M(-(e.x-i/2),-(e.y-s/2),this.getCamera().z),n),this}zoomToFit(e){const n=[...this.getCurrentPageShapeIds()];if(n.length<=0)return this;const r=Ee.Common(bt(n.map(i=>this.getShapePageBounds(i))));return this.zoomToBounds(r,e),this}resetZoom(e=this.getViewportScreenCenter(),n){const{isLocked:r,constraints:i}=this.getCameraOptions();if(r&&!(n!=null&&n.force))return this;const s=this.getCamera(),{x:o,y:a,z:l}=s,{x:c,y:u}=e;let d=1;if(i){const h=this.getInitialZoom();l!==h&&(d=h)}return this.setCamera(new M(o+(c/d-c)-(c/l-c),a+(u/d-u)-(u/l-u),d),n),this}zoomIn(e=this.getViewportScreenCenter(),n){const{isLocked:r}=this.getCameraOptions();if(r&&!(n!=null&&n.force))return this;const{x:i,y:s,z:o}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const l=this.getBaseZoom();let c=Yi(a)*l;for(let u=1;u<a.length;u++){const d=a[u-1]*l,h=a[u]*l;if(!(h-o<=(h-d)/2)){c=h;break}}this.setCamera(new M(i+(e.x/c-e.x)-(e.x/o-e.x),s+(e.y/c-e.y)-(e.y/o-e.y),c),n)}return this}zoomOut(e=this.getViewportScreenCenter(),n){const{isLocked:r}=this.getCameraOptions();if(r&&!(n!=null&&n.force))return this;const{zoomSteps:i}=this.getCameraOptions();if(i!==null&&i.length>1){const s=this.getBaseZoom(),{x:o,y:a,z:l}=this.getCamera();let c=i[0]*s;for(let u=i.length-1;u>0;u--){const d=i[u-1]*s,h=i[u]*s;if(!(h-l>=(h-d)/2)){c=d;break}}this.setCamera(new M(o+(e.x/c-e.x)-(e.x/l-e.x),a+(e.y/c-e.y)-(e.y/l-e.y),c),n)}return this}zoomToSelection(e){const{isLocked:n}=this.getCameraOptions();if(n&&!(e!=null&&e.force))return this;const r=this.getSelectionPageBounds();return r&&this.zoomToBounds(r,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToSelectionIfOffscreen(e=16,n){const r=this.getSelectionPageBounds(),i=this.getViewportPageBounds();if(r&&!i.contains(r)){const s=r.clone().expandBy(e/this.getZoomLevel()).expand(i),o=i.clone().translate({x:(s.center.x-i.center.x)*2,y:(s.center.y-i.center.y)*2});this.zoomToBounds(o,n)}}zoomToBounds(e,n){const r=this._cameraOptions.__unsafe__getWithoutCapture();if(r.isLocked&&!(n!=null&&n.force))return this;const i=this.getViewportScreenBounds(),s=(n==null?void 0:n.inset)??Math.min(QGe,i.width*.28),o=this.getBaseZoom(),a=r.zoomSteps[0],l=Yi(r.zoomSteps);let c=Ct(Math.min((i.width-s)/e.w,(i.height-s)/e.h),a*o,l*o);return(n==null?void 0:n.targetZoom)!==void 0&&(c=Math.min(n.targetZoom,c)),this.setCamera(new M(-e.x+(i.width-e.w*c)/2/c,-e.y+(i.height-e.h*c)/2/c,c),n),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:n,easing:r,duration:i,start:s,end:o}=this._viewportAnimation;if(n>i){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new M(-o.x,-o.y,this.getViewportScreenBounds().width/o.width));return}const a=i-n,l=r(1-a/i),c=s.minX+(o.minX-s.minX)*l,u=s.minY+(o.minY-s.minY)*l,d=s.maxX+(o.maxX-s.maxX)*l;this._setCamera(new M(-c,-u,this.getViewportScreenBounds().width/(d-c)),{force:!0})}_animateToViewport(e,n={animation:_j}){const{animation:r,...i}=n;if(!r)return;const{duration:s=0,easing:o=Ms.easeInOutCubic}=r,a=this.user.getAnimationSpeed(),l=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),s===0||a===0?this._setCamera(new M(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...i}):(this._viewportAnimation={elapsed:0,duration:s/a,easing:o,start:l.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:n}=this.getCameraOptions();if(n&&!(e!=null&&e.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:i,friction:s=this.options.cameraSlideFriction,direction:o,speedThreshold:a=.01}=e;let l=Math.min(i,1);const c=()=>{this.off("tick",u),this.off("stop-camera-animation",c)};this.once("stop-camera-animation",c);const u=d=>{const{x:h,y:f,z:y}=this.getCamera(),b=M.Mul(o,l*d/y);l*=1-s,l<a?c():this._setCamera(new M(h+b.x,f+b.y,y))};return this.on("tick",u),this}zoomToUser(e,n={animation:{duration:500}}){const r=this.getCollaborators().find(s=>s.userId===e);if(!r)return this;const i=r.cursor;return i?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const s=r.currentPageId===this.getCurrentPageId();s||this.setCurrentPage(r.currentPageId),n&&n.animation&&!s&&(n.animation=void 0),this.centerOnPoint(i,n);const{highlightedUserIds:o}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...o,e]}),this.timers.setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],l=a.indexOf(e);l<0||(a.splice(l,1),this.updateInstanceState({highlightedUserIds:a}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,n=!1){if(e instanceof Ee)e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);else{const a=e.getBoundingClientRect();e=new Ee(a.left||a.x,a.top||a.y,Math.max(a.width,1),Math.max(a.height,1))}const r=[e.minY!==0,!Nr(document.body.scrollWidth,e.maxX,1),!Nr(document.body.scrollHeight,e.maxY,1),e.minX!==0],{_willSetInitialBounds:i}=this;this._willSetInitialBounds=!1;const{screenBounds:s,insets:o}=this.getInstanceState();if(e.equals(s)&&r.every((a,l)=>a===o[l]))return this;if(i)this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.setCamera(this.getCamera());else if(n&&!this.getInstanceState().followingUserId){const a=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.centerOnPoint(a)}else this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this._setCamera(M.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:n,w:r,h:i}=this.getInstanceState().screenBounds;return new Ee(e,n,r,i)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new M(e.w/2,e.h/2)}getViewportPageBounds(){const{w:e,h:n}=this.getViewportScreenBounds(),{x:r,y:i,z:s}=this.getCamera();return new Ee(-r,-i,e/s,n/s)}screenToPage(e){const{screenBounds:n}=this.store.unsafeGetWithoutCapture(so),{x:r,y:i,z:s=1}=this.getCamera();return new M((e.x-n.x)/s-r,(e.y-n.y)/s-i,e.z??.5)}pageToScreen(e){const{screenBounds:n}=this.store.unsafeGetWithoutCapture(so),{x:r,y:i,z:s=1}=this.getCamera();return new M((e.x+r)*s+n.x,(e.y+i)*s+n.y,e.z??.5)}pageToViewport(e){const{x:n,y:r,z:i=1}=this.getCamera();return new M((e.x+n)*i,(e.y+r)*i,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(r=>r.userId))].sort().map(r=>BVe(e.filter(s=>s.userId===r),s=>s.lastActivityTimestamp??0)):Mr}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(n=>n.currentPageId===e)}startFollowingUser(e){if(this.stopFollowingUser(),this.user.getId()||console.warn("You should set the userId for the current instance before following a user"),!this._getFollowingPresence(e))return this;const i=me("latestLeaderPresence",()=>this._getFollowingPresence(e));return Oa(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const s=Ma("update current page",()=>{const l=i.get();if(!l){this.stopFollowingUser();return}l.currentPageId!==this.getCurrentPageId()&&this.getPage(l.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:l.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),o=()=>{s(),this._isLockedOnFollowingUser.set(!1),this.off("frame",a),this.off("stop-following",o)},a=()=>{if(!i.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const c=this.user.getAnimationSpeed();if(c===0){this._isLockedOnFollowingUser.set(!0);return}const u=this.getViewportPageBoundsForFollowing();if(!u){this.stopFollowingUser();return}const d=this.getViewportPageBounds(),h=Math.abs(u.minX-d.minX)+Math.abs(u.maxX-d.maxX),f=Math.abs(u.minY-d.minY)+Math.abs(u.maxY-d.maxY);if(h<this.options.followChaseViewportSnap&&f<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const y=Ct(c*.5,.1,.8),b=new Ee(At(d.minX,u.minX,y),At(d.minY,u.minY,y),At(d.width,u.width,y),At(d.height,u.height,y)),v=new M(-b.x,-b.y,this.getViewportScreenBounds().width/b.width);this.stopCameraAnimation(),this._setCamera(v)};this.once("stop-following",o),this.addListener("frame",a),a()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const n=[];let r=this.options.maxShapesPerPage*2,i=this.options.maxShapesPerPage;const s=this.getErasingShapeIds(),o=(l,c,u)=>{const d=this.getShape(l);if(!d)return;if(this.isShapeHidden(d)){const v=u||s.includes(l);for(const x of this.getSortedChildIdsForParent(l))o(x,c,v);return}c*=d.opacity;let h=!1;const f=this.getShapeUtil(d);e&&(h=!u&&s.includes(l),h&&(c*=.32)),n.push({id:l,shape:d,util:f,index:r,backgroundIndex:i,opacity:c}),r+=1,i+=1;const y=this.getSortedChildIdsForParent(l);if(!y.length)return;let b=null;f.providesBackgroundForChildren(d)&&(b=i,i=r,r+=this.options.maxShapesPerPage);for(const v of y)o(v,c,u||h);b!==null&&(i=b)},a=e?[this.getCurrentPage()]:this.getPages();for(const l of a)for(const c of this.getSortedChildIdsForParent(l.id))o(c,1,!1);return n}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(xWe)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return Array.from(this._getAllPagesQuery().get()).sort(Xi)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const n=typeof e=="string"?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:n}});return this.getShapeAndDescendantIds(r.map(i=>i.id))}setCurrentPage(e){const n=typeof e=="string"?e:e.id;return this.store.has(n)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:n}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getIsReadonly()?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,r=>({...r,...e}))):this}createPage(e){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;const n=this.getPages(),r=BXe(e.name??"Page 1",n.map(o=>o.name));let i=e.index;(!i||n.some(o=>o.index===i))&&(i=ac(n[n.length-1].index));const s=fo.create({meta:{},...e,name:r,index:i});this.store.put([s])}),this}deletePage(e){const n=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getIsReadonly())return;const r=this.getPages();if(r.length===1)return;const i=this.getPage(n);if(i){if(n===this.getCurrentPageId()){const s=r.findIndex(a=>a.id===n),o=r[s-1]??r[s+1];this.setCurrentPage(o.id)}this.store.remove([i.id])}}),this}duplicatePage(e,n=fo.createId()){if(this.getPages().length>=this.options.maxPages)return this;const r=typeof e=="string"?e:e.id,i=this.getPage(r);if(!i)return this;const s={...this.getCamera()},o=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(i.id));return this.run(()=>{var c;const a=this.getPages(),l=By(i.index,(c=a[a.indexOf(i)+1])==null?void 0:c.index);if(this.createPage({name:i.name+" Copy",id:n,index:l}),this.setCurrentPage(n),this.setCamera(s),o)return this.putContentOntoCurrentPage(o)}),this}renamePage(e,n){const r=typeof e=="string"?e:e.id;return this.getIsReadonly()?this:(this.updatePage({id:r,name:n}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(n=>({...this.store.get(n.id),...n})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getIsReadonly())return this;const n=typeof e[0]=="string"?e:e.map(r=>r.id);return n.length<=0?this:(this.run(()=>{var r,i;(i=(r=this.store.props.assets).remove)==null||i.call(r,n),this.store.remove(n)},{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,n){if(!e)return null;const r=this.getAsset(e);if(!r)return null;const{screenScale:i=1,shouldResolveToOriginal:s=!1,dpr:o=this.getInstanceState().devicePixelRatio}=n,l=(u=>Math.pow(2,Math.ceil(Math.log2(u))))(i),c="connection"in navigator?navigator.connection.effectiveType:null;return await this.store.props.assets.resolve(r,{screenScale:i||1,steppedScreenScale:l,dpr:o,networkEffectiveType:c,shouldResolveToOriginal:s})}async uploadAsset(e,n,r){return await this.store.props.assets.upload(e,n,r)}getShapeGeometry(e,n){const r=(n==null?void 0:n.context)??"none";return this._shapeGeometryCaches[r]||(this._shapeGeometryCaches[r]=this.store.createComputedCache("bounds",i=>(this.fonts.trackFontsForShape(i),this.getShapeUtil(i).getGeometry(i,n)),{areRecordsEqual:Y3})),this._shapeGeometryCaches[r].get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>{var n,r;return(r=(n=this.getShapeUtil(e)).getHandles)==null?void 0:r.call(n,e)},{areRecordsEqual:Y3})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const n=typeof e=="string"?e:e.id,r=this.getShape(n);if(!r)throw Error("Editor.getTransform: shape not found");return xe.Identity().translate(r.x,r.y).rotate(r.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(Vi(e.parentId))return this.getShapeLocalTransform(e);const n=this._getShapePageTransformCache().get(e.parentId)??xe.Identity();return xe.Compose(n,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const n=typeof e=="string"?e:e.id,r=this.getShape(n);return!r||Vi(r.parentId)?xe.Identity():this._getShapePageTransformCache().get(r.parentId)??xe.Identity()}getShapePageTransform(e){const n=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(n)??xe.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const n=this.getShapePageTransform(e);if(!n)return;const r=this.getShapeGeometry(e);return Ee.FromPoints(n.applyToPoints(r.vertices))})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const n=this._getShapeMaskCache().get(e.id);if(!n)return;if(n.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=this._getShapePageTransformCache().get(e.id);return r?`polygon(${xe.applyToPoints(xe.Inverse(r),n).map(s=>`${s.x}px ${s.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(Vi(e.parentId))return;const n=this.getShapeAncestors(e.id).filter(i=>this.isShapeOfType(i,"frame"));return n.length===0?void 0:n.map(i=>{const s=this.getShapeGeometry(i.id);return this.getShapePageTransform(i.id).applyToPoints(s.vertices)}).reduce((i,s)=>{if(!(s&&i))return;const o=JI(i,s);return o?o.map(M.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const n=this._getShapePageBoundsCache().get(e.id);if(!n)return;const r=this._getShapeMaskCache().get(e.id);if(r){if(r.length===0)return;const{corners:i}=n;if(i.every((o,a)=>o&&M.Equals(o,r[a])))return n.clone();const s=JI(r,i);return s?Ee.FromPoints(s):void 0}return n})}getShapeAncestors(e,n=[]){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return n;const s=i.parentId;if(Vi(s))return n.reverse(),n;const o=this.store.get(s);return o?(n.push(o),this.getShapeAncestors(o,n)):n}findShapeAncestor(e,n){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return;const s=i.parentId;if(Vi(s))return;const o=this.getShape(s);if(o)return n(o)?o:this.findShapeAncestor(o,n)}hasAncestor(e,n){const r=typeof e=="string"?e:e==null?void 0:e.id,i=r&&this.getShape(r);return i?i.parentId===n?!0:this.hasAncestor(this.getShapeParent(i),n):!1}findCommonAncestor(e,n){var l;if(e.length===0)return;const r=typeof e[0]=="string"?e:e.map(c=>c.id),i=bt(r.map(c=>this.getShape(c)));if(i.length===1){const c=i[0].parentId;return Vi(c)?void 0:n?(l=this.findShapeAncestor(i[0],n))==null?void 0:l.id:c}const[s,...o]=i;let a=this.getShapeParent(s);for(;a;){if(n&&!n(a)){a=this.getShapeParent(a);continue}if(o.every(c=>this.hasAncestor(c,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){const n=e&&this.getShape(e);return n===void 0?!1:n.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(n))}getNotVisibleShapes(){return this._notVisibleShapes.get()}getCulledShapes(){const e=this.getNotVisibleShapes(),n=this.getSelectedShapeIds(),r=this.getEditingShapeId(),i=new Set(e);return r&&i.delete(r),n.forEach(s=>{i.delete(s)}),i}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(n=>{const r=this.getShapeMaskedPageBounds(n);r&&(e?e=e.expand(r):e=r.clone())}),e}getSelectedShapeAtPoint(e){const n=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(r=>r.type!=="group"&&n.includes(r.id)).reverse().find(r=>this.isPointInShape(r,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,n={}){var v;const r=this.getZoomLevel(),i=this.getViewportPageBounds(),{filter:s,margin:o=0,hitLocked:a=!1,hitLabels:l=!1,hitInside:c=!1,hitFrameInside:u=!1}=n;let d=1/0,h=null,f=1/0,y=null;const b=(n.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(x=>{if(x.isLocked&&!a||this.isShapeHidden(x)||this.isShapeOfType(x,"group"))return!1;const C=this.getShapeMask(x);return C&&!po(e,C)?!1:s?s(x):!0});for(let x=b.length-1;x>=0;x--){const C=b[x],E=this.getShapeGeometry(C),I=E instanceof yo,P=this.getPointInShapeSpace(C,e);if(this.isShapeOfType(C,"frame")||this.isShapeOfType(C,"arrow")&&C.props.text.trim()||(this.isShapeOfType(C,"note")||this.isShapeOfType(C,"geo")&&C.props.fill==="none")&&((v=this.getShapeUtil(C).getText(C))!=null&&v.trim())){for(const A of E.children)if(A.isLabel&&A.isPointInBounds(P))return C}if(this.isShapeOfType(C,"frame")){const A=E.distanceToPoint(P,c);if(Math.abs(A)<=o)return y||C;if(E.hitTestPoint(P,0,!0))return y||h||(u?C:void 0);continue}let _;if(I){let A=1/0;for(const D of E.children){if(D.isLabel&&!l)continue;const L=D.distanceToPoint(P,c);L<A&&(A=L)}_=A}else o===0&&(E.bounds.w<1||E.bounds.h<1)||E.bounds.containsPoint(P,o)?_=E.distanceToPoint(P,c):_=1/0;if(E.isClosed){if(_<=o){if(E.isFilled||I&&E.children[0].isFilled)return y||C;if(this.getShapePageBounds(C).contains(i))continue;if(Math.abs(_)<o)Math.abs(_)<f&&(f=Math.abs(_),y=C);else if(!y){const{area:A}=E;A<d&&(d=A,h=C)}}}else if(_<this.options.hitTestMargin/r)return C}return y||h||void 0}getShapesAtPoint(e,n={}){return this.getCurrentPageShapesSorted().filter(r=>!this.isShapeHidden(r)&&this.isPointInShape(r,e,n)).reverse()}isPointInShape(e,n,r={}){const{hitInside:i=!1,margin:s=0}=r,o=typeof e=="string"?e:e.id,a=this.getShapeMask(o);return a&&!po(n,a)?!1:this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(e,n),s,i)}getPointInShapeSpace(e,n){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r).clone().invert().applyToPoint(n)}getPointInParentSpace(e,n){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return new M(0,0);if(Vi(i.parentId))return M.From(n);const s=this.getShapePageTransform(i.parentId);return s?s.clone().invert().applyToPoint(n):M.From(n)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],n=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let r=0,i=n.length;r<i;r++)dme(this,n[r],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:n})=>!e.has(n)&&!this.isShapeHidden(n))}isShapeOfType(e,n){const r=typeof e=="string"?this.getShape(e):e;return r?r.type===n:!1}getShape(e){const n=typeof e=="string"?e:e.id;if(io(n))return this.store.get(n)}getShapeParent(e){const n=typeof e=="string"?e:e==null?void 0:e.id;if(!n)return;const r=this.getShape(n);if(!(r===void 0||!io(r.parentId)))return this.getShape(r.parentId)}getShapeNearestSibling(e,n){return n?n.parentId===e.parentId?n:this.findShapeAncestor(n,i=>i.parentId===e.parentId):void 0}isShapeInPage(e,n=this.getCurrentPageId()){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return!1;let s=!1;if(i.parentId===n)s=!0;else{let o=this.getShape(i.parentId);e:for(;o;){if(o.parentId===n){s=!0;break e}o=this.getShape(o.parentId)}}return s}getAncestorPageId(e){const n=typeof e=="string"?e:e==null?void 0:e.id,r=n&&this.getShape(n);if(r)return Vi(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}reparentShapes(e,n,r){const i=typeof e[0]=="string"?e:e.map(h=>h.id);if(i.length===0)return this;const s=[],o=Vi(n)?xe.Identity():this.getShapePageTransform(n),a=o.rotation();let l=[];const c=bt(this.getSortedChildIdsForParent(n).map(h=>this.getShape(h)));if(r){const h=c.find(f=>f.index===r);if(h){const f=c[c.indexOf(h)+1];f?l=$y(r,f.index,i.length):l=bR(r,i.length)}else{const f=c.sort(Xi).find(y=>y.index>r);f?l=$y(r,f.index,i.length):l=bR(r,i.length)}}else{const h=c.length&&c[c.length-1];l=h?bR(h.index,i.length):sw(i.length)}const u=o.clone().invert(),d=bt(i.map(h=>this.getShape(h))).sort(Xi);return this.run(()=>{for(let h=0;h<d.length;h++){const f=d[h],y=this.getShapePageTransform(f);if(!y)continue;const b=y.point();if(!b)continue;const v=u.applyToPoint(b),x=y.rotation()-a;if(f.id===n)throw Error("Attempted to reparent a shape to itself!");s.push({id:f.id,type:f.type,parentId:n,x:v.x,y:v.y,rotation:x,index:l[h]})}this.updateShapes(s)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const n=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[n];if(!r||r.length===0)return"a1";const i=this.getShape(r[r.length-1]);return ac(i.index)}getSortedChildIdsForParent(e){const n=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[n];return r||Mr}visitDescendants(e,n){const r=this.getSortedChildIdsForParent(e);for(const i of r)n(i)!==!1&&this.visitDescendants(i,n);return this}getShapeAndDescendantIds(e){const n=new Set;for(const r of e.map(i=>this.getShape(i)).sort(Xi))n.add(r.id),this.visitDescendants(r,i=>{n.add(i)});return n}getDroppingOverShape(e,n){return this.getDraggingOverShape(e,n)}getDraggingOverShape(e,n){const r=bt(n.map(s=>this.getShape(s))).filter(s=>!s.isLocked&&!this.isShapeHidden(s)),i=this.getShapesAtPoint(e,{hitInside:!0,margin:0}).filter(s=>!n.includes(s)&&!s.isLocked&&!this.isShapeHidden(s)&&!r.includes(s));for(const s of i){const o=this.getShapeUtil(s);if(o.onDragShapesOver||o.onDragShapesIn||o.onDragShapesOut||o.onDropShapesOver)return s}}getOutermostSelectableShape(e,n){const r=typeof e=="string"?e:e.id,i=this.getShape(r);let s=i,o=i;const a=this.getFocusedGroup();for(;o;){if(this.isShapeOfType(o,"group")&&(a==null?void 0:a.id)!==o.id&&!this.hasAncestor(a,o.id)&&((n==null?void 0:n(o))??!0))s=o;else if((a==null?void 0:a.id)===o.id)break;o=this.getShapeParent(o)}return s}_getBindingsIndexCache(){const e=WXe(this);return this.store.createComputedCache("bindingsIndex",n=>e.get().get(n.id),{areRecordsEqual:()=>!0})}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,n){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.fromId===r&&i.type===n)}getBindingsToShape(e,n){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.toId===r&&i.type===n)}getBindingsInvolvingShape(e,n){const r=typeof e=="string"?e:e.id,i=this._getBindingsIndexCache().get(r)??Mr;return n?i.filter(s=>s.type===n):i}createBindings(e){const n=[];for(const r of e){const i=this.getShape(r.fromId),s=this.getShape(r.toId);if(!i||!s||!this.canBindShapes({fromShape:i,toShape:s,binding:r}))continue;const a=this.getBindingUtil(r.type).getDefaultProps(),l=this.store.schema.types.binding.create({...r,id:r.id??Vp(),props:{...a,...r.props}});n.push(l)}return this.store.put(n),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const n=[];for(const r of e){if(!r)continue;const i=this.getBinding(r.id);if(!i)continue;const s=Wc(i,r);if(s===i)continue;const o=this.getShape(s.fromId),a=this.getShape(s.toId);!o||!a||this.canBindShapes({fromShape:o,toShape:a,binding:s})&&n.push(s)}return this.store.put(n),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:n=!1}={}){const r=e.map(i=>typeof i=="string"?i:i.id);return n?this.store.atomic(()=>{var i,s;for(const o of r){const a=this.getBinding(o);if(!a)continue;const l=this.getBindingUtil(a);(i=l.onBeforeIsolateFromShape)==null||i.call(l,{binding:a,removedShape:this.getShape(a.toId)}),(s=l.onBeforeIsolateToShape)==null||s.call(l,{binding:a,removedShape:this.getShape(a.fromId)}),this.store.remove([o])}}):this.store.remove(r),this}deleteBinding(e,n){return this.deleteBindings([e],n)}canBindShapes({fromShape:e,toShape:n,binding:r}){const i=typeof e=="string"?e:e.type,s=typeof n=="string"?n:n.type,o=typeof r=="string"?r:r.type,a={fromShapeType:i,toShapeType:s,bindingType:o};return i===s?this.getShapeUtil(i).canBind(a):this.getShapeUtil(i).canBind(a)&&this.getShapeUtil(s).canBind(a)}rotateShapesBy(e,n,r){const i=typeof e[0]=="string"?e:e.map(o=>o.id);if(i.length<=0)return this;const s=jfe({editor:this,ids:i});return s?(GE({delta:n,snapshot:s,editor:this,stage:"one-off",centerOverride:r==null?void 0:r.center}),this):this}getChangesToTranslateShape(e,n){var l,c,u;let r=e;const i=this.getShapeUtil(e),s=(l=i.onTranslateStart)==null?void 0:l.call(i,r);s&&(r=Wc(r,s)),r=Wc(r,{id:e.id,type:e.type,x:n.x,y:n.y});const o=(c=i.onTranslate)==null?void 0:c.call(i,e,r);o&&(r=Wc(r,o));const a=(u=i.onTranslateEnd)==null?void 0:u.call(i,e,r);return a&&(r=Wc(r,a)),r}nudgeShapes(e,n){const r=typeof e[0]=="string"?e:e.map(s=>s.id);if(r.length<=0)return this;const i=[];for(const s of r){const o=this.getShape(s),a=M.From(n),l=this.getShapeParentTransform(o);l&&a.rot(-l.rotation()),i.push(this.getChangesToTranslateShape(o,a.add(o)))}return this.updateShapes(i),this}duplicateShapes(e,n){return this.run(()=>{const r=typeof e[0]=="string"?e:e.map(h=>h.id),i=this._shouldIgnoreShapeLock?r:this._getUnlockedShapeIds(r);if(i.length<=0)return this;const s=new Set(i),o=this.getShapeAndDescendantIds(i),a=[...o].reverse(),l=new Map;for(const h of o)l.set(h,Sn());const{shapesToCreateWithOriginals:c,bindingsToCreate:u}=iQ(this,o,h=>{const f=[];for(const b of h){const v=this.getBinding(b);if(!v)continue;const x=Vp();f.push({...v,id:x,fromId:Ps(l.get(v.fromId)),toId:Ps(l.get(v.toId))})}const y=[];for(const b of a){const v=Ps(l.get(b)),x=this.getShape(b);if(!x)continue;let C=0,E=0;if(n&&s.has(b)){const I=this.getShapeParentTransform(x),P=new M(n.x,n.y).rot(-I.rotation());C=P.x,E=P.y}y.push({shape:{...x,id:v,x:x.x+C,y:x.y+E,index:"a1",parentId:l.get(x.parentId)??x.parentId},originalShape:x})}return{shapesToCreateWithOriginals:y,bindingsToCreate:f}});c.forEach(({shape:h,originalShape:f})=>{const y=f.parentId,b=this.getSortedChildIdsForParent(y),v=b.indexOf(f.id),x=b[v+1],C=x?this.getShape(x):void 0,E=By(f.index,C==null?void 0:C.index);h.index=E});const d=c.map(({shape:h})=>h);if(!this.canCreateShapes(d)){HC(this);return}if(this.createShapes(d),this.createBindings(u),this.setSelectedShapes(bt(i.map(h=>l.get(h)))),n!==void 0){const h=this.getSelectionPageBounds(),f=this.getViewportPageBounds();h&&!f.contains(h)&&this.centerOnPoint(h.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,n){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(r.length===0)return this;if(this.getIsReadonly())return this;const i=this.getCurrentPageId();if(n===i)return this;if(!this.store.has(n))return this;const s=this.getContentFromCurrentPage(r);if(!s)return this;if(this.getPageShapeIds(n).size+s.shapes.length>this.options.maxShapesPerPage)return HC(this,n),this;const o=this.getCamera().z;return this.run(()=>{this.deleteShapes(r),this.setCurrentPage(n),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:o}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const n=typeof e[0]=="string"?e:e.map(o=>o.id);if(this.getIsReadonly()||n.length===0)return this;let r=!0,i=!0;const s=[];for(const o of n){const a=this.getShape(o);a&&(s.push(a),a.isLocked?i=!1:r=!1)}return this.run(()=>{i?(this.updateShapes(s.map(o=>({id:o.id,type:o.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(s.map(o=>({id:o.id,type:o.type,isLocked:!1}))):this.updateShapes(s.map(o=>({id:o.id,type:o.type,isLocked:!0})))}),this}sendToBack(e){const n=typeof e[0]=="string"?e:e.map(i=>i.id),r=zC(this,"toBack",n,{considerAllShapes:!0});return r&&this.updateShapes(r),this}sendBackward(e,n={}){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=zC(this,"backward",r,n);return i&&this.updateShapes(i),this}bringForward(e,n={}){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=zC(this,"forward",r,n);return i&&this.updateShapes(i),this}bringToFront(e){const n=typeof e[0]=="string"?e:e.map(i=>i.id),r=zC(this,"toFront",n);return r&&this.updateShapes(r),this}collectShapesViaArrowBindings(e){const{initialShapes:n,resultShapes:r,resultBounds:i,bindings:s,visited:o}=e;for(const a of s)for(const l of[a.fromId,a.toId])if(!o.has(l)){const c=n.find(u=>u.id===l);if(c&&!o.has(c.id)){o.add(c.id);const u=this.getShapePageBounds(c);if(!u)continue;r.push(c),i.push(u),this.collectShapesViaArrowBindings({...e,bindings:this.getBindingsInvolvingShape(c,"arrow")})}}}flipShapes(e,n){if(this.getIsReadonly())return this;const r=typeof e[0]=="string"?e:e.map(l=>l.id),i=bt(r.map(l=>this.getShape(l)));for(const l of i)if(this.isShapeOfType(l,"group")){const c=bt(this.getSortedChildIdsForParent(l.id).map(u=>this.getShape(u)));i.push(...c)}const s=[],o=[];for(const l of i){const c=this.getShapeUtil(l);if(!c.canBeLaidOut(l,{type:"flip",shapes:i}))continue;const u=this.getShapePageBounds(l),d=this.getShapeGeometry(l).bounds,h=this.getShapePageTransform(l.id);u&&d&&h&&(s.push({shape:l,localBounds:d,pageTransform:h,isAspectRatioLocked:c.isAspectRatioLocked(l)}),o.push(u))}if(!s.length)return this;const a=Ee.Common(o).center;return this.run(()=>{for(const{shape:l,localBounds:c,pageTransform:u,isAspectRatioLocked:d}of s)this.resizeShape(l.id,{x:n==="horizontal"?-1:1,y:n==="vertical"?-1:1},{initialBounds:c,initialPageTransform:u,initialShape:l,isAspectRatioLocked:d,mode:"scale_shape",scaleOrigin:a,scaleAxisRotation:0})}),this}stackShapes(e,n,r){var x,C;const i=r??this.options.adjacentShapeMargin,s=typeof e[0]=="string"?e:e.map(E=>E.id);if(this.getIsReadonly())return this;const o=bt(s.map(E=>this.getShape(E))),a=[],l=new Set;for(const E of o){if(l.has(E.id))continue;l.add(E.id);const I=this.getShapePageBounds(E);if(!I||!((C=(x=this.getShapeUtil(E)).canBeLaidOut)!=null&&C.call(x,E,{type:"stack",shapes:o})))continue;const P=[E],_=[I];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(E.id,"arrow"),initialShapes:o,resultShapes:P,resultBounds:_,visited:l});const A=Ee.Common(_);A&&a.push({shapes:P,pageBounds:A})}const c=a.length;if(i===0&&c<3||c<2)return this;let u,d,h,f;n==="horizontal"?(u="x",d="minX",h="maxX",f="width"):(u="y",d="minY",h="maxY",f="height");let y=0;if(i===0){const E={};a.sort((P,_)=>P.pageBounds[d]-_.pageBounds[d]);for(let P=0;P<c-1;P++){const _=a[P],D=a[P+1].pageBounds[d]-_.pageBounds[h];E[D]||(E[D]=0),E[D]++}let I=1;for(const[P,_]of Object.entries(E))_>I&&(I=_,y=parseFloat(P));if(I===1){let P=0;for(const[_,A]of Object.entries(E))y+=parseFloat(_)*A,P+=A;y/=P}}else y=i;const b=[];let v=a[0].pageBounds[h];for(let E=1;E<a.length;E++){const{shapes:I,pageBounds:P}=a[E],_=new M;_[u]=v+y-P[u];for(const A of I){const D=_.clone(),L=this.getShapeParent(A);if(L){const z=this.getShapePageTransform(L);z&&D.rot(-z.rotation())}D.add(A),b.push(this.getChangesToTranslateShape(A,D))}v+=P[f]+y}return this.updateShapes(b),this}packShapes(e,n){var P,_;if(this.getIsReadonly())return this;const r=n??this.options.adjacentShapeMargin,i=typeof e[0]=="string"?e:e.map(A=>A.id),s=bt(i.map(A=>this.getShape(A))),o=[],a=[],l=new Set;for(const A of s){if(l.has(A.id))continue;l.add(A.id);const D=this.getShapePageBounds(A);if(!D||!((_=(P=this.getShapeUtil(A)).canBeLaidOut)!=null&&_.call(P,A,{type:"pack",shapes:s})))continue;const L=[A],z=[D];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(A.id,"arrow"),initialShapes:s,resultShapes:L,resultBounds:z,visited:l});const $=Ee.Common(z);$&&(o.push({shapes:L,pageBounds:$,nextPageBounds:$.clone()}),a.push($))}if(o.length<2)return this;let c=0;for(const{pageBounds:A}of o)c+=A.width*A.height;const u=Ee.Common(a),d=u.width;o.sort((A,D)=>A.pageBounds.width-D.pageBounds.width).sort((A,D)=>A.pageBounds.height-D.pageBounds.height);const h=Math.max(Math.ceil(Math.sqrt(c/.95)),d),f=[new Ee(u.x,u.y,h,1/0)];let y=0,b=0,v,x;for(const{nextPageBounds:A}of o)for(let D=f.length-1;D>=0;D--)if(v=f[D],!(A.width>v.width||A.height>v.height)){A.x=v.x,A.y=v.y,b=Math.max(b,A.maxY),y=Math.max(y,A.maxX),A.width===v.width&&A.height===v.height?(x=f.pop(),D<f.length&&(f[D]=x)):A.height===v.height?(v.x+=A.width+r,v.width-=A.width+r):A.width===v.width?(v.y+=A.height+r,v.height-=A.height+r):(f.push(new Ee(v.x+(A.width+r),v.y,v.width-(A.width+r),A.height)),v.y+=A.height+r,v.height-=A.height+r);break}const C=Ee.Common(o.map(A=>A.nextPageBounds)),E=M.Sub(u.center,C.center),I=[];for(const{shapes:A,pageBounds:D,nextPageBounds:L}of o){const z=M.Sub(L.point,D.point).add(E);for(const $ of A){const H=z.clone();if(this.getShapeParent($)){const j=this.getShapeParentTransform($);j&&H.rot(-j.rotation())}H.add($),I.push(this.getChangesToTranslateShape($,H))}}return I.length&&this.updateShapes(I),this}alignShapes(e,n){var u,d;if(this.getIsReadonly())return this;const r=typeof e[0]=="string"?e:e.map(h=>h.id),i=bt(r.map(h=>this.getShape(h))),s=[],o=[],a=new Set;for(const h of i){if(a.has(h.id))continue;a.add(h.id);const f=this.getShapePageBounds(h);if(!f||!((d=(u=this.getShapeUtil(h)).canBeLaidOut)!=null&&d.call(u,h,{type:"align",shapes:i})))continue;const y=[h],b=[f];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(h.id,"arrow"),initialShapes:i,resultShapes:y,resultBounds:b,visited:a});const v=Ee.Common(b);v&&(s.push({shapes:y,pageBounds:v}),o.push(v))}if(s.length<2)return this;const l=Ee.Common(o),c=[];return s.forEach(({shapes:h,pageBounds:f})=>{const y=new M;switch(n){case"top":{y.y=l.minY-f.minY;break}case"center-vertical":{y.y=l.midY-f.minY-f.height/2;break}case"bottom":{y.y=l.maxY-f.minY-f.height;break}case"left":{y.x=l.minX-f.minX;break}case"center-horizontal":{y.x=l.midX-f.minX-f.width/2;break}case"right":{y.x=l.maxX-f.minX-f.width;break}}for(const b of h){const v=y.clone(),x=this.getShapeParent(b);if(x){const C=this.getShapePageTransform(x);C&&v.rot(-C.rotation())}v.add(b),c.push(this.getChangesToTranslateShape(b,v))}}),this.updateShapes(c),this}distributeShapes(e,n){var E,I;if(this.getIsReadonly())return this;const r=typeof e[0]=="string"?e:e.map(P=>P.id),i=bt(r.map(P=>this.getShape(P))),s=[],o=new Set;for(const P of i){if(o.has(P.id))continue;o.add(P.id);const _=this.getShapePageBounds(P);if(!_||!((I=(E=this.getShapeUtil(P)).canBeLaidOut)!=null&&I.call(E,P,{type:"distribute",shapes:i})))continue;const A=[P],D=[_];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(P.id,"arrow"),initialShapes:i,resultShapes:A,resultBounds:D,visited:o});const L=Ee.Common(D);L&&s.push({shapes:A,pageBounds:L})}if(s.length<3)return this;let a,l,c,u;n==="horizontal"?(a="x",l="minX",c="maxX",u="width"):(a="y",l="minY",c="maxY",u="height");const d=[],h=s.sort((P,_)=>P.pageBounds[l]-_.pageBounds[l])[0],f=s.sort((P,_)=>_.pageBounds[c]-P.pageBounds[c])[0];if(h===f){const P=new Set(h.shapes.map(_=>_.id));return this.distributeShapes(r.filter(_=>!P.has(_)),n)}const y=s.filter(P=>P!==h&&P!==f).sort((P,_)=>P.pageBounds[l]===_.pageBounds[l]?P.shapes[0].id<_.shapes[0].id?-1:1:P.pageBounds[l]-_.pageBounds[l]),b=h.pageBounds[c],v=f.pageBounds[l]-b,x=y.reduce((P,_)=>P+_.pageBounds[u],0),C=(v-x)/(y.length+1);for(let P=b+C,_=0;_<y.length;_++){const{shapes:A,pageBounds:D}=y[_],L=new M;L[a]=P-D[a],P+D[u]>f.pageBounds[c]-1&&(L[a]=f.pageBounds[c]-D[c]-1);for(const z of A){const $=L.clone(),H=this.getShapeParent(z);if(H){const R=this.getShapePageTransform(H);R&&$.rot(-R.rotation())}$.add(z),d.push(this.getChangesToTranslateShape(z,$))}P+=D[u]+C}return this.updateShapes(d),this}stretchShapes(e,n){var h,f;const r=typeof e[0]=="string"?e:e.map(y=>y.id);if(this.getIsReadonly())return this;const i=bt(r.map(y=>this.getShape(y))).filter(y=>{var b;return((b=this.getShapePageTransform(y))==null?void 0:b.rotation())%(un/2)===0}),s=[],o=[],a=new Set;for(const y of i){if(a.has(y.id))continue;a.add(y.id);const b=this.getShapePageBounds(y);if(!b)continue;const v=[y],x=[b];if(!((f=(h=this.getShapeUtil(y)).canBeLaidOut)!=null&&f.call(h,y,{type:"stretch",shapes:i})))continue;this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(y.id,"arrow"),initialShapes:i,resultShapes:v,resultBounds:x,visited:a});const C=Ee.Common(x);C&&(s.push({shapes:v,pageBounds:C}),o.push(C))}if(s.length<2)return this;const l=Ee.Common(o);let c,u,d;return n==="horizontal"?(c="x",u="minX",d="width"):(c="y",u="minY",d="height"),this.run(()=>{s.forEach(({shapes:y,pageBounds:b})=>{const v=new M;v[c]=l[u]-b[u];const x=b.center.clone();x[c]=l[u];const C=new M(1,1);C[c]=l[d]/b[d];for(const E of y){const I=v.clone(),P=this.getShapeParentTransform(E);P&&v.rot(-P.rotation()),I.add(E);const _=this.getChangesToTranslateShape(E,I);this.updateShape(_),this.resizeShape(E.id,C,{initialBounds:this.getShapeGeometry(E).bounds,scaleOrigin:x,isAspectRatioLocked:this.getShapeUtil(E).isAspectRatioLocked(E),scaleAxisRotation:0})}})}),this}resizeShape(e,n,r={}){var y,b,v;const i=typeof e=="string"?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(n.x)||(n=new M(1,n.y)),Number.isFinite(n.y)||(n=new M(n.x,1));const s=r.initialShape??this.getShape(i);if(!s)return this;const o=r.scaleOrigin??((y=this.getShapePageBounds(i))==null?void 0:y.center);if(!o)return this;const a=r.initialPageTransform?xe.Cast(r.initialPageTransform):this.getShapePageTransform(i);if(!a)return this;const l=a.rotation();if(l==null)return this;const c=r.scaleAxisRotation??l,u=r.initialBounds??this.getShapeGeometry(i).bounds;if(!u)return this;const d=r.isAspectRatioLocked??this.getShapeUtil(s).isAspectRatioLocked(s);if(!Nhe(l,c))return this._resizeUnalignedShape(i,n,{...r,initialBounds:u,scaleOrigin:o,scaleAxisRotation:c,initialPageTransform:a,isAspectRatioLocked:d,initialShape:s});const h=this.getShapeUtil(s);d&&(Math.abs(n.x)>Math.abs(n.y)?n=new M(n.x,Math.sign(n.y)*Math.abs(n.x)):n=new M(Math.sign(n.x)*Math.abs(n.y),n.y));let f=!1;if(h.onResize&&h.canResize(s)){const x=this._scalePagePoint(xe.applyToPoint(a,new M(0,0)),o,n,c),C=this.getPointInParentSpace(s.id,x),E=new M(n.x,n.y),I=Nr((l-c)%Math.PI,0);E.x=I?n.x:n.y,E.y=I?n.y:n.x;const P=xe.applyToPoint(a,new M),{x:_,y:A}=this.getPointInParentSpace(s.id,P);let D=s;r.skipStartAndEndCallbacks||(D=Wc(s,((b=h.onResizeStart)==null?void 0:b.call(h,s))??void 0));const L=h.onResize({...s,x:_,y:A},{newPoint:C,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:E.x,scaleY:E.y,initialBounds:u,initialShape:s});L&&(f=!0),D=Wc(D,{id:i,type:s.type,x:C.x,y:C.y,...L}),r.skipStartAndEndCallbacks||(D=Wc(D,((v=h.onResizeEnd)==null?void 0:v.call(h,s,D))??void 0)),this.updateShapes([D])}if(!f){const x=xe.applyToPoint(a,u.center),C=this._scalePagePoint(x,o,n,c),E=this.getPointInParentSpace(s.id,x),I=this.getPointInParentSpace(s.id,C),P=M.Sub(I,E);this.updateShapes([{id:i,type:s.type,x:s.x+P.x,y:s.y+P.y}])}return this}_scalePagePoint(e,n,r,i){const s=M.RotWith(e,n,-i).sub(n),o=M.MulV(s,r);return M.Add(o,n).rotWith(n,i)}_resizeUnalignedShape(e,n,r){const{type:i}=r.initialShape,s=new M(n.x,n.y);if(Math.abs(n.x)>Math.abs(n.y)?s.x=Math.sign(n.x)*Math.abs(n.y):s.y=Math.sign(n.y)*Math.abs(n.x),this.resizeShape(e,s,{initialShape:r.initialShape,initialBounds:r.initialBounds,isAspectRatioLocked:r.isAspectRatioLocked}),Math.sign(n.x)*Math.sign(n.y)<0){let{rotation:v}=xe.Decompose(r.initialPageTransform);v-=2*v,this.updateShapes([{id:e,type:i,rotation:v}])}const o=xe.applyToPoint(r.initialPageTransform,r.initialBounds.center),a=this._scalePagePoint(o,r.scaleOrigin,n,r.scaleAxisRotation),l=this.getShapePageBounds(e),c=this.getShapePageTransform(e),u=l.center,d=c.point();if(!u||!d)return this;const h=M.Sub(a,u),f=M.Add(d,h),{x:y,y:b}=this.getPointInParentSpace(e,f);return this.updateShapes([{id:e,type:i,x:y,y:b}]),this}getInitialMetaForShape(e){return{}}canCreateShape(e){return this.canCreateShapes([e])}canCreateShapes(e){return e.length+this.getCurrentPageShapeIds().size<=this.options.maxShapesPerPage}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const n=this.getCurrentPageShapeIds();if(e.length+n.size>this.options.maxShapesPerPage)return HC(this),this;const i=this.getFocusedGroupId();return this.run(()=>{var u,d;const s=this.getCurrentPageShapesSorted(),o=e.map(h=>{if(h.id||(h={id:Sn(),...h}),!h.parentId||!(this.store.has(h.parentId)||e.some(f=>f.id===h.parentId))){let f=this.getFocusedGroupId();for(let b=s.length-1;b>=0;b--){const v=s[b];if(this.getShapeUtil(v).canReceiveNewChildrenOfType(v,h.type)&&!this.isShapeHidden(v)&&this.isPointInShape(v,{x:h.x??0,y:h.y??0},{margin:0,hitInside:!0})){f=v.id;break}}const y=h.parentId;if(f===h.id&&(f=i),f!==y&&(h={...h},h.parentId=f,io(f))){const b=this.getPointInShapeSpace(this.getShape(f),{x:h.x??0,y:h.y??0});h.x=b.x,h.y=b.y,h.rotation=-this.getShapePageTransform(f).rotation()+(h.rotation??0)}}return h}),a=new Map,l=[],{opacityForNextShape:c}=this.getInstanceState();for(const h of o){const f=this.getShapeUtil(h);let y=h.index;if(!y){const C=h.parentId??i;a.has(C)||a.set(C,this.getHighestIndexForParent(C)),y=a.get(C),a.set(C,ac(y))}const b=f.getDefaultProps();for(const[C,E]of this.styleProps[h.type])b[E]=this.getStyleForNextShape(C);let v=this.store.schema.types.shape.create({...h,index:y,opacity:h.opacity??c,parentId:h.parentId??i,props:"props"in h?{...b,...h.props}:b});if(v.index===void 0)throw Error("no index!");const x=(d=(u=this.getShapeUtil(v)).onBeforeCreate)==null?void 0:d.call(u,v);x&&(v=x),l.push(v)}l.forEach(h=>{h.meta={...this.getInitialMetaForShape(h),...h.meta}}),this.emit("created-shapes",l),this.emit("edit"),this.store.put(l)}),this}animateShape(e,n={animation:_j}){return this.animateShapes([e],n)}animateShapes(e,n={animation:_j}){if(!n.animation)return this;const{duration:r=500,easing:i=Ms.linear}=n.animation,s=fn();let o=r,a;const l=[];let c,u;for(let h=0,f=e.length;h<f;h++){if(c=e[h],!c)continue;const y=this.getShape(c.id);y&&(u={start:ar(y),end:Wc(ar(y),c)},l.push(u),this.animatingShapes.set(y.id,s))}const d=h=>{var v,x;if(o-=h,o<0){const{animatingShapes:C}=this,E=e.filter(I=>I&&C.get(I.id)===s);E.length&&this.updateShapes(E),this.off("tick",d);return}a=i(1-o/r);const{animatingShapes:f}=this,y=[];let b;for(let C=0,E=l.length;C<E;C++){const{start:I,end:P}=l[C];b=f.get(I.id),b===s&&y.push({...P,x:I.x+(P.x-I.x)*a,y:I.y+(P.y-I.y)*a,opacity:I.opacity+(P.opacity-I.opacity)*a,rotation:I.rotation+(P.rotation-I.rotation)*a,props:((x=(v=this.getShapeUtil(P)).getInterpolatedProps)==null?void 0:x.call(v,I,P,a))??P.props})}this._updateShapes(y)};return this.on("tick",d),this}groupShapes(e,n={}){var y;const{groupId:r=Sn(),select:i=!0}=n;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const s=typeof e[0]=="string"?e:e.map(b=>b.id);if(s.length<=1)return this;const o=bt((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(b=>this.getShape(b))),a=o.sort(Xi).map(b=>b.id),l=Ee.Common(bt(o.map(b=>this.getShapePageBounds(b)))),{x:c,y:u}=l.point,d=this.findCommonAncestor(o)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const h=o.filter(b=>b.parentId===d).sort(Xi),f=(y=h[h.length-1])==null?void 0:y.index;return this.run(()=>{this.createShapes([{id:r,type:"group",parentId:d,index:f,x:c,y:u,opacity:1,props:{}}]),this.reparentShapes(a,r),i&&this.select(r)}),this}ungroupShapes(e,n={}){if(this.getIsReadonly())return this;const{select:r=!0}=n,i=typeof e[0]=="string"?e:e.map(l=>l.id),s=bt((this._shouldIgnoreShapeLock?i:this._getUnlockedShapeIds(i)).map(l=>this.getShape(l)));if(s.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const o=new Set,a=[];return s.forEach(l=>{this.isShapeOfType(l,"group")?a.push(l):o.add(l.id)}),a.length===0?this:(this.run(()=>{let l;for(let c=0,u=a.length;c<u;c++){l=a[c];const d=this.getSortedChildIdsForParent(l.id);for(let h=0,f=d.length;h<f;h++)o.add(d[h]);this.reparentShapes(d,l.parentId,l.index)}this.deleteShapes(a.map(c=>c.id)),r&&this.select(...o)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const n=Array(e.length);for(let r=0,i=e.length;r<i;r++){const s=e[r];if(!s)continue;const o=this.getShape(s.id);if(o){if(!this._shouldIgnoreShapeLock){if(o.isLocked){if(!(Object.hasOwn(s,"isLocked")&&!s.isLocked))continue}else if(this.isShapeOrAncestorLocked(o))continue}this.animatingShapes.delete(s.id),n.push(s)}}return this._updateShapes(n),this}_updateShapes(e){this.getIsReadonly()||this.run(()=>{var s,o;const n=[];let r,i;for(let a=0,l=e.length;a<l;a++){const c=e[a];c&&(r=this.getShape(c.id),r&&(i=Wc(r,c),i!==r&&(i=((o=(s=this.getShapeUtil(r)).onBeforeUpdate)==null?void 0:o.call(s,r,i))??i,n.push(i))))}this.emit("edited-shapes",n),this.emit("edit"),this.store.put(n)})}_getUnlockedShapeIds(e){return e.filter(n=>{var r;return!((r=this.getShape(n))!=null&&r.isLocked)})}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const n=typeof e[0]=="string"?e:e.map(s=>s.id),r=this._shouldIgnoreShapeLock?n:this._getUnlockedShapeIds(n);if(r.length===0)return this;const i=new Set(r);for(const s of r)this.visitDescendants(s,o=>{i.add(o)});return this.emit("deleted-shapes",[...i]),this.emit("edit"),this.run(()=>this.store.remove([...i]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,n){if(this.isShapeOfType(e,"group")){const r=this._parentIdsToChildIds.get()[e.id];if(!r)return;for(let i=0,s=r.length;i<s;i++)this._extractSharedStyles(this.getShape(r[i]),n)}else for(const[r,i]of this.styleProps[e.type])n.applyValue(r,Ar(e.props,i))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),n=new J3;for(const r of e)this._extractSharedStyles(r,n);return n}getStyleForNextShape(e){const n=this.getInstanceState().stylesForNextShape[e.id];return n===void 0?e.defaultValue:n}getShapeStyleIfExists(e,n){const r=this.styleProps[e.type].get(n);if(r!==void 0)return Ar(e.props,r)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),n=new J3;if(!e)return n;if(e.shapeType)if(e.shapeType==="frame"&&!this.getShapeUtil("frame").options.showColors)for(const r of this.styleProps[e.shapeType].keys())r.id!=="tldraw:color"&&n.applyValue(r,this.getStyleForNextShape(r));else for(const r of this.styleProps[e.shapeType].keys())n.applyValue(r,this.getStyleForNextShape(r));return n}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],n=i=>{const s=this.getShape(i);if(s)if(this.isShapeOfType(s,"group"))for(const o of this.getSortedChildIdsForParent(s.id))n(o);else e.push(s)};for(const i of this.getSelectedShapeIds())n(i);let r=null;for(const i of e)if(r===null)r=i.opacity;else if(r!==i.opacity)return{type:"mixed"};if(r!==null)return{type:"shared",value:r}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,n){return this.updateInstanceState({opacityForNextShape:e},n),this}setOpacityForSelectedShapes(e){const n=this.getSelectedShapes();if(n.length>0){const r=[],i=s=>{if(this.isShapeOfType(s,"group")){const o=this.getSortedChildIdsForParent(s);for(const a of o)i(this.getShape(a))}else r.push(s)};for(const s of n)i(s);this.updateShapes(r.map(s=>({id:s.id,type:s.type,opacity:e})))}return this}setStyleForNextShapes(e,n,r){const i=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...i,[e.id]:n}},r),this}setStyleForSelectedShapes(e,n){const r=this.getSelectedShapes();if(r.length>0){const i=[],s=o=>{if(this.isShapeOfType(o,"group")){const a=this.getSortedChildIdsForParent(o.id);for(const l of a)s(this.getShape(l))}else{const a=this.getShapeUtil(o),l=this.styleProps[o.type].get(e);if(l){const c={id:o.id,type:o.type,props:{[l]:n}};i.push({util:a,originalShape:o,updatePartial:c})}}};for(const o of r)s(o);this.updateShapes(i.map(({updatePartial:o})=>o))}return this}registerExternalAssetHandler(e,n){return this.externalAssetContentHandlers[e]=n,this}createTemporaryAssetPreview(e,n){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const r=URL.createObjectURL(n);return this.temporaryAssetPreview.set(e,r),setTimeout(()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(r)},this.options.temporaryAssetPreviewLifetimeMs),r}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){var n,r;return await((r=(n=this.externalAssetContentHandlers)[e.type])==null?void 0:r.call(n,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,n){return this.externalContentHandlers[e]=n,this}async putExternalContent(e){var n,r;return(r=(n=this.externalContentHandlers)[e.type])==null?void 0:r.call(n,e)}async replaceExternalContent(e){var n,r;return(r=(n=this.externalContentHandlers)[e.type])==null?void 0:r.call(n,e)}getContentFromCurrentPage(e){const n=typeof e[0]=="string"?e:e.map(i=>i.id);if(!n||n.length===0)return;const r=this.getShapeAndDescendantIds(n);return iQ(this,r,i=>{const s=[];for(const u of i){const d=this.getBinding(u);d&&s.push(d)}const o=[],a=[];for(const u of r){const d=this.getShape(u);if(!d)continue;if(!r.has(d.parentId)){const f=this.getShapePageTransform(d.id),y=f.point();a.push({...d,x:y.x,y:y.y,rotation:f.rotation(),parentId:this.getCurrentPageId()}),o.push(d.id)}else a.push(d)}const l=[],c=new Set;for(const u of a){if(!("assetId"in u.props))continue;const d=u.props.assetId;if(!d||c.has(d))continue;c.add(d);const h=this.getAsset(d);h&&l.push(h)}return{schema:this.store.schema.serialize(),shapes:a,rootShapeIds:o,bindings:s,assets:l}})}async resolveAssetsInContent(e){if(!e)return;const n=[];return await Promise.allSettled(e.assets.map(async r=>{var i,s,o;if((r.type==="image"||r.type==="video")&&!((i=r.props.src)!=null&&i.startsWith("data:image"))&&!((s=r.props.src)!=null&&s.startsWith("data:video"))&&!((o=r.props.src)!=null&&o.startsWith("http"))){const a=ar(r),l=await this.store.props.assets.resolve(r,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});a.props.src=await co.blobToDataUrl(await hc(l).then(c=>c.blob())),n.push(a)}else n.push(r)})),e.assets=n,e}putContentOntoCurrentPage(e,n={}){var z,$,H;if(this.getIsReadonly())return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:r=!1,preserveIds:i=!1,preservePosition:s=!1}=n;let{point:o=void 0}=n;const a=this.getCurrentPageId(),{rootShapeIds:l}=e,c=[],u=[],d=[],h={store:{...Object.fromEntries(e.assets.map(R=>[R.id,R])),...Object.fromEntries(e.shapes.map(R=>[R.id,R])),...Object.fromEntries(((z=e.bindings)==null?void 0:z.map(R=>[R.id,R]))??[])},schema:e.schema},f=this.store.schema.migrateStoreSnapshot(h);if(f.type==="error")throw Error("Could not put content: could not migrate content");for(const R of Object.values(f.value))switch(R.typeName){case"asset":{c.push(R);break}case"shape":{u.push(R);break}case"binding":{d.push(R);break}}const y=new Map(i?u.map(R=>[R.id,R.id]):u.map(R=>[R.id,Sn()])),b=new Map(i?d.map(R=>[R.id,R.id]):d.map(R=>[R.id,Vp()]));let v=this.getCurrentPageId(),x=1/0,C=[];for(const R of this.getSelectedShapes()){if(x===0)break;const j=this.isShapeOfType(R,"frame"),B=this.getShapeAncestors(R);j&&B.push(R);const K=j?B.length+1:B.length;if(K<x)x=K,C=B,v=j?R.id:R.parentId;else if(K===x){if(C.length!==B.length)throw Error(`Ancestors: ${C.length} !== ${B.length}`);if(C.length===0){v=a;break}else{v=a;for(let G=0;G<C.length&&B[G]===C[G];G++)v=B[G].id}}}let E=!1;if(!Vi(v)){const R=this.getShape(v);if(R){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(R)))v=a;else if(l.length===1){const j=u.find(B=>B.id===l[0]);this.isShapeOfType(R,"frame")&&this.isShapeOfType(j,"frame")&&j.props.w===(R==null?void 0:R.props.w)&&j.props.h===(R==null?void 0:R.props.h)&&(E=!0)}}else v=a}E||(E=y.has(v)),E&&(v=this.getShape(v).parentId);let I=this.getHighestIndexForParent(v);const P=[],_=u.map(R=>{const j=y.get(R.id),B={...R,id:j};return l.includes(R.id)&&(B.parentId=a,P.push(B)),y.has(B.parentId)?B.parentId=y.get(R.parentId):(l.push(B.id),B.index=I,I=ac(I)),B});if(_.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return HC(this),this;const A=d.map(R=>({...R,id:Ps(b.get(R.id)),fromId:Ps(y.get(R.fromId)),toId:Ps(y.get(R.toId))})),D=[],L=[];for(const R of c)this.store.has(R.id)||((R.type==="image"&&(($=R.props.src)!=null&&$.startsWith("data:image"))||R.type==="video"&&((H=R.props.src)!=null&&H.startsWith("data:video")))&&(L.push(ar(R)),R.props.src=null),D.push(R));return Promise.allSettled(L.map(async R=>{const j=await jXe(R.props.src,R.props.name,R.props.mimeType??"image/png"),B=await this.getAssetForExternalContent({type:"file",file:j,assetId:R.id});if(!B){this.deleteAssets([R.id]);return}this.updateAssets([{...B,id:R.id}])})),this.run(()=>{D.length>0&&this.createAssets(D),this.createShapes(_),this.createBindings(A),r&&this.select(...P.map(G=>G.id)),v!==a&&this.reparentShapes(P.map(G=>G.id),v);const R=_.map(G=>this.getShape(G.id)),j=Ee.Common(R.map(G=>this.getShapePageBounds(G)));if(o===void 0)if(Vi(v)){const G=this.getViewportPageBounds();s||G.includes(Ee.From(j))?o=j.center:o=G.center}else{const G=this.getShape(v);o=xe.applyToPoint(this.getShapePageTransform(G),this.getShapeGeometry(G).bounds.center)}if(P.length===1){const G=P[0];if(this.isShapeOfType(G,"frame"))for(;this.getShapesAtPoint(o).some(V=>this.isShapeOfType(V,"frame")&&V.props.w===G.props.w&&V.props.h===G.props.h);)o.x+=j.w+16}const B=Ee.Common(bt(P.map(({id:G})=>this.getShapePageBounds(G)))).center,K=M.Sub(o,B);this.updateShapes(P.map(({id:G})=>{const V=this.getShape(G),W=this.getShapeParentTransform(G).decompose().rotation,Z=M.Rot(K,-W);return{id:V.id,type:V.type,x:V.x+Z.x,y:V.y+Z.y}}))}),this}async getSvgElement(e,n={}){const r=e.length===0?this.getCurrentPageShapeIdsSorted():typeof e[0]=="string"?e:e.map(i=>i.id);if(r.length!==0)return PXe(this,r,n)}async getSvgString(e,n={}){const r=await this.getSvgElement(e,n);return r?{svg:new XMLSerializer().serializeToString(r.svg),width:r.width,height:r.height}:void 0}async getSvg(e,n={}){const r=await this.getSvgElement(e,n);if(r)return r.svg}async toImage(e,n={}){const r={format:"png",scale:1,pixelRatio:n.format==="svg"?void 0:2,...n},i=await this.getSvgString(e,r);if(!i)throw new Error("Could not create SVG");switch(r.format){case"svg":return{blob:new Blob([i.svg],{type:"image/svg+xml"}),width:i.width,height:i.height};case"jpeg":case"png":case"webp":{const s=await DXe(i.svg,{type:r.format,quality:r.quality,pixelRatio:r.pixelRatio,width:i.width,height:i.height});if(!s)throw new Error("Could not construct image.");return{blob:s,width:i.width,height:i.height}}default:Yt(r.format)}}_updateInputsFromEvent(e){const{pointerVelocity:n,previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:s,currentPagePoint:o,originScreenPoint:a,originPagePoint:l}=this.inputs,{screenBounds:c}=this.store.unsafeGetWithoutCapture(so),{x:u,y:d,z:h}=kb(()=>this.getCamera()),f=e.point.x-c.x,y=e.point.y-c.y,b=e.point.z??.5;r.setTo(s),i.setTo(o),s.set(f,y);const v=f/h-u,x=y/h-d;isFinite(v)&&isFinite(x)&&o.set(v,x,b),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(n.set(0,0),a.setTo(s),l.setTo(o)),this.run(()=>{var C;this.store.put([{id:HI,typeName:"pointer",x:o.x,y:o.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===DZ.CAMERA_MOVE?((C=this.store.unsafeGetWithoutCapture(HI))==null?void 0:C.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return ife(this.store)}loadSnapshot(e,n){return IU(this.store,e,n),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run(()=>{switch(e.type){case"page":{const n=this.getPage(e.pageId);n&&this.setCurrentPage(n),this._zoomToFitPageContentAt100Percent();return}case"shapes":{const n=bt(e.shapeIds.map(o=>this.getShape(o))),r={};for(const o of n){const a=this.getAncestorPageId(o);a&&(r[a]??(r[a]=[]),r[a].push(o))}const[i,s]=Object.entries(r).sort(([o,a],[l,c])=>c.length-a.length)[0]??["",[]];if(!i||!s.length)this._zoomToFitPageContentAt100Percent();else{this.setCurrentPage(i);const o=Ee.Common(s.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(o,{immediate:!0,targetZoom:this.getBaseZoom()})}return}case"viewport":{if(e.pageId){if(!this.getPage(e.pageId)){this._zoomToFitPageContentAt100Percent();return}this.setCurrentPage(e.pageId)}this.zoomToBounds(e.bounds,{immediate:!0,inset:0});return}default:Yt(e)}})}navigateToDeepLink(e){if(e&&"type"in e)return this._navigateToDeepLink(e),this;const r=new URL((e==null?void 0:e.url)??window.location.href).searchParams.get((e==null?void 0:e.param)??"d");if(!r)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink($Xe(r))}catch(i){console.warn(i),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){const n=new URL((e==null?void 0:e.url)??window.location.href);return n.searchParams.set((e==null?void 0:e.param)??"d",FXe((e==null?void 0:e.to)??{type:"viewport",pageId:this.options.maxPages===1?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),n}registerDeepLinkListener(e){if(e!=null&&e.getUrl&&!(e!=null&&e.onChange))throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const n=me("url with state",()=>{var l,c;const o=((l=e==null?void 0:e.getUrl)==null?void 0:l.call(e,this))??window.location.href;return this.createDeepLink({param:e==null?void 0:e.param,url:o,to:(c=e==null?void 0:e.getTarget)==null?void 0:c.call(e,this)}).toString()}),r=(e==null?void 0:e.onChange)??(()=>{var a;const o=this.createDeepLink({param:e==null?void 0:e.param,to:(a=e==null?void 0:e.getTarget)==null?void 0:a.call(e,this)});window.history.replaceState({},document.title,o.toString())}),i=vk(o=>o(),(e==null?void 0:e.debounceMs)??500),s=Ma("update url on state change",()=>r(new URL(n.get()),this),{scheduleEffect:i});return()=>{s(),i.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:ni(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:ni(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:ni(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:ni(this.inputs),code:"MetaLeft"})}dispatch(e){return this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const n=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const r of n)this._flushEventForTick(r)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick(e){if(this.getCrashingError())return this;this.emit("before-event",e);const{inputs:n}=this,{type:r}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,n.shiftKey=!0):!e.shiftKey&&n.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,n.altKey=!0):!e.altKey&&n.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,n.ctrlKey=!0):!e.ctrlKey&&n.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,n.metaKey=!0):!e.metaKey&&n.metaKey&&this._metaKeyTimeout===-1&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:i,currentPagePoint:s}=n;n.isPointing||(n.isDragging=!1);const o=this.store.unsafeGetWithoutCapture(so),a=this.store.get(this._getCurrentPageStateId()),l=this._cameraOptions.__unsafe__getWithoutCapture();switch(r){case"pinch":{if(l.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(n.isPinching)return;n.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...a.selectedShapeIds]),this._didPinch=!0,n.isPinching=!0,this.interrupt());return}case"pinch":{if(!n.isPinching)return;const{point:{z:c=1},delta:{x:u,y:d}}=e,{x:h,y:f}=M.SubXY(e.point,o.screenBounds.x,o.screenBounds.y);this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:y,y:b,z:v}=kb(()=>this.getCamera()),{panSpeed:x}=l;this._setCamera(new M(y+u*x/v-h/v+h/c,b+d*x/v-f/v+f/c,c),{immediate:!0});return}case"pinch_end":{if(!n.isPinching)return this;n.isPinching=!1;const{_selectedShapeIdsAtPointerDown:c}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,c.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(c)}));return}}}case"wheel":{if(l.isLocked)return;this._updateInputsFromEvent(e);const{panSpeed:c,zoomSpeed:u,wheelBehavior:d}=l;if(d!=="none"){this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:h,y:f,z:y}=kb(()=>this.getCamera()),{x:b,y:v,z:x=0}=e.delta;let C=d;switch(e.ctrlKey&&(C=d==="pan"?"zoom":"pan"),C){case"zoom":{const{x:E,y:I}=this.inputs.currentScreenPoint;let P=x;d==="zoom"&&(Math.abs(v)>10?P=10*Math.sign(v)/100:P=v/100);const _=y+(P??0)*u*y;this._setCamera(new M(h+E/_-E/y,f+I/_-I/y,_),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new M(h+b*c/y,f+v*c/y,y),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}break}case"pointer":{if(n.isPinching)return;this._updateInputsFromEvent(e);const{isPen:c}=e,{isPenMode:u}=o;switch(e.name){case"pointer_down":{if(u&&!c)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{const d=this.getViewportScreenBounds();this.dispatch({...e,point:this.inputs.originScreenPoint.clone().addXY(d.x,d.y),name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===RZ&&(this.capturedPointerId=e.pointerId),n.buttons.add(e.button),n.isPointing=!0,n.isDragging=!1,!u&&c&&this.updateInstanceState({isPenMode:!0}),e.button===NZ?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===LC&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!c&&u)return;const{x:d,y:h,z:f}=kb(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:y,previousScreenPoint:b}=this.inputs,v=M.Sub(y,b);this.setCamera(new M(d+v.x/f,h+v.y/f,f),{immediate:!0}),this.maybeTrackPerformance("Panning");return}n.isPointing&&!n.isDragging&&M.Dist2(i,s)*this.getZoomLevel()>(o.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/f&&(n.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(n.isDragging=!1,n.isPointing=!1,clearTimeout(this._longPressTimeout),n.buttons.delete(e.button),o.isPenMode&&!c)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),n.isPanning){n.keys.has("Space")||(n.isPanning=!1,n.isSpacebarPanning=!1);const d=this.inputs.pointerVelocity,h=Math.min(2,d.len());switch(e.button){case RZ:{this.setCursor({type:"grab",rotation:0});break}case LC:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}h>0&&this.slideCamera({speed:h,direction:d})}else e.button===NZ&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.code==="MetaRight"&&(e.code="MetaLeft"),e.name){case"key_down":{if(n.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=o.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let c;switch(e.code){case"ArrowUp":{c=new M(0,-1);break}case"ArrowRight":{c=new M(1,0);break}case"ArrowDown":{c=new M(0,1);break}case"ArrowLeft":{c=new M(-1,0);break}}if(c){const u=this.getViewportPageBounds(),d=u.clone().translate(c.mulV({x:u.w,y:u.h}));this._animateToViewport(d,{animation:{duration:320}})}}break}case"key_up":{n.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(LC)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===LC?e.name="middle_click":e.button===vU&&(e.name="right_click");const{isPenMode:c}=this.store.unsafeGetWithoutCapture(so);if(e.isPen===c){const u=this._clickManager.handlePointerEvent(e);if(e.name!==u.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(u),this.emit("event",u);return}}}return this.root.handleEvent(e),this.emit("event",e),e.type==="pointer"&&e.name==="pointer_down"&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){Jn.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}};ze=lZe(Q3);Ve(ze,1,"getIsShapeHiddenCache",ume,Be);Ve(ze,1,"getCanUndo",cme,Be);Ve(ze,1,"getCanRedo",lme,Be);Ve(ze,1,"getPath",ame,Be);Ve(ze,1,"getCurrentTool",ome,Be);Ve(ze,1,"getCurrentToolId",sme,Be);Ve(ze,1,"getDocumentSettings",ime,Be);Ve(ze,1,"getInstanceState",rme,Be);Ve(ze,1,"getOpenMenus",nme,Be);Ve(ze,1,"getIsMenuOpen",tme,Be);Ve(ze,1,"getPageStates",eme,Be);Ve(ze,1,"_getPageStatesQuery",Qge,Be);Ve(ze,1,"getCurrentPageState",Zge,Be);Ve(ze,1,"_getCurrentPageStateId",Jge,Be);Ve(ze,1,"getSelectedShapeIds",Xge,Be);Ve(ze,1,"getSelectedShapes",Yge,Be);Ve(ze,1,"getCurrentPageShapesInReadingOrder",Gge,Be);Ve(ze,1,"getOnlySelectedShapeId",qge,Be);Ve(ze,1,"getOnlySelectedShape",Kge,Be);Ve(ze,1,"getSelectionPageBounds",Wge,Be);Ve(ze,1,"getSelectionRotation",Vge,Be);Ve(ze,1,"getSelectionRotatedPageBounds",Hge,Be);Ve(ze,1,"getSelectionRotatedScreenBounds",Uge,Be);Ve(ze,1,"getFocusedGroupId",zge,Be);Ve(ze,1,"getFocusedGroup",Bge,Be);Ve(ze,1,"getEditingShapeId",$ge,Be);Ve(ze,1,"getEditingShape",Fge,Be);Ve(ze,1,"getRichTextEditor",Lge,Be);Ve(ze,1,"getHoveredShapeId",jge,Be);Ve(ze,1,"getHoveredShape",Nge,Be);Ve(ze,1,"getHintingShapeIds",Rge,Be);Ve(ze,1,"getHintingShape",Dge,Be);Ve(ze,1,"getErasingShapeIds",Oge,Be);Ve(ze,1,"getErasingShapes",Mge,Be);Ve(ze,1,"_unsafe_getCameraId",Age,Be);Ve(ze,1,"getCamera",kge,Be);Ve(ze,1,"getViewportPageBoundsForFollowing",_ge,Be);Ve(ze,1,"getCameraForFollowing",Pge,Be);Ve(ze,1,"getZoomLevel",Ige,Be);Ve(ze,1,"getViewportScreenBounds",Tge,Be);Ve(ze,1,"getViewportScreenCenter",Ege,Be);Ve(ze,1,"getViewportPageBounds",Cge,Be);Ve(ze,1,"_getCollaboratorsQuery",Sge,Be);Ve(ze,1,"getCollaborators",wge,Be);Ve(ze,1,"getCollaboratorsOnCurrentPage",xge,Be);Ve(ze,1,"getRenderingShapes",bge,Be);Ve(ze,1,"_getAllPagesQuery",vge,Be);Ve(ze,1,"getPages",yge,Be);Ve(ze,1,"getCurrentPageId",mge,Be);Ve(ze,1,"getCurrentPageShapeIdsSorted",gge,Be);Ve(ze,1,"_getAllAssetsQuery",pge,Be);Ve(ze,1,"_getShapeHandlesCache",fge,Be);Ve(ze,1,"_getShapePageTransformCache",hge,Be);Ve(ze,1,"_getShapePageBoundsCache",dge,Be);Ve(ze,1,"_getShapeClipPathCache",uge,Be);Ve(ze,1,"_getShapeMaskCache",cge,Be);Ve(ze,1,"_getShapeMaskedPageBoundsCache",lge,Be);Ve(ze,1,"getNotVisibleShapes",age,Be);Ve(ze,1,"getCulledShapes",oge,Be);Ve(ze,1,"getCurrentPageBounds",sge,Be);Ve(ze,1,"getCurrentPageShapes",ige,Be);Ve(ze,1,"getCurrentPageShapesSorted",rge,Be);Ve(ze,1,"getCurrentPageRenderingShapesSorted",nge,Be);Ve(ze,1,"_getBindingsIndexCache",tge,Be);Ve(ze,1,"_getSelectionSharedStyles",ege,Be);Ve(ze,1,"getSharedStyles",Qpe,Be);Ve(ze,1,"getSharedOpacity",Zpe,Be);Ve(ze,1,"getIsFocused",Jpe,Be);Ve(ze,1,"getIsReadonly",Xpe,Be);Ve(ze,1,"_setShiftKeyTimeout",Ype,Be);Ve(ze,1,"_setAltKeyTimeout",Gpe,Be);Ve(ze,1,"_setCtrlKeyTimeout",qpe,Be);Ve(ze,1,"_setMetaKeyTimeout",Kpe,Be);uZe(ze,Be);function HC(t,e=t.getCurrentPageId()){const n=t.getPage(e).name;t.emit("max-shapes",{name:n,pageId:e,count:t.options.maxShapesPerPage})}function Wc(t,e){if(!e)return t;let n=null;const r=Object.entries(e);for(let i=0,s=r.length;i<s;i++){const[o,a]=r[i];if(a!==void 0&&!(o==="id"||o==="type"||o==="typeName")&&a!==t[o]){if(n||(n={...t}),o==="props"||o==="meta"){n[o]={...t[o]};for(const[l,c]of Object.entries(a))n[o][l]=c;continue}n[o]=a}}return n||t}function dme(t,e,n){const r=t.getShape(e);if(!r)return;n.push(r);const i=t.getSortedChildIdsForParent(e);for(let s=0,o=i.length;s<o;s++)dme(t,i[s],n)}function iQ(t,e,n){let r;if(t.run(()=>{const i=t.store.extractingChanges(()=>{const s=new Set,o=new Set;for(const a of e)if(t.getShape(a))for(const c of t.getBindingsInvolvingShape(a)){const u=e.has(c.fromId),d=e.has(c.toId);if(u&&d){s.add(c.id);continue}(!u||!d)&&o.add(c.id)}t.deleteBindings([...o],{isolateShapes:!0});try{r=sf.ok(n(s))}catch(a){r=sf.err(a)}});t.store.applyDiff($3(i),{runCallbacks:!1})},{history:"ignore"}),r.ok)return r.value;throw r.error}function sQ(t,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:n,y:r}}=e.constraints,i=t.getViewportScreenBounds(),s=Ee.From(e.constraints.bounds),o=(i.w-n*2)/s.w,a=(i.h-r*2)/s.h;return{zx:o,zy:a}}function NS(){const t=re(),e=MS();return ie("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??t.user.getIsDarkMode(),[e,t])}const oQ="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",aQ="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",VC='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function wh(t,e,n,r,i,s=16,o=16){const a=(-n-e)*(un/180),l=Math.sin(a),c=Math.cos(a),u=1*c-1*l,d=1*l+1*c;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${d}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+t.replaceAll('"',"'")+`</g></svg>") ${s} ${o}, pointer`}const hZe=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],fZe={none:()=>"none","ew-resize":(t,e,n)=>wh(aQ,t,0,e,n),"ns-resize":(t,e,n)=>wh(aQ,t,90,e,n),"nesw-resize":(t,e,n)=>wh(oQ,t,0,e,n),"nwse-resize":(t,e,n)=>wh(oQ,t,90,e,n),"nwse-rotate":(t,e,n)=>wh(VC,t,0,e,n),"nesw-rotate":(t,e,n)=>wh(VC,t,90,e,n),"senw-rotate":(t,e,n)=>wh(VC,t,180,e,n),"swne-rotate":(t,e,n)=>wh(VC,t,270,e,n)};function fa(t,e=0,n="black"){return fZe[t](GGe(e),!1,n)}function pZe(){const t=re(),e=Fr(),n=NS();lg("useCursor",()=>{const{type:r,rotation:i}=t.getInstanceState().cursor;if(hZe.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",fa(r,i,n?"white":"black"))},[t,e,n])}function gZe(){const t=re(),e=Fr(),n=NS(),r=ie(Jn.forceSrgb);$e.useEffect(()=>{n?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[t,e,r,n])}function mZe(){const[t,e]=S.useState(0);S.useEffect(()=>e(n=>n+1),[])}const yZe=t=>t.props.src,vZe={upload:async(t,e)=>({src:await co.blobToDataUrl(e)})};function bZe(t){return"schema"in t&&t.schema?t.schema:FGe({shapes:"shapeUtils"in t&&t.shapeUtils?lQ(ufe(t.shapeUtils)):void 0,bindings:"bindingUtils"in t&&t.bindingUtils?lQ(sfe(t.bindingUtils)):void 0,migrations:"migrations"in t?t.migrations:void 0})}function ZI({initialData:t,defaultName:e="",id:n,assets:r=vZe,onMount:i,collaboration:s,...o}={}){const a=bZe(o),l=new sU({id:n,schema:a,initialData:t,props:{defaultName:e,assets:{upload:r.upload,resolve:r.resolve??yZe,remove:r.remove??(()=>Promise.resolve())},onMount:c=>{it(c instanceof Be),i==null||i(c)},collaboration:s}});if(o.snapshot){if(t)throw new Error("Cannot provide both initialData and snapshot");IU(l,o.snapshot,{forceOverwriteSessionState:!0})}return l}function lQ(t){return Object.fromEntries(t.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const xZe="TLDRAW_DOCUMENT_v2",wZe="TLDRAW_ASSET_STORE_v1",hme="TLDRAW_DB_NAME_INDEX_v2",Ut={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function fme(t){const e=xZe+t;return CZe(e),await n4(e,4,{upgrade(n){n.objectStoreNames.contains(Ut.Records)||n.createObjectStore(Ut.Records),n.objectStoreNames.contains(Ut.Schema)||n.createObjectStore(Ut.Schema),n.objectStoreNames.contains(Ut.SessionState)||n.createObjectStore(Ut.SessionState),n.objectStoreNames.contains(Ut.Assets)||n.createObjectStore(Ut.Assets)}})}async function SZe(t){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(h=>h.name):LU(),n=wZe+t;if(!e.find(h=>h===n))return;const i=await n4(n,1,{upgrade(h){h.objectStoreNames.contains("assets")||h.createObjectStore("assets")}});if(!i.objectStoreNames.contains("assets"))return;const s=i.transaction(["assets"],"readonly"),o=s.objectStore("assets"),a=await o.getAllKeys(),l=await Promise.all(a.map(async h=>[h,await o.get(h)]));await s.done;const c=await fme(t),u=c.transaction([Ut.Assets],"readwrite"),d=u.objectStore(Ut.Assets);for(const[h,f]of l)d.put(f,h);await u.done,i.close(),c.close(),await aie(n)}const Ax=class Ax{constructor(e){N(this,"getDbPromise");N(this,"isClosed",!1);N(this,"pendingTransactionSet",new Set);Ax.connectedInstances.add(this),this.getDbPromise=(async()=>(await SZe(e),await fme(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(nw)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),Ax.connectedInstances.delete(this))}tx(e,n,r){const i=(async()=>{it(!this.isClosed,"db is closed");const o=(await this.getDb()).transaction(n,e),a=o.done.catch(l=>{if(!this.isClosed)throw l});try{return await r(o)}finally{this.isClosed?o.abort():await a}})();return this.pendingTransactionSet.add(i),i.finally(()=>this.pendingTransactionSet.delete(i)),i}async load({sessionId:e}={}){return await this.tx("readonly",[Ut.Records,Ut.Schema,Ut.SessionState],async n=>{var l,c;const r=n.objectStore(Ut.Records),i=n.objectStore(Ut.Schema),s=n.objectStore(Ut.SessionState);let o=e?(l=await s.get(e))==null?void 0:l.snapshot:null;return o||(o=(c=(await s.getAll()).sort((d,h)=>d.updatedAt-h.updatedAt).pop())==null?void 0:c.snapshot),{records:await r.getAll(),schema:await i.get(Ut.Schema),sessionStateSnapshot:o}})}async storeChanges({schema:e,changes:n,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[Ut.Records,Ut.Schema,Ut.SessionState],async s=>{const o=s.objectStore(Ut.Records),a=s.objectStore(Ut.Schema),l=s.objectStore(Ut.SessionState);for(const[c,u]of Object.entries(n.added))await o.put(u,c);for(const[c,u]of Object.values(n.updated))await o.put(u,u.id);for(const c of Object.keys(n.removed))await o.delete(c);a.put(e.serialize(),Ut.Schema),i&&r?l.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:n,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[Ut.Records,Ut.Schema,Ut.SessionState],async s=>{const o=s.objectStore(Ut.Records),a=s.objectStore(Ut.Schema),l=s.objectStore(Ut.SessionState);await o.clear();for(const[c,u]of Object.entries(n))await o.put(u,c);a.put(e.serialize(),Ut.Schema),i&&r?l.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Ut.SessionState],async e=>{const n=e.objectStore(Ut.SessionState),r=(await n.getAll()).sort((s,o)=>s.updatedAt-o.updatedAt);if(r.length<10){await e.done;return}const i=r.slice(0,r.length-10);for(const{id:s}of i)await n.delete(s)})}async getAsset(e){return await this.tx("readonly",[Ut.Assets],async n=>await n.objectStore(Ut.Assets).get(e))}async storeAsset(e,n){await this.tx("readwrite",[Ut.Assets],async r=>{await r.objectStore(Ut.Assets).put(n,e)})}async removeAssets(e){await this.tx("readwrite",[Ut.Assets],async n=>{const r=n.objectStore(Ut.Assets);for(const i of e)await r.delete(i)})}};N(Ax,"connectedInstances",new Set);let QI=Ax;function LU(){const t=JSON.parse(Oz(hme)||"[]")??[];return Array.isArray(t)?t:[]}function CZe(t){const e=new Set(LU());e.add(t),Dz(hme,JSON.stringify([...e]))}function EZe(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
• If your hard disk is full, try clearing up some space and then reload the page.`)}function TZe(){window.alert(`Oops! We could not access your browser's storage—and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const IZe=350,PZe=1e4,cQ=Symbol("UPDATE_INSTANCE_STATE"),_Ze=t=>t;class kZe{constructor(e){N(this,"onmessage")}postMessage(e){}close(){}}const AZe=typeof BroadcastChannel>"u"?kZe:BroadcastChannel;class MZe{constructor(e,{persistenceKey:n,sessionId:r=XI,onLoad:i,onLoadError:s},o=new AZe(`tldraw-tab-sync-${n}`)){N(this,"disposables",new Set);N(this,"diffQueue",[]);N(this,"didDispose",!1);N(this,"shouldDoFullDBWrite",!0);N(this,"isReloading",!1);N(this,"persistenceKey");N(this,"sessionId");N(this,"serializedSchema");N(this,"isDebugging",!1);N(this,"documentTypes");N(this,"$sessionStateSnapshot");N(this,"db");N(this,"initTime",Date.now());N(this,"isPersisting",!1);N(this,"didLastWriteError",!1);N(this,"scheduledPersistTimeout",null);this.store=e,this.channel=o,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=r,this.db=new QI(n),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=TU(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(_Ze({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(cQ),this.schedulePersist()},{scope:"session"})),this.connect(i,s),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,n){this.debug("connecting");let r;try{r=await this.db.load({sessionId:this.sessionId})}catch(i){n(i),TZe();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const i=Object.fromEntries(r.records.map(l=>[l.id,l])),s=r.sessionStateSnapshot??_Ye(i),o=this.store.schema.migrateStoreSnapshot({store:i,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(o.type==="error"){console.error("failed to migrate store",o),n(new Error(`Failed to migrate store: ${o.reason}`));return}const a=Object.values(o.value).filter(l=>this.documentTypes.has(l.typeName));a.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(a,"initialize")}),s&&K3(this.store,s,{forceOverwrite:!0})}this.channel.onmessage=({data:i})=>{var a,l;this.debug("got message",i);const s=i,o=this.store.schema.getMigrationsSince(s.schema);if(o.ok){if(o.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){n(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(l=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||l.call(a);return}s.type==="diff"&&(this.debug("applying diff"),Oa(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(s.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;n(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?PZe:IZe))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(it(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const n=iU(e.filter(r=>r!==cQ));await this.db.storeChanges({changes:n,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(n){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",n),EZe(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function pme(t){const e=S.useRef(t),[n,r]=S.useState(t);n!==e.current&&r(e.current);const i=S.useCallback(s=>{typeof s=="function"?e.current=s(e.current):e.current=s,r(e.current)},[]);return[n,i]}function OZe(t){const[e,n]=pme({status:"loading"});return t=Fv(t),S.useEffect(()=>{const{persistenceKey:r,sessionId:i,...s}=t;if(!r){n({status:"not-synced",store:ZI(s)});return}n({status:"loading"});const o=new zs,a={upload:async(d,h)=>(await u.db.storeAsset(d.id,h),{src:d.id}),resolve:async d=>d.props.src?d.props.src.startsWith("asset:")?await o.get(d,async()=>{const h=await u.db.getAsset(d.id);return h?URL.createObjectURL(h):null}):d.props.src:null,remove:async d=>{await u.db.removeAssets(d)},...s.assets},l=ZI({...s,assets:a});let c=!1;const u=new MZe(l,{sessionId:i,persistenceKey:r,onLoad(){c||n({store:l,status:"synced-local"})},onLoadError(d){c||n({status:"error",error:d})}});return()=>{c=!0,u.close()}},[t,n]),e}function DZe(){const t=re(),e=Fr();S.useEffect(()=>{const n=s=>e.style.setProperty("--tl-zoom",s.toString()),r=vk(n,100),i=new zg("useZoomCss",()=>{t.getCurrentPageShapeIds().size<300?n(t.getZoomLevel()):r(t.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach(),r.cancel()}},[t,e])}function e$(t){const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let r=0,i=t.length;r<i;r++)n[r]=t.charCodeAt(r);return e}function RZe(t){const e=atob(t),n=e$(e);return crypto.subtle.importKey("spki",new Uint8Array(n),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const NZe=5,Ab={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},jZe=Math.max(...Object.values(Ab)),Mb={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},LZe=Object.keys(Mb).length,$j="sales@tldraw.com",FZe=`${zr()}/watermarks/watermark-track.svg`;class Wk{constructor(e,n,r){N(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");N(this,"isDevelopment");N(this,"isTest");N(this,"isCryptoAvailable");N(this,"state",lr("license state","pending"));N(this,"verbose",!0);this.isTest=!1,this.isDevelopment=this.getIsDevelopment(r),this.publicKey=n||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(i=>{const s=$Ze(i);!this.isDevelopment&&s&&hc(FZe),s?this.state.set("unlicensed"):i.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")})}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:!["https:","vscode-webview:"].includes(window.location.protocol)||window.location.hostname==="localhost"}async extractLicenseKey(e){const[n,r]=e.split("."),[i,s]=n.split("/");if(!i.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${i}'`);const o=await RZe(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,new Uint8Array(e$(atob(r))),new Uint8Array(e$(atob(s))))}catch(c){throw console.error(c),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let l;try{l=JSON.parse(atob(s))}catch{throw new Error("Could not parse object")}return l.length>LZe&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:l[Mb.ID],hosts:l[Mb.HOSTS],flags:l[Mb.FLAGS],expiryDate:l[Mb.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let n=e.replace(/[\u200B-\u200D\uFEFF]/g,"");n=n.replace(/\r?\n|\r/g,"");try{const r=await this.extractLicenseKey(n),i=new Date(r.expiryDate),s=this.isFlagEnabled(r.flags,Ab.ANNUAL_LICENSE),o=this.isFlagEnabled(r.flags,Ab.PERPETUAL_LICENSE),a={license:r,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(r),expiryDate:i,isAnnualLicense:s,isAnnualLicenseExpired:s&&this.isAnnualLicenseExpired(i),isPerpetualLicense:o,isPerpetualLicenseExpired:o&&this.isPerpetualLicenseExpired(i),isInternalLicense:this.isFlagEnabled(r.flags,Ab.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(r.flags,Ab.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(a),a}catch(r){return this.outputInvalidLicenseKey(r.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const n=window.location.hostname.toLowerCase();return e.hosts.some(r=>{const i=r.toLowerCase().trim();if(i===n||`www.${i}`===n||i===`www.${n}`||r==="*")return!0;if(r.includes("*")){const s=new RegExp(r.replace(/\*/g,".*?"));return s.test(n)||s.test(`www.${n}`)}if(window.location.protocol==="vscode-webview:"){const o=new URL(window.location.href).searchParams.get("extensionId");if(i===o)return!0}return!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+NZe+1)}isAnnualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e),r=new Date>=n;return!r&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${$j} if you would like to renew your license.`]),r}isPerpetualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e),r={major:new Date(LZ.major),minor:new Date(LZ.minor)};return r.major>=n||r.minor>=n}isFlagEnabled(e,n){return(e&n)===n}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${$j} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${$j} if you would like to use tldraw on other domains.`]),e.license.flags>=jZe*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const n of e)console.log(`%c${n}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}N(Wk,"className","tl-watermark_SEE-LICENSE");function $Ze(t){if(!t.isLicenseParseable||!t.isDomainValid&&!t.isDevelopment)return!0;if(t.isPerpetualLicenseExpired||t.isAnnualLicenseExpired){if(t.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const gme=S.createContext({}),BZe=()=>S.useContext(gme);function zZe({licenseKey:t,children:e}){const[n]=S.useState(()=>new Wk(t));return g.jsx(gme.Provider,{value:n,children:e})}function Hd(t){if(!t)throw Error("usePassThroughWheelEvents must be passed a ref");const e=Fr();S.useEffect(()=>{function n(i){if(i.isSpecialRedispatchedEvent)return;const s=t.current;if(s&&s.scrollHeight>s.clientHeight)return;St(i);const o=e.querySelector(".tl-canvas");if(!o)return;const a=new WheelEvent("wheel",i);a.isSpecialRedispatchedEvent=!0,o.dispatchEvent(a)}const r=t.current;if(r)return r.addEventListener("wheel",n,{passive:!1}),()=>{r.removeEventListener("wheel",n)}},[e,t])}const UZe='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',HZe='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>';function VZe(t){return ie("watermarkState",()=>t.state.get(),[t])}const WZe=`data:image/svg+xml;utf8,${encodeURIComponent(UZe)}`,KZe=`data:image/svg+xml;utf8,${encodeURIComponent(HZe)}`,qZe=S.memo(function(){const e=BZe(),n=re(),r=ie("is mobile",()=>n.getViewportScreenBounds().width<700,[n]),i=VZe(e);return["licensed-with-watermark","unlicensed"].includes(i)?g.jsxs(g.Fragment,{children:[g.jsx(YZe,{}),g.jsx(GZe,{src:r?KZe:WZe})]}):null}),GZe=S.memo(function({src:e}){const n=re(),r=ie("debug mode",()=>n.getInstanceState().isDebugMode,[n]),i=ie("is mobile",()=>n.getViewportScreenBounds().width<700,[n]),s=SU(),o=S.useRef(null);Hd(o);const a=`url('${e}') center 100% / 100% no-repeat`,l="https://tldraw.dev/?utm_source=dotcom&utm_medium=organic&utm_campaign=watermark";return g.jsx("div",{ref:o,className:Wk.className,"data-debug":r,"data-mobile":i,draggable:!1,...s,children:g.jsx("button",{draggable:!1,role:"button",onPointerDown:c=>{tr(c),St(c)},title:"made with tldraw",onClick:()=>Dk.openWindow(l,"_blank"),style:{mask:a,WebkitMask:a}})})}),YZe=S.memo(function(){const e=re(),n=Wk.className,r=`/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

	.${n} {
		position: absolute;
		bottom: var(--space-2);
		right: var(--space-2);
		width: 96px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: var(--layer-watermark) !important;
		background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
		opacity: 1;
		border-radius: 5px;
		pointer-events: all;
		padding: 2px;
		box-sizing: content-box;
	}

	.${n} > button {
		position: absolute;
		width: 96px;
		height: 32px;
		pointer-events: all;
		cursor: inherit;
		color: var(--color-text);
		opacity: .38;
		border: 0;
		padding: 0;
		background-color: currentColor;
	}

	.${n}[data-debug='true'] {
		bottom: 46px;
	}

	.${n}[data-mobile='true'] {
		border-radius: 4px 0px 0px 4px;
		right: -2px;
		width: 8px;
		height: 48px;
	}

	.${n}[data-mobile='true'] > button {
		width: 8px;
		height: 32px;
	}

	@media (hover: hover) {
		.${n} > button {
			pointer-events: none;
		}

		.${n}:hover {
			background-color: var(--color-background);
			transition: background-color 0.2s ease-in-out;
			transition-delay: 0.32s;
		}

		.${n}:hover > button {
			animation: ${n}_delayed_link 0.2s forwards ease-in-out;
			animation-delay: 0.32s;
		}

		.${n} > button:focus-visible {
			opacity: 1;
		}
	}


	@keyframes ${n}_delayed_link {
		0% {
			cursor: inherit;
			opacity: .38;
			pointer-events: none;
		}
		100% {
			cursor: pointer;
			opacity: 1;
			pointer-events: all;
		}
	}`;return g.jsx("style",{nonce:e.options.nonce,children:r})}),XZe=[],JZe=[],ZZe=[],QZe="tl-container",eQe=S.memo(function({store:e,components:n,className:r,user:i,options:s,...o}){const[a,l]=S.useState(null),c=S.useMemo(()=>i??efe(),[i]),u=(n==null?void 0:n.ErrorFallback)===void 0?Hhe:n==null?void 0:n.ErrorFallback,d={...o,shapeUtils:o.shapeUtils??XZe,bindingUtils:o.bindingUtils??JZe,tools:o.tools??ZZe,components:n,options:Fv(s)};return g.jsx("div",{ref:l,"data-tldraw":Vhe,draggable:!1,className:nt(`${QZe} tl-theme__light`,r),onPointerDown:tr,tabIndex:-1,role:"application","aria-label":(s==null?void 0:s.branding)??"tldraw",children:g.jsx(cw,{fallback:u,onError:h=>Pz(h,{tags:{origin:"react.tldraw-before-app"}}),children:a&&g.jsx(zZe,{licenseKey:o.licenseKey,children:g.jsx(zhe,{container:a,children:g.jsx(pQe,{overrides:n,children:e?e instanceof sU?g.jsx(yme,{...d,store:e,user:c}):g.jsx(mme,{...d,store:e,user:c}):g.jsx(tQe,{...d,store:e,user:c})})})})})})});function tQe(t){const{defaultName:e,snapshot:n,initialData:r,shapeUtils:i,bindingUtils:s,persistenceKey:o,sessionId:a,user:l,assets:c,migrations:u}=t,d=OZe({shapeUtils:i,bindingUtils:s,initialData:r,persistenceKey:o,sessionId:a,defaultName:e,snapshot:n,assets:c,migrations:u});return g.jsx(mme,{...t,store:d,user:l})}const mme=S.memo(function({store:e,user:n,...r}){const i=Fr();S.useLayoutEffect(()=>{n.userPreferences.get().colorScheme==="dark"&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))},[i,n]);const{LoadingScreen:s}=Cn();switch(e.status){case"error":throw e.error;case"loading":return s?g.jsx(s,{}):null}return g.jsx(yme,{...r,store:e.store,user:n})}),Bj=()=>document.location.search.includes("tldraw_preserve_focus");function yme({onMount:t,children:e,store:n,tools:r,shapeUtils:i,bindingUtils:s,user:o,initialState:a,autoFocus:l=!0,inferDarkMode:c,cameraOptions:u,textOptions:d,options:h,licenseKey:f,deepLinks:y,isShapeHidden:b,getShapeVisibility:v,assetUrls:x}){const{ErrorFallback:C}=Cn(),E=Fr(),[I,P]=pme(null),_=S.useRef(null),A=Fv(y===!0?{}:y),D=S.useRef({autoFocus:l&&!Bj(),inferDarkMode:c,initialState:a,cameraOptions:u,deepLinks:A});S.useLayoutEffect(()=>{D.current={autoFocus:l&&!Bj(),inferDarkMode:c,initialState:a,cameraOptions:u,deepLinks:A}},[l,c,a,u,A]),S.useLayoutEffect(()=>{const{autoFocus:B,inferDarkMode:K,initialState:G,cameraOptions:V,deepLinks:W}=D.current,Z=new Be({store:n,shapeUtils:i,bindingUtils:s,tools:r,getContainer:()=>E,user:o,initialState:G,autoFocus:B,inferDarkMode:K,cameraOptions:V,textOptions:d,options:h,licenseKey:f,isShapeHidden:b,getShapeVisibility:v,fontAssetUrls:x==null?void 0:x.fonts});return Z.updateViewportScreenBounds(_.current??E),W&&(W!=null&&W.getUrl?Z.navigateToDeepLink({...W,url:W.getUrl(Z)}):Z.navigateToDeepLink(W)),P(Z),()=>{Z.dispose()}},[s,E,h,i,n,r,o,P,f,b,v,d,x]),S.useLayoutEffect(()=>{if(I&&A)return I.registerDeepLinkListener(A)},[I,A]),S.useLayoutEffect(()=>{I&&u&&I.setCameraOptions(u)},[I,u]);const L=S.useSyncExternalStore(S.useCallback(B=>I?(I.on("crash",B),()=>I.off("crash",B)):()=>{},[I]),()=>(I==null?void 0:I.getCrashingError())??null);S.useEffect(function(){if(!I)return;function K(){I&&I.focus()}function G(){I&&I.blur()}if(l&&Bj())return I.getContainer().addEventListener("pointerdown",K),document.body.addEventListener("pointerdown",G),()=>{var V;(V=I.getContainer())==null||V.removeEventListener("pointerdown",K),document.body.removeEventListener("pointerdown",G)}},[I,l]);const[z,$]=S.useState(null);let H=z;I!==(H==null?void 0:H.editor)&&(H=null),S.useEffect(()=>{if(!I)return;let B=!1;return $({editor:I,isLoaded:!1}),I.fonts.loadRequiredFontsForCurrentPage(I.options.maxFontsToLoadBeforeRender).finally(()=>{B||$({editor:I,isLoaded:!0})}),()=>{B=!0}},[I]);const{Canvas:R,LoadingScreen:j}=Cn();return!I||!(H!=null&&H.isLoaded)?g.jsxs(g.Fragment,{children:[j&&g.jsx(j,{}),g.jsx("div",{className:"tl-canvas",ref:_})]}):g.jsx(cw,{fallback:C,onError:B=>I.annotateError(B,{origin:"react.tldraw",willCrashApp:!0}),children:L?g.jsx(rQe,{crashingError:L}):g.jsx(wU,{editor:I,children:g.jsxs(nQe,{onMount:t,children:[e??(R?g.jsx(R,{},I.contextId):null),g.jsx(qZe,{})]})})})}function nQe({children:t,onMount:e}){return DZe(),pZe(),gZe(),mZe(),bme(n=>{const r=n.store.props.onMount(n),i=e==null?void 0:e(n);return()=>{r==null||r(),i==null||i()}}),t}function rQe({crashingError:t}){throw t}function vme({children:t}){return g.jsx("div",{className:"tl-loading","aria-busy":"true",tabIndex:0,children:t})}function bme(t){const e=re(),n=Zc(r=>{let i;return r.run(()=>{i=t==null?void 0:t(r),r.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,i});$e.useLayoutEffect(()=>{if(e)return n==null?void 0:n(e)},[e,n])}const iQe=()=>{const{Spinner:t}=Cn();return g.jsx(vme,{children:t?g.jsx(t,{}):null})};function xme(t,e=!0){const n=t.length;if(n<2)return"";let r=t[0],i=t[1];if(n===2)return`M${Ji(r)}L${Ji(i)}`;let s="";for(let o=2,a=n-1;o<a;o++)r=t[o],i=t[o+1],s+=Vo(r,i);return e?`M${Vo(t[0],t[1])}Q${Ji(t[1])}${Vo(t[1],t[2])}T${s}${Vo(t[n-1],t[0])}${Vo(t[0],t[1])}Z`:`M${Ji(t[0])}Q${Ji(t[1])}${Vo(t[1],t[2])}${t.length>3?"T":""}${s}L${Ji(t[n-1])}`}function uQ({scribble:t,zoom:e,color:n,opacity:r,className:i}){return t.points.length?g.jsx("svg",{className:i&&nt("tl-overlays__item",i),children:g.jsx("path",{className:"tl-scribble",d:xme(t.points,!1),stroke:n??`var(--color-${t.color})`,fill:"none",strokeWidth:8/e,opacity:r??t.opacity})}):null}function sQe({bounds:t,rotation:e}){const n=re(),r=S.useRef(null),i=ie("only selected shape",()=>n.getOnlySelectedShape(),[n]),s=i?n.getShapeUtil(i).expandSelectionOutlinePx(i):0;return IS(r,t==null?void 0:t.x,t==null?void 0:t.y,1,e,{x:-s,y:-s}),t=s instanceof Ee?t.clone().expand(s).zeroFix():t.clone().expandBy(s).zeroFix(),g.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:g.jsx("rect",{className:nt("tl-selection__fg__outline"),width:te(t.width),height:te(t.height)})})}const oQe=()=>g.jsx("div",{className:"tl-shape-error-boundary"}),aQe=S.memo(({shape:t,util:e})=>Ek("Indicator: "+t.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(t.id))),(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta),lQe=S.memo(({editor:t,id:e})=>{const n=ie("shape for indicator",()=>t.store.get(e),[t,e]),{ShapeIndicatorErrorFallback:r}=Cn();return!n||n.isLocked?null:g.jsx(cw,{fallback:r,onError:i=>t.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:g.jsx(aQe,{shape:n,util:t.getShapeUtil(n)},n.id)})}),dQ=S.memo(function({shapeId:e,className:n,color:r,hidden:i,opacity:s}){const o=re(),a=S.useRef(null);return lg("indicator transform",()=>{if(i)return;const l=a.current;if(!l)return;const c=o.getShapePageTransform(e);c&&l.style.setProperty("transform",c.toCssString())},[o,e,i]),S.useLayoutEffect(()=>{const l=a.current;l&&l.style.setProperty("display",i?"none":"block")},[i]),g.jsx("svg",{ref:a,className:nt("tl-overlays__item",n),"aria-hidden":"true",children:g.jsx("g",{className:"tl-shape-indicator",stroke:r??"var(--color-selected)",opacity:s,children:g.jsx(lQe,{editor:o,id:e})})})}),cQe=()=>g.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),wme=S.memo(function({hideAll:e,showAll:n}){const r=re();if(e&&n)throw Error("You cannot set both hideAll and showAll props to true, cmon now");const i=S.useRef(new Set),s=ie("should display selected ids",()=>{const l=i.current,c=new Set,u=r.getInstanceState(),d=u.isChangingStyle,h=r.isInAny("select.idle","select.editing_shape"),f=r.isInAny("select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","select.pointing_handle");if(d||!(h||f))return i.current=c,c;for(const y of r.getSelectedShapeIds())c.add(y);if(h&&u.isHoveringCanvas&&!u.isCoarsePointer){const y=r.getHoveredShapeId();y&&c.add(y)}if(l.size!==c.size)return i.current=c,c;for(const y of c)if(!l.has(y))return i.current=c,c;return l},[r]),o=ie("rendering shapes",()=>r.getRenderingShapes(),[r]),{ShapeIndicator:a}=Cn();return a?o.map(({id:l})=>g.jsx(a,{shapeId:l,hidden:!n&&(e||!s.has(l))},l+"_indicator")):null});function uQe({points:t,zoom:e}){const n=2.5/e,r=t.reduce((h,f)=>Math.min(h,f.x),1/0),i=t.reduce((h,f)=>Math.max(h,f.x),-1/0),s=t.reduce((h,f)=>Math.min(h,f.y),1/0),o=t.reduce((h,f)=>Math.max(h,f.y),-1/0),a=t.some(h=>h.x===r&&h.y===s);let l,c,u,d;return a?(l=r,c=s,u=i,d=o):(l=r,c=o,u=i,d=s),g.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[g.jsx("line",{x1:l,y1:c,x2:u,y2:d}),t.map((h,f)=>g.jsx("g",{transform:`translate(${h.x},${h.y})`,children:g.jsx("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})},f))]})}function dQe({gaps:t,direction:e,zoom:n}){const r=3.5/n;let i=[-1/0,1/0],s=null;const o=e==="horizontal";for(const l of t){if(s=tc(i[0],i[1],o?l.startEdge[0].y:l.startEdge[0].x,o?l.startEdge[1].y:l.startEdge[1].x),s)i=s;else continue;if(s=tc(i[0],i[1],o?l.endEdge[0].y:l.endEdge[0].x,o?l.endEdge[1].y:l.endEdge[1].x),s)i=s;else continue}if(i===null)return null;const a=(i[0]+i[1])/2;return g.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:t.map(({startEdge:l,endEdge:c},u)=>g.jsx(S.Fragment,{children:o?g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),g.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),g.jsx("line",{x1:l[0].x,y1:a,x2:c[0].x,y2:a}),g.jsx("line",{x1:(l[0].x+c[0].x)/2,y1:a-r,x2:(l[0].x+c[0].x)/2,y2:a+r})]}):g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),g.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),g.jsx("line",{x1:a,y1:l[0].y,x2:a,y2:c[0].y}),g.jsx("line",{x1:a-r,y1:(l[0].y+c[0].y)/2,x2:a+r,y2:(l[0].y+c[0].y)/2})]})},u))})}function hQe({className:t,line:e,zoom:n}){return g.jsx("svg",{className:nt("tl-overlays__item",t),"aria-hidden":"true",children:e.type==="points"?g.jsx(uQe,{...e,zoom:n}):e.type==="gaps"?g.jsx(dQe,{...e,zoom:n}):null})}function Sme(t){return g.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16","aria-hidden":"false",...t,className:nt("tl-spinner",t.className),children:g.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[g.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),g.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor"})]})})}const fQe=()=>null,Cme=S.createContext(null);function pQe({overrides:t={},children:e}){const n=Fv(t),r=S.useMemo(()=>({Background:UGe,Brush:Ij,Canvas:Oet,CollaboratorBrush:Ij,CollaboratorCursor:jZ,CollaboratorHint:aYe,CollaboratorScribble:uQ,CollaboratorShapeIndicator:dQ,Cursor:jZ,Grid:dYe,Handle:hYe,Handles:fYe,InFrontOfTheCanvas:null,LoadingScreen:iQe,OnTheCanvas:null,Overlays:null,Scribble:uQ,SelectionBackground:null,SelectionForeground:sQe,ShapeIndicator:dQ,ShapeIndicators:wme,SnapIndicator:hQe,Spinner:Sme,SvgDefs:fQe,ZoomBrush:Ij,ErrorFallback:Hhe,ShapeErrorFallback:oQe,ShapeIndicatorErrorFallback:cQe,...n}),[n]);return g.jsx(Cme.Provider,{value:r,children:e})}function Cn(){const t=S.useContext(Cme);if(!t)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return t}const gQe=["textarea","input"];function mQe(t){const e=re();S.useEffect(()=>{const n=t.current;if(!n)return;const r=i=>{var s;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:o}=i;if(gQe.includes((s=o.tagName)==null?void 0:s.toLocaleLowerCase())||o.isContentEditable||e.isIn("select.editing_shape"))return;St(i)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.removeEventListener("touchend",r)}},[e,t])}function yQe(t,e,n){return Math.max(e,Math.min(t,n))}const rs={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function hQ(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function fQ(t,e,n,r=.15){return r===0?yQe(t,e,n):t<e?-hQ(e-t,n-e,r)+e:t>n?+hQ(t-n,n-e,r)+n:t}function vQe(t,[e,n],[r,i]){const[[s,o],[a,l]]=t;return[fQ(e,s,o,r),fQ(n,a,l,i)]}function bQe(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function xQe(t){var e=bQe(t,"string");return typeof e=="symbol"?e:String(e)}function Ts(t,e,n){return e=xQe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pQ(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function cr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?pQ(Object(n),!0).forEach(function(r){Ts(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pQ(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Eme={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function gQ(t){return t?t[0].toUpperCase()+t.slice(1):""}const wQe=["enter","leave"];function SQe(t=!1,e){return t&&!wQe.includes(e)}function CQe(t,e="",n=!1){const r=Eme[t],i=r&&r[e]||e;return"on"+gQ(t)+gQ(i)+(SQe(n,i)?"Capture":"")}const EQe=["gotpointercapture","lostpointercapture"];function TQe(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=EQe.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:n}}function IQe(t,e=""){const n=Eme[t],r=n&&n[e]||e;return t+r}function Tme(t){return"touches"in t}function PQe(t){return Tme(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function _Qe(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,e.target))})}function t$(t,e){try{const n=e.clientX-t.clientX,r=e.clientY-t.clientY,i=(e.clientX+t.clientX)/2,s=(e.clientY+t.clientY)/2,o=Math.hypot(n,r);return{angle:-(Math.atan2(n,r)*180)/Math.PI,distance:o,origin:[i,s]}}catch{}return null}function kQe(t){return _Qe(t).map(e=>e.identifier)}function mQ(t,e){const[n,r]=Array.from(t.touches).filter(i=>e.includes(i.identifier));return t$(n,r)}const yQ=40,vQ=800;function Ime(t){let{deltaX:e,deltaY:n,deltaMode:r}=t;return r===1?(e*=yQ,n*=yQ):r===2&&(e*=vQ,n*=vQ),[e,n]}function AQe(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s})}return e}function eP(t,...e){return typeof t=="function"?t(...e):t}function MQe(){}function OQe(...t){return t.length===0?MQe:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function bQ(t,e){return Object.assign({},e,t||{})}const DQe=32;class Pme{constructor(e,n,r){this.ctrl=e,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:r,args:i}=this;n[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=r.from?eP(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:r,shared:i}=this;n.args=this.args;let s=0;if(e&&(n.event=e,r.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,AQe(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const _=n._delta.map(Math.abs);rs.addTo(n._distance,_)}this.axisIntent&&this.axisIntent(e);const[o,a]=n._movement,[l,c]=r.threshold,{_step:u,values:d}=n;if(r.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=l&&d[0]),u[1]===!1&&(u[1]=Math.abs(a)>=c&&d[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=l&&Math.sign(o)*l),u[1]===!1&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),n.intentional=u[0]!==!1||u[1]!==!1,!n.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[_,A]=d;h[0]=u[0]!==!1?_-u[0]:0,h[1]=u[1]!==!1?A-u[1]:0}else h[0]=u[0]!==!1?o-u[0]:0,h[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(h);const f=n.offset,y=n._active&&!n._blocked||n.active;y&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=i[this.ingKey]=n._active,e&&(n.first&&("bounds"in r&&(n._bounds=eP(r.bounds,n)),this.setup&&this.setup()),n.movement=h,this.computeOffset()));const[b,v]=n.offset,[[x,C],[E,I]]=n._bounds;n.overflow=[b<x?-1:b>C?1:0,v<E?-1:v>I?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const P=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=vQe(n._bounds,n.offset,P),n.delta=rs.sub(n.offset,f),this.computeMovement(),y&&(!n.last||s>DQe)){n.delta=rs.sub(n.offset,f);const _=n.delta.map(Math.abs);rs.addTo(n.distance,_),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&s>0&&(n.velocity=[_[0]/s,_[1]/s],n.timeDelta=s)}}emit(){const e=this.state,n=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(cr(cr(cr({},n),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function RQe([t,e],n){const r=Math.abs(t),i=Math.abs(e);if(r>i&&r>n)return"x";if(i>r&&i>n)return"y"}class NQe extends Pme{constructor(...e){super(...e),Ts(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=rs.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=rs.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,r=this.config;if(!n.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[PQe(e)]:r.axisThreshold;n.axis=RQe(n._movement,i)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const jQe=t=>t,xQ=.15,_me={enabled(t=!0){return t},eventOptions(t,e,n){return cr(cr({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[xQ,xQ];case!1:return[0,0];default:return rs.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return rs.toVector(t)},transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||jQe},threshold(t){return rs.toVector(t,0)}},LQe=0,jS=cr(cr({},_me),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=LQe){return t},bounds(t={}){if(typeof t=="function")return s=>jS.bounds(t(s));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=t;return[[e,n],[r,i]]}}),LS=typeof window<"u"&&window.document&&window.document.createElement;function kme(){return LS&&"ontouchstart"in window}function FQe(){return kme()||LS&&window.navigator.maxTouchPoints>1}function $Qe(){return LS&&"onpointerdown"in window}function BQe(){return LS&&"exitPointerLock"in window.document}function zQe(){try{return"constructor"in GestureEvent}catch{return!1}}const yl={isBrowser:LS,gesture:zQe(),touch:kme(),touchscreen:FQe(),pointer:$Qe(),pointerLock:BQe()},UQe=250,HQe=180,VQe=.5,WQe=50,KQe=250,qQe=10,wQ={mouse:0,touch:0,pen:8};cr(cr({},jS),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&yl.pointerLock,yl.touch&&n?"touch":this.pointerLock?"mouse":yl.pointer&&!i?"pointer":yl.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?UQe:void 0,!(!yl.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:i=void 0}){const s=rs.toVector(t,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,s},swipe({velocity:t=VQe,distance:e=WQe,duration:n=KQe}={}){return{velocity:this.transform(rs.toVector(t)),distance:this.transform(rs.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return HQe;case!1:return 0;default:return t}},axisThreshold(t){return t?cr(cr({},wQ),t):wQ},keyboardDisplacement(t=qQe){return t}});function Ame(t){const[e,n]=t.overflow,[r,i]=t._delta,[s,o]=t._direction;(e<0&&r>0&&s<0||e>0&&r<0&&s>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&i>0&&o<0||n>0&&i<0&&o>0)&&(t._movement[1]=t._movementBound[1])}const GQe=30,YQe=100;class XQe extends Pme{constructor(...e){super(...e),Ts(this,"ingKey","pinching"),Ts(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:n,lastOffset:r}=this.state;e==="wheel"?this.state.offset=rs.add(n,r):this.state.offset=[(1+n[0])*r[0],n[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:n}=this.state;this.state.movement=[e[0]/n[0],e[1]-n[1]]}axisIntent(){const e=this.state,[n,r]=e._movement;if(!e.axis){const i=Math.abs(n)*GQe-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const n=this.state,r=this.ctrl.touchIds;if(n._active&&n._touchIds.every(s=>r.has(s))||r.size<2)return;this.start(e),n._touchIds=Array.from(r).slice(0,2);const i=mQ(e,n._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const n=this.state,r=n._pointerEvents,i=this.ctrl.pointerIds;if(n._active&&Array.from(r.keys()).every(o=>i.has(o))||(r.size<2&&r.set(e.pointerId,e),n._pointerEvents.size<2))return;this.start(e);const s=t$(...Array.from(r.values()));s&&this.pinchStart(e,s)}pinchStart(e,n){const r=this.state;r.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const n=mQ(e,this.state._touchIds);n&&this.pinchMove(e,n)}pointerMove(e){const n=this.state._pointerEvents;if(n.has(e.pointerId)&&n.set(e.pointerId,e),!this.state._active)return;const r=t$(...Array.from(n.values()));r&&this.pinchMove(e,r)}pinchMove(e,n){const r=this.state,i=r._values[1],s=n.angle-i;let o=0;Math.abs(s)>270&&(o+=Math.sign(s)),this.computeValues([n.distance,n.angle-360*o]),r.origin=n.origin,r.turns=o,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const n=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}n._pointerEvents.has(e.pointerId)&&n._pointerEvents.delete(e.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const n=this.state;n._active||(this.start(e),this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY];const r=n._movement;n._movement=[e.scale-1,e.rotation],n._delta=rs.sub(n._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(r=>e[r]):!e[n])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const r=this.state;r._delta=[-Ime(e)[1]/YQe*r.offset[0],0],rs.addTo(r._movement,r._delta),Ame(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const n=this.config.device;n&&(e(n,"start",this[n+"Start"].bind(this)),e(n,"change",this[n+"Move"].bind(this)),e(n,"end",this[n+"End"].bind(this)),e(n,"cancel",this[n+"End"].bind(this)),e("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const JQe=cr(cr({},_me),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!yl.touch&&yl.gesture)return"gesture";if(yl.touch&&r)return"touch";if(yl.touchscreen){if(yl.pointer)return"pointer";if(yl.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const i=o=>{const a=bQ(eP(n,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=bQ(eP(r,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",rs.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});cr(cr({},jS),{},{mouseOnly:(t=!0)=>t});class ZQe extends NQe{constructor(...e){super(...e),Ts(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const n=this.state;n._delta=Ime(e),rs.addTo(n._movement,n._delta),Ame(n),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const QQe=jS;cr(cr({},jS),{},{mouseOnly:(t=!0)=>t});const FU=new Map,n$=new Map;function eet(t){FU.set(t.key,t.engine),n$.set(t.key,t.resolver)}const tet={key:"pinch",engine:XQe,resolver:JQe},net={key:"wheel",engine:ZQe,resolver:QQe};function ret(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function iet(t,e){if(t==null)return{};var n=ret(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}const set={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=yl.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},oet=["target","eventOptions","window","enabled","transform"];function YE(t={},e){const n={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":n[r]=i.call(n,t[r],r,t);break;case"object":n[r]=YE(t[r],i);break;case"boolean":i&&(n[r]=t[r]);break}return n}function aet(t,e,n={}){const r=t,{target:i,eventOptions:s,window:o,enabled:a,transform:l}=r,c=iet(r,oet);if(n.shared=YE({target:i,eventOptions:s,window:o,enabled:a,transform:l},set),e){const u=n$.get(e);n[e]=YE(cr({shared:n.shared},c),u)}else for(const u in c){const d=n$.get(u);d&&(n[u]=YE(cr({shared:n.shared},c[u]),d))}return n}class Mme{constructor(e,n){Ts(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,r,i,s){const o=this._listeners,a=IQe(n,r),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=cr(cr({},l),s);e.addEventListener(a,i,c);const u=()=>{e.removeEventListener(a,i,c),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class cet{constructor(){Ts(this,"_timeouts",new Map)}add(e,n,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(n,r,...i))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class uet{constructor(e){Ts(this,"gestures",new Set),Ts(this,"_targetEventStore",new Mme(this)),Ts(this,"gestureEventStores",{}),Ts(this,"gestureTimeoutStores",{}),Ts(this,"handlers",{}),Ts(this,"config",{}),Ts(this,"pointerIds",new Set),Ts(this,"touchIds",new Set),Ts(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),det(this,e)}setEventIds(e){if(Tme(e))return this.touchIds=new Set(kQe(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=aet(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,r={};let i;if(!(n.target&&(i=n.target(),!i))){if(n.enabled){for(const o of this.gestures){const a=this.config[o],l=SQ(r,a.eventOptions,!!i);if(a.enabled){const c=FU.get(o);new c(this,e,o).bind(l)}}const s=SQ(r,n.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](cr(cr({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in r)r[s]=OQe(...r[s]);if(!i)return r;for(const s in r){const{device:o,capture:a,passive:l}=TQe(s);this._targetEventStore.add(i,o,"",r[s],{capture:a,passive:l})}}}}function _m(t,e){t.gestures.add(e),t.gestureEventStores[e]=new Mme(t,e),t.gestureTimeoutStores[e]=new cet}function det(t,e){e.drag&&_m(t,"drag"),e.wheel&&_m(t,"wheel"),e.scroll&&_m(t,"scroll"),e.move&&_m(t,"move"),e.pinch&&_m(t,"pinch"),e.hover&&_m(t,"hover")}const SQ=(t,e,n)=>(r,i,s,o={},a=!1)=>{var l,c;const u=(l=o.capture)!==null&&l!==void 0?l:e.capture,d=(c=o.passive)!==null&&c!==void 0?c:e.passive;let h=a?r:CQe(r,i,u);n&&d&&(h+="Passive"),t[h]=t[h]||[],t[h].push(s)},het=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function fet(t){const e={},n={},r=new Set;for(let i in t)het.test(i)?(r.add(RegExp.lastMatch),n[i]=t[i]):e[i]=t[i];return[n,e,r]}function km(t,e,n,r,i,s){if(!t.has(n)||!FU.has(r))return;const o=n+"Start",a=n+"End",l=c=>{let u;return c.first&&o in e&&e[o](c),n in e&&(u=e[n](c)),c.last&&a in e&&e[a](c),u};i[r]=l,s[r]=s[r]||{}}function pet(t,e){const[n,r,i]=fet(t),s={};return km(i,n,"onDrag","drag",s,e),km(i,n,"onWheel","wheel",s,e),km(i,n,"onScroll","scroll",s,e),km(i,n,"onPinch","pinch",s,e),km(i,n,"onMove","move",s,e),km(i,n,"onHover","hover",s,e),{handlers:s,config:e,nativeHandlers:r}}function get(t,e={},n,r){const i=$e.useMemo(()=>new uet(t),[]);if(i.applyHandlers(t,r),i.applyConfig(e,n),$e.useEffect(i.effect.bind(i)),$e.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function met(t){return t.forEach(eet),function(n,r){const{handlers:i,nativeHandlers:s,config:o}=pet(n,r||{});return get(i,o,void 0,s)}}const CQ=10,yet=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function Ome(t){let{deltaY:e,deltaX:n}=t,r=0;return t.ctrlKey||t.altKey||t.metaKey?r=(Math.abs(e)>CQ?CQ*Math.sign(e):e)/100:t.shiftKey&&!yet&&(n=e,e=0),{x:-n,y:-e,z:-r}}const vet=met([net,tet]);let Am;const bet=t=>Am===void 0?(Am=t,!1):t-Am>120&&t-Am<160?(Am=t,!0):(Am=t,!1);function xet(t){const e=re(),n=S.useMemo(()=>{let r="not sure";const i=({event:y})=>{if(!e.getInstanceState().isFocused||(r="not sure",bet(Date.now())))return;const b=e.getEditingShapeId();if(b){const C=e.getShape(b);if(C&&e.getShapeUtil(C).canScroll(C)){const I=e.getShapePageBounds(b);if(I!=null&&I.containsPoint(e.inputs.currentPagePoint))return}}St(y),tr(y);const v=Ome(y);if(v.x===0&&v.y===0)return;const x={type:"wheel",name:"wheel",delta:v,point:new M(y.clientX,y.clientY),shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey,metaKey:y.metaKey,accelKey:ni(y)};e.dispatch(x)};let s=1,o=1,a=0;const l=new M,c=new M,u=y=>{const b=t.current;r="not sure";const{event:v,origin:x,da:C}=y;v instanceof WheelEvent||(v.target===b||b!=null&&b.contains(v.target))&&(c.x=x[0],c.y=x[1],l.x=x[0],l.y=x[1],s=C[0],o=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:x[0],y:x[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:v.shiftKey,altKey:v.altKey,ctrlKey:v.metaKey||v.ctrlKey,metaKey:v.metaKey,accelKey:ni(v)}))},d=y=>{if(y&&(r="zooming"),r==="zooming")return;const b=Math.abs(a-s),v=M.Dist(l,c);switch(r){case"not sure":{b>24?r="zooming":v>16&&(r="panning");break}case"panning":{b>64&&(r="zooming");break}}};return{onWheel:i,onPinchStart:u,onPinchEnd:y=>{const b=t.current,{event:v,origin:x,offset:C}=y;if(v instanceof WheelEvent||!(v.target===b||b!=null&&b.contains(v.target)))return;const E=C[0]**e.getCameraOptions().zoomSpeed;r="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:x[0],y:x[1],z:E},delta:{x:x[0],y:x[1]},shiftKey:v.shiftKey,altKey:v.altKey,ctrlKey:v.metaKey||v.ctrlKey,metaKey:v.metaKey,accelKey:ni(v)})})},onPinch:y=>{const b=t.current,{event:v,origin:x,offset:C,da:E}=y;if(v instanceof WheelEvent||!(v.target===b||b!=null&&b.contains(v.target)))return;const I=y.type==="gesturechange"||y.type==="gestureend";a=E[0];const P=x[0]-c.x,_=x[1]-c.y;switch(c.x=x[0],c.y=x[1],d(I),r){case"zooming":{const A=C[0]**e.getCameraOptions().zoomSpeed;e.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:A},delta:{x:P,y:_},shiftKey:v.shiftKey,altKey:v.altKey,ctrlKey:v.metaKey||v.ctrlKey,metaKey:v.metaKey,accelKey:ni(v)});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:o},delta:{x:P,y:_},shiftKey:v.shiftKey,altKey:v.altKey,ctrlKey:v.metaKey||v.ctrlKey,metaKey:v.metaKey,accelKey:ni(v)});break}}}}},[e,t]);vet(n,{target:t,eventOptions:{passive:!1},pinch:{from:()=>{const{zoomSpeed:r}=e.getCameraOptions();return[e.getZoomLevel()**(1/r),0]},scaleBounds:()=>{const r=e.getBaseZoom(),{zoomSteps:i,zoomSpeed:s}=e.getCameraOptions(),o=i[0]*r;return{max:(i[i.length-1]*r)**(1/s),min:o**(1/s)}}}})}function zj(t,e,n){const r=t.getShape(e),i=t.getShapeHandles(r);return{shape:r,handle:i.find(s=>s.id===n)}}function wet(t,e){const n=re();return S.useMemo(()=>{const r=l=>{if(l.isKilled)return;const c=YI(l.currentTarget);PS(c,l);const{shape:u,handle:d}=zj(n,t,e);d&&n.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_down",...wa(l)})};let i,s;return{onPointerDown:r,onPointerMove:l=>{if(l.isKilled||l.clientX===i&&l.clientY===s)return;i=l.clientX,s=l.clientY;const{shape:c,handle:u}=zj(n,t,e);u&&n.dispatch({type:"pointer",target:"handle",handle:u,shape:c,name:"pointer_move",...wa(l)})},onPointerUp:l=>{if(l.isKilled)return;const c=YI(l.currentTarget);_S(c,l);const{shape:u,handle:d}=zj(n,t,e);d&&n.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_up",...wa(l)})}}},[n,t,e])}function Cet(t){const e=re();S.useLayoutEffect(()=>{const n=kue(()=>{t.current&&e.updateViewportScreenBounds(t.current)},200,{trailing:!0}),r=e.timers.setInterval(n,1e3);window.addEventListener("resize",n);const i=new ResizeObserver(a=>{a[0].contentRect&&n()}),s=t.current;let o=null;return s&&(i.observe(s),o=Eet(s),o.addEventListener("scroll",n)),()=>{clearInterval(r),window.removeEventListener("resize",n),i.disconnect(),o==null||o.removeEventListener("scroll",n),n.cancel()}},[e,t])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const Eet=t=>{let e=t.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:n}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(n==="auto"||n==="scroll"||n==="overlay"))return e;e=e.parentElement}return document};function Dme(t,e){return e===0?t:Dme(e,t%e)}function Rme(t){const e=t.toString().split(".")[1];if(!e)return 1;const n=Math.pow(10,e.length),r=parseInt(e,10);return n/Dme(r,n)}function Tet(t=!0){const[e,n]=S.useState(0),r=re();S.useEffect(()=>{if(!t)return;const i=()=>n(s=>s+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,t])}const Iet=Lr(function({showStroke:e=!0,showVertices:n=!0,showClosestPointOnOutline:r=!0}){const i=re();Tet(r);const s=i.getZoomLevel(),o=i.getRenderingShapes(),{inputs:{currentPagePoint:a}}=i;return g.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(l=>{const c=i.getShape(l.id);if(c.type==="group")return null;const u=i.getShapeGeometry(c),d=i.getShapePageTransform(c),h=i.getPointInShapeSpace(c,a),f=u.nearestPoint(h),y=u.distanceToPoint(h,!0),b=Math.abs(y)*s,v=y<0,{vertices:x}=u;return g.jsxs("g",{transform:d.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&g.jsx("g",{stroke:u.debugColor??"red",opacity:"1",strokeWidth:2/s,fill:"none",children:g.jsx(Nme,{geometry:u})}),n&&x.map((C,E)=>g.jsx("circle",{cx:C.x,cy:C.y,r:2/s,fill:`hsl(${yu(E,[0,x.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/s},`v${E}`)),r&&b<150&&g.jsx("line",{x1:f.x,y1:f.y,x2:h.x,y2:h.y,opacity:1-b/150,stroke:v?"goldenrod":"dodgerblue",strokeWidth:2/s})]},l.id+"_outline")})})});function Nme({geometry:t}){return t instanceof yo?g.jsx("g",{stroke:t.debugColor,children:[...t.children,...t.ignoredChildren].map((e,n)=>g.jsx(Nme,{geometry:e},n))}):g.jsx("path",{d:t.toSimpleSvgPath(),stroke:t.debugColor})}function jme(t){return $Ve(t)}function Lme(){const t=re(),e=YKe("userIds",()=>jme(t.getCollaborators().map(n=>n.userId)).sort(),{isEqual:(n,r)=>{var i;return n.join(",")===((i=r.join)==null?void 0:i.call(r,","))}},[t]);return ie(e)}function Kk(t){const e=re();return ie(`latestPresence:${t}`,()=>e.getCollaborators().find(r=>r.userId===t),[e,t])??null}const Pet=Lr(function(){return Lme().map(n=>g.jsx(_et,{collaboratorId:n},n))}),_et=Lr(function({collaboratorId:e}){const n=re(),r=Kk(e),i=Aet(n,r);if(!(r&&r.currentPageId===n.getCurrentPageId()))return null;switch(i){case"inactive":{const{followingUserId:s,highlightedUserIds:o}=n.getInstanceState();if(!(s===r.userId||o.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:s}=n.getInstanceState();if(r.followingUserId===n.user.getId()&&!(r.chatMessage||s.includes(r.userId)))return null;break}}return g.jsx(ket,{latestPresence:r})}),ket=Lr(function({latestPresence:e}){const n=re(),{CollaboratorBrush:r,CollaboratorScribble:i,CollaboratorCursor:s,CollaboratorHint:o,CollaboratorShapeIndicator:a}=Cn(),l=n.getZoomLevel(),c=n.getViewportPageBounds(),{userId:u,chatMessage:d,brush:h,scribbles:f,selectedShapeIds:y,userName:b,cursor:v,color:x}=e;if(!v)return null;const C=!(v.x<c.minX-12/l||v.y<c.minY-16/l||v.x>c.maxX-12/l||v.y>c.maxY-16/l);return g.jsxs(g.Fragment,{children:[h&&r?g.jsx(r,{className:"tl-collaborator__brush",userId:u,brush:h,color:x,opacity:.1},u+"_brush"):null,C&&s?g.jsx(s,{className:"tl-collaborator__cursor",userId:u,point:v,color:x,zoom:l,name:b!=="New User"?b:null,chatMessage:d??""},u+"_cursor"):o?g.jsx(o,{className:"tl-collaborator__cursor-hint",userId:u,point:v,color:x,zoom:l,viewport:c},u+"_cursor_hint"):null,i&&f.length?g.jsx(g.Fragment,{children:f.map(E=>g.jsx(i,{className:"tl-collaborator__scribble",userId:u,scribble:E,color:x,zoom:l,opacity:E.color==="laser"?.5:.1},u+"_scribble_"+E.id))}):null,a&&y.filter(E=>!n.isShapeHidden(E)).map(E=>g.jsx(a,{className:"tl-collaborator__shape-indicator",userId:u,shapeId:E,color:x,opacity:.5},u+"_"+E))]})});function EQ(t,e){return e>t.options.collaboratorInactiveTimeoutMs?"inactive":e>t.options.collaboratorIdleTimeoutMs?"idle":"active"}function Aet(t,e){const n=S.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[r,i]=S.useState(()=>EQ(t,Date.now()-n.current));return S.useEffect(()=>{const s=t.timers.setInterval(()=>{i(EQ(t,Date.now()-n.current))},t.options.collaboratorCheckIntervalMs);return()=>clearInterval(s)},[t]),e&&(n.current=e.lastActivityTimestamp??1/0),r}function Met(){const t=re(),e=ie("is menu open",()=>t.menus.hasAnyOpenMenus(),[t]),[n,r]=S.useState(!1),i=e||n,s=SU(),o=S.useRef({isDown:!1,isDragging:!1,start:new M}),a=S.useCallback(u=>{u.button===0&&(r(!0),o.current={isDown:!0,isDragging:!1,start:new M(u.clientX,u.clientY)}),t.menus.clearOpenMenus()},[t]),l=S.useCallback(u=>{var d,h,f;if(o.current.isDown){if(o.current.isDragging){(d=s.onPointerMove)==null||d.call(s,u);return}if(M.Dist2(o.current.start,new M(u.clientX,u.clientY))>t.options.dragDistanceSquared){o.current={...o.current,isDown:!0,isDragging:!0};const{x:y,y:b}=o.current.start;(h=s.onPointerDown)==null||h.call(s,{...u,clientX:y,clientY:b,button:0}),(f=s.onPointerMove)==null||f.call(s,u)}}},[s,t]),c=S.useCallback(u=>{var d;(d=s.onPointerUp)==null||d.call(s,u),r(!1),o.current={isDown:!1,isDragging:!1,start:new M(u.clientX,u.clientY)}},[s]);return i&&g.jsx("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...s,onPointerDown:a,onPointerMove:l,onPointerUp:c})}function Oet({className:t}){const e=re(),{SelectionBackground:n,Background:r,SvgDefs:i,ShapeIndicators:s}=Cn(),o=S.useRef(null),a=S.useRef(null),l=S.useRef(null),c=Fr();Cet(o),oYe(),sYe(),xet(o),mQe(o);const u=S.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});lg("position layers",function(){const{x:E,y:I,z:P}=e.getCamera();if(u.current.allowTextOutline&&sn.isSafari&&(c.style.setProperty("--tl-text-outline","none"),u.current.allowTextOutline=!1),u.current.allowTextOutline&&P<e.options.textShadowLod!==u.current.lodDisableTextOutline){const D=P<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",D?"none":"var(--tl-text-outline-reference)"),u.current.lodDisableTextOutline=D}const _=P>=1?yu(P,[1,8],[.125,.5],!0):yu(P,[.1,1],[-2,.125],!0),A=`scale(${te(P)}) translate(${te(E+_)}px,${te(I+_)}px)`;Ss(a.current,"transform",A),Ss(l.current,"transform",A)},[e,c]);const d=SU(),h=ie("shapeSvgDefs",()=>{const C=new Map;for(const E of yr(e.shapeUtils)){if(!E)return;const I=E.getCanvasSvgDefs();for(const{key:P,component:_}of I)C.has(P)||C.set(P,g.jsx(_,{},P))}return[...C.values()]},[e]),f=ie("debug_shapes",()=>Jn.hideShapes.get(),[Jn]),y=ie("debug_svg",()=>Jn.debugSvg.get(),[Jn]),b=ie("debug_geometry",()=>Jn.debugGeometry.get(),[Jn]),v=ie("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),x=ie("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return g.jsxs(g.Fragment,{children:[g.jsxs("div",{ref:o,draggable:!1,"data-iseditinganything":v,"data-isselectinganything":x,className:nt("tl-canvas",t),"data-testid":"canvas",...d,children:[g.jsx("svg",{className:"tl-svg-context","aria-hidden":"true",children:g.jsxs("defs",{children:[h,g.jsx(qet,{}),g.jsx(Get,{}),i&&g.jsx(i,{})]})}),r&&g.jsx("div",{className:"tl-background__wrapper",children:g.jsx(r,{})}),g.jsx(Ret,{}),g.jsxs("div",{ref:a,className:"tl-html-layer tl-shapes",draggable:!1,children:[g.jsx(Zet,{}),n&&g.jsx(Jet,{}),f?null:y?g.jsx(Het,{}):g.jsx(Wet,{})]}),g.jsx("div",{className:"tl-overlays",children:g.jsxs("div",{ref:l,className:"tl-html-layer",children:[b?g.jsx(Iet,{}):null,g.jsx(jet,{}),g.jsx(Net,{}),g.jsx(Let,{}),s&&g.jsx(s,{}),g.jsx(Ket,{}),g.jsx(Fet,{}),g.jsx(Xet,{}),g.jsx($et,{}),g.jsx(Uet,{}),g.jsx(Pet,{})]})}),g.jsx(Qet,{})]}),g.jsx(Met,{}),g.jsx(Det,{})]})}function Det(){const{InFrontOfTheCanvas:t}=Cn();return t?g.jsx(t,{}):null}function Ret(){const t=re(),e=ie("gridSize",()=>t.getDocumentSettings().gridSize,[t]),{x:n,y:r,z:i}=ie("camera",()=>t.getCamera(),[t]),s=ie("isGridMode",()=>t.getInstanceState().isGridMode,[t]),{Grid:o}=Cn();return o&&s?g.jsx(o,{x:n,y:r,z:i,size:e}):null}function Net(){const t=re(),e=ie("scribbles",()=>t.getInstanceState().scribbles,[t]),n=ie("zoomLevel",()=>t.getZoomLevel(),[t]),{Scribble:r}=Cn();return r&&e.length?e.map(i=>g.jsx(r,{className:"tl-user-scribble",scribble:i,zoom:n},i.id)):null}function jet(){const t=re(),e=ie("brush",()=>t.getInstanceState().brush,[t]),{Brush:n}=Cn();return n&&e?g.jsx(n,{className:"tl-user-brush",brush:e}):null}function Let(){const t=re(),e=ie("zoomBrush",()=>t.getInstanceState().zoomBrush,[t]),{ZoomBrush:n}=Cn();return n&&e?g.jsx(n,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function Fet(){const t=re(),e=ie("snapLines",()=>t.snaps.getIndicators(),[t]),n=ie("zoomLevel",()=>t.getZoomLevel(),[t]),{SnapIndicator:r}=Cn();return r&&e.length>0?e.map(i=>g.jsx(r,{className:"tl-user-snapline",line:i,zoom:n},i.id)):null}function $et(){const t=re(),e=ie("handles shapeIdWithHandles",()=>{const{isReadonly:n,isChangingStyle:r}=t.getInstanceState();if(n||r)return!1;const i=t.getOnlySelectedShape();return!i||!t.getShapeHandles(i)?!1:i.id},[t]);return e?g.jsx(Bet,{shapeId:e}):null}function Bet({shapeId:t}){const e=re(),{Handles:n}=Cn(),r=ie("zoomLevel",()=>e.getZoomLevel(),[e]),i=ie("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),s=ie("handles transform",()=>e.getShapePageTransform(t),[e,t]),o=ie("handles",()=>{const l=e.getShapeHandles(t);if(!l)return null;const c=(i?e.options.coarseHandleRadius:e.options.handleRadius)/r*2;return l.filter(u=>u.type!=="virtual"||!l.some(d=>d!==u&&d.type==="vertex"&&M.Dist(u,d)<c)).sort(u=>u.type==="vertex"?1:-1)},[e,r,i,t]),a=ie("isHidden",()=>e.isShapeHidden(t),[e,t]);return!n||!o||!s||a?null:g.jsx(n,{children:g.jsx("g",{transform:xe.toCssString(s),children:o.map(l=>g.jsx(zet,{shapeId:t,handle:l,zoom:r,isCoarse:i},l.id))})})}function zet({shapeId:t,handle:e,zoom:n,isCoarse:r}){const i=wet(t,e.id),{Handle:s}=Cn();return s?g.jsx("g",{role:"button","aria-label":e.label||"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:g.jsx(s,{shapeId:t,handle:e,zoom:n,isCoarse:r})}):null}function Uet(){const{Overlays:t}=Cn();return t?g.jsx("div",{className:"tl-custom-overlays tl-overlays__item",children:g.jsx(t,{})}):null}function Het(){const t=re(),e=ie("rendering shapes",()=>t.getRenderingShapes(),[t]),n=ie("dpr multiple",()=>Rme(Math.floor(t.getInstanceState().devicePixelRatio*100)/100),[t]);return e.map(r=>g.jsxs(S.Fragment,{children:[g.jsx(Ife,{...r,dprMultiple:n}),g.jsx(Yet,{id:r.id,mode:"iframe"})]},r.id+"_fragment"))}function Vet(){const t=re(),e=S.useRef(new Set);return lg("reflow for culled shapes",()=>{const n=t.getCulledShapes();if(e.current.size===n.size&&[...n].every(i=>e.current.has(i)))return;e.current=n;const r=document.getElementsByClassName("tl-canvas");r.length!==0&&r[0].offsetHeight},[t]),null}function Wet(){const t=re(),e=ie("rendering shapes",()=>t.getRenderingShapes(),[t]),n=ie("dpr multiple",()=>Rme(Math.floor(t.getInstanceState().devicePixelRatio*100)/100),[t]);return g.jsxs(g.Fragment,{children:[e.map(r=>g.jsx(Ife,{...r,dprMultiple:n},r.id+"_shape")),sn.isSafari&&g.jsx(Vet,{})]})}function Ket(){const t=re(),{ShapeIndicator:e}=Cn(),n=ie("hinting shape ids",()=>Tz(t.getHintingShapeIds()),[t]);return!n.length||!e?null:n.map(r=>g.jsx(e,{className:"tl-user-indicator__hint",shapeId:r},r+"_hinting"))}function qet(){return g.jsxs("g",{id:fc("cursor"),children:[g.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),g.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function Get(){const t=fc("cursor_hint");return g.jsx("path",{id:t,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function Yet({id:t,mode:e}){const n=re(),[r,i]=S.useState(null),s=ie("is in root",()=>{const o=n.getShape(t);return(o==null?void 0:o.parentId)===n.getCurrentPageId()},[n,t]);return S.useEffect(()=>{if(!s)return;let o=null;const a=Ma("shape to svg",async()=>{const l=Math.random();o=l;const u=n.isShapeOfType(t,"frame")?0:10;let d=n.getShapePageBounds(t);if(!d)return;d=d.clone().expandBy(u);const h=await n.getSvgString([t],{padding:u});if(o!==l||!h)return;const f=`data:image/svg+xml;utf8,${encodeURIComponent(h.svg)}`;i({src:f,bounds:d})});return()=>{o=null,a()}},[n,t,s]),!s||!r?null:e==="iframe"?g.jsx("iframe",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):g.jsx("img",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function Xet(){const t=re(),e=ie("selection rotation",function(){return t.getSelectionRotation()},[t]),n=ie("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionForeground:r}=Cn();return!n||!r?null:g.jsx(r,{bounds:n,rotation:e})}function Jet(){const t=re(),e=ie("selection rotation",()=>t.getSelectionRotation(),[t]),n=ie("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionBackground:r}=Cn();return!n||!r?null:g.jsx(r,{bounds:n,rotation:e})}function Zet(){const{OnTheCanvas:t}=Cn();return t?g.jsx(t,{}):null}function Qet(){const t=re(),e=ie("camera state",()=>t.getCameraState(),[t]);return g.jsx("div",{className:nt("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function of({children:t,className:e="",...n}){return g.jsx("div",{...n,className:nt("tl-html-container",e),children:t})}class XE{constructor(e){this.editor=e}}N(XE,"props"),N(XE,"migrations"),N(XE,"type");function qk(t,e,n={}){const{newPoint:r,handle:i,scaleX:s,scaleY:o}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=n;let d=t.props.w*s,h=t.props.h*o;const f=new M(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":{f.x=d-a;break}case"top":case"bottom":{f.x=(d-a)/2;break}default:f.x=0}d=a}}else if(f.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":{f.x=-d;break}default:f.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{f.y=h-c;break}case"right":case"left":{f.y=(h-c)/2;break}default:f.y=0}h=c}}else if(f.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{f.y=-h;break}default:f.y=-c}h=c}const{x:y,y:b}=f.rot(t.rotation).add(r);return{...t,x:y,y:b,props:{w:Math.min(l,d),h:Math.min(u,h)}}}class zv extends pc{getGeometry(e){return new bu({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,n){return qk(e,n)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,n,r){return{...n.props,w:At(e.props.w,n.props.w,r),h:At(e.props.h,n.props.h,r)}}}function Fme(t,{initialBounds:e,scaleX:n,scaleY:r,newPoint:i,handle:s}){let o;switch(s){case"bottom_left":case"bottom_right":case"top_left":case"top_right":{o=Math.max(.01,Math.max(Math.abs(n),Math.abs(r)));break}case"left":case"right":{o=Math.max(.01,Math.abs(n));break}case"bottom":case"top":{o=Math.max(.01,Math.abs(r));break}default:throw Yt(s)}const a=new M(0,0);n<0&&(a.x=-(e.width*o)),r<0&&(a.y=-(e.height*o));const{x:l,y:c}=M.Add(i,a.rot(t.rotation));return{x:l,y:c,props:{scale:o*t.props.scale}}}var rF;let ett=(rF=class extends Qe{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},N(rF,"id","idle"),rF);var iF;let ttt=(iF=class extends Qe{onPointerMove(e){const{editor:n}=this;if(n.inputs.isDragging){const{originPagePoint:r}=n.inputs,i=this.parent.shapeType,s=Sn(),o=n.markHistoryStoppingPoint(`creating_box:${s}`),a=Ba(r,n);if(this.editor.createShapes([{id:s,type:i,x:a.x,y:a.y,props:{w:1,h:1}}]),!n.getShape(s)){this.cancel();return}n.select(s);const c=this.parent;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:o,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:c.onCreate?u=>{var d;return(d=c.onCreate)==null?void 0:d.call(c,u)}:void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,n=this.parent.shapeType,r=Sn();this.editor.markHistoryStoppingPoint(`creating_box:${r}`),this.editor.createShapes([{id:r,type:n,x:e.x,y:e.y}]);const i=this.editor.getShape(r);if(!i){this.cancel();return}let{w:s,h:o}=i.props;const a=new M(s/2,o/2),l=this.editor.getShapeParentTransform(i);l&&a.rot(-l.rotation());let c=1;this.editor.user.getIsDynamicResizeMode()&&(c=1/this.editor.getZoomLevel(),s*=c,o*=c,a.mul(c));const u=ar(i),d=Ba(new M(i.x-a.x,i.y-a.y),this.editor);u.x=d.x,u.y=d.y,u.props.w=s,u.props.h=o,"scale"in i.props&&(u.props.scale=c),this.editor.updateShape(u),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},N(iF,"id","pointing"),iF);function Ba(t,e){const n=e.getInstanceState().isGridMode,r=e.getDocumentSettings().gridSize;return n?t.clone().snapToGrid(r):t.clone()}class r$ extends Qe{static children(){return[ett,ttt]}}N(r$,"id","box"),N(r$,"initial","idle");function ntt(t,e,n){const r=S.useRef(!1),i=S.useCallback(o=>{r.current=o,o?oo.addOpenMenu(t):oo.deleteOpenMenu(t),e==null||e(o)},[t,e]),s=ie("is menu open",()=>oo.getOpenMenus().includes(t),[t]);return S.useEffect(()=>(r.current&&(n==null||n("open-menu"),oo.addOpenMenu(t)),()=>{r.current&&(oo.deleteOpenMenu(t),oo.getOpenMenus().forEach(o=>{o.startsWith(t)&&(n==null||n("close-menu"),oo.deleteOpenMenu(o))}),r.current=!1)}),[t,n]),[s,i]}function FS(t){const e=re();return ie("isEditing",()=>e.getEditingShapeId()===t,[e,t])}function rtt(t){if(!t)throw Error("usePassThroughWheelEvents must be passed a ref");const e=Fr();S.useEffect(()=>{function n(i){if(i.isSpecialRedispatchedEvent)return;St(i);const s=e.querySelector(".tl-canvas");if(!s)return;const o=new PointerEvent(i.type,i);o.isSpecialRedispatchedEvent=!0,s.dispatchEvent(o)}const r=t.current;if(r)return r.addEventListener("mouseover",n,{passive:!1}),()=>{r.removeEventListener("mouseover",n)}},[e,t])}function Gc(t){const e=re();return S.useMemo(function(){const i=c=>{if(c.isKilled)return;if(c.button===vU){e.dispatch({type:"pointer",target:"selection",handle:t,name:"right_click",...wa(c)});return}if(c.button!==0)return;const u=YI(c.currentTarget);function d(){u.removeEventListener("pointerup",d),_S(u,c)}PS(u,c),u.addEventListener("pointerup",d),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:t,...wa(c)}),tr(c)};let s,o;function a(c){c.isKilled||c.button===0&&(c.clientX===s&&c.clientY===o||(s=c.clientX,o=c.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:t,...wa(c)})))}return{onPointerDown:i,onPointerMove:a,onPointerUp:c=>{c.isKilled||c.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:t,...wa(c)})}}},[e,t])}function itt(t){const[e,n]=S.useState(()=>({store:ZI(t),opts:t}));if(!Lue(e.opts,t)){const r={store:ZI(t),opts:t};return n(r),r.store}return e.store}const stt=20,ott=8;function Gk(t,e=stt){return Math.max(ott,Math.ceil(t/e))}class $me extends jf{constructor(n){super({...n,isFilled:!1,isClosed:!1});N(this,"_center");N(this,"_radius");N(this,"_start");N(this,"_end");N(this,"_largeArcFlag");N(this,"_sweepFlag");N(this,"_measure");N(this,"_angleStart");N(this,"_angleEnd");const{center:r,sweepFlag:i,largeArcFlag:s,start:o,end:a}=n;if(o.equals(a))throw Error("Arc must have different start and end points.");this._angleStart=M.Angle(r,o),this._angleEnd=M.Angle(r,a),this._radius=M.Dist(r,o),this._measure=YGe(this._angleStart,this._angleEnd,i,s),this._start=o,this._end=a,this._sweepFlag=i,this._largeArcFlag=s,this._center=r}nearestPoint(n){const{_center:r,_measure:i,_radius:s,_angleEnd:o,_angleStart:a,_start:l,_end:c}=this,u=AZ(i,a,o,r.angle(n));if(u<=0)return l;if(u>=1)return c;const d=M.Sub(n,r).uni().mul(s).add(r);let h,f=1/0,y;for(const b of[l,c,d])y=M.Dist2(n,b),y<f&&(h=b,f=y);if(!h)throw Error("nearest point not found");return h}hitTestLineSegment(n,r){const{_center:i,_radius:s,_measure:o,_angleStart:a,_angleEnd:l}=this,c=kS(n,r,i,s);return c===null?!1:c.some(u=>{const d=AZ(o,a,l,i.angle(u));return d>=0&&d<=1})}getVertices(){const{_center:n,_measure:r,length:i,_radius:s,_angleStart:o}=this,a=[];for(let l=0,c=Gk(Math.abs(i));l<c+1;l++){const u=l/c*r,d=o+u;a.push(yU(n,s,d))}return a}getSvgPathData(n=!0){const{_start:r,_end:i,_radius:s,_largeArcFlag:o,_sweepFlag:a}=this;return`${n?`M${r.toFixed()}`:""} A${s} ${s} 0 ${o} ${a} ${i.toFixed()}`}getLength(){return Math.abs(this._measure*this._radius)}}class tP extends jf{constructor(n){super({isClosed:!0,...n});N(this,"_center");N(this,"_radius");N(this,"_x");N(this,"_y");this.config=n;const{x:r=0,y:i=0,radius:s}=n;this._x=r,this._y=i,this._center=new M(s+r,s+i),this._radius=s}getBounds(){return new Ee(this._x,this._y,this._radius*2,this._radius*2)}getVertices(){const{_center:n,_radius:r}=this,i=Pn*r,s=[];for(let o=0,a=Gk(i);o<a;o++){const l=o/a*Pn;s.push(yU(n,r,l))}return s}nearestPoint(n){const{_center:r,_radius:i}=this;return r.equals(n)?M.AddXY(r,i,0):M.Sub(n,r).uni().mul(i).add(r)}hitTestLineSegment(n,r,i=0){const{_center:s,_radius:o}=this;return kS(n,r,s,o+i)!==null}getSvgPathData(){const{_center:n,_radius:r}=this;return`M${n.x+r},${n.y} a${r},${r} 0 1,0 ${r*2},0a${r},${r} 0 1,0 -${r*2},0`}}class $U extends AS{constructor(n){const{start:r,cp1:i,cp2:s,end:o}=n;super({...n,points:[r,o]});N(this,"_a");N(this,"_b");N(this,"_c");N(this,"_d");N(this,"_resolution");this._a=r,this._b=i,this._c=s,this._d=o,this._resolution=n.resolution??10}getVertices(){const n=[],{_a:r,_b:i,_c:s,_d:o}=this;for(let a=0,l=this._resolution;a<=l;a++){const c=a/l;n.push(new M((1-c)*(1-c)*(1-c)*r.x+3*((1-c)*(1-c))*c*i.x+3*(1-c)*(c*c)*s.x+c*c*c*o.x,(1-c)*(1-c)*(1-c)*r.y+3*((1-c)*(1-c))*c*i.y+3*(1-c)*(c*c)*s.y+c*c*c*o.y))}return n}nearestPoint(n){let r,i=1/0,s,o;for(const a of this.segments)o=a.nearestPoint(n),s=M.Dist2(o,n),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}getSvgPathData(n=!0){const{_a:r,_b:i,_c:s,_d:o}=this;return`${n?`M ${r.toFixed()} `:""} C${i.toFixed()} ${s.toFixed()} ${o.toFixed()}`}static GetAtT(n,r){const{_a:i,_b:s,_c:o,_d:a}=n;return new M((1-r)*(1-r)*(1-r)*i.x+3*((1-r)*(1-r))*r*s.x+3*(1-r)*(r*r)*o.x+r*r*r*a.x,(1-r)*(1-r)*(1-r)*i.y+3*((1-r)*(1-r))*r*s.y+3*(1-r)*(r*r)*o.y+r*r*r*a.y)}getLength(n,r=32){let i,s=this._a,o=0;for(let a=1;a<=r;a++)i=$U.GetAtT(this,a/r),o+=M.Dist(s,i),s=i;return o}}class att extends jf{constructor(n){super({...n,isClosed:!0});N(this,"_w");N(this,"_h");N(this,"_edges");this.config=n;const{width:r,height:i}=n;this._w=r,this._h=i}get edges(){if(!this._edges){const{vertices:n}=this;this._edges=[];for(let r=0,i=n.length;r<i;r++){const s=n[r],o=n[(r+1)%i];this._edges.push(new Vy({start:s,end:o}))}}return this._edges}getVertices(){const n=Math.max(1,this._w),r=Math.max(1,this._h),i=n/2,s=r/2,o=Math.pow(i-s,2)/Math.pow(i+s,2),a=un*(i+s)*(1+3*o/(10+Math.sqrt(4-3*o))),l=Gk(a),c=Pn/l,u=Math.cos(c),d=Math.sin(c);let h=0,f=1,y=0,b=1;const v=Array(l);for(let x=0;x<l;x++)v[x]=new M(Ct(i+i*f,0,n),Ct(s+s*h,0,r)),y=d*f+u*h,b=u*f-d*h,h=y,f=b;return v}nearestPoint(n){let r,i=1/0,s,o;for(const a of this.edges)o=a.nearestPoint(n),s=M.Dist2(o,n),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(n,r){return this.edges.some(i=>i.hitTestLineSegment(n,r))}getBounds(){return new Ee(0,0,this._w,this._h)}getLength(){const{_w:n,_h:r}=this,i=n/2,s=r/2,o=Math.max(0,i),a=Math.max(0,s);return WGe(o,a)}getSvgPathData(n=!1){const{_w:r,_h:i}=this,s=r/2,o=i/2,a=Math.max(0,s),l=Math.max(0,o);return`${n?`M${s-a},${o}`:""} a${a},${l},0,1,1,${a*2},0a${a},${l},0,1,1,-${a*2},0`}}function yn(t,e,n){var a;const r=new Set;for(const l of e){const c=t.getShape(l);if(!c)continue;r.add(c);const u=t.getShape(c.parentId);u&&r.add(u)}const i=new Map;for(const l of r){const c=t.getSortedChildIdsForParent(l);if(n!=null&&n.filter&&!n.filter(l))i.set(l,c);else{const u=ltt(t,l.id,c);u.length<c.length&&i.set(l,c.filter(d=>!u.includes(d)))}}const s=t.getCurrentPageShapesSorted().map(l=>l.id),o={};for(const[l,c]of i){const u=bt(c.map(f=>t.getShape(f))),{reparenting:d,remainingShapesToReparent:h}=ctt(t,u,(f,y)=>n!=null&&n.filter&&!n.filter(y)?!1:y.id!==l.id&&s.indexOf(y.id)<s.indexOf(f.id));if(d.forEach((f,y)=>{f.length!==0&&(o[y]||(o[y]={parentId:y,shapeIds:[]}),o[y].shapeIds.push(...f.map(b=>b.id)))}),h.size>0){const f=((a=t.findShapeAncestor(l,y=>t.isShapeOfType(y,"group")))==null?void 0:a.id)??t.getCurrentPageId();h.forEach(y=>{if(!o[f]){let b;const v=t.getSortedChildIdsForParent(f),x=v.indexOf(l.id);if(x>-1){const C=v[x+1],E=C?t.getShape(C).index:ac(l.index);b=By(l.index,E)}o[f]={parentId:f,shapeIds:[],index:b}}o[f].shapeIds.push(y.id)})}}t.run(()=>{Object.values(o).forEach(({parentId:l,shapeIds:c,index:u})=>{c.length!==0&&(c.sort((d,h)=>s.indexOf(d)<s.indexOf(h)?-1:1),t.reparentShapes(c,l,u))})})}function ltt(t,e,n){if(n.length===0)return Mr;const r=t.getShapePageBounds(e);if(!r)return Mr;const i=t.getShapeGeometry(e),o=t.getShapePageTransform(e).applyToPoints(i.vertices),a=t.getShapeMask(e),l=a?JI(a,o):o;return l?n.filter(c=>{const u=t.getShapePageBounds(c);if(!u||!r.includes(u))return!1;const d=t.getShapePageTransform(c).clone().invert().applyToPoints(l),h=t.getShapeGeometry(c);return BU(h,d)}):Mr}function BU(t,e){if(t instanceof yo)return t.children.some(a=>BU(a,e));const{vertices:n,center:r,isFilled:i,isEmptyLabel:s,isClosed:o}=t;if(s)return!1;if(n.some(a=>po(a,e)))return!0;if(o){if(i&&(po(r,e)||e.every(a=>po(a,n)))||afe(e,n))return!0}else if(LYe(e,n))return!0;return!1}function ctt(t,e,n){var c,u,d,h;const r=new Set(e),i=new Set;for(const f of e){const y=t.getShapeParent(f);y&&t.isShapeOfType(y,"group")&&(i.has(y)||i.add(y))}for(const f of i){const y=bt(t.getSortedChildIdsForParent(f).map(b=>t.getShape(b)));for(const b of y)r.delete(b);r.add(f)}const s=new Map,o=new Map,a=new Set(r),l=t.getCurrentPageShapesSorted().filter(f=>{var y,b;return((b=(y=t.getShapeUtil(f)).canReceiveNewChildrenOfType)==null?void 0:b.call(y,f,f.type))&&!a.has(f)});e:for(let f=l.length-1;f>=0;f--){const y=l[f],b=(c=t.findShapeAncestor(y,_=>t.isShapeOfType(_,"group")))==null?void 0:c.id,v=t.getShapeGeometry(y),x=t.getShapePageTransform(y),C=t.getShapeMask(y),E=x.applyToPoints(v.vertices),I=C?JI(C,E):E;if(!I)continue e;const P=[];t:for(const _ of a){if(y.id===_.id||n&&!n(_,y)||(s.has(_.id)||s.set(_.id,(u=t.findShapeAncestor(_,L=>t.isShapeOfType(L,"group")))==null?void 0:u.id),s.get(_.id)!==b)||t.findShapeAncestor(y,L=>_.id===L.id))continue t;const D=t.getShapePageTransform(_).clone().invert().applyToPoints(I);if(BU(t.getShapeGeometry(_),D)){if(!((h=(d=t.getShapeUtil(y)).canReceiveNewChildrenOfType)!=null&&h.call(d,y,_.type)))continue t;_.parentId!==y.id&&P.push(_),a.delete(_);continue t}}P.length&&o.set(y.id,P)}return{reparenting:o,remainingShapesToReparent:a}}function Wi(t){this.content=t}Wi.prototype={constructor:Wi,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return i==-1?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new Wi(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Wi(n)},addToStart:function(t,e){return new Wi([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Wi(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(s==-1?i.length:s,0,e,n),new Wi(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Wi.from(t),t.size?new Wi(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Wi.from(t),t.size?new Wi(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Wi.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Wi.from=function(t){if(t instanceof Wi)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Wi(e)};function Bme(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i==s){n+=i.nodeSize;continue}if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)n++;return n}if(i.content.size||s.content.size){let o=Bme(i.content,s.content,n+1);if(o!=null)return o}n+=i.nodeSize}}function zme(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=zme(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class Pe{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,s){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let s="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:s+=r),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new Pe(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let s=0,o=0;o<n;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),i+=a.nodeSize),o=l}return new Pe(r,i)}cutByIndex(e,n){return e==n?Pe.empty:e==0&&n==this.content.length?this:new Pe(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),s=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new Pe(i,s)}addToStart(e){return new Pe([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Pe(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return Bme(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return zme(this,e,n,r)}findIndex(e){if(e==0)return WC(0,e);if(e==this.size)return WC(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),s=r+i.nodeSize;if(s>=e)return s==e?WC(n+1,s):WC(n,r);r=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return Pe.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Pe(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Pe.empty;let n,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(n||(n=e.slice(0,i)),n[n.length-1]=s.withText(n[n.length-1].text+s.text)):n&&n.push(s)}return new Pe(n||e,r)}static from(e){if(!e)return Pe.empty;if(e instanceof Pe)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Pe([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Pe.empty=new Pe([],0);const Uj={index:0,offset:0};function WC(t,e){return Uj.index=t,Uj.offset=e,Uj}function nP(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!nP(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!nP(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let Tn=class i${constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(s)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&nP(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let i=r.create(n.attrs);return r.checkAttrs(i.attrs),i}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return i$.none;if(e instanceof i$)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}};Tn.none=[];class rP extends Error{}class We{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=Hme(this.content,e+this.openStart,n);return r&&new We(r,this.openStart,this.openEnd)}removeBetween(e,n){return new We(Ume(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return We.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new We(Pe.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new We(e,r,i)}}We.empty=new We(Pe.empty,0,0);function Ume(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(Ume(s.content,e-i-1,n-i-1)))}function Hme(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=Hme(o.content,e-s-1,n,o);return a&&t.replaceChild(i,o.copy(a))}function utt(t,e,n){if(n.openStart>t.depth)throw new rP("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new rP("Inconsistent open depths");return Vme(t,e,n,0)}function Vme(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=Vme(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Kp(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=dtt(n,t);return Kp(s,Kme(t,o,a,e,r))}else return Kp(s,iP(t,e,r))}function Wme(t,e){if(!e.type.compatibleContent(t.type))throw new rP("Cannot join "+e.type.name+" onto "+t.type.name)}function s$(t,e,n){let r=t.node(n);return Wme(r,e.node(n)),r}function Wp(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function ux(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(Wp(t.nodeAfter,r),s++));for(let a=s;a<o;a++)Wp(i.child(a),r);e&&e.depth==n&&e.textOffset&&Wp(e.nodeBefore,r)}function Kp(t,e){return t.type.checkContent(e),t.copy(e)}function Kme(t,e,n,r,i){let s=t.depth>i&&s$(t,e,i+1),o=r.depth>i&&s$(n,r,i+1),a=[];return ux(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(Wme(s,o),Wp(Kp(s,Kme(t,e,n,r,i+1)),a)):(s&&Wp(Kp(s,iP(t,e,i+1)),a),ux(e,n,i,a),o&&Wp(Kp(o,iP(n,r,i+1)),a)),ux(r,null,i,a),new Pe(a)}function iP(t,e,n){let r=[];if(ux(null,t,n,r),t.depth>n){let i=s$(t,e,n+1);Wp(Kp(i,iP(t,e,n+1)),r)}return ux(e,null,n,r),new Pe(r)}function dtt(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(Pe.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class dw{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Tn.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new sP(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,s=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new dw(n,r,s)}static resolveCached(e,n){let r=TQ.get(e);if(r)for(let s=0;s<r.elts.length;s++){let o=r.elts[s];if(o.pos==n)return o}else TQ.set(e,r=new htt);let i=r.elts[r.i]=dw.resolve(e,n);return r.i=(r.i+1)%ftt,i}}class htt{constructor(){this.elts=[],this.i=0}}const ftt=12,TQ=new WeakMap;class sP{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const ptt=Object.create(null);let gc=class o${constructor(e,n,r,i=Tn.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||Pe.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&nP(this.attrs,n||e.defaultAttrs||ptt)&&Tn.sameSet(this.marks,r||Tn.none)}copy(e=null){return e==this.content?this:new o$(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new o$(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return We.empty;let i=this.resolve(e),s=this.resolve(n),o=r?0:i.sharedDepth(n),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new We(c,i.depth-o,s.depth-o)}replace(e,n,r){return utt(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return dw.resolveCached(this,e)}resolveNoCache(e){return dw.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),qme(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=Pe.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Tn.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Tn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=Pe.fromJSON(e,n.content),s=e.nodeType(n.type).create(n.attrs,i,r);return s.type.checkAttrs(s.attrs),s}};gc.prototype.text=void 0;class oP extends gc{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):qme(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new oP(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new oP(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function qme(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class pg{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new gtt(e,n);if(r.next==null)return pg.empty;let i=Gme(r);r.next&&r.err("Unexpected trailing text");let s=Stt(wtt(i));return Ctt(s,r),s}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let s=n;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return Pe.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}pg.empty=new pg(!0);class gtt{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Gme(t){let e=[];do e.push(mtt(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function mtt(t){let e=[];do e.push(ytt(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function ytt(t){let e=xtt(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=vtt(t,e);else break;return e}function IQ(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function vtt(t,e){let n=IQ(t),r=n;return t.eat(",")&&(t.next!="}"?r=IQ(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function btt(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let o=n[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function xtt(t){if(t.eat("(")){let e=Gme(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=btt(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function wtt(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Yme(t,e){return e-t}function PQ(t,e){let n=[];return r(e),n.sort(Yme);function r(i){let s=t[i];if(s.length==1&&!s[0].term)return r(s[0].to);n.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&n.indexOf(l)==-1&&r(l)}}}function Stt(t){let e=Object.create(null);return n(PQ(t,0));function n(r){let i=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);PQ(t,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new pg(r.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(Yme);s.next.push({type:i[o][0],next:e[a.join(",")]||n(a)})}return s}}function Ctt(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Xme(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function Jme(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let s=t[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function Zme(t,e,n,r){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${n} of type ${i}`);for(let i in t){let s=t[i];s.validate&&s.validate(e[i])}}function Qme(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new Ttt(t,r,e[r]);return n}let _Q=class eye{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=Qme(e,r.attrs),this.defaultAttrs=Xme(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==pg.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Jme(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new gc(this,this.computeAttrs(e),Pe.from(n),Tn.setFrom(r))}createChecked(e=null,n,r){return n=Pe.from(n),this.checkContent(n),new gc(this,this.computeAttrs(e),n,Tn.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=Pe.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let i=this.contentMatch.matchFragment(n),s=i&&i.fillBefore(Pe.empty,!0);return s?new gc(this,e,n.append(s),Tn.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Zme(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Tn.none:e}static compile(e,n){let r=Object.create(null);e.forEach((s,o)=>r[s]=new eye(s,n,o));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function Ett(t,e,n){let r=n.split("|");return i=>{let s=i===null?"null":typeof i;if(r.indexOf(s)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${s}`)}}class Ttt{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?Ett(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Yk{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=Qme(e,i.attrs),this.excluded=null;let s=Xme(this.attrs);this.instance=s?new Tn(this,s):null}create(e=null){return!e&&this.instance?this.instance:new Tn(this,Jme(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new Yk(s,i++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){Zme(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class tye{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let i in e)n[i]=e[i];n.nodes=Wi.from(e.nodes),n.marks=Wi.from(e.marks||{}),this.nodes=_Q.compile(this.spec.nodes,this),this.marks=Yk.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=r[o]||(r[o]=pg.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?kQ(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:kQ(this,o.split(" "))}this.nodeFromJSON=i=>gc.fromJSON(this,i),this.markFromJSON=i=>Tn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof _Q){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new oP(r,r.defaultAttrs,e,Tn.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function kQ(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function Itt(t){return t.tag!=null}function Ptt(t){return t.style!=null}let gy=class a${constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(i=>{if(Itt(i))this.tags.push(i);else if(Ptt(i)){let s=/[^=]*/.exec(i.style)[0];r.indexOf(s)<0&&r.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,n={}){let r=new MQ(this,n,!1);return r.addAll(e,Tn.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new MQ(this,n,!0);return r.addAll(e,Tn.none,n.from,n.to),We.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(Att(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||n.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,n,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<s)break}n.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=OQ(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=OQ(o)),o.node||o.ignore||o.mark||(o.node=i)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new a$(e,a$.schemaRules(e)))}};const nye={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},_tt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},rye={ol:!0,ul:!0},hw=1,l$=2,dx=4;function AQ(t,e,n){return e!=null?(e?hw:0)|(e==="full"?l$:0):t&&t.whitespace=="pre"?hw|l$:n&~dx}class KC{constructor(e,n,r,i,s,o){this.type=e,this.attrs=n,this.marks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=Tn.none,this.match=s||(o&dx?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Pe.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&hw)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let n=Pe.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(Pe.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!nye.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class MQ{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let i=n.topNode,s,o=AQ(null,n.preserveWhitespace,0)|(r?dx:0);i?s=new KC(i.type,i.attrs,Tn.none,!0,n.topMatch||i.type.contentMatch,o):r?s=new KC(null,null,Tn.none,!0,null,o):s=new KC(e.schema.topNodeType,null,Tn.none,!0,null,o),this.nodes=[s],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,i=this.top,s=i.options&l$?"full":this.localPreserveWS||(i.options&hw)>0;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(s)s!=="full"?r=r.replace(/\r?\n|\r/g," "):r=r.replace(/\r\n?/g,`
`);else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let o=i.content[i.content.length-1],a=e.previousSibling;(!o||a&&a.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;rye.hasOwnProperty(o)&&this.parser.normalizeLists&&ktt(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:_tt.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(nye.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let d=l&&l.skip?n:this.readStyles(e,n);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=r.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,i){let s,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(s=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,r,i);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,n,r,i){let s=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,n);this.findAtPoint(e,s)}findPlace(e,n,r){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)n=this.enterInner(i[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(n=this.enterInner(s,null,n))}let i=this.findPlace(e,n,r);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=Tn.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):DQ(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,n,r,i){let s=this.findPlace(e.create(n),r,!1);return s&&(s=this.enterInner(e,n,r,!0,i)),s}enterInner(e,n,r,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=AQ(e,s,o.options);o.options&dx&&o.content.length==0&&(a|=dx);let l=Tn.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):DQ(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new KC(e,n,l,i,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=hw)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function ktt(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&rye.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function Att(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function OQ(t){let e={};for(let n in t)e[n]=t[n];return e}function DQ(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}class Wg{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=Hj(n).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=JE(Hj(n),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,n);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&JE(Hj(r),i(e,n),null,e.attrs)}static renderSpec(e,n,r=null,i){return JE(e,n,r,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Wg(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=RQ(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return RQ(e.marks)}}function RQ(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Hj(t){return t.document||window.document}const NQ=new WeakMap;function Mtt(t){let e=NQ.get(t);return e===void 0&&NQ.set(t,e=Ott(t)),e}function Ott(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let i=0;i<r.length;i++)n(r[i]);else for(let i in r)n(r[i])}return n(t),e}function JE(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(s=Mtt(r))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(n=i.slice(0,o),i=i.slice(o+1));let a,l=n?t.createElementNS(n,i):t.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let h=d.indexOf(" ");h>0?l.setAttributeNS(d.slice(0,h),d.slice(h+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let h=e[d];if(h===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:y}=JE(t,h,n,r);if(l.appendChild(f),y){if(a)throw new RangeError("Multiple content holes");a=y}}}return{dom:l,contentDOM:a}}const iye=65535,sye=Math.pow(2,16);function Dtt(t,e){return t+e*sye}function jQ(t){return t&iye}function Rtt(t){return(t-(t&iye))/sye}const oye=1,aye=2,ZE=4,lye=8;class c${constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&lye)>0}get deletedBefore(){return(this.delInfo&(oye|ZE))>0}get deletedAfter(){return(this.delInfo&(aye|ZE))>0}get deletedAcross(){return(this.delInfo&ZE)>0}}class ya{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ya.empty)return ya.empty}recover(e){let n=0,r=jQ(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+Rtt(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:n:n,f=l+i+(h<0?0:u);if(r)return f;let y=e==(n<0?l:d)?null:Dtt(a/3,e-l),b=e==l?aye:e==d?oye:ZE;return(n<0?e!=l:e!=d)&&(b|=lye),new c$(f,b,y)}i+=u-c}return r?e+i:new c$(e+i,0,null)}touches(e,n){let r=0,i=jQ(n),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+n],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new ya(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ya.empty:new ya(e<0?[0,-e,0]:[0,0,e])}}ya.empty=new ya([]);let cye=class u${constructor(e,n,r=0,i=e?e.length:0){this.mirror=n,this.from=r,this.to=i,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new u$(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let i=e.getMirror(n);this.appendMap(e._maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e._maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new u$;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new c$(e,i,null)}};const Vj=Object.create(null);class Ks{getMap(){return ya.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Vj[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Vj)throw new RangeError("Duplicate use of step JSON ID "+e);return Vj[e]=n,n.prototype.jsonID=e,n}}class qr{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new qr(e,null)}static fail(e){return new qr(null,e)}static fromReplace(e,n,r,i){try{return qr.ok(e.replace(n,r,i))}catch(s){if(s instanceof rP)return qr.fail(s.message);throw s}}}function zU(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(zU(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return Pe.fromArray(r)}class qh extends Ks{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new We(zU(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),n.openStart,n.openEnd);return qr.fromReplace(e,this.from,this.to,s)}invert(){return new iu(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new qh(n.pos,r.pos,this.mark)}merge(e){return e instanceof qh&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new qh(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new qh(n.from,n.to,e.markFromJSON(n.mark))}}Ks.jsonID("addMark",qh);class iu extends Ks{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new We(zU(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return qr.fromReplace(e,this.from,this.to,r)}invert(){return new qh(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new iu(n.pos,r.pos,this.mark)}merge(e){return e instanceof iu&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new iu(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new iu(n.from,n.to,e.markFromJSON(n.mark))}}Ks.jsonID("removeMark",iu);class Gh extends Ks{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return qr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return qr.fromReplace(e,this.pos,this.pos+1,new We(Pe.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new Gh(this.pos,n.marks[i]);return new Gh(this.pos,this.mark)}}return new gg(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Gh(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Gh(n.pos,e.markFromJSON(n.mark))}}Ks.jsonID("addNodeMark",Gh);class gg extends Ks{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return qr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return qr.fromReplace(e,this.pos,this.pos+1,new We(Pe.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Gh(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new gg(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new gg(n.pos,e.markFromJSON(n.mark))}}Ks.jsonID("removeNodeMark",gg);class xi extends Ks{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&d$(e,this.from,this.to)?qr.fail("Structure replace would overwrite content"):qr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ya([this.from,this.to-this.from,this.slice.size])}invert(e){return new xi(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new xi(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof xi)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?We.empty:new We(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new xi(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?We.empty:new We(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new xi(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new xi(n.from,n.to,We.fromJSON(e,n.slice),!!n.structure)}}Ks.jsonID("replace",xi);class Ii extends Ks{constructor(e,n,r,i,s,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(d$(e,this.from,this.gapFrom)||d$(e,this.gapTo,this.to)))return qr.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return qr.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?qr.fromReplace(e,this.from,this.to,r):qr.fail("Content does not fit in gap")}getMap(){return new ya([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Ii(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||s>r.pos?null:new Ii(n.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ii(n.from,n.to,n.gapFrom,n.gapTo,We.fromJSON(e,n.slice),n.insert,!!n.structure)}}Ks.jsonID("replaceAround",Ii);function d$(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function Ntt(t,e,n,r){let i=[],s=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!r.isInSet(d)&&u.type.allowsMarkType(r.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,n),y=r.addToSet(d);for(let b=0;b<d.length;b++)d[b].isInSet(y)||(o&&o.to==h&&o.mark.eq(d[b])?o.to=f:i.push(o=new iu(h,f,d[b])));a&&a.to==h?a.to=f:s.push(a=new qh(h,f,r))}}),i.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function jtt(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof Yk){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let y=i[f];y.step==s-1&&d.eq(i[f].style)&&(h=y)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>t.step(new iu(o.from,o.to,o.style)))}function UU(t,e,n,r=n.contentMatch,i=!0){let s=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=r.matchType(c.type);if(!d)o.push(new xi(a,u,We.empty));else{r=d;for(let h=0;h<c.marks.length;h++)n.allowsMarkType(c.marks[h].type)||t.step(new iu(a,u,c.marks[h]));if(i&&c.isText&&n.whitespace!="pre"){let h,f=/\r?\n|\r/g,y;for(;h=f.exec(c.text);)y||(y=new We(Pe.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new xi(a+h.index,a+h.index+h[0].length,y))}}a=u}if(!r.validEnd){let l=r.fillBefore(Pe.empty,!0);t.replace(a,a,new We(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function Ltt(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Uv(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let i=t.$from.node(r),s=t.$from.index(r),o=t.$to.indexAfter(r);if(r<t.depth&&i.canReplace(s,o,n))return r;if(r==0||i.type.spec.isolating||!Ltt(i,s,o))break}return null}function Ftt(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=Pe.empty,d=0;for(let y=s,b=!1;y>n;y--)b||r.index(y)>0?(b=!0,u=Pe.from(r.node(y).copy(u)),d++):l--;let h=Pe.empty,f=0;for(let y=s,b=!1;y>n;y--)b||i.after(y+1)<i.end(y)?(b=!0,h=Pe.from(i.node(y).copy(h)),f++):c++;t.step(new Ii(l,c,o,a,new We(u.append(h),d,f),u.size-d,!0))}function HU(t,e,n=null,r=t){let i=$tt(t,e),s=i&&Btt(r,e);return s?i.map(LQ).concat({type:e,attrs:n}).concat(s.map(LQ)):null}function LQ(t){return{type:t,attrs:null}}function $tt(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function Btt(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function ztt(t,e,n){let r=Pe.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=Pe.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new Ii(i,s,i,s,new We(r,0,0),n.length,!0))}function Utt(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(r,l)&&Htt(t.doc,t.mapping.slice(s).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let f=r.whitespace=="pre",y=!!r.contentMatch.matchType(r.schema.linebreakReplacement);f&&!y?c=!1:!f&&y&&(c=!0)}c===!1&&dye(t,o,a,s),UU(t,t.mapping.slice(s).map(a,1),r,void 0,c===null);let u=t.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return t.step(new Ii(d,h,d+1,h-1,new We(Pe.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&uye(t,o,a,s),!1}})}function uye(t,e,n,r){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=t.mapping.slice(r).map(n+1+s+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function dye(t,e,n,r){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+s);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function Htt(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function Vtt(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Ii(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new We(Pe.from(o),0,0),1,!0))}function fd(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=n-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),y=r&&r[u+1];y&&(f=f.replaceChild(0,y.type.create(y.attrs)));let b=r&&r[u]||d;if(!d.canReplace(h+1,d.childCount)||!b.type.validContent(f))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function Wtt(t,e,n=1,r){let i=t.doc.resolve(e),s=Pe.empty,o=Pe.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=Pe.from(i.node(a).copy(s));let u=r&&r[c];o=Pe.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}t.step(new xi(e,e,new We(s.append(o),n,n),!0))}function Lf(t,e){let n=t.resolve(e),r=n.index();return hye(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function Ktt(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==r?t.type.schema.nodes.text:s.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(s.marks))return!1}return n.validEnd}function hye(t,e){return!!(t&&e&&!t.isLeaf&&Ktt(t,e))}function Xk(t,e,n=-1){let r=t.resolve(e);for(let i=r.depth;;i--){let s,o,a=r.index(i);if(i==r.depth?(s=r.nodeBefore,o=r.nodeAfter):n>0?(s=r.node(i+1),a++,o=r.node(i).maybeChild(a)):(s=r.node(i).maybeChild(a-1),o=r.node(i+1)),s&&!s.isTextblock&&hye(s,o)&&r.node(i).canReplace(a,a+1))return e;if(i==0)break;e=n<0?r.before(i):r.after(i)}}function qtt(t,e,n){let r=null,{linebreakReplacement:i}=t.doc.type.schema,s=t.doc.resolve(e-n),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?r=!1:!u&&d&&(r=!0)}let a=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);dye(t,u.node(),u.before(),a)}o.inlineContent&&UU(t,e+n-1,o,s.node().contentMatchAt(s.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new xi(c,l.map(e+n,-1),We.empty,!0)),r===!0){let u=t.doc.resolve(c);uye(t,u.node(),u.before(),t.steps.length)}return t}function Gtt(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,n))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,n))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function fye(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let d=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function Jk(t,e,n=e,r=We.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return pye(i,s,r)?new xi(e,n,r):new Ytt(i,s,r).fit()}function pye(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class Ytt{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=Pe.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Pe.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new We(s,o,a);return e>-1?new Ii(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new xi(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let s=n.firstChild;if(n.childCount>1&&(i=0),s.type.spec.isolating&&i<=r){e=r;break}n=s.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let i,s=null;r?(s=Wj(this.unplaced.content,r-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(n==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Pe.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:r,frontierDepth:a,parent:s,inject:d};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=Wj(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new We(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=Wj(e,n);if(i.childCount<=1&&n>0){let s=e.size-n<=n+i.size;this.unplaced=new We(Ob(e,n-1,1),n-1,s?n-1:r)}else this.unplaced=new We(Ob(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:s}){for(;this.depth>n;)this.closeFrontierNode();if(s)for(let b=0;b<s.length;b++)this.openFrontierNode(s[b]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[n];if(i){for(let b=0;b<i.childCount;b++)u.push(i.child(b));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let b=a.child(c),v=d.matchType(b.type);if(!v)break;c++,(c>1||l==0||b.content.size)&&(d=v,u.push(gye(b.mark(h.allowedMarks(b.marks)),c==1?l:0,c==a.childCount?f:-1)))}let y=c==a.childCount;y||(f=-1),this.placed=Db(this.placed,n,Pe.from(u)),this.frontier[n].match=d,y&&f<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let b=0,v=a;b<f;b++){let x=v.lastChild;this.frontier.push({type:x.type,match:x.contentMatchAt(x.childCount)}),v=x.content}this.unplaced=y?e==0?We.empty:new We(Ob(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new We(Ob(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!Kj(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],s=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=Kj(e,n,i,r,s);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=Kj(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:s?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Db(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Db(this.placed,this.depth,Pe.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Pe.empty,!0);n.childCount&&(this.placed=Db(this.placed,this.frontier.length,n))}}function Ob(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Ob(t.firstChild.content,e-1,n)))}function Db(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Db(t.lastChild.content,e-1,n)))}function Wj(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function gye(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,gye(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Pe.empty,!0)))),t.copy(r)}function Kj(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!Xtt(n,s.content,o)?a:null}function Xtt(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function Jtt(t){return t.spec.defining||t.spec.definingForContent}function Ztt(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if(pye(i,s,r))return t.step(new xi(e,n,r));let o=yye(i,t.doc.resolve(n));o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let y=i.node(h).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=r.openStart;for(let h=r.content,f=0;;f++){let y=h.firstChild;if(c.push(y),f==r.openStart)break;h=y.content}for(let h=u-1;h>=0;h--){let f=c[h],y=Jtt(f.type);if(y&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(y||!f.type.isTextblock)break}for(let h=r.openStart;h>=0;h--){let f=(h+u+1)%(r.openStart+1),y=c[f];if(y)for(let b=0;b<o.length;b++){let v=o[(b+l)%o.length],x=!0;v<0&&(x=!1,v=-v);let C=i.node(v-1),E=i.index(v-1);if(C.canReplaceWith(E,E,y.type,y.marks))return t.replace(i.before(v),x?s.after(v):n,new We(mye(r.content,0,r.openStart,f),f,r.openEnd))}}let d=t.steps.length;for(let h=o.length-1;h>=0&&(t.replace(e,n,r),!(t.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),n=s.after(f))}}function mye(t,e,n,r,i){if(e<n){let s=t.firstChild;t=t.replaceChild(0,s.copy(mye(s.content,e+1,n,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(Pe.empty,!0))}return t}function Qtt(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=Gtt(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new We(Pe.from(r),0,0))}function ent(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=yye(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o&&r.start(o-1)==i.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),i.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function yye(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let s=t.start(i);if(s<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&n.push(i)}return n}class my extends Ks{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return qr.fail("No node at attribute step's position");let r=Object.create(null);for(let s in n.attrs)r[s]=n.attrs[s];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return qr.fromReplace(e,this.pos,this.pos+1,new We(Pe.from(i),0,n.isLeaf?0:1))}getMap(){return ya.empty}invert(e){return new my(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new my(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new my(n.pos,n.attr,n.value)}}Ks.jsonID("attr",my);class fw extends Ks{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let i in e.attrs)n[i]=e.attrs[i];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return qr.ok(r)}getMap(){return ya.empty}invert(e){return new fw(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new fw(n.attr,n.value)}}Ks.jsonID("docAttr",fw);let Ky=class extends Error{};Ky=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Ky.prototype=Object.create(Error.prototype);Ky.prototype.constructor=Ky;Ky.prototype.name="TransformError";class vye{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new cye}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Ky(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=We.empty){let i=Jk(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new We(Pe.from(r),0,0))}delete(e,n){return this.replace(e,n,We.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return Ztt(this,e,n,r),this}replaceRangeWith(e,n,r){return Qtt(this,e,n,r),this}deleteRange(e,n){return ent(this,e,n),this}lift(e,n){return Ftt(this,e,n),this}join(e,n=1){return qtt(this,e,n),this}wrap(e,n){return ztt(this,e,n),this}setBlockType(e,n=e,r,i=null){return Utt(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i){return Vtt(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new my(e,n,r)),this}setDocAttribute(e,n){return this.step(new fw(e,n)),this}addNodeMark(e,n){return this.step(new Gh(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof Tn)n.isInSet(r.marks)&&this.step(new gg(e,n));else{let i=r.marks,s,o=[];for(;s=n.isInSet(i);)o.push(new gg(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return Wtt(this,e,n,r),this}addMark(e,n,r){return Ntt(this,e,n,r),this}removeMark(e,n,r){return jtt(this,e,n,r),this}clearIncompatible(e,n,r){return UU(this,e,n,r),this}}const qj=Object.create(null);class $t{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new tnt(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=We.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?We.empty:n),a==0&&BQ(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),BQ(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new Ot(e):Hm(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=n<0?Hm(e.node(0),e.node(s),e.before(s+1),e.index(s),n,r):Hm(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Ra(e.node(0))}static atStart(e){return Hm(e,e,0,0,1)||new Ra(e)}static atEnd(e){return Hm(e,e,e.content.size,e.childCount,-1)||new Ra(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=qj[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in qj)throw new RangeError("Duplicate use of selection JSON ID "+e);return qj[e]=n,n.prototype.jsonID=e,n}getBookmark(){return Ot.between(this.$anchor,this.$head).getBookmark()}}$t.prototype.visible=!0;class tnt{constructor(e,n){this.$from=e,this.$to=n}}let FQ=!1;function $Q(t){!FQ&&!t.parent.inlineContent&&(FQ=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class Ot extends $t{constructor(e,n=e){$Q(e),$Q(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return $t.near(r);let i=e.resolve(n.map(this.anchor));return new Ot(i.parent.inlineContent?i:r,r)}replace(e,n=We.empty){if(super.replace(e,n),n==We.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof Ot&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Zk(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Ot(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let s=$t.findFrom(n,r,!0)||$t.findFrom(n,-r,!0);if(s)n=s.$head;else return $t.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=($t.findFrom(e,-r,!0)||$t.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new Ot(e,n)}}$t.jsonID("text",Ot);class Zk{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Zk(e.map(this.anchor),e.map(this.head))}resolve(e){return Ot.between(e.resolve(this.anchor),e.resolve(this.head))}}class dt extends $t{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),s=e.resolve(i);return r?$t.near(s):new dt(s)}content(){return new We(Pe.from(this.node),0,0)}eq(e){return e instanceof dt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new VU(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new dt(e.resolve(n.anchor))}static create(e,n){return new dt(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}dt.prototype.visible=!1;$t.jsonID("node",dt);class VU{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Zk(r,r):new VU(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&dt.isSelectable(r)?new dt(n):$t.near(n)}}class Ra extends $t{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=We.empty){if(n==We.empty){e.delete(0,e.doc.content.size);let r=$t.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ra(e)}map(e){return new Ra(e)}eq(e){return e instanceof Ra}getBookmark(){return nnt}}$t.jsonID("all",Ra);const nnt={map(){return this},resolve(t){return new Ra(t)}};function Hm(t,e,n,r,i,s=!1){if(e.inlineContent)return Ot.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&dt.isSelectable(a))return dt.create(t,n-(i<0?a.nodeSize:0))}else{let l=Hm(t,a,n+i,i<0?a.childCount:0,i,s);if(l)return l}n+=a.nodeSize*i}return null}function BQ(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof xi||i instanceof Ii))return;let s=t.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection($t.near(t.doc.resolve(o),n))}const zQ=1,qC=2,UQ=4;class rnt extends vye{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|zQ)&~qC,this.storedMarks=null,this}get selectionSet(){return(this.updated&zQ)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=qC,this}ensureMarks(e){return Tn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&qC)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~qC,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Tn.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),r=r??n,!e)return this.deleteRange(n,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(n);s=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,s)),this.selection.empty||this.setSelection($t.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=UQ,this}get scrolledIntoView(){return(this.updated&UQ)>0}}function HQ(t,e){return!e||!t?t:t.bind(e)}class Rb{constructor(e,n,r){this.name=e,this.init=HQ(n.init,r),this.apply=HQ(n.apply,r)}}const int=[new Rb("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Rb("selection",{init(t,e){return t.selection||$t.atStart(e.doc)},apply(t){return t.selection}}),new Rb("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Rb("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class Gj{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=int.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Rb(r.key,r.spec.state,r))})}}class ty{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let d=0;d<this.config.plugins.length;d++)i.push(d<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:n.length})}}if(!s)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new ty(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];n[s.name]=s.apply(e,this[s.name],this,n)}return n}get tr(){return new rnt(this)}static create(e){let n=new Gj(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new ty(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new Gj(this.schema,e.plugins),r=n.fields,i=new ty(n);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(n[r]=s.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new Gj(e.schema,e.plugins),s=new ty(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=gc.fromJSON(e.schema,n.doc);else if(o.name=="selection")s.selection=$t.fromJSON(s.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(s.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){s[o.name]=c.fromJSON.call(l,e,n[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function bye(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=bye(i,e,{})),n[r]=i}return n}class ls{constructor(e){this.spec=e,this.props={},e.props&&bye(e.props,this,this.props),this.key=e.key?e.key.key:xye("plugin")}getState(e){return e[this.key]}}const Yj=Object.create(null);function xye(t){return t in Yj?t+"$"+ ++Yj[t]:(Yj[t]=0,t+"$")}class Wa{constructor(e="key"){this.key=xye(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Zi=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},qy=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let h$=null;const Zu=function(t,e,n){let r=h$||(h$=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},snt=function(){h$=null},mg=function(t,e,n,r){return n&&(VQ(t,e,n,r,-1)||VQ(t,e,n,r,1))},ont=/^(img|br|input|textarea|hr)$/i;function VQ(t,e,n,r,i){for(var s;;){if(t==n&&e==r)return!0;if(e==(i<0?0:bl(t))){let o=t.parentNode;if(!o||o.nodeType!=1||$S(t)||ont.test(t.nodeName)||t.contentEditable=="false")return!1;e=Zi(t)+(i<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((s=o.pmViewDesc)===null||s===void 0)&&s.ignoreForSelection)e+=i;else return!1;else t=o,e=i<0?bl(t):0}else return!1}}function bl(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function ant(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=bl(t)}else if(t.parentNode&&!$S(t))e=Zi(t),t=t.parentNode;else return null}}function lnt(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!$S(t))e=Zi(t)+1,t=t.parentNode;else return null}}function cnt(t,e,n){for(let r=e==0,i=e==bl(t);r||i;){if(t==n)return!0;let s=Zi(t);if(t=t.parentNode,!t)return!1;r=r&&s==0,i=i&&s==bl(t)}}function $S(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Qk=function(t){return t.focusNode&&mg(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Sp(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function unt(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function dnt(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(bl(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(bl(r.startContainer),r.startOffset)}}}const xu=typeof navigator<"u"?navigator:null,WQ=typeof document<"u"?document:null,Ff=xu&&xu.userAgent||"",f$=/Edge\/(\d+)/.exec(Ff),wye=/MSIE \d/.exec(Ff),p$=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ff),Qo=!!(wye||p$||f$),af=wye?document.documentMode:p$?+p$[1]:f$?+f$[1]:0,wc=!Qo&&/gecko\/(\d+)/i.test(Ff);wc&&+(/Firefox\/(\d+)/.exec(Ff)||[0,0])[1];const g$=!Qo&&/Chrome\/(\d+)/.exec(Ff),Os=!!g$,Sye=g$?+g$[1]:0,vo=!Qo&&!!xu&&/Apple Computer/.test(xu.vendor),Gy=vo&&(/Mobile\/\w+/.test(Ff)||!!xu&&xu.maxTouchPoints>2),gl=Gy||(xu?/Mac/.test(xu.platform):!1),hnt=xu?/Win/.test(xu.platform):!1,od=/Android \d/.test(Ff),BS=!!WQ&&"webkitFontSmoothing"in WQ.documentElement.style,fnt=BS?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function pnt(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Wu(t,e){return typeof t=="number"?t:t[e]}function gnt(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function KQ(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=qy(o);continue}let a=o,l=a==s.body,c=l?pnt(s):gnt(a),u=0,d=0;if(e.top<c.top+Wu(r,"top")?d=-(c.top-e.top+Wu(i,"top")):e.bottom>c.bottom-Wu(r,"bottom")&&(d=e.bottom-e.top>c.bottom-c.top?e.top+Wu(i,"top")-c.top:e.bottom-c.bottom+Wu(i,"bottom")),e.left<c.left+Wu(r,"left")?u=-(c.left-e.left+Wu(i,"left")):e.right>c.right-Wu(r,"right")&&(u=e.right-c.right+Wu(i,"right")),u||d)if(l)s.defaultView.scrollBy(u,d);else{let f=a.scrollLeft,y=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let b=a.scrollLeft-f,v=a.scrollTop-y;e={left:e.left-b,top:e.top-v,right:e.right-b,bottom:e.bottom-v}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:qy(o)}}function mnt(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:Cye(t.dom)}}function Cye(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=qy(r));return e}function ynt({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;Eye(n,r==0?0:r-e)}function Eye(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let Mm=null;function vnt(t){if(t.setActive)return t.setActive();if(Mm)return t.focus(Mm);let e=Cye(t);t.focus(Mm==null?{get preventScroll(){return Mm={preventScroll:!0},!0}}:void 0),Mm||(Mm=!1,Eye(e,0))}function Tye(t,e){let n,r=2e8,i,s=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,d=0;u;u=u.nextSibling,d++){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=Zu(u).getClientRects();else continue;for(let f=0;f<h.length;f++){let y=h[f];if(y.top<=o&&y.bottom>=a){o=Math.max(y.bottom,o),a=Math.min(y.top,a);let b=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(b<r){n=u,r=b,i=b&&n.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,u.nodeType==1&&b&&(s=d+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!l&&y.left<=e.left&&y.right>=e.left&&(l=u,c={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!n&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(s=d+1)}}return!n&&l&&(n=l,i=c,r=0),n&&n.nodeType==3?bnt(n,i):!n||r&&n.nodeType==1?{node:t,offset:s}:Tye(n,i)}function bnt(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let s=_h(r,1);if(s.top!=s.bottom&&WU(e,s))return{node:t,offset:i+(e.left>=(s.left+s.right)/2?1:0)}}return{node:t,offset:0}}function WU(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function xnt(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function wnt(t,e,n){let{node:r,offset:i}=Tye(e,n),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function Snt(t,e,n,r){let i=-1;for(let s=e,o=!1;s!=t.dom;){let a=t.docView.nearestDesc(s,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?i=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;s=a.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}function Iye(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(WU(e,c))return Iye(o,e,c)}}if((s=(s+1)%r)==i)break}return t}function Cnt(t,e){let n=t.dom.ownerDocument,r,i=0,s=dnt(n,e.left,e.top);s&&({node:r,offset:i}=s);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!WU(e,c)||(o=Iye(t.dom,e,c),!o))return null}if(vo)for(let c=o;r&&c;c=qy(c))c.draggable&&(r=void 0);if(o=xnt(o,e),r){if(wc&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let u=r.childNodes[i],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&i++}let c;BS&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(a=Snt(t,r,i,e))}a==null&&(a=wnt(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function qQ(t){return t.top<t.bottom||t.left<t.right}function _h(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(qQ(r))return r}return Array.prototype.find.call(n,qQ)||t.getBoundingClientRect()}const Ent=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Pye(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=BS||wc;if(r.nodeType==3)if(o&&(Ent.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=_h(Zu(r,i,i),n);if(wc&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=_h(Zu(r,i-1,i-1),-1);if(c.top==l.top){let u=_h(Zu(r,i,i+1),-1);if(u.top!=l.top)return cb(u,u.left<c.left)}}return l}else{let l=i,c=i,u=n<0?1:-1;return n<0&&!i?(c++,u=-1):n>=0&&i==r.nodeValue.length?(l--,u=1):n<0?l--:c++,cb(_h(Zu(r,l,c),u),u<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(n<0||i==bl(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return Xj(l.getBoundingClientRect(),!1)}if(s==null&&i<bl(r)){let l=r.childNodes[i];if(l.nodeType==1)return Xj(l.getBoundingClientRect(),!0)}return Xj(r.getBoundingClientRect(),n>=0)}if(s==null&&i&&(n<0||i==bl(r))){let l=r.childNodes[i-1],c=l.nodeType==3?Zu(l,bl(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return cb(_h(c,1),!1)}if(s==null&&i<bl(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Zu(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return cb(_h(c,-1),!0)}return cb(_h(r.nodeType==3?Zu(r):r,-n),n>=0)}function cb(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function Xj(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function _ye(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function Tnt(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return _ye(t,e,()=>{let{node:s}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=Pye(t,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Zu(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const Int=/[\u0590-\u08ac]/;function Pnt(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return a?!Int.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?s:o:_ye(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=t.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",n,"character");let f=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:y,focusOffset:b}=t.domSelectionRange(),v=y&&!f.contains(y.nodeType==1?y:y.parentNode)||l==y&&c==b;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch{}return h!=null&&(a.caretBidiLevel=h),v}):r.pos==r.start()||r.pos==r.end()}let GQ=null,YQ=null,XQ=!1;function _nt(t,e,n){return GQ==e&&YQ==n?XQ:(GQ=e,YQ=n,XQ=n=="up"||n=="down"?Tnt(t,e,n):Pnt(t,e,n))}const Pl=0,JQ=1,_p=2,wu=3;class zS{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=Pl,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>Zi(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!n||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let a=i.children[o];if(a.size){i=a;break}}return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof Aye){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof kye&&s.side>=0;r--);if(n<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&n&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,n):{node:this.contentDOM,offset:s?Zi(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,n):{node:this.contentDOM,offset:s?Zi(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let d=a;d>0;d--){let h=this.children[d-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){i=Zi(h.dom)+1;break}e-=h.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){s=Zi(d.dom);break}n+=d.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let s=Math.min(e,n),o=Math.max(e,n);for(let f=0,y=0;f<this.children.length;f++){let b=this.children[f],v=y+b.size;if(s>y&&o<v)return b.setSelection(e-y-b.border,n-y-b.border,r,i);y=v}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),d=!1;if((wc||vo)&&e==n){let{node:f,offset:y}=a;if(f.nodeType==3){if(d=!!(y&&f.nodeValue[y-1]==`
`),d&&y==f.nodeValue.length)for(let b=f,v;b;b=b.parentNode){if(v=b.nextSibling){v.nodeName=="BR"&&(a=l={node:v.parentNode,offset:Zi(v)+1});break}let x=b.pmViewDesc;if(x&&x.node&&x.node.isBlock)break}}else{let b=f.childNodes[y-1];d=b&&(b.nodeName=="BR"||b.contentEditable=="false")}}if(wc&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let f=u.focusNode.childNodes[u.focusOffset];f&&f.contentEditable=="false"&&(i=!0)}if(!(i||d&&vo)&&mg(a.node,a.offset,u.anchorNode,u.anchorOffset)&&mg(l.node,l.offset,u.focusNode,u.focusOffset))return;let h=!1;if((c.extend||e==n)&&!d){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let y=a;a=l,l=y}let f=document.createRange();f.setEnd(l.node,l.offset),f.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+s.border,l=o-s.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?_p:JQ,e==a&&n==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=wu:s.markDirty(e-a,n-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?_p:wu}r=o}this.dirty=_p}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?_p:JQ;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class kye extends zS{constructor(e,n,r,i){let s,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,s=this}matchesWidget(e){return this.dirty==Pl&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class knt extends zS{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class yg extends zS{constructor(e,n,r,i,s){super(e,[],r,i),this.mark=n,this.spec=s}static create(e,n,r,i){let s=i.nodeViews[n.type.name],o=s&&s(n,i,r);return(!o||!o.dom)&&(o=Wg.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new yg(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&wu||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=wu&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Pl){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Pl}}slice(e,n,r){let i=yg.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;n<o&&(s=y$(s,n,o,r)),e>0&&(s=y$(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class lf extends zS{constructor(e,n,r,i,s,o,a,l,c){super(e,[],s,o),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a}static create(e,n,r,i,s,o){let a=s.nodeViews[n.type.name],l,c=a&&a(n,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,d=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=Wg.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!d&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let h=u;return u=Dye(u,r,n),c?l=new Ant(e,n,r,i,u,d||null,h,c,s,o+1):n.isText?new eA(e,n,r,i,u,h,s):new lf(e,n,r,i,u,d||null,h,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Pe.empty)}return e}matchesNode(e,n,r){return this.dirty==Pl&&e.eq(this.node)&&aP(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,s=e.composing?this.localCompositionInfo(e,n):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new Ont(this,o&&o.node,e);Nnt(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?Tn.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,i)},(c,u,d,h)=>{l.syncToMarks(c.marks,r,e);let f;l.findNodeMatch(c,u,d,h)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(f=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,d,f,e)||l.updateNextNode(c,u,d,e,h,i)||l.addNode(c,u,d,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==_p)&&(o&&this.protectLocalComposition(e,o),Mye(this.contentDOM,this.children,e),Gy&&jnt(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof Ot)||r<n||i>n+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=Lnt(this.node.content,o,r-n,i-n);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let s=n;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new knt(this,s,n,i);e.input.compositionNodes.push(o),this.children=y$(this.children,r,r+i.length,e,o)}update(e,n,r,i){return this.dirty==wu||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Pl}updateOuterDeco(e){if(aP(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=Oye(this.dom,this.nodeDOM,m$(this.outerDeco,this.node,n),m$(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function ZQ(t,e,n,r,i){Dye(r,e,t);let s=new lf(void 0,t,e,n,r,r,r,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class eA extends lf{constructor(e,n,r,i,s,o,a){super(e,n,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==wu||this.dirty!=Pl&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Pl||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Pl,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),s=document.createTextNode(i.text);return new eA(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=wu)}get domAtom(){return!1}isText(e){return this.node.text==e}}class Aye extends zS{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Pl&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class Ant extends lf{constructor(e,n,r,i,s,o,a,l,c,u){super(e,n,r,i,s,o,a,c,u),this.spec=l}update(e,n,r,i){if(this.dirty==wu)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,n,r);return s&&this.updateInner(e,n,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function Mye(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=QQ(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof yg){let l=r?r.previousSibling:t.lastChild;Mye(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=QQ(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const hx=function(t){t&&(this.nodeName=t)};hx.prototype=Object.create(null);const kp=[new hx];function m$(t,e,n){if(t.length==0)return kp;let r=n?kp[0]:new hx,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&i.push(r=new hx(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&i.length==1&&i.push(r=new hx(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function Oye(t,e,n,r){if(n==kp&&r==kp)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=kp[0]),i=l}Mnt(i,a||kp[0],o)}return i}function Mnt(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&t.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&t.classList.add(i[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function Dye(t,e,n){return Oye(t,t,kp,m$(e,n,t.nodeType!=1))}function aP(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function QQ(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Ont{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Dnt(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=Pl,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[s])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=yg.create(this.top,e[s],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,n,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,n,r,i,s){let o=this.top.children[i];return o.dirty==wu&&o.dom==o.contentDOM&&(o.dirty=_p),o.update(e,n,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof lf){let c=this.preMatch.matched.get(l);if(c!=null&&c!=s)return!1;let u=l.dom,d,h=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=wu&&aP(n,l.outerDeco));if(!h&&l.update(e,n,r,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!h&&(d=this.recreateWrapper(l,e,n,r,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=_p,d.updateChildren(i,o+1),d.dirty=Pl),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,i,s,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!aP(r,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=lf.create(this.top,n,r,i,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,i,s){let o=lf.create(this.top,e,n,r,i,s);o.contentDOM&&o.updateChildren(i,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new kye(this.top,e,n,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof yg;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof eA)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((vo||Os)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new Aye(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function Dnt(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof yg)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function Rnt(t,e){return t.type.side-e.type.side}function Nnt(t,e,n,r){let i=e.locals(t),s=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,d;for(;o<i.length&&i[o].to==s;){let v=i[o++];v.widget&&(u?(d||(d=[u])).push(v):u=v)}if(u)if(d){d.sort(Rnt);for(let v=0;v<d.length;v++)n(d[v],c,!!l)}else n(u,c,!!l);let h,f;if(l)f=-1,h=l,l=null;else if(c<t.childCount)f=c,h=t.child(c++);else break;for(let v=0;v<a.length;v++)a[v].to<=s&&a.splice(v--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let y=s+h.nodeSize;if(h.isText){let v=y;o<i.length&&i[o].from<v&&(v=i[o].from);for(let x=0;x<a.length;x++)a[x].to<v&&(v=a[x].to);v<y&&(l=h.cut(v-s),h=h.cut(0,v-s),y=v,f=-1)}else for(;o<i.length&&i[o].to<y;)o++;let b=h.isInline&&!h.isLeaf?a.filter(v=>!v.inline):a.slice();r(h,b,e.forChild(s,h),f),s=y}}function jnt(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Lnt(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let c=t.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=n){if(s>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function y$(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>n&&s.push(l.slice(n-c,l.size,r)))}return s}function KU(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(Qk(n)){for(l=o;i&&!i.node;)i=i.parent;let d=i.node;if(i&&d.isAtom&&dt.isSelectable(d)&&i.parent&&!(d.isInline&&cnt(n.focusNode,n.focusOffset,i.dom))){let h=i.posBefore;c=new dt(o==h?a:r.resolve(h))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let d=o,h=o;for(let f=0;f<n.rangeCount;f++){let y=n.getRangeAt(f);d=Math.min(d,t.docView.posFromDOM(y.startContainer,y.startOffset,1)),h=Math.max(h,t.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(d<0)return null;[l,o]=h==t.state.selection.anchor?[h,d]:[d,h],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let d=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;c=qU(t,u,a,d)}return c}function Rye(t){return t.editable?t.hasFocus():jye(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function pd(t,e=!1){let n=t.state.selection;if(Nye(t,n),!!Rye(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Os){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&mg(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)$nt(t);else{let{anchor:r,head:i}=n,s,o;eee&&!(n instanceof Ot)&&(n.$from.parent.inlineContent||(s=tee(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=tee(t,n.to))),t.docView.setSelection(r,i,t,e),eee&&(s&&nee(s),o&&nee(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Fnt(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const eee=vo||Os&&Sye<63;function tee(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(vo&&i&&i.contentEditable=="false")return Jj(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return Jj(i);if(s)return Jj(s)}}function Jj(t){return t.contentEditable="true",vo&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function nee(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Fnt(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!Rye(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function $nt(t){let e=t.domSelection(),n=document.createRange();if(!e)return;let r=t.cursorWrapper.dom,i=r.nodeName=="IMG";i?n.setStart(r.parentNode,Zi(r)+1):n.setStart(r,0),n.collapse(!0),e.removeAllRanges(),e.addRange(n),!i&&!t.state.selection.visible&&Qo&&af<=11&&(r.disabled=!0,r.disabled=!1)}function Nye(t,e){if(e instanceof dt){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(ree(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else ree(t)}function ree(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function qU(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||Ot.between(e,n,r)}function iee(t){return t.editable&&!t.hasFocus()?!1:jye(t)}function jye(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function Bnt(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return mg(e.node,e.offset,n.anchorNode,n.anchorOffset)}function v$(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&$t.findFrom(s,e)}function Oh(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function see(t,e,n){let r=t.state.selection;if(r instanceof Ot)if(n.indexOf("s")>-1){let{$head:i}=r,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=t.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return Oh(t,new Ot(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=v$(t.state,e);return i&&i instanceof dt?Oh(t,i):!1}else if(!(gl&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?dt.isSelectable(s)?Oh(t,new dt(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):BS?Oh(t,new Ot(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(r instanceof dt&&r.node.isInline)return Oh(t,new Ot(e>0?r.$to:r.$from));{let i=v$(t.state,e);return i?Oh(t,i):!1}}}function lP(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function fx(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Om(t,e){return e<0?znt(t):Unt(t)}function znt(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;for(wc&&n.nodeType==1&&r<lP(n)&&fx(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(fx(a,-1))i=n,s=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(Lye(n))break;{let a=n.previousSibling;for(;a&&fx(a,-1);)i=n.parentNode,s=Zi(a),a=a.previousSibling;if(a)n=a,r=lP(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?b$(t,n,r):i&&b$(t,i,s)}function Unt(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=lP(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if(fx(a,1))s=n,o=++r;else break}else{if(Lye(n))break;{let a=n.nextSibling;for(;a&&fx(a,1);)s=a.parentNode,o=Zi(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=lP(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}s&&b$(t,s,o)}function Lye(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Hnt(t,e){for(;t&&e==t.childNodes.length&&!$S(t);)e=Zi(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function Vnt(t,e){for(;t&&!e&&!$S(t);)e=Zi(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function b$(t,e,n){if(e.nodeType!=3){let s,o;(o=Hnt(e,n))?(e=o,n=0):(s=Vnt(e,n))&&(e=s,n=s.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Qk(r)){let s=document.createRange();s.setEnd(e,n),s.setStart(e,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&pd(t)},50)}function oee(t,e){let n=t.state.doc.resolve(e);if(!(Os||hnt)&&n.parent.inlineContent){let i=t.coordsAtPos(e);if(e>n.start()){let s=t.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<n.end()){let s=t.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function aee(t,e,n){let r=t.state.selection;if(r instanceof Ot&&!r.empty||n.indexOf("s")>-1||gl&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=v$(t.state,e);if(o&&o instanceof dt)return Oh(t,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof Ra?$t.near(o,e):$t.findFrom(o,e);return a?Oh(t,a):!1}return!1}function lee(t,e){if(!(t.state.selection instanceof Ot))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),t.dispatch(o),!0}return!1}function cee(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function Wnt(t){if(!vo||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;cee(t,r,"true"),setTimeout(()=>cee(t,r,"false"),20)}return!1}function Knt(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function qnt(t,e){let n=e.keyCode,r=Knt(e);if(n==8||gl&&n==72&&r=="c")return lee(t,-1)||Om(t,-1);if(n==46&&!e.shiftKey||gl&&n==68&&r=="c")return lee(t,1)||Om(t,1);if(n==13||n==27)return!0;if(n==37||gl&&n==66&&r=="c"){let i=n==37?oee(t,t.state.selection.from)=="ltr"?-1:1:-1;return see(t,i,r)||Om(t,i)}else if(n==39||gl&&n==70&&r=="c"){let i=n==39?oee(t,t.state.selection.from)=="ltr"?1:-1:1;return see(t,i,r)||Om(t,i)}else{if(n==38||gl&&n==80&&r=="c")return aee(t,-1,r)||Om(t,-1);if(n==40||gl&&n==78&&r=="c")return Wnt(t)||aee(t,1,r)||Om(t,1);if(r==(gl?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function GU(t,e){t.someProp("transformCopied",f=>{e=f(e,t)});let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let f=r.firstChild;n.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),r=f.content}let o=t.someProp("clipboardSerializer")||Wg.fromSchema(t.state.schema),a=Hye(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=Uye[c.nodeName.toLowerCase()]);){for(let f=u.length-1;f>=0;f--){let y=a.createElement(u[f]);for(;l.firstChild;)y.appendChild(l.firstChild);l.appendChild(y),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(n)}`);let h=t.someProp("clipboardTextSerializer",f=>f(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function Fye(t,e,n,r,i){let s=i.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=e&&(r||s||!n);if(l){if(t.someProp("transformPastedText",h=>{e=h(e,s||r,t)}),s)return e?new We(Pe.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):We.empty;let d=t.someProp("clipboardTextParser",h=>h(e,i,r,t));if(d)a=d;else{let h=i.marks(),{schema:f}=t.state,y=Wg.fromSchema(f);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(b=>{let v=o.appendChild(document.createElement("p"));b&&v.appendChild(y.serializeNode(f.text(b,h)))})}}else t.someProp("transformPastedHTML",d=>{n=d(n,t)}),o=Jnt(n),BS&&Znt(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||gy.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!Gnt.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=Qnt(uee(a,+u[1],+u[2]),u[4]);else if(a=We.maxOpen(Ynt(a.content,i),!0),a.openStart||a.openEnd){let d=0,h=0;for(let f=a.content.firstChild;d<a.openStart&&!f.type.spec.isolating;d++,f=f.firstChild);for(let f=a.content.lastChild;h<a.openEnd&&!f.type.spec.isolating;h++,f=f.lastChild);a=uee(a,d,h)}return t.someProp("transformPasted",d=>{a=d(a,t)}),a}const Gnt=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Ynt(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&Bye(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=zye(o[o.length-1],s.length));let u=$ye(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return Pe.from(o)}return t}function $ye(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,Pe.from(t));return t}function Bye(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=Bye(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(Pe.from($ye(n,t,i+1))))}}function zye(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,zye(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Pe.empty,!0);return t.copy(n.append(r))}function x$(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(s=0),i<r-1&&(a=x$(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Pe.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function uee(t,e,n){return e<t.openStart&&(t=new We(x$(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new We(x$(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const Uye={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let dee=null;function Hye(){return dee||(dee=document.implementation.createHTMLDocument("title"))}let Zj=null;function Xnt(t){let e=window.trustedTypes;return e?(Zj||(Zj=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),Zj.createHTML(t)):t}function Jnt(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=Hye().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&Uye[r[1].toLowerCase()])&&(t=i.map(s=>"<"+s+">").join("")+t+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=Xnt(t),i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function Znt(t){let e=t.querySelectorAll(Os?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function Qnt(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=Pe.from(l.create(r[a+1],i)),s++,o++}return new We(i,s,o)}const bo={},xo={},ert={touchstart:!0,touchmove:!0};class trt{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function nrt(t){for(let e in bo){let n=bo[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{irt(t,r)&&!YU(t,r)&&(t.editable||!(r.type in xo))&&n(t,r)},ert[e]?{passive:!0}:void 0)}vo&&t.dom.addEventListener("input",()=>null),w$(t)}function Yh(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function rrt(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function w$(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>YU(t,r))})}function YU(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function irt(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function srt(t,e){!YU(t,e)&&bo[e.type]&&(t.editable||!(e.type in xo))&&bo[e.type](t,e)}xo.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!Wye(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(od&&Os&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Gy&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,Sp(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||qnt(t,n)?n.preventDefault():Yh(t,"key")};xo.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};xo.keypress=(t,e)=>{let n=e;if(Wye(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||gl&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof Ot)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode),s=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,i,s))&&t.dispatch(s()),n.preventDefault()}};function tA(t){return{left:t.clientX,top:t.clientY}}function ort(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function XU(t,e,n,r,i){if(r==-1)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,n,s.nodeAfter,s.before(o),i,!0):a(t,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function yy(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function art(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&dt.isSelectable(r)?(yy(t,new dt(n)),!0):!1}function lrt(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof dt&&(r=n.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(dt.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?(yy(t,dt.create(t.state.doc,i)),!0):!1}function crt(t,e,n,r,i){return XU(t,"handleClickOn",e,n,r)||t.someProp("handleClick",s=>s(t,e,r))||(i?lrt(t,n):art(t,n))}function urt(t,e,n,r){return XU(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function drt(t,e,n,r){return XU(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||hrt(t,n,r)}function hrt(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(yy(t,Ot.create(r,0,r.content.size)),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)yy(t,Ot.create(r,a+1,a+1+o.content.size));else if(dt.isSelectable(o))yy(t,dt.create(r,a));else continue;return!0}}function JU(t){return cP(t)}const Vye=gl?"metaKey":"ctrlKey";bo.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=JU(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&ort(n,t.input.lastClick)&&!n[Vye]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s,button:n.button};let o=t.posAtCoords(tA(n));o&&(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new frt(t,o,n,!!r)):(s=="doubleClick"?urt:drt)(t,o.pos,o.inside,n)?n.preventDefault():Yh(t,"pointer"))};class frt{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[Vye],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof dt&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&wc&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Yh(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>pd(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(tA(e))),this.updateAllowDefault(e),this.allowDefault||!n?Yh(this.view,"pointer"):crt(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||vo&&this.mightDrag&&!this.mightDrag.node.isAtom||Os&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(yy(this.view,$t.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):Yh(this.view,"pointer")}move(e){this.updateAllowDefault(e),Yh(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}bo.touchstart=t=>{t.input.lastTouch=Date.now(),JU(t),Yh(t,"pointer")};bo.touchmove=t=>{t.input.lastTouch=Date.now(),Yh(t,"pointer")};bo.contextmenu=t=>JU(t);function Wye(t,e){return t.composing?!0:vo&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const prt=od?5e3:-1;xo.compositionstart=xo.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof Ot&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),cP(t,!0),t.markCursor=null;else if(cP(t,!e.selection.empty),wc&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}t.input.composing=!0}Kye(t,prt)};xo.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,Kye(t,20))};function Kye(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>cP(t),e))}function qye(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=mrt());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function grt(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=ant(e.focusNode,e.focusOffset),r=lnt(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let i=r.pmViewDesc,s=t.domObserver.lastChangedTextNode;if(n==s||r==s)return s;if(!i||!i.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function mrt(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function cP(t,e=!1){if(!(od&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),qye(t),e||t.docView&&t.docView.dirty){let n=KU(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function yrt(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const pw=Qo&&af<15||Gy&&fnt<604;bo.copy=xo.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let s=pw?null:n.clipboardData,o=r.content(),{dom:a,text:l}=GU(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):yrt(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function vrt(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function brt(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?gw(t,r.value,null,i,e):gw(t,r.textContent,r.innerHTML,i,e)},50)}function gw(t,e,n,r,i){let s=Fye(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,s||We.empty)))return!0;if(!s)return!1;let o=vrt(s),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(s);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Gye(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}xo.paste=(t,e)=>{let n=e;if(t.composing&&!od)return;let r=pw?null:n.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&gw(t,Gye(r),r.getData("text/html"),i,n)?n.preventDefault():brt(t,n)};let Yye=class{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}};const xrt=gl?"altKey":"ctrlKey";function Xye(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[xrt]}bo.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(tA(n)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof dt?i.to-1:i.to))){if(r&&r.mightDrag)o=dt.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let d=t.docView.nearestDesc(n.target,!0);d&&d.node.type.spec.draggable&&d!=t.docView&&(o=dt.create(t.state.doc,d.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=GU(t,a);(!n.dataTransfer.files.length||!Os||Sye>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(pw?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",pw||n.dataTransfer.setData("text/plain",c),t.dragging=new Yye(u,Xye(t,n),o)};bo.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};xo.dragover=xo.dragenter=(t,e)=>e.preventDefault();xo.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let i=t.posAtCoords(tA(n));if(!i)return;let s=t.state.doc.resolve(i.pos),o=r&&r.slice;o?t.someProp("transformPasted",y=>{o=y(o,t)}):o=Fye(t,Gye(n.dataTransfer),pw?null:n.dataTransfer.getData("text/html"),!1,s);let a=!!(r&&Xye(t,n));if(t.someProp("handleDrop",y=>y(t,n,o||We.empty,a))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?fye(t.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let c=t.state.tr;if(a){let{node:y}=r;y?y.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,h=c.doc;if(d?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(h))return;let f=c.doc.resolve(u);if(d&&dt.isSelectable(o.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new dt(f));else{let y=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((b,v,x,C)=>y=C),c.setSelection(qU(t,f,c.doc.resolve(y)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};bo.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&pd(t)},20))};bo.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};bo.beforeinput=(t,e)=>{if(Os&&od&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,Sp(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in xo)bo[t]=xo[t];function mw(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class uP{constructor(e,n){this.toDOM=e,this.spec=n||qp,this.side=this.spec.side||0}map(e,n,r,i){let{pos:s,deleted:o}=e.mapResult(n.from+i,this.side<0?-1:1);return o?null:new Cl(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof uP&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&mw(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class cf{constructor(e,n){this.attrs=e,this.spec=n||qp}map(e,n,r,i){let s=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new Cl(s,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof cf&&mw(this.attrs,e.attrs)&&mw(this.spec,e.spec)}static is(e){return e.type instanceof cf}destroy(){}}class ZU{constructor(e,n){this.attrs=e,this.spec=n||qp}map(e,n,r,i){let s=e.mapResult(n.from+i,1);if(s.deleted)return null;let o=e.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new Cl(s.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),s;return i==n.from&&!(s=e.child(r)).isText&&i+s.nodeSize==n.to}eq(e){return this==e||e instanceof ZU&&mw(this.attrs,e.attrs)&&mw(this.spec,e.spec)}destroy(){}}class Cl{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Cl(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Cl(e,e,new uP(n,r))}static inline(e,n,r,i){return new Cl(e,n,new cf(r,i))}static node(e,n,r,i){return new Cl(e,n,new ZU(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof cf}get widget(){return this.type instanceof uP}}const Vm=[],qp={};class ti{constructor(e,n){this.local=e.length?e:Vm,this.children=n.length?n:Vm}static create(e,n){return n.length?dP(n,e,0,qp):Es}find(e,n,r){let i=[];return this.findInner(e??0,n??1e9,i,0,r),i}findInner(e,n,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,i+a,s)}}map(e,n,r){return this==Es||e.maps.length==0?this:this.mapInner(e,n,0,0,r||qp)}mapInner(e,n,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?wrt(this.children,o||[],e,n,r,i,s):o?new ti(o.sort(Gp),Vm):Es}add(e,n){return n.length?this==Es?ti.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(u=Zye(n,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,dP(u,a,c+1,qp)),s+=3}});let o=Jye(s?Qye(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new ti(o.length?this.local.concat(o).sort(Gp):this.local,i||this.children)}remove(e){return e.length==0||this==Es?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+n,l=r[s+1]+n;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=Es?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new ti(i,r):Es}forChild(e,n){if(this==Es)return this;if(n.isLeaf)return ti.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof cf){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new ti(i.sort(Gp),Vm);return r?new zh([a,r]):a}return r||Es}eq(e){if(this==e)return!0;if(!(e instanceof ti)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return QU(this.localsInner(e))}localsInner(e){if(this==Es)return Vm;if(e.inlineContent||!this.local.some(cf.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof cf||n.push(this.local[r]);return n}forEachSet(e){e(this)}}ti.empty=new ti([],[]);ti.removeOverlap=QU;const Es=ti.empty;class zh{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,qp));return zh.from(r)}forChild(e,n){if(n.isLeaf)return ti.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,n);s!=Es&&(s instanceof zh?r=r.concat(s.members):r.push(s))}return zh.from(r)}eq(e){if(!(e instanceof zh)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?QU(r?n:n.sort(Gp)):Vm}static from(e){switch(e.length){case 0:return Es;case 1:return e[0];default:return new zh(e.every(n=>n instanceof ti)?e:e.reduce((n,r)=>n.concat(r instanceof ti?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function wrt(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,u=s;c<n.maps.length;c++){let d=0;n.maps[c].forEach((h,f,y,b)=>{let v=b-y-(f-h);for(let x=0;x<a.length;x+=3){let C=a[x+1];if(C<0||h>C+u-d)continue;let E=a[x]+u-d;f>=E?a[x+1]=h<=E?-2:-1:h>=u&&v&&(a[x]+=v,a[x+1]+=v)}d+=v}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+s),d=u-i;if(d<0||d>=r.content.size){l=!0;continue}let h=n.map(t[c+1]+s,-1),f=h-i,{index:y,offset:b}=r.content.findIndex(d),v=r.maybeChild(y);if(v&&b==d&&b+v.nodeSize==f){let x=a[c+2].mapInner(n,v,u+1,t[c]+s+1,o);x!=Es?(a[c]=d,a[c+1]=f,a[c+2]=x):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=Srt(a,t,e,n,i,s,o),u=dP(c,r,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,h=0;d<u.children.length;d+=3){let f=u.children[d];for(;h<a.length&&a[h]<f;)h+=3;a.splice(h,0,u.children[d],u.children[d+1],u.children[d+2])}}return new ti(e.sort(Gp),a)}function Jye(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new Cl(i.from+e,i.to+e,i.type))}return n}function Srt(t,e,n,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(r,i,c);d?n.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return n}function Zye(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),t[s]=null);return i}function Qye(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function dP(t,e,n,r){let i=[],s=!1;e.forEach((a,l)=>{let c=Zye(t,a,l+n);if(c){s=!0;let u=dP(c,a,n+l+1,r);u!=Es&&i.push(l,l+a.nodeSize,u)}});let o=Jye(s?Qye(t):t,-n).sort(Gp);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new ti(o,i):Es}function Gp(t,e){return t.from-e.from||t.to-e.to}function QU(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),hee(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),hee(e,i,r.copy(s.from,r.to)));break}}}return e}function hee(t,e,n){for(;e<t.length&&Gp(n,t[e])>0;)e++;t.splice(e,0,n)}function Qj(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=Es&&e.push(r)}),t.cursorWrapper&&e.push(ti.create(t.state.doc,[t.cursorWrapper.deco])),zh.from(e)}const Crt={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Ert=Qo&&af<=11;class Trt{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Irt{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Trt,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);Qo&&af<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),Ert&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Crt)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(iee(this.view)){if(this.suppressingSelectionUpdates)return pd(this.view);if(Qo&&af<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&mg(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let s=e.focusNode;s;s=qy(s))n.add(s);for(let s=e.anchorNode;s;s=qy(s))if(n.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&iee(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let d=this.registerMutation(n[u],l);d&&(s=s<0?d.from:Math.min(d.from,s),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(a=!0))}if(wc&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,h]=u;d.parentNode&&d.parentNode.parentNode==h.parentNode?h.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let h of u){let f=h.parentNode;f&&f.nodeName=="LI"&&(!d||krt(e,d)!=f)&&h.remove()}}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Qk(r)&&(c=KU(e))&&c.eq($t.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,pd(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),Prt(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||pd(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let d=e.addedNodes[u];n.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(Qo&&af<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:d,nextSibling:h}=e.addedNodes[u];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h)}let o=i&&i.parentNode==e.target?Zi(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?Zi(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let fee=new WeakMap,pee=!1;function Prt(t){if(!fee.has(t)&&(fee.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=wc,pee)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),pee=!0}}function gee(t,e){let n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return mg(o.node,o.offset,i,s)&&([n,r,i,s]=[i,s,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}}function _rt(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return gee(t,i)}let n;function r(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?gee(t,n):null}function krt(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function Art(t,e,n){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],Qk(l)||c.push({node:l.focusNode,offset:l.focusOffset})),Os&&t.input.lastKeyCode===8)for(let v=s;v>i;v--){let x=r.childNodes[v-1],C=x.pmViewDesc;if(x.nodeName=="BR"&&!C){s=v;break}if(!C||C.size)break}let d=t.state.doc,h=t.someProp("domParser")||gy.fromSchema(t.state.schema),f=d.resolve(o),y=null,b=h.parse(r,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:i,to:s,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:Mrt,context:f});if(c&&c[0].pos!=null){let v=c[0].pos,x=c[1]&&c[1].pos;x==null&&(x=v),y={anchor:v+o,head:x+o}}return{doc:b,sel:y,from:o,to:a}}function Mrt(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(vo&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||vo&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Ort=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Drt(t,e,n,r,i){let s=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let D=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,L=KU(t,D);if(L&&!t.state.selection.eq(L)){if(Os&&od&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",$=>$(t,Sp(13,"Enter"))))return;let z=t.state.tr.setSelection(L);D=="pointer"?z.setMeta("pointer",!0):D=="key"&&z.scrollIntoView(),s&&z.setMeta("composition",s),t.dispatch(z)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=Art(t,e,n),u=t.state.doc,d=u.slice(c.from,c.to),h,f;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,f="end"):(h=t.state.selection.from,f="start"),t.input.lastKeyCode=null;let y=jrt(d.content,c.doc.content,c.from,h,f);if(y&&t.input.domChangeCount++,(Gy&&t.input.lastIOSEnter>Date.now()-225||od)&&i.some(D=>D.nodeType==1&&!Ort.test(D.nodeName))&&(!y||y.endA>=y.endB)&&t.someProp("handleKeyDown",D=>D(t,Sp(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!y)if(r&&l instanceof Ot&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))y={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let D=mee(t,t.state.doc,c.sel);if(D&&!D.eq(t.state.selection)){let L=t.state.tr.setSelection(D);s&&L.setMeta("composition",s),t.dispatch(L)}}return}t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof Ot&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),Qo&&af<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>c.from&&c.doc.textBetween(y.start-c.from-1,y.start-c.from+1)=="  "&&(y.start--,y.endA--,y.endB--);let b=c.doc.resolveNoCache(y.start-c.from),v=c.doc.resolveNoCache(y.endB-c.from),x=u.resolve(y.start),C=b.sameParent(v)&&b.parent.inlineContent&&x.end()>=y.endA,E;if((Gy&&t.input.lastIOSEnter>Date.now()-225&&(!C||i.some(D=>D.nodeName=="DIV"||D.nodeName=="P"))||!C&&b.pos<c.doc.content.size&&(!b.sameParent(v)||!b.parent.inlineContent)&&!/\S/.test(c.doc.textBetween(b.pos,v.pos,"",""))&&(E=$t.findFrom(c.doc.resolve(b.pos+1),1,!0))&&E.head>b.pos)&&t.someProp("handleKeyDown",D=>D(t,Sp(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>y.start&&Nrt(u,y.start,y.endA,b,v)&&t.someProp("handleKeyDown",D=>D(t,Sp(8,"Backspace")))){od&&Os&&t.domObserver.suppressSelectionUpdates();return}Os&&y.endB==y.start&&(t.input.lastChromeDelete=Date.now()),od&&!C&&b.start()!=v.start()&&v.parentOffset==0&&b.depth==v.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==y.endA&&(y.endB-=2,v=c.doc.resolveNoCache(y.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(D){return D(t,Sp(13,"Enter"))})},20));let I=y.start,P=y.endA,_=D=>{let L=D||t.state.tr.replace(I,P,c.doc.slice(y.start-c.from,y.endB-c.from));if(c.sel){let z=mee(t,L.doc,c.sel);z&&!(Os&&t.composing&&z.empty&&(y.start!=y.endB||t.input.lastChromeDelete<Date.now()-100)&&(z.head==I||z.head==L.mapping.map(P)-1)||Qo&&z.empty&&z.head==I)&&L.setSelection(z)}return s&&L.setMeta("composition",s),L.scrollIntoView()},A;if(C){if(b.pos==v.pos){Qo&&af<=11&&b.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>pd(t),20));let D=_(t.state.tr.delete(I,P)),L=u.resolve(y.start).marksAcross(u.resolve(y.endA));L&&D.ensureMarks(L),t.dispatch(D)}else if(y.endA==y.endB&&(A=Rrt(b.parent.content.cut(b.parentOffset,v.parentOffset),x.parent.content.cut(x.parentOffset,y.endA-x.start())))){let D=_(t.state.tr);A.type=="add"?D.addMark(I,P,A.mark):D.removeMark(I,P,A.mark),t.dispatch(D)}else if(b.parent.child(b.index()).isText&&b.index()==v.index()-(v.textOffset?0:1)){let D=b.parent.textBetween(b.parentOffset,v.parentOffset),L=()=>_(t.state.tr.insertText(D,I,P));t.someProp("handleTextInput",z=>z(t,I,P,D,L))||t.dispatch(L())}}else t.dispatch(_())}function mee(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:qU(t,e.resolve(n.anchor),e.resolve(n.head))}function Rrt(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(Pe.from(c).eq(t))return{mark:a,type:o}}function Nrt(t,e,n,r,i){if(n-e<=i.pos-r.pos||eL(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(!r.parent.isTextblock){let a=s.nodeAfter;return a!=null&&n==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(eL(s,!0,!0));return!o.parent.isTextblock||o.pos>n||eL(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function eL(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let s=t.node(r).maybeChild(t.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function jrt(t,e,n,r,i){let s=t.findDiffStart(e,n);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}if(o<s&&t.size<e.size){let l=r<=s&&r>=o?s-r:0;s-=l,s&&s<e.size&&yee(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=r<=s&&r>=a?s-r:0;s-=l,s&&s<t.size&&yee(t.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function yee(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class eve{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new trt,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(See),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=xee(this),bee(this),this.nodeViews=wee(this),this.docView=ZQ(this.state.doc,vee(this),Qj(this),this.dom,this),this.domObserver=new Irt(this,(r,i,s,o)=>Drt(this,r,i,s,o)),this.domObserver.start(),nrt(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&w$(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(See),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let i=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&(qye(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let f=wee(this);Frt(f,this.nodeViews)&&(this.nodeViews=f,s=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&w$(this),this.editable=xee(this),bee(this);let l=Qj(this),c=vee(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",d=s||!this.docView.matchesNode(e.doc,c,l);(d||!e.selection.eq(i.selection))&&(o=!0);let h=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&mnt(this);if(o){this.domObserver.stop();let f=d&&(Qo||Os)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&Lrt(i.selection,e.selection);if(d){let y=Os?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=grt(this)),(s||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=ZQ(e.doc,c,l,this.dom,this)),y&&!this.trackWrites&&(f=!0)}f||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Bnt(this))?pd(this,f):(Nye(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():h&&ynt(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof dt){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&KQ(this,n.getBoundingClientRect(),e)}else KQ(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let s=r.from+(this.state.doc.content.size-n.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==r.node&&(i=s)}this.dragging=new Yye(e.slice,e.move,i<0?void 0:dt.create(this.state.doc,i))}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=n?n(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(Qo){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&vnt(this.dom),pd(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Cnt(this,e)}coordsAtPos(e,n=1){return Pye(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return _nt(this,n||this.state,e)}pasteHTML(e,n){return gw(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return gw(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return GU(this,e)}destroy(){this.docView&&(rrt(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Qj(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,snt())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return srt(this,e)}domSelectionRange(){let e=this.domSelection();return e?vo&&this.root.nodeType===11&&unt(this.dom.ownerDocument)==this.dom&&_rt(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}eve.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function vee(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[Cl.node(0,t.state.doc.content.size,e)]}function bee(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Cl.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function xee(t){return!t.someProp("editable",e=>e(t.state)===!1)}function Lrt(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function wee(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function Frt(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function See(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var gf={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},hP={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},$rt=typeof navigator<"u"&&/Mac/.test(navigator.platform),Brt=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Qi=0;Qi<10;Qi++)gf[48+Qi]=gf[96+Qi]=String(Qi);for(var Qi=1;Qi<=24;Qi++)gf[Qi+111]="F"+Qi;for(var Qi=65;Qi<=90;Qi++)gf[Qi]=String.fromCharCode(Qi+32),hP[Qi]=String.fromCharCode(Qi);for(var tL in gf)hP.hasOwnProperty(tL)||(hP[tL]=gf[tL]);function zrt(t){var e=$rt&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||Brt&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?hP:gf)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const Urt=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Hrt=typeof navigator<"u"&&/Win/.test(navigator.platform);function Vrt(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))Urt?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function Wrt(t){let e=Object.create(null);for(let n in t)e[Vrt(n)]=t[n];return e}function nL(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function Krt(t){return new ls({props:{handleKeyDown:tve(t)}})}function tve(t){let e=Wrt(t);return function(n,r){let i=zrt(r),s,o=e[nL(i,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let a=e[nL(i,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(Hrt&&r.ctrlKey&&r.altKey)&&(s=gf[r.keyCode])&&s!=i){let a=e[nL(s,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const e6=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function nve(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const rve=(t,e,n)=>{let r=nve(t,n);if(!r)return!1;let i=t6(r);if(!i){let o=r.blockRange(),a=o&&Uv(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(hve(t,i,e,-1))return!0;if(r.parent.content.size==0&&(Yy(s,"end")||dt.isSelectable(s)))for(let o=r.depth;;o--){let a=Jk(t.doc,r.before(o),r.after(o),We.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Yy(s,"end")?$t.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):dt.create(l.doc,i.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1},qrt=(t,e,n)=>{let r=nve(t,n);if(!r)return!1;let i=t6(r);return i?ive(t,i,e):!1},Grt=(t,e,n)=>{let r=ove(t,n);if(!r)return!1;let i=n6(r);return i?ive(t,i,e):!1};function ive(t,e,n){let r=e.nodeBefore,i=r,s=e.pos-1;for(;!i.isTextblock;s--){if(i.type.spec.isolating)return!1;let u=i.lastChild;if(!u)return!1;i=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=Jk(t.doc,s,l,We.empty);if(!c||c.from!=s||c instanceof xi&&c.slice.size>=l-s)return!1;if(n){let u=t.tr.step(c);u.setSelection(Ot.create(u.doc,s)),n(u.scrollIntoView())}return!0}function Yy(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const sve=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=t6(r)}let o=s&&s.nodeBefore;return!o||!dt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(dt.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function t6(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function ove(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const ave=(t,e,n)=>{let r=ove(t,n);if(!r)return!1;let i=n6(r);if(!i)return!1;let s=i.nodeAfter;if(hve(t,i,e,1))return!0;if(r.parent.content.size==0&&(Yy(s,"start")||dt.isSelectable(s))){let o=Jk(t.doc,r.before(),r.after(),We.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Yy(s,"start")?$t.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):dt.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},lve=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=n6(r)}let o=s&&s.nodeAfter;return!o||!dt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(dt.create(t.doc,s.pos)).scrollIntoView()),!0)};function n6(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const Yrt=(t,e)=>{let n=t.selection,r=n instanceof dt,i;if(r){if(n.node.isTextblock||!Lf(t.doc,n.from))return!1;i=n.from}else if(i=Xk(t.doc,n.from,-1),i==null)return!1;if(e){let s=t.tr.join(i);r&&s.setSelection(dt.create(s.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},Xrt=(t,e)=>{let n=t.selection,r;if(n instanceof dt){if(n.node.isTextblock||!Lf(t.doc,n.to))return!1;r=n.to}else if(r=Xk(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},Jrt=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&Uv(i);return s==null?!1:(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},cve=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function r6(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const Zrt=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=r6(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection($t.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},uve=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof Ra||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=r6(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(Ot.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},dve=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(fd(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let r=n.blockRange(),i=r&&Uv(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)};function Qrt(t){return(e,n)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof dt&&e.selection.node.isBlock)return!r.parentOffset||!fd(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let s=[],o,a,l=!1,c=!1;for(let f=r.depth;;f--)if(r.node(f).isBlock){l=r.end(f)==r.pos+(r.depth-f),c=r.start(f)==r.pos-(r.depth-f),a=r6(r.node(f-1).contentMatchAt(r.indexAfter(f-1))),s.unshift(l&&a?{type:a}:null),o=f;break}else{if(f==1)return!1;s.unshift(null)}let u=e.tr;(e.selection instanceof Ot||e.selection instanceof Ra)&&u.deleteSelection();let d=u.mapping.map(r.pos),h=fd(u.doc,d,s.length,s);if(h||(s[0]=a?{type:a}:null,h=fd(u.doc,d,s.length,s)),!h)return!1;if(u.split(d,s.length,s),!l&&c&&r.node(o).type!=a){let f=u.mapping.map(r.before(o)),y=u.doc.resolve(f);a&&r.node(o-1).canReplaceWith(y.index(),y.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return n&&n(u.scrollIntoView()),!0}}const eit=Qrt(),tit=(t,e)=>{let{$from:n,to:r}=t.selection,i,s=n.sharedDepth(r);return s==0?!1:(i=n.before(s),e&&e(t.tr.setSelection(dt.create(t.doc,i))),!0)};function nit(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||Lf(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function hve(t,e,n,r){let i=e.nodeBefore,s=e.nodeAfter,o,a,l=i.type.spec.isolating||s.type.spec.isolating;if(!l&&nit(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&a.matchType(o[0]||s.type).validEnd){if(n){let f=e.pos+s.nodeSize,y=Pe.empty;for(let x=o.length-1;x>=0;x--)y=Pe.from(o[x].create(null,y));y=Pe.from(i.copy(y));let b=t.tr.step(new Ii(e.pos-1,f,e.pos,f,new We(y,1,0),o.length,!0)),v=b.doc.resolve(f+2*o.length);v.nodeAfter&&v.nodeAfter.type==i.type&&Lf(b.doc,v.pos)&&b.join(v.pos),n(b.scrollIntoView())}return!0}let u=s.type.spec.isolating||r>0&&l?null:$t.findFrom(e,1),d=u&&u.$from.blockRange(u.$to),h=d&&Uv(d);if(h!=null&&h>=e.depth)return n&&n(t.tr.lift(d,h).scrollIntoView()),!0;if(c&&Yy(s,"start",!0)&&Yy(i,"end")){let f=i,y=[];for(;y.push(f),!f.isTextblock;)f=f.lastChild;let b=s,v=1;for(;!b.isTextblock;b=b.firstChild)v++;if(f.canReplace(f.childCount,f.childCount,b.content)){if(n){let x=Pe.empty;for(let E=y.length-1;E>=0;E--)x=Pe.from(y[E].copy(x));let C=t.tr.step(new Ii(e.pos-y.length,e.pos+s.nodeSize,e.pos+v,e.pos+s.nodeSize-v,new We(x,y.length,0),0,!0));n(C.scrollIntoView())}return!0}}return!1}function fve(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(n&&n(e.tr.setSelection(Ot.create(e.doc,t<0?i.start(s):i.end(s)))),!0):!1}}const rit=fve(-1),iit=fve(1);function sit(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&HU(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function Cee(t,e=null){return function(n,r){let i=!1;for(let s=0;s<n.selection.ranges.length&&!i;s++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[s];n.doc.nodesBetween(o,a,(l,c)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let u=n.doc.resolve(c),d=u.index();i=u.parent.canReplaceWith(d,d+1,t)}})}if(!i)return!1;if(r){let s=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];s.setBlockType(a,l,t,e)}r(s.scrollIntoView())}return!0}}function i6(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}i6(e6,rve,sve);i6(e6,ave,lve);i6(cve,uve,dve,eit);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function oit(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s);if(!o)return!1;let a=r?n.tr:null;return ait(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function ait(t,e,n,r=null){let i=!1,s=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);s=new sP(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new sP(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let a=HU(s,n,r,e);return a?(t&&lit(t,e,a,i,n),!0):!1}function lit(t,e,n,r,i){let s=Pe.empty;for(let u=n.length-1;u>=0;u--)s=Pe.from(n[u].type.create(n[u].attrs,s));t.step(new Ii(e.start-(r?2:0),e.end,e.start,e.end,new We(s,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==i&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,d=e.endIndex,h=!0;u<d;u++,h=!1)!h&&fd(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function cit(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return s?n?r.node(s.depth-1).type==t?uit(e,n,t,s):dit(e,n,s):!0:!1}}function uit(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new Ii(s-1,o,s,o,new We(Pe.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new sP(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=Uv(r);if(a==null)return!1;i.lift(r,a);let l=i.doc.resolve(i.mapping.map(s,-1)-1);return Lf(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function dit(t,e,n){let r=t.tr,i=n.parent;for(let f=n.end,y=n.endIndex-1,b=n.startIndex;y>b;y--)f-=i.child(y).nodeSize,r.delete(f-1,f+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?Pe.empty:Pe.from(i))))return!1;let d=s.pos,h=d+o.nodeSize;return r.step(new Ii(d-(a?1:0),h+(l?1:0),d+1,h-1,new We((a?Pe.empty:Pe.from(i.copy(Pe.empty))).append(l?Pe.empty:Pe.from(i.copy(Pe.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function hit(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=Pe.from(c?t.create():null),d=new We(Pe.from(t.create(null,Pe.from(a.type.create(null,u)))),c?3:1,0),h=s.start,f=s.end;n(e.tr.step(new Ii(h-(c?3:1),f,h,f,d,1,!0)).scrollIntoView())}return!0}}function nA(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}class rA{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:i}=n,{tr:s}=r,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(r).map(([h,f])=>[h,(...b)=>{const v=this.buildProps(c,n),x=f(...b)(v);return a.push(x),d}])),run:u};return d}createCan(e){const{rawCommands:n,state:r}=this,i=!1,s=e||r.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:nA({state:s,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}}class fit{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(i=>i.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(i=>i!==n):delete this.callbacks[e]),this}once(e,n){const r=(...i)=>{this.off(e,r),n.apply(this,i)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function rt(t,e,n){return t.config[e]===void 0&&t.parent?rt(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?rt(t.parent,e,n):null}):t.config[e]}function iA(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function pve(t){const e=[],{nodeExtensions:n,markExtensions:r}=iA(t),i=[...n,...r],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=rt(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([h,f])=>{e.push({type:d,name:h,attribute:{...s,...f}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=rt(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const h={...s,...d};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,e.push({type:o.name,name:u,attribute:h})})}),e}function ki(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function Ai(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=r[i]?r[i].split(" "):[],c=a.filter(u=>!l.includes(u));r[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[i]?r[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),r[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else r[i]=s}),r},{})}function S$(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>Ai(n,r),{})}function gve(t){return typeof t=="function"}function Ht(t,e=void 0,...n){return gve(t)?e?t.bind(e)(...n):t(...n):t}function pit(t={}){return Object.keys(t).length===0&&t.constructor===Object}function git(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function Eee(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):git(n.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function Tee(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&pit(n)?!1:n!=null))}function mve(t,e){var n;const r=pve(t),{nodeExtensions:i,markExtensions:s}=iA(t),o=(n=i.find(c=>rt(c,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(i.map(c=>{const u=r.filter(x=>x.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=t.reduce((x,C)=>{const E=rt(C,"extendNodeSchema",d);return{...x,...E?E(c):{}}},{}),f=Tee({...h,content:Ht(rt(c,"content",d)),marks:Ht(rt(c,"marks",d)),group:Ht(rt(c,"group",d)),inline:Ht(rt(c,"inline",d)),atom:Ht(rt(c,"atom",d)),selectable:Ht(rt(c,"selectable",d)),draggable:Ht(rt(c,"draggable",d)),code:Ht(rt(c,"code",d)),whitespace:Ht(rt(c,"whitespace",d)),linebreakReplacement:Ht(rt(c,"linebreakReplacement",d)),defining:Ht(rt(c,"defining",d)),isolating:Ht(rt(c,"isolating",d)),attrs:Object.fromEntries(u.map(x=>{var C;return[x.name,{default:(C=x==null?void 0:x.attribute)===null||C===void 0?void 0:C.default}]}))}),y=Ht(rt(c,"parseHTML",d));y&&(f.parseDOM=y.map(x=>Eee(x,u)));const b=rt(c,"renderHTML",d);b&&(f.toDOM=x=>b({node:x,HTMLAttributes:S$(x,u)}));const v=rt(c,"renderText",d);return v&&(f.toText=v),[c.name,f]})),l=Object.fromEntries(s.map(c=>{const u=r.filter(v=>v.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=t.reduce((v,x)=>{const C=rt(x,"extendMarkSchema",d);return{...v,...C?C(c):{}}},{}),f=Tee({...h,inclusive:Ht(rt(c,"inclusive",d)),excludes:Ht(rt(c,"excludes",d)),group:Ht(rt(c,"group",d)),spanning:Ht(rt(c,"spanning",d)),code:Ht(rt(c,"code",d)),attrs:Object.fromEntries(u.map(v=>{var x;return[v.name,{default:(x=v==null?void 0:v.attribute)===null||x===void 0?void 0:x.default}]}))}),y=Ht(rt(c,"parseHTML",d));y&&(f.parseDOM=y.map(v=>Eee(v,u)));const b=rt(c,"renderHTML",d);return b&&(f.toDOM=v=>b({mark:v,HTMLAttributes:S$(v,u)})),[c.name,f]}));return new tye({topNode:o,nodes:a,marks:l})}function rL(t,e){return e.nodes[t]||e.marks[t]||null}function Iee(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function sA(t,e){const n=Wg.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}const mit=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;const u=((c=(l=i.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%";n+=i.isAtom&&!i.isText?u:u.slice(0,Math.max(0,r-s))}),n};function s6(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class oA{constructor(e){this.find=e.find,this.handler=e.handler}}const yit=(t,e)=>{if(s6(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function GC(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(h=>h.type.spec.code))return!1;let u=!1;const d=mit(c)+s;return o.forEach(h=>{if(u)return;const f=yit(d,h.find);if(!f)return;const y=l.state.tr,b=nA({state:l.state,transaction:y}),v={from:r-(f[0].length-s.length),to:i},{commands:x,chain:C,can:E}=new rA({editor:n,state:b});h.handler({state:b,range:v,match:f,commands:x,chain:C,can:E})===null||!y.steps.length||(y.setMeta(a,{transform:y,from:r,to:i,text:s}),l.dispatch(y),u=!0)}),u}function vit(t){const{editor:e,rules:n}=t,r=new ls({state:{init(){return null},apply(i,s,o){const a=i.getMeta(r);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=sA(Pe.from(u),o.schema);const{from:d}=l,h=d+u.length;GC({editor:e,from:d,to:h,text:u,rules:n,plugin:r})}),i.selectionSet||i.docChanged?null:s}},props:{handleTextInput(i,s,o,a){return GC({editor:e,from:s,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&GC({editor:e,from:s.pos,to:s.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?GC({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function bit(t){return Object.prototype.toString.call(t).slice(8,-1)}function YC(t){return bit(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function aA(t,e){const n={...t};return YC(t)&&YC(e)&&Object.keys(e).forEach(r=>{YC(e[r])&&YC(t[r])?n[r]=aA(t[r],e[r]):n[r]=e[r]}),n}class Su{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ht(rt(this,"addOptions",{name:this.name}))),this.storage=Ht(rt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Su(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>aA(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Su(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Ht(rt(n,"addOptions",{name:n.name})),n.storage=Ht(rt(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=o.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}}function xit(t){return typeof t=="number"}class wit{constructor(e){this.find=e.find,this.handler=e.handler}}const Sit=(t,e,n)=>{if(s6(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(i=>{const s=[i.text];return s.index=i.index,s.input=t,s.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(i.replaceWith)),s}):[]};function Cit(t){const{editor:e,state:n,from:r,to:i,rule:s,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new rA({editor:e,state:n}),d=[];return n.doc.nodesBetween(r,i,(f,y)=>{if(!f.isTextblock||f.type.spec.code)return;const b=Math.max(r,y),v=Math.min(i,y+f.content.size),x=f.textBetween(b-y,v-y,void 0,"￼");Sit(x,s.find,o).forEach(E=>{if(E.index===void 0)return;const I=b+E.index+1,P=I+E[0].length,_={from:n.tr.mapping.map(I),to:n.tr.mapping.map(P)},A=s.handler({state:n,range:_,match:E,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});d.push(A)})}),d.every(f=>f!==null)}let XC=null;const Eit=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function Tit(t){const{editor:e,rules:n}=t;let r=null,i=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:h,rule:f,pasteEvt:y})=>{const b=u.tr,v=nA({state:u,transaction:b});if(!(!Cit({editor:e,state:v,from:Math.max(d-1,0),to:h.b-1,rule:f,pasteEvent:y,dropEvent:a})||!b.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,b}};return n.map(u=>new ls({view(d){const h=y=>{var b;r=!((b=d.dom.parentElement)===null||b===void 0)&&b.contains(y.target)?d.dom.parentElement:null,r&&(XC=e)},f=()=>{XC&&(XC=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(d,h)=>{if(s=r===d.dom.parentElement,a=h,!s){const f=XC;f!=null&&f.isEditable&&setTimeout(()=>{const y=f.state.selection;y&&f.commands.deleteRange({from:y.from,to:y.to})},10)}return!1},paste:(d,h)=>{var f;const y=(f=h.clipboardData)===null||f===void 0?void 0:f.getData("text/html");return o=h,i=!!(y!=null&&y.includes("data-pm-slice")),!1}}},appendTransaction:(d,h,f)=>{const y=d[0],b=y.getMeta("uiEvent")==="paste"&&!i,v=y.getMeta("uiEvent")==="drop"&&!s,x=y.getMeta("applyPasteRules"),C=!!x;if(!b&&!v&&!C)return;if(C){let{text:P}=x;typeof P=="string"?P=P:P=sA(Pe.from(P),f.schema);const{from:_}=x,A=_+P.length,D=Eit(P);return l({rule:u,state:f,from:_,to:{b:A},pasteEvt:D})}const E=h.doc.content.findDiffStart(f.doc.content),I=h.doc.content.findDiffEnd(f.doc.content);if(!(!xit(E)||!I||E===I.b))return l({rule:u,state:f,from:E,to:I,pasteEvt:o})}}))}function Iit(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class Ap{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=Ap.resolve(e),this.schema=mve(this.extensions,n),this.setupExtensions()}static resolve(e){const n=Ap.sort(Ap.flatten(e)),r=Iit(n.map(i=>i.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},i=rt(n,"addExtensions",r);return i?[n,...this.flatten(i())]:n}).flat(10)}static sort(e){return e.sort((r,i)=>{const s=rt(r,"priority")||100,o=rt(i,"priority")||100;return s>o?-1:s<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:rL(n.name,this.schema)},i=rt(n,"addCommands",r);return i?{...e,...i()}:e},{})}get plugins(){const{editor:e}=this,n=Ap.sort([...this.extensions].reverse()),r=[],i=[],s=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:rL(o.name,this.schema)},l=[],c=rt(o,"addKeyboardShortcuts",a);let u={};if(o.type==="mark"&&rt(o,"exitable",a)&&(u.ArrowRight=()=>Su.handleExit({editor:e,mark:o})),c){const b=Object.fromEntries(Object.entries(c()).map(([v,x])=>[v,()=>x({editor:e})]));u={...u,...b}}const d=Krt(u);l.push(d);const h=rt(o,"addInputRules",a);Iee(o,e.options.enableInputRules)&&h&&r.push(...h());const f=rt(o,"addPasteRules",a);Iee(o,e.options.enablePasteRules)&&f&&i.push(...f());const y=rt(o,"addProseMirrorPlugins",a);if(y){const b=y();l.push(...b)}return l}).flat();return[vit({editor:e,rules:r}),...Tit({editor:e,rules:i}),...s]}get attributes(){return pve(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=iA(this.extensions);return Object.fromEntries(n.filter(r=>!!rt(r,"addNodeView")).map(r=>{const i=this.attributes.filter(l=>l.type===r.name),s={name:r.name,options:r.options,storage:r.storage,editor:e,type:ki(r.name,this.schema)},o=rt(r,"addNodeView",s);if(!o)return[];const a=(l,c,u,d,h)=>{const f=S$(l,i);return o()({node:l,view:c,getPos:u,decorations:d,innerDecorations:h,editor:e,extension:r,HTMLAttributes:f})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:rL(e.name,this.schema)};e.type==="mark"&&(!((n=Ht(rt(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const i=rt(e,"onBeforeCreate",r),s=rt(e,"onCreate",r),o=rt(e,"onUpdate",r),a=rt(e,"onSelectionUpdate",r),l=rt(e,"onTransaction",r),c=rt(e,"onFocus",r),u=rt(e,"onBlur",r),d=rt(e,"onDestroy",r);i&&this.editor.on("beforeCreate",i),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}}class ss{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ht(rt(this,"addOptions",{name:this.name}))),this.storage=Ht(rt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ss(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>aA(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new ss({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Ht(rt(n,"addOptions",{name:n.name})),n.storage=Ht(rt(n,"addStorage",{name:n.name,options:n.options})),n}}function yve(t,e,n){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,i,(l,c,u,d)=>{var h;l.isBlock&&c>r&&(a+=s);const f=o==null?void 0:o[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)===null||h===void 0?void 0:h.slice(Math.max(r,c)-c,i-c))}),a}function o6(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const Pit=ss.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new ls({key:new Wa("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=o6(n);return yve(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),_it=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),kit=(t=!1)=>({commands:e})=>e.setContent("",t),Ait=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const y=Uv(f);if(a.type.isTextblock){const{defaultType:b}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,b)}(y||y===0)&&e.lift(f,y)})}),!0},Mit=t=>e=>t(e),Oit=()=>({state:t,dispatch:e})=>uve(t,e),Dit=(t,e)=>({editor:n,tr:r})=>{const{state:i}=n,s=i.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,s.content),r.setSelection(new Ot(r.doc.resolve(Math.max(o-1,0)))),!0},Rit=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const i=t.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===r.type){if(e){const a=i.before(s),l=i.after(s);t.delete(a,l).scrollIntoView()}return!0}return!1},Nit=t=>({tr:e,state:n,dispatch:r})=>{const i=ki(t,n.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},jit=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},Lit=()=>({state:t,dispatch:e})=>e6(t,e),Fit=()=>({commands:t})=>t.keyboardShortcut("Enter"),$it=()=>({state:t,dispatch:e})=>Zrt(t,e);function fP(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:s6(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function vve(t,e,n={}){return t.find(r=>r.type===e&&fP(Object.fromEntries(Object.keys(n).map(i=>[i,r.attrs[i]])),n))}function Pee(t,e,n={}){return!!vve(t,e,n)}function lA(t,e,n){var r;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(n=n||((r=i.node.marks[0])===null||r===void 0?void 0:r.attrs),!vve([...i.node.marks],e,n)))return;let o=i.index,a=t.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&Pee([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&Pee([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function $f(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const Bit=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const s=$f(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(i){const d=lA(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=Ot.create(o,d.from,d.to);n.setSelection(h)}}return!0},zit=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function bve(t){return t instanceof Ot}function Mp(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function xve(t,e=null){if(!e)return null;const n=$t.atStart(t),r=$t.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,s=r.to;return e==="all"?Ot.create(t,Mp(0,i,s),Mp(t.content.size,i,s)):Ot.create(t,Mp(e,i,s),Mp(e,i,s))}function Uit(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function a6(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const Hit=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(a6()||Uit())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(s&&t===null&&!bve(n.state.selection))return o(),!0;const a=xve(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},Vit=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),Wit=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),wve=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&wve(r)}return t};function Nb(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return wve(n)}function yw(t,e,n){if(t instanceof gc||t instanceof Pe)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,i=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return Pe.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(s){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),yw("",e,n)}if(i){if(n.errorOnInvalidContent){let o=!1,a="";const l=new tye({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?gy.fromSchema(l).parseSlice(Nb(t),n.parseOptions):gy.fromSchema(l).parse(Nb(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=gy.fromSchema(e);return n.slice?s.parseSlice(Nb(t),n.parseOptions).content:s.parse(Nb(t),n.parseOptions)}return yw("",e,n)}function Kit(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof xi||i instanceof Ii))return;const s=t.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection($t.near(t.doc.resolve(o),n))}const qit=t=>!("type"in t),Git=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{var o;if(i){n={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=v=>{s.emit("contentError",{editor:s,error:v,disableCollaboration:()=>{s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{yw(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(v){l(v)}try{a=yw(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!==null&&o!==void 0?o:s.options.enableContentCheck})}catch(v){return l(v),!1}let{from:u,to:d}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},h=!0,f=!0;if((qit(a)?a:[a]).forEach(v=>{v.check(),h=h?v.isText&&v.marks.length===0:!1,f=f?v.isBlock:!1}),u===d&&f){const{parent:v}=r.doc.resolve(u);v.isTextblock&&!v.type.spec.code&&!v.childCount&&(u-=1,d+=1)}let b;if(h){if(Array.isArray(e))b=e.map(v=>v.text||"").join("");else if(e instanceof Pe){let v="";e.forEach(x=>{x.text&&(v+=x.text)}),b=v}else typeof e=="object"&&e&&e.text?b=e.text:b=e;r.insertText(b,u,d)}else b=a,r.replaceWith(u,d,b);n.updateSelection&&Kit(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:b}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:b})}return!0},Yit=()=>({state:t,dispatch:e})=>Yrt(t,e),Xit=()=>({state:t,dispatch:e})=>Xrt(t,e),Jit=()=>({state:t,dispatch:e})=>rve(t,e),Zit=()=>({state:t,dispatch:e})=>ave(t,e),Qit=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Xk(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},est=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Xk(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},tst=()=>({state:t,dispatch:e})=>qrt(t,e),nst=()=>({state:t,dispatch:e})=>Grt(t,e);function Sve(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function rst(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))a6()||Sve()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}const ist=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=rst(t).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function vw(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?ki(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(d,h)=>{if(d.isText)return;const f=Math.max(r,h),y=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:y})});const l=i-r,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>fP(d.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}const sst=(t,e={})=>({state:n,dispatch:r})=>{const i=ki(t,n.schema);return vw(n,i,e)?Jrt(n,r):!1},ost=()=>({state:t,dispatch:e})=>dve(t,e),ast=t=>({state:e,dispatch:n})=>{const r=ki(t,e.schema);return cit(r)(e,n)},lst=()=>({state:t,dispatch:e})=>cve(t,e);function cA(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function _ee(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}const cst=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=cA(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=ki(t,r.schema)),a==="mark"&&(o=$f(t,r.schema)),i&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&n.setNodeMarkup(u,void 0,_ee(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(d=>{o===d.type&&n.addMark(u,u+c.nodeSize,o.create(_ee(d.attrs,e)))})})}),!0):!1},ust=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),dst=()=>({tr:t,dispatch:e})=>{if(e){const n=new Ra(t.doc);t.setSelection(n)}return!0},hst=()=>({state:t,dispatch:e})=>sve(t,e),fst=()=>({state:t,dispatch:e})=>lve(t,e),pst=()=>({state:t,dispatch:e})=>tit(t,e),gst=()=>({state:t,dispatch:e})=>iit(t,e),mst=()=>({state:t,dispatch:e})=>rit(t,e);function C$(t,e,n={},r={}){return yw(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const yst=(t,e=!1,n={},r={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{var l,c;const{doc:u}=s;if(n.preserveWhitespace!=="full"){const d=C$(t,i.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:i.options.enableContentCheck});return o&&s.replaceWith(0,u.content.size,d).setMeta("preventUpdate",!e),!0}return o&&s.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:u.content.size},t,{parseOptions:n,errorOnInvalidContent:(c=r.errorOnInvalidContent)!==null&&c!==void 0?c:i.options.enableContentCheck})};function Cve(t,e){const n=$f(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function vst(t,e){const n=new vye(t);return e.forEach(r=>{r.steps.forEach(i=>{n.step(i)})}),n}function bst(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function xst(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(i,s)=>{n(i)&&r.push({node:i,pos:s})}),r}function wst(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function l6(t){return e=>wst(e.$from,t)}function uA(t,e){const n=Ap.resolve(t);return mve(n,e)}function Sst(t,e){const n=uA(e),r=gc.fromJSON(n,t);return sA(r.content,n)}function Cst(t,e){const n=uA(e),r=Nb(t);return gy.fromSchema(n).parse(r).toJSON()}function Eve(t,e){const n={from:0,to:t.content.size};return yve(t,n,e)}function Est(t,e,n){const{blockSeparator:r=`

`,textSerializers:i={}}=n||{},s=uA(e),o=gc.fromJSON(s,t);return Eve(o,{blockSeparator:r,textSerializers:{...o6(s),...i}})}function Tst(t,e){const n=ki(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function Tve(t,e){const n=cA(typeof e=="string"?e:e.name,t.schema);return n==="node"?Tst(t,e):n==="mark"?Cve(t,e):{}}function Ist(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function Pst(t){const e=Ist(t);return e.length===1?e:e.filter((n,r)=>!e.filter((s,o)=>o!==r).some(s=>n.oldRange.from>=s.oldRange.from&&n.oldRange.to<=s.oldRange.to&&n.newRange.from>=s.newRange.from&&n.newRange.to<=s.newRange.to))}function _st(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);r.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),Pst(r)}function c6(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const s=n.resolve(t),o=lA(s,i.type);o&&r.push({mark:i,...o})}):n.nodesBetween(t,e,(i,s)=>{!i||(i==null?void 0:i.nodeSize)===void 0||r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}function QE(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}function E$(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?$f(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>fP(d.attrs,n,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,y=h.pos;t.doc.nodesBetween(f,y,(b,v)=>{if(!b.isText&&!b.marks.length)return;const x=Math.max(f,v),C=Math.min(y,v+b.nodeSize),E=C-x;o+=E,a.push(...b.marks.map(I=>({mark:I,from:x,to:C})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>fP(d.mark.attrs,n,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function kst(t,e,n={}){if(!e)return vw(t,null,n)||E$(t,null,n);const r=cA(e,t.schema);return r==="node"?vw(t,e,n):r==="mark"?E$(t,e,n):!1}function kee(t,e){const{nodeExtensions:n}=iA(e),r=n.find(o=>o.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=Ht(rt(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function u6(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(s=>{i!==!1&&(u6(s,{ignoreWhitespace:n,checkChildren:e})||(i=!1))}),i}return!1}function Ast(t){return t instanceof dt}function Mst(t,e,n){var r;const{selection:i}=e;let s=null;if(bve(i)&&(s=i.$cursor),s){const a=(r=t.storedMarks)!==null&&r!==void 0?r:s.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(n),y=!!n.isInSet(u.marks)||!u.marks.some(b=>b.type.excludes(n));c=f&&y}return!c}),c})}const Ost=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=$f(t,r.schema);if(i)if(o){const c=Cve(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;r.doc.nodesBetween(u,d,(h,f)=>{const y=Math.max(f,u),b=Math.min(f+h.nodeSize,d);h.marks.find(x=>x.type===l)?h.marks.forEach(x=>{l===x.type&&n.addMark(y,b,l.create({...x.attrs,...e}))}):n.addMark(y,b,l.create(e))})});return Mst(r,n,l)},Dst=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),Rst=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=ki(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>Cee(s,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>Cee(s,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Nst=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=Mp(t,0,r.content.size),s=dt.create(r,i);e.setSelection(s)}return!0},jst=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:s}=typeof t=="number"?{from:t,to:t}:t,o=Ot.atStart(r).from,a=Ot.atEnd(r).to,l=Mp(i,o,a),c=Mp(s,o,a),u=Ot.create(r,l,c);e.setSelection(u)}return!0},Lst=t=>({state:e,dispatch:n})=>{const r=ki(t,e.schema);return hit(r)(e,n)};function Aee(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e==null?void 0:e.includes(i.type.name));t.tr.ensureMarks(r)}}const Fst=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=QE(c,a.node().type.name,a.node().attrs);if(s instanceof dt&&s.node.isBlock)return!a.parentOffset||!fd(o,a.pos)?!1:(r&&(t&&Aee(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:bst(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,y=fd(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!y&&fd(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(y=!0,f=h?[{type:h,attrs:u}]:void 0),r){if(y&&(s instanceof Ot&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const b=e.mapping.map(a.before()),v=e.doc.resolve(b);a.node(-1).canReplaceWith(v.index(),v.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}t&&Aee(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return y},$st=(t,e={})=>({tr:n,state:r,dispatch:i,editor:s})=>{var o;const a=ki(t,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let x=Pe.empty;const C=l.index(-1)?1:l.index(-2)?2:3;for(let D=l.depth-C;D>=l.depth-3;D-=1)x=Pe.from(l.node(D).copy(x));const E=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,I={...QE(h,l.node().type.name,l.node().attrs),...e},P=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(I))||void 0;x=x.append(Pe.from(a.createAndFill(null,P)||void 0));const _=l.before(l.depth-(C-1));n.replace(_,l.after(-E),new We(x,4-C,0));let A=-1;n.doc.nodesBetween(_,n.doc.content.size,(D,L)=>{if(A>-1)return!1;D.isTextblock&&D.content.size===0&&(A=L+1)}),A>-1&&n.setSelection(Ot.near(n.doc.resolve(A))),n.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,y={...QE(h,d.type.name,d.attrs),...e},b={...QE(h,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const v=f?[{type:a,attrs:y},{type:f,attrs:b}]:[{type:a,attrs:y}];if(!fd(n.doc,l.pos,2))return!1;if(i){const{selection:x,storedMarks:C}=r,{splittableMarks:E}=s.extensionManager,I=C||x.$to.parentOffset&&x.$from.marks();if(n.split(l.pos,2,v).scrollIntoView(),!I||!i)return!0;const P=I.filter(_=>E.includes(_.type.name));n.ensureMarks(P)}return!0},iL=(t,e)=>{const n=l6(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===(i==null?void 0:i.type)&&Lf(t.doc,n.pos)&&t.join(n.pos),!0},sL=(t,e)=>{const n=l6(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===(i==null?void 0:i.type)&&Lf(t.doc,r)&&t.join(r),!0},Bst=(t,e,n,r={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=ki(t,o.schema),y=ki(e,o.schema),{selection:b,storedMarks:v}=o,{$from:x,$to:C}=b,E=x.blockRange(C),I=v||b.$to.parentOffset&&b.$from.marks();if(!E)return!1;const P=l6(_=>kee(_.type.name,d))(b);if(E.depth>=1&&P&&E.depth-P.depth<=1){if(P.node.type===f)return c.liftListItem(y);if(kee(P.node.type.name,d)&&f.validContent(P.node.content)&&a)return l().command(()=>(s.setNodeMarkup(P.pos,f),!0)).command(()=>iL(s,f)).command(()=>sL(s,f)).run()}return!n||!I||!a?l().command(()=>u().wrapInList(f,r)?!0:c.clearNodes()).wrapInList(f,r).command(()=>iL(s,f)).command(()=>sL(s,f)).run():l().command(()=>{const _=u().wrapInList(f,r),A=I.filter(D=>h.includes(D.type.name));return s.ensureMarks(A),_?!0:c.clearNodes()}).wrapInList(f,r).command(()=>iL(s,f)).command(()=>sL(s,f)).run()},zst=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=$f(t,r.schema);return E$(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},Ust=(t,e,n={})=>({state:r,commands:i})=>{const s=ki(t,r.schema),o=ki(e,r.schema),a=vw(r,s,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...n})},Hst=(t,e={})=>({state:n,commands:r})=>{const i=ki(t,n.schema);return vw(n,i,e)?r.lift(i):r.wrapIn(i,e)},Vst=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},Wst=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},Kst=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=$f(t,r.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const y=(s=c.marks().find(v=>v.type===l))===null||s===void 0?void 0:s.attrs,b=lA(c,l,y);b&&(h=b.from,f=b.to),n.removeMark(h,f,l)}else d.forEach(h=>{n.removeMark(h.$from.pos,h.$to.pos,l)});return n.removeStoredMark(l),!0},qst=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=cA(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=ki(t,r.schema)),a==="mark"&&(o=$f(t,r.schema)),i&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let d,h,f,y;n.selection.empty?r.doc.nodesBetween(c,u,(b,v)=>{s&&s===b.type&&(f=Math.max(v,c),y=Math.min(v+b.nodeSize,u),d=v,h=b)}):r.doc.nodesBetween(c,u,(b,v)=>{v<c&&s&&s===b.type&&(f=Math.max(v,c),y=Math.min(v+b.nodeSize,u),d=v,h=b),v>=c&&v<=u&&(s&&s===b.type&&n.setNodeMarkup(v,void 0,{...b.attrs,...e}),o&&b.marks.length&&b.marks.forEach(x=>{if(o===x.type){const C=Math.max(v,c),E=Math.min(v+b.nodeSize,u);n.addMark(C,E,o.create({...x.attrs,...e}))}}))}),h&&(d!==void 0&&n.setNodeMarkup(d,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(b=>{o===b.type&&n.addMark(f,y,o.create({...b.attrs,...e}))}))}),!0):!1},Gst=(t,e={})=>({state:n,dispatch:r})=>{const i=ki(t,n.schema);return sit(i,e)(n,r)},Yst=(t,e={})=>({state:n,dispatch:r})=>{const i=ki(t,n.schema);return oit(i,e)(n,r)};var Xst=Object.freeze({__proto__:null,blur:_it,clearContent:kit,clearNodes:Ait,command:Mit,createParagraphNear:Oit,cut:Dit,deleteCurrentNode:Rit,deleteNode:Nit,deleteRange:jit,deleteSelection:Lit,enter:Fit,exitCode:$it,extendMarkRange:Bit,first:zit,focus:Hit,forEach:Vit,insertContent:Wit,insertContentAt:Git,joinBackward:Jit,joinDown:Xit,joinForward:Zit,joinItemBackward:Qit,joinItemForward:est,joinTextblockBackward:tst,joinTextblockForward:nst,joinUp:Yit,keyboardShortcut:ist,lift:sst,liftEmptyBlock:ost,liftListItem:ast,newlineInCode:lst,resetAttributes:cst,scrollIntoView:ust,selectAll:dst,selectNodeBackward:hst,selectNodeForward:fst,selectParentNode:pst,selectTextblockEnd:gst,selectTextblockStart:mst,setContent:yst,setMark:Ost,setMeta:Dst,setNode:Rst,setNodeSelection:Nst,setTextSelection:jst,sinkListItem:Lst,splitBlock:Fst,splitListItem:$st,toggleList:Bst,toggleMark:zst,toggleNode:Ust,toggleWrap:Hst,undoInputRule:Vst,unsetAllMarks:Wst,unsetMark:Kst,updateAttributes:qst,wrapIn:Gst,wrapInList:Yst});const Jst=ss.create({name:"commands",addCommands(){return{...Xst}}}),Zst=ss.create({name:"drop",addProseMirrorPlugins(){return[new ls({key:new Wa("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),Qst=ss.create({name:"editable",addProseMirrorPlugins(){return[new ls({key:new Wa("editable"),props:{editable:()=>this.editor.options.editable}})]}}),eot=new Wa("focusEvents"),tot=ss.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new ls({key:eot,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),not=ss.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,y=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,b=y.parent.type.spec.isolating,v=d.pos-d.parentOffset,x=b&&y.parent.childCount===1?v===d.pos:$t.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!x||x&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return a6()||Sve()?s:i},addProseMirrorPlugins(){return[new ls({key:new Wa("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(b=>b.getMeta("composition")))return;const r=t.some(b=>b.docChanged)&&!e.doc.eq(n.doc),i=t.some(b=>b.getMeta("preventClearDocument"));if(!r||i)return;const{empty:s,from:o,to:a}=e.selection,l=$t.atStart(e.doc).from,c=$t.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!u6(n.doc))return;const h=n.tr,f=nA({state:n,transaction:h}),{commands:y}=new rA({editor:this.editor,state:f});if(y.clearNodes(),!!h.steps.length)return h}})]}}),rot=ss.create({name:"paste",addProseMirrorPlugins(){return[new ls({key:new Wa("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),iot=ss.create({name:"tabindex",addProseMirrorPlugins(){return[new ls({key:new Wa("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Cp{get name(){return this.node.type.name}constructor(e,n,r=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=i}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new Cp(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Cp(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Cp(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const i=n.isBlock&&!n.isTextblock,s=n.isAtom&&!n.isText,o=this.pos+r+(s?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!i&&a.depth<=this.depth)return;const l=new Cp(a,this.editor,i,i?n:null);i&&(l.actualDepth=this.depth+1),e.push(new Cp(a,this.editor,i,i?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,i=this.parent;for(;i&&!r;){if(i.node.type.name===e)if(Object.keys(n).length>0){const s=i.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==n[l])break}}else r=i;i=i.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let i=[];if(!this.children||this.children.length===0)return i;const s=Object.keys(n);return this.children.forEach(o=>{r&&i.length>0||(o.node.type.name===e&&s.every(l=>n[l]===o.node.attrs[l])&&i.push(o),!(r&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,n,r))))}),i}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const sot=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function oot(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}class aot extends fit{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:i})=>this.options.onDrop(n,r,i)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=oot(sot,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=gve(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}createExtensionManager(){var e,n;const i=[...this.options.enableCoreExtensions?[Qst,Pit.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),Jst,tot,not,iot,Zst,rot].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s==null?void 0:s.type));this.extensionManager=new Ap(i,this)}createCommandManager(){this.commandManager=new rA({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=C$(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=C$(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=xve(n,this.options.autofocus);this.view=new eve(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:ty.create({doc:n,selection:r||void 0})});const i=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(i),this.createNodeViews(),this.prependClass();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),s=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),s&&this.emit("blur",{editor:this,event:s.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return Tve(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return kst(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return sA(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return Eve(this.state.doc,{blockSeparator:n,textSerializers:{...o6(this.schema),...r}})}get isEmpty(){return u6(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new Cp(n,this)}get $doc(){return this.$pos(0)}}function vg(t){return new oA({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Ht(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(c6(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(b=>b===t.type&&b!==f.mark.type)).filter(f=>f.to>c).length)return null;u<n.to&&s.delete(u,n.to),c>n.from&&s.delete(n.from+l,c);const h=n.from+l+o.length;s.addMark(n.from+l,h,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}function lot(t){return new oA({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Ht(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;const l=t.type.create(i);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const d=r[0][r[0].length-1];s.insertText(d,o+r[0].length-1),s.replaceWith(u,a,l)}else if(r[0]){const c=t.type.isInline?o:o-1;s.insert(c,t.type.create(i)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()}})}function T$(t){return new oA({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=Ht(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)}})}function bw(t){return new oA({find:t.find,handler:({state:e,range:n,match:r,chain:i})=>{const s=Ht(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&HU(l,t.type,s);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:h}=e,{splittableMarks:f}=t.editor.extensionManager,y=h||d.$to.parentOffset&&d.$from.marks();if(y){const b=y.filter(v=>f.includes(v.type.name));o.ensureMarks(b)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(d,s).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&Lf(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&o.join(n.from-1)}})}let Ac=class I${constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ht(rt(this,"addOptions",{name:this.name}))),this.storage=Ht(rt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new I$(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>aA(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new I$(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Ht(rt(n,"addOptions",{name:n.name})),n.storage=Ht(rt(n,"addStorage",{name:n.name,options:n.options})),n}};function mf(t){return new wit({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:i})=>{const s=Ht(t.getAttributes,void 0,r,i);if(s===!1||s===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),d=n.from+l.indexOf(a),h=d+a.length;if(c6(n.from,n.to,e.doc).filter(y=>y.mark.type.excluded.find(v=>v===t.type&&v!==y.mark.type)).filter(y=>y.to>d).length)return null;h<n.to&&o.delete(h,n.to),d>n.from&&o.delete(n.from+u,d),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}function cot(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof dt){const s=r.index();return r.parent.canReplaceWith(s,s+1,e)}let i=r.depth;for(;i>=0;){const s=r.index(i);if(r.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}const uot=new zs;function dot(t){return uot.get(t,()=>uA(t.extensions??[]))}function d6(t,e,n){const{tipTapConfig:r,addFontsFromNode:i}=t.getTextOptions();it(r,"textOptions.tipTapConfig must be set to use rich text"),it(i,"textOptions.addFontsFromNode must be set to use rich text");const s=dot(r),o=gc.fromJSON(s,e),a=new Set;function l(u){a.add(u)}function c(u,d){d=i(u,d,l);for(const h of u.children)c(h,d)}return c(o,n),Array.from(a)}async function hot({shouldReload:t=!0}={}){SWe();for(const e of QI.connectedInstances)await e.close();await Promise.all(LU().map(e=>aie(e))),wWe(),t&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=hot);function fot(t,e="_blank"){Dk.openWindow(t,e)}Fd("@tldraw/editor","3.15.3","esm");class rn{constructor(){N(this,"commands",[]);N(this,"lastMoveTo",null)}static lineThroughPoints(e,n){const r=new rn;r.moveTo(e[0].x,e[0].y,{...n,offset:(n==null?void 0:n.endOffsets)??(n==null?void 0:n.offset)});for(let i=1;i<e.length;i++){const s=i===e.length-1;r.lineTo(e[i].x,e[i].y,s?{offset:n==null?void 0:n.endOffsets}:void 0)}return r}static cubicSplineThroughPoints(e,n){const r=new rn,i=e.length,s=i-2,o=1.25;r.moveTo(e[0].x,e[0].y,{...n,offset:(n==null?void 0:n.endOffsets)??(n==null?void 0:n.offset)});for(let a=0;a<i-1;a++){const l=a===0?e[0]:e[a-1],c=e[a],u=e[a+1],d=a===s?u:e[a+2];let h,f,y,b;a===0?(h=l.x,f=l.y):(h=c.x+(u.x-l.x)/6*o,f=c.y+(u.y-l.y)/6*o);let v;a===s?(y=u.x,b=u.y,v={offset:n==null?void 0:n.endOffsets}):(y=u.x-(d.x-c.x)/6*o,b=u.y-(d.y-c.y)/6*o),r.cubicBezierTo(u.x,u.y,h,f,y,b,v)}return r}assertHasMoveTo(){return it(this.lastMoveTo,"Start an SVGPathBuilder with `.moveTo()`"),this.lastMoveTo}moveTo(e,n,r){return this.lastMoveTo={type:"move",x:e,y:n,closeIdx:null,isClose:!1,opts:r},this.commands.push(this.lastMoveTo),this}lineTo(e,n,r){return this.assertHasMoveTo(),this.commands.push({type:"line",x:e,y:n,isClose:!1,opts:r}),this}circularArcTo(e,n,r,i,s,o){return this.arcTo(e,e,n,r,0,i,s,o)}arcTo(e,n,r,i,s,o,a,l){this.assertHasMoveTo();const c=this.commands[this.commands.length-1].x,u=this.commands[this.commands.length-1].y;if(c===o&&u===a)return this;if(e===0||n===0)return this.lineTo(o,a,l);const d=s,h=Math.sin(d),f=Math.cos(d);let y=Math.abs(e),b=Math.abs(n);const v=(c-o)/2,x=(u-a)/2,C=f*v+h*x,E=-h*v+f*x,I=C*C/(y*y)+E*E/(b*b);if(I>1){const Ae=Math.sqrt(I);y*=Ae,b*=Ae}const P=r!==i?1:-1,_=y*y*b*b-y*y*E*E-b*b*C*C,A=y*y*E*E+b*b*C*C;let D=_/A;D=D<0?0:D;const L=P*Math.sqrt(D),z=L*(y*E/b),$=L*(-(b*C)/y),H=f*z-h*$+(c+o)/2,R=h*z+f*$+(u+a)/2,j=(C-z)/y,B=(E-$)/b,K=(-C-z)/y,G=(-E-$)/b,V=Math.atan2(B,j);let W=Math.atan2(G,K);!i&&W>V?W-=2*Math.PI:i&&W<V&&(W+=2*Math.PI);const Z=W-V,U=Math.max(y,b)*Math.abs(Z),J=Math.min(4,Math.ceil(Math.abs(Z)/(Math.PI/2))),ge=Math.ceil(Gk(U)/J),_e=Z/J,fe=Ae=>({x:H+y*Math.cos(Ae)*f-b*Math.sin(Ae)*h,y:R+y*Math.cos(Ae)*h+b*Math.sin(Ae)*f}),je=Ae=>({x:-y*Math.sin(Ae)*f-b*Math.cos(Ae)*h,y:-y*Math.sin(Ae)*h+b*Math.cos(Ae)*f});for(let Ae=0;Ae<J;Ae++){const ke=V+Ae*_e,le=V+(Ae+1)*_e,ve=le-ke,qe=fe(ke),de=fe(le),pe=je(ke),Se=je(le),Fe=4/3*Math.tan(ve/4),ut=qe.x+Fe*pe.x,Tt=qe.y+Fe*pe.y,pn=de.x-Fe*Se.x,qn=de.y-Fe*Se.y,ci=Ae===0?l:{...l,mergeWithPrevious:!0};this.cubicBezierToWithResolution(de.x,de.y,ut,Tt,pn,qn,ci,ge)}return this}cubicBezierTo(e,n,r,i,s,o,a){return this.cubicBezierToWithResolution(e,n,r,i,s,o,a)}cubicBezierToWithResolution(e,n,r,i,s,o,a,l){return this.assertHasMoveTo(),this.commands.push({type:"cubic",x:e,y:n,cp1:{x:r,y:i},cp2:{x:s,y:o},isClose:!1,opts:a,resolution:l}),this}close(){const e=this.assertHasMoveTo(),n=this.commands[this.commands.length-1];return Nr(e.x,n.x)&&Nr(e.y,n.y)?n.isClose=!0:this.commands.push({type:"line",x:e.x,y:e.y,isClose:!0}),e.closeIdx=this.commands.length-1,this.lastMoveTo=null,this}toD(e={}){var u,d,h;const{startIdx:n=0,endIdx:r=this.commands.length,onlyFilled:i=!1}=e,s=[];let o=!1,a=!1,l=!1;const c=f=>{if(a||f===0)return;a=!0;const y=this.commands[f-1];s.push("M",te(y.x),te(y.y))};for(let f=n;f<r;f++){const y=this.commands[f];switch(y.type){case"move":{const b=((u=y.opts)==null?void 0:u.geometry)===!1?!1:((h=(d=y.opts)==null?void 0:d.geometry)==null?void 0:h.isFilled)??!1;i&&!b?o=!0:(o=!1,a=!0,l=!0,s.push("M",te(y.x),te(y.y)));break}case"line":if(o)break;c(f),y.isClose&&l?s.push("Z"):s.push("L",te(y.x),te(y.y));break;case"cubic":if(o)break;c(f),s.push("C",te(y.cp1.x),te(y.cp1.y),te(y.cp2.x),te(y.cp2.y),te(y.x),te(y.y));break;default:Yt(y,"type")}}return s.join(" ")}toSvg(e){if(e.forceSolid)return this.toSolidSvg(e);switch(e.style){case"solid":return this.toSolidSvg(e);case"dashed":case"dotted":return this.toDashedSvg(e);case"draw":return this.toDrawSvg(e);default:Yt(e,"style")}}toGeometry(){var r,i,s,o,a,l,c,u;const e=[];let n=null;for(let d=0;d<this.commands.length;d++){const h=this.commands[d];h.type==="move"&&(n&&((r=n.opts)==null?void 0:r.geometry)!==!1&&e.push(new P$(this,n.startIdx,d,{...(i=n.opts)==null?void 0:i.geometry,isFilled:((o=(s=n.opts)==null?void 0:s.geometry)==null?void 0:o.isFilled)??!1,isClosed:n.moveCommand.closeIdx!==null})),n={startIdx:d,moveCommand:h,opts:h.opts,isClosed:!1}),h.isClose&&(it(n,"No current move command"),n.isClosed=!0)}return n&&((a=n.opts)==null?void 0:a.geometry)!==!1&&e.push(new P$(this,n.startIdx,this.commands.length,{...(l=n.opts)==null?void 0:l.geometry,isFilled:((u=(c=n.opts)==null?void 0:c.geometry)==null?void 0:u.isFilled)??!1,isClosed:n.moveCommand.closeIdx!==null})),it(e.length>0),e.length===1?e[0]:new yo({children:e})}toSolidSvg(e){const{strokeWidth:n,props:r}=e;return g.jsx("path",{strokeWidth:n,d:this.toD({onlyFilled:e.onlyFilled}),...r})}toDashedSvg(e){var b,v,x,C,E;const{style:n,strokeWidth:r,snap:i,lengthRatio:s,props:{markerStart:o,markerEnd:a,...l}={}}=e,c=[];let u=!1,d=!1,h,f=null;const y=()=>{if(!f)return;const{startIdx:I,endIdx:P,isFirst:_,isLast:A,length:D,lineOpts:L,pathIsClosed:z}=f;if(f=null,I===P&&this.commands[I].type==="move")return;const $=(L==null?void 0:L.dashStart)??e.start,H=(L==null?void 0:L.dashEnd)??e.end,{strokeDasharray:R,strokeDashoffset:j}=lfe(D,r,{style:n,snap:i,lengthRatio:s,start:_?$??(z?"outset":"none"):"outset",end:A?H??(z?"outset":"none"):"outset"}),B=this.toD({startIdx:I,endIdx:P+1});c.push(g.jsx("path",{d:B,strokeDasharray:R,strokeDashoffset:j,markerStart:_?o:void 0,markerEnd:A?a:void 0},c.length))};for(let I=0;I<this.commands.length;I++){const P=this.commands[I],_=this.commands[I-1];if(P.type==="move"){u=P.closeIdx!==null;const z=((b=P.opts)==null?void 0:b.geometry)===!1?!1:((x=(v=P.opts)==null?void 0:v.geometry)==null?void 0:x.isFilled)??!1;e.onlyFilled&&!z?d=!0:(d=!1,h=P.opts);continue}if(d)continue;const A=this.calculateSegmentLength(_,P),D=_.type==="move",L=P.isClose||I===this.commands.length-1||((C=this.commands[I+1])==null?void 0:C.type)==="move";f&&((E=P.opts)!=null&&E.mergeWithPrevious)?(f.length+=A,f.endIdx=I,f.isLast=L):(y(),f={startIdx:I,endIdx:I,isFirst:D,isLast:L,length:A,lineOpts:h,pathIsClosed:u})}return y(),g.jsx("g",{strokeWidth:r,...l,children:c})}toDrawSvg(e){return g.jsx("path",{strokeWidth:e.strokeWidth,d:this.toDrawD(e),...e.props})}toDrawD(e){var h,f,y,b,v,x,C;const{strokeWidth:n,randomSeed:r,offset:i=n/3,roundness:s=n*2,passes:o=2,onlyFilled:a=!1}=e,l=[],c=this.getCommandInfo(),u=[];let d=null;for(let E=0;E<this.commands.length;E++){const I=this.commands[E],P=((h=I.opts)==null?void 0:h.offset)??i,_=((f=I.opts)==null?void 0:f.roundness)??s;I.type==="move"&&(d=E);const A=I.isClose?Ps(d)+1:!this.commands[E+1]||this.commands[E+1].type==="move"?void 0:E+1,D=A!==void 0&&this.commands[A]&&((y=this.commands[A])==null?void 0:y.type)!=="move"?c[A]:void 0,L=Mee[I.type],z=A!==void 0?Mee[this.commands[A].type]:!1,$=c[E],H=$==null?void 0:$.tangentEnd,R=D==null?void 0:D.tangentStart,j=L&&z&&H&&R&&M.Len2(H)>.01&&M.Len2(R)>.01?yu(Math.abs(M.AngleBetween(H,R)),[Math.PI/2,Math.PI],[_,0],!0):0,K=Math.min(($==null?void 0:$.length)??1/0,(D==null?void 0:D.length)??1/0)-j*2,G=Ct(P,0,K/4),V=Math.min(j,(($==null?void 0:$.length)??1/0)/4),W=Math.min(j,((D==null?void 0:D.length)??1/0)/4),Z={command:I,offsetAmount:G,roundnessBefore:V,roundnessAfter:W,tangentToPrev:(b=c[E])==null?void 0:b.tangentEnd,tangentToNext:D==null?void 0:D.tangentStart,moveDidClose:!1};if(u.push(Z),I.isClose&&d!==null){const U=u[d];U.moveDidClose=!0,U.roundnessAfter=W}else I.type==="move"&&(d=E)}for(let E=0;E<o;E++){const I=Fg(r+E);let P={x:0,y:0},_=!1;for(const{command:A,offsetAmount:D,roundnessBefore:L,roundnessAfter:z,tangentToNext:$,tangentToPrev:H}of u){const R=A.isClose?P:{x:I()*D,y:I()*D};if(A.type==="move"){P=R;const G=((v=A.opts)==null?void 0:v.geometry)===!1?!1:((C=(x=A.opts)==null?void 0:x.geometry)==null?void 0:C.isFilled)??!1;a&&!G?_=!0:_=!1}if(_)continue;const j=M.Add(A,R),B=$&&z>0?M.Mul($,-z).add(j):j,K=H&&L>0?M.Mul(H,L).add(j):j;if(B===j||K===j)switch(A.type){case"move":l.push("M",te(B.x),te(B.y));break;case"line":l.push("L",te(B.x),te(B.y));break;case"cubic":{const G=M.Add(A.cp1,R),V=M.Add(A.cp2,R);l.push("C",te(G.x),te(G.y),te(V.x),te(V.y),te(B.x),te(B.y));break}default:Yt(A,"type")}else switch(A.type){case"move":l.push("M",te(B.x),te(B.y));break;case"line":l.push("L",te(K.x),te(K.y),"Q",te(j.x),te(j.y),te(B.x),te(B.y));break;case"cubic":{const G=M.Add(A.cp1,R),V=M.Add(A.cp2,R);l.push("C",te(G.x),te(G.y),te(V.x),te(V.y),te(j.x),te(j.y));break}default:Yt(A,"type")}}}return l.join(" ")}calculateSegmentLength(e,n){switch(n.type){case"move":return 0;case"line":return M.Dist(e,n);case"cubic":return jb.length(e.x,e.y,n.cp1.x,n.cp1.y,n.cp2.x,n.cp2.y,n.x,n.y);default:Yt(n,"type")}}getCommands(){return this.commands}getCommandInfo(){const e=[];for(let n=1;n<this.commands.length;n++){const r=this.commands[n-1],i=this.commands[n];if(i._info){e[n]=i._info;continue}if(i.type==="move")continue;let s,o;switch(i.type){case"line":s=o=M.Sub(r,i).uni();break;case"cubic":{s=M.Sub(i.cp1,r).uni(),o=M.Sub(i.cp2,i).uni();break}default:Yt(i,"type")}i._info={tangentStart:s,tangentEnd:o,length:this.calculateSegmentLength(r,i)},e[n]=i._info}return e}}const Mee={line:!0,move:!0,cubic:!1};class P$ extends jf{constructor(n,r,i,s){super(s);N(this,"_segments",null);this.path=n,this.startIdx=r,this.endIdx=i}getSegments(){if(this._segments)return this._segments;this._segments=[];let n=this.path.commands[this.startIdx];it(n.type==="move");for(let r=this.startIdx+1;r<this.endIdx;r++){const i=this.path.commands[r];switch(it(i.type!=="move"),i.type){case"line":this._segments.push(new Vy({start:M.From(n),end:M.From(i)}));break;case"cubic":{this._segments.push(new $U({start:M.From(n),cp1:M.From(i.cp1),cp2:M.From(i.cp2),end:M.From(i),resolution:i.resolution}));break}default:Yt(i,"type")}n=i}return this._segments}getVertices(n){const r=this.getSegments().flatMap(i=>i.getVertices(n)).filter((i,s,o)=>{const a=o[s-1];return a?!M.Equals(a,i):!0});if(this.isClosed){const i=r[r.length-1],s=r[0];M.Equals(i,s)||r.push(s)}return r}nearestPoint(n,r){let i=null,s=1/0;for(const o of this.getSegments()){const a=o.nearestPoint(n),l=M.Dist2(n,a);l<s&&(s=l,i=a)}return it(i,"No nearest point found"),i}hitTestLineSegment(n,r,i=0,s){return super.hitTestLineSegment(n,r,i,s)}getSvgPathData(){return this.path.toD({startIdx:this.startIdx,endIdx:this.endIdx})}}/*!
 * Adapted from https://github.com/adobe-webplatform/Snap.svg/tree/master
 * Apache License: https://github.com/adobe-webplatform/Snap.svg/blob/master/LICENSE
 * https://github.com/adobe-webplatform/Snap.svg/blob/c8e483c9694517e24b282f8f59f985629f4994ce/dist/snap.svg.js#L5786
 */const jb={base3(t,e,n,r,i){const s=-3*e+9*n-9*r+3*i,o=t*s+6*e-12*n+6*r;return t*o-3*e+3*n},length(t,e,n,r,i,s,o,a,l=1){l=l>1?1:l<0?0:l;const c=l/2,u=12;let d=0;d=0;for(let h=0;h<u;h++){const f=c*jb.Tvalues[h]+c,y=jb.base3(f,t,n,i,o),b=jb.base3(f,e,r,s,a),v=y*y+b*b;d+=jb.Cvalues[h]*Math.sqrt(v)}return c*d},Tvalues:[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues:[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472]};function Ive(){const[t,e]=S.useState(!1);return S.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const n=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(n.matches)};return r(),n.addEventListener("change",r),()=>n.removeEventListener("change",r)},[]),t}const _$=S.createContext(null);function pot({children:t}){const e=ES("a11y",{msg:"",priority:"assertive"}),n=S.useContext(_$),r=S.useMemo(()=>({currentMsg:e,announce(i){i&&e.set(i)}}),[e]);return n?g.jsx(g.Fragment,{children:t}):g.jsx(_$.Provider,{value:r,children:t})}function dA(){const t=S.useContext(_$);if(!t)throw new Error("useA11y must be used within a A11yContext.Provider");return t}const Pve=S.createContext(null);function _ve({assetUrls:t,children:e}){return S.useEffect(()=>{for(const n of Object.values(t.icons)){if(!n)continue;const r=rw();r.crossOrigin="anonymous",r.src=n,r.decode()}for(const n of Object.values(t.embedIcons)){if(!n)continue;const r=rw();r.crossOrigin="anonymous",r.src=n,r.decode()}},[t]),g.jsx(Pve.Provider,{value:t,children:e})}function h6(){const t=S.useContext(Pve);if(!t)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return t}const k$={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.download-original":"Download original","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-kbd-shortcuts":"Open keyboard shortcuts","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-keyboard-shortcuts.menu":"Keyboard shortcuts","action.toggle-keyboard-shortcuts":"Toggle keyboard shortcuts","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.files.amount-too-many":"Too many files","assets.url.failed":"Couldn’t load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.cloud":"Cloud","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.heart":"Heart","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","arrow-kind-style.arc":"Arc","arrow-kind-style.elbow":"Elbow","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.heart":"Heart","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.media":"Media","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","tool.image-zoom":"Zoom","tool.replace-media":"Replace media","tool.flip-horz":"Flip horizontally","tool.flip-vert":"Flip vertically","tool.rotate-cw":"Rotate","tool.aspect-ratio":"Aspect ratio","tool.aspect-ratio.original":"Original","tool.aspect-ratio.square":"Square (1:1)","tool.aspect-ratio.circle":"Circle (1:1)","tool.aspect-ratio.landscape":"Landscape (4:3)","tool.aspect-ratio.portrait":"Portrait (3:4)","tool.aspect-ratio.wide":"Wide (16:9)","tool.image-toolbar-title":"Image tools","tool.image-crop":"Crop image","tool.media-alt-text":"Alternative text","tool.media-alt-text-desc":"Give a description…","tool.media-alt-text-confirm":"Confirm","tool.rich-text-bold":"Bold","tool.rich-text-italic":"Italic","tool.rich-text-code":"Code","tool.rich-text-highlight":"Highlight","tool.rich-text-strikethrough":"Strikethrough","tool.rich-text-link":"Link","tool.rich-text-link-visit":"Visit link","tool.rich-text-link-remove":"Remove link","tool.rich-text-header":"Header","tool.rich-text-bulletList":"Bulleted list","tool.rich-text-toolbar-title":"Text formatting","tool.rich-text-orderedList":"Ordered list","tool.bookmark":"Bookmark","a11y.status":"Status","a11y.skip-to-main-content":"Move focus to canvas","a11y.shape-index":"{num} of {total}","a11y.shape-image":"Image","a11y.shape-video":"Video","a11y.multiple-shapes":"{num} shapes selected","a11y.select-shape":"Select next shape","a11y.select-shape-direction":"Select shape in direction","a11y.enter-leave-container":"Enter/leave container","a11y.repeat-shape":"Repeat shape","a11y.move-shape":"Move shape","a11y.move-shape-faster":"Move shape faster","a11y.enlarge-shape":"Enlarge shape","a11y.shrink-shape":"Shrink shape","a11y.pan-camera":"Pan camera","a11y.adjust-shape-styles":"Adjust shape styles","a11y.open-context-menu":"Open context menu","a11y.open-keyboard-shortcuts":"Open keyboard shortcuts","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.title":"Context menu","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.copy-link":"Copy editor link","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can’t be shared because it’s too large. We’re working on it!","share-menu.upload-failed":"Sorry, we couldn’t upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project…","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.avatar-color":"Avatar color","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","people-menu.anonymous-user":"New user","help-menu.import-tldr-file":"Import file…","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","edit-link-dialog.external-link":"External link","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site’s URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","shortcuts-dialog.a11y":"Accessibility","shortcuts-dialog.text-formatting":"Text formatting","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.arrow-kind":"Line","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.title":"Tools","tool-panel.more":"More","navigation-zone.title":"Navigation","navigation-zone.minimap":"Minimap","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","toast.success":"Success","toast.error":"Error","toast.info":"Info","toast.warning":"Warning","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn’t look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don’t ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don’t ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don’t ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We’ve updated this document to work with the current version of tldraw. If you’d like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don’t ask again","cursor-chat.type-to-chat":"Type to chat…","app.loading":"Loading tldraw…","handle.resize-top":"Resize top","handle.resize-bottom":"Resize bottom","handle.resize-left":"Resize left","handle.resize-right":"Resize right","handle.resize-top-left":"Resize top left","handle.resize-top-right":"Resize top right","handle.resize-bottom-left":"Resize bottom left","handle.resize-bottom-right":"Resize bottom right","handle.rotate.top_left_rotate":"Rotate top left","handle.rotate.top_right_rotate":"Rotate top right","handle.rotate.bottom_left_rotate":"Rotate bottom left","handle.rotate.bottom_right_rotate":"Rotate bottom right","handle.rotate.mobile_rotate":"Rotate","handle.crop.top":"Crop top","handle.crop.bottom":"Crop bottom","handle.crop.left":"Crop left","handle.crop.right":"Crop right","handle.crop.top-left":"Crop top left","handle.crop.top-right":"Crop top right","handle.crop.bottom-left":"Crop bottom left","handle.crop.bottom-right":"Crop bottom right","ui.close":"Close","ui.checked":"Checked","ui.unchecked":"Unchecked"},got=new Set(["ar","fa","he","ur","ku"]),Dm={locale:"en",label:"English",messages:k$,dir:"ltr"};async function mot(t,e){if(!(await hc(e.translations.en)).ok)return console.warn("No main translations found."),Dm;if(t==="en")return Dm;const r=lw.find(o=>o.locale===t);if(!r)return console.warn(`No translation found for locale ${t}`),Dm;const s=await(await hc(e.translations[r.locale])).json();if(!s)return console.warn(`No messages found for locale ${t}`),Dm;for(const o in Dm.messages)s[o];return{locale:t,label:r.label,dir:got.has(r.locale)?"rtl":"ltr",messages:{...Dm.messages,...s}}}const kve=S.createContext(null);function Ave(){const t=S.useContext(kve);if(!t)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return t}function Mve({overrides:t,locale:e,children:n}){const r=h6(),[i,s]=S.useState(()=>t&&t.en?{locale:"en",label:"English",dir:"ltr",messages:{...k$,...t.en}}:{locale:"en",label:"English",dir:"ltr",messages:k$});return S.useEffect(()=>{let o=!1;async function a(){const l=await mot(e,r);l&&!o&&(t&&t[e]?s({...l,messages:{...l.messages,...t[e]}}):s(l))}return a(),()=>{o=!0}},[r,e,t]),g.jsx(kve.Provider,{value:i,children:n})}function et(){const t=Ave();return S.useCallback(function(n){return t.messages[n]??n},[t])}const yot={normal:"tlui-button__normal",primary:"tlui-button__primary",danger:"tlui-button__danger",low:"tlui-button__low",icon:"tlui-button__icon",tool:"tlui-button__tool",menu:"tlui-button__menu",help:"tlui-button__help"},xt=S.forwardRef(function({children:e,type:n,isActive:r,...i},s){return g.jsx("button",{ref:s,type:"button",draggable:!1,"data-isactive":r,...i,className:nt("tlui-button",yot[n],i.className),children:e})});function vot(){const t=re(),e=et(),n=S.useRef(null),r=S.useCallback(i=>{var o;tr(i),(o=n.current)==null||o.blur();const s=t.getCurrentPageShapesInReadingOrder();s.length&&(t.setSelectedShapes([s[0].id]),t.zoomToSelectionIfOffscreen(256,{animation:{duration:t.options.animationMediumMs},inset:0}),t.timers.setTimeout(()=>t.getContainer().focus(),100))},[t]);return g.jsx(xt,{ref:n,type:"low",tabIndex:0,className:"tl-skip-to-main-content",onClick:r,children:e("a11y.skip-to-main-content")})}const bot=S.memo(function(){const e=dA(),n=et(),r=ie("a11y-msg",()=>e.currentMsg.get(),[]);return wot(r.msg),xot(),r.msg&&g.jsx("div",{"aria-label":n("a11y.status"),"aria-live":r.priority||"assertive",role:"status","aria-hidden":"false",style:{position:"absolute",top:"-10000px",left:"-10000px"},children:r.msg})});function Ove(t){const{editor:e,selectedShapeIds:n,msg:r}=t;let i="";const s=n.length;if(s>1)i=r("a11y.multiple-shapes").replace("{num}",s.toString());else if(s===1){const o=n[0],a=e.getShape(o);if(!a)return"";const l=e.getShapeUtil(a.type),c=["image","video"].includes(a.type);let u="";a.type==="geo"?u=r(`geo-style.${a.props.geo}`):c?u=r(`a11y.shape-${a.type}`):u=r(`tool.${a.type}`);const d=e.getCurrentPageShapesInReadingOrder(),h=(d.findIndex(v=>v.id===o)+1).toString(),f=d.length.toString(),y=r("a11y.shape-index").replace("{num}",h).replace("{total}",f),b=l.getAriaDescriptor(a)||l.getText(a)||"";i=(b?`${b}, `:"")+`${u}. ${y}`}return i}const xot=()=>{const t=as(),e=dA(),n=et(),r=S.useRef([]);Yz("announce selection",()=>{if(!t)return;if(t.isIn("select.idle")){const s=t.getSelectedShapeIds();s!==r.current&&(r.current=s,kb(()=>{const o=Ove({editor:t,selectedShapeIds:s,msg:n});o&&e.announce({msg:o})}))}},[t,e,n])},wot=t=>{const e=Fr();S.useEffect(()=>{if(Jn.a11y.get()){const n=i=>{console.debug(`%ca11y%c: ${i}`,"color: white; background: #40C057; padding: 2px;border-radius: 3px;","font-weight: normal")},r=i=>{const s=document.activeElement;if(i.key==="Tab"&&s&&s!==document.body&&!s.classList.contains("tl-container")){const o=s.getAttribute("aria-label")||s.getAttribute("title")||s.textContent;o&&n(o)}};return t&&n(t),document.addEventListener("keyup",r),()=>document.removeEventListener("keyup",r)}},[e,t])},Dve=()=>{},Rve=S.createContext(null);function Sot({onEvent:t,children:e}){return g.jsx(Rve.Provider,{value:t??Dve,children:e})}function hr(){return S.useContext(Rve)??Dve}function Oee(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function hA(...t){return e=>{let n=!1;const r=t.map(i=>{const s=Oee(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():Oee(t[i],null)}}}}function _n(...t){return S.useCallback(hA(...t),t)}function Xy(t){const e=Cot(t),n=S.forwardRef((r,i)=>{const{children:s,...o}=r,a=S.Children.toArray(s),l=a.find(Tot);if(l){const c=l.props.children,u=a.map(d=>d===l?S.Children.count(c)>1?S.Children.only(null):S.isValidElement(c)?c.props.children:null:d);return g.jsx(e,{...o,ref:i,children:S.isValidElement(c)?S.cloneElement(c,void 0,u):null})}return g.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function Cot(t){const e=S.forwardRef((n,r)=>{const{children:i,...s}=n;if(S.isValidElement(i)){const o=Pot(i),a=Iot(s,i.props);return i.type!==S.Fragment&&(a.ref=r?hA(r,o):o),S.cloneElement(i,a)}return S.Children.count(i)>1?S.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Eot=Symbol("radix.slottable");function Tot(t){return S.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Eot}function Iot(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const l=s(...a);return i(...a),l}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function Pot(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var _ot=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],jt=_ot.reduce((t,e)=>{const n=Xy(`Primitive.${e}`),r=S.forwardRef((i,s)=>{const{asChild:o,...a}=i,l=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function f6(t,e){t&&_c.flushSync(()=>t.dispatchEvent(e))}var kot=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Aot="VisuallyHidden",p6=S.forwardRef((t,e)=>g.jsx(jt.span,{...t,ref:e,style:{...kot,...t.style}}));p6.displayName=Aot;function Mot(t,e){const n=S.createContext(e),r=s=>{const{children:o,...a}=s,l=S.useMemo(()=>a,Object.values(a));return g.jsx(n.Provider,{value:l,children:o})};r.displayName=t+"Provider";function i(s){const o=S.useContext(n);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,i]}function Ll(t,e=[]){let n=[];function r(s,o){const a=S.createContext(o),l=n.length;n=[...n,o];const c=d=>{var x;const{scope:h,children:f,...y}=d,b=((x=h==null?void 0:h[t])==null?void 0:x[l])||a,v=S.useMemo(()=>y,Object.values(y));return g.jsx(b.Provider,{value:v,children:f})};c.displayName=s+"Provider";function u(d,h){var b;const f=((b=h==null?void 0:h[t])==null?void 0:b[l])||a,y=S.useContext(f);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const i=()=>{const s=n.map(o=>S.createContext(o));return function(a){const l=(a==null?void 0:a[t])||s;return S.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return i.scopeName=t,[r,Oot(i,...e)]}function Oot(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return S.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function fA(t){const e=t+"CollectionProvider",[n,r]=Ll(e),[i,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=b=>{const{scope:v,children:x}=b,C=$e.useRef(null),E=$e.useRef(new Map).current;return g.jsx(i,{scope:v,itemMap:E,collectionRef:C,children:x})};o.displayName=e;const a=t+"CollectionSlot",l=Xy(a),c=$e.forwardRef((b,v)=>{const{scope:x,children:C}=b,E=s(a,x),I=_n(v,E.collectionRef);return g.jsx(l,{ref:I,children:C})});c.displayName=a;const u=t+"CollectionItemSlot",d="data-radix-collection-item",h=Xy(u),f=$e.forwardRef((b,v)=>{const{scope:x,children:C,...E}=b,I=$e.useRef(null),P=_n(v,I),_=s(u,x);return $e.useEffect(()=>(_.itemMap.set(I,{ref:I,...E}),()=>void _.itemMap.delete(I))),g.jsx(h,{[d]:"",ref:P,children:C})});f.displayName=u;function y(b){const v=s(t+"CollectionConsumer",b);return $e.useCallback(()=>{const C=v.collectionRef.current;if(!C)return[];const E=Array.from(C.querySelectorAll(`[${d}]`));return Array.from(v.itemMap.values()).sort((_,A)=>E.indexOf(_.ref.current)-E.indexOf(A.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:o,Slot:c,ItemSlot:f},y,r]}function Xe(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t==null||t(i),n===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}var Id=globalThis!=null&&globalThis.document?S.useLayoutEffect:()=>{},Dot=S_[" useInsertionEffect ".trim().toString()]||Id;function Mc({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[i,s,o]=Rot({defaultProp:e,onChange:n}),a=t!==void 0,l=a?t:i;{const u=S.useRef(t!==void 0);S.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,r])}const c=S.useCallback(u=>{var d;if(a){const h=Not(u)?u(t):u;h!==t&&((d=o.current)==null||d.call(o,h))}else s(u)},[a,t,s,o]);return[l,c]}function Rot({defaultProp:t,onChange:e}){const[n,r]=S.useState(t),i=S.useRef(n),s=S.useRef(e);return Dot(()=>{s.current=e},[e]),S.useEffect(()=>{var o;i.current!==n&&((o=s.current)==null||o.call(s,n),i.current=n)},[n,i]),[n,r,s]}function Not(t){return typeof t=="function"}function jot(t,e){return S.useReducer((n,r)=>e[n][r]??n,t)}var Oc=t=>{const{present:e,children:n}=t,r=Lot(e),i=typeof n=="function"?n({present:r.isPresent}):S.Children.only(n),s=_n(r.ref,Fot(i));return typeof n=="function"||r.isPresent?S.cloneElement(i,{ref:s}):null};Oc.displayName="Presence";function Lot(t){const[e,n]=S.useState(),r=S.useRef(null),i=S.useRef(t),s=S.useRef("none"),o=t?"mounted":"unmounted",[a,l]=jot(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return S.useEffect(()=>{const c=JC(r.current);s.current=a==="mounted"?c:"none"},[a]),Id(()=>{const c=r.current,u=i.current;if(u!==t){const h=s.current,f=JC(c);t?l("MOUNT"):f==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&h!==f?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,l]),Id(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=f=>{const b=JC(r.current).includes(CSS.escape(f.animationName));if(f.target===e&&b&&(l("ANIMATION_END"),!i.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=f=>{f.target===e&&(s.current=JC(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:S.useCallback(c=>{r.current=c?getComputedStyle(c):null,n(c)},[])}}function JC(t){return(t==null?void 0:t.animationName)||"none"}function Fot(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var $ot=S_[" useId ".trim().toString()]||(()=>{}),Bot=0;function gd(t){const[e,n]=S.useState($ot());return Id(()=>{n(r=>r??String(Bot++))},[t]),e?`radix-${e}`:""}var zot=S.createContext(void 0);function US(t){const e=S.useContext(zot);return t||e||"ltr"}function wo(t){const e=S.useRef(t);return S.useEffect(()=>{e.current=t}),S.useMemo(()=>(...n)=>{var r;return(r=e.current)==null?void 0:r.call(e,...n)},[])}function Uot(t,e=globalThis==null?void 0:globalThis.document){const n=wo(t);S.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var Hot="DismissableLayer",A$="dismissableLayer.update",Vot="dismissableLayer.pointerDownOutside",Wot="dismissableLayer.focusOutside",Dee,Nve=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),HS=S.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...l}=t,c=S.useContext(Nve),[u,d]=S.useState(null),h=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=S.useState({}),y=_n(e,A=>d(A)),b=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),x=b.indexOf(v),C=u?b.indexOf(u):-1,E=c.layersWithOutsidePointerEventsDisabled.size>0,I=C>=x,P=qot(A=>{const D=A.target,L=[...c.branches].some(z=>z.contains(D));!I||L||(i==null||i(A),o==null||o(A),A.defaultPrevented||a==null||a())},h),_=Got(A=>{const D=A.target;[...c.branches].some(z=>z.contains(D))||(s==null||s(A),o==null||o(A),A.defaultPrevented||a==null||a())},h);return Uot(A=>{C===c.layers.size-1&&(r==null||r(A),!A.defaultPrevented&&a&&(A.preventDefault(),a()))},h),S.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Dee=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Ree(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=Dee)}},[u,h,n,c]),S.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Ree())},[u,c]),S.useEffect(()=>{const A=()=>f({});return document.addEventListener(A$,A),()=>document.removeEventListener(A$,A)},[]),g.jsx(jt.div,{...l,ref:y,style:{pointerEvents:E?I?"auto":"none":void 0,...t.style},onFocusCapture:Xe(t.onFocusCapture,_.onFocusCapture),onBlurCapture:Xe(t.onBlurCapture,_.onBlurCapture),onPointerDownCapture:Xe(t.onPointerDownCapture,P.onPointerDownCapture)})});HS.displayName=Hot;var Kot="DismissableLayerBranch",jve=S.forwardRef((t,e)=>{const n=S.useContext(Nve),r=S.useRef(null),i=_n(e,r);return S.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),g.jsx(jt.div,{...t,ref:i})});jve.displayName=Kot;function qot(t,e=globalThis==null?void 0:globalThis.document){const n=wo(t),r=S.useRef(!1),i=S.useRef(()=>{});return S.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){Lve(Vot,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function Got(t,e=globalThis==null?void 0:globalThis.document){const n=wo(t),r=S.useRef(!1);return S.useEffect(()=>{const i=s=>{s.target&&!r.current&&Lve(Wot,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Ree(){const t=new CustomEvent(A$);document.dispatchEvent(t)}function Lve(t,e,n,{discrete:r}){const i=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?f6(i,s):i.dispatchEvent(s)}var Yot=HS,Xot=jve,oL="focusScope.autoFocusOnMount",aL="focusScope.autoFocusOnUnmount",Nee={bubbles:!1,cancelable:!0},Jot="FocusScope",pA=S.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=t,[a,l]=S.useState(null),c=wo(i),u=wo(s),d=S.useRef(null),h=_n(e,b=>l(b)),f=S.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;S.useEffect(()=>{if(r){let b=function(E){if(f.paused||!a)return;const I=E.target;a.contains(I)?d.current=I:kh(d.current,{select:!0})},v=function(E){if(f.paused||!a)return;const I=E.relatedTarget;I!==null&&(a.contains(I)||kh(d.current,{select:!0}))},x=function(E){if(document.activeElement===document.body)for(const P of E)P.removedNodes.length>0&&kh(a)};document.addEventListener("focusin",b),document.addEventListener("focusout",v);const C=new MutationObserver(x);return a&&C.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",b),document.removeEventListener("focusout",v),C.disconnect()}}},[r,a,f.paused]),S.useEffect(()=>{if(a){Lee.add(f);const b=document.activeElement;if(!a.contains(b)){const x=new CustomEvent(oL,Nee);a.addEventListener(oL,c),a.dispatchEvent(x),x.defaultPrevented||(Zot(rat(Fve(a)),{select:!0}),document.activeElement===b&&kh(a))}return()=>{a.removeEventListener(oL,c),setTimeout(()=>{const x=new CustomEvent(aL,Nee);a.addEventListener(aL,u),a.dispatchEvent(x),x.defaultPrevented||kh(b??document.body,{select:!0}),a.removeEventListener(aL,u),Lee.remove(f)},0)}}},[a,c,u,f]);const y=S.useCallback(b=>{if(!n&&!r||f.paused)return;const v=b.key==="Tab"&&!b.altKey&&!b.ctrlKey&&!b.metaKey,x=document.activeElement;if(v&&x){const C=b.currentTarget,[E,I]=Qot(C);E&&I?!b.shiftKey&&x===I?(b.preventDefault(),n&&kh(E,{select:!0})):b.shiftKey&&x===E&&(b.preventDefault(),n&&kh(I,{select:!0})):x===C&&b.preventDefault()}},[n,r,f.paused]);return g.jsx(jt.div,{tabIndex:-1,...o,ref:h,onKeyDown:y})});pA.displayName=Jot;function Zot(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(kh(r,{select:e}),document.activeElement!==n)return}function Qot(t){const e=Fve(t),n=jee(e,t),r=jee(e.reverse(),t);return[n,r]}function Fve(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function jee(t,e){for(const n of t)if(!eat(n,{upTo:e}))return n}function eat(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function tat(t){return t instanceof HTMLInputElement&&"select"in t}function kh(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&tat(t)&&e&&t.select()}}var Lee=nat();function nat(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=Fee(t,e),t.unshift(e)},remove(e){var n;t=Fee(t,e),(n=t[0])==null||n.resume()}}}function Fee(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function rat(t){return t.filter(e=>e.tagName!=="A")}var iat="Portal",VS=S.forwardRef((t,e)=>{var a;const{container:n,...r}=t,[i,s]=S.useState(!1);Id(()=>s(!0),[]);const o=n||i&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?Lre.createPortal(g.jsx(jt.div,{...r,ref:e}),o):null});VS.displayName=iat;var lL=0;function g6(){S.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??$ee()),document.body.insertAdjacentElement("beforeend",t[1]??$ee()),lL++,()=>{lL===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),lL--}},[])}function $ee(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var eT="right-scroll-bar-position",tT="width-before-scroll-bar",sat="with-scroll-bars-hidden",oat="--removed-body-scroll-bar-size";function cL(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function aat(t,e){var n=S.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=e,n.facade}var lat=typeof window<"u"?S.useLayoutEffect:S.useEffect,Bee=new WeakMap;function cat(t,e){var n=aat(null,function(r){return t.forEach(function(i){return cL(i,r)})});return lat(function(){var r=Bee.get(n);if(r){var i=new Set(r),s=new Set(t),o=n.current;i.forEach(function(a){s.has(a)||cL(a,null)}),s.forEach(function(a){i.has(a)||cL(a,o)})}Bee.set(n,t)},[t]),n}function uat(t){return t}function dat(t,e){e===void 0&&(e=uat);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var o=e(s,r);return n.push(o),function(){n=n.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(r=!0;n.length;){var o=n;n=[],o.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var o=[];if(n.length){var a=n;n=[],a.forEach(s),o=n}var l=function(){var u=o;o=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(u){o.push(u),c()},filter:function(u){return o=o.filter(u),n}}}};return i}function hat(t){t===void 0&&(t={});var e=dat(null);return e.options=Qc({async:!0,ssr:!1},t),e}var $ve=function(t){var e=t.sideCar,n=Jw(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return S.createElement(r,Qc({},n))};$ve.isSideCarExport=!0;function fat(t,e){return t.useMedium(e),$ve}var Bve=hat(),uL=function(){},gA=S.forwardRef(function(t,e){var n=S.useRef(null),r=S.useState({onScrollCapture:uL,onWheelCapture:uL,onTouchMoveCapture:uL}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,h=t.sideCar,f=t.noRelative,y=t.noIsolation,b=t.inert,v=t.allowPinchZoom,x=t.as,C=x===void 0?"div":x,E=t.gapMode,I=Jw(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),P=h,_=cat([n,e]),A=Qc(Qc({},I),i);return S.createElement(S.Fragment,null,u&&S.createElement(P,{sideCar:Bve,removeScrollBar:c,shards:d,noRelative:f,noIsolation:y,inert:b,setCallbacks:s,allowPinchZoom:!!v,lockRef:n,gapMode:E}),o?S.cloneElement(S.Children.only(a),Qc(Qc({},A),{ref:_})):S.createElement(C,Qc({},A,{className:l,ref:_}),a))});gA.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};gA.classNames={fullWidth:tT,zeroRight:eT};var pat=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function gat(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=pat();return e&&t.setAttribute("nonce",e),t}function mat(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function yat(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var vat=function(){var t=0,e=null;return{add:function(n){t==0&&(e=gat())&&(mat(e,n),yat(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},bat=function(){var t=vat();return function(e,n){S.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},zve=function(){var t=bat(),e=function(n){var r=n.styles,i=n.dynamic;return t(r,i),null};return e},xat={left:0,top:0,right:0,gap:0},dL=function(t){return parseInt(t||"",10)||0},wat=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[dL(n),dL(r),dL(i)]},Sat=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return xat;var e=wat(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},Cat=zve(),vy="data-scroll-locked",Eat=function(t,e,n,r){var i=t.left,s=t.top,o=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(sat,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(vy,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(eT,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(tT,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(eT," .").concat(eT,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(tT," .").concat(tT,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(vy,`] {
    `).concat(oat,": ").concat(a,`px;
  }
`)},zee=function(){var t=parseInt(document.body.getAttribute(vy)||"0",10);return isFinite(t)?t:0},Tat=function(){S.useEffect(function(){return document.body.setAttribute(vy,(zee()+1).toString()),function(){var t=zee()-1;t<=0?document.body.removeAttribute(vy):document.body.setAttribute(vy,t.toString())}},[])},Iat=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,i=r===void 0?"margin":r;Tat();var s=S.useMemo(function(){return Sat(i)},[i]);return S.createElement(Cat,{styles:Eat(s,!e,i,n?"":"!important")})},M$=!1;if(typeof window<"u")try{var ZC=Object.defineProperty({},"passive",{get:function(){return M$=!0,!0}});window.addEventListener("test",ZC,ZC),window.removeEventListener("test",ZC,ZC)}catch{M$=!1}var Rm=M$?{passive:!1}:!1,Pat=function(t){return t.tagName==="TEXTAREA"},Uve=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Pat(t)&&n[e]==="visible")},_at=function(t){return Uve(t,"overflowY")},kat=function(t){return Uve(t,"overflowX")},Uee=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=Hve(t,r);if(i){var s=Vve(t,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},Aat=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},Mat=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},Hve=function(t,e){return t==="v"?_at(e):kat(e)},Vve=function(t,e){return t==="v"?Aat(e):Mat(e)},Oat=function(t,e){return t==="h"&&e==="rtl"?-1:1},Dat=function(t,e,n,r,i){var s=Oat(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,l=e.contains(a),c=!1,u=o>0,d=0,h=0;do{if(!a)break;var f=Vve(t,a),y=f[0],b=f[1],v=f[2],x=b-v-s*y;(y||x)&&Hve(t,a)&&(d+=x,h+=y);var C=a.parentNode;a=C&&C.nodeType===Node.DOCUMENT_FRAGMENT_NODE?C.host:C}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},QC=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Hee=function(t){return[t.deltaX,t.deltaY]},Vee=function(t){return t&&"current"in t?t.current:t},Rat=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Nat=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},jat=0,Nm=[];function Lat(t){var e=S.useRef([]),n=S.useRef([0,0]),r=S.useRef(),i=S.useState(jat++)[0],s=S.useState(zve)[0],o=S.useRef(t);S.useEffect(function(){o.current=t},[t]),S.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var b=Yke([t.lockRef.current],(t.shards||[]).map(Vee),!0).filter(Boolean);return b.forEach(function(v){return v.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),b.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=S.useCallback(function(b,v){if("touches"in b&&b.touches.length===2||b.type==="wheel"&&b.ctrlKey)return!o.current.allowPinchZoom;var x=QC(b),C=n.current,E="deltaX"in b?b.deltaX:C[0]-x[0],I="deltaY"in b?b.deltaY:C[1]-x[1],P,_=b.target,A=Math.abs(E)>Math.abs(I)?"h":"v";if("touches"in b&&A==="h"&&_.type==="range")return!1;var D=Uee(A,_);if(!D)return!0;if(D?P=A:(P=A==="v"?"h":"v",D=Uee(A,_)),!D)return!1;if(!r.current&&"changedTouches"in b&&(E||I)&&(r.current=P),!P)return!0;var L=r.current||P;return Dat(L,v,b,L==="h"?E:I)},[]),l=S.useCallback(function(b){var v=b;if(!(!Nm.length||Nm[Nm.length-1]!==s)){var x="deltaY"in v?Hee(v):QC(v),C=e.current.filter(function(P){return P.name===v.type&&(P.target===v.target||v.target===P.shadowParent)&&Rat(P.delta,x)})[0];if(C&&C.should){v.cancelable&&v.preventDefault();return}if(!C){var E=(o.current.shards||[]).map(Vee).filter(Boolean).filter(function(P){return P.contains(v.target)}),I=E.length>0?a(v,E[0]):!o.current.noIsolation;I&&v.cancelable&&v.preventDefault()}}},[]),c=S.useCallback(function(b,v,x,C){var E={name:b,delta:v,target:x,should:C,shadowParent:Fat(x)};e.current.push(E),setTimeout(function(){e.current=e.current.filter(function(I){return I!==E})},1)},[]),u=S.useCallback(function(b){n.current=QC(b),r.current=void 0},[]),d=S.useCallback(function(b){c(b.type,Hee(b),b.target,a(b,t.lockRef.current))},[]),h=S.useCallback(function(b){c(b.type,QC(b),b.target,a(b,t.lockRef.current))},[]);S.useEffect(function(){return Nm.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Rm),document.addEventListener("touchmove",l,Rm),document.addEventListener("touchstart",u,Rm),function(){Nm=Nm.filter(function(b){return b!==s}),document.removeEventListener("wheel",l,Rm),document.removeEventListener("touchmove",l,Rm),document.removeEventListener("touchstart",u,Rm)}},[]);var f=t.removeScrollBar,y=t.inert;return S.createElement(S.Fragment,null,y?S.createElement(s,{styles:Nat(i)}):null,f?S.createElement(Iat,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function Fat(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const $at=fat(Bve,Lat);var mA=S.forwardRef(function(t,e){return S.createElement(gA,Qc({},t,{ref:e,sideCar:$at}))});mA.classNames=gA.classNames;var Bat=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},jm=new WeakMap,eE=new WeakMap,tE={},hL=0,Wve=function(t){return t&&(t.host||Wve(t.parentNode))},zat=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=Wve(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},Uat=function(t,e,n,r){var i=zat(e,Array.isArray(t)?t:[t]);tE[n]||(tE[n]=new WeakMap);var s=tE[n],o=[],a=new Set,l=new Set(i),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};i.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var f=h.getAttribute(r),y=f!==null&&f!=="false",b=(jm.get(h)||0)+1,v=(s.get(h)||0)+1;jm.set(h,b),s.set(h,v),o.push(h),b===1&&y&&eE.set(h,!0),v===1&&h.setAttribute(n,"true"),y||h.setAttribute(r,"true")}catch(x){console.error("aria-hidden: cannot operate on ",h,x)}})};return u(e),a.clear(),hL++,function(){o.forEach(function(d){var h=jm.get(d)-1,f=s.get(d)-1;jm.set(d,h),s.set(d,f),h||(eE.has(d)||d.removeAttribute(r),eE.delete(d)),f||d.removeAttribute(n)}),hL--,hL||(jm=new WeakMap,jm=new WeakMap,eE=new WeakMap,tE={})}},m6=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),i=Bat(t);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live], script"))),Uat(r,i,n,"aria-hidden")):function(){return null}},yA="Dialog",[Kve,JPt]=Ll(yA),[Hat,Dc]=Kve(yA),qve=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=t,a=S.useRef(null),l=S.useRef(null),[c,u]=Mc({prop:r,defaultProp:i??!1,onChange:s,caller:yA});return g.jsx(Hat,{scope:e,triggerRef:a,contentRef:l,contentId:gd(),titleId:gd(),descriptionId:gd(),open:c,onOpenChange:u,onOpenToggle:S.useCallback(()=>u(d=>!d),[u]),modal:o,children:n})};qve.displayName=yA;var Gve="DialogTrigger",Vat=S.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Dc(Gve,n),s=_n(e,i.triggerRef);return g.jsx(jt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":b6(i.open),...r,ref:s,onClick:Xe(t.onClick,i.onOpenToggle)})});Vat.displayName=Gve;var y6="DialogPortal",[Wat,Yve]=Kve(y6,{forceMount:void 0}),Xve=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:i}=t,s=Dc(y6,e);return g.jsx(Wat,{scope:e,forceMount:n,children:S.Children.map(r,o=>g.jsx(Oc,{present:n||s.open,children:g.jsx(VS,{asChild:!0,container:i,children:o})}))})};Xve.displayName=y6;var pP="DialogOverlay",Jve=S.forwardRef((t,e)=>{const n=Yve(pP,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=Dc(pP,t.__scopeDialog);return s.modal?g.jsx(Oc,{present:r||s.open,children:g.jsx(qat,{...i,ref:e})}):null});Jve.displayName=pP;var Kat=Xy("DialogOverlay.RemoveScroll"),qat=S.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Dc(pP,n);return g.jsx(mA,{as:Kat,allowPinchZoom:!0,shards:[i.contentRef],children:g.jsx(jt.div,{"data-state":b6(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),bg="DialogContent",Zve=S.forwardRef((t,e)=>{const n=Yve(bg,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=Dc(bg,t.__scopeDialog);return g.jsx(Oc,{present:r||s.open,children:s.modal?g.jsx(Gat,{...i,ref:e}):g.jsx(Yat,{...i,ref:e})})});Zve.displayName=bg;var Gat=S.forwardRef((t,e)=>{const n=Dc(bg,t.__scopeDialog),r=S.useRef(null),i=_n(e,n.contentRef,r);return S.useEffect(()=>{const s=r.current;if(s)return m6(s)},[]),g.jsx(Qve,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Xe(t.onCloseAutoFocus,s=>{var o;s.preventDefault(),(o=n.triggerRef.current)==null||o.focus()}),onPointerDownOutside:Xe(t.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:Xe(t.onFocusOutside,s=>s.preventDefault())})}),Yat=S.forwardRef((t,e)=>{const n=Dc(bg,t.__scopeDialog),r=S.useRef(!1),i=S.useRef(!1);return g.jsx(Qve,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=t.onCloseAutoFocus)==null||o.call(t,s),s.defaultPrevented||(r.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var l,c;(l=t.onInteractOutside)==null||l.call(t,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((c=n.triggerRef.current)==null?void 0:c.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),Qve=S.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=t,a=Dc(bg,n),l=S.useRef(null),c=_n(e,l);return g6(),g.jsxs(g.Fragment,{children:[g.jsx(pA,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:g.jsx(HS,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":b6(a.open),...o,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),g.jsxs(g.Fragment,{children:[g.jsx(Jat,{titleId:a.titleId}),g.jsx(Qat,{contentRef:l,descriptionId:a.descriptionId})]})]})}),v6="DialogTitle",e0e=S.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Dc(v6,n);return g.jsx(jt.h2,{id:i.titleId,...r,ref:e})});e0e.displayName=v6;var t0e="DialogDescription",Xat=S.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Dc(t0e,n);return g.jsx(jt.p,{id:i.descriptionId,...r,ref:e})});Xat.displayName=t0e;var n0e="DialogClose",r0e=S.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Dc(n0e,n);return g.jsx(jt.button,{type:"button",...r,ref:e,onClick:Xe(t.onClick,()=>i.onOpenChange(!1))})});r0e.displayName=n0e;function b6(t){return t?"open":"closed"}var i0e="DialogTitleWarning",[ZPt,s0e]=Mot(i0e,{contentName:bg,titleName:v6,docsSlug:"dialog"}),Jat=({titleId:t})=>{const e=s0e(i0e),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return S.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},Zat="DialogDescriptionWarning",Qat=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${s0e(Zat).contentName}}.`;return S.useEffect(()=>{var s;const i=(s=t.current)==null?void 0:s.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},elt=qve,tlt=Xve,nlt=Jve,rlt=Zve,ilt=e0e;function slt(t){const e=S.useRef({value:t,previous:t});return S.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}function o0e(t){const[e,n]=S.useState(void 0);return Id(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}const olt=["top","right","bottom","left"],yf=Math.min,ga=Math.max,gP=Math.round,nE=Math.floor,pu=t=>({x:t,y:t}),alt={left:"right",right:"left",bottom:"top",top:"bottom"},llt={start:"end",end:"start"};function O$(t,e,n){return ga(t,yf(e,n))}function Pd(t,e){return typeof t=="function"?t(e):t}function _d(t){return t.split("-")[0]}function Hv(t){return t.split("-")[1]}function x6(t){return t==="x"?"y":"x"}function w6(t){return t==="y"?"height":"width"}const clt=new Set(["top","bottom"]);function su(t){return clt.has(_d(t))?"y":"x"}function S6(t){return x6(su(t))}function ult(t,e,n){n===void 0&&(n=!1);const r=Hv(t),i=S6(t),s=w6(i);let o=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=mP(o)),[o,mP(o)]}function dlt(t){const e=mP(t);return[D$(t),e,D$(e)]}function D$(t){return t.replace(/start|end/g,e=>llt[e])}const Wee=["left","right"],Kee=["right","left"],hlt=["top","bottom"],flt=["bottom","top"];function plt(t,e,n){switch(t){case"top":case"bottom":return n?e?Kee:Wee:e?Wee:Kee;case"left":case"right":return e?hlt:flt;default:return[]}}function glt(t,e,n,r){const i=Hv(t);let s=plt(_d(t),n==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(D$)))),s}function mP(t){return t.replace(/left|right|bottom|top/g,e=>alt[e])}function mlt(t){return{top:0,right:0,bottom:0,left:0,...t}}function a0e(t){return typeof t!="number"?mlt(t):{top:t,right:t,bottom:t,left:t}}function yP(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}function qee(t,e,n){let{reference:r,floating:i}=t;const s=su(e),o=S6(e),a=w6(o),l=_d(e),c=s==="y",u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,h=r[a]/2-i[a]/2;let f;switch(l){case"top":f={x:u,y:r.y-i.height};break;case"bottom":f={x:u,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:d};break;case"left":f={x:r.x-i.width,y:d};break;default:f={x:r.x,y:r.y}}switch(Hv(e)){case"start":f[o]-=h*(n&&c?-1:1);break;case"end":f[o]+=h*(n&&c?-1:1);break}return f}const ylt=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:u,y:d}=qee(c,r,l),h=r,f={},y=0;for(let b=0;b<a.length;b++){const{name:v,fn:x}=a[b],{x:C,y:E,data:I,reset:P}=await x({x:u,y:d,initialPlacement:r,placement:h,strategy:i,middlewareData:f,rects:c,platform:o,elements:{reference:t,floating:e}});u=C??u,d=E??d,f={...f,[v]:{...f[v],...I}},P&&y<=50&&(y++,typeof P=="object"&&(P.placement&&(h=P.placement),P.rects&&(c=P.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):P.rects),{x:u,y:d}=qee(c,h,l)),b=-1)}return{x:u,y:d,placement:h,strategy:i,middlewareData:f}};async function xw(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=Pd(e,t),y=a0e(f),v=a[h?d==="floating"?"reference":"floating":d],x=yP(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(v)))==null||n?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),C=d==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,E=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),I=await(s.isElement==null?void 0:s.isElement(E))?await(s.getScale==null?void 0:s.getScale(E))||{x:1,y:1}:{x:1,y:1},P=yP(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:C,offsetParent:E,strategy:l}):C);return{top:(x.top-P.top+y.top)/I.y,bottom:(P.bottom-x.bottom+y.bottom)/I.y,left:(x.left-P.left+y.left)/I.x,right:(P.right-x.right+y.right)/I.x}}const vlt=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Pd(t,e)||{};if(c==null)return{};const d=a0e(u),h={x:n,y:r},f=S6(i),y=w6(f),b=await o.getDimensions(c),v=f==="y",x=v?"top":"left",C=v?"bottom":"right",E=v?"clientHeight":"clientWidth",I=s.reference[y]+s.reference[f]-h[f]-s.floating[y],P=h[f]-s.reference[f],_=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let A=_?_[E]:0;(!A||!await(o.isElement==null?void 0:o.isElement(_)))&&(A=a.floating[E]||s.floating[y]);const D=I/2-P/2,L=A/2-b[y]/2-1,z=yf(d[x],L),$=yf(d[C],L),H=z,R=A-b[y]-$,j=A/2-b[y]/2+D,B=O$(H,j,R),K=!l.arrow&&Hv(i)!=null&&j!==B&&s.reference[y]/2-(j<H?z:$)-b[y]/2<0,G=K?j<H?j-H:j-R:0;return{[f]:h[f]+G,data:{[f]:B,centerOffset:j-B-G,...K&&{alignmentOffset:G}},reset:K}}}),blt=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:b=!0,...v}=Pd(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const x=_d(i),C=su(a),E=_d(a)===a,I=await(l.isRTL==null?void 0:l.isRTL(c.floating)),P=h||(E||!b?[mP(a)]:dlt(a)),_=y!=="none";!h&&_&&P.push(...glt(a,b,y,I));const A=[a,...P],D=await xw(e,v),L=[];let z=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&L.push(D[x]),d){const j=ult(i,o,I);L.push(D[j[0]],D[j[1]])}if(z=[...z,{placement:i,overflows:L}],!L.every(j=>j<=0)){var $,H;const j=((($=s.flip)==null?void 0:$.index)||0)+1,B=A[j];if(B&&(!(d==="alignment"?C!==su(B):!1)||z.every(V=>su(V.placement)===C?V.overflows[0]>0:!0)))return{data:{index:j,overflows:z},reset:{placement:B}};let K=(H=z.filter(G=>G.overflows[0]<=0).sort((G,V)=>G.overflows[1]-V.overflows[1])[0])==null?void 0:H.placement;if(!K)switch(f){case"bestFit":{var R;const G=(R=z.filter(V=>{if(_){const W=su(V.placement);return W===C||W==="y"}return!0}).map(V=>[V.placement,V.overflows.filter(W=>W>0).reduce((W,Z)=>W+Z,0)]).sort((V,W)=>V[1]-W[1])[0])==null?void 0:R[0];G&&(K=G);break}case"initialPlacement":K=a;break}if(i!==K)return{reset:{placement:K}}}return{}}}};function Gee(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Yee(t){return olt.some(e=>t[e]>=0)}const xlt=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=Pd(t,e);switch(r){case"referenceHidden":{const s=await xw(e,{...i,elementContext:"reference"}),o=Gee(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:Yee(o)}}}case"escaped":{const s=await xw(e,{...i,altBoundary:!0}),o=Gee(s,n.floating);return{data:{escapedOffsets:o,escaped:Yee(o)}}}default:return{}}}}},l0e=new Set(["left","top"]);async function wlt(t,e){const{placement:n,platform:r,elements:i}=t,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=_d(n),a=Hv(n),l=su(n)==="y",c=l0e.has(o)?-1:1,u=s&&l?-1:1,d=Pd(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(f=a==="end"?y*-1:y),l?{x:f*u,y:h*c}:{x:h*c,y:f*u}}const Slt=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:s,placement:o,middlewareData:a}=e,l=await wlt(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},Clt=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:v=>{let{x,y:C}=v;return{x,y:C}}},...l}=Pd(t,e),c={x:n,y:r},u=await xw(e,l),d=su(_d(i)),h=x6(d);let f=c[h],y=c[d];if(s){const v=h==="y"?"top":"left",x=h==="y"?"bottom":"right",C=f+u[v],E=f-u[x];f=O$(C,f,E)}if(o){const v=d==="y"?"top":"left",x=d==="y"?"bottom":"right",C=y+u[v],E=y-u[x];y=O$(C,y,E)}const b=a.fn({...e,[h]:f,[d]:y});return{...b,data:{x:b.x-n,y:b.y-r,enabled:{[h]:s,[d]:o}}}}}},Elt=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Pd(t,e),u={x:n,y:r},d=su(i),h=x6(d);let f=u[h],y=u[d];const b=Pd(a,e),v=typeof b=="number"?{mainAxis:b,crossAxis:0}:{mainAxis:0,crossAxis:0,...b};if(l){const E=h==="y"?"height":"width",I=s.reference[h]-s.floating[E]+v.mainAxis,P=s.reference[h]+s.reference[E]-v.mainAxis;f<I?f=I:f>P&&(f=P)}if(c){var x,C;const E=h==="y"?"width":"height",I=l0e.has(_d(i)),P=s.reference[d]-s.floating[E]+(I&&((x=o.offset)==null?void 0:x[d])||0)+(I?0:v.crossAxis),_=s.reference[d]+s.reference[E]+(I?0:((C=o.offset)==null?void 0:C[d])||0)-(I?v.crossAxis:0);y<P?y=P:y>_&&(y=_)}return{[h]:f,[d]:y}}}},Tlt=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:l=()=>{},...c}=Pd(t,e),u=await xw(e,c),d=_d(i),h=Hv(i),f=su(i)==="y",{width:y,height:b}=s.floating;let v,x;d==="top"||d==="bottom"?(v=d,x=h===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(x=d,v=h==="end"?"top":"bottom");const C=b-u.top-u.bottom,E=y-u.left-u.right,I=yf(b-u[v],C),P=yf(y-u[x],E),_=!e.middlewareData.shift;let A=I,D=P;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(D=E),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(A=C),_&&!h){const z=ga(u.left,0),$=ga(u.right,0),H=ga(u.top,0),R=ga(u.bottom,0);f?D=y-2*(z!==0||$!==0?z+$:ga(u.left,u.right)):A=b-2*(H!==0||R!==0?H+R:ga(u.top,u.bottom))}await l({...e,availableWidth:D,availableHeight:A});const L=await o.getDimensions(a.floating);return y!==L.width||b!==L.height?{reset:{rects:!0}}:{}}}};function vA(){return typeof window<"u"}function Vv(t){return c0e(t)?(t.nodeName||"").toLowerCase():"#document"}function Na(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function _u(t){var e;return(e=(c0e(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function c0e(t){return vA()?t instanceof Node||t instanceof Na(t).Node:!1}function Sc(t){return vA()?t instanceof Element||t instanceof Na(t).Element:!1}function Cu(t){return vA()?t instanceof HTMLElement||t instanceof Na(t).HTMLElement:!1}function Xee(t){return!vA()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Na(t).ShadowRoot}const Ilt=new Set(["inline","contents"]);function WS(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=Cc(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!Ilt.has(i)}const Plt=new Set(["table","td","th"]);function _lt(t){return Plt.has(Vv(t))}const klt=[":popover-open",":modal"];function bA(t){return klt.some(e=>{try{return t.matches(e)}catch{return!1}})}const Alt=["transform","translate","scale","rotate","perspective"],Mlt=["transform","translate","scale","rotate","perspective","filter"],Olt=["paint","layout","strict","content"];function C6(t){const e=E6(),n=Sc(t)?Cc(t):t;return Alt.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||Mlt.some(r=>(n.willChange||"").includes(r))||Olt.some(r=>(n.contain||"").includes(r))}function Dlt(t){let e=vf(t);for(;Cu(e)&&!Jy(e);){if(C6(e))return e;if(bA(e))return null;e=vf(e)}return null}function E6(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Rlt=new Set(["html","body","#document"]);function Jy(t){return Rlt.has(Vv(t))}function Cc(t){return Na(t).getComputedStyle(t)}function xA(t){return Sc(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function vf(t){if(Vv(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Xee(t)&&t.host||_u(t);return Xee(e)?e.host:e}function u0e(t){const e=vf(t);return Jy(e)?t.ownerDocument?t.ownerDocument.body:t.body:Cu(e)&&WS(e)?e:u0e(e)}function ww(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=u0e(t),s=i===((r=t.ownerDocument)==null?void 0:r.body),o=Na(i);if(s){const a=R$(o);return e.concat(o,o.visualViewport||[],WS(i)?i:[],a&&n?ww(a):[])}return e.concat(i,ww(i,[],n))}function R$(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function d0e(t){const e=Cc(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Cu(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=gP(n)!==s||gP(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function T6(t){return Sc(t)?t:t.contextElement}function by(t){const e=T6(t);if(!Cu(e))return pu(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=d0e(e);let o=(s?gP(n.width):n.width)/r,a=(s?gP(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const Nlt=pu(0);function h0e(t){const e=Na(t);return!E6()||!e.visualViewport?Nlt:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function jlt(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Na(t)?!1:e}function xg(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=T6(t);let o=pu(1);e&&(r?Sc(r)&&(o=by(r)):o=by(t));const a=jlt(s,n,r)?h0e(s):pu(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,d=i.height/o.y;if(s){const h=Na(s),f=r&&Sc(r)?Na(r):r;let y=h,b=R$(y);for(;b&&r&&f!==y;){const v=by(b),x=b.getBoundingClientRect(),C=Cc(b),E=x.left+(b.clientLeft+parseFloat(C.paddingLeft))*v.x,I=x.top+(b.clientTop+parseFloat(C.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=E,c+=I,y=Na(b),b=R$(y)}}return yP({width:u,height:d,x:l,y:c})}function wA(t,e){const n=xA(t).scrollLeft;return e?e.left+n:xg(_u(t)).left+n}function f0e(t,e){const n=t.getBoundingClientRect(),r=n.left+e.scrollLeft-wA(t,n),i=n.top+e.scrollTop;return{x:r,y:i}}function Llt(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const s=i==="fixed",o=_u(r),a=e?bA(e.floating):!1;if(r===o||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=pu(1);const u=pu(0),d=Cu(r);if((d||!d&&!s)&&((Vv(r)!=="body"||WS(o))&&(l=xA(r)),Cu(r))){const f=xg(r);c=by(r),u.x=f.x+r.clientLeft,u.y=f.y+r.clientTop}const h=o&&!d&&!s?f0e(o,l):pu(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:n.y*c.y-l.scrollTop*c.y+u.y+h.y}}function Flt(t){return Array.from(t.getClientRects())}function $lt(t){const e=_u(t),n=xA(t),r=t.ownerDocument.body,i=ga(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=ga(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+wA(t);const a=-n.scrollTop;return Cc(r).direction==="rtl"&&(o+=ga(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}const Jee=25;function Blt(t,e){const n=Na(t),r=_u(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const u=E6();(!u||u&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}const c=wA(r);if(c<=0){const u=r.ownerDocument,d=u.body,h=getComputedStyle(d),f=u.compatMode==="CSS1Compat"&&parseFloat(h.marginLeft)+parseFloat(h.marginRight)||0,y=Math.abs(r.clientWidth-d.clientWidth-f);y<=Jee&&(s-=y)}else c<=Jee&&(s+=c);return{width:s,height:o,x:a,y:l}}const zlt=new Set(["absolute","fixed"]);function Ult(t,e){const n=xg(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=Cu(t)?by(t):pu(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=i*s.x,c=r*s.y;return{width:o,height:a,x:l,y:c}}function Zee(t,e,n){let r;if(e==="viewport")r=Blt(t,n);else if(e==="document")r=$lt(_u(t));else if(Sc(e))r=Ult(e,n);else{const i=h0e(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return yP(r)}function p0e(t,e){const n=vf(t);return n===e||!Sc(n)||Jy(n)?!1:Cc(n).position==="fixed"||p0e(n,e)}function Hlt(t,e){const n=e.get(t);if(n)return n;let r=ww(t,[],!1).filter(a=>Sc(a)&&Vv(a)!=="body"),i=null;const s=Cc(t).position==="fixed";let o=s?vf(t):t;for(;Sc(o)&&!Jy(o);){const a=Cc(o),l=C6(o);!l&&a.position==="fixed"&&(i=null),(s?!l&&!i:!l&&a.position==="static"&&!!i&&zlt.has(i.position)||WS(o)&&!l&&p0e(t,o))?r=r.filter(u=>u!==o):i=a,o=vf(o)}return e.set(t,r),r}function Vlt(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const o=[...n==="clippingAncestors"?bA(e)?[]:Hlt(e,this._c):[].concat(n),r],a=o[0],l=o.reduce((c,u)=>{const d=Zee(e,u,i);return c.top=ga(d.top,c.top),c.right=yf(d.right,c.right),c.bottom=yf(d.bottom,c.bottom),c.left=ga(d.left,c.left),c},Zee(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Wlt(t){const{width:e,height:n}=d0e(t);return{width:e,height:n}}function Klt(t,e,n){const r=Cu(e),i=_u(e),s=n==="fixed",o=xg(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=pu(0);function c(){l.x=wA(i)}if(r||!r&&!s)if((Vv(e)!=="body"||WS(i))&&(a=xA(e)),r){const f=xg(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else i&&c();s&&!r&&i&&c();const u=i&&!r&&!s?f0e(i,a):pu(0),d=o.left+a.scrollLeft-l.x-u.x,h=o.top+a.scrollTop-l.y-u.y;return{x:d,y:h,width:o.width,height:o.height}}function fL(t){return Cc(t).position==="static"}function Qee(t,e){if(!Cu(t)||Cc(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return _u(t)===n&&(n=n.ownerDocument.body),n}function g0e(t,e){const n=Na(t);if(bA(t))return n;if(!Cu(t)){let i=vf(t);for(;i&&!Jy(i);){if(Sc(i)&&!fL(i))return i;i=vf(i)}return n}let r=Qee(t,e);for(;r&&_lt(r)&&fL(r);)r=Qee(r,e);return r&&Jy(r)&&fL(r)&&!C6(r)?n:r||Dlt(t)||n}const qlt=async function(t){const e=this.getOffsetParent||g0e,n=this.getDimensions,r=await n(t.floating);return{reference:Klt(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Glt(t){return Cc(t).direction==="rtl"}const Ylt={convertOffsetParentRelativeRectToViewportRelativeRect:Llt,getDocumentElement:_u,getClippingRect:Vlt,getOffsetParent:g0e,getElementRects:qlt,getClientRects:Flt,getDimensions:Wlt,getScale:by,isElement:Sc,isRTL:Glt};function m0e(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Xlt(t,e){let n=null,r;const i=_u(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:h,height:f}=c;if(a||e(),!h||!f)return;const y=nE(d),b=nE(i.clientWidth-(u+h)),v=nE(i.clientHeight-(d+f)),x=nE(u),E={rootMargin:-y+"px "+-b+"px "+-v+"px "+-x+"px",threshold:ga(0,yf(1,l))||1};let I=!0;function P(_){const A=_[0].intersectionRatio;if(A!==l){if(!I)return o();A?o(!1,A):r=setTimeout(()=>{o(!1,1e-7)},1e3)}A===1&&!m0e(c,t.getBoundingClientRect())&&o(),I=!1}try{n=new IntersectionObserver(P,{...E,root:i.ownerDocument})}catch{n=new IntersectionObserver(P,E)}n.observe(t)}return o(!0),s}function Jlt(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=T6(t),u=i||s?[...c?ww(c):[],...ww(e)]:[];u.forEach(x=>{i&&x.addEventListener("scroll",n,{passive:!0}),s&&x.addEventListener("resize",n)});const d=c&&a?Xlt(c,n):null;let h=-1,f=null;o&&(f=new ResizeObserver(x=>{let[C]=x;C&&C.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var E;(E=f)==null||E.observe(e)})),n()}),c&&!l&&f.observe(c),f.observe(e));let y,b=l?xg(t):null;l&&v();function v(){const x=xg(t);b&&!m0e(b,x)&&n(),b=x,y=requestAnimationFrame(v)}return n(),()=>{var x;u.forEach(C=>{i&&C.removeEventListener("scroll",n),s&&C.removeEventListener("resize",n)}),d==null||d(),(x=f)==null||x.disconnect(),f=null,l&&cancelAnimationFrame(y)}}const Zlt=Slt,Qlt=Clt,ect=blt,tct=Tlt,nct=xlt,ete=vlt,rct=Elt,ict=(t,e,n)=>{const r=new Map,i={platform:Ylt,...n},s={...i.platform,_c:r};return ylt(t,e,{...i,platform:s})};var sct=typeof document<"u",oct=function(){},nT=sct?S.useLayoutEffect:oct;function vP(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!vP(t[r],e[r]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const s=i[r];if(!(s==="_owner"&&t.$$typeof)&&!vP(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function y0e(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function tte(t,e){const n=y0e(t);return Math.round(e*n)/n}function pL(t){const e=S.useRef(t);return nT(()=>{e.current=t}),e}function act(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=S.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=S.useState(r);vP(h,r)||f(r);const[y,b]=S.useState(null),[v,x]=S.useState(null),C=S.useCallback(V=>{V!==_.current&&(_.current=V,b(V))},[]),E=S.useCallback(V=>{V!==A.current&&(A.current=V,x(V))},[]),I=s||y,P=o||v,_=S.useRef(null),A=S.useRef(null),D=S.useRef(u),L=l!=null,z=pL(l),$=pL(i),H=pL(c),R=S.useCallback(()=>{if(!_.current||!A.current)return;const V={placement:e,strategy:n,middleware:h};$.current&&(V.platform=$.current),ict(_.current,A.current,V).then(W=>{const Z={...W,isPositioned:H.current!==!1};j.current&&!vP(D.current,Z)&&(D.current=Z,_c.flushSync(()=>{d(Z)}))})},[h,e,n,$,H]);nT(()=>{c===!1&&D.current.isPositioned&&(D.current.isPositioned=!1,d(V=>({...V,isPositioned:!1})))},[c]);const j=S.useRef(!1);nT(()=>(j.current=!0,()=>{j.current=!1}),[]),nT(()=>{if(I&&(_.current=I),P&&(A.current=P),I&&P){if(z.current)return z.current(I,P,R);R()}},[I,P,R,z,L]);const B=S.useMemo(()=>({reference:_,floating:A,setReference:C,setFloating:E}),[C,E]),K=S.useMemo(()=>({reference:I,floating:P}),[I,P]),G=S.useMemo(()=>{const V={position:n,left:0,top:0};if(!K.floating)return V;const W=tte(K.floating,u.x),Z=tte(K.floating,u.y);return a?{...V,transform:"translate("+W+"px, "+Z+"px)",...y0e(K.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:W,top:Z}},[n,a,K.floating,u.x,u.y]);return S.useMemo(()=>({...u,update:R,refs:B,elements:K,floatingStyles:G}),[u,R,B,K,G])}const lct=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:i}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?ete({element:r.current,padding:i}).fn(n):{}:r?ete({element:r,padding:i}).fn(n):{}}}},cct=(t,e)=>({...Zlt(t),options:[t,e]}),uct=(t,e)=>({...Qlt(t),options:[t,e]}),dct=(t,e)=>({...rct(t),options:[t,e]}),hct=(t,e)=>({...ect(t),options:[t,e]}),fct=(t,e)=>({...tct(t),options:[t,e]}),pct=(t,e)=>({...nct(t),options:[t,e]}),gct=(t,e)=>({...lct(t),options:[t,e]});var mct="Arrow",v0e=S.forwardRef((t,e)=>{const{children:n,width:r=10,height:i=5,...s}=t;return g.jsx(jt.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:g.jsx("polygon",{points:"0,0 30,0 15,10"})})});v0e.displayName=mct;var yct=v0e,I6="Popper",[b0e,SA]=Ll(I6),[vct,x0e]=b0e(I6),w0e=t=>{const{__scopePopper:e,children:n}=t,[r,i]=S.useState(null);return g.jsx(vct,{scope:e,anchor:r,onAnchorChange:i,children:n})};w0e.displayName=I6;var S0e="PopperAnchor",C0e=S.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...i}=t,s=x0e(S0e,n),o=S.useRef(null),a=_n(e,o),l=S.useRef(null);return S.useEffect(()=>{const c=l.current;l.current=(r==null?void 0:r.current)||o.current,c!==l.current&&s.onAnchorChange(l.current)}),r?null:g.jsx(jt.div,{...i,ref:a})});C0e.displayName=S0e;var P6="PopperContent",[bct,xct]=b0e(P6),E0e=S.forwardRef((t,e)=>{var Ae,ke,le,ve,qe,de;const{__scopePopper:n,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:f="optimized",onPlaced:y,...b}=t,v=x0e(P6,n),[x,C]=S.useState(null),E=_n(e,pe=>C(pe)),[I,P]=S.useState(null),_=o0e(I),A=(_==null?void 0:_.width)??0,D=(_==null?void 0:_.height)??0,L=r+(s!=="center"?"-"+s:""),z=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},$=Array.isArray(c)?c:[c],H=$.length>0,R={padding:z,boundary:$.filter(Sct),altBoundary:H},{refs:j,floatingStyles:B,placement:K,isPositioned:G,middlewareData:V}=act({strategy:"fixed",placement:L,whileElementsMounted:(...pe)=>Jlt(...pe,{animationFrame:f==="always"}),elements:{reference:v.anchor},middleware:[cct({mainAxis:i+D,alignmentAxis:o}),l&&uct({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?dct():void 0,...R}),l&&hct({...R}),fct({...R,apply:({elements:pe,rects:Se,availableWidth:Fe,availableHeight:ut})=>{const{width:Tt,height:pn}=Se.reference,qn=pe.floating.style;qn.setProperty("--radix-popper-available-width",`${Fe}px`),qn.setProperty("--radix-popper-available-height",`${ut}px`),qn.setProperty("--radix-popper-anchor-width",`${Tt}px`),qn.setProperty("--radix-popper-anchor-height",`${pn}px`)}}),I&&gct({element:I,padding:a}),Cct({arrowWidth:A,arrowHeight:D}),h&&pct({strategy:"referenceHidden",...R})]}),[W,Z]=P0e(K),U=wo(y);Id(()=>{G&&(U==null||U())},[G,U]);const J=(Ae=V.arrow)==null?void 0:Ae.x,ge=(ke=V.arrow)==null?void 0:ke.y,_e=((le=V.arrow)==null?void 0:le.centerOffset)!==0,[fe,je]=S.useState();return Id(()=>{x&&je(window.getComputedStyle(x).zIndex)},[x]),g.jsx("div",{ref:j.setFloating,"data-radix-popper-content-wrapper":"",style:{...B,transform:G?B.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:fe,"--radix-popper-transform-origin":[(ve=V.transformOrigin)==null?void 0:ve.x,(qe=V.transformOrigin)==null?void 0:qe.y].join(" "),...((de=V.hide)==null?void 0:de.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:g.jsx(bct,{scope:n,placedSide:W,onArrowChange:P,arrowX:J,arrowY:ge,shouldHideArrow:_e,children:g.jsx(jt.div,{"data-side":W,"data-align":Z,...b,ref:E,style:{...b.style,animation:G?void 0:"none"}})})})});E0e.displayName=P6;var T0e="PopperArrow",wct={top:"bottom",right:"left",bottom:"top",left:"right"},I0e=S.forwardRef(function(e,n){const{__scopePopper:r,...i}=e,s=xct(T0e,r),o=wct[s.placedSide];return g.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:g.jsx(yct,{...i,ref:n,style:{...i.style,display:"block"}})})});I0e.displayName=T0e;function Sct(t){return t!==null}var Cct=t=>({name:"transformOrigin",options:t,fn(e){var v,x,C;const{placement:n,rects:r,middlewareData:i}=e,o=((v=i.arrow)==null?void 0:v.centerOffset)!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,u]=P0e(n),d={start:"0%",center:"50%",end:"100%"}[u],h=(((x=i.arrow)==null?void 0:x.x)??0)+a/2,f=(((C=i.arrow)==null?void 0:C.y)??0)+l/2;let y="",b="";return c==="bottom"?(y=o?d:`${h}px`,b=`${-l}px`):c==="top"?(y=o?d:`${h}px`,b=`${r.floating.height+l}px`):c==="right"?(y=`${-l}px`,b=o?d:`${f}px`):c==="left"&&(y=`${r.floating.width+l}px`,b=o?d:`${f}px`),{data:{x:y,y:b}}}});function P0e(t){const[e,n="center"]=t.split("-");return[e,n]}var _6=w0e,k6=C0e,_0e=E0e,k0e=I0e,gL="rovingFocusGroup.onEntryFocus",Ect={bubbles:!1,cancelable:!0},KS="RovingFocusGroup",[N$,A0e,Tct]=fA(KS),[Ict,Wv]=Ll(KS,[Tct]),[Pct,_ct]=Ict(KS),M0e=S.forwardRef((t,e)=>g.jsx(N$.Provider,{scope:t.__scopeRovingFocusGroup,children:g.jsx(N$.Slot,{scope:t.__scopeRovingFocusGroup,children:g.jsx(kct,{...t,ref:e})})}));M0e.displayName=KS;var kct=S.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...d}=t,h=S.useRef(null),f=_n(e,h),y=US(s),[b,v]=Mc({prop:o,defaultProp:a??null,onChange:l,caller:KS}),[x,C]=S.useState(!1),E=wo(c),I=A0e(n),P=S.useRef(!1),[_,A]=S.useState(0);return S.useEffect(()=>{const D=h.current;if(D)return D.addEventListener(gL,E),()=>D.removeEventListener(gL,E)},[E]),g.jsx(Pct,{scope:n,orientation:r,dir:y,loop:i,currentTabStopId:b,onItemFocus:S.useCallback(D=>v(D),[v]),onItemShiftTab:S.useCallback(()=>C(!0),[]),onFocusableItemAdd:S.useCallback(()=>A(D=>D+1),[]),onFocusableItemRemove:S.useCallback(()=>A(D=>D-1),[]),children:g.jsx(jt.div,{tabIndex:x||_===0?-1:0,"data-orientation":r,...d,ref:f,style:{outline:"none",...t.style},onMouseDown:Xe(t.onMouseDown,()=>{P.current=!0}),onFocus:Xe(t.onFocus,D=>{const L=!P.current;if(D.target===D.currentTarget&&L&&!x){const z=new CustomEvent(gL,Ect);if(D.currentTarget.dispatchEvent(z),!z.defaultPrevented){const $=I().filter(K=>K.focusable),H=$.find(K=>K.active),R=$.find(K=>K.id===b),B=[H,R,...$].filter(Boolean).map(K=>K.ref.current);R0e(B,u)}}P.current=!1}),onBlur:Xe(t.onBlur,()=>C(!1))})})}),O0e="RovingFocusGroupItem",D0e=S.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:s,children:o,...a}=t,l=gd(),c=s||l,u=_ct(O0e,n),d=u.currentTabStopId===c,h=A0e(n),{onFocusableItemAdd:f,onFocusableItemRemove:y,currentTabStopId:b}=u;return S.useEffect(()=>{if(r)return f(),()=>y()},[r,f,y]),g.jsx(N$.ItemSlot,{scope:n,id:c,focusable:r,active:i,children:g.jsx(jt.span,{tabIndex:d?0:-1,"data-orientation":u.orientation,...a,ref:e,onMouseDown:Xe(t.onMouseDown,v=>{r?u.onItemFocus(c):v.preventDefault()}),onFocus:Xe(t.onFocus,()=>u.onItemFocus(c)),onKeyDown:Xe(t.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){u.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const x=Oct(v,u.orientation,u.dir);if(x!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let E=h().filter(I=>I.focusable).map(I=>I.ref.current);if(x==="last")E.reverse();else if(x==="prev"||x==="next"){x==="prev"&&E.reverse();const I=E.indexOf(v.currentTarget);E=u.loop?Dct(E,I+1):E.slice(I+1)}setTimeout(()=>R0e(E))}}),children:typeof o=="function"?o({isCurrentTabStop:d,hasTabStop:b!=null}):o})})});D0e.displayName=O0e;var Act={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Mct(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Oct(t,e,n){const r=Mct(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Act[r]}function R0e(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function Dct(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var A6=M0e,CA=D0e,j$=["Enter"," "],Rct=["ArrowDown","PageUp","Home"],N0e=["ArrowUp","PageDown","End"],Nct=[...Rct,...N0e],jct={ltr:[...j$,"ArrowRight"],rtl:[...j$,"ArrowLeft"]},Lct={ltr:["ArrowLeft"],rtl:["ArrowRight"]},qS="Menu",[Sw,Fct,$ct]=fA(qS),[Kg,EA]=Ll(qS,[$ct,SA,Wv]),GS=SA(),j0e=Wv(),[L0e,Bf]=Kg(qS),[Bct,YS]=Kg(qS),F0e=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:i,onOpenChange:s,modal:o=!0}=t,a=GS(e),[l,c]=S.useState(null),u=S.useRef(!1),d=wo(s),h=US(i);return S.useEffect(()=>{const f=()=>{u.current=!0,document.addEventListener("pointerdown",y,{capture:!0,once:!0}),document.addEventListener("pointermove",y,{capture:!0,once:!0})},y=()=>u.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",y,{capture:!0}),document.removeEventListener("pointermove",y,{capture:!0})}},[]),g.jsx(_6,{...a,children:g.jsx(L0e,{scope:e,open:n,onOpenChange:d,content:l,onContentChange:c,children:g.jsx(Bct,{scope:e,onClose:S.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:o,children:r})})})};F0e.displayName=qS;var zct="MenuAnchor",M6=S.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=GS(n);return g.jsx(k6,{...i,...r,ref:e})});M6.displayName=zct;var O6="MenuPortal",[Uct,$0e]=Kg(O6,{forceMount:void 0}),B0e=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:i}=t,s=Bf(O6,e);return g.jsx(Uct,{scope:e,forceMount:n,children:g.jsx(Oc,{present:n||s.open,children:g.jsx(VS,{asChild:!0,container:i,children:r})})})};B0e.displayName=O6;var _l="MenuContent",[Hct,D6]=Kg(_l),z0e=S.forwardRef((t,e)=>{const n=$0e(_l,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=Bf(_l,t.__scopeMenu),o=YS(_l,t.__scopeMenu);return g.jsx(Sw.Provider,{scope:t.__scopeMenu,children:g.jsx(Oc,{present:r||s.open,children:g.jsx(Sw.Slot,{scope:t.__scopeMenu,children:o.modal?g.jsx(Vct,{...i,ref:e}):g.jsx(Wct,{...i,ref:e})})})})}),Vct=S.forwardRef((t,e)=>{const n=Bf(_l,t.__scopeMenu),r=S.useRef(null),i=_n(e,r);return S.useEffect(()=>{const s=r.current;if(s)return m6(s)},[]),g.jsx(R6,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Xe(t.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Wct=S.forwardRef((t,e)=>{const n=Bf(_l,t.__scopeMenu);return g.jsx(R6,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Kct=Xy("MenuContent.ScrollLock"),R6=S.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:f,disableOutsideScroll:y,...b}=t,v=Bf(_l,n),x=YS(_l,n),C=GS(n),E=j0e(n),I=Fct(n),[P,_]=S.useState(null),A=S.useRef(null),D=_n(e,A,v.onContentChange),L=S.useRef(0),z=S.useRef(""),$=S.useRef(0),H=S.useRef(null),R=S.useRef("right"),j=S.useRef(0),B=y?mA:S.Fragment,K=y?{as:Kct,allowPinchZoom:!0}:void 0,G=W=>{var Ae,ke;const Z=z.current+W,U=I().filter(le=>!le.disabled),J=document.activeElement,ge=(Ae=U.find(le=>le.ref.current===J))==null?void 0:Ae.textValue,_e=U.map(le=>le.textValue),fe=iut(_e,Z,ge),je=(ke=U.find(le=>le.textValue===fe))==null?void 0:ke.ref.current;(function le(ve){z.current=ve,window.clearTimeout(L.current),ve!==""&&(L.current=window.setTimeout(()=>le(""),1e3))})(Z),je&&setTimeout(()=>je.focus())};S.useEffect(()=>()=>window.clearTimeout(L.current),[]),g6();const V=S.useCallback(W=>{var U,J;return R.current===((U=H.current)==null?void 0:U.side)&&out(W,(J=H.current)==null?void 0:J.area)},[]);return g.jsx(Hct,{scope:n,searchRef:z,onItemEnter:S.useCallback(W=>{V(W)&&W.preventDefault()},[V]),onItemLeave:S.useCallback(W=>{var Z;V(W)||((Z=A.current)==null||Z.focus(),_(null))},[V]),onTriggerLeave:S.useCallback(W=>{V(W)&&W.preventDefault()},[V]),pointerGraceTimerRef:$,onPointerGraceIntentChange:S.useCallback(W=>{H.current=W},[]),children:g.jsx(B,{...K,children:g.jsx(pA,{asChild:!0,trapped:i,onMountAutoFocus:Xe(s,W=>{var Z;W.preventDefault(),(Z=A.current)==null||Z.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:g.jsx(HS,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:f,children:g.jsx(A6,{asChild:!0,...E,dir:x.dir,orientation:"vertical",loop:r,currentTabStopId:P,onCurrentTabStopIdChange:_,onEntryFocus:Xe(l,W=>{x.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:g.jsx(_0e,{role:"menu","aria-orientation":"vertical","data-state":ibe(v.open),"data-radix-menu-content":"",dir:x.dir,...C,...b,ref:D,style:{outline:"none",...b.style},onKeyDown:Xe(b.onKeyDown,W=>{const U=W.target.closest("[data-radix-menu-content]")===W.currentTarget,J=W.ctrlKey||W.altKey||W.metaKey,ge=W.key.length===1;U&&(W.key==="Tab"&&W.preventDefault(),!J&&ge&&G(W.key));const _e=A.current;if(W.target!==_e||!Nct.includes(W.key))return;W.preventDefault();const je=I().filter(Ae=>!Ae.disabled).map(Ae=>Ae.ref.current);N0e.includes(W.key)&&je.reverse(),nut(je)}),onBlur:Xe(t.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(L.current),z.current="")}),onPointerMove:Xe(t.onPointerMove,Cw(W=>{const Z=W.target,U=j.current!==W.clientX;if(W.currentTarget.contains(Z)&&U){const J=W.clientX>j.current?"right":"left";R.current=J,j.current=W.clientX}}))})})})})})})});z0e.displayName=_l;var qct="MenuGroup",N6=S.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return g.jsx(jt.div,{role:"group",...r,ref:e})});N6.displayName=qct;var Gct="MenuLabel",U0e=S.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return g.jsx(jt.div,{...r,ref:e})});U0e.displayName=Gct;var bP="MenuItem",nte="menu.itemSelect",TA=S.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...i}=t,s=S.useRef(null),o=YS(bP,t.__scopeMenu),a=D6(bP,t.__scopeMenu),l=_n(e,s),c=S.useRef(!1),u=()=>{const d=s.current;if(!n&&d){const h=new CustomEvent(nte,{bubbles:!0,cancelable:!0});d.addEventListener(nte,f=>r==null?void 0:r(f),{once:!0}),f6(d,h),h.defaultPrevented?c.current=!1:o.onClose()}};return g.jsx(H0e,{...i,ref:l,disabled:n,onClick:Xe(t.onClick,u),onPointerDown:d=>{var h;(h=t.onPointerDown)==null||h.call(t,d),c.current=!0},onPointerUp:Xe(t.onPointerUp,d=>{var h;c.current||(h=d.currentTarget)==null||h.click()}),onKeyDown:Xe(t.onKeyDown,d=>{const h=a.searchRef.current!=="";n||h&&d.key===" "||j$.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});TA.displayName=bP;var H0e=S.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...s}=t,o=D6(bP,n),a=j0e(n),l=S.useRef(null),c=_n(e,l),[u,d]=S.useState(!1),[h,f]=S.useState("");return S.useEffect(()=>{const y=l.current;y&&f((y.textContent??"").trim())},[s.children]),g.jsx(Sw.ItemSlot,{scope:n,disabled:r,textValue:i??h,children:g.jsx(CA,{asChild:!0,...a,focusable:!r,children:g.jsx(jt.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:c,onPointerMove:Xe(t.onPointerMove,Cw(y=>{r?o.onItemLeave(y):(o.onItemEnter(y),y.defaultPrevented||y.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Xe(t.onPointerLeave,Cw(y=>o.onItemLeave(y))),onFocus:Xe(t.onFocus,()=>d(!0)),onBlur:Xe(t.onBlur,()=>d(!1))})})})}),Yct="MenuCheckboxItem",V0e=S.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...i}=t;return g.jsx(Y0e,{scope:t.__scopeMenu,checked:n,children:g.jsx(TA,{role:"menuitemcheckbox","aria-checked":xP(n)?"mixed":n,...i,ref:e,"data-state":F6(n),onSelect:Xe(i.onSelect,()=>r==null?void 0:r(xP(n)?!0:!n),{checkForDefaultPrevented:!1})})})});V0e.displayName=Yct;var W0e="MenuRadioGroup",[Xct,Jct]=Kg(W0e,{value:void 0,onValueChange:()=>{}}),K0e=S.forwardRef((t,e)=>{const{value:n,onValueChange:r,...i}=t,s=wo(r);return g.jsx(Xct,{scope:t.__scopeMenu,value:n,onValueChange:s,children:g.jsx(N6,{...i,ref:e})})});K0e.displayName=W0e;var q0e="MenuRadioItem",G0e=S.forwardRef((t,e)=>{const{value:n,...r}=t,i=Jct(q0e,t.__scopeMenu),s=n===i.value;return g.jsx(Y0e,{scope:t.__scopeMenu,checked:s,children:g.jsx(TA,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":F6(s),onSelect:Xe(r.onSelect,()=>{var o;return(o=i.onValueChange)==null?void 0:o.call(i,n)},{checkForDefaultPrevented:!1})})})});G0e.displayName=q0e;var j6="MenuItemIndicator",[Y0e,Zct]=Kg(j6,{checked:!1}),X0e=S.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...i}=t,s=Zct(j6,n);return g.jsx(Oc,{present:r||xP(s.checked)||s.checked===!0,children:g.jsx(jt.span,{...i,ref:e,"data-state":F6(s.checked)})})});X0e.displayName=j6;var Qct="MenuSeparator",J0e=S.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return g.jsx(jt.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});J0e.displayName=Qct;var eut="MenuArrow",Z0e=S.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=GS(n);return g.jsx(k0e,{...i,...r,ref:e})});Z0e.displayName=eut;var L6="MenuSub",[tut,Q0e]=Kg(L6),ebe=t=>{const{__scopeMenu:e,children:n,open:r=!1,onOpenChange:i}=t,s=Bf(L6,e),o=GS(e),[a,l]=S.useState(null),[c,u]=S.useState(null),d=wo(i);return S.useEffect(()=>(s.open===!1&&d(!1),()=>d(!1)),[s.open,d]),g.jsx(_6,{...o,children:g.jsx(L0e,{scope:e,open:r,onOpenChange:d,content:c,onContentChange:u,children:g.jsx(tut,{scope:e,contentId:gd(),triggerId:gd(),trigger:a,onTriggerChange:l,children:n})})})};ebe.displayName=L6;var Lb="MenuSubTrigger",tbe=S.forwardRef((t,e)=>{const n=Bf(Lb,t.__scopeMenu),r=YS(Lb,t.__scopeMenu),i=Q0e(Lb,t.__scopeMenu),s=D6(Lb,t.__scopeMenu),o=S.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=s,c={__scopeMenu:t.__scopeMenu},u=S.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return S.useEffect(()=>u,[u]),S.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),l(null)}},[a,l]),g.jsx(M6,{asChild:!0,...c,children:g.jsx(H0e,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":ibe(n.open),...t,ref:hA(e,i.onTriggerChange),onClick:d=>{var h;(h=t.onClick)==null||h.call(t,d),!(t.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Xe(t.onPointerMove,Cw(d=>{s.onItemEnter(d),!d.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:Xe(t.onPointerLeave,Cw(d=>{var f,y;u();const h=(f=n.content)==null?void 0:f.getBoundingClientRect();if(h){const b=(y=n.content)==null?void 0:y.dataset.side,v=b==="right",x=v?-5:5,C=h[v?"left":"right"],E=h[v?"right":"left"];s.onPointerGraceIntentChange({area:[{x:d.clientX+x,y:d.clientY},{x:C,y:h.top},{x:E,y:h.top},{x:E,y:h.bottom},{x:C,y:h.bottom}],side:b}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(d),d.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:Xe(t.onKeyDown,d=>{var f;const h=s.searchRef.current!=="";t.disabled||h&&d.key===" "||jct[r.dir].includes(d.key)&&(n.onOpenChange(!0),(f=n.content)==null||f.focus(),d.preventDefault())})})})});tbe.displayName=Lb;var nbe="MenuSubContent",rbe=S.forwardRef((t,e)=>{const n=$0e(_l,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=Bf(_l,t.__scopeMenu),o=YS(_l,t.__scopeMenu),a=Q0e(nbe,t.__scopeMenu),l=S.useRef(null),c=_n(e,l);return g.jsx(Sw.Provider,{scope:t.__scopeMenu,children:g.jsx(Oc,{present:r||s.open,children:g.jsx(Sw.Slot,{scope:t.__scopeMenu,children:g.jsx(R6,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:c,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;o.isUsingKeyboardRef.current&&((d=l.current)==null||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:Xe(t.onFocusOutside,u=>{u.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:Xe(t.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:Xe(t.onKeyDown,u=>{var f;const d=u.currentTarget.contains(u.target),h=Lct[o.dir].includes(u.key);d&&h&&(s.onOpenChange(!1),(f=a.trigger)==null||f.focus(),u.preventDefault())})})})})})});rbe.displayName=nbe;function ibe(t){return t?"open":"closed"}function xP(t){return t==="indeterminate"}function F6(t){return xP(t)?"indeterminate":t?"checked":"unchecked"}function nut(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function rut(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function iut(t,e,n){const i=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,s=n?t.indexOf(n):-1;let o=rut(t,Math.max(s,0));i.length===1&&(o=o.filter(c=>c!==n));const l=o.find(c=>c.toLowerCase().startsWith(i.toLowerCase()));return l!==n?l:void 0}function sut(t,e){const{x:n,y:r}=t;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s],l=e[o],c=a.x,u=a.y,d=l.x,h=l.y;u>r!=h>r&&n<(d-c)*(r-u)/(h-u)+c&&(i=!i)}return i}function out(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return sut(n,e)}function Cw(t){return e=>e.pointerType==="mouse"?t(e):void 0}var sbe=F0e,obe=M6,abe=B0e,lbe=z0e,cbe=N6,ube=U0e,dbe=TA,hbe=V0e,fbe=K0e,pbe=G0e,gbe=X0e,mbe=J0e,ybe=Z0e,vbe=ebe,bbe=tbe,xbe=rbe,$6="ContextMenu",[aut,QPt]=Ll($6,[EA]),qs=EA(),[lut,wbe]=aut($6),Sbe=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:i,modal:s=!0}=t,[o,a]=S.useState(!1),l=qs(e),c=wo(r),u=S.useCallback(d=>{a(d),c(d)},[c]);return g.jsx(lut,{scope:e,open:o,onOpenChange:u,modal:s,children:g.jsx(sbe,{...l,dir:i,open:o,onOpenChange:u,modal:s,children:n})})};Sbe.displayName=$6;var Cbe="ContextMenuTrigger",Ebe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...i}=t,s=wbe(Cbe,n),o=qs(n),a=S.useRef({x:0,y:0}),l=S.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=S.useRef(0),u=S.useCallback(()=>window.clearTimeout(c.current),[]),d=h=>{a.current={x:h.clientX,y:h.clientY},s.onOpenChange(!0)};return S.useEffect(()=>u,[u]),S.useEffect(()=>void(r&&u()),[r,u]),g.jsxs(g.Fragment,{children:[g.jsx(obe,{...o,virtualRef:l}),g.jsx(jt.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:Xe(t.onContextMenu,h=>{u(),d(h),h.preventDefault()}),onPointerDown:r?t.onPointerDown:Xe(t.onPointerDown,rE(h=>{u(),c.current=window.setTimeout(()=>d(h),700)})),onPointerMove:r?t.onPointerMove:Xe(t.onPointerMove,rE(u)),onPointerCancel:r?t.onPointerCancel:Xe(t.onPointerCancel,rE(u)),onPointerUp:r?t.onPointerUp:Xe(t.onPointerUp,rE(u))})]})});Ebe.displayName=Cbe;var cut="ContextMenuPortal",B6=t=>{const{__scopeContextMenu:e,...n}=t,r=qs(e);return g.jsx(abe,{...r,...n})};B6.displayName=cut;var Tbe="ContextMenuContent",Ibe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=wbe(Tbe,n),s=qs(n),o=S.useRef(!1);return g.jsx(lbe,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var l;(l=t.onCloseAutoFocus)==null||l.call(t,a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{var l;(l=t.onInteractOutside)==null||l.call(t,a),!a.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ibe.displayName=Tbe;var uut="ContextMenuGroup",dut=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(cbe,{...i,...r,ref:e})});dut.displayName=uut;var hut="ContextMenuLabel",fut=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(ube,{...i,...r,ref:e})});fut.displayName=hut;var put="ContextMenuItem",Pbe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(dbe,{...i,...r,ref:e})});Pbe.displayName=put;var gut="ContextMenuCheckboxItem",_be=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(hbe,{...i,...r,ref:e})});_be.displayName=gut;var mut="ContextMenuRadioGroup",yut=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(fbe,{...i,...r,ref:e})});yut.displayName=mut;var vut="ContextMenuRadioItem",but=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(pbe,{...i,...r,ref:e})});but.displayName=vut;var xut="ContextMenuItemIndicator",wut=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(gbe,{...i,...r,ref:e})});wut.displayName=xut;var Sut="ContextMenuSeparator",Cut=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(mbe,{...i,...r,ref:e})});Cut.displayName=Sut;var Eut="ContextMenuArrow",Tut=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(ybe,{...i,...r,ref:e})});Tut.displayName=Eut;var kbe="ContextMenuSub",Abe=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,open:i,defaultOpen:s}=t,o=qs(e),[a,l]=Mc({prop:i,defaultProp:s??!1,onChange:r,caller:kbe});return g.jsx(vbe,{...o,open:a,onOpenChange:l,children:n})};Abe.displayName=kbe;var Iut="ContextMenuSubTrigger",Mbe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(bbe,{...i,...r,ref:e})});Mbe.displayName=Iut;var Put="ContextMenuSubContent",Obe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=qs(n);return g.jsx(xbe,{...i,...r,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Obe.displayName=Put;function rE(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var _ut=Sbe,kut=Ebe,Aut=B6,Mut=Ibe,Out=Pbe,Dut=_be,IA="DropdownMenu",[Rut,e_t]=Ll(IA,[EA]),Gs=EA(),[Nut,Dbe]=Rut(IA),Rbe=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:i,defaultOpen:s,onOpenChange:o,modal:a=!0}=t,l=Gs(e),c=S.useRef(null),[u,d]=Mc({prop:i,defaultProp:s??!1,onChange:o,caller:IA});return g.jsx(Nut,{scope:e,triggerId:gd(),triggerRef:c,contentId:gd(),open:u,onOpenChange:d,onOpenToggle:S.useCallback(()=>d(h=>!h),[d]),modal:a,children:g.jsx(sbe,{...l,open:u,onOpenChange:d,dir:r,modal:a,children:n})})};Rbe.displayName=IA;var Nbe="DropdownMenuTrigger",jbe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=t,s=Dbe(Nbe,n),o=Gs(n);return g.jsx(obe,{asChild:!0,...o,children:g.jsx(jt.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:hA(e,s.triggerRef),onPointerDown:Xe(t.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:Xe(t.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});jbe.displayName=Nbe;var jut="DropdownMenuPortal",Lbe=t=>{const{__scopeDropdownMenu:e,...n}=t,r=Gs(e);return g.jsx(abe,{...r,...n})};Lbe.displayName=jut;var Fbe="DropdownMenuContent",$be=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Dbe(Fbe,n),s=Gs(n),o=S.useRef(!1);return g.jsx(lbe,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...r,ref:e,onCloseAutoFocus:Xe(t.onCloseAutoFocus,a=>{var l;o.current||(l=i.triggerRef.current)==null||l.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:Xe(t.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!i.modal||u)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});$be.displayName=Fbe;var Lut="DropdownMenuGroup",Fut=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(cbe,{...i,...r,ref:e})});Fut.displayName=Lut;var $ut="DropdownMenuLabel",But=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(ube,{...i,...r,ref:e})});But.displayName=$ut;var zut="DropdownMenuItem",Bbe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(dbe,{...i,...r,ref:e})});Bbe.displayName=zut;var Uut="DropdownMenuCheckboxItem",zbe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(hbe,{...i,...r,ref:e})});zbe.displayName=Uut;var Hut="DropdownMenuRadioGroup",Vut=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(fbe,{...i,...r,ref:e})});Vut.displayName=Hut;var Wut="DropdownMenuRadioItem",Kut=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(pbe,{...i,...r,ref:e})});Kut.displayName=Wut;var qut="DropdownMenuItemIndicator",Ube=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(gbe,{...i,...r,ref:e})});Ube.displayName=qut;var Gut="DropdownMenuSeparator",Yut=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(mbe,{...i,...r,ref:e})});Yut.displayName=Gut;var Xut="DropdownMenuArrow",Jut=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(ybe,{...i,...r,ref:e})});Jut.displayName=Xut;var Zut=t=>{const{__scopeDropdownMenu:e,children:n,open:r,onOpenChange:i,defaultOpen:s}=t,o=Gs(e),[a,l]=Mc({prop:r,defaultProp:s??!1,onChange:i,caller:"DropdownMenuSub"});return g.jsx(vbe,{...o,open:a,onOpenChange:l,children:n})},Qut="DropdownMenuSubTrigger",Hbe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(bbe,{...i,...r,ref:e})});Hbe.displayName=Qut;var edt="DropdownMenuSubContent",Vbe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Gs(n);return g.jsx(xbe,{...i,...r,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Vbe.displayName=edt;var z6=Rbe,U6=jbe,PA=Lbe,H6=$be,tdt=Bbe,Wbe=zbe,ndt=Ube,rdt=Zut,idt=Hbe,sdt=Vbe;function Kbe(t,[e,n]){return Math.min(n,Math.max(e,t))}var _A="Popover",[qbe,t_t]=Ll(_A,[SA]),XS=SA(),[odt,zf]=qbe(_A),Gbe=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:i,onOpenChange:s,modal:o=!1}=t,a=XS(e),l=S.useRef(null),[c,u]=S.useState(!1),[d,h]=Mc({prop:r,defaultProp:i??!1,onChange:s,caller:_A});return g.jsx(_6,{...a,children:g.jsx(odt,{scope:e,contentId:gd(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:S.useCallback(()=>h(f=>!f),[h]),hasCustomAnchor:c,onCustomAnchorAdd:S.useCallback(()=>u(!0),[]),onCustomAnchorRemove:S.useCallback(()=>u(!1),[]),modal:o,children:n})})};Gbe.displayName=_A;var Ybe="PopoverAnchor",adt=S.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,i=zf(Ybe,n),s=XS(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=i;return S.useEffect(()=>(o(),()=>a()),[o,a]),g.jsx(k6,{...s,...r,ref:e})});adt.displayName=Ybe;var Xbe="PopoverTrigger",Jbe=S.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,i=zf(Xbe,n),s=XS(n),o=_n(e,i.triggerRef),a=g.jsx(jt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":nxe(i.open),...r,ref:o,onClick:Xe(t.onClick,i.onOpenToggle)});return i.hasCustomAnchor?a:g.jsx(k6,{asChild:!0,...s,children:a})});Jbe.displayName=Xbe;var V6="PopoverPortal",[ldt,cdt]=qbe(V6,{forceMount:void 0}),Zbe=t=>{const{__scopePopover:e,forceMount:n,children:r,container:i}=t,s=zf(V6,e);return g.jsx(ldt,{scope:e,forceMount:n,children:g.jsx(Oc,{present:n||s.open,children:g.jsx(VS,{asChild:!0,container:i,children:r})})})};Zbe.displayName=V6;var Zy="PopoverContent",Qbe=S.forwardRef((t,e)=>{const n=cdt(Zy,t.__scopePopover),{forceMount:r=n.forceMount,...i}=t,s=zf(Zy,t.__scopePopover);return g.jsx(Oc,{present:r||s.open,children:s.modal?g.jsx(ddt,{...i,ref:e}):g.jsx(hdt,{...i,ref:e})})});Qbe.displayName=Zy;var udt=Xy("PopoverContent.RemoveScroll"),ddt=S.forwardRef((t,e)=>{const n=zf(Zy,t.__scopePopover),r=S.useRef(null),i=_n(e,r),s=S.useRef(!1);return S.useEffect(()=>{const o=r.current;if(o)return m6(o)},[]),g.jsx(mA,{as:udt,allowPinchZoom:!0,children:g.jsx(exe,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Xe(t.onCloseAutoFocus,o=>{var a;o.preventDefault(),s.current||(a=n.triggerRef.current)==null||a.focus()}),onPointerDownOutside:Xe(t.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Xe(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),hdt=S.forwardRef((t,e)=>{const n=zf(Zy,t.__scopePopover),r=S.useRef(!1),i=S.useRef(!1);return g.jsx(exe,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=t.onCloseAutoFocus)==null||o.call(t,s),s.defaultPrevented||(r.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var l,c;(l=t.onInteractOutside)==null||l.call(t,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((c=n.triggerRef.current)==null?void 0:c.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),exe=S.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,h=zf(Zy,n),f=XS(n);return g6(),g.jsx(pA,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:g.jsx(HS,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:g.jsx(_0e,{"data-state":nxe(h.open),role:"dialog",id:h.contentId,...f,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),txe="PopoverClose",fdt=S.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,i=zf(txe,n);return g.jsx(jt.button,{type:"button",...r,ref:e,onClick:Xe(t.onClick,()=>i.onOpenChange(!1))})});fdt.displayName=txe;var pdt="PopoverArrow",gdt=S.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,i=XS(n);return g.jsx(k0e,{...i,...r,ref:e})});gdt.displayName=pdt;function nxe(t){return t?"open":"closed"}var W6=Gbe,K6=Jbe,q6=Zbe,G6=Qbe,mdt="Separator",rte="horizontal",ydt=["horizontal","vertical"],rxe=S.forwardRef((t,e)=>{const{decorative:n,orientation:r=rte,...i}=t,s=vdt(r)?r:rte,a=n?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return g.jsx(jt.div,{"data-orientation":s,...a,...i,ref:e})});rxe.displayName=mdt;function vdt(t){return ydt.includes(t)}var bdt=rxe,ixe=["PageUp","PageDown"],sxe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],oxe={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Kv="Slider",[L$,xdt,wdt]=fA(Kv),[axe,n_t]=Ll(Kv,[wdt]),[Sdt,kA]=axe(Kv),lxe=S.forwardRef((t,e)=>{const{name:n,min:r=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:f=!1,form:y,...b}=t,v=S.useRef(new Set),x=S.useRef(0),E=o==="horizontal"?Cdt:Edt,[I=[],P]=Mc({prop:u,defaultProp:c,onChange:$=>{var R;(R=[...v.current][x.current])==null||R.focus(),d($)}}),_=S.useRef(I);function A($){const H=kdt(I,$);z($,H)}function D($){z($,x.current)}function L(){const $=_.current[x.current];I[x.current]!==$&&h(I)}function z($,H,{commit:R}={commit:!1}){const j=Ddt(s),B=Rdt(Math.round(($-r)/s)*s+r,j),K=Kbe(B,[r,i]);P((G=[])=>{const V=Pdt(G,K,H);if(Odt(V,l*s)){x.current=V.indexOf(K);const W=String(V)!==String(G);return W&&R&&h(V),W?V:G}else return G})}return g.jsx(Sdt,{scope:t.__scopeSlider,name:n,disabled:a,min:r,max:i,valueIndexToChangeRef:x,thumbs:v.current,values:I,orientation:o,form:y,children:g.jsx(L$.Provider,{scope:t.__scopeSlider,children:g.jsx(L$.Slot,{scope:t.__scopeSlider,children:g.jsx(E,{"aria-disabled":a,"data-disabled":a?"":void 0,...b,ref:e,onPointerDown:Xe(b.onPointerDown,()=>{a||(_.current=I)}),min:r,max:i,inverted:f,onSlideStart:a?void 0:A,onSlideMove:a?void 0:D,onSlideEnd:a?void 0:L,onHomeKeyDown:()=>!a&&z(r,0,{commit:!0}),onEndKeyDown:()=>!a&&z(i,I.length-1,{commit:!0}),onStepKeyDown:({event:$,direction:H})=>{if(!a){const B=ixe.includes($.key)||$.shiftKey&&sxe.includes($.key)?10:1,K=x.current,G=I[K],V=s*B*H;z(G+V,K,{commit:!0})}}})})})})});lxe.displayName=Kv;var[cxe,uxe]=axe(Kv,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Cdt=S.forwardRef((t,e)=>{const{min:n,max:r,dir:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=t,[d,h]=S.useState(null),f=_n(e,E=>h(E)),y=S.useRef(void 0),b=US(i),v=b==="ltr",x=v&&!s||!v&&s;function C(E){const I=y.current||d.getBoundingClientRect(),P=[0,I.width],A=Y6(P,x?[n,r]:[r,n]);return y.current=I,A(E-I.left)}return g.jsx(cxe,{scope:t.__scopeSlider,startEdge:x?"left":"right",endEdge:x?"right":"left",direction:x?1:-1,size:"width",children:g.jsx(dxe,{dir:b,"data-orientation":"horizontal",...u,ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:E=>{const I=C(E.clientX);o==null||o(I)},onSlideMove:E=>{const I=C(E.clientX);a==null||a(I)},onSlideEnd:()=>{y.current=void 0,l==null||l()},onStepKeyDown:E=>{const P=oxe[x?"from-left":"from-right"].includes(E.key);c==null||c({event:E,direction:P?-1:1})}})})}),Edt=S.forwardRef((t,e)=>{const{min:n,max:r,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onStepKeyDown:l,...c}=t,u=S.useRef(null),d=_n(e,u),h=S.useRef(void 0),f=!i;function y(b){const v=h.current||u.current.getBoundingClientRect(),x=[0,v.height],E=Y6(x,f?[r,n]:[n,r]);return h.current=v,E(b-v.top)}return g.jsx(cxe,{scope:t.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:g.jsx(dxe,{"data-orientation":"vertical",...c,ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:b=>{const v=y(b.clientY);s==null||s(v)},onSlideMove:b=>{const v=y(b.clientY);o==null||o(v)},onSlideEnd:()=>{h.current=void 0,a==null||a()},onStepKeyDown:b=>{const x=oxe[f?"from-bottom":"from-top"].includes(b.key);l==null||l({event:b,direction:x?-1:1})}})})}),dxe=S.forwardRef((t,e)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:l,...c}=t,u=kA(Kv,n);return g.jsx(jt.span,{...c,ref:e,onKeyDown:Xe(t.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):ixe.concat(sxe).includes(d.key)&&(l(d),d.preventDefault())}),onPointerDown:Xe(t.onPointerDown,d=>{const h=d.target;h.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(h)?h.focus():r(d)}),onPointerMove:Xe(t.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&i(d)}),onPointerUp:Xe(t.onPointerUp,d=>{const h=d.target;h.hasPointerCapture(d.pointerId)&&(h.releasePointerCapture(d.pointerId),s(d))})})}),hxe="SliderTrack",fxe=S.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=kA(hxe,n);return g.jsx(jt.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});fxe.displayName=hxe;var F$="SliderRange",pxe=S.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=kA(F$,n),s=uxe(F$,n),o=S.useRef(null),a=_n(e,o),l=i.values.length,c=i.values.map(h=>yxe(h,i.min,i.max)),u=l>1?Math.min(...c):0,d=100-Math.max(...c);return g.jsx(jt.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:a,style:{...t.style,[s.startEdge]:u+"%",[s.endEdge]:d+"%"}})});pxe.displayName=F$;var $$="SliderThumb",gxe=S.forwardRef((t,e)=>{const n=xdt(t.__scopeSlider),[r,i]=S.useState(null),s=_n(e,a=>i(a)),o=S.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return g.jsx(Tdt,{...t,ref:s,index:o})}),Tdt=S.forwardRef((t,e)=>{const{__scopeSlider:n,index:r,name:i,...s}=t,o=kA($$,n),a=uxe($$,n),[l,c]=S.useState(null),u=_n(e,C=>c(C)),d=l?o.form||!!l.closest("form"):!0,h=o0e(l),f=o.values[r],y=f===void 0?0:yxe(f,o.min,o.max),b=_dt(r,o.values.length),v=h==null?void 0:h[a.size],x=v?Adt(v,y,a.direction):0;return S.useEffect(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),g.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${y}% + ${x}px)`},children:[g.jsx(L$.ItemSlot,{scope:t.__scopeSlider,children:g.jsx(jt.span,{role:"slider","aria-label":t["aria-label"]||b,"aria-valuemin":o.min,"aria-valuenow":f,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:u,style:f===void 0?{display:"none"}:t.style,onFocus:Xe(t.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),d&&g.jsx(mxe,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:f},r)]})});gxe.displayName=$$;var Idt="RadioBubbleInput",mxe=S.forwardRef(({__scopeSlider:t,value:e,...n},r)=>{const i=S.useRef(null),s=_n(i,r),o=slt(e);return S.useEffect(()=>{const a=i.current;if(!a)return;const l=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==e&&u){const d=new Event("input",{bubbles:!0});u.call(a,e),a.dispatchEvent(d)}},[o,e]),g.jsx(jt.input,{style:{display:"none"},...n,ref:s,defaultValue:e})});mxe.displayName=Idt;function Pdt(t=[],e,n){const r=[...t];return r[n]=e,r.sort((i,s)=>i-s)}function yxe(t,e,n){const s=100/(n-e)*(t-e);return Kbe(s,[0,100])}function _dt(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function kdt(t,e){if(t.length===1)return 0;const n=t.map(i=>Math.abs(i-e)),r=Math.min(...n);return n.indexOf(r)}function Adt(t,e,n){const r=t/2,s=Y6([0,50],[0,r]);return(r-s(e)*n)*n}function Mdt(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function Odt(t,e){if(e>0){const n=Mdt(t);return Math.min(...n)>=e}return!0}function Y6(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function Ddt(t){return(String(t).split(".")[1]||"").length}function Rdt(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}var Ndt=lxe,jdt=fxe,Ldt=pxe,Fdt=gxe,X6="ToastProvider",[J6,$dt,Bdt]=fA("Toast"),[vxe,r_t]=Ll("Toast",[Bdt]),[zdt,AA]=vxe(X6),bxe=t=>{const{__scopeToast:e,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:s=50,children:o}=t,[a,l]=S.useState(null),[c,u]=S.useState(0),d=S.useRef(!1),h=S.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${X6}\`. Expected non-empty \`string\`.`),g.jsx(J6.Provider,{scope:e,children:g.jsx(zdt,{scope:e,label:n,duration:r,swipeDirection:i,swipeThreshold:s,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:S.useCallback(()=>u(f=>f+1),[]),onToastRemove:S.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h,children:o})})};bxe.displayName=X6;var xxe="ToastViewport",Udt=["F8"],B$="toast.viewportPause",z$="toast.viewportResume",wxe=S.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:r=Udt,label:i="Notifications ({hotkey})",...s}=t,o=AA(xxe,n),a=$dt(n),l=S.useRef(null),c=S.useRef(null),u=S.useRef(null),d=S.useRef(null),h=_n(e,d,o.onViewportChange),f=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=o.toastCount>0;S.useEffect(()=>{const v=x=>{var E;r.length!==0&&r.every(I=>x[I]||x.code===I)&&((E=d.current)==null||E.focus())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[r]),S.useEffect(()=>{const v=l.current,x=d.current;if(y&&v&&x){const C=()=>{if(!o.isClosePausedRef.current){const _=new CustomEvent(B$);x.dispatchEvent(_),o.isClosePausedRef.current=!0}},E=()=>{if(o.isClosePausedRef.current){const _=new CustomEvent(z$);x.dispatchEvent(_),o.isClosePausedRef.current=!1}},I=_=>{!v.contains(_.relatedTarget)&&E()},P=()=>{v.contains(document.activeElement)||E()};return v.addEventListener("focusin",C),v.addEventListener("focusout",I),v.addEventListener("pointermove",C),v.addEventListener("pointerleave",P),window.addEventListener("blur",C),window.addEventListener("focus",E),()=>{v.removeEventListener("focusin",C),v.removeEventListener("focusout",I),v.removeEventListener("pointermove",C),v.removeEventListener("pointerleave",P),window.removeEventListener("blur",C),window.removeEventListener("focus",E)}}},[y,o.isClosePausedRef]);const b=S.useCallback(({tabbingDirection:v})=>{const C=a().map(E=>{const I=E.ref.current,P=[I,...tht(I)];return v==="forwards"?P:P.reverse()});return(v==="forwards"?C.reverse():C).flat()},[a]);return S.useEffect(()=>{const v=d.current;if(v){const x=C=>{var P,_,A;const E=C.altKey||C.ctrlKey||C.metaKey;if(C.key==="Tab"&&!E){const D=document.activeElement,L=C.shiftKey;if(C.target===v&&L){(P=c.current)==null||P.focus();return}const H=b({tabbingDirection:L?"backwards":"forwards"}),R=H.findIndex(j=>j===D);mL(H.slice(R+1))?C.preventDefault():L?(_=c.current)==null||_.focus():(A=u.current)==null||A.focus()}};return v.addEventListener("keydown",x),()=>v.removeEventListener("keydown",x)}},[a,b]),g.jsxs(Xot,{ref:l,role:"region","aria-label":i.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:y?void 0:"none"},children:[y&&g.jsx(U$,{ref:c,onFocusFromOutsideViewport:()=>{const v=b({tabbingDirection:"forwards"});mL(v)}}),g.jsx(J6.Slot,{scope:n,children:g.jsx(jt.ol,{tabIndex:-1,...s,ref:h})}),y&&g.jsx(U$,{ref:u,onFocusFromOutsideViewport:()=>{const v=b({tabbingDirection:"backwards"});mL(v)}})]})});wxe.displayName=xxe;var Sxe="ToastFocusProxy",U$=S.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=t,s=AA(Sxe,n);return g.jsx(p6,{tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=s.viewport)!=null&&c.contains(a))&&r()}})});U$.displayName=Sxe;var JS="Toast",Hdt="toast.swipeStart",Vdt="toast.swipeMove",Wdt="toast.swipeCancel",Kdt="toast.swipeEnd",Cxe=S.forwardRef((t,e)=>{const{forceMount:n,open:r,defaultOpen:i,onOpenChange:s,...o}=t,[a,l]=Mc({prop:r,defaultProp:i??!0,onChange:s,caller:JS});return g.jsx(Oc,{present:n||a,children:g.jsx(Ydt,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:wo(t.onPause),onResume:wo(t.onResume),onSwipeStart:Xe(t.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Xe(t.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:Xe(t.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Xe(t.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});Cxe.displayName=JS;var[qdt,Gdt]=vxe(JS,{onClose(){}}),Ydt=S.forwardRef((t,e)=>{const{__scopeToast:n,type:r="foreground",duration:i,open:s,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:f,...y}=t,b=AA(JS,n),[v,x]=S.useState(null),C=_n(e,j=>x(j)),E=S.useRef(null),I=S.useRef(null),P=i||b.duration,_=S.useRef(0),A=S.useRef(P),D=S.useRef(0),{onToastAdd:L,onToastRemove:z}=b,$=wo(()=>{var B;(v==null?void 0:v.contains(document.activeElement))&&((B=b.viewport)==null||B.focus()),o()}),H=S.useCallback(j=>{!j||j===1/0||(window.clearTimeout(D.current),_.current=new Date().getTime(),D.current=window.setTimeout($,j))},[$]);S.useEffect(()=>{const j=b.viewport;if(j){const B=()=>{H(A.current),c==null||c()},K=()=>{const G=new Date().getTime()-_.current;A.current=A.current-G,window.clearTimeout(D.current),l==null||l()};return j.addEventListener(B$,K),j.addEventListener(z$,B),()=>{j.removeEventListener(B$,K),j.removeEventListener(z$,B)}}},[b.viewport,P,l,c,H]),S.useEffect(()=>{s&&!b.isClosePausedRef.current&&H(P)},[s,P,b.isClosePausedRef,H]),S.useEffect(()=>(L(),()=>z()),[L,z]);const R=S.useMemo(()=>v?Axe(v):null,[v]);return b.viewport?g.jsxs(g.Fragment,{children:[R&&g.jsx(Xdt,{__scopeToast:n,role:"status","aria-live":r==="foreground"?"assertive":"polite",children:R}),g.jsx(qdt,{scope:n,onClose:$,children:_c.createPortal(g.jsx(J6.ItemSlot,{scope:n,children:g.jsx(Yot,{asChild:!0,onEscapeKeyDown:Xe(a,()=>{b.isFocusedToastEscapeKeyDownRef.current||$(),b.isFocusedToastEscapeKeyDownRef.current=!1}),children:g.jsx(jt.li,{tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":b.swipeDirection,...y,ref:C,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:Xe(t.onKeyDown,j=>{j.key==="Escape"&&(a==null||a(j.nativeEvent),j.nativeEvent.defaultPrevented||(b.isFocusedToastEscapeKeyDownRef.current=!0,$()))}),onPointerDown:Xe(t.onPointerDown,j=>{j.button===0&&(E.current={x:j.clientX,y:j.clientY})}),onPointerMove:Xe(t.onPointerMove,j=>{if(!E.current)return;const B=j.clientX-E.current.x,K=j.clientY-E.current.y,G=!!I.current,V=["left","right"].includes(b.swipeDirection),W=["left","up"].includes(b.swipeDirection)?Math.min:Math.max,Z=V?W(0,B):0,U=V?0:W(0,K),J=j.pointerType==="touch"?10:2,ge={x:Z,y:U},_e={originalEvent:j,delta:ge};G?(I.current=ge,iE(Vdt,d,_e,{discrete:!1})):ite(ge,b.swipeDirection,J)?(I.current=ge,iE(Hdt,u,_e,{discrete:!1}),j.target.setPointerCapture(j.pointerId)):(Math.abs(B)>J||Math.abs(K)>J)&&(E.current=null)}),onPointerUp:Xe(t.onPointerUp,j=>{const B=I.current,K=j.target;if(K.hasPointerCapture(j.pointerId)&&K.releasePointerCapture(j.pointerId),I.current=null,E.current=null,B){const G=j.currentTarget,V={originalEvent:j,delta:B};ite(B,b.swipeDirection,b.swipeThreshold)?iE(Kdt,f,V,{discrete:!0}):iE(Wdt,h,V,{discrete:!0}),G.addEventListener("click",W=>W.preventDefault(),{once:!0})}})})})}),b.viewport)})]}):null}),Xdt=t=>{const{__scopeToast:e,children:n,...r}=t,i=AA(JS,e),[s,o]=S.useState(!1),[a,l]=S.useState(!1);return Qdt(()=>o(!0)),S.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:g.jsx(VS,{asChild:!0,children:g.jsx(p6,{...r,children:s&&g.jsxs(g.Fragment,{children:[i.label," ",n]})})})},Jdt="ToastTitle",Exe=S.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return g.jsx(jt.div,{...r,ref:e})});Exe.displayName=Jdt;var Zdt="ToastDescription",Txe=S.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return g.jsx(jt.div,{...r,ref:e})});Txe.displayName=Zdt;var Ixe="ToastAction",Pxe=S.forwardRef((t,e)=>{const{altText:n,...r}=t;return n.trim()?g.jsx(kxe,{altText:n,asChild:!0,children:g.jsx(Z6,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${Ixe}\`. Expected non-empty \`string\`.`),null)});Pxe.displayName=Ixe;var _xe="ToastClose",Z6=S.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t,i=Gdt(_xe,n);return g.jsx(kxe,{asChild:!0,children:g.jsx(jt.button,{type:"button",...r,ref:e,onClick:Xe(t.onClick,i.onClose)})})});Z6.displayName=_xe;var kxe=S.forwardRef((t,e)=>{const{__scopeToast:n,altText:r,...i}=t;return g.jsx(jt.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:e})});function Axe(t){const e=[];return Array.from(t.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),eht(r)){const i=r.ariaHidden||r.hidden||r.style.display==="none",s=r.dataset.radixToastAnnounceExclude==="";if(!i)if(s){const o=r.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...Axe(r))}}),e}function iE(t,e,n,{discrete:r}){const i=n.originalEvent.currentTarget,s=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?f6(i,s):i.dispatchEvent(s)}var ite=(t,e,n=0)=>{const r=Math.abs(t.x),i=Math.abs(t.y),s=r>i;return e==="left"||e==="right"?s&&r>n:!s&&i>n};function Qdt(t=()=>{}){const e=wo(t);Id(()=>{let n=0,r=0;return n=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(r)}},[e])}function eht(t){return t.nodeType===t.ELEMENT_NODE}function tht(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function mL(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}var nht=bxe,rht=Cxe,iht=Exe,sht=Txe,oht=Pxe,ste=Z6,Mxe="Toggle",Oxe=S.forwardRef((t,e)=>{const{pressed:n,defaultPressed:r,onPressedChange:i,...s}=t,[o,a]=Mc({prop:n,onChange:i,defaultProp:r??!1,caller:Mxe});return g.jsx(jt.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":t.disabled?"":void 0,...s,ref:e,onClick:Xe(t.onClick,()=>{t.disabled||a(!o)})})});Oxe.displayName=Mxe;var Uf="ToggleGroup",[Dxe,Rxe]=Ll(Uf,[Wv]),Nxe=Wv(),Q6=$e.forwardRef((t,e)=>{const{type:n,...r}=t;if(n==="single"){const i=r;return g.jsx(aht,{...i,ref:e})}if(n==="multiple"){const i=r;return g.jsx(lht,{...i,ref:e})}throw new Error(`Missing prop \`type\` expected on \`${Uf}\``)});Q6.displayName=Uf;var[jxe,Lxe]=Dxe(Uf),aht=$e.forwardRef((t,e)=>{const{value:n,defaultValue:r,onValueChange:i=()=>{},...s}=t,[o,a]=Mc({prop:n,defaultProp:r??"",onChange:i,caller:Uf});return g.jsx(jxe,{scope:t.__scopeToggleGroup,type:"single",value:$e.useMemo(()=>o?[o]:[],[o]),onItemActivate:a,onItemDeactivate:$e.useCallback(()=>a(""),[a]),children:g.jsx(Fxe,{...s,ref:e})})}),lht=$e.forwardRef((t,e)=>{const{value:n,defaultValue:r,onValueChange:i=()=>{},...s}=t,[o,a]=Mc({prop:n,defaultProp:r??[],onChange:i,caller:Uf}),l=$e.useCallback(u=>a((d=[])=>[...d,u]),[a]),c=$e.useCallback(u=>a((d=[])=>d.filter(h=>h!==u)),[a]);return g.jsx(jxe,{scope:t.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:l,onItemDeactivate:c,children:g.jsx(Fxe,{...s,ref:e})})});Q6.displayName=Uf;var[cht,uht]=Dxe(Uf),Fxe=$e.forwardRef((t,e)=>{const{__scopeToggleGroup:n,disabled:r=!1,rovingFocus:i=!0,orientation:s,dir:o,loop:a=!0,...l}=t,c=Nxe(n),u=US(o),d={role:"group",dir:u,...l};return g.jsx(cht,{scope:n,rovingFocus:i,disabled:r,children:i?g.jsx(A6,{asChild:!0,...c,orientation:s,dir:u,loop:a,children:g.jsx(jt.div,{...d,ref:e})}):g.jsx(jt.div,{...d,ref:e})})}),wP="ToggleGroupItem",$xe=$e.forwardRef((t,e)=>{const n=Lxe(wP,t.__scopeToggleGroup),r=uht(wP,t.__scopeToggleGroup),i=Nxe(t.__scopeToggleGroup),s=n.value.includes(t.value),o=r.disabled||t.disabled,a={...t,pressed:s,disabled:o},l=$e.useRef(null);return r.rovingFocus?g.jsx(CA,{asChild:!0,...i,focusable:!o,active:s,ref:l,children:g.jsx(ote,{...a,ref:e})}):g.jsx(ote,{...a,ref:e})});$xe.displayName=wP;var ote=$e.forwardRef((t,e)=>{const{__scopeToggleGroup:n,value:r,...i}=t,s=Lxe(wP,n),o={role:"radio","aria-checked":t.pressed,"aria-pressed":void 0},a=s.type==="single"?o:void 0;return g.jsx(Oxe,{...a,...i,ref:e,onPressedChange:l=>{l?s.onItemActivate(r):s.onItemDeactivate(r)}})}),dht=Q6,hht=$xe,e9="Toolbar",[fht,i_t]=Ll(e9,[Wv,Rxe]),t9=Wv(),Bxe=Rxe(),[pht,zxe]=fht(e9),Uxe=S.forwardRef((t,e)=>{const{__scopeToolbar:n,orientation:r="horizontal",dir:i,loop:s=!0,...o}=t,a=t9(n),l=US(i);return g.jsx(pht,{scope:n,orientation:r,dir:l,children:g.jsx(A6,{asChild:!0,...a,orientation:r,dir:l,loop:s,children:g.jsx(jt.div,{role:"toolbar","aria-orientation":r,dir:l,...o,ref:e})})})});Uxe.displayName=e9;var Hxe="ToolbarSeparator",ght=S.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=zxe(Hxe,n);return g.jsx(bdt,{orientation:i.orientation==="horizontal"?"vertical":"horizontal",...r,ref:e})});ght.displayName=Hxe;var mht="ToolbarButton",n9=S.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=t9(n);return g.jsx(CA,{asChild:!0,...i,focusable:!t.disabled,children:g.jsx(jt.button,{type:"button",...r,ref:e})})});n9.displayName=mht;var yht="ToolbarLink",vht=S.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=t9(n);return g.jsx(CA,{asChild:!0,...i,focusable:!0,children:g.jsx(jt.a,{...r,ref:e,onKeyDown:Xe(t.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});vht.displayName=yht;var Vxe="ToolbarToggleGroup",Wxe=S.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=zxe(Vxe,n),s=Bxe(n);return g.jsx(dht,{"data-orientation":i.orientation,dir:i.dir,...s,...r,ref:e,rovingFocus:!1})});Wxe.displayName=Vxe;var bht="ToolbarToggleItem",Kxe=S.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=Bxe(n),s={__scopeToolbar:t.__scopeToolbar};return g.jsx(n9,{asChild:!0,...s,children:g.jsx(hht,{...i,...r,ref:e})})});Kxe.displayName=bht;var xht=Uxe,wht=n9,Sht=Wxe,Cht=Kxe;function Eht(t,e){const n=bt(e.map(i=>t.getShape(i)).filter(i=>i&&t.isShapeOfType(i,"frame")));if(!n.length)return;const r=[];t.run(()=>{n.map(i=>{const s=t.getSortedChildIdsForParent(i.id);s.length&&(yn(t,s,{filter:o=>!n.find(a=>a.id===o.id)}),r.push(...s))}),t.setSelectedShapes(r),t.deleteShapes(e)})}const ate=50;function qxe(t,e,n={padding:ate}){const r=Ee.FromPoints(t.flatMap(c=>{if(!c)return[];const u=e.getShapeGeometry(c.id),d=e.getShapeLocalTransform(c);return(d==null?void 0:d.applyToPoints(u.vertices))??[]})),i=n.padding??ate,s=r.w+2*i,o=r.h+2*i,a=i-r.minX,l=i-r.minY;return{w:s,h:o,dx:a,dy:l}}function Gxe(t,e,n={}){const r=t.getShape(e);if(!r)return;const i=t.getSortedChildIdsForParent(r.id),s=bt(i.map(d=>t.getShape(d)));if(!s.length)return;const{w:o,h:a,dx:l,dy:c}=qxe(s,t,n);if(l===0&&c===0&&r.props.w===o&&r.props.h===a)return;const u=new M(l,c).rot(r.rotation);t.run(()=>{const d=i.map(h=>{const f=t.getShape(h);return{id:f.id,type:f.type,x:f.x+l,y:f.y+c}});d.push({id:r.id,type:r.type,x:r.x-u.x,y:r.y-u.y,props:{w:o,h:a}}),t.updateShapes(d)})}function xr({children:t}){return g.jsx("span",{className:"tlui-button__label",children:t})}const Eu=S.memo(function({label:e,small:n,invertIcon:r,icon:i,color:s,className:o,...a}){return typeof i=="string"?g.jsx(Tht,{label:e,small:n,invertIcon:r,icon:i,color:s,className:o,...a}):S.cloneElement(i,{...a,className:nt({"tlui-icon__small":n},o,i.props.className),"aria-label":e,style:{color:s,transform:r?"scale(-1, 1)":void 0,...i.props.style}})});function Tht({label:t,small:e,invertIcon:n,icon:r,color:i,className:s,...o}){const a=h6(),l=a.icons[r]??a.icons["question-mark-circle"],c=S.useRef(null);return S.useLayoutEffect(()=>{l||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),c!=null&&c.current&&(c.current.style.webkitMask=`url(${l}) center 100% / 100% no-repeat`)},[c,l,r]),r==="none"?g.jsx("div",{className:nt("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},s),...o}):g.jsx("div",{...o,ref:c,"aria-label":t,role:"img",className:nt("tlui-icon",{"tlui-icon__small":e},s),style:{color:i,mask:`url(${l}) center 100% / 100% no-repeat`,transform:n?"scale(-1, 1)":void 0}})}function vt({icon:t,small:e,invertIcon:n}){return g.jsx(Eu,{"aria-hidden":"true",label:"",className:"tlui-button__icon",icon:t,small:e,invertIcon:n})}function MA({className:t,children:e}){return g.jsx("div",{className:nt("tlui-dialog__header",t),children:e})}function OA({className:t,children:e,style:n}){return g.jsx(ilt,{dir:"ltr",className:nt("tlui-dialog__header__title",t),style:n,children:e})}function DA(){const t=et();return g.jsx("div",{className:"tlui-dialog__header__close",children:g.jsx(r0e,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:g.jsx(xt,{type:"icon","aria-label":t("ui.close"),onTouchEnd:e=>e.target.click(),children:g.jsx(vt,{small:!0,icon:"cross-2"})})})})}function Ew({className:t,children:e,style:n}){return g.jsx("div",{className:nt("tlui-dialog__body",t),style:n,tabIndex:0,children:e})}function r9({className:t,children:e}){return g.jsx("div",{className:nt("tlui-dialog__footer",t),children:e})}const qv=S.forwardRef(function({className:e,label:n,icon:r,iconLeft:i,iconLabel:s,autoSelect:o=!1,autoFocus:a=!1,defaultValue:l,placeholder:c,onComplete:u,onValueChange:d,onCancel:h,onFocus:f,onBlur:y,shouldManuallyMaintainScrollPositionWhenFocused:b=!1,children:v,value:x,"data-testid":C,disabled:E},I){const P=as(),_=S.useRef(null);S.useImperativeHandle(I,()=>_.current);const A=et(),D=S.useRef(l??""),L=S.useRef(l??""),z=S.useRef(!1),[$,H]=S.useState(!1),R=S.useCallback(W=>{H(!0);const Z=W.currentTarget;L.current=Z.value,P?P.timers.requestAnimationFrame(()=>{o&&Z.select()}):X3.requestAnimationFrame("anon",()=>{o&&Z.select()}),f==null||f()},[o,P,f]),j=S.useCallback(W=>{const Z=W.currentTarget.value;L.current=Z,d==null||d(Z)},[d]),B=S.useCallback(W=>{switch(W.key){case"Enter":{if(z.current)return;W.currentTarget.blur(),tr(W),u==null||u(W.currentTarget.value);break}case"Escape":{W.currentTarget.value=D.current,h==null||h(W.currentTarget.value),W.currentTarget.blur(),tr(W);break}}},[u,h]),K=S.useCallback(W=>{H(!1);const Z=W.currentTarget.value;y==null||y(Z)},[y]),G=S.useCallback(()=>z.current=!0,[]),V=S.useCallback(()=>z.current=!1,[]);return S.useEffect(()=>{if(!sn.isIos)return;const W=window.visualViewport;if($&&b&&W){const Z=()=>{var U;(U=_.current)==null||U.scrollIntoView({block:"center"})};return W.addEventListener("resize",Z),W.addEventListener("scroll",Z),P?P.timers.requestAnimationFrame(()=>{var U;(U=_.current)==null||U.scrollIntoView({block:"center"})}):X3.requestAnimationFrame("anon",()=>{var U;(U=_.current)==null||U.scrollIntoView({block:"center"})}),()=>{W.removeEventListener("resize",Z),W.removeEventListener("scroll",Z)}}},[$,P,b]),g.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[v,n&&g.jsx("label",{children:A(n)}),i&&g.jsx(Eu,{label:s?A(s):"",icon:i,className:"tlui-icon-left",small:!0}),g.jsx("input",{ref:_,className:nt("tlui-input",e),type:"text",defaultValue:l,onKeyDownCapture:B,onChange:j,onFocus:R,onBlur:K,onCompositionStart:G,onCompositionEnd:V,autoFocus:a,placeholder:c,value:x,"data-testid":C,disabled:E}),r&&g.jsx(Eu,{label:s?A(s):"",icon:r,small:!!n})]})});function lte(t){return $a.isValid(t)?{isValid:!0,hasProtocol:!0}:$a.isValid("https://"+t)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const Iht=Lr(function({onClose:e}){const r=re().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?g.jsx(Pht,{onClose:e,selectedShape:r}):null}),Pht=Lr(function({onClose:e,selectedShape:n}){const r=re(),i=et(),s=S.useRef(null);S.useEffect(()=>{r.timers.requestAnimationFrame(()=>{var y;return(y=s.current)==null?void 0:y.focus()})},[r]);const o=S.useRef(n.props.url),[a,l]=S.useState(()=>{const y=lte(n.props.url),b=y.isValid===!0?y.hasProtocol?n.props.url:"https://"+n.props.url:"https://";return{actual:b,safe:b,valid:!0}}),c=S.useCallback(y=>{const b=y.replace(/https?:\/\/(https?:\/\/)/,(C,E)=>E),v=lte(b),x=v.isValid===!0?v.hasProtocol?b:"https://"+b:"https://";l({actual:b,safe:x,valid:v.isValid})},[]),u=S.useCallback(()=>{const y=r.getOnlySelectedShape();y&&(r.updateShapes([{id:y.id,type:y.type,props:{url:""}}]),e())},[r,e]),d=S.useCallback(()=>{const y=r.getOnlySelectedShape();y&&(y&&"url"in y.props&&y.props.url!==a.safe&&r.updateShapes([{id:y.id,type:y.type,props:{url:a.safe}}]),e())},[r,e,a]),h=S.useCallback(()=>{e()},[e]);if(!n)return e(),null;const f=o.current&&!a.valid;return g.jsxs(g.Fragment,{children:[g.jsxs(MA,{children:[g.jsx(OA,{children:i("edit-link-dialog.title")}),g.jsx(DA,{})]}),g.jsx(Ew,{children:g.jsxs("div",{className:"tlui-edit-link-dialog",children:[g.jsx(qv,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,autoSelect:!0,placeholder:"https://example.com",value:a.actual,onValueChange:c,onComplete:d,onCancel:h}),g.jsx("div",{children:a.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),g.jsxs(r9,{className:"tlui-dialog__footer__actions",children:[g.jsx(xt,{type:"normal",onClick:h,onTouchEnd:h,children:g.jsx(xr,{children:i("edit-link-dialog.cancel")})}),f?g.jsx(xt,{type:"danger",onTouchEnd:u,onClick:u,children:g.jsx(xr,{children:i("edit-link-dialog.clear")})}):g.jsx(xt,{type:"primary",disabled:!a.valid,onTouchEnd:d,onClick:d,children:g.jsx(xr,{children:i("edit-link-dialog.save")})})]})]})});var _ht={};const cte=/(^\/[f|p|r|ro|s|v]\/[^/]+\/?$)/,i9=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(cte))return e.searchParams.append("embed","true"),t},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(cte))return e.searchParams.delete("embed"),t}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{if(t.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto|design)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!t.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${t}`},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/embed\/?$/)){const n=e.searchParams.get("url");if(n)return n}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:t=>{if(t.includes("/maps/embed?"))return t;if(t.includes("/maps/")){const e=t.match(/@(.*?),(.*?),(.*?)(z|m)/);let n;if(e){const[,r,i,s,o]=e,a=o==="z"?"roadmap":"satellite",l=a==="roadmap"?s:-Math.log2(parseInt(s)/14772321)/.8;n=`https://${new URL(t).host.replace("www.","")}/maps/embed/v1/view?key=${_ht.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${l}&maptype=${a}`}else n="";return n}},fromEmbedUrl:t=>{const e=wt(t);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom")??"12",i=e.searchParams.get("maptype")??"roadmap",s=i==="roadmap"?r:14772321*Math.pow(2,parseInt(r)*-.8),[o,a]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${o},${a},${s}${i==="roadmap"?"z":"m"}`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=wt(t),n=e&&e.pathname.match(/\/v\/(.+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:t=>{const e=wt(t),n=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=wt(t),n=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:t=>{const e=wt(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,n=t.match(e);if(n){const[r,i,s]=n;return`https://codepen.io/${i}/embed/${s}`}},fromEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,i,s]=n;return`https://codepen.io/${i}/pen/${s}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:t=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,n=t.match(e);if(n){const[r,i]=n;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:t=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,i]=n;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=wt(t);if(!e)return;const n=e.hostname.replace(/^www./,"");if(n==="youtu.be"){const r=e.pathname.split("/").filter(Boolean)[0],i=new URLSearchParams(e.search),s=i.get("t");s&&(i.set("start",s),i.delete("t"));const o=i.toString()?"?"+i.toString():"";return`https://www.youtube.com/embed/${r}${o}`}else if((n==="youtube.com"||n==="m.youtube.com")&&e.pathname.match(/^\/watch/)){const r=e.searchParams.get("v"),i=new URLSearchParams(e.search);i.delete("v");const s=i.get("t");s&&(i.set("start",s),i.delete("t"));const o=i.toString()?"?"+i.toString():"";return`https://www.youtube.com/embed/${r}${o}`}},fromEmbedUrl:t=>{const e=wt(t);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r){const i=new URLSearchParams(e.search);i.set("v",(r==null?void 0:r[1])??"");const s=i.get("start");return s&&(i.set("t",s),i.delete("start")),`https://www.youtube.com/watch?${i.toString()}`}}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:t=>{const e=wt(t),n=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&n){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("src",n),e.href}},fromEmbedUrl:t=>{const e=wt(t),n=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&n){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",n),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:t=>{const e=wt(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}},fromEmbedUrl:t=>{const e=wt(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return t.split("/").pop()?t:void 0},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return t.split("/").pop()?t:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${t}?embed=true`},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=wt(t);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.hostname==="player.vimeo.com"){const n=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=wt(t);if(e&&e.hash.match(/#room=/))return t},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.hash.match(/#room=/))return t}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const n=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${n}?cell=*`}},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:t=>{const e=wt(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${t}?embed`},fromEmbedUrl:t=>{const e=wt(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return t.replace("?embed","")}}],kht={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},Aht=i9.map(t=>t.type);function Mht(t){return Aht.includes(t)}function Oht(t){return"icon"in t}function Yxe(){const t=as();if(t&&t.hasShapeUtil("embed"))return t.getShapeUtil("embed")}function s9(){const t=Yxe();return e=>t?t.getEmbedDefinition(e):void 0}function Dht(){const t=Yxe();return t?t.getEmbedDefinitions():[]}const Xxe=Lr(function({onClose:e}){const n=re(),r=et(),i=h6(),[s,o]=S.useState(null),[a,l]=S.useState(""),[c,u]=S.useState(null),[d,h]=S.useState(!1),f=S.useRef(-1),y=Dht(),b=s9();return g.jsxs(g.Fragment,{children:[g.jsxs(MA,{children:[g.jsx(OA,{children:s?`${r("embed-dialog.title")} — ${s.title}`:r("embed-dialog.title")}),g.jsx(DA,{})]}),s?g.jsxs(g.Fragment,{children:[g.jsxs(Ew,{className:"tlui-embed-dialog__enter",children:[g.jsx(qv,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:v=>{l(v);const x=b(v);u(x&&x.definition.type===s.type?x:null),h(!1),clearTimeout(f.current),f.current=n.timers.setTimeout(()=>h(!x),320)}}),a===""?g.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[g.jsx("span",{children:r("embed-dialog.instruction")})," ",s.instructionLink&&g.jsxs(g.Fragment,{children:[g.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:"Learn more"}),"."]})]}):g.jsx("div",{className:"tlui-embed-dialog__warning",children:d?r("embed-dialog.invalid-url"):" "})]}),g.jsxs(r9,{className:"tlui-dialog__footer__actions",children:[g.jsx(xt,{type:"normal",onClick:()=>{o(null),u(null),l("")},children:g.jsx(xr,{children:r("embed-dialog.back")})}),g.jsx("div",{className:"tlui-embed__spacer"}),g.jsx(xt,{type:"normal",onClick:e,children:g.jsx(xr,{children:r("embed-dialog.cancel")})}),g.jsx(xt,{type:"primary",disabled:!c,onClick:()=>{c&&(n.putExternalContent({type:"embed",url:a,point:n.getViewportPageBounds().center,embed:c.definition}),e())},children:g.jsx(xr,{children:r("embed-dialog.create")})})]})]}):g.jsx(g.Fragment,{children:g.jsx(Ew,{className:"tlui-embed-dialog__list",children:y.map(v=>{const x=Mht(v.type)?i.embedIcons[v.type]:Oht(v)?v.icon:void 0;return g.jsxs(xt,{type:"menu",onClick:()=>o(v),children:[g.jsx(xr,{children:v.title}),x&&g.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${x})`}})]},v.type)})})})]})}),yL=[0,389,436,476,580,640,840,1023];var wr=(t=>(t[t.ZERO=0]="ZERO",t[t.MOBILE_XXS=1]="MOBILE_XXS",t[t.MOBILE_XS=2]="MOBILE_XS",t[t.MOBILE_SM=3]="MOBILE_SM",t[t.MOBILE=4]="MOBILE",t[t.TABLET_SM=5]="TABLET_SM",t[t.TABLET=6]="TABLET",t[t.DESKTOP=7]="DESKTOP",t))(wr||{});const Jxe=$e.createContext(null);function Rht({forceMobile:t=!1,children:e}){const n=as(),r=ie("breakpoint",()=>{const{width:i}=(n==null?void 0:n.getViewportScreenBounds())??{width:window.innerWidth},s=t?wr.MOBILE_SM:yL.length-1;for(let o=0;o<s;o++)if(i>yL[o]&&i<=yL[o+1])return o;return s},[n]);return g.jsx(Jxe.Provider,{value:r,children:e})}function Ys(){const t=S.useContext(Jxe);if(t===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return t}const Zxe=S.createContext(null);function RA(){const t=S.useContext(Zxe);if(!t)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return t}function So({type:t,sourceId:e,children:n}){return g.jsx(Zxe.Provider,{value:{type:t,sourceId:e},children:n})}function NA(){const t=as();return(t==null?void 0:t.store.props.collaboration)!==void 0}function Nht(){const t=as();return ie("sync status",()=>{var e;return(e=t==null?void 0:t.store.props.collaboration)!=null&&e.status?t.store.props.collaboration.status.get():null},[t])}function Ka(){const t=as();return ie("isReadonlyMode",()=>!!(t!=null&&t.getIsReadonly()),[t])}const vL=sn.isDarwin?"⌘":"__CTRL__",ute=sn.isDarwin?"⌥":"__ALT__";function Qxe(t){return t===","?[","]:t.split(",")[0].split(/(\[\[[^\]]+\]\])/g).map(e=>e.startsWith("[[")?e.replace(/[[\]]/g,""):e.replace(/cmd\+/g,vL).replace(/ctrl\+/g,vL).replace(/alt\+/g,ute).replace(/shift\+/g,"⇧").replace(/\$/g,vL).replace(/\?/g,ute).replace(/!/g,"⇧").match(/__CTRL__|__ALT__|./g)||[]).flat().map((e,n)=>{if(e==="__CTRL__")return"Ctrl";if(e==="__ALT__")return"Alt";const r=e[0].toUpperCase()+e.slice(1);return sn.isDarwin||!n?r:["+",r]}).flat()}function H$(t){return"— "+Qxe(t).join(" ")}function V$(t){const e=et();return g.jsx(Sme,{"aria-label":e("app.loading"),...t})}function Vd(t,e){const n=as(),r=S.useCallback(o=>{o&&(n==null||n.complete()),e==null||e(o)},[n,e]),i=hr(),s=S.useCallback(o=>{i(o,{source:"unknown",id:t})},[t,i]);return ntt(n?`${t}-${n.contextId}`:t,r,s)}function jA({id:t,children:e,modal:n=!1,debugOpen:r=!1}){const[i,s]=Vd(t);return g.jsx(z6,{open:r||i,dir:"ltr",modal:n,onOpenChange:s,children:e})}function LA({children:t,...e}){return g.jsx(U6,{dir:"ltr",asChild:!0,onTouchEnd:n=>St(n),...e,children:t})}function FA({className:t,side:e="bottom",align:n="start",sideOffset:r=8,alignOffset:i=8,children:s}){const o=Fr();return g.jsx(PA,{container:o,children:g.jsx(H6,{className:nt("tlui-menu",t),side:e,sideOffset:r,align:n,alignOffset:i,collisionPadding:4,children:s})})}function jht({id:t,children:e}){const[n,r]=Vd(t);return g.jsx(rdt,{open:n,onOpenChange:r,children:e})}function Lht({id:t,label:e,title:n,disabled:r}){return g.jsx(idt,{dir:"ltr",asChild:!0,disabled:r,children:g.jsxs(xt,{"data-testid":t,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:n,children:[g.jsx(xr,{children:e}),g.jsx(vt,{icon:"chevron-right",small:!0})]})})}function Fht({id:t,alignOffset:e=-1,sideOffset:n=-6,size:r="small",children:i}){const s=Fr();return g.jsx(PA,{container:s,children:g.jsx(sdt,{"data-testid":t,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:n,collisionPadding:4,"data-size":r,children:i})})}function $ht({className:t,children:e}){return g.jsx("div",{dir:"ltr",className:nt("tlui-menu__group",t),children:e})}function Bht({noClose:t,children:e}){return g.jsx(tdt,{dir:"ltr",asChild:!0,onClick:t?St:void 0,children:e})}function zht({children:t,onSelect:e,...n}){const r=et();return g.jsxs(Wbe,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:i=>{e==null||e(i),St(i)},...n,children:[g.jsx("div",{className:"tlui-button__checkbox__indicator",children:g.jsx(ndt,{dir:"ltr",children:g.jsx(Eu,{label:r("ui.checked"),icon:"check",small:!0})})}),t]})}function px({children:t,visibleOnMobileLayout:e=!1}){const n=Ys();return!e&&n<wr.MOBILE?null:g.jsx("kbd",{className:"tlui-kbd",children:Qxe(t).map((r,i)=>g.jsx("span",{children:r},i))})}const Or=$e.forwardRef(({children:t,className:e,label:n,...r},i)=>g.jsx(xht,{ref:i,...r,className:nt("tlui-toolbar-container",e),"aria-label":n,children:t})),Ei=$e.forwardRef(({asChild:t,children:e,type:n,isActive:r,...i},s)=>g.jsx(wht,{ref:s,asChild:t,draggable:!1,"data-isactive":r,...i,className:nt("tlui-button",`tlui-button__${n}`,i.className),children:e})),Uht=({children:t,className:e,type:n,...r})=>g.jsx(Sht,{type:n,...r,role:"radiogroup",className:nt("tlui-toolbar-toggle-group",e),children:t}),Hht=({children:t,className:e,type:n,value:r,...i})=>g.jsx(Cht,{...i,className:nt("tlui-button",`tlui-button__${n}`,"tlui-toolbar-toggle-group-item",e),value:r,children:t});function Jt({disabled:t=!1,spinner:e=!1,readonlyOk:n=!1,id:r,kbd:i,label:s,icon:o,iconLeft:a,onSelect:l,noClose:c,isSelected:u}){const{type:d,sourceId:h}=RA(),f=et(),[y,b]=S.useState(!1);if(Ka()&&!n)return null;const x=Tw(s,d),C=i?H$(i):void 0,E=x?f(x):void 0,I=E&&C?`${E} ${C}`:E;switch(d){case"menu":return g.jsx(Bht,{children:g.jsxs(xt,{type:"menu","data-testid":`${h}.${r}`,disabled:t,title:I,onClick:P=>{c&&St(P),y?b(!1):l(h)},children:[a&&g.jsx(vt,{icon:a,small:!0}),g.jsx(xr,{children:E}),i&&g.jsx(px,{children:i})]})});case"context-menu":return t?null:g.jsxs(Out,{dir:"ltr",title:I,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${h}.${r}`,onSelect:P=>{c&&St(P),y?b(!1):l(h)},children:[g.jsx("span",{className:"tlui-button__label",draggable:!1,children:E}),a&&g.jsx(vt,{icon:a,small:!0}),i&&g.jsx(px,{children:i}),e&&g.jsx(V$,{})]});case"panel":return g.jsxs(xt,{"data-testid":`${h}.${r}`,type:"menu",title:I,disabled:t,onClick:()=>l(h),children:[g.jsx(xr,{children:E}),e?g.jsx(V$,{}):o&&g.jsx(vt,{icon:o})]});case"small-icons":case"icons":return g.jsx(Ei,{"data-testid":`${h}.${r}`,type:"icon",title:I,disabled:t,onClick:()=>l(h),children:g.jsx(vt,{icon:o,small:!0})});case"keyboard-shortcuts":return i?g.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${h}.${r}`,children:[g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:E}),g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:g.jsx(px,{visibleOnMobileLayout:!0,children:i})})]}):(console.warn(`Menu item '${s}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return g.jsxs(xt,{type:"low",onClick:()=>l(h),children:[g.jsx(vt,{icon:o}),g.jsx(xr,{children:E})]});case"toolbar":return g.jsx(Ei,{"aria-label":E,"aria-pressed":u?"true":"false","data-testid":`tools.${r}`,"data-value":r,disabled:t,onClick:()=>l("toolbar"),onTouchStart:P=>{St(P),l("toolbar")},title:I,type:"tool",children:g.jsx(vt,{icon:o})});case"toolbar-overflow":return g.jsx(Ei,{"aria-label":E,"aria-pressed":u?"true":"false",isActive:u,className:"tlui-button-grid__button","data-testid":`tools.more.${r}`,"data-value":r,disabled:t,onClick:()=>l("toolbar"),title:I,type:"icon",children:g.jsx(vt,{icon:o})});default:throw Yt(d)}}function ye({actionId:t="",...e}){const r=Kd()[t];return r?g.jsx(Jt,{...r,...e}):null}function Nt({id:t,label:e,className:n,children:r}){const{type:i,sourceId:s}=RA(),o=et(),a=Tw(e,i),l=a?o(a):void 0;switch(i){case"panel":return g.jsx("div",{className:nt("tlui-menu__group",n),"data-testid":`${s}-group.${t}`,children:r});case"menu":return g.jsx($ht,{className:n,"data-testid":`${s}-group.${t}`,children:r});case"context-menu":return g.jsx("div",{dir:"ltr",className:nt("tlui-menu__group",n),"data-testid":`${s}-group.${t}`,children:r});case"keyboard-shortcuts":return g.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${s}-group.${t}`,children:[g.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:l}),g.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:r})]});default:return r}}const W$=S.createContext(null);function Vht({context:t,children:e}){const n=S.useContext(W$),r=hr(),i=ES("dialogs",[]),s=S.useMemo(()=>({dialogs:i,addDialog(o){const a=o.id??fn();return i.update(l=>[...l.filter(c=>c.id!==o.id),{...o,id:a}]),r("open-menu",{source:"dialog",id:a}),oo.addOpenMenu(a,t),a},removeDialog(o){var l;const a=i.get().find(c=>c.id===o);return a&&((l=a.onClose)==null||l.call(a),r("close-menu",{source:"dialog",id:o}),oo.deleteOpenMenu(o,t),i.update(c=>c.filter(u=>u!==a))),o},clearDialogs(){const o=i.get();o.length!==0&&(o.forEach(a=>{var l;(l=a.onClose)==null||l.call(a),r("close-menu",{source:"dialog",id:a.id}),oo.deleteOpenMenu(a.id,t)}),i.set([]))}}),[r,i,t]);return n?g.jsx(g.Fragment,{children:e}):g.jsx(W$.Provider,{value:s,children:e})}function ZS(){const t=S.useContext(W$);if(!t)throw new Error("useDialogs must be used within a DialogsProvider");return t}const K$=S.createContext(null);function Wht({children:t}){const e=ES("toasts",[]),n=S.useContext(K$),r=S.useMemo(()=>({toasts:e,addToast(i){const s=i.id??fn();return e.update(o=>[...o.filter(a=>a.id!==i.id),{...i,id:s}]),s},removeToast(i){return e.update(s=>s.filter(o=>o.id!==i)),i},clearToasts(){e.set([])}}),[e]);return n?g.jsx(g.Fragment,{children:t}):g.jsx(nht,{children:g.jsx(K$.Provider,{value:r,children:t})})}function Wd(){const t=S.useContext(K$);if(!t)throw new Error("useToasts must be used within a ToastsProvider");return t}function dte(t){return new Promise(e=>{const{allowMultiple:n=!0,mimeTypes:r=[]}=t||{},i=document.createElement("input");i.type="file",i.accept=r==null?void 0:r.join(","),i.multiple=n;async function s(o){const a=o.target.files;if(!a||a.length===0)return;const l=Array.from(a);i.value="",e(l),i.removeEventListener("change",s),i.remove()}i.addEventListener("change",s),i==null||i.click()})}var bL={exports:{}},hte;function Kht(){return hte||(hte=1,function(t){var e=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(l,c){if(!s[l]){s[l]={};for(var u=0;u<l.length;u++)s[l][l.charAt(u)]=u}return s[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(u){return r.charAt(u)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return o(r,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return n(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),u=new Uint8Array(c.length*2),d=0,h=c.length;d<h;d++){var f=c.charCodeAt(d);u[d*2]=f>>>8,u[d*2+1]=f%256}return u},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),u=0,d=c.length;u<d;u++)c[u]=l[u*2]*256+l[u*2+1];var h=[];return c.forEach(function(f){h.push(n(f))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return o(i,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return n(c)})},_compress:function(l,c,u){if(l==null)return"";var d,h,f={},y={},b="",v="",x="",C=2,E=3,I=2,P=[],_=0,A=0,D;for(D=0;D<l.length;D+=1)if(b=l.charAt(D),Object.prototype.hasOwnProperty.call(f,b)||(f[b]=E++,y[b]=!0),v=x+b,Object.prototype.hasOwnProperty.call(f,v))x=v;else{if(Object.prototype.hasOwnProperty.call(y,x)){if(x.charCodeAt(0)<256){for(d=0;d<I;d++)_=_<<1,A==c-1?(A=0,P.push(u(_)),_=0):A++;for(h=x.charCodeAt(0),d=0;d<8;d++)_=_<<1|h&1,A==c-1?(A=0,P.push(u(_)),_=0):A++,h=h>>1}else{for(h=1,d=0;d<I;d++)_=_<<1|h,A==c-1?(A=0,P.push(u(_)),_=0):A++,h=0;for(h=x.charCodeAt(0),d=0;d<16;d++)_=_<<1|h&1,A==c-1?(A=0,P.push(u(_)),_=0):A++,h=h>>1}C--,C==0&&(C=Math.pow(2,I),I++),delete y[x]}else for(h=f[x],d=0;d<I;d++)_=_<<1|h&1,A==c-1?(A=0,P.push(u(_)),_=0):A++,h=h>>1;C--,C==0&&(C=Math.pow(2,I),I++),f[v]=E++,x=String(b)}if(x!==""){if(Object.prototype.hasOwnProperty.call(y,x)){if(x.charCodeAt(0)<256){for(d=0;d<I;d++)_=_<<1,A==c-1?(A=0,P.push(u(_)),_=0):A++;for(h=x.charCodeAt(0),d=0;d<8;d++)_=_<<1|h&1,A==c-1?(A=0,P.push(u(_)),_=0):A++,h=h>>1}else{for(h=1,d=0;d<I;d++)_=_<<1|h,A==c-1?(A=0,P.push(u(_)),_=0):A++,h=0;for(h=x.charCodeAt(0),d=0;d<16;d++)_=_<<1|h&1,A==c-1?(A=0,P.push(u(_)),_=0):A++,h=h>>1}C--,C==0&&(C=Math.pow(2,I),I++),delete y[x]}else for(h=f[x],d=0;d<I;d++)_=_<<1|h&1,A==c-1?(A=0,P.push(u(_)),_=0):A++,h=h>>1;C--,C==0&&(C=Math.pow(2,I),I++)}for(h=2,d=0;d<I;d++)_=_<<1|h&1,A==c-1?(A=0,P.push(u(_)),_=0):A++,h=h>>1;for(;;)if(_=_<<1,A==c-1){P.push(u(_));break}else A++;return P.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,u){var d=[],h=4,f=4,y=3,b="",v=[],x,C,E,I,P,_,A,D={val:u(0),position:c,index:1};for(x=0;x<3;x+=1)d[x]=x;for(E=0,P=Math.pow(2,2),_=1;_!=P;)I=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=u(D.index++)),E|=(I>0?1:0)*_,_<<=1;switch(E){case 0:for(E=0,P=Math.pow(2,8),_=1;_!=P;)I=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=u(D.index++)),E|=(I>0?1:0)*_,_<<=1;A=n(E);break;case 1:for(E=0,P=Math.pow(2,16),_=1;_!=P;)I=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=u(D.index++)),E|=(I>0?1:0)*_,_<<=1;A=n(E);break;case 2:return""}for(d[3]=A,C=A,v.push(A);;){if(D.index>l)return"";for(E=0,P=Math.pow(2,y),_=1;_!=P;)I=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=u(D.index++)),E|=(I>0?1:0)*_,_<<=1;switch(A=E){case 0:for(E=0,P=Math.pow(2,8),_=1;_!=P;)I=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=u(D.index++)),E|=(I>0?1:0)*_,_<<=1;d[f++]=n(E),A=f-1,h--;break;case 1:for(E=0,P=Math.pow(2,16),_=1;_!=P;)I=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=u(D.index++)),E|=(I>0?1:0)*_,_<<=1;d[f++]=n(E),A=f-1,h--;break;case 2:return v.join("")}if(h==0&&(h=Math.pow(2,y),y++),d[A])b=d[A];else if(A===f)b=C+C.charAt(0);else return null;v.push(b),d[f++]=C+b.charAt(0),h--,C=b,h==0&&(h=Math.pow(2,y),y++)}}};return a}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(bL)),bL.exports}var qht=Kht();const q$=Oi(qht),o9="web image/vnd.tldraw+png",Ght={png:o9},Yht={[o9]:"image/png"};function Xht(t){return Ar(Ght,t)??null}function Jht(t){return Ar(Yht,t)??t}function Zht(t){return typeof ClipboardItem<"u"&&"supports"in ClipboardItem&&ClipboardItem.supports(t)}function Qht(t){const e=Object.entries(t);for(const[n,r]of e)r.catch(i=>console.error(i));return navigator.clipboard.write([new ClipboardItem(t)]).catch(n=>(console.error(n),Promise.all(e.map(async([r,i])=>[r,await i])).then(r=>{const i=jue(r);return navigator.clipboard.write([new ClipboardItem(i)])})))}async function eft(t,e,n,r){const i=e.map(s=>s instanceof File?s:new File([s],"tldrawFile",{type:s.type}));t.markHistoryStoppingPoint("paste"),await t.putExternalContent({type:"files",files:i,point:n,sources:r})}async function G$(t,e,n,r){return t.markHistoryStoppingPoint("paste"),await t.putExternalContent({type:"url",point:n,url:e,sources:r})}const tft=[o9,"image/png","image/jpeg","image/webp","image/svg+xml"];function xL(t){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=t.trim(),e.body.textContent||e.body.innerText||""}const nft=t=>{try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},rft=t=>{const e=t.split(/[\n\s]/);for(const n of e)try{const r=new URL(n);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return jme(e)},ift=t=>/^<svg/.test(t),sft=["input","select","textarea"];function wL(t){const{activeElement:e}=document;return t.menus.hasAnyOpenMenus()||e&&(e.isContentEditable||sft.indexOf(e.tagName.toLowerCase())>-1)}const sE=(t,e,n,r)=>{const i=rft(e);if(i)for(const s of i)G$(t,s,n);else nft(e)?G$(t,e,n):ift(e)?(t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"svg-text",text:e,point:n,sources:r})):(t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"text",text:e,point:n,sources:r}))},oft=async(t,e,n)=>{if(t.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{r.push({type:"file",source:new Promise(s=>s(i.getAsFile()))});break}case"string":{i.type==="text/html"?r.push({type:"html",source:new Promise(s=>i.getAsString(s))}):i.type==="text/plain"?r.push({type:"text",source:new Promise(s=>i.getAsString(s))}):r.push({type:i.type,source:new Promise(s=>i.getAsString(s))});break}}twe(t,r,n)},ewe=async({editor:t,clipboardItems:e,point:n,fallbackFiles:r})=>{const i=[];for(const s of e){for(const o of tft)if(s.types.includes(o)){const a=s.getType(o).then(l=>co.rewriteMimeType(l,Jht(o)));i.push({type:"blob",source:a});break}s.types.includes("text/html")&&i.push({type:"html",source:(async()=>{const o=await s.getType("text/html");return await co.blobToText(o)})()}),s.types.includes("text/uri-list")&&i.push({type:"url",source:(async()=>{const o=await s.getType("text/uri-list");return await co.blobToText(o)})()}),s.types.includes("text/plain")&&i.push({type:"text",source:(async()=>{const o=await s.getType("text/plain");return await co.blobToText(o)})()})}return r!=null&&r.length&&i.length===1&&i[0].type==="text"?(i.pop(),i.push(...r.map(s=>({type:"file",source:Promise.resolve(s)})))):r!=null&&r.length&&i.length===0&&i.push(...r.map(s=>({type:"file",source:Promise.resolve(s)}))),await twe(t,i,n)};async function twe(t,e,n){const r=e.filter(s=>(s.type==="file"||s.type==="blob")&&s.source!==null);if(r.length){if(r.length>t.options.maxFilesAtOnce)throw Error("Too many files");const s=bt(await Promise.all(r.map(o=>o.source)));return await eft(t,s,n)}const i=await Promise.all(e.filter(s=>s.type!=="file").map(s=>new Promise(o=>{const a=s;if(a.type==="file"){o({type:"error",data:null,reason:"unexpected file"});return}a.source.then(l=>{var u;const c=(u=l.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:u[1];if(c)try{let d;try{d=JSON.parse(c)}catch{const h=q$.decompressFromBase64(c);if(h===null){o({type:"error",data:null,reason:"found tldraw data comment but could not parse"});return}d=JSON.parse(h)}if(d.type!=="application/tldraw"){o({type:"error",data:d,reason:`found tldraw data comment but JSON was of a different type: ${d.type}`});return}if(d.version===3)try{const h=JSON.parse(q$.decompressFromBase64(d.data.otherCompressed)||"{}"),f={assets:d.data.assets||[],...h};o({type:"tldraw",data:f});return}catch(h){o({type:"error",data:d,reason:`failed to decompress version 2 clipboard data: ${h}`});return}if(d.version===2)o({type:"tldraw",data:d.data});else{if(typeof d.data=="string"){o({type:"error",data:d,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}o({type:"tldraw",data:d.data});return}}catch{o({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){o({type:"text",data:l,subtype:"html"});return}if(a.type==="url"){o({type:"text",data:l,subtype:"url"});return}try{const d=JSON.parse(l);if(d.type==="excalidraw/clipboard"){o({type:"excalidraw",data:d});return}else{o({type:"text",data:l,subtype:"json"});return}}catch{o({type:"text",data:l,subtype:"text"});return}}o({type:"error",data:l,reason:"unhandled case"})})})));for(const s of i)if(s.type==="tldraw"){t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"tldraw",content:s.data,point:n});return}for(const s of i)if(s.type==="excalidraw"){t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"excalidraw",content:s.data,point:n});return}for(const s of i){if(s.type==="text"&&s.subtype==="html"){const a=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(c=>c.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const c=a.firstElementChild.getAttribute("href");sE(t,c,n,i);return}if(!i.some(c=>c.type==="text"&&c.subtype!=="html")&&s.data.trim()&&(xL(s.data)??"")){sE(t,xL(s.data),n,i);return}if(i.some(c=>c.type==="text"&&c.subtype!=="html")){const c=xL(s.data)??"";if(c){t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"text",text:c,html:s.data,point:n,sources:i});return}}}if(s.type==="text"&&s.subtype==="text"&&s.data.startsWith("<iframe ")){const a=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(c=>c.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="IFRAME"&&a.firstElementChild.hasAttribute("src")&&a.firstElementChild.getAttribute("src")!==""){const c=a.firstElementChild.getAttribute("src");sE(t,c,n,i);return}}}for(const s of i)if(s.type==="text"&&s.subtype==="url"){G$(t,s.data,n,i);return}for(const s of i)if(s.type==="text"&&s.subtype==="text"&&s.data.trim()){sE(t,s.data,n,i);return}}const SP=async t=>{var o;const e=await t.resolveAssetsInContent(t.getContentFromCurrentPage(t.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const{assets:n,...r}=e,i={type:"application/tldraw",kind:"content",version:3,data:{assets:n||[],otherCompressed:q$.compressToBase64(JSON.stringify(r))}},s=JSON.stringify(i);if(!(typeof navigator>"u")){const a=e.shapes.map(l=>t.getShapeUtil(l).getText(l)).filter(TWe);if((o=navigator.clipboard)!=null&&o.write){const l=new Blob([`<div data-tldraw>${s}</div>`],{type:"text/html"});let c=a.join(" ");c===""&&(c=" "),navigator.clipboard.write([new ClipboardItem({"text/html":l,"text/plain":new Blob([c],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${s}</div>`)}};function aft(){const t=as(),e=hr(),n=S.useCallback(async function(o){it(t,"editor is required for copy"),t.getSelectedShapeIds().length!==0&&(await SP(t),e("copy",{source:o}))},[t,e]),r=S.useCallback(async function(o){t&&t.getSelectedShapeIds().length!==0&&(await SP(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:o}))},[t,e]),i=S.useCallback(async function(o,a,l){t&&t.getEditingShapeId()===null&&(Array.isArray(o)&&o[0]instanceof ClipboardItem?(ewe({editor:t,clipboardItems:o,point:l}),e("paste",{source:"menu"})):navigator.clipboard.read().then(c=>{i(c,a,l)}))},[t,e]);return{copy:n,cut:r,paste:i}}function lft(){const t=re(),e=hr(),n=ie("editor.isFocused",()=>t.getInstanceState().isFocused,[t]);S.useEffect(()=>{if(!n)return;const r=async l=>{t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||wL(t)||(St(l),await SP(t),e("copy",{source:"kbd"}))};async function i(l){t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||wL(t)||(St(l),await SP(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let s=!1;const o=l=>{l.button===1&&(s=!0,t.timers.requestAnimationFrame(()=>{s=!1}))},a=l=>{var h,f;if(s){tr(l);return}if(t.getEditingShapeId()!==null||wL(t))return;let c,u=!1;t.inputs.shiftKey&&(u=!0),t.user.getIsPasteAtCursorMode()&&(u=!u),u&&(c=t.inputs.currentPagePoint);const d=()=>{l.clipboardData&&oft(t,l.clipboardData,c)};if((h=navigator.clipboard)!=null&&h.read){const y=Array.from(((f=l.clipboardData)==null?void 0:f.files)||[]);navigator.clipboard.read().then(b=>{Array.isArray(b)&&b[0]instanceof ClipboardItem&&ewe({editor:t,clipboardItems:b,point:c,fallbackFiles:y})},()=>{d()})}else d();St(l),e("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",o),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",o)}},[t,e,n])}const fte={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",svg:"text/plain"};function cft(t,e,n={}){const r=e!=null&&e.length?e:[...t.getCurrentPageShapeIds()],i=n.format??"png";return{blobPromise:t.toImage(r,n).then(s=>co.rewriteMimeType(s.blob,fte[i])),mimeType:fte[i]}}function uft(...t){const[e,n,r]=typeof t[2]=="string"?[t[0],t[1],{...t[3],format:t[2]}]:t;if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise:i,mimeType:s}=cft(e,n,r),o={[s]:i},a=Xht(r.format);return a&&Zht(a)&&(o[a]=i.then(l=>co.rewriteMimeType(l,a))),Qht(o)}switch(r.format){case"svg":return dft(async()=>{const i=await e.getSvgString(n,r);if(!i)throw new Error("Failed to copy");return i.svg});case"png":throw new Error("Copy not supported");default:Yt(r.format)}}async function dft(t){var e,n;await((n=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:n.call(e,await t()))}function hft(){const t=as(),{addToast:e}=Wd(),n=et();return S.useCallback((r,i="svg")=>{it(t,"useCopyAs: editor is required"),uft(t,r,{format:i}).catch(()=>{e({id:"copy-fail",severity:"warning",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[t,e,n])}async function fft(...t){const[e,n,r]=typeof t[2]=="object"?t:[t[0],t[1],{...t[4],format:t[2]??"png",name:t[3]}];let i=r.name;if(!i&&(i=`shapes at ${pte()}`,n.length===1)){const a=e.getShape(n[0]);e.isShapeOfType(a,"frame")?i=a.props.name||"frame":i=`${Ok(a.id)} at ${pte()}`}i+=`.${r.format}`;const{blob:s}=await e.toImage(n,r),o=new File([s],i,{type:s.type});pft(o)}function pte(){const t=new Date,e=String(t.getFullYear()).slice(2),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),o=String(t.getSeconds()).padStart(2,"0");return`${e}-${n}-${r} ${i}.${s}.${o}`}function pft(t){const e=document.createElement("a"),n=URL.createObjectURL(t);e.href=n,e.download=t.name,e.click(),URL.revokeObjectURL(n)}function gft(){const t=as(),{addToast:e}=Wd(),n=et();return S.useCallback((r,i="png",s)=>{it(t,"useExportAs: editor is required"),fft(t,r,{format:i,name:s,scale:1}).catch(o=>{console.error(o.message),e({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc"),severity:"error"})})},[t,e,n])}function mft(){const t=as(),e=S.useRef(null),n=S.useRef(null);return S.useCallback(async function(){it(t,"usePrint: editor is required");const i=document.createElement("div"),s=document.createElement("style"),o=(x,C)=>{x&&(x.innerHTML=""),C&&document.head.contains(C)&&document.head.removeChild(C),x&&document.body.contains(x)&&document.body.removeChild(x)};o(e.current,n.current),e.current=i,n.current=s;const a=`tl-print-surface-${fn()}`;i.className=a,s.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const l=()=>{document.head.appendChild(s),document.body.appendChild(i)},c=()=>{t.once("tick",()=>{o(i,s)})};window.addEventListener("beforeprint",l),window.addEventListener("afterprint",c);function u(x,C,E){try{i.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${x.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${E}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${C?"":"hide"}">
          ${C??""}
        </div>
      </div>`}catch(I){console.error(I)}}function d(){sn.isChromeForIos?(l(),window.print()):sn.isSafari?(l(),document.execCommand("print",!1)):window.print()}const h=t.getSelectedShapeIds(),f=t.getCurrentPageId(),y=t.getPages(),v={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(t.getSelectedShapeIds().length>0){const x=await t.getSvgString(h,v);if(x){const C=y.find(E=>E.id===f);u(`tldraw — ${C==null?void 0:C.name}`,null,x.svg),d()}}else{const x=t.getCurrentPage(),C=await t.getSvgString(t.getSortedChildIdsForParent(x.id),v);C&&(u(`tldraw — ${x.name}`,null,C.svg),d())}window.removeEventListener("beforeprint",l),window.removeEventListener("afterprint",c)},[t])}const nwe=S.createContext([]);function a9(){const t=as(),{addToast:e,removeToast:n,clearToasts:r}=Wd(),{addDialog:i,clearDialogs:s,removeDialog:o}=ZS(),a=et(),l=mft(),{cut:c,copy:u,paste:d}=aft(),h=hft(),f=gft(),y=s9(),v=Ys()<wr.TABLET_SM,x=Bh(S.useContext(nwe)),C=S.useCallback(async()=>{if(!t)return;const _=await dte({allowMultiple:!0,mimeTypes:x});_.length&&(t.markHistoryStoppingPoint("insert media"),t.putExternalContent({type:"files",files:_,point:t.getViewportPageBounds().center}))},[t,x]),E=S.useCallback(async _=>{if(!t)return;const A=await dte({allowMultiple:!1,mimeTypes:x==null?void 0:x.filter(z=>_?z.startsWith("image/"):z.startsWith("video/"))});if(!A.length)return;const D=t.getOnlySelectedShape();if(!D||_&&D.type!=="image"||!_&&D.type!=="video")return;t.markHistoryStoppingPoint("replace media");const L=A[0];t.replaceExternalContent({type:"file-replace",file:L,shapeId:D.id,isImage:_})},[t,x]),I=S.useCallback(()=>E(!0),[E]),P=S.useCallback(()=>E(!1),[E]);return S.useMemo(()=>({addToast:e,removeToast:n,clearToasts:r,addDialog:i,removeDialog:o,clearDialogs:s,msg:a,isMobile:v,insertMedia:C,replaceImage:I,replaceVideo:P,printSelectionOrPages:l,cut:c,copy:u,paste:d,copyAs:h,exportAs:f,getEmbedDefinition:y}),[e,n,r,i,o,s,a,v,C,I,P,l,c,u,d,h,f,y])}function yft(t,e){const n={};for(const r of t)if(r.translations)for(const[i,s]of ho(r.translations)){let o=n[i];o||(o=n[i]={}),Object.assign(o,s)}return{actions:(r,i,s)=>{for(const o of t)o.actions&&(i=o.actions(r,i,s));return i},tools:(r,i,s)=>{for(const o of t)o.tools&&(i=o.tools(r,i,{...e,...s}));return i},translations:n}}function rwe(t){return S.useMemo(()=>t,t)}function iwe(t){const e=rwe(t==null?[]:Array.isArray(t)?t:[t]);return S.useMemo(()=>{const n={};for(const r of e)if(r.translations)for(const[i,s]of ho(r.translations)){let o=n[i];o||(o=n[i]={}),Object.assign(o,s)}return n},[e])}function vft(t){const e=a9(),n=rwe(t==null?[]:Array.isArray(t)?t:[t]);return S.useMemo(()=>yft(n,e),[n,e])}const swe=S.createContext(null);function bft({overrides:t,children:e}){const n=as(),r=hr(),i=dA(),s=et(),o=a9(),a=S.useCallback((c,u,d)=>{i.announce({msg:s(u.label)}),r("select-tool",{source:c,id:d??u.id})},[i,s,r]),l=S.useMemo(()=>{if(!n)return{};const c=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(d){if(n.isIn("select")){const h=n.root.getCurrent();h.exit({},h.id),h.enter({},h.id)}n.setCurrentTool("select"),a(d,this)}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(d){n.setCurrentTool("hand"),a(d,this)}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(d){n.setCurrentTool("eraser"),a(d,this)}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(d){n.setCurrentTool("draw"),a(d,this)}},...[...uc.values].map(d=>({id:d,label:`tool.${d}`,meta:{geo:d},kbd:d==="rectangle"?"r":d==="ellipse"?"o":void 0,icon:"geo-"+d,onSelect(h){n.run(()=>{n.setStyleForNextShapes(uc,d),n.setCurrentTool("geo"),a(h,this,`geo-${d}`)})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(d){n.setCurrentTool("arrow"),a(d,this)}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(d){n.setCurrentTool("line"),a(d,this)}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(d){n.setCurrentTool("frame"),a(d,this)}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(d){n.setCurrentTool("text"),a(d,this)}},{id:"asset",label:"tool.media",icon:"tool-media",kbd:"cmd+u,ctrl+u",onSelect(d){o.insertMedia(),a(d,this,"media")}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(d){n.setCurrentTool("note"),a(d,this)}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(d){n.setCurrentTool("laser"),a(d,this)}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(d){o.addDialog({component:Xxe}),a(d,this)}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"shift+d",onSelect(d){n.setCurrentTool("highlight"),a(d,this)}}];c.forEach(d=>d.onSelect=d.onSelect.bind(d));const u=Object.fromEntries(c.map(d=>[d.id,d]));return t?t(n,u,o):u},[t,n,o,a]);return g.jsx(swe.Provider,{value:l,children:e})}function l9(){const t=S.useContext(swe);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function $o({toolId:t="",...e}){const r=l9()[t];return r?g.jsx(Jt,{...r,...e}):null}function xft(){const t=NA();return g.jsxs(g.Fragment,{children:[g.jsxs(Nt,{label:"shortcuts-dialog.tools",id:"tools",children:[g.jsx(ye,{actionId:"toggle-tool-lock"}),g.jsx(ye,{actionId:"insert-media"}),g.jsx($o,{toolId:"select"}),g.jsx($o,{toolId:"draw"}),g.jsx($o,{toolId:"eraser"}),g.jsx($o,{toolId:"hand"}),g.jsx($o,{toolId:"rectangle"}),g.jsx($o,{toolId:"ellipse"}),g.jsx($o,{toolId:"arrow"}),g.jsx($o,{toolId:"line"}),g.jsx($o,{toolId:"text"}),g.jsx($o,{toolId:"frame"}),g.jsx($o,{toolId:"note"}),g.jsx($o,{toolId:"laser"}),g.jsx(Jt,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),g.jsxs(Nt,{label:"shortcuts-dialog.preferences",id:"preferences",children:[g.jsx(ye,{actionId:"toggle-dark-mode"}),g.jsx(ye,{actionId:"toggle-focus-mode"}),g.jsx(ye,{actionId:"toggle-grid"})]}),g.jsxs(Nt,{label:"shortcuts-dialog.edit",id:"edit",children:[g.jsx(ye,{actionId:"undo"}),g.jsx(ye,{actionId:"redo"}),g.jsx(ye,{actionId:"cut"}),g.jsx(ye,{actionId:"copy"}),g.jsx(ye,{actionId:"paste"}),g.jsx(ye,{actionId:"select-all"}),g.jsx(ye,{actionId:"delete"}),g.jsx(ye,{actionId:"duplicate"})]}),g.jsxs(Nt,{label:"shortcuts-dialog.view",id:"view",children:[g.jsx(ye,{actionId:"zoom-in"}),g.jsx(ye,{actionId:"zoom-out"}),g.jsx(ye,{actionId:"zoom-to-100"}),g.jsx(ye,{actionId:"zoom-to-fit"}),g.jsx(ye,{actionId:"zoom-to-selection"})]}),g.jsxs(Nt,{label:"shortcuts-dialog.transform",id:"transform",children:[g.jsx(ye,{actionId:"bring-to-front"}),g.jsx(ye,{actionId:"bring-forward"}),g.jsx(ye,{actionId:"send-backward"}),g.jsx(ye,{actionId:"send-to-back"}),g.jsx(ye,{actionId:"group"}),g.jsx(ye,{actionId:"ungroup"}),g.jsx(ye,{actionId:"flip-horizontal"}),g.jsx(ye,{actionId:"flip-vertical"}),g.jsx(ye,{actionId:"align-top"}),g.jsx(ye,{actionId:"align-center-vertical"}),g.jsx(ye,{actionId:"align-bottom"}),g.jsx(ye,{actionId:"align-left"}),g.jsx(ye,{actionId:"align-center-horizontal"}),g.jsx(ye,{actionId:"align-right"})]}),g.jsxs(Nt,{label:"shortcuts-dialog.text-formatting",id:"text",children:[g.jsx(Jt,{id:"text-bold",label:"tool.rich-text-bold",kbd:"cmd+b",onSelect:()=>{}}),g.jsx(Jt,{id:"text-italic",label:"tool.rich-text-italic",kbd:"cmd+i",onSelect:()=>{}}),g.jsx(Jt,{id:"text-code",label:"tool.rich-text-code",kbd:"cmd+e",onSelect:()=>{}}),g.jsx(Jt,{id:"text-highlight",label:"tool.rich-text-highlight",kbd:"cmd+shift+h",onSelect:()=>{}}),g.jsx(Jt,{id:"text-strikethrough",label:"tool.rich-text-strikethrough",kbd:"cmd+shift+s",onSelect:()=>{}}),g.jsx(Jt,{id:"text-link",label:"tool.rich-text-link",kbd:"cmd+shift+k",onSelect:()=>{}}),g.jsx(Jt,{id:"text-header",label:"tool.rich-text-header",kbd:"cmd+shift+[[1-6]]",onSelect:()=>{}}),g.jsx(Jt,{id:"text-orderedList",label:"tool.rich-text-orderedList",kbd:"cmd+shift+7",onSelect:()=>{}}),g.jsx(Jt,{id:"text-bulletedlist",label:"tool.rich-text-bulletList",kbd:"cmd+shift+8",onSelect:()=>{}})]}),g.jsxs(Nt,{label:"shortcuts-dialog.a11y",id:"a11y",children:[g.jsx(Jt,{id:"a11y-select-next-shape",label:"a11y.select-shape",kbd:"[[Tab]]",onSelect:()=>{}}),g.jsx(Jt,{id:"a11y-select-next-shape-direction",label:"a11y.select-shape-direction",kbd:"cmd+↑→↓←",onSelect:()=>{}}),g.jsx(Jt,{id:"a11y-select-next-shape-container",label:"a11y.enter-leave-container",kbd:"cmd+shift+↑→",onSelect:()=>{}}),g.jsx(Jt,{id:"a11y-pan-camera",label:"a11y.pan-camera",kbd:"[[Space]]+↑→↓←",onSelect:()=>{}}),g.jsx(Jt,{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+[[Enter]]",onSelect:()=>{}}),g.jsx(Jt,{id:"open-context-menu",label:"a11y.open-context-menu",kbd:"cmd+shift+[[Enter]]",onSelect:()=>{}}),g.jsx(Jt,{id:"a11y-move-shape",label:"a11y.move-shape",kbd:"↑→↓←",onSelect:()=>{}}),g.jsx(Jt,{id:"a11y-move-shape-faster",label:"a11y.move-shape-faster",kbd:"shift+↑→↓←",onSelect:()=>{}}),g.jsx(ye,{actionId:"enlarge-shapes"}),g.jsx(ye,{actionId:"shrink-shapes"}),g.jsx(ye,{actionId:"a11y-repeat-shape-announce"}),g.jsx(Jt,{id:"a11y-open-keyboard-shortcuts",label:"a11y.open-keyboard-shortcuts",kbd:"cmd+alt+/",onSelect:()=>{}})]}),t&&g.jsx(Nt,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:g.jsx(ye,{actionId:"open-cursor-chat"})})]})}const owe=S.memo(function({children:e}){const n=et(),r=Ys(),i=e??g.jsx(xft,{});return g.jsxs(g.Fragment,{children:[g.jsxs(MA,{className:"tlui-shortcuts-dialog__header",children:[g.jsx(OA,{children:n("shortcuts-dialog.title")}),g.jsx(DA,{})]}),g.jsx(Ew,{className:nt("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":r<=wr.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":r<=wr.TABLET}),children:g.jsx(So,{type:"keyboard-shortcuts",sourceId:"kbd",children:i})}),g.jsx("div",{className:"tlui-dialog__scrim"})]})});async function wft(t,e,n){const r=bt(e.map(a=>{const l=t.getShape(a);if(!(!l||t.getShapeUtil(l.type).toSvg===void 0))return l}));if(r.length===0)return;if(r.length===1){const a=r[0];if(!a||t.isShapeOfType(a,"image"))return}const i=[];if(n!==void 0){const a=r.map(l=>({shape:l,bounds:t.getShapeMaskedPageBounds(l).clone().expandBy(n)}));for(let l=0;l<a.length;l++){const c=a[l];if(l===0){i[0]={shapes:[c.shape],bounds:c.bounds};continue}let u=!1;for(const d of i)if(d.bounds.includes(c.bounds)){d.shapes.push(c.shape),d.bounds.expand(c.bounds),u=!0;break}u||i.push({shapes:[c.shape],bounds:c.bounds})}}else{const a=Ee.Common(r.map(l=>t.getShapeMaskedPageBounds(l)));i.push({shapes:r,bounds:a})}const s=t.options.flattenImageBoundsPadding;for(const a of i){n!==void 0&&a.bounds.expandBy(-n);const l=await t.getSvgString(a.shapes,{padding:s,background:!1});if(!(l!=null&&l.svg))continue;const c=await t.getAssetForExternalContent({type:"file",file:new File([l.svg],"asset.svg",{type:"image/svg+xml"})});c&&(a.asset=c)}const o=[];return Oa(()=>{for(const a of i){const{asset:l,bounds:c,shapes:u}=a;if(!l)continue;const d=t.findCommonAncestor(u)??t.getCurrentPageId();if(!d)continue;let h="a1";for(const x of u)if(x.parentId===d){x.index>h&&(h=x.index);break}let f,y,b;if(io(d)){const x=t.getShape(d);if(!x)continue;const C=t.getPointInShapeSpace(x,{x:c.x,y:c.y});b=t.getShapePageTransform(d).rotation(),C.sub(new M(s,s).rot(-b)),f=C.x,y=C.y}else f=c.x-s,y=c.y-s,b=0;t.deleteShapes(u),t.createAssets([{...l,id:l.id}]);const v=Sn();t.createShape({id:v,type:"image",index:h,parentId:d,x:f,y,rotation:-b,props:{assetId:l.id,w:c.w+s*2,h:c.h+s*2}}),o.push(v)}}),o}const awe=S.createContext(null);function lwe(t,e){return(e.isShapeOfType(t,"image")||e.isShapeOfType(t,"video"))&&!!t.props.assetId}function Sft(t){return Object.fromEntries(t.map(e=>[e.id,e]))}function oE(t,e){if(t.getSelectedShapes().length===0)return t.getDocumentSettings().name||e}function Cft({overrides:t,children:e}){const n=as(),r=NA(),i=a9(),s=hr(),o=dA(),a=et(),l=i.msg("document.default-name"),c=S.useMemo(()=>{const u=n;if(!u)return{};function d(){return u.isIn("select")||(u.complete(),u.setCurrentTool("select")),!1}function h(){return u.isIn("select")&&u.getSelectedShapeIds().length>0}function f(v){if(!h()||d())return;u.markHistoryStoppingPoint("resize shapes");const x=u.getSelectedShapeIds();x.length!==0&&u.run(()=>{x.map(E=>u.getShape(E)).filter(Boolean).forEach(E=>{var I;u.resizeShape(E.id,new M(v,v),{scaleOrigin:(I=u.getSelectionPageBounds())==null?void 0:I.center})})})}const y=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(v){h()&&(d()||(s("edit-link",{source:v}),u.markHistoryStoppingPoint("edit-link"),i.addDialog({component:Iht})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"cmd+i,ctrl+i",onSelect(v){s("insert-embed",{source:v}),i.addDialog({component:Xxe})}},{id:"open-kbd-shortcuts",label:"action.open-kbd-shortcuts",kbd:"cmd+alt+/,ctrl+alt+/",onSelect(v){s("open-kbd-shortcuts",{source:v}),i.addDialog({component:owe})}},{id:"insert-media",label:"action.insert-media",kbd:"cmd+u,ctrl+u",onSelect(v){s("insert-media",{source:v}),i.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"cmd+z,ctrl+z",onSelect(v){s("undo",{source:v}),u.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"cmd+shift+z,ctrl+shift+z",onSelect(v){s("redo",{source:v}),u.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(v){let x=u.getSelectedShapeIds();x.length===0&&(x=Array.from(u.getCurrentPageShapeIds().values())),x.length!==0&&(s("export-as",{format:"svg",source:v}),i.exportAs(x,"svg",oE(u,l)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(v){let x=u.getSelectedShapeIds();x.length===0&&(x=Array.from(u.getCurrentPageShapeIds().values())),x.length!==0&&(s("export-as",{format:"png",source:v}),i.exportAs(x,"png",oE(u,l)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(v){let x=u.getSelectedShapeIds();x.length===0&&(x=Array.from(u.getCurrentPageShapeIds().values())),x.length!==0&&(s("export-all-as",{format:"svg",source:v}),i.exportAs(Array.from(u.getCurrentPageShapeIds()),"svg",oE(u,l)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(v){const x=Array.from(u.getCurrentPageShapeIds().values());x.length!==0&&(s("export-all-as",{format:"png",source:v}),i.exportAs(x,"png",oE(u,l)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"cmd+shift+c,ctrl+shift+c",readonlyOk:!0,onSelect(v){let x=u.getSelectedShapeIds();x.length===0&&(x=Array.from(u.getCurrentPageShapeIds().values())),x.length!==0&&(s("copy-as",{format:"svg",source:v}),i.copyAs(x,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(v){let x=u.getSelectedShapeIds();x.length===0&&(x=Array.from(u.getCurrentPageShapeIds().values())),x.length!==0&&(s("copy-as",{format:"png",source:v}),i.copyAs(x,"png"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(v){h()&&(d()||(s("toggle-auto-size",{source:v}),u.markHistoryStoppingPoint("toggling auto size"),u.run(()=>{const x=u.getSelectedShapes().filter(C=>u.isShapeOfType(C,"text")&&C.props.autoSize===!1);u.updateShapes(x.map(C=>({id:C.id,type:C.type,props:{...C.props,w:8,autoSize:!0}}))),yn(u,x.map(C=>C.id))})))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(v){s("open-embed-link",{source:v});const x=u.getSelectedShapeIds(),C="No embed shapes selected";if(x.length!==1){console.error(C);return}const E=u.getShape(x[0]);if(!E||!u.isShapeOfType(E,"embed")){console.error(C);return}fot(E.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(v){var x,C;if(((x=u.root.getCurrent())==null?void 0:x.id)!=="zoom"&&(s("zoom-tool",{source:v}),!(u.inputs.shiftKey||u.inputs.ctrlKey))){const E=u.root.getCurrent();E&&((C=E.getCurrent())==null?void 0:C.id)==="idle"&&u.setCurrentTool("zoom",{onInteractionEnd:E.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(v){h()&&(d()||u.run(()=>{s("convert-to-bookmark",{source:v});const x=u.getSelectedShapes(),C=[],E=[];for(const I of x){if(!I||!u.isShapeOfType(I,"embed")||!I.props.url)continue;const P=new M(I.x,I.y);P.rot(-I.rotation),P.add(new M(I.props.w/2-300/2,I.props.h/2-320/2)),P.rot(I.rotation);const _={id:Sn(),type:"bookmark",rotation:I.rotation,x:P.x,y:P.y,opacity:1,props:{url:I.props.url}};C.push(_),E.push(I.id)}u.markHistoryStoppingPoint("convert shapes to bookmark"),u.deleteShapes(E),u.createShapes(C)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(v){h()&&(d()||(s("convert-to-embed",{source:v}),u.run(()=>{const x=u.getSelectedShapeIds(),C=bt(x.map(P=>u.getShape(P))),E=[],I=[];for(const P of C){if(!u.isShapeOfType(P,"bookmark"))continue;const{url:_}=P.props,A=i.getEmbedDefinition(_);if(!A||!A.definition)continue;const{width:D,height:L}=A.definition,z=new M(P.x,P.y);z.rot(-P.rotation),z.add(new M(P.props.w/2-D/2,P.props.h/2-L/2)),z.rot(P.rotation);const $={id:Sn(),type:"embed",x:z.x,y:z.y,rotation:P.rotation,props:{url:_,w:D,h:L}};E.push($),I.push(P.id)}u.markHistoryStoppingPoint("convert shapes to embed"),u.deleteShapes(I),u.createShapes(E)})))}},{id:"duplicate",kbd:"cmd+d,ctrl+d",label:"action.duplicate",icon:"duplicate",onSelect(v){if(!h()||d())return;s("duplicate-shapes",{source:v});const x=u.getInstanceState();let C,E;if(x.duplicateProps)C=x.duplicateProps.shapeIds,E=x.duplicateProps.offset;else{C=u.getSelectedShapeIds();const I=Ee.Common(bt(C.map(P=>u.getShapePageBounds(P))));E=u.getCameraOptions().isLocked?{x:u.options.adjacentShapeMargin,y:u.options.adjacentShapeMargin}:{x:I.width+u.options.adjacentShapeMargin,y:0}}u.markHistoryStoppingPoint("duplicate shapes"),u.duplicateShapes(C,E),x.duplicateProps&&u.updateInstanceState({duplicateProps:{...x.duplicateProps,shapeIds:u.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"cmd+shift+g,ctrl+shift+g",icon:"ungroup",onSelect(v){h()&&(d()||(s("ungroup-shapes",{source:v}),u.markHistoryStoppingPoint("ungroup"),u.ungroupShapes(u.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"cmd+g,ctrl+g",icon:"group",onSelect(v){if(!h()||d())return;s("group-shapes",{source:v});const x=u.getOnlySelectedShape();x&&u.isShapeOfType(x,"group")?(u.markHistoryStoppingPoint("ungroup"),u.ungroupShapes(u.getSelectedShapeIds())):(u.markHistoryStoppingPoint("group"),u.groupShapes(u.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"cmd+shift+f,ctrl+shift+f",onSelect(v){if(!h())return;s("remove-frame",{source:v});const x=u.getSelectedShapes();x.length>0&&x.every(C=>u.isShapeOfType(C,"frame"))&&(u.markHistoryStoppingPoint("remove-frame"),Eht(u,x.map(C=>C.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(v){if(!h())return;s("fit-frame-to-content",{source:v});const x=u.getOnlySelectedShape();x&&u.isShapeOfType(x,"frame")&&(u.markHistoryStoppingPoint("fit-frame-to-content"),Gxe(u,x.id))}},{id:"align-left",label:"action.align-left",kbd:"alt+A",icon:"align-left",onSelect(v){h()&&(d()||(s("align-shapes",{operation:"left",source:v}),u.markHistoryStoppingPoint("align left"),u.run(()=>{const x=u.getSelectedShapeIds();u.alignShapes(x,"left"),yn(u,x)})))}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"alt+H",icon:"align-center-horizontal",onSelect(v){h()&&(d()||(s("align-shapes",{operation:"center-horizontal",source:v}),u.markHistoryStoppingPoint("align center horizontal"),u.run(()=>{const x=u.getSelectedShapeIds();u.alignShapes(x,"center-horizontal"),yn(u,x)})))}},{id:"align-right",label:"action.align-right",kbd:"alt+D",icon:"align-right",onSelect(v){h()&&(d()||(s("align-shapes",{operation:"right",source:v}),u.markHistoryStoppingPoint("align right"),u.run(()=>{const x=u.getSelectedShapeIds();u.alignShapes(x,"right"),yn(u,x)})))}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"alt+V",icon:"align-center-vertical",onSelect(v){h()&&(d()||(s("align-shapes",{operation:"center-vertical",source:v}),u.markHistoryStoppingPoint("align center vertical"),u.run(()=>{const x=u.getSelectedShapeIds();u.alignShapes(x,"center-vertical"),yn(u,x)})))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"alt+W",onSelect(v){h()&&(d()||(s("align-shapes",{operation:"top",source:v}),u.markHistoryStoppingPoint("align top"),u.run(()=>{const x=u.getSelectedShapeIds();u.alignShapes(x,"top"),yn(u,x)})))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"alt+S",onSelect(v){h()&&(d()||(s("align-shapes",{operation:"bottom",source:v}),u.markHistoryStoppingPoint("align bottom"),u.run(()=>{const x=u.getSelectedShapeIds();u.alignShapes(x,"bottom"),yn(u,x)})))}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"alt+shift+h",onSelect(v){h()&&(d()||(s("distribute-shapes",{operation:"horizontal",source:v}),u.markHistoryStoppingPoint("distribute horizontal"),u.run(()=>{const x=u.getSelectedShapeIds();u.distributeShapes(x,"horizontal"),yn(u,x)})))}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"alt+shift+V",onSelect(v){h()&&(d()||(s("distribute-shapes",{operation:"vertical",source:v}),u.markHistoryStoppingPoint("distribute vertical"),u.run(()=>{const x=u.getSelectedShapeIds();u.distributeShapes(x,"vertical"),yn(u,x)})))}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(v){h()&&(d()||(s("stretch-shapes",{operation:"horizontal",source:v}),u.markHistoryStoppingPoint("stretch horizontal"),u.run(()=>{const x=u.getSelectedShapeIds();u.stretchShapes(x,"horizontal"),yn(u,x)})))}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(v){h()&&(d()||(s("stretch-shapes",{operation:"vertical",source:v}),u.markHistoryStoppingPoint("stretch vertical"),u.run(()=>{const x=u.getSelectedShapeIds();u.stretchShapes(x,"vertical"),yn(u,x)})))}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"shift+h",onSelect(v){h()&&(d()||(s("flip-shapes",{operation:"horizontal",source:v}),u.markHistoryStoppingPoint("flip horizontal"),u.run(()=>{const x=u.getSelectedShapeIds();u.flipShapes(x,"horizontal"),yn(u,x)})))}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"shift+v",onSelect(v){h()&&(d()||(s("flip-shapes",{operation:"vertical",source:v}),u.markHistoryStoppingPoint("flip vertical"),u.run(()=>{const x=u.getSelectedShapeIds();u.flipShapes(x,"vertical"),yn(u,x)})))}},{id:"pack",label:"action.pack",icon:"pack",onSelect(v){h()&&(d()||(s("pack-shapes",{source:v}),u.markHistoryStoppingPoint("pack"),u.run(()=>{const x=u.getSelectedShapeIds();u.packShapes(x,u.options.adjacentShapeMargin),yn(u,x)})))}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(v){h()&&(d()||(s("stack-shapes",{operation:"vertical",source:v}),u.markHistoryStoppingPoint("stack-vertical"),u.run(()=>{const x=u.getSelectedShapeIds();u.stackShapes(x,"vertical",u.options.adjacentShapeMargin),yn(u,x)})))}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(v){h()&&(d()||(s("stack-shapes",{operation:"horizontal",source:v}),u.markHistoryStoppingPoint("stack-horizontal"),u.run(()=>{const x=u.getSelectedShapeIds();u.stackShapes(x,"horizontal",u.options.adjacentShapeMargin),yn(u,x)})))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(v){h()&&(d()||(s("reorder-shapes",{operation:"toFront",source:v}),u.markHistoryStoppingPoint("bring to front"),u.bringToFront(u.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"alt+]",onSelect(v){h()&&(d()||(s("reorder-shapes",{operation:"forward",source:v}),u.markHistoryStoppingPoint("bring forward"),u.bringForward(u.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"alt+[",onSelect(v){h()&&(d()||(s("reorder-shapes",{operation:"backward",source:v}),u.markHistoryStoppingPoint("send backward"),u.sendBackward(u.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(v){h()&&(d()||(s("reorder-shapes",{operation:"toBack",source:v}),u.markHistoryStoppingPoint("send to back"),u.sendToBack(u.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"cmd+x,ctrl+x",onSelect(v){h()&&(d()||(u.markHistoryStoppingPoint("cut"),i.cut(v)))}},{id:"copy",label:"action.copy",kbd:"cmd+c,ctrl+c",readonlyOk:!0,onSelect(v){h()&&(d()||i.copy(v))}},{id:"paste",label:"action.paste",kbd:"cmd+v,ctrl+v",onSelect(v){var x;(x=navigator.clipboard)==null||x.read().then(C=>{i.paste(C,v,v==="context-menu"?u.inputs.currentPagePoint:void 0)}).catch(()=>{i.addToast({title:i.msg("action.paste-error-title"),description:i.msg("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"cmd+a,ctrl+a",readonlyOk:!0,onSelect(v){u.run(()=>{d()||(s("select-all-shapes",{source:v}),u.markHistoryStoppingPoint("select all kbd"),u.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(v){h()&&(d()||(s("select-none-shapes",{source:v}),u.markHistoryStoppingPoint("select none"),u.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del",icon:"trash",onSelect(v){h()&&(d()||(s("delete-shapes",{source:v}),u.markHistoryStoppingPoint("delete"),u.deleteShapes(u.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(v){h()&&(d()||(s("rotate-cw",{source:v}),u.markHistoryStoppingPoint("rotate-cw"),u.run(()=>{const x=u.getSelectionRotation()%(Zn/2),C=Nr(x,0)||Nr(x,Zn/2),E=u.getSelectedShapeIds();u.rotateShapesBy(E,Zn/2-(C?0:x)),yn(u,E)})))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(v){h()&&(d()||(s("rotate-ccw",{source:v}),u.markHistoryStoppingPoint("rotate-ccw"),u.run(()=>{const x=u.getSelectionRotation()%(Zn/2),C=Nr(x,0),E=u.getSelectedShapeIds();u.rotateShapesBy(E,C?-(Zn/2):-x),yn(u,E)})))}},{id:"zoom-in",label:"action.zoom-in",kbd:"cmd+=,ctrl+=,=",readonlyOk:!0,onSelect(v){s("zoom-in",{source:v,towardsCursor:!1}),u.zoomIn(void 0,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-in-on-cursor",label:"action.zoom-in",kbd:"shift+cmd+=,shift+ctrl+=,shift+=",readonlyOk:!0,onSelect(v){s("zoom-in",{source:v,towardsCursor:!0}),u.zoomIn(u.inputs.currentScreenPoint,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"cmd+-,ctrl+-,-",readonlyOk:!0,onSelect(v){s("zoom-out",{source:v,towardsCursor:!1}),u.zoomOut(void 0,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-out-on-cursor",label:"action.zoom-out",kbd:"shift+cmd+-,shift+ctrl+-,shift+-",readonlyOk:!0,onSelect(v){s("zoom-out",{source:v,towardsCursor:!0}),u.zoomOut(u.inputs.currentScreenPoint,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"shift+0",readonlyOk:!0,onSelect(v){s("reset-zoom",{source:v}),u.resetZoom(void 0,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"shift+1",readonlyOk:!0,onSelect(v){s("zoom-to-fit",{source:v}),u.zoomToFit({animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"shift+2",readonlyOk:!0,onSelect(v){h()&&(d()||(s("zoom-to-selection",{source:v}),u.zoomToSelection({animation:{duration:u.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(v){s("toggle-snap-mode",{source:v}),u.user.updateUserPreferences({isSnapMode:!u.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"cmd+/,ctrl+/",readonlyOk:!0,onSelect(v){const x=u.user.getIsDarkMode()?"light":"dark";s("color-scheme",{source:v,value:x}),u.user.updateUserPreferences({colorScheme:x})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(v){s("toggle-wrap-mode",{source:v}),u.user.updateUserPreferences({isWrapMode:!u.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(v){s("toggle-dynamic-size-mode",{source:v}),u.user.updateUserPreferences({isDynamicSizeMode:!u.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(v){s("toggle-paste-at-cursor",{source:v}),u.user.updateUserPreferences({isPasteAtCursorMode:!u.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(v){s("toggle-reduce-motion",{source:v}),u.user.updateUserPreferences({animationSpeed:u.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-keyboard-shortcuts",label:{default:"action.toggle-keyboard-shortcuts",menu:"action.toggle-keyboard-shortcuts.menu"},readonlyOk:!0,onSelect(v){s("toggle-keyboard-shortcuts",{source:v}),u.user.updateUserPreferences({areKeyboardShortcutsEnabled:!u.user.getAreKeyboardShortcutsEnabled()})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(v){s("toggle-edge-scrolling",{source:v}),u.user.updateUserPreferences({edgeScrollSpeed:u.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(v){s("toggle-transparent",{source:v}),u.updateInstanceState({exportBackground:!u.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(v){s("toggle-tool-lock",{source:v}),u.updateInstanceState({isToolLocked:!u.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(v){s("unlock-all",{source:v});const x=[];for(const C of u.getCurrentPageShapes())C.isLocked&&x.push({id:C.id,type:C.type,isLocked:!1});x.length>0&&u.updateShapes(x)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"cmd+.,ctrl+.",checkbox:!0,onSelect(v){u.timers.requestAnimationFrame(()=>{u.run(()=>{s("toggle-focus-mode",{source:v}),i.clearDialogs(),i.clearToasts(),u.updateInstanceState({isFocusMode:!u.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"cmd+',ctrl+'",onSelect(v){s("toggle-grid-mode",{source:v}),u.updateInstanceState({isGridMode:!u.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(v){s("toggle-debug-mode",{source:v}),u.updateInstanceState({isDebugMode:!u.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"cmd+p,ctrl+p",readonlyOk:!0,onSelect(v){s("print",{source:v}),i.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(v){s("exit-pen-mode",{source:v}),u.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(v){s("stop-following",{source:v}),u.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(v){s("zoom-to-content",{source:v});const x=u.getSelectionPageBounds()??u.getCurrentPageBounds();x&&u.zoomToBounds(x,{targetZoom:Math.min(1,u.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"shift+l",onSelect(v){u.markHistoryStoppingPoint("locking"),s("toggle-lock",{source:v}),u.toggleLock(u.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(v){const x=fo.createId(),C=u.getSelectedShapeIds();u.run(()=>{u.markHistoryStoppingPoint("move_shapes_to_page"),u.createPage({name:i.msg("page-menu.new-page-initial-name"),id:x}),u.moveShapesToPage(C,x)}),s("move-to-new-page",{source:v})}},{id:"select-white-color",label:"color-style.white",kbd:"alt+t",onSelect(v){const x=mo;u.run(()=>{u.markHistoryStoppingPoint("change-color"),u.isIn("select")&&u.setStyleForSelectedShapes(x,"white"),u.setStyleForNextShapes(x,"white")}),s("set-style",{source:v,id:x.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"alt+f",onSelect(v){const x=fg;u.run(()=>{u.markHistoryStoppingPoint("change-fill"),u.isIn("select")&&u.setStyleForSelectedShapes(x,"fill"),u.setStyleForNextShapes(x,"fill")}),s("set-style",{source:v,id:x.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"shift+f",onSelect:async v=>{const x=u.getSelectedShapeIds();if(x.length===0)return;u.markHistoryStoppingPoint("flattening to image"),s("flatten-to-image",{source:v});const C=await wft(u,x,u.options.flattenImageBoundsExpand);C!=null&&C.length&&u.setSelectedShapes(C)}},{id:"select-geo-tool",kbd:"g",onSelect:async v=>{s("select-tool",{source:v,id:"geo-previous"}),u.setCurrentTool("geo")}},{id:"change-page-prev",kbd:"alt+left,alt+up",readonlyOk:!0,onSelect:async v=>{const x=u.getPages(),C=x.findIndex(E=>E.id===u.getCurrentPageId());C<1||(s("change-page",{source:v,direction:"prev"}),u.setCurrentPage(x[C-1].id))}},{id:"change-page-next",kbd:"alt+right,alt+down",readonlyOk:!0,onSelect:async v=>{const x=u.getPages(),C=x.findIndex(E=>E.id===u.getCurrentPageId());if(C===-1||C>=x.length-1){if(u.getCurrentPageShapes().length<=0||u.getIsReadonly())return;s("new-page",{source:v}),u.run(()=>{u.markHistoryStoppingPoint("creating page");const E=fo.createId();u.createPage({name:i.msg("page-menu.new-page-initial-name"),id:E}),u.setCurrentPage(E)});return}u.setCurrentPage(x[C+1].id),s("change-page",{source:v,direction:"next"})}},{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+Enter,ctrl+Enter",isRequiredA11yAction:!0,onSelect:async v=>{if(!h())return;const x=u.getContainer().querySelector(".tlui-style-panel button");x==null||x.focus(),s("adjust-shape-styles",{source:v})}},{id:"a11y-open-context-menu",kbd:"cmd+shift+Enter,ctrl+shift+Enter",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async v=>{var P;if(!h())return;const x=u.getSelectionPageBounds();if(!x)return;const C=x.x+x.width/2,E=x.y+x.height/2,I=u.pageToScreen(new M(C,E));(P=u.getContainer().querySelector(".tl-canvas"))==null||P.dispatchEvent(new PointerEvent("contextmenu",{clientX:I.x,clientY:I.y,bubbles:!0})),s("open-context-menu",{source:v})}},{id:"enlarge-shapes",label:"a11y.enlarge-shape",kbd:"cmd+alt+shift+=,ctrl+alt+shift+=",onSelect:async v=>{f(1.1),s("enlarge-shapes",{source:v})}},{id:"shrink-shapes",label:"a11y.shrink-shape",kbd:"cmd+alt+shift+-,ctrl+alt+shift+-",onSelect:async v=>{f(1/1.1),s("shrink-shapes",{source:v})}},{id:"a11y-repeat-shape-announce",kbd:"alt+r",label:"a11y.repeat-shape",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async v=>{const x=u.getSelectedShapeIds();if(!x.length)return;const C=Ove({editor:u,selectedShapeIds:x,msg:a});C&&(o.announce({msg:""}),u.timers.requestAnimationFrame(()=>{o.announce({msg:C})}),s("a11y-repeat-shape-announce",{source:v}))}},{id:"image-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async v=>{s("image-replace",{source:v}),i.replaceImage()}},{id:"video-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async v=>{s("video-replace",{source:v}),i.replaceVideo()}},{id:"download-original",label:"action.download-original",readonlyOk:!0,onSelect:async v=>{const x=u.getSelectedShapes();if(x.length===0)return;const C=x.filter(E=>lwe(E,u));if(C.length!==0){for(const E of C){const I=u.getAsset(E.props.assetId);if(!I||!I.props.src)continue;const P=await u.resolveAssetUrl(I.id,{shouldResolveToOriginal:!0});if(!P)return;const _=document.createElement("a");_.href=P,(I.type==="video"||I.type==="image")&&!I.props.src.startsWith("asset:")?_.download=I.props.name:_.download="download",document.body.appendChild(_),_.click(),document.body.removeChild(_)}s("download-original",{source:v})}}}];r&&y.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(v){s("open-cursor-chat",{source:v}),!u.getInstanceState().isCoarsePointer&&u.timers.requestAnimationFrame(()=>{u.updateInstanceState({isChatting:!0})})}});const b=Sft(y);return t?t(u,b,i):b},[i,n,s,t,l,r,a,o]);return g.jsx(awe.Provider,{value:c,children:e})}function Kd(){const t=S.useContext(awe);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function Tw(t,e){return t?typeof t=="string"?t:e?t[e]??t.default:void 0:void 0}function $A({id:t,kbd:e,label:n,readonlyOk:r,onSelect:i,toggle:s=!1,disabled:o=!1,checked:a=!1}){const{type:l,sourceId:c}=RA(),u=Ka(),d=et();if(u&&!r)return null;const h=Tw(n,l),f=h?d(h):void 0;switch(l){case"menu":return g.jsxs(Wbe,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:f,onSelect:y=>{i==null||i(c),St(y)},disabled:o,checked:a,children:[g.jsx(Eu,{small:!0,label:d(a?"ui.checked":"ui.unchecked"),icon:s?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&g.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&g.jsx(px,{children:e})]});case"context-menu":return g.jsxs(Dut,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:f,onSelect:y=>{i(c),St(y)},disabled:o,checked:a,children:[g.jsx(Eu,{small:!0,label:d(a?"ui.checked":"ui.unchecked"),icon:s?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&g.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&g.jsx(px,{children:e})]},t);default:return null}}function ta({id:t,disabled:e=!1,label:n,size:r="small",children:i}){const{type:s,sourceId:o}=RA(),a=Fr(),l=et(),c=n?typeof n=="string"?n:n[s]??n.default:void 0,u=c?l(c):void 0;switch(s){case"menu":return g.jsxs(jht,{id:`${o}-sub.${t}`,children:[g.jsx(Lht,{id:`${o}-sub.${t}-button`,disabled:e,label:u,title:u}),g.jsx(Fht,{id:`${o}-sub.${t}-content`,size:r,children:i})]});case"context-menu":return e?null:g.jsxs(Eft,{id:`${o}-sub.${t}`,children:[g.jsx(Mbe,{dir:"ltr",disabled:e,asChild:!0,children:g.jsxs(xt,{"data-testid":`${o}-sub.${t}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[g.jsx(xr,{children:u}),g.jsx(vt,{icon:"chevron-right",small:!0})]})}),g.jsx(B6,{container:a,children:g.jsx(Obe,{"data-testid":`${o}-sub.${t}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:i})})]});default:return i}}function Eft({id:t,children:e}){const[n,r]=Vd(t);return g.jsx(Abe,{open:n,onOpenChange:r,children:e})}const Tft=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function Ift(){const t=re(),e=hr(),n=ie("colorScheme",()=>t.user.getUserPreferences().colorScheme??(t.user.getIsDarkMode()?"dark":"light"),[t]);return g.jsx(ta,{id:"help menu color-scheme",label:"menu.theme",children:g.jsx(Nt,{id:"theme",children:Tft.map(({colorScheme:r,label:i})=>g.jsx($A,{id:`color-scheme-${r}`,label:i,checked:r===n,readonlyOk:!0,onSelect:()=>{t.user.updateUserPreferences({colorScheme:r}),e("color-scheme",{source:"menu",value:r})}},r))})})}const Pft=({id:t,component:e,onClose:n,preventBackgroundClose:r})=>{const{removeDialog:i}=ZS(),s=S.useRef(!1),o=Fr(),a=S.useCallback(l=>{if(!l){if(n)try{n()}catch(c){console.warn(c)}i(t)}},[t,n,i]);return g.jsx(elt,{onOpenChange:a,defaultOpen:!0,children:g.jsx(tlt,{container:o,children:g.jsx(nlt,{dir:"ltr",className:"tlui-dialog__overlay",onClick:l=>{s.current||!r&&l.target===l.currentTarget&&a(!1)},children:g.jsx(rlt,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,onMouseDown:()=>s.current=!0,onMouseUp:()=>s.current=!1,onInteractOutside:l=>{s.current=!1,r&&l.preventDefault()},children:g.jsx(e,{onClose:()=>{s.current=!1,a(!1)}})})})})})},_ft=S.memo(function(){const{dialogs:e}=ZS();return ie("dialogs",()=>e.get(),[e]).map(r=>g.jsx(Pft,{...r},r.id))});function Fl({actionId:t="",...e}){const r=Kd()[t];return r?g.jsx($A,{...r,...e}):null}const kft=4e3,Aft={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function Mft({toast:t}){const{removeToast:e}=Wd(),n=et(),r=a=>{a||e(t.id)},i=t.actions&&t.actions.length>0,s=t.icon||t.severity&&Aft[t.severity],o=t.iconLabel||(t.severity?n(`toast.${t.severity}`):"");return g.jsxs(rht,{onOpenChange:r,className:"tlui-toast__container",duration:t.keepOpen?1/0:kft,"data-severity":t.severity,children:[s&&g.jsx("div",{className:"tlui-toast__icon",children:g.jsx(Eu,{label:o,icon:s})}),g.jsxs("div",{className:"tlui-toast__main","data-title":!!t.title,"data-description":!!t.description,"data-actions":!!t.actions,children:[g.jsxs("div",{className:"tlui-toast__content",children:[t.title&&g.jsx(iht,{className:"tlui-toast__title",children:t.title}),t.description&&g.jsx(sht,{className:"tlui-toast__description",children:t.description})]}),t.actions&&g.jsxs("div",{className:"tlui-toast__actions",children:[t.actions.map((a,l)=>g.jsx(oht,{altText:a.label,asChild:!0,onClick:a.onClick,children:g.jsx(xt,{type:a.type,children:g.jsx(xr,{children:a.label})})},l)),g.jsx(ste,{asChild:!0,children:g.jsx(xt,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:g.jsx(xr,{children:t.closeLabel??n("toast.close")})})})]})]}),!i&&g.jsx(ste,{asChild:!0,children:g.jsx(xt,{type:"normal",className:"tlui-toast__close",children:g.jsx(xr,{children:t.closeLabel??n("toast.close")})})})]})}const Oft=S.memo(function(){const{toasts:e}=Wd(),n=ie("toasts",()=>e.get(),[]);return g.jsxs(g.Fragment,{children:[n.map(r=>g.jsx(Mft,{toast:r},r.id)),g.jsx(wxe,{className:"tlui-toast__viewport"})]})});function CP(t,e,n){const{arrowheadStart:r,arrowheadEnd:i}=e.props,s=ry(t,e,n),o=s.start.clone(),a=s.end.clone(),l=M.Med(o,a);if(M.Equals(o,a))return{bindings:n,type:"straight",start:{handle:o,point:o,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:!1,length:0};const c=M.Sub(a,o).uni(),u=TP(t,e,"start"),d=TP(t,e,"end"),h=t.getShapePageTransform(e);gte(a,s.start,h,d),gte(o,s.end,h,u);let f=0,y=0,b=0,v=0,x=iy*e.props.scale;const C=u&&d&&u.shape===d.shape,E=u&&d?c9(t,u.shape.id,d.shape.id):"safe";E==="safe"&&u&&d&&!C&&!u.isExact&&!d.isExact&&(d.didIntersect&&!u.didIntersect?u.isClosed&&o.setTo(a.clone().add(c.clone().mul(iy*e.props.scale))):d.didIntersect||d.isClosed&&a.setTo(o.clone().sub(c.clone().mul(iy*e.props.scale))));const I=M.Sub(a,o),P=M.Len(I)?I.uni():M.From(I),_=!M.Equals(P,c);C||(E!=="start-contains-end"&&u&&r!=="none"&&!u.isExact&&(b=Sa[e.props.size]/2+("size"in u.shape.props?Sa[u.shape.props.size]/2:0),f=(Pw+b)*e.props.scale,x+=b*e.props.scale),E!=="end-contains-start"&&d&&i!=="none"&&!d.isExact&&(v=Sa[e.props.size]/2+("size"in d.shape.props?Sa[d.shape.props.size]/2:0),y=(Pw+v)*e.props.scale,x+=v*e.props.scale));const A=o.clone().add(P.clone().mul(f*(_?-1:1))),D=a.clone().sub(P.clone().mul(y*(_?-1:1)));M.DistMin(A,D,x)&&(f!==0&&y!==0?(f*=-1.5,y*=-1.5):f!==0?f*=-1:y!==0&&(y*=-1)),o.add(P.clone().mul(f*(_?-1:1))),a.sub(P.clone().mul(y*(_?-1:1))),_?(u&&d&&a.setTo(M.Add(o,P.clone().mul(-iy*e.props.scale))),l.setTo(M.Med(s.start,s.end))):l.setTo(M.Med(o,a));const L=M.Dist(o,a);return{bindings:n,type:"straight",start:{handle:s.start,point:o,arrowhead:e.props.arrowheadStart},end:{handle:s.end,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:L>0,length:L}}function gte(t,e,n,r){if(r===void 0||r.isExact)return;const i=xe.applyToPoint(n,e),s=xe.applyToPoint(n,t),o=xe.applyToPoint(xe.Inverse(r.transform),i),a=xe.applyToPoint(xe.Inverse(r.transform),s),l=Array.from(r.geometry.intersectLineSegment(o,a,{includeLabels:!1,includeInternal:!1}));let c;if(l.length&&(c=l.sort((h,f)=>M.Dist2(h,o)-M.Dist2(f,o))[0]??(r.isClosed?void 0:a)),c===void 0&&(c=r.geometry.nearestPoint(a),!M.DistMin(c,a,1)))return;const u=xe.applyToPoint(r.transform,c),d=xe.applyToPoint(xe.Inverse(n),u);t.setTo(d),r.didIntersect=!0}function Dft(t,e,n){const{arrowheadEnd:r,arrowheadStart:i}=e.props,s=e.props.bend;if(Math.abs(s)>Math.abs(e.props.bend*(npt*e.props.scale)))return CP(t,e,n);const o=ry(t,e,n),a=M.Med(o.start,o.end),l=M.Sub(o.end,o.start),c=M.Len(l)?l.uni():M.From(l),u=M.Add(a,c.per().mul(-s)),d=TP(t,e,"start"),h=TP(t,e,"end"),f=o.start.clone(),y=o.end.clone(),b=u.clone();if(M.Equals(f,y))return{bindings:n,type:"straight",start:{handle:f,point:f,arrowhead:e.props.arrowheadStart},end:{handle:y,point:y,arrowhead:e.props.arrowheadEnd},middle:b,isValid:!1,length:0};const v=e.props.bend<0,x=v?mU:KGe,C=mte(f,y,b),E=M.Angle(C.center,f),I=M.Angle(C.center,y),P=x(E,I);if(C.length===0||C.size===0||!kZ(C.length)||!kZ(C.size))return CP(t,e,n);const _=f.clone(),A=y.clone(),D=b.clone(),L=t.getShapePageTransform(e);let z=0,$=0,H=iy*e.props.scale;if(d&&!d.isExact){const Z=xe.applyToPoint(L,_),U=xe.applyToPoint(L,C.center),J=xe.applyToPoint(L,A),ge=xe.Inverse(d.transform),_e=xe.applyToPoint(ge,Z),fe=xe.applyToPoint(ge,U),je=xe.applyToPoint(ge,J),{isClosed:Ae}=d;let ke,le=Array.from(d.geometry.intersectCircle(fe,C.radius,{includeLabels:!1,includeInternal:!1}));if(le.length){const ve=fe.angle(_e),qe=fe.angle(je),de=x(ve,qe);le=le.filter(Se=>x(ve,fe.angle(Se))<=de);const pe=de*.25;le.sort(Ae?(Se,Fe)=>Math.abs(x(ve,fe.angle(Se))-pe)<Math.abs(x(ve,fe.angle(Fe))-pe)?-1:1:(Se,Fe)=>x(ve,fe.angle(Se))<x(ve,fe.angle(Fe))?-1:1),ke=le[0]}if(!ke)if(Ae){const ve=d.geometry.nearestPoint(_e);M.DistMin(ve,_e,1)&&(ke=ve)}else ke=_e;if(ke&&(_.setTo(t.getPointInShapeSpace(e,xe.applyToPoint(d.transform,ke))),d.didIntersect=!0,i!=="none")){const ve=Sa[e.props.size]/2+("size"in d.shape.props?Sa[d.shape.props.size]/2:0);z=(Pw+ve)*e.props.scale,H+=ve*e.props.scale}}if(h&&!h.isExact){const Z=xe.applyToPoint(L,_),U=xe.applyToPoint(L,A),J=xe.applyToPoint(L,C.center),ge=xe.Inverse(h.transform),_e=xe.applyToPoint(ge,Z),fe=xe.applyToPoint(ge,J),je=xe.applyToPoint(ge,U),Ae=h.isClosed;let ke,le=Array.from(h.geometry.intersectCircle(fe,C.radius,{includeLabels:!1,includeInternal:!1}));if(le.length){const ve=fe.angle(_e),qe=fe.angle(je),de=x(ve,qe),pe=de*.75;le=le.filter(Se=>x(ve,fe.angle(Se))<=de),le.sort(Ae?(Se,Fe)=>Math.abs(x(ve,fe.angle(Se))-pe)<Math.abs(x(ve,fe.angle(Fe))-pe)?-1:1:(Se,Fe)=>x(ve,fe.angle(Se))<x(ve,fe.angle(Fe))?-1:1),ke=le[0]}if(!ke)if(Ae){const ve=h.geometry.nearestPoint(je);M.DistMin(ve,je,1)&&(ke=ve)}else ke=je;if(ke&&(A.setTo(t.getPointInShapeSpace(e,xe.applyToPoint(h.transform,ke))),h.didIntersect=!0,r!=="none")){const ve=Sa[e.props.size]/2+("size"in h.shape.props?Sa[h.shape.props.size]/2:0);$=(Pw+ve)*e.props.scale,H+=ve*e.props.scale}}let R=M.Angle(C.center,_),j=M.Angle(C.center,A),B=x(R,j),K=B*C.radius;const G=_.clone(),V=A.clone();if(z!==0&&G.setTo(C.center).add(M.FromAngle(R+B*(z/K*(v?1:-1))).mul(C.radius)),$!==0&&V.setTo(C.center).add(M.FromAngle(j+B*($/K*(v?-1:1))).mul(C.radius)),M.DistMin(G,V,H)){z!==0&&$!==0?(z*=-1.5,$*=-1.5):z!==0?z*=-2:$!==0&&($*=-2);const Z=.1-x(E,R)*C.radius,U=.1-x(j,I)*C.radius;z=Math.max(z,Z),$=Math.max($,U)}if(z!==0&&_.setTo(C.center).add(M.FromAngle(R+B*(z/K*(v?1:-1))).mul(C.radius)),$!==0&&A.setTo(C.center).add(M.FromAngle(j+B*($/K*(v?-1:1))).mul(C.radius)),d&&h&&!d.isExact&&!h.isExact){R=M.Angle(C.center,_),j=M.Angle(C.center,A),B=x(R,j),K=B*C.radius;const Z=c9(t,d.shape.id,h.shape.id);Z==="double-bound"&&K<30?(_.setTo(f),A.setTo(y),D.setTo(b)):Z==="safe"&&(d&&!d.didIntersect&&_.setTo(f),(h&&!h.didIntersect||x(E,R)>x(E,j))&&A.setTo(C.center).add(M.FromAngle(R+B*(Math.min(.9,iy*e.props.scale/K)*(v?1:-1))).mul(C.radius)))}Rft(C.center,C.radius,_,A,D,P,v),_.equals(A)&&(_.setTo(D.clone().addXY(1,1)),A.setTo(D.clone().subXY(1,1))),f.setTo(_),y.setTo(A),b.setTo(D);const W=mte(f,y,b);return{bindings:n,type:"arc",start:{point:f,handle:o.start,arrowhead:e.props.arrowheadStart},end:{point:y,handle:o.end,arrowhead:e.props.arrowheadEnd},middle:b,handleArc:C,bodyArc:W,isValid:W.length!==0&&isFinite(W.center.x)&&isFinite(W.center.y)}}function mte(t,e,n){const r=jhe(t,e,n)??M.Med(t,e),i=M.Dist(r,t),s=+M.Clockwise(t,n,e),o=((t.y-e.y)**2+(t.x-e.x)**2)**.5,a=((e.y-n.y)**2+(e.x-n.x)**2)**.5,l=((n.y-t.y)**2+(n.x-t.x)**2)**.5,c=Math.acos((a*a+l*l-o*o)/(2*a*l))*2,u=+(un>c),d=(Pn-c)*(s?1:-1),h=d*i;return{center:r,radius:i,size:d,length:h,largeArcFlag:u,sweepFlag:s}}function Rft(t,e,n,r,i,s,o){const a=M.Angle(t,n),l=M.Angle(t,r);let c=mU(a,l);if(o||(c=Pn-c),i.setTo(t).add(M.FromAngle(a+c*(.5*(o?1:-1))).mul(e)),c>s){i.rotWith(t,un);const u=r.clone();r.setTo(n),n.setTo(u)}}const yte=["right","bottom","left","top"],Nft={top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},jft={left:"x",right:"x",top:"y",bottom:"y"},Lm={top:"bottom",right:"left",bottom:"top",left:"right"},Iw={x:{v:(t,e)=>new M(t,e),loEdge:"left",hiEdge:"right",crossMid:"midY",gap:"gapX",midRange:"midXRange",self:"x",cross:"y",size:"width"},y:{v:(t,e)=>new M(e,t),loEdge:"top",hiEdge:"bottom",crossMid:"midX",gap:"gapY",midRange:"midYRange",self:"y",cross:"x",size:"height"}};function Lft(t,e){const n={min:t.min-e,max:t.max+e};return n.min>n.max?null:n}function Fft(t,e){return it(t.min<=t.max&&e.min<=e.max),t.min<=e.min&&e.max<=t.max?[{min:t.min,max:e.min},{min:e.max,max:t.max}]:e.max<=t.min||e.min>=t.max?[t]:e.min<=t.min&&t.max<=e.max?[]:EP(t.min,e)?[{min:e.max,max:t.max}]:EP(t.max,e)?[{min:t.min,max:e.min}]:[]}function SL(t,e){return{min:Math.min(t,e),max:Math.max(t,e)}}function EP(t,e){return t>=e.min&&t<=e.max}function vte(t){return t.max-t.min}function aE(t){if(!t)return;const e=t.cross.min;t.cross.min=-t.cross.max,t.cross.max=-e,t.crossTarget=-t.crossTarget}function lE(t){t&&(t.value=-t.value,t.expanded=t.expanded===null?null:-t.expanded)}const Ur={Identity:{x:1,y:1,transpose:!1},Rotate90:{x:-1,y:1,transpose:!0},Rotate180:{x:-1,y:-1,transpose:!1},Rotate270:{x:1,y:-1,transpose:!0},FlipY:{x:1,y:-1,transpose:!1}};function $ft(t){return t.transpose?{x:t.y,y:t.x,transpose:!0}:t}function Bft(t,e){const n={...t};return e.transpose&&(Xh(n,"x","y"),n.transpose=!n.transpose),e.x===-1&&(n.x=-n.x),e.y===-1&&(n.y=-n.y),n}function Xh(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function bte(t,e){e.x=t.x*e.x,e.y=t.y*e.y,t.transpose&&Xh(e,"x","y")}function Fm(t,e){t.x===-1&&(e.x=-(e.x+e.width)),t.y===-1&&(e.y=-(e.y+e.height)),t.transpose&&(Xh(e,"x","y"),Xh(e,"width","height"))}function xte(t,e){t.x===-1&&(Xh(e,"left","right"),aE(e.top),aE(e.bottom),lE(e.left),lE(e.right)),t.y===-1&&(Xh(e,"top","bottom"),aE(e.left),aE(e.right),lE(e.top),lE(e.bottom)),t.transpose&&(Xh(e,"left","top"),Xh(e,"right","bottom"))}class zft{constructor(e){N(this,"options");N(this,"A");N(this,"B");N(this,"common");N(this,"gapX");N(this,"gapY");N(this,"midX");N(this,"midY");N(this,"bias");N(this,"transform",Ur.Identity);N(this,"inverse",Ur.Identity);this.options=e.options,this.A=e.A,this.B=e.B,this.common=e.common,this.midX=e.midX,this.midY=e.midY,this.gapX=e.gapX,this.gapY=e.gapY,this.bias=new M(1,1)}apply(e){if(this.transform=Bft(e,this.transform),this.inverse=$ft(this.transform),Fm(e,this.A.original),Fm(e,this.B.original),Fm(e,this.common.original),Fm(e,this.A.expanded),Fm(e,this.B.expanded),Fm(e,this.common.expanded),xte(e,this.A.edges),xte(e,this.B.edges),bte(e,this.bias),e.x===-1&&(this.gapX=-this.gapX,this.midX=this.midX===null?null:-this.midX),e.y===-1&&(this.gapY=-this.gapY,this.midY=this.midY===null?null:-this.midY),e.transpose){let n=this.midX;this.midX=this.midY,this.midY=n,n=this.gapX,this.gapX=this.gapY,this.gapY=n}}reset(){this.apply(this.inverse)}vec(e,n){const r=new M(e,n);return bte(this.inverse,r),r}}const $m=.01;class Wo{constructor(e,n){N(this,"points",[]);N(this,"_midpointHandle",null);this.info=e,this.name=n}add(e,n){return this.points.push(this.info.vec(e,n)),this}midpointHandle(e){it(this._midpointHandle===null,"midX/midY called multiple times");const n=M.Lrp(this.points[this.points.length-2],this.points[this.points.length-1],.5);return this._midpointHandle={axis:this.info.transform.transpose?e==="x"?"y":"x":e,point:n,segmentStart:this.points[this.points.length-2].clone(),segmentEnd:this.points[this.points.length-1].clone()},this}build(){const e=[];for(let n=0;n<this.points.length;n++){const r=this.points[n],i=e[e.length-1],s=e[e.length-2];if(!i||!s)e.push(r);else{const o=Math.abs(r.x-i.x),a=Math.abs(r.y-i.y),l=Math.abs(r.x-s.x),c=Math.abs(r.y-s.y);o<$m&&a<$m||(o<$m&&l<$m?i.y=r.y:a<$m&&c<$m?i.x=r.x:e.push(r))}}return{name:this.name,points:e,distance:Uft(e),aEdgePicking:"manual",bEdgePicking:"manual",skipPointsWhenDrawing:new Set,midpointHandle:this._midpointHandle}}}function Uft(t){let e=0;for(let n=0;n<t.length-1;n++){const r=t[n],i=t[n+1];e+=Math.abs(i.x-r.x)+Math.abs(i.y-r.y)}return e}function cE(t){const e=t.A.edges.right,n=t.B.edges.left;if(!e||!n)return null;if(e.crossTarget>n.crossTarget&&t.apply(Ur.FlipY),t.gapX>0&&t.midX!==null)return new Wo(t,"to left 1").add(e.value,e.crossTarget).add(t.midX,e.crossTarget).add(t.midX,n.crossTarget).midpointHandle("x").add(n.value,n.crossTarget).build();if(e.expanded===null||n.expanded===null)return null;if(t.midY!==null)return new Wo(t,"to left 2").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.midY).add(n.expanded,t.midY).midpointHandle("y").add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build();const r=Math.abs(e.value-t.common.expanded.right)+Math.abs(e.crossTarget-t.common.expanded.bottom)+Math.abs(t.common.expanded.right-n.expanded)+Math.abs(t.common.expanded.bottom-n.crossTarget)+t.options.expandElbowLegLength+6,i=t.options.expandElbowLegLength+Math.abs(e.crossTarget-t.common.expanded.top)+Math.abs(e.expanded-t.common.expanded.left)+Math.abs(t.common.expanded.top-n.crossTarget)+Math.abs(t.common.expanded.left-n.value)+6+t.bias.y,s=t.gapX<0&&t.midX!==null?t.options.expandElbowLegLength+Math.abs(e.crossTarget-t.A.expanded.bottom)+t.common.expanded.width+Math.abs(t.A.expanded.bottom-t.B.expanded.top)+Math.abs(t.B.expanded.top-n.crossTarget)+t.options.expandElbowLegLength+8:1/0;return r<i&&r<s?new Wo(t,"to left 3").add(e.value,e.crossTarget).add(t.common.expanded.right,e.crossTarget).add(t.common.expanded.right,t.common.expanded.bottom).add(n.expanded,t.common.expanded.bottom).add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build():i<s?new Wo(t,"to left 4").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.common.expanded.top).add(t.common.expanded.left,t.common.expanded.top).add(t.common.expanded.left,n.crossTarget).add(n.value,n.crossTarget).build():t.midX!==null?new Wo(t,"to left 5").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.A.expanded.bottom).add(t.midX,t.A.expanded.bottom).add(t.midX,t.B.expanded.top).midpointHandle("y").add(n.expanded,t.B.expanded.top).add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build():null}function Fb(t){const e=t.A.edges.right,n=t.B.edges.top;if(!e||!n)return null;if(e.crossTarget<(n.expanded??n.value)&&n.crossTarget>(e.expanded??e.value)||t.A.isPoint&&t.B.expanded.containsPoint(t.A.original.center))return new Wo(t,"to top 1").add(e.value,e.crossTarget).add(n.crossTarget,e.crossTarget).add(n.crossTarget,n.value).build();if(t.gapX>0&&t.midX!==null&&n.expanded!==null)return new Wo(t,"to top 2").add(e.value,e.crossTarget).add(t.midX,e.crossTarget).add(t.midX,n.expanded).midpointHandle("x").add(n.crossTarget,n.expanded).add(n.crossTarget,n.value).build();if(t.gapY>0&&e.expanded!==null&&n.crossTarget<e.expanded&&t.midY!==null)return new Wo(t,"to top 3").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.midY).add(n.crossTarget,t.midY).midpointHandle("y").add(n.crossTarget,n.value).build();const r=Math.abs(e.value-t.common.expanded.right)+Math.abs(e.crossTarget-t.common.expanded.top)+Math.abs(n.crossTarget-t.common.expanded.right)+Math.abs(n.value-t.common.expanded.top),i=e.expanded!==null&&t.midY!==null&&n.expanded!==null?Math.abs(e.value-e.expanded)+Math.abs(t.B.expanded.left-e.expanded)+Math.abs(t.B.expanded.left-n.crossTarget)+Math.abs(e.crossTarget-t.B.expanded.top)+Math.abs(n.value-n.expanded):1/0,s=e.expanded!==null&&t.midX!==null&&n.expanded!==null?Math.abs(e.value-t.common.expanded.right)+Math.abs(e.crossTarget-t.A.expanded.bottom)+Math.abs(e.expanded-n.crossTarget)+Math.abs(t.A.expanded.bottom-n.expanded)+Math.abs(n.expanded-n.value):1/0;return r<i&&r<s?new Wo(t,"to top 4").add(e.value,e.crossTarget).add(t.common.expanded.right,e.crossTarget).add(t.common.expanded.right,t.common.expanded.top).add(n.crossTarget,t.common.expanded.top).add(n.crossTarget,n.value).build():n.expanded!==null&&e.expanded!==null&&t.midY!==null&&i<s?new Wo(t,"to top 5").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.midY).add(t.B.expanded.left,t.midY).midpointHandle("y").add(t.B.expanded.left,n.expanded).add(n.crossTarget,n.expanded).add(n.crossTarget,n.value).build():n.expanded!==null&&e.expanded!==null&&t.midX!==null?new Wo(t,"to top 6").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.A.expanded.bottom).add(t.midX,t.A.expanded.bottom).add(t.midX,n.expanded).midpointHandle("x").add(n.crossTarget,n.expanded).add(n.crossTarget,n.value).build():null}function uE(t){return t.apply(Ur.FlipY),Fb(t)}function dE(t){const e=t.A.edges.right,n=t.B.edges.right;if(!e||!n)return null;if((t.gapX<=0||e.crossTarget>t.B.expanded.bottom||e.crossTarget<t.B.expanded.top)&&(n.value>t.A.original.left||n.crossTarget>t.A.expanded.bottom||n.crossTarget<t.A.expanded.top))return new Wo(t,"to right 1").add(e.value,e.crossTarget).add(t.common.expanded.right,e.crossTarget).add(t.common.expanded.right,n.crossTarget).add(n.value,n.crossTarget).build();if(t.midX===null)return null;if(n.expanded!==null&&t.gapX>=0){const r=Math.abs(n.crossTarget-t.B.expanded.bottom)+Math.abs(e.crossTarget-t.B.expanded.bottom),i=Math.abs(n.crossTarget-t.B.expanded.top)+Math.abs(e.crossTarget-t.B.expanded.top),s=r<i?"bottom":"top";return new Wo(t,`to right 2 via ${s}`).add(e.value,e.crossTarget).add(t.midX,e.crossTarget).add(t.midX,t.B.expanded[s]).midpointHandle("x").add(n.expanded,t.B.expanded[s]).add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build()}if(e.expanded!==null&&t.gapX<=0){const r=Math.abs(n.crossTarget-t.A.expanded.bottom)+Math.abs(e.crossTarget-t.A.expanded.bottom),i=Math.abs(n.crossTarget-t.A.expanded.top)+Math.abs(e.crossTarget-t.A.expanded.top),s=r<i?"bottom":"top";return new Wo(t,`to right 3 via ${s}`).add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.A.expanded[s]).add(t.midX,t.A.expanded[s]).add(t.midX,n.crossTarget).midpointHandle("x").add(n.value,n.crossTarget).build()}return null}const Hft={top:{top:[Ur.Rotate270,dE],left:[Ur.Rotate270,Fb],bottom:[Ur.Rotate270,cE],right:[Ur.Rotate270,uE]},right:{top:[Ur.Identity,Fb],right:[Ur.Identity,dE],bottom:[Ur.Identity,uE],left:[Ur.Identity,cE]},bottom:{top:[Ur.Rotate90,cE],left:[Ur.Rotate90,uE],bottom:[Ur.Rotate90,dE],right:[Ur.Rotate90,Fb]},left:{top:[Ur.Rotate180,uE],left:[Ur.Rotate180,dE],bottom:[Ur.Rotate180,Fb],right:[Ur.Rotate180,cE]}};function Hr(t,e,n){const[r,i]=Hft[e][n];t.apply(r);const s=i(t);return t.reset(),s}function Vft(t,e){let n=null;if(Math.abs(t.gapX)+1>Math.abs(t.gapY)&&t.midX!==null)t.gapX>0?n=Hr(t,"right","left"):n=Hr(t,"left","right");else{const o=t.A.edges.right,a=t.A.edges.left,l=t.B.edges.top,c=t.B.edges.bottom;t.A.isPoint&&t.B.isPoint?t.gapY>0?n=Hr(t,"bottom","top"):n=Hr(t,"top","bottom"):o&&l&&(o.expanded??o.value)<=l.crossTarget&&o.crossTarget<=(l.expanded??l.value)?n=Hr(t,"right","top"):o&&c&&(o.expanded??o.value)<=c.crossTarget&&o.crossTarget>=(c.expanded??c.value)?n=Hr(t,"right","bottom"):a&&l&&(a.expanded??a.value)>=l.crossTarget&&a.crossTarget<=(l.expanded??l.value)?n=Hr(t,"left","top"):a&&c&&(a.expanded??a.value)>=c.crossTarget&&a.crossTarget>=(c.expanded??c.value)?n=Hr(t,"left","bottom"):t.gapY>0&&t.midY!==null?n=Hr(t,"bottom","top"):t.gapY<0&&t.midY!==null&&(n=Hr(t,"top","bottom"))}if(n)return n.aEdgePicking=e,n.bEdgePicking=e,n;const r=yte.filter(o=>t.A.edges[o]),i=yte.filter(o=>t.B.edges[o]),s=r.flatMap(o=>i.map(a=>[o,a,e,e]));return ny(t,s)}function Wft(t,e){let n=null;const r=t.A.edges.right,i=t.A.edges.left,s=t.B.edges.top,o=t.B.edges.bottom;switch(e){case"right":t.gapX>0&&t.gapX>Math.abs(t.gapY)&&t.midX!==null?n=Hr(t,"right","left"):r&&s&&(r.expanded??r.value)<=s.crossTarget&&r.crossTarget<=(s.expanded??s.value)?n=Hr(t,"right","top"):r&&o&&(r.expanded??r.value)<=o.crossTarget&&r.crossTarget>=(o.expanded??o.value)&&(n=Hr(t,"right","bottom"));break;case"left":t.gapX<0&&Math.abs(t.gapX)>Math.abs(t.gapY)&&t.midX!==null?n=Hr(t,"left","right"):i&&s&&(i.expanded??i.value)>=s.crossTarget&&i.crossTarget<=(s.expanded??s.value)?n=Hr(t,"left","top"):i&&o&&(i.expanded??i.value)>=o.crossTarget&&i.crossTarget>=(o.expanded??o.value)&&(n=Hr(t,"left","bottom"));break;case"top":case"bottom":break;default:Yt(e)}if(n)return n.aEdgePicking="manual",n.bEdgePicking="auto",n;switch(e){case"top":return ny(t,[["top","bottom","manual","auto"],["top","right","manual","auto"],["top","left","manual","auto"],["top","top","manual","auto"]]);case"bottom":return ny(t,[["bottom","top","manual","auto"],["bottom","right","manual","auto"],["bottom","left","manual","auto"],["bottom","bottom","manual","auto"]]);case"left":return ny(t,[["left","right","manual","auto"],["left","bottom","manual","auto"],["left","left","manual","auto"],["left","top","manual","auto"]]);case"right":return ny(t,[["right","left","manual","auto"],["right","bottom","manual","auto"],["right","right","manual","auto"],["right","top","manual","auto"]])}}function Kft(t,e,n){const r=Hr(t,e,n);return r||(t.A.isPoint&&t.B.isPoint?ny(t,[[Lm[e],Lm[n],"manual","manual"],[e,Lm[n],"manual","auto"],[Lm[e],n,"auto","manual"]]):t.A.isPoint?Hr(t,Lm[e],n):t.B.isPoint?Hr(t,e,Lm[n]):null)}function ny(t,e){let n=null,r=1/0,i=1/0,s=0;for(const[o,a,l,c]of e){s+=1;const u=Hr(t,o,a);u&&(u.aEdgePicking=l,u.bEdgePicking=c,u.points.length<r?(r=u.points.length,i=u.distance,n=u):u.points.length===r&&u.distance+s<i&&(i=u.distance,n=u))}return n}function cwe(t,e,n){const r=t.getShapeUtil(e.type).options,i={elbowMidpoint:e.props.elbowMidPoint,expandElbowLegLength:r.expandElbowLegLength[e.props.size]*e.props.scale,minElbowLegLength:r.minElbowLegLength[e.props.size]*e.props.scale};let s=wte(t,e,n.start,e.props.start),o=wte(t,e,n.end,e.props.end);s=Tte(s,o,i),o=Tte(o,s,i);const a=!!(!s.side&&o.side);let{aTerminal:l,bTerminal:c}=a?{aTerminal:o,bTerminal:s}:{aTerminal:s,bTerminal:o},u={top:bs(l,c,"top",i),right:bs(l,c,"right",i),bottom:bs(l,c,"bottom",i),left:bs(l,c,"left",i)},d={top:bs(c,l,"top",i),right:bs(c,l,"right",i),bottom:bs(c,l,"bottom",i),left:bs(c,l,"left",i)};const h=Ste(u,l.side),f=Ste(d,c.side);let y=!1;(!h||!f)&&(y=!0,h||(c=$b(c)),f||(l=$b(l)),c.bounds.containsPoint(l.target,i.expandElbowLegLength)&&(c=$b(c)),l.bounds.containsPoint(c.target,i.expandElbowLegLength)&&(l=$b(l))),y&&(u={top:bs(l,c,"top",i),right:bs(l,c,"right",i),bottom:bs(l,c,"bottom",i),left:bs(l,c,"left",i)},d={top:bs(c,l,"top",i),right:bs(c,l,"right",i),bottom:bs(c,l,"bottom",i),left:bs(c,l,"left",i)});const b=l.isPoint?l.bounds:l.bounds.clone().expandBy(i.expandElbowLegLength),v=c.isPoint?c.bounds:c.bounds.clone().expandBy(i.expandElbowLegLength),x={original:Ee.Common([l.bounds,c.bounds]),expanded:Ee.Common([b,v])};let C=c.bounds.minX-l.bounds.maxX;C<0&&(C=l.bounds.minX-c.bounds.maxX,C<0&&(C=0),C=-C);let E=c.bounds.minY-l.bounds.maxY;E<0&&(E=l.bounds.minY-c.bounds.maxY,E<0&&(E=0),E=-E);const I=l.minEndSegmentLength*3,P=c.minEndSegmentLength*3,_=(l.isPoint?I:i.minElbowLegLength)+(c.isPoint?P:i.minElbowLegLength);let A=null;C>_?A={a:l.isPoint?l.bounds.maxX+I:b.maxX,b:c.isPoint?c.bounds.minX-P:v.minX}:C<-_&&(A={a:l.isPoint?l.bounds.minX-I:b.minX,b:c.isPoint?c.bounds.maxX+P:v.maxX});let D=null;E>_?D={a:l.isPoint?l.bounds.maxY+I:b.maxY,b:c.isPoint?c.bounds.minY-P:v.minY}:E<-_&&(D={a:l.isPoint?l.bounds.minY-I:b.minY,b:c.isPoint?c.bounds.maxY+P:v.maxY});const L=a?1-i.elbowMidpoint:i.elbowMidpoint,z=A?At(A.a,A.b,L):null,$=D?At(D.a,D.b,L):null,H={options:i,swapOrder:a,A:{isPoint:l.isPoint,target:l.target,isExact:l.isExact,arrowheadOffset:l.arrowheadOffset,minEndSegmentLength:l.minEndSegmentLength,original:l.bounds,expanded:b,edges:u,geometry:l.geometry},B:{isPoint:c.isPoint,target:c.target,isExact:c.isExact,arrowheadOffset:c.arrowheadOffset,minEndSegmentLength:c.minEndSegmentLength,original:c.bounds,expanded:v,edges:d,geometry:c.geometry},common:x,gapX:C,gapY:E,midX:z,midY:$},R=new zft(H),j=Cte(l,c,H.A.edges),B=Cte(c,l,H.B.edges);let K;return j&&B?K=Kft(R,j,B):j&&!B&&(K=Wft(R,j)),K||(K=Vft(R,j||B?"fallback":"auto")),K&&(Ete("first",H.A,H.B,K),Ete("last",H.B,H.A,K),Jft(K,l,c),a&&K.points.reverse()),{...H,route:K,midXRange:A?a?{lo:A.b,hi:A.a}:{lo:A.a,hi:A.b}:null,midYRange:D?a?{lo:D.b,hi:D.a}:{lo:D.a,hi:D.b}:null}}function qft(t,e){const n=t.swapOrder?t.B.target:t.A.target,r=t.swapOrder?t.A.target:t.B.target,i=M.ManhattanDist(e.points[0],e.points[1]),s=M.ManhattanDist(e.points[e.points.length-2],e.points[e.points.length-1]),o=M.ManhattanDist(n,e.points[1]),a=M.ManhattanDist(e.points[e.points.length-2],r),l=i-o,c=s-a,u=[n,...e.points,r];return{name:e.name,distance:e.distance+l+c,points:u.filter(d=>!e.skipPointsWhenDrawing.has(d)),aEdgePicking:e.aEdgePicking,bEdgePicking:e.bEdgePicking,skipPointsWhenDrawing:e.skipPointsWhenDrawing,midpointHandle:e.midpointHandle}}function Gft(t){return Nr(t.x,.5)&&Nr(t.y,.5)?null:Math.abs(t.x-.5)>Math.abs(t.y-.5)-1e-4?t.x<.5?"left":"right":t.y<.5?"top":"bottom"}function wte(t,e,n,r){const i=Sa[e.props.size]*e.props.scale/2,s=i*e.props.scale*3;if(n){const o=t.getShape(n.toId),a=Yft(t,e,n.toId,n.props);if(a&&o){let l=0;const c=n.props.terminal==="start"?"arrowheadStart":"arrowheadEnd";if(e.props[c]!=="none"){const h="scale"in o.props?o.props.scale:1,f="size"in o.props?(Sa[o.props.size]??0)*h/2:0;l=i+f+Pw*e.props.scale}let u=null;const d=a.target;return n.props.isPrecise&&(u=Gft(M.RotWith(n.props.normalizedAnchor,{x:.5,y:.5},a.shapeToArrowTransform.rotation()))),{targetShapeId:n.toId,isPoint:!1,isExact:n.props.isExact,bounds:a.bounds,geometry:a.geometry,target:d,arrowheadOffset:l,minEndSegmentLength:s,side:u,snap:n.props.snap}}}return{targetShapeId:null,bounds:Ee.FromCenter(r,{x:0,y:0}),geometry:null,isExact:!1,isPoint:!0,target:M.From(r),arrowheadOffset:0,minEndSegmentLength:s,side:null,snap:"none"}}function Yft(t,e,n,r){const i=r.terminal==="start"?e.props.arrowheadStart!=="none":e.props.arrowheadEnd!=="none",s=t.getShapeGeometry(n,i?void 0:{context:"@tldraw/arrow-without-arrowhead"});if(!s)return null;const o=t.getShapePageTransform(e.id),a=t.getShapePageTransform(n),l=o.clone().invert().multiply(a),c=s.transform(l),u={x:.5,y:.5},d=r.isPrecise?r.normalizedAnchor:u,h={x:At(s.bounds.minX,s.bounds.maxX,d.x),y:At(s.bounds.minY,s.bounds.maxY,d.y)},f={x:At(s.bounds.minX,s.bounds.maxX,u.x),y:At(s.bounds.minY,s.bounds.maxY,u.y)},y=xe.applyToPoint(l,h),b=xe.applyToPoint(l,f);return{bounds:c.bounds,geometry:c,target:y,center:b,shapeToArrowTransform:l}}const Xft={top:{expand:-1,main:"minY",opposite:"maxY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"max",crossAxis:"x"},bottom:{expand:1,main:"maxY",opposite:"minY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"min",crossAxis:"x"},left:{expand:-1,main:"minX",opposite:"maxX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"max",crossAxis:"y"},right:{expand:1,main:"maxX",opposite:"minX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"min",crossAxis:"y"}};function bs(t,e,n,r){const i=Xft[n],s=t.targetShapeId===e.targetShapeId&&t.targetShapeId!==null&&(t.snap==="edge"||t.snap==="edge-point")&&(e.snap==="edge"||e.snap==="edge-point"),o=t.bounds[i.main],a=t.isPoint?null:o+i.expand*r.expandElbowLegLength,l=SL(t.bounds[i.crossMin],t.bounds[i.crossMax]);let c=l;if(!c)return null;it(l);const u=SL(e.bounds[i.main],e.bounds[i.opposite]);e.isPoint||(u[i.bRangeExpand]-=r.minElbowLegLength*2*i.expand);const d=Lft(SL(e.bounds[i.crossMin],e.bounds[i.crossMax]),r.expandElbowLegLength);it(u&&d);let h=!1;if(EP(o,u)&&!t.isPoint&&!e.isPoint&&!s){const y=Fft(c,d);switch(y.length){case 0:return null;case 1:h=y[0]!==c,c=y[0];break;case 2:h=!0,c=vte(y[0])>vte(y[1])?y[0]:y[1];break;default:Yt(y)}}if(!EP(t.target[i.crossAxis],c))return null;const f=t.target[i.crossAxis];return{value:o,expanded:a,cross:c,crossTarget:f,isPartial:h}}function Ste(t,e){return e===null?!!(t.bottom||t.left||t.right||t.top):e==="x"?!!t.left||!!t.right:e==="y"?!!t.top||!!t.bottom:!!t[e]}function Cte(t,e,n){switch(t.side){case null:return null;case"x":return t.bounds.center.x>e.bounds.center.x&&(n!=null&&n.left)?"left":n!=null&&n.right?"right":null;case"y":return t.bounds.center.y>e.bounds.center.y&&(n!=null&&n.top)?"top":n!=null&&n.bottom?"bottom":null;default:return t.side}}function $b(t){if(t.isPoint)return t;let e=null,n=0;return(t.snap==="edge"||t.snap==="edge-point")&&(n=t.arrowheadOffset,(t.side==="x"||t.side==="left"||t.side==="right")&&(e="x"),(t.side==="y"||t.side==="top"||t.side==="bottom")&&(e="y")),{targetShapeId:t.targetShapeId,side:e,bounds:new Ee(t.target.x,t.target.y,0,0),geometry:t.geometry,target:t.target,arrowheadOffset:n,minEndSegmentLength:t.minEndSegmentLength,isExact:t.isExact,isPoint:!0,snap:t.snap}}function Ete(t,e,n,r){if(!e.geometry)return;const i=t==="first"?r.points[0]:r.points[r.points.length-1],s=t==="first"?r.points[1]:r.points[r.points.length-2],o=e.geometry.isClosed?s:e.target,a=M.ManhattanDist(i,o);let l=null,c=1/0;if(e.isExact)l=e.target;else if(e.geometry){const u=e.geometry.intersectLineSegment(s,e.target,{includeLabels:!1,includeInternal:!1});e.geometry.hitTestPoint(e.target,Math.max(1,e.arrowheadOffset),!0,fu.EXCLUDE_NON_STANDARD)&&u.push(e.target);for(const d of u){const h=M.ManhattanDist(o,d);h<c&&(c=h,l=d)}}if(l){let u=e.arrowheadOffset;const d=M.ManhattanDist(s,l),h=e.arrowheadOffset*2;if(d<h){const v=h-e.arrowheadOffset;u=d-v}u<e.minEndSegmentLength&&(e.geometry.bounds.containsPoint(n.target)?u=Math.max(0,u):u=-e.arrowheadOffset);let f=l,y=!1;if(!e.isExact&&u!==0){const v=M.Nudge(l,s,u);f=v,u<0&&!e.geometry.hitTestPoint(v,0,!0,fu.EXCLUDE_NON_STANDARD)?f=l:(u<0&&(y=!0),f=v)}const b=M.ManhattanDist(s,f);if(r.distance+=b-a,i.x=f.x,i.y=f.y,y){const v=M.Lrp(s,i,.5);r.skipPointsWhenDrawing.add(v),r.points.splice(t==="first"?1:r.points.length-1,0,v)}}}function Jft(t,e,n){if(t){if(t.points.length>=3){const r=t.points[0],i=t.points[1];if(M.ManhattanDist(r,i)<e.minEndSegmentLength&&(t.points.splice(1,1),t.points.length>=3)){const o=Nr(r.x,i.x)?"y":"x";t.points[1][o]=r[o]}}if(t.points.length>=3){const r=t.points[t.points.length-1],i=t.points[t.points.length-2];if(M.ManhattanDist(r,i)<n.minEndSegmentLength&&(t.points.splice(t.points.length-2,1),t.points.length>=3)){const o=Nr(r.x,i.x)?"y":"x";t.points[t.points.length-2][o]=r[o]}}}}function Tte(t,e,n){if(!t.geometry||t.geometry.isClosed)return t;const r=t.geometry.uninterpolateAlongEdge(t.target,fu.EXCLUDE_NON_STANDARD),i=t.geometry.interpolateAlongEdge(r-.01/t.geometry.length),o=t.geometry.interpolateAlongEdge(r+.01/t.geometry.length).sub(i).per().uni(),a=Math.abs(o.x)>Math.abs(o.y)?Iw.x:Iw.y;if(t.geometry.bounds.containsPoint(e.target,n.expandElbowLegLength))return t.side=a.self,$b(t);const l=a.v(t.target[a.self]-t.bounds[a.size]*2,t.target[a.cross]),c=a.v(t.target[a.self]+t.bounds[a.size]*2,t.target[a.cross]);let u=null,d=0,h=null,f=0,y=a.self;for(const b of t.geometry.intersectLineSegment(l,c,fu.EXCLUDE_NON_STANDARD))Math.abs(b[a.self]-t.target[a.self])<1||(b[a.self]<t.target[a.self]?M.ManhattanDist(b,t.target)>d&&(d=M.ManhattanDist(b,t.target),u=b):M.ManhattanDist(b,t.target)>f&&(f=M.ManhattanDist(b,t.target),h=b));return u&&h?d>f?y=a.hiEdge:y=a.loEdge:u&&!h?y=a.hiEdge:!u&&h&&(y=a.loEdge),t.side=y,t}const Zft=8;function Qft(t){return t.props.kind!=="arc"?!1:Math.abs(t.props.bend)<Zft*t.props.scale}function TP(t,e,n){const r=t.getBindingsFromShape(e,"arrow").find(l=>l.props.terminal===n);if(!r)return;const i=t.getShape(r.toId);if(!i)return;const s=t.getShapePageTransform(i),o=n==="start"?e.props.arrowheadStart!=="none":e.props.arrowheadEnd!=="none",a=t.getShapeGeometry(i,o?void 0:{context:"@tldraw/arrow-without-arrowhead"});return{shape:i,transform:s,isClosed:a.isClosed,isExact:r.props.isExact,didIntersect:!1,geometry:a}}function Ite(t,e,n,r){const i=t.getShape(n.toId);if(i){const{point:s,size:o}=t.getShapeGeometry(i).bounds,a=M.Add(s,M.MulV(n.props.isPrecise||r?n.props.normalizedAnchor:{x:.5,y:.5},o)),l=xe.applyToPoint(t.getShapePageTransform(i),a);return xe.applyToPoint(xe.Inverse(e),l)}else return new M(0,0)}const ept=_k("arrow bindings",(t,e)=>{const n=t.getBindingsFromShape(e.id,"arrow");return{start:n.find(r=>r.props.terminal==="start"),end:n.find(r=>r.props.terminal==="end")}},{areRecordsEqual:(t,e)=>t.id===e.id,areResultsEqual:(t,e)=>t.start===e.start&&t.end===e.end});function wi(t,e){return ept.get(t,e.id)}const tpt=_k("arrow info",(t,e)=>{const n=wi(t,e);if(e.props.kind==="elbow"){const r=cwe(t,e,n);if(!(r!=null&&r.route))return CP(t,e,n);const i=r.swapOrder?r.B:r.A,s=r.swapOrder?r.A:r.B;return{type:"elbow",bindings:n,start:{handle:i.target,point:r.route.points[0],arrowhead:e.props.arrowheadStart},end:{handle:s.target,point:r.route.points[r.route.points.length-1],arrowhead:e.props.arrowheadEnd},elbow:r,route:r.route,isValid:!0}}return Qft(e)?CP(t,e,n):Dft(t,e,n)},{areRecordsEqual:(t,e)=>t.props===e.props,areResultsEqual:tWe});function vl(t,e){const n=typeof e=="string"?e:e.id;return tpt.get(t,n)}function ry(t,e,n){var a,l;const r=t.getShapePageTransform(e),i=c9(t,(a=n.start)==null?void 0:a.toId,(l=n.end)==null?void 0:l.toId),s=n.start?Ite(t,r,n.start,i==="double-bound"||i==="start-contains-end"):M.From(e.props.start),o=n.end?Ite(t,r,n.end,i==="double-bound"||i==="end-contains-start"):M.From(e.props.end);return{start:s,end:o}}function ub(t,e,n,r){const i=typeof e=="string"?e:e.id,s=typeof n=="string"?n:n.id,o=t.getBindingsFromShape(i,"arrow").filter(l=>l.props.terminal===r.terminal);o.length>1&&t.deleteBindings(o.slice(1));const a=o[0];a?t.updateBinding({...a,toId:s,props:r}):t.createBinding({type:"arrow",fromId:i,toId:s,props:r})}function Bb(t,e,n){const r=t.getBindingsFromShape(e,"arrow").filter(i=>i.props.terminal===n);t.deleteBindings(r)}const iy=10,Pw=10,npt=10,Sa={s:2,m:3.5,l:5,xl:10};function c9(t,e,n){if(!e||!n)return"safe";if(e===n)return"double-bound";const r=t.getShapePageBounds(e),i=t.getShapePageBounds(n);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}class rT extends XE{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5},snap:"none"}}onAfterCreate({binding:e}){const n=this.editor.getShape(e.fromId);n&&CL(this.editor,n)}onAfterChange({bindingAfter:e}){const n=this.editor.getShape(e.fromId);n&&CL(this.editor,n)}onAfterChangeFromShape({shapeAfter:e}){CL(this.editor,e)}onAfterChangeToShape({binding:e,shapeBefore:n,shapeAfter:r,reason:i}){i!=="ancestry"&&n.parentId===r.parentId&&n.index===r.index||uwe(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const n=this.editor.getShape(e.fromId);n&&IP({editor:this.editor,arrow:n,terminal:e.props.terminal})}}N(rT,"type","arrow"),N(rT,"props",she),N(rT,"migrations",ohe);function uwe(t,e){var v;const n=t.getShape(e);if(!n)return;const r=wi(t,n),{start:i,end:s}=r,o=i?t.getShape(i.toId):void 0,a=s?t.getShape(s.toId):void 0,l=t.getAncestorPageId(n);if(!l)return;let c;if(o&&a)c=t.findCommonAncestor([o,a])??l;else if(o||a){const x=(v=o||a)==null?void 0:v.parentId;x&&x===n.parentId?c=n.parentId:c=l}else return;c&&c!==n.parentId&&t.reparentShapes([e],c);const u=t.getShape(e);if(!u)throw Error("no reparented arrow");const d=t.getShapeNearestSibling(u,o),h=t.getShapeNearestSibling(u,a);let f;if(d&&h)f=d.index>h.index?d:h;else if(d&&!h)f=d;else if(h&&!d)f=h;else return;let y;const b=t.getSortedChildIdsForParent(f.parentId).map(x=>t.getShape(x)).filter(x=>x.index>f.index);if(b.length){const x=b.find(C=>C.type!=="arrow");if(u.index>f.index&&(!x||u.index<x.index))return;y=By(f.index,b[0].index)}else y=ac(f.index);y!==u.index&&t.updateShapes([{id:e,type:"arrow",index:y}])}function CL(t,e){const n=wi(t,e);for(const r of["start","end"]){const i=n[r];if(!i)continue;const s=t.getShape(i.toId),o=t.getAncestorPageId(e)===t.getAncestorPageId(s);(!s||!o)&&IP({editor:t,arrow:e,terminal:r,unbind:!0})}uwe(t,e.id)}function IP({editor:t,arrow:e,terminal:n,unbind:r=!1,useHandle:i=!1}){const s=vl(t,e);if(!s)throw new Error("expected arrow info");const o=i?s.start.handle:s.start.point,a=i?s.end.handle:s.end.point,l=n==="start"?o:a,c={id:e.id,type:"arrow",props:{[n]:{x:l.x,y:l.y},bend:e.props.bend}};if(s.type==="arc"){const u=n==="start"?o:s.start.handle,d=n==="end"?a:s.end.handle,h=M.Med(u,d),f=M.Sub(u,d).per().uni().mul(s.handleArc.radius*2*Math.sign(e.props.bend)),y=kS(s.handleArc.center,M.Add(h,f),s.handleArc.center,s.handleArc.radius);it((y==null?void 0:y.length)===1);const b=M.Dist(h,y[0])*Math.sign(e.props.bend);Nr(b,c.props.bend)||(c.props.bend=b)}t.updateShape(c),r&&Bb(t,e,n)}function rpt({children:t}){const e=re();return ie("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const r=e.getOnlySelectedShape();return r&&e.isShapeOfType(r,"note")}return!1},[e])?g.jsx("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:t}):null}const ipt=new zs;function gx(t){return ipt.get(t,()=>lr("arrowTarget",null))}function spt(t){return gx(t).get()}function u9(t){gx(t).set(null)}function BA({editor:t,pointInPageSpace:e,arrow:n,isPrecise:r,currentBinding:i,oppositeBinding:s}){const o=t.getShapeUtil("arrow");if(o.options.shouldIgnoreTargets(t))return gx(t).set(null),null;const a=o.options.shouldBeExact(t),l=n?n.props.kind:t.getStyleForNextShape(ow),c=t.getShapeAtPoint(e,{hitInside:!0,hitFrameInside:!0,margin:l==="elbow"?8:0,filter:B=>!B.isLocked&&t.canBindShapes({fromShape:n??opt,toShape:B,binding:"arrow"})});if(!c)return gx(t).set(null),null;const u=t.getShapeGeometry(c),d=Ee.ZeroFix(u.bounds),h=u.center,f=t.getShapePageTransform(c),y=t.getPointInShapeSpace(c,e),b=Math.max(u.bounds.width,u.bounds.height),v=Mf(Nft,(B,K)=>{const G=Iw[jft[B]],V=M.Mul(K,b).add(h);let W=!1,Z=G.v(d[B],d[G.crossMid]),U=0;const J=u.intersectLineSegment(h,V,fu.EXCLUDE_NON_STANDARD);for(const _e of J){const fe=M.Dist2(_e,h);fe>U&&(U=fe,Z=_e,W=u.isClosed)}return{point:f.applyToPoint(Z),isEnabled:W,far:f.applyToPoint(V)}}),x=t.getZoomLevel(),C=o.options.minElbowHandleDistance/x,E=f.applyToPoint(h);for(const B of sx(v)){const K=v[B];M.DistMin(K.point,E,C)&&(K.isEnabled=!1)}let I=r||a;I||(!i||i&&c.id!==i.toId)&&(I=t.inputs.pointerVelocity.len()<.5),r||(u.isClosed||(I=!0),s&&c.id===s.toId&&s.props.isPrecise&&(I=!0));const P=!a&&I&&u.isClosed,_=!a&&(I&&l==="elbow"||!u.isClosed),A=!a&&I&&l==="elbow"&&u.isClosed,D=I&&(u.isClosed||a),L=!a&&I&&l==="elbow"&&u.isClosed;let z="none",$=e;if(D||(z="center",$=E),_){const B=D?hE(t,d,o.options.elbowArrowEdgeSnapDistance):1/0,K=u.nearestPoint(y,{includeLabels:!1,includeInternal:!1}),G=f.applyToPoint(K);M.Dist(G,e)<B&&(z="edge",$=G)}if(L){const B=hE(t,d,o.options.elbowArrowAxisSnapDistance),K=M.DistanceToLineSegment(v.left.far,v.right.far,e),G=M.DistanceToLineSegment(v.top.far,v.bottom.far,e),V=K<G&&K<B?"x":G<B?"y":null;if(V){const W=Iw[V],Z=M.Dist2(v[W.loEdge].far,e),U=M.Dist2(v[W.hiEdge].far,e),J=Z<U?W.loEdge:W.hiEdge;v[J].isEnabled&&(z="edge-point",$=v[J].point)}}if(A){const B=hE(t,d,o.options.elbowArrowPointSnapDistance);let K=null,G=1/0;for(const[V,W]of ho(v)){if(!W.isEnabled)continue;const Z=M.Dist(W.point,e);Z<B&&Z<G&&(G=Z,K=V)}K&&(z="edge-point",$=v[K].point)}if(P){const B=hE(t,d,l==="elbow"?o.options.elbowArrowCenterSnapDistance:o.options.arcArrowCenterSnapDistance);M.Dist(y,d.center)<B&&(z="center",$=E)}const H=t.getPointInShapeSpace(c,$),R={x:iw(d.minX,d.maxX,H.x),y:iw(d.minY,d.maxY,H.y)},j={target:c,arrowKind:l,handlesInPageSpace:v,centerInPageSpace:E,anchorInPageSpace:$,isExact:a,isPrecise:I,snap:z,normalizedAnchor:R};return gx(t).set(j),j}const opt={type:"arrow"};function hE(t,e,n){return Ct(Math.min(e.width,e.height)*.15,4,n)/t.getZoomLevel()}function apt(){const t=re();return ie("should show arrow hints",()=>{if(t.isInAny("arrow.idle","arrow.pointing"))return!0;if(t.isIn("select.pointing_handle")){const n=t.getStateDescendant("select.pointing_handle");if(n.info.shape.type==="arrow"&&(n.info.handle.id==="start"||n.info.handle.id==="end"))return!0}if(t.isIn("select.dragging_handle")){const n=t.getStateDescendant("select.dragging_handle");if(n.info.shape.type==="arrow"&&(n.info.handle.id==="start"||n.info.handle.id==="end"))return!0}return!1},[t])?g.jsx(lpt,{}):null}function lpt(){const t=re(),{ShapeIndicator:e}=Cn(),n=ie("arrow target info",()=>spt(t),[t]);if(!n)return null;const{handlesInPageSpace:r,snap:i,anchorInPageSpace:s,arrowKind:o,isExact:a,isPrecise:l}=n,c=!a&&o==="elbow";return g.jsxs(g.Fragment,{children:[e&&g.jsx(e,{shapeId:n.target.id}),c&&g.jsxs("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[g.jsx("circle",{cx:s.x,cy:s.y,className:`tl-arrow-hint-snap tl-arrow-hint-snap__${l?i??"none":"none"}`}),Object.entries(r).map(([u,d])=>d.isEnabled?g.jsx("circle",{cx:d.point.x,cy:d.point.y,className:"tl-arrow-hint-handle"},u):null)]})]})}const{PI:cpt}=Math,xy=cpt+1e-4;function dwe(t,e={}){const{size:n=16,smoothing:r=.5}=e;if(t.length===0||n<=0)return{left:[],right:[]};const i=t[0],s=t[t.length-1],o=s.runningLength,a=Math.pow(n*r,2),l=[],c=[];let u=t[0].vector,d=t[0].point,h=d,f=d,y=h,b=!1,v;for(let x=0;x<t.length;x++){v=t[x];const{point:C,vector:E}=t[x],I=v.vector.dpr(u),P=(x<t.length-1?t[x+1]:t[x]).vector,_=x<t.length-1?P.dpr(v.vector):1,A=I<0&&!b,D=_!==null&&_<.2;if(A||D){if(_>-.62&&o-v.runningLength>v.radius){const z=u.clone().mul(v.radius);u.clone().cpr(P)<0?(f=M.Add(C,z),y=M.Sub(C,z)):(f=M.Sub(C,z),y=M.Add(C,z)),l.push(f),c.push(y)}else{const z=u.clone().mul(v.radius).per(),$=M.Sub(v.input,z);for(let H=1/13,R=0;R<1;R+=H)f=M.RotWith($,v.input,xy*R),l.push(f),y=M.RotWith($,v.input,xy+xy*-R),c.push(y)}d=f,h=y,D&&(b=!0);continue}if(b=!1,v===i||v===s){const z=M.Per(E).mul(v.radius);l.push(M.Sub(C,z)),c.push(M.Add(C,z));continue}const L=M.Lrp(P,E,_).per().mul(v.radius);f=M.Sub(C,L),(x<=1||M.Dist2(d,f)>a)&&(l.push(f),d=f),y=M.Add(C,L),(x<=1||M.Dist2(h,y)>a)&&(c.push(y),h=y),u=E}return{left:l,right:c}}function hwe(t,e={}){const{size:n=16,start:r={},end:i={},last:s=!1}=e,{cap:o=!0}=r,{cap:a=!0}=i;if(t.length===0||n<=0)return[];const l=t[0],c=t[t.length-1],u=c.runningLength,d=r.taper===!1?0:r.taper===!0?Math.max(n,u):r.taper,h=i.taper===!1?0:i.taper===!0?Math.max(n,u):i.taper,{left:f,right:y}=dwe(t,e),b=l.point,v=t.length>1?t[t.length-1].point:M.AddXY(l.point,1,1);if(t.length===1&&(!(d||h)||s)){const I=M.Add(b,M.Sub(b,v).uni().per().mul(-l.radius)),P=[];for(let _=1/13,A=_;A<=1;A+=_)P.push(M.RotWith(I,b,xy*2*A));return P}const x=[];if(!(d||h&&t.length===1))if(o)for(let I=1/8,P=I;P<=1;P+=I){const _=M.RotWith(y[0],b,xy*P);x.push(_)}else{const I=M.Sub(f[0],y[0]),P=M.Mul(I,.5),_=M.Mul(I,.51);x.push(M.Sub(b,P),M.Sub(b,_),M.Add(b,_),M.Add(b,P))}const C=[],E=c.vector.clone().per().neg();if(h||d&&t.length===1)C.push(v);else if(a){const I=M.Add(v,M.Mul(E,c.radius));for(let P=1/29,_=P;_<1;_+=P)C.push(M.RotWith(I,v,xy*3*_))}else C.push(M.Add(v,M.Mul(E,c.radius)),M.Add(v,M.Mul(E,c.radius*.99)),M.Sub(v,M.Mul(E,c.radius*.99)),M.Sub(v,M.Mul(E,c.radius)));return f.concat(C,y.reverse(),x)}const upt=.025,dpt=.01;function bf(t,e={}){var v;const{streamline:n=.5,size:r=16,simulatePressure:i=!1}=e;if(t.length===0)return[];const s=.15+(1-n)*.85;let o=t.map(M.From),a=0;if(!i){let x=o[0];for(;x&&!(x.z>=upt);)o.shift(),x=o[0]}if(!i){let x=o[o.length-1];for(;x&&!(x.z>=dpt);)o.pop(),x=o[o.length-1]}if(o.length===0)return[{point:M.From(t[0]),input:M.From(t[0]),pressure:i?.5:.15,vector:new M(1,1),distance:0,runningLength:0,radius:1}];let l=o[1];for(;l&&!(M.Dist2(l,o[0])>(r/3)**2);)o[0].z=Math.max(o[0].z,l.z),o.splice(1,1),l=o[1];const c=o.pop();for(l=o[o.length-1];l&&!(M.Dist2(l,c)>(r/3)**2);)o.pop(),l=o[o.length-1],a++;o.push(c);const u=e.last||!e.simulatePressure||o.length>1&&M.Dist2(o[o.length-1],o[o.length-2])<r**2||a>0;if(o.length===2&&e.simulatePressure){const x=o[1];o=o.slice(0,-1);for(let C=1;C<5;C++){const E=M.Lrp(o[0],x,C/4);E.z=(o[0].z+(x.z-o[0].z))*C/4,o.push(E)}}const d=[{point:o[0],input:o[0],pressure:i?.5:o[0].z,vector:new M(1,1),distance:0,runningLength:0,radius:1}];let h=0,f=d[0],y,b;u&&n>0&&o.push(o[o.length-1].clone());for(let x=1,C=o.length;x<C;x++)y=!s||e.last&&x===C-1?o[x].clone():o[x].clone().lrp(f.point,1-s),!f.point.equals(y)&&(b=M.Dist(y,f.point),h+=b,!(x<4&&h<r)&&(f={input:o[x],point:y,pressure:i?.5:o[x].z,vector:M.Sub(f.point,y).uni(),distance:b,runningLength:h,radius:1},d.push(f)));if((v=d[1])!=null&&v.vector&&(d[0].vector=d[1].vector.clone()),h<1){const x=Math.max(.5,...d.map(C=>C.pressure));d.forEach(C=>C.pressure=x)}return d}const{min:Sh}=Math,EL=.275;function d9(t,e){const{size:n=16,thinning:r=.5,simulatePressure:i=!0,easing:s=v=>v,start:o={},end:a={}}=e,{easing:l=Ms.easeOutQuad}=o,{easing:c=Ms.easeOutCubic}=a,u=t[t.length-1].runningLength;let d,h=t[0].pressure,f;if(!i&&u<n){const v=t.reduce((x,C)=>Math.max(x,C.pressure),.5);return t.forEach(x=>{x.pressure=v,x.radius=n*s(.5-r*(.5-x.pressure))}),t}else{let v;for(let x=0,C=t.length;x<C&&(f=t[x],!(f.runningLength>n*5));x++){const E=Sh(1,f.distance/n);if(i){const I=Sh(1,1-E);v=Sh(1,h+(I-h)*(E*EL))}else v=Sh(1,h+(f.pressure-h)*.5);h=h+(v-h)*.5}for(let x=0;x<t.length;x++){if(f=t[x],r){let{pressure:C}=f;const E=Sh(1,f.distance/n);if(i){const I=Sh(1,1-E);C=Sh(1,h+(I-h)*(E*EL))}else C=Sh(1,h+(C-h)*(E*EL));f.radius=n*s(.5-r*(.5-C)),h=C}else f.radius=n/2;d===void 0&&(d=f.radius)}}const y=o.taper===!1?0:o.taper===!0?Math.max(n,u):o.taper,b=a.taper===!1?0:a.taper===!0?Math.max(n,u):a.taper;if(y||b)for(let v=0;v<t.length;v++){f=t[v];const{runningLength:x}=f,C=x<y?l(x/y):1,E=u-x<b?c((u-x)/b):1;f.radius=Math.max(.01,f.radius*Math.min(C,E))}return t}function hpt(t,e={}){return hwe(d9(bf(t,e),e),e)}function Pte({scribble:t,zoom:e,color:n,opacity:r,className:i}){if(!t.points.length)return null;const s=hpt(t.points,{size:t.size/e,start:{taper:t.taper,easing:Ms.linear},last:t.state==="stopping",simulatePressure:!1,streamline:.32});let o;if(s.length<4){const a=t.size/e/2,{x:l,y:c}=t.points[t.points.length-1];o=`M ${l-a},${c} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else o=xme(s);return g.jsx("svg",{className:i&&nt("tl-overlays__item",i),children:g.jsx("path",{className:"tl-scribble",d:o,fill:n??`var(--color-${t.color})`,opacity:r??t.opacity})})}function fpt({size:t,width:e,height:n,hideAlternateHandles:r}){const i=te(t/3),s=i/2,o=et();return g.jsxs("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${te(0-s)},${te(t)} 
						${te(0-s)},${te(0-s)} 
						${te(t)},${te(0-s)}`,strokeWidth:i,"data-testid":"selection.crop.top_left",role:"button","aria-label":o("handle.crop.top-left")}),g.jsx("line",{className:nt("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:te(e/2-t),y1:te(0-s),x2:te(e/2+t),y2:te(0-s),strokeWidth:i,"data-testid":"selection.crop.top",role:"button","aria-label":o("handle.crop.top")}),g.jsx("polyline",{className:nt("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${te(e-t)},${te(0-s)} 
						${te(e+s)},${te(0-s)} 
						${te(e+s)},${te(t)}`,strokeWidth:i,"data-testid":"selection.crop.top_right",role:"button","aria-label":o("handle.crop.top-right")}),g.jsx("line",{className:nt("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:te(e+s),y1:te(n/2-t),x2:te(e+s),y2:te(n/2+t),strokeWidth:i,"data-testid":"selection.crop.right",role:"button","aria-label":o("handle.crop.right")}),g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${te(e+s)},${te(n-t)} 
						${te(e+s)},${te(n+s)}
						${te(e-t)},${te(n+s)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right",role:"button","aria-label":o("handle.crop.bottom-right")}),g.jsx("line",{className:nt("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:te(e/2-t),y1:te(n+s),x2:te(e/2+t),y2:te(n+s),strokeWidth:i,"data-testid":"selection.crop.bottom",role:"button","aria-label":o("handle.crop.bottom")}),g.jsx("polyline",{className:nt("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${te(0+t)},${te(n+s)} 
						${te(0-s)},${te(n+s)}
						${te(0-s)},${te(n-t)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left",role:"button","aria-label":o("handle.crop.bottom-left")}),g.jsx("line",{className:nt("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:te(0-s),y1:te(n/2-t),x2:te(0-s),y2:te(n/2+t),strokeWidth:i,"data-testid":"selection.crop.left",role:"button","aria-label":o("handle.crop.left")})]})}const ppt=Lr(function({bounds:e,rotation:n}){const r=re(),i=et(),s=S.useRef(null),o=Ka(),a=Gc("top"),l=Gc("right"),c=Gc("bottom"),u=Gc("left"),d=Gc("top_left"),h=Gc("top_right"),f=Gc("bottom_right"),y=Gc("bottom_left"),b=r.getInstanceState().cursor.type==="default",v=r.getInstanceState().isCoarsePointer,x=r.getOnlySelectedShape(),C=x&&r.isShapeOrAncestorLocked(x),E=x?r.getShapeUtil(x).expandSelectionOutlinePx(x):0,I=E instanceof Ee?e.clone().expand(E).zeroFix():e.clone().expandBy(E).zeroFix();if(IS(s,e==null?void 0:e.x,e==null?void 0:e.y,1,r.getSelectionRotation(),{x:I.x-e.x,y:I.y-e.y}),x&&r.isShapeHidden(x))return null;const P=r.getZoomLevel(),_=r.getInstanceState().isChangingStyle,A=I.width,D=I.height,L=8/P,z=A<L*2,$=D<L*2,H=A<L*4,R=D<L*4,j=A<L*5,B=D<L*5,K=v?1.75:1,G=6/P*K,V=(H?G/2:G)*(K*.75),W=(R?G/2:G)*(K*.75),Z=(x?!r.getShapeUtil(x).hideSelectionBoundsFg(x):!0)&&!_;let U=Z&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||Z&&r.isIn("select.resizing")&&x&&r.isShapeOfType(x,"text");x&&U&&sn.isFirefox&&r.isShapeOfType(x,"embed")&&(U=!1);const J=r.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!_&&!o,ge=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!_&&!o,_e=!v&&!(z||$)&&(ge||J)&&(x?!r.getShapeUtil(x).hideRotateHandle(x):!0)&&!C,fe=v&&(!H||!R)&&(ge||J)&&(x?!r.getShapeUtil(x).hideRotateHandle(x):!0)&&!C,je=ge&&(x?r.getShapeUtil(x).canResize(x)&&!r.getShapeUtil(x).hideResizeHandles(x):!0)&&!J&&!C,Ae=z||$,ke=z&&$,le=j||B,ve=je||J,qe=!_e,de=!ge||!fe,pe=!ge||!ve,Se=!ge||!ve||Ae,Fe=!ge||!ve||Ae,ut=!ge||!ve||ke&&!J;let Tt=!0,pn=!0;if(J)Tt=le,pn=le;else if(je){Tt=Ae||ke||v;const Yr=v&&x&&x.type==="text";pn=Tt&&!Yr}const qn=Math.min(24/P,D-W*3),ci=ge&&v&&x&&r.isShapeOfType(x,"text")&&qn*P>=4;return g.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground","aria-hidden":"true",children:g.jsxs("g",{ref:s,children:[U&&g.jsx("rect",{className:"tl-selection__fg__outline",width:te(A),height:te(D)}),g.jsx(fE,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:G,corner:"top_left_rotate",cursor:b?fa("nwse-rotate",n):void 0,isHidden:qe}),g.jsx(fE,{"data-testid":"selection.rotate.top-right",cx:A+G*3,cy:0,targetSize:G,corner:"top_right_rotate",cursor:b?fa("nesw-rotate",n):void 0,isHidden:qe}),g.jsx(fE,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:D+G*3,targetSize:G,corner:"bottom_left_rotate",cursor:b?fa("swne-rotate",n):void 0,isHidden:qe}),g.jsx(fE,{"data-testid":"selection.rotate.bottom-right",cx:A+G*3,cy:D+G*3,targetSize:G,corner:"bottom_right_rotate",cursor:b?fa("senw-rotate",n):void 0,isHidden:qe}),g.jsx(mpt,{"data-testid":"selection.rotate.mobile",cx:H?-G*1.5:A/2,cy:H?D/2:-G*1.5,size:L,isHidden:de}),g.jsx(Ch,{hide:Tt,dataTestId:"selection.resize.top",ariaLabel:i("handle.resize-top"),x:0,y:te(0-(R?W*2:W)),width:te(A),height:te(Math.max(1,W*2)),cursor:b?fa("ns-resize",n):void 0,events:a}),g.jsx(Ch,{hide:pn,dataTestId:"selection.resize.right",ariaLabel:i("handle.resize-right"),x:te(A-(H?0:V)),y:0,height:te(D),width:te(Math.max(1,V*2)),cursor:b?fa("ew-resize",n):void 0,events:l}),g.jsx(Ch,{hide:Tt,dataTestId:"selection.resize.bottom",ariaLabel:i("handle.resize-bottom"),x:0,y:te(D-(R?0:W)),width:te(A),height:te(Math.max(1,W*2)),cursor:b?fa("ns-resize",n):void 0,events:c}),g.jsx(Ch,{hide:pn,dataTestId:"selection.resize.left",ariaLabel:i("handle.resize-left"),x:te(0-(H?V*2:V)),y:0,height:te(D),width:te(Math.max(1,V*2)),cursor:b?fa("ew-resize",n):void 0,events:u}),g.jsx(Ch,{hide:pe,dataTestId:"selection.target.top-left",ariaLabel:i("handle.resize-top-left"),x:te(0-(H?V*2:V*1.5)),y:te(0-(R?W*2:W*1.5)),width:te(V*3),height:te(W*3),cursor:b?fa("nwse-resize",n):void 0,events:d}),g.jsx(Ch,{hide:Se,dataTestId:"selection.target.top-right",ariaLabel:i("handle.resize-top-right"),x:te(A-(H?0:V*1.5)),y:te(0-(R?W*2:W*1.5)),width:te(V*3),height:te(W*3),cursor:b?fa("nesw-resize",n):void 0,events:h}),g.jsx(Ch,{hide:ut,dataTestId:"selection.target.bottom-right",ariaLabel:i("handle.resize-bottom-right"),x:te(A-(H?V:V*1.5)),y:te(D-(R?W:W*1.5)),width:te(V*3),height:te(W*3),cursor:b?fa("nwse-resize",n):void 0,events:f}),g.jsx(Ch,{hide:Fe,dataTestId:"selection.target.bottom-left",ariaLabel:i("handle.resize-bottom-left"),x:te(0-(H?V*3:V*1.5)),y:te(D-(R?0:W*1.5)),width:te(V*3),height:te(W*3),cursor:b?fa("nesw-resize",n):void 0,events:y}),je&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.resize.top-left",className:nt("tl-corner-handle",{"tl-hidden":pe}),x:te(0-L/2),y:te(0-L/2),width:te(L),height:te(L)}),g.jsx("rect",{"data-testid":"selection.resize.top-right",className:nt("tl-corner-handle",{"tl-hidden":Se}),x:te(A-L/2),y:te(0-L/2),width:te(L),height:te(L)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:nt("tl-corner-handle",{"tl-hidden":ut}),x:te(A-L/2),y:te(D-L/2),width:te(L),height:te(L)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:nt("tl-corner-handle",{"tl-hidden":Fe}),x:te(0-L/2),y:te(D-L/2),width:te(L),height:te(L)})]}),ci&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle",x:te(0-L/4),y:te(D/2-qn/2),rx:L/4,width:te(L/2),height:te(qn)}),g.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle",rx:L/4,x:te(A-L/4),y:te(D/2-qn/2),width:te(L/2),height:te(qn)})]}),J&&g.jsx(fpt,{size:L,width:A,height:D,hideAlternateHandles:le})]})})}),Ch=function({hide:e,dataTestId:n,ariaLabel:r,x:i,y:s,width:o,height:a,cursor:l,events:c}){return g.jsx("rect",{className:nt("tl-resize-handle","tl-transparent",{"tl-hidden":e}),"data-testid":n,role:"button","aria-label":r,pointerEvents:"all",x:i,y:s,width:o,height:a,cursor:l,...c})},fE=function({cx:e,cy:n,targetSize:r,corner:i,cursor:s,isHidden:o,"data-testid":a}){const l=Gc(i),u=et()(`handle.rotate.${i}`);return g.jsx("rect",{className:nt("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,role:"button","aria-label":u,pointerEvents:"all",x:te(e-r*3),y:te(n-r*3),width:te(Math.max(1,r*3)),height:te(Math.max(1,r*3)),cursor:s,...l})},gpt=Math.sqrt(Math.PI),mpt=function({cx:e,cy:n,size:r,isHidden:i,"data-testid":s}){const o=Gc("mobile_rotate"),a=re(),l=ie("zoom level",()=>a.getZoomLevel(),[a]),c=Math.max(14*(1/l),20/Math.max(1,l)),u=et();return g.jsxs("g",{role:"button","aria-label":u("handle.rotate.mobile_rotate"),children:[g.jsx("circle",{"data-testid":s,pointerEvents:"all",className:nt("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:e,cy:n,r:c,...o}),g.jsx("circle",{className:nt("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:e,cy:n,r:r/gpt})]})};function ypt(){const t=re(),e=ie("is in a valid select state",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[t]);return g.jsx(wme,{hideAll:!e})}const fwe=[rT],_te=8;function dc(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}const vpt=["original","square","circle","landscape","portrait","wide"],Y$={original:0,square:1,circle:1,landscape:4/3,portrait:3/4,wide:16/9};function Ec(t,e){if(!e)return{w:t.w,h:t.h};const n=t.w/(e.bottomRight.x-e.topLeft.x),r=t.h/(e.bottomRight.y-e.topLeft.y);return{w:n,h:r}}function zA(t){return{width:t.bottomRight.x-t.topLeft.x,height:t.bottomRight.y-t.topLeft.y}}function h9(t){const{width:e,height:n}=zA(t);return{x:t.topLeft.x+e/2,y:t.topLeft.y+n/2}}function f9(t,e,n,r,i){const s=Math.max(0,Math.min(1-n,t-n/2)),o=Math.max(0,Math.min(1-r,e-r/2));return{topLeft:{x:s,y:o},bottomRight:{x:s+n,y:o+r},isCircle:i}}function bpt(t,e,n={}){const{handle:r,change:i,crop:s,aspectRatioLocked:o}=e,{w:a,h:l}=e.uncroppedSize,{minWidth:c=_te,minHeight:u=_te}=n;if(a<c||l<u||i.x===0&&i.y===0)return;const d=new Ee(s.topLeft.x*a,s.topLeft.y*l,(s.bottomRight.x-s.topLeft.x)*a,(s.bottomRight.y-s.topLeft.y)*l),h=d.aspectRatio,f=d.clone();if(r==="top_left"||r==="bottom_left"||r==="left")f.x=Ct(f.x+i.x,0,d.maxX-c),f.w=d.maxX-f.x;else if(r==="top_right"||r==="bottom_right"||r==="right"){const v=Ct(f.maxX+i.x,d.x+c,a);f.w=v-f.x}if(r==="top_left"||r==="top_right"||r==="top")f.y=Ct(f.y+i.y,0,d.maxY-u),f.h=d.maxY-f.y;else if(r==="bottom_left"||r==="bottom_right"||r==="bottom"){const v=Ct(f.maxY+i.y,d.y+u,l);f.h=v-f.y}if(o)switch(f.aspectRatio>h?f.h=f.w/h:f.w=f.h*h,r){case"top_left":{f.x=d.maxX-f.w,f.y=d.maxY-f.h,f.x<=0&&(f.x=0,f.w=d.maxX-f.x,f.h=f.w/h,f.y=d.maxY-f.h),f.y<=0&&(f.y=0,f.h=d.maxY-f.y,f.w=f.h*h,f.x=d.maxX-f.w);break}case"top_right":{f.x=d.x,f.y=d.maxY-f.h,f.maxX>=a&&(f.w=a-d.x,f.h=f.w/h,f.y=d.maxY-f.h),f.y<=0&&(f.y=0,f.h=d.maxY-f.y,f.w=f.h*h);break}case"bottom_left":{f.x=d.maxX-f.w,f.y=d.y,f.x<=0&&(f.x=0,f.w=d.maxX-f.x,f.h=f.w/h),f.maxY>=l&&(f.h=l-d.y,f.w=f.h*h,f.x=d.maxX-f.w);break}case"bottom_right":{f.x=d.x,f.y=d.y,f.maxX>=a&&(f.w=a-d.x,f.h=f.w/h),f.maxY>=l&&(f.h=l-d.y,f.w=f.h*h);break}case"top":{if(f.h=d.maxY-f.y,f.w=f.h*h,f.x-=(f.w-d.w)/2,f.x<=0){const x=d.midX;f.w=x*2,f.h=f.w/h,f.x=0}if(f.maxX>=a){const x=a-d.midX;f.w=x*2,f.h=f.w/h,f.x=a-f.w}f.y=d.maxY-f.h;break}case"right":{if(f.w=f.maxX-d.x,f.h=f.w/h,f.y-=(f.h-d.h)/2,f.y<=0){const x=d.midY;f.h=x*2,f.w=f.h*h,f.y=0}if(f.maxY>=l){const x=l-d.midY;f.h=x*2,f.w=f.h*h,f.y=l-f.h}break}case"bottom":{if(f.h=f.maxY-d.y,f.w=f.h*h,f.x-=(f.w-d.w)/2,f.x<=0){const x=d.midX;f.w=x*2,f.h=f.w/h,f.x=0}if(f.maxX>=a){const x=a-d.midX;f.w=x*2,f.h=f.w/h,f.x=a-f.w}break}case"left":{if(f.w=d.maxX-f.x,f.h=f.w/h,f.y-=(f.h-d.h)/2,f.y<=0){const x=d.midY;f.h=x*2,f.w=f.h*h,f.y=0}if(f.maxY>=l){const x=l-d.midY;f.h=x*2,f.w=f.h*h,f.y=l-f.h}f.x=d.maxX-f.w;break}}const y={topLeft:{x:f.x/a,y:f.y/l},bottomRight:{x:f.maxX/a,y:f.maxY/l},isCircle:s.isCircle};if(y.topLeft.x===s.topLeft.x&&y.topLeft.y===s.topLeft.y&&y.bottomRight.x===s.bottomRight.x&&y.bottomRight.y===s.bottomRight.y)return;const b=new M(f.x-s.topLeft.x*a,f.y-s.topLeft.y*l).rot(t.rotation).add(t);return{id:t.id,type:t.type,x:b.x,y:b.y,props:{w:f.w,h:f.h,crop:y}}}function xpt(t,e,n,r=!0,i=!1){const{w:s,h:o}=Ec(t.props,t.props.crop??dc()),a=t.props.crop||dc(),l=t.x+t.props.w/2,c=t.y+t.props.h/2;let u,d;if(r){const{x:b,y:v}=h9(a);u=b,d=v}else u=.5,d=.5;const h=f9(u,d,e,n,i),f=e*s,y=n*o;return{crop:h,w:f,h:y,x:l-f/2,y:c-y/2}}const zo=3;function wpt(t,e,n){const r=e.props.crop||dc(),{width:i,height:s}=zA(r),o=i/s,a=n?1/(1-n):zo,l=1+t*(a-1);let c,u;o>1?(c=Math.min(1,1/l),u=c/o):(u=Math.min(1,1/l),c=u*o);const d=xpt(e,c,u,!0,r.isCircle),h=Math.min(zo,i/c);d.w*=h,d.h*=h;const f=e.x+e.props.w/2,y=e.y+e.props.h/2;return d.x=f-d.w/2,d.y=y-d.h/2,d}function Spt(t,e,n){const r=dc(),i=t.props.crop||r,s=t.props.w,o=t.props.h,a=e/n;let l=r,c=s,u=o;if(Af(t.props.crop,r))c=s,u=s*n/e;else{const{w:v,h:x}=Ec(t.props,t.props.crop||dc()),{width:C,height:E}=zA(i),I=C/E,P=v/x;let _,A;const D=h9(i);_=C;const L=a/P/I;A=_*L;const z=zo/(zo-1);if(L>z){const $=1/zo;if(1/A<1/_){const H=A/$;A=A/H,_=_/H}else{const H=_/$;_=_/H,A=A/H}}_=Math.max(0,Math.min(1,_)),A=Math.max(0,Math.min(1,A)),l=f9(D.x,D.y,_,A,i.isCircle)}const h=t.x+s/2,f=t.y+o/2,y=h-c/2,b=f-u/2;return{crop:l,w:c,h:u,x:y,y:b}}function Cpt(t,e){if(t==="original"){const{w:$,h:H}=Ec(e.props,e.props.crop??dc()),R=e.x+e.props.w/2,j=e.y+e.props.h/2;return{crop:dc(),w:$,h:H,x:R-$/2,y:j-H/2}}const n=Y$[t],r=t==="circle",{w:i,h:s}=Ec(e.props,e.props.crop||dc()),o=i/s,a=e.props.crop||dc(),{width:l,height:c}=zA(a),u=h9(a),d=Math.min(1/l,1/c);let h,f;if(o===0||!Number.isFinite(o)||n===0)h=1,f=1;else{const $=l*i,H=c*s,R=Math.max($,H),j=$>=H;let B,K;j?(B=R,K=B/n):(K=R,B=K*n),h=B/i,f=K/s,h>1&&(h=1,f=o/n),f>1&&(f=1,h=n/o),h=Math.max(0,Math.min(1,h)),f=Math.max(0,Math.min(1,f))}const y=Math.min(1/h,1/f);h*=y/d,f*=y/d,h=Math.max(0,Math.min(1,h)),f=Math.max(0,Math.min(1,f));const b=f9(u.x,u.y,h,f,r),v=b.bottomRight.x-b.topLeft.x,x=b.bottomRight.y-b.topLeft.y,C=v*i,E=x*s;let I=1;l>0?I=e.props.w/(l*i):c>0&&(I=e.props.h/(c*s));const P=C*I,_=E*I,A=e.x+e.props.w/2,D=e.y+e.props.h/2,L=A-P/2,z=D-_/2;return{crop:b,w:P,h:_,x:L,y:z}}const Ds={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},ri={s:2,m:3.5,l:5,xl:10},Qy={s:18,m:24,l:36,xl:44},uf={s:18,m:22,l:26,xl:32},Ept={s:18,m:20,l:24,xl:28},xf={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},Tpt=20,X$=4.25,ao=16;function Ipt(t,e){const n=t.w/e.w,r=t.h/e.h;return n<=1&&r<=1?t:n>r?{w:t.w/n,h:t.h/n}:{w:t.w/r,h:t.h/r}}async function Ppt(t,e,n){var x,C,E;const{elements:r,files:i}=e,s={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:t.store.schema.serialize()},o=new Map,a=new Map,l=t.getCurrentPageId(),c=new Map,u=[],d=new Set;r.forEach(I=>{if(c.set(I.id,Sn()),I.boundElements!==null)for(const P of I.boundElements)P.type==="text"&&d.add(P.id)});let h=Xue;for(const I of r){if(d.has(I.id))continue;const P=c.get(I.id),_={id:P,typeName:"shape",parentId:l,index:h,x:I.x,y:I.y,rotation:0,isLocked:I.locked,opacity:_pt(I.opacity),meta:{}};switch(I.angle!==0&&a.set(P,I.angle),I.groupIds&&I.groupIds.length>0?o.has(I.groupIds[0])?(x=o.get(I.groupIds[0]))==null||x.push(P):o.set(I.groupIds[0],[P]):u.push(P),I.type){case"rectangle":case"ellipse":case"diamond":{let A="",D="middle";if(I.boundElements!==null){for(const z of I.boundElements)if(z.type==="text"){const $=r.find(H=>H.id===z.id);$&&(A=$.text,D=Npt[$.textAlign])}}const L=I.backgroundColor==="transparent"?I.strokeColor:I.backgroundColor;s.shapes.push({..._,type:"geo",props:{geo:I.type,url:I.link??"",w:I.width,h:I.height,size:pE[I.strokeWidth]??"draw",color:db[L]??"black",richText:Dl(A),align:D,dash:gE(I),fill:Fpt(I)}});break}case"freedraw":{s.shapes.push({..._,type:"draw",props:{dash:gE(I),size:pE[I.strokeWidth],color:db[I.strokeColor]??"black",segments:[{type:"free",points:I.points.map(([A,D,L=.5])=>({x:A,y:D,z:L}))}]}});break}case"line":{if(I.points.slice().length<2)break;const D=sw(I.points.length);s.shapes.push({..._,type:"line",props:{dash:gE(I),size:pE[I.strokeWidth],color:db[I.strokeColor]??"black",spline:I.roundness?"cubic":"line",points:{...Object.fromEntries(I.points.map(([L,z],$)=>{const H=D[$];return[H,{id:H,index:H,x:L,y:z}]}))}}});break}case"arrow":{let A="";if(I.boundElements!==null){for(const H of I.boundElements)if(H.type==="text"){const R=r.find(j=>j.id===H.id);R&&(A=R.text)}}const D=I.points[0],L=I.points[I.points.length-1],z=c.get((C=I.startBinding)==null?void 0:C.elementId),$=c.get((E=I.endBinding)==null?void 0:E.elementId);s.shapes.push({..._,type:"arrow",props:{text:A,kind:I.elbowed?"elbow":"arc",bend:Lpt(I,D,L),dash:gE(I),size:pE[I.strokeWidth]??"m",color:db[I.strokeColor]??"black",start:{x:D[0],y:D[1]},end:{x:L[0],y:L[1]},arrowheadEnd:kte[I.endArrowhead]??"none",arrowheadStart:kte[I.startArrowhead]??"none"}}),z&&s.bindings.push({id:Vp(),typeName:"binding",type:"arrow",fromId:P,toId:z,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),$&&s.bindings.push({id:Vp(),typeName:"binding",type:"arrow",fromId:P,toId:$,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:A,scale:D}=Apt(I.fontSize);s.shapes.push({..._,type:"text",props:{size:A,scale:D,font:Mpt[I.fontFamily]??"draw",color:db[I.strokeColor]??"black",richText:Dl(I.text),textAlign:jpt[I.textAlign]}});break}case"image":{const A=i[I.fileId];if(!A)break;const D=Nf.createId();s.assets.push({id:D,typeName:"asset",type:"image",props:{w:I.width,h:I.height,fileSize:A.size,name:I.id??"Untitled",isAnimated:!1,mimeType:A.mimeType,src:A.dataURL},meta:{}}),s.shapes.push({..._,type:"image",props:{w:I.width,h:I.height,assetId:D}})}}h=ac(h)}const f=n??(t.inputs.shiftKey?t.inputs.currentPagePoint:void 0);t.putContentOntoCurrentPage(s,{point:f,select:!1,preserveIds:!0});for(const I of o.values())if(I.length>1){t.groupShapes(I);const P=t.getShape(I[0]);P!=null&&P.parentId&&io(P.parentId)&&u.push(P.parentId)}for(const[I,P]of a)t.select(I),t.rotateShapesBy([I],P);const y=bt(u.map(I=>t.getShape(I))),b=Ee.Common(y.map(I=>t.getShapePageBounds(I))),v=t.getViewportPageBounds().center;t.updateShapes(y.map(I=>{const P={x:(I.x??0)-(b.x+b.w/2),y:(I.y??0)-(b.y+b.h/2)};return{id:I.id,type:I.type,x:v.x+P.x,y:v.y+P.y}})),t.setSelectedShapes(u)}const _pt=t=>{const e=t/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},pE={1:"s",2:"m",3:"l",4:"xl"},kpt={16:"s",20:"m",28:"l",36:"xl"};function Apt(t){const e=kpt[t];return e?{size:e,scale:1}:t<16?{size:"s",scale:t/16}:t>36?{size:"xl",scale:t/36}:{size:"m",scale:1}}const Mpt={1:"draw",2:"sans",3:"mono"},Opt={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function Kc(t,e,n){const r=[0,1,2,3,4].map(i=>Opt[t][i]);return Object.fromEntries(r.map((i,s)=>[i,s<3?e:n]))}const db={...Kc("gray","grey","black"),...Kc("red","light-red","red"),...Kc("pink","light-red","red"),...Kc("grape","light-violet","violet"),...Kc("blue","light-blue","blue"),...Kc("cyan","light-blue","blue"),...Kc("teal","light-green","green"),...Kc("green","light-green","green"),...Kc("yellow","yellow","orange"),...Kc("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},Dpt={solid:"draw",dashed:"dashed",dotted:"dotted"},Rpt={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},Npt={left:"start",center:"middle",right:"end"},jpt={left:"start",center:"middle",right:"end"},kte={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function Lpt(t,e,n){let r=0;if(t.points.length>2){const i=new M(e[0],e[1]),s=new M(n[0],n[1]),o=new M(t.points[1][0],t.points[1][1]),a=M.Sub(s,i),l=M.Per(a),c=M.Med(s,i),u=M.Sub(c,l),d=M.Add(c,l),h=M.NearestPointOnLineSegment(u,d,o,!1);r=M.Dist(h,c),M.Clockwise(h,s,c)&&(r*=-1)}return r}const gE=t=>{let e=Dpt[t.strokeStyle]??"draw";return e==="draw"&&t.roughness===0&&(e="solid"),e},Fpt=t=>t.backgroundColor==="transparent"?"none":Rpt[t.fillStyle]??"solid",$pt=/(^|[^`])`([^`]+)`(?!`)/,Bpt=/(^|[^`])`([^`]+)`(?!`)/g,pwe=Su.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Ai(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[vg({find:$pt,type:this.type})]},addPasteRules(){return[mf({find:Bpt,type:this.type})]}}),zpt=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,Upt=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,gwe=Su.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",Ai(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[vg({find:zpt,type:this.type})]},addPasteRules(){return[mf({find:Upt,type:this.type})]}}),Hpt="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Vpt="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",J$="numeric",Z$="ascii",Q$="alpha",mx="asciinumeric",zb="alphanumeric",eB="domain",mwe="emoji",Wpt="scheme",Kpt="slashscheme",TL="whitespace";function qpt(t,e){return t in e||(e[t]=[]),e[t]}function Op(t,e,n){e[J$]&&(e[mx]=!0,e[zb]=!0),e[Z$]&&(e[mx]=!0,e[Q$]=!0),e[mx]&&(e[zb]=!0),e[Q$]&&(e[zb]=!0),e[zb]&&(e[eB]=!0),e[mwe]&&(e[eB]=!0);for(const r in e){const i=qpt(r,n);i.indexOf(t)<0&&i.push(t)}}function Gpt(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Ko(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Ko.groups={};Ko.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const i=e.jr[r][0],s=e.jr[r][1];if(s&&i.test(t))return s}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let i=0;i<t.length;i++)this.tt(t[i],e,n,r)},tr(t,e,n,r){r=r||Ko.groups;let i;return e&&e.j?i=e:(i=new Ko(e),n&&r&&Op(e,n,r)),this.jr.push([t,i]),i},ts(t,e,n,r){let i=this;const s=t.length;if(!s)return i;for(let o=0;o<s-1;o++)i=i.tt(t[o]);return i.tt(t[s-1],e,n,r)},tt(t,e,n,r){r=r||Ko.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const s=e;let o,a=i.go(t);if(a?(o=new Ko,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Ko,s){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(Gpt(o.t,r),n);Op(s,l,r)}else n&&Op(s,n,r);o.t=s}return i.j[t]=o,o}};const Bt=(t,e,n,r,i)=>t.ta(e,n,r,i),mr=(t,e,n,r,i)=>t.tr(e,n,r,i),Ate=(t,e,n,r,i)=>t.ts(e,n,r,i),Oe=(t,e,n,r,i)=>t.tt(e,n,r,i),Ju="WORD",tB="UWORD",ywe="ASCIINUMERICAL",vwe="ALPHANUMERICAL",_w="LOCALHOST",nB="TLD",rB="UTLD",iT="SCHEME",Wm="SLASH_SCHEME",p9="NUM",iB="WS",g9="NL",yx="OPENBRACE",vx="CLOSEBRACE",PP="OPENBRACKET",_P="CLOSEBRACKET",kP="OPENPAREN",AP="CLOSEPAREN",MP="OPENANGLEBRACKET",OP="CLOSEANGLEBRACKET",DP="FULLWIDTHLEFTPAREN",RP="FULLWIDTHRIGHTPAREN",NP="LEFTCORNERBRACKET",jP="RIGHTCORNERBRACKET",LP="LEFTWHITECORNERBRACKET",FP="RIGHTWHITECORNERBRACKET",$P="FULLWIDTHLESSTHAN",BP="FULLWIDTHGREATERTHAN",zP="AMPERSAND",UP="APOSTROPHE",HP="ASTERISK",Dh="AT",VP="BACKSLASH",WP="BACKTICK",KP="CARET",Uh="COLON",m9="COMMA",qP="DOLLAR",Yc="DOT",GP="EQUALS",y9="EXCLAMATION",fl="HYPHEN",bx="PERCENT",YP="PIPE",XP="PLUS",JP="POUND",xx="QUERY",v9="QUOTE",bwe="FULLWIDTHMIDDLEDOT",b9="SEMI",Xc="SLASH",wx="TILDE",ZP="UNDERSCORE",xwe="EMOJI",QP="SYM";var wwe=Object.freeze({__proto__:null,ALPHANUMERICAL:vwe,AMPERSAND:zP,APOSTROPHE:UP,ASCIINUMERICAL:ywe,ASTERISK:HP,AT:Dh,BACKSLASH:VP,BACKTICK:WP,CARET:KP,CLOSEANGLEBRACKET:OP,CLOSEBRACE:vx,CLOSEBRACKET:_P,CLOSEPAREN:AP,COLON:Uh,COMMA:m9,DOLLAR:qP,DOT:Yc,EMOJI:xwe,EQUALS:GP,EXCLAMATION:y9,FULLWIDTHGREATERTHAN:BP,FULLWIDTHLEFTPAREN:DP,FULLWIDTHLESSTHAN:$P,FULLWIDTHMIDDLEDOT:bwe,FULLWIDTHRIGHTPAREN:RP,HYPHEN:fl,LEFTCORNERBRACKET:NP,LEFTWHITECORNERBRACKET:LP,LOCALHOST:_w,NL:g9,NUM:p9,OPENANGLEBRACKET:MP,OPENBRACE:yx,OPENBRACKET:PP,OPENPAREN:kP,PERCENT:bx,PIPE:YP,PLUS:XP,POUND:JP,QUERY:xx,QUOTE:v9,RIGHTCORNERBRACKET:jP,RIGHTWHITECORNERBRACKET:FP,SCHEME:iT,SEMI:b9,SLASH:Xc,SLASH_SCHEME:Wm,SYM:QP,TILDE:wx,TLD:nB,UNDERSCORE:ZP,UTLD:rB,UWORD:tB,WORD:Ju,WS:iB});const Ku=/[a-z]/,hb=new RegExp("\\p{L}","u"),IL=new RegExp("\\p{Emoji}","u"),qu=/\d/,PL=/\s/,Mte="\r",_L=`
`,Ypt="️",Xpt="‍",kL="￼";let mE=null,yE=null;function Jpt(t=[]){const e={};Ko.groups=e;const n=new Ko;mE==null&&(mE=Ote(Hpt)),yE==null&&(yE=Ote(Vpt)),Oe(n,"'",UP),Oe(n,"{",yx),Oe(n,"}",vx),Oe(n,"[",PP),Oe(n,"]",_P),Oe(n,"(",kP),Oe(n,")",AP),Oe(n,"<",MP),Oe(n,">",OP),Oe(n,"（",DP),Oe(n,"）",RP),Oe(n,"「",NP),Oe(n,"」",jP),Oe(n,"『",LP),Oe(n,"』",FP),Oe(n,"＜",$P),Oe(n,"＞",BP),Oe(n,"&",zP),Oe(n,"*",HP),Oe(n,"@",Dh),Oe(n,"`",WP),Oe(n,"^",KP),Oe(n,":",Uh),Oe(n,",",m9),Oe(n,"$",qP),Oe(n,".",Yc),Oe(n,"=",GP),Oe(n,"!",y9),Oe(n,"-",fl),Oe(n,"%",bx),Oe(n,"|",YP),Oe(n,"+",XP),Oe(n,"#",JP),Oe(n,"?",xx),Oe(n,'"',v9),Oe(n,"/",Xc),Oe(n,";",b9),Oe(n,"~",wx),Oe(n,"_",ZP),Oe(n,"\\",VP),Oe(n,"・",bwe);const r=mr(n,qu,p9,{[J$]:!0});mr(r,qu,r);const i=mr(r,Ku,ywe,{[mx]:!0}),s=mr(r,hb,vwe,{[zb]:!0}),o=mr(n,Ku,Ju,{[Z$]:!0});mr(o,qu,i),mr(o,Ku,o),mr(i,qu,i),mr(i,Ku,i);const a=mr(n,hb,tB,{[Q$]:!0});mr(a,Ku),mr(a,qu,s),mr(a,hb,a),mr(s,qu,s),mr(s,Ku),mr(s,hb,s);const l=Oe(n,_L,g9,{[TL]:!0}),c=Oe(n,Mte,iB,{[TL]:!0}),u=mr(n,PL,iB,{[TL]:!0});Oe(n,kL,u),Oe(c,_L,l),Oe(c,kL,u),mr(c,PL,u),Oe(u,Mte),Oe(u,_L),mr(u,PL,u),Oe(u,kL,u);const d=mr(n,IL,xwe,{[mwe]:!0});Oe(d,"#"),mr(d,IL,d),Oe(d,Ypt,d);const h=Oe(d,Xpt);Oe(h,"#"),mr(h,IL,d);const f=[[Ku,o],[qu,i]],y=[[Ku,null],[hb,a],[qu,s]];for(let b=0;b<mE.length;b++)Eh(n,mE[b],nB,Ju,f);for(let b=0;b<yE.length;b++)Eh(n,yE[b],rB,tB,y);Op(nB,{tld:!0,ascii:!0},e),Op(rB,{utld:!0,alpha:!0},e),Eh(n,"file",iT,Ju,f),Eh(n,"mailto",iT,Ju,f),Eh(n,"http",Wm,Ju,f),Eh(n,"https",Wm,Ju,f),Eh(n,"ftp",Wm,Ju,f),Eh(n,"ftps",Wm,Ju,f),Op(iT,{scheme:!0,ascii:!0},e),Op(Wm,{slashscheme:!0,ascii:!0},e),t=t.sort((b,v)=>b[0]>v[0]?1:-1);for(let b=0;b<t.length;b++){const v=t[b][0],C=t[b][1]?{[Wpt]:!0}:{[Kpt]:!0};v.indexOf("-")>=0?C[eB]=!0:Ku.test(v)?qu.test(v)?C[mx]=!0:C[Z$]=!0:C[J$]=!0,Ate(n,v,v,C)}return Ate(n,"localhost",_w,{ascii:!0}),n.jd=new Ko(QP),{start:n,tokens:Object.assign({groups:e},wwe)}}function Swe(t,e){const n=Zpt(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,i=[];let s=0,o=0;for(;o<r;){let a=t,l=null,c=0,u=null,d=-1,h=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(d=0,h=0,u=a):d>=0&&(d+=n[o].length,h++),c+=n[o].length,s+=n[o].length,o++;s-=d,o-=h,c-=d,i.push({t:u.t,v:e.slice(s-c,s),s:s-c,e:s})}return i}function Zpt(t){const e=[],n=t.length;let r=0;for(;r<n;){let i=t.charCodeAt(r),s,o=i<55296||i>56319||r+1===n||(s=t.charCodeAt(r+1))<56320||s>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function Eh(t,e,n,r,i){let s;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?s=t.j[l]:(s=new Ko(r),s.jr=i.slice(),t.j[l]=s),t=s}return s=new Ko(n),s.jr=i.slice(),t.j[e[o-1]]=s,s}function Ote(t){const e=[],n=[];let r=0,i="0123456789";for(;r<t.length;){let s=0;for(;i.indexOf(t[r+s])>=0;)s++;if(s>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+s),10);o>0;o--)n.pop();r+=s}else n.push(t[r]),r++}return e}const kw={defaultProtocol:"http",events:null,format:Dte,formatHref:Dte,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function x9(t,e=null){let n=Object.assign({},kw);t&&(n=Object.assign(n,t instanceof x9?t.o:t));const r=n.ignoreTags,i=[];for(let s=0;s<r.length;s++)i.push(r[s].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=i}x9.prototype={o:kw,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:kw[t],typeof i=="function"&&r&&(i=i(e,n))):typeof i=="function"&&r&&(i=i(e,n.t,n)),i)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function Dte(t){return t}function Cwe(t,e){this.t="token",this.v=t,this.tk=e}Cwe.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"…":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=kw.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),i=t.get("tagName",n,e),s=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),d=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:i,attributes:o,content:s,eventListeners:d}}};function UA(t,e){class n extends Cwe{constructor(i,s){super(i,s),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const Rte=UA("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Nte=UA("text"),Qpt=UA("nl"),vE=UA("url",{isLink:!0,toHref(t=kw.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==_w&&t[1].t===Uh}}),ul=t=>new Ko(t);function egt({groups:t}){const e=t.domain.concat([zP,HP,Dh,VP,WP,KP,qP,GP,fl,p9,bx,YP,XP,JP,Xc,QP,wx,ZP]),n=[UP,Uh,m9,Yc,y9,bx,xx,v9,b9,MP,OP,yx,vx,_P,PP,kP,AP,DP,RP,NP,jP,LP,FP,$P,BP],r=[zP,UP,HP,VP,WP,KP,qP,GP,fl,yx,vx,bx,YP,XP,JP,xx,Xc,QP,wx,ZP],i=ul(),s=Oe(i,wx);Bt(s,r,s),Bt(s,t.domain,s);const o=ul(),a=ul(),l=ul();Bt(i,t.domain,o),Bt(i,t.scheme,a),Bt(i,t.slashscheme,l),Bt(o,r,s),Bt(o,t.domain,o);const c=Oe(o,Dh);Oe(s,Dh,c),Oe(a,Dh,c),Oe(l,Dh,c);const u=Oe(s,Yc);Bt(u,r,s),Bt(u,t.domain,s);const d=ul();Bt(c,t.domain,d),Bt(d,t.domain,d);const h=Oe(d,Yc);Bt(h,t.domain,d);const f=ul(Rte);Bt(h,t.tld,f),Bt(h,t.utld,f),Oe(c,_w,f);const y=Oe(d,fl);Oe(y,fl,y),Bt(y,t.domain,d),Bt(f,t.domain,d),Oe(f,Yc,h),Oe(f,fl,y);const b=Oe(f,Uh);Bt(b,t.numeric,Rte);const v=Oe(o,fl),x=Oe(o,Yc);Oe(v,fl,v),Bt(v,t.domain,o),Bt(x,r,s),Bt(x,t.domain,o);const C=ul(vE);Bt(x,t.tld,C),Bt(x,t.utld,C),Bt(C,t.domain,o),Bt(C,r,s),Oe(C,Yc,x),Oe(C,fl,v),Oe(C,Dh,c);const E=Oe(C,Uh),I=ul(vE);Bt(E,t.numeric,I);const P=ul(vE),_=ul();Bt(P,e,P),Bt(P,n,_),Bt(_,e,P),Bt(_,n,_),Oe(C,Xc,P),Oe(I,Xc,P);const A=Oe(a,Uh),D=Oe(l,Uh),L=Oe(D,Xc),z=Oe(L,Xc);Bt(a,t.domain,o),Oe(a,Yc,x),Oe(a,fl,v),Bt(l,t.domain,o),Oe(l,Yc,x),Oe(l,fl,v),Bt(A,t.domain,P),Oe(A,Xc,P),Oe(A,xx,P),Bt(z,t.domain,P),Bt(z,e,P),Oe(z,Xc,P);const $=[[yx,vx],[PP,_P],[kP,AP],[MP,OP],[DP,RP],[NP,jP],[LP,FP],[$P,BP]];for(let H=0;H<$.length;H++){const[R,j]=$[H],B=Oe(P,R);Oe(_,R,B),Oe(B,j,P);const K=ul(vE);Bt(B,e,K);const G=ul();Bt(B,n),Bt(K,e,K),Bt(K,n,G),Bt(G,e,K),Bt(G,n,G),Oe(K,j,P),Oe(G,j,P)}return Oe(i,_w,C),Oe(i,g9,Qpt),{start:i,tokens:wwe}}function tgt(t,e,n){let r=n.length,i=0,s=[],o=[];for(;i<r;){let a=t,l=null,c=null,u=0,d=null,h=-1;for(;i<r&&!(l=a.go(n[i].t));)o.push(n[i++]);for(;i<r&&(c=l||a.go(n[i].t));)l=null,a=c,a.accepts()?(h=0,d=a):h>=0&&h++,i++,u++;if(h<0)i-=u,i<r&&(o.push(n[i]),i++);else{o.length>0&&(s.push(AL(Nte,e,o)),o=[]),i-=h,u-=h;const f=d.t,y=n.slice(i-u,i);s.push(AL(f,e,y))}}return o.length>0&&s.push(AL(Nte,e,o)),s}function AL(t,e,n){const r=n[0].s,i=n[n.length-1].e,s=e.slice(r,i);return new t(s,n)}const ngt=typeof console<"u"&&console&&console.warn||(()=>{}),rgt="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Un={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function igt(){return Ko.groups={},Un.scanner=null,Un.parser=null,Un.tokenQueue=[],Un.pluginQueue=[],Un.customSchemes=[],Un.initialized=!1,Un}function jte(t,e=!1){if(Un.initialized&&ngt(`linkifyjs: already initialized - will not register custom scheme "${t}" ${rgt}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Un.customSchemes.push([t,e])}function sgt(){Un.scanner=Jpt(Un.customSchemes);for(let t=0;t<Un.tokenQueue.length;t++)Un.tokenQueue[t][1]({scanner:Un.scanner});Un.parser=egt(Un.scanner.tokens);for(let t=0;t<Un.pluginQueue.length;t++)Un.pluginQueue[t][1]({scanner:Un.scanner,parser:Un.parser});return Un.initialized=!0,Un}function w9(t){return Un.initialized||sgt(),tgt(Un.parser.start,t,Swe(Un.scanner.start,t))}w9.scan=Swe;function Ewe(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new x9(n),i=w9(t),s=[];for(let o=0;o<i.length;o++){const a=i[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&s.push(a.toFormattedObject(r))}return s}const S9="[\0-   ᠎ -\u2029 　]",ogt=new RegExp(S9),agt=new RegExp(`${S9}$`),lgt=new RegExp(S9,"g");function cgt(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function ugt(t){return new ls({key:new Wa("autolink"),appendTransaction:(e,n,r)=>{const i=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),s=e.some(c=>c.getMeta("preventAutolink"));if(!i||s)return;const{tr:o}=r,a=vst(n.doc,[...e]);if(_st(a).forEach(({newRange:c})=>{const u=xst(r.doc,c,f=>f.isTextblock);let d,h;if(u.length>1)d=u[0],h=r.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const f=r.doc.textBetween(c.from,c.to," "," ");if(!agt.test(f))return;d=u[0],h=r.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&h){const f=h.split(ogt).filter(Boolean);if(f.length<=0)return!1;const y=f[f.length-1],b=d.pos+h.lastIndexOf(y);if(!y)return!1;const v=w9(y).map(x=>x.toObject(t.defaultProtocol));if(!cgt(v))return!1;v.filter(x=>x.isLink).map(x=>({...x,from:b+x.start+1,to:b+x.end+1})).filter(x=>r.schema.marks.code?!r.doc.rangeHasMark(x.from,x.to,r.schema.marks.code):!0).filter(x=>t.validate(x.value)).filter(x=>t.shouldAutoLink(x.value)).forEach(x=>{c6(x.from,x.to,r.doc).some(C=>C.mark.type===t.type)||o.addMark(x.from,x.to,t.type.create({href:x.href}))})}}),!!o.steps.length)return o}})}function dgt(t){return new ls({key:new Wa("handleClickLink"),props:{handleClick:(e,n,r)=>{var i,s;if(r.button!==0||!e.editable)return!1;let o=r.target;const a=[];for(;o.nodeName!=="DIV";)a.push(o),o=o.parentNode;if(!a.find(h=>h.nodeName==="A"))return!1;const l=Tve(e.state,t.type.name),c=r.target,u=(i=c==null?void 0:c.href)!==null&&i!==void 0?i:l.href,d=(s=c==null?void 0:c.target)!==null&&s!==void 0?s:l.target;return c&&u?(window.open(u,d),!0):!1}}})}function hgt(t){return new ls({key:new Wa("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:i}=e,{selection:s}=i,{empty:o}=s;if(o)return!1;let a="";r.content.forEach(c=>{a+=c.textContent});const l=Ewe(a,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===a);return!a||!l?!1:t.editor.commands.setMark(t.type,{href:l.href})}}})}function fp(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const i=typeof r=="string"?r:r.scheme;i&&n.push(i)}),!t||t.replace(lgt,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const fgt=Su.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){jte(t);return}jte(t.scheme,t.optionalSlashes)})},onDestroy(){igt()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!fp(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!fp(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!fp(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Ai(this.options.HTMLAttributes,t),0]:["a",Ai(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!fp(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!fp(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[mf({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,i=Ewe(t).filter(s=>s.isLink&&this.options.isAllowedUri(s.value,{defaultValidate:o=>!!fp(o,n),protocols:n,defaultProtocol:r}));i.length&&i.forEach(s=>e.push({text:s.value,data:{href:s.href},index:s.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(ugt({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:i=>!!fp(i,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(dgt({type:this.type})),this.options.linkOnPaste&&t.push(hgt({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),pgt=/^\s*>\s$/,ggt=Ac.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",Ai(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[bw({find:pgt,type:this.type})]}}),mgt=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,ygt=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,vgt=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,bgt=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,xgt=Su.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",Ai(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[vg({find:mgt,type:this.type}),vg({find:vgt,type:this.type})]},addPasteRules(){return[mf({find:ygt,type:this.type}),mf({find:bgt,type:this.type})]}}),wgt="listItem",Lte="textStyle",Fte=/^\s*([-+*])\s$/,Sgt=Ac.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Ai(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(wgt,this.editor.getAttributes(Lte)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=bw({find:Fte,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=bw({find:Fte,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Lte),editor:this.editor})),[t]}}),Cgt=/^```([a-z]+)?[\s\n]$/,Egt=/^~~~([a-z]+)?[\s\n]$/,Tgt=Ac.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,s=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Ai(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection($t.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[T$({find:Cgt,type:this.type,getAttributes:t=>({language:t[1]})}),T$({find:Egt,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new ls({key:new Wa("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i==null?void 0:i.mode;if(!n||!s)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(Ot.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),Igt=Ac.create({name:"doc",topNode:!0,content:"block+"});function Pgt(t={}){return new ls({view(e){return new _gt(e,t)}})}class _gt{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return e.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,i=this.editorView.dom,s=i.getBoundingClientRect(),o=s.width/i.offsetWidth,a=s.height/i.offsetHeight;if(n){let d=e.nodeBefore,h=e.nodeAfter;if(d||h){let f=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(f){let y=f.getBoundingClientRect(),b=d?y.bottom:y.top;d&&h&&(b=(b+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let v=this.width/2*a;r={left:y.left,right:y.right,top:b-v,bottom:b+v}}}}if(!r){let d=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*o;r={left:d.left-h,right:d.left+h,top:d.top,bottom:d.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let d=l.getBoundingClientRect(),h=d.width/l.offsetWidth,f=d.height/l.offsetHeight;c=d.left-l.scrollLeft*h,u=d.top-l.scrollTop*f}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n,e):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=fye(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const kgt=ss.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Pgt(this.options)]}});class br extends $t{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return br.valid(r)?new br(r):$t.near(r)}content(){return We.empty}eq(e){return e instanceof br&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new br(e.resolve(n.pos))}getBookmark(){return new C9(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!Agt(e)||!Mgt(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&br.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=n;let l=e.doc.resolve(i);if(br.valid(l))return l}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!dt.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let a=e.doc.resolve(i);if(br.valid(a))return a}return null}}}br.prototype.visible=!1;br.findFrom=br.findGapCursorFrom;$t.jsonID("gapcursor",br);class C9{constructor(e){this.pos=e}map(e){return new C9(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return br.valid(n)?new br(n):$t.near(n)}}function Agt(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function Mgt(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function Ogt(){return new ls({props:{decorations:jgt,createSelectionBetween(t,e,n){return e.pos==n.pos&&br.valid(n)?new br(n):null},handleClick:Rgt,handleKeyDown:Dgt,handleDOMEvents:{beforeinput:Ngt}}})}const Dgt=tve({ArrowLeft:bE("horiz",-1),ArrowRight:bE("horiz",1),ArrowUp:bE("vert",-1),ArrowDown:bE("vert",1)});function bE(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof Ot){if(!s.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=br.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new br(c))),!0):!1}}function Rgt(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!br.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&dt.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new br(r))),!0)}function Ngt(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof br))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=Pe.empty;for(let o=r.length-1;o>=0;o--)i=Pe.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new We(i,0,0));return s.setSelection(Ot.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function jgt(t){if(!(t.selection instanceof br))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",ti.create(t.doc,[Cl.widget(t.selection.head,e,{key:"gapcursor"})])}const Lgt=ss.create({name:"gapCursor",addProseMirrorPlugins(){return[Ogt()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Ht(rt(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),Fgt=Ac.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Ai(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const d=l.filter(h=>a.includes(h.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),$gt=Ac.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Ai(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>T$({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var e_=200,Pi=function(){};Pi.prototype.append=function(e){return e.length?(e=Pi.from(e),!this.length&&e||e.length<e_&&this.leafAppend(e)||this.length<e_&&e.leafPrepend(this)||this.appendInner(e)):this};Pi.prototype.prepend=function(e){return e.length?Pi.from(e).append(this):this};Pi.prototype.appendInner=function(e){return new Bgt(this,e)};Pi.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Pi.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Pi.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Pi.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Pi.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},n,r),i};Pi.from=function(e){return e instanceof Pi?e:e&&e.length?new Twe(e):Pi.empty};var Twe=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=e_)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=e_)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Pi);Pi.empty=new Twe([]);var Bgt=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(Pi);const zgt=500;class sc{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((d,h)=>{if(!d.step){i||(i=this.remapping(r,h+1),s=i.maps.length),s--,u.push(d);return}if(i){u.push(new Jc(d.map));let f=d.step.map(i.slice(s)),y;f&&o.maybeStep(f).doc&&(y=o.mapping.maps[o.mapping.maps.length-1],c.push(new Jc(y,void 0,void 0,c.length+u.length))),s--,y&&i.appendMap(y,s)}else o.maybeStep(d.step);if(d.selection)return a=i?d.selection.map(i.slice(s)):d.selection,l=new sc(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let d=e.steps[u].invert(e.docs[u]),h=new Jc(e.mapping.maps[u],d,n),f;(f=l&&l.merge(h))&&(h=f,u?s.pop():a=a.slice(0,a.length-1)),s.push(h),n&&(o++,n=void 0),i||(l=h)}let c=o-r.depth;return c>Hgt&&(a=Ugt(a,c),o-=c),new sc(a.append(s),o)}remapping(e,n){let r=new cye;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new sc(this.items.append(e.map(n=>new Jc(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},i);let l=n;this.items.forEach(h=>{let f=s.getMirror(--l);if(f==null)return;o=Math.min(o,f);let y=s.maps[f];if(h.step){let b=e.steps[f].invert(e.docs[f]),v=h.selection&&h.selection.map(s.slice(l+1,f));v&&a++,r.push(new Jc(y,b,v))}else r.push(new Jc(y))},i);let c=[];for(let h=n;h<o;h++)c.push(new Jc(s.maps[h]));let u=this.items.slice(0,i).append(c).append(r),d=new sc(u,a);return d.emptyItemCount()>zgt&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&s++;let d=new Jc(c.invert(),l,u),h,f=i.length-1;(h=i.length&&i[f].merge(d))?i[f]=h:i.push(d)}}else o.map&&r--},this.items.length,0),new sc(Pi.from(i.reverse()),s)}}sc.empty=new sc(Pi.empty,0);function Ugt(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class Jc{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Jc(n.getMap().invert(),n,this.selection)}}}class Rh{constructor(e,n,r,i,s){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}}const Hgt=20;function Vgt(t,e,n,r){let i=n.getMeta(Yp),s;if(i)return i.historyState;n.getMeta(qgt)&&(t=new Rh(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Yp))return o.getMeta(Yp).redo?new Rh(t.done.addTransform(n,void 0,r,sT(e)),t.undone,$te(n.mapping.maps),t.prevTime,t.prevComposition):new Rh(t.done,t.undone.addTransform(n,void 0,r,sT(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!Wgt(n,t.prevRanges)),c=o?ML(t.prevRanges,n.mapping):$te(n.mapping.maps);return new Rh(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,sT(e)),sc.empty,c,n.time,a??t.prevComposition)}else return(s=n.getMeta("rebased"))?new Rh(t.done.rebased(n,s),t.undone.rebased(n,s),ML(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Rh(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),ML(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function Wgt(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(n=!0)}),n}function $te(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,i,s,o)=>e.push(s,o));return e}function ML(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function Kgt(t,e,n){let r=sT(e),i=Yp.get(e).spec.config,s=(n?t.undone:t.done).popEvent(e,r);if(!s)return null;let o=s.selection.resolve(s.transform.doc),a=(n?t.done:t.undone).addTransform(s.transform,e.selection.getBookmark(),i,r),l=new Rh(n?a:s.remaining,n?s.remaining:a,null,0,-1);return s.transform.setSelection(o).setMeta(Yp,{redo:n,historyState:l})}let OL=!1,Bte=null;function sT(t){let e=t.plugins;if(Bte!=e){OL=!1,Bte=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){OL=!0;break}}return OL}const Yp=new Wa("history"),qgt=new Wa("closeHistory");function Ggt(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new ls({key:Yp,state:{init(){return new Rh(sc.empty,sc.empty,null,0,-1)},apply(e,n,r){return Vgt(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?Pwe:r=="historyRedo"?_we:null;return i?(n.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function Iwe(t,e){return(n,r)=>{let i=Yp.getState(n);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(r){let s=Kgt(i,n,t);s&&r(e?s.scrollIntoView():s)}return!0}}const Pwe=Iwe(!1,!0),_we=Iwe(!0,!0),Ygt=ss.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>Pwe(t,e),redo:()=>({state:t,dispatch:e})=>_we(t,e)}},addProseMirrorPlugins(){return[Ggt(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),Xgt=Ac.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Ai(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!cot(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:i}=n,s=t();return r.parentOffset===0?s.insertContentAt({from:Math.max(r.pos-1,0),to:i.pos},{type:this.name}):Ast(n)?s.insertContentAt(i.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:c}=o.selection,u=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?o.setSelection(Ot.create(o.doc,c.pos+1)):c.nodeAfter.isBlock?o.setSelection(dt.create(o.doc,c.pos)):o.setSelection(Ot.create(o.doc,c.pos));else{const d=(l=c.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();d&&(o.insert(u,d),o.setSelection(Ot.create(o.doc,u+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[lot({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),Jgt=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Zgt=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Qgt=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,emt=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,tmt=Su.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Ai(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[vg({find:Jgt,type:this.type}),vg({find:Qgt,type:this.type})]},addPasteRules(){return[mf({find:Zgt,type:this.type}),mf({find:emt,type:this.type})]}}),nmt=Ac.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Ai(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),rmt="listItem",zte="textStyle",Ute=/^(\d+)\.\s$/,imt=Ac.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",Ai(this.options.HTMLAttributes,n),0]:["ol",Ai(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(rmt,this.editor.getAttributes(zte)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=bw({find:Ute,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=bw({find:Ute,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(zte)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),smt=Ac.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Ai(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),omt=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,amt=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,lmt=Su.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Ai(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[vg({find:omt,type:this.type})]},addPasteRules(){return[mf({find:amt,type:this.type})]}}),cmt=Ac.create({name:"text",group:"inline"}),umt=ss.create({name:"starterKit",addExtensions(){const t=[];return this.options.bold!==!1&&t.push(xgt.configure(this.options.bold)),this.options.blockquote!==!1&&t.push(ggt.configure(this.options.blockquote)),this.options.bulletList!==!1&&t.push(Sgt.configure(this.options.bulletList)),this.options.code!==!1&&t.push(pwe.configure(this.options.code)),this.options.codeBlock!==!1&&t.push(Tgt.configure(this.options.codeBlock)),this.options.document!==!1&&t.push(Igt.configure(this.options.document)),this.options.dropcursor!==!1&&t.push(kgt.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&t.push(Lgt.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&t.push(Fgt.configure(this.options.hardBreak)),this.options.heading!==!1&&t.push($gt.configure(this.options.heading)),this.options.history!==!1&&t.push(Ygt.configure(this.options.history)),this.options.horizontalRule!==!1&&t.push(Xgt.configure(this.options.horizontalRule)),this.options.italic!==!1&&t.push(tmt.configure(this.options.italic)),this.options.listItem!==!1&&t.push(nmt.configure(this.options.listItem)),this.options.orderedList!==!1&&t.push(imt.configure(this.options.orderedList)),this.options.paragraph!==!1&&t.push(smt.configure(this.options.paragraph)),this.options.strike!==!1&&t.push(lmt.configure(this.options.strike)),this.options.text!==!1&&t.push(cmt.configure(this.options.text)),t}}),E9={tldraw_draw:{normal:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw",format:"woff2"},weight:"normal"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_bold",format:"woff2"},weight:"bold"}},italic:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_sans:{normal:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_serif:{normal:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_mono:{normal:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}}},dmt=yr(E9).flatMap(t=>yr(t).flatMap(e=>Object.values(e))),hmt=ss.create({name:"textDirection",addGlobalAttributes(){return[{types:["heading","paragraph"],attributes:{dir:{default:"auto",parseHTML:t=>{const e=t.getAttribute("dir");return e&&["ltr","rtl","auto"].includes(e)?e:"auto"},renderHTML:t=>({dir:t.dir})}}}]}}),fmt=ss.create({name:"keyboardShiftEnterHandler",addKeyboardShortcuts(){return{"Shift-Enter":({editor:t})=>t.commands.enter()}}});pwe.config.excludes=void 0;gwe.config.priority=1100;const QS=[umt.configure({blockquote:!1,codeBlock:!1,horizontalRule:!1}),fgt.configure({openOnClick:!1,autolink:!0}),gwe,fmt,hmt],pmt=new zs;function T9(t,e){return pmt.get(e,()=>{var i;const n=((i=t.getTextOptions().tipTapConfig)==null?void 0:i.extensions)??QS;return Sst(e,n).replaceAll('<p dir="auto"></p>',"<p><br /></p>")??""})}function t_(t,e){return`<div class="tl-rich-text">${T9(t,e)}</div>`}const gmt=new zs;function Uo(t){return t.content.length===1&&!t.content[0].content}function wg(t,e){return Uo(e)?"":gmt.get(e,()=>{var r;const n=((r=t.getTextOptions().tipTapConfig)==null?void 0:r.extensions)??QS;return Est(e,n,{blockSeparator:`
`})})}function mmt(t,e){var r;const n=((r=t.getTextOptions().tipTapConfig)==null?void 0:r.extensions)??QS;return Cst(e,n)}function kwe(t,e,n){for(const o of t.marks)o.type.name==="bold"&&e.weight!=="bold"&&(e={...e,weight:"bold"}),o.type.name==="italic"&&e.style!=="italic"&&(e={...e,style:"italic"}),o.type.name==="code"&&e.family!=="tldraw_mono"&&(e={...e,family:"tldraw_mono"});const r=Ar(E9,e.family);if(!r)return e;const i=Ar(r,e.style);if(!i)return e;const s=Ar(i,e.weight);return s&&n(s),e}const ymt="  ",Mx=class Mx{static normalizeText(e){return e.replace(Mx.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(Mx.fixNewLines,`
`).split(`
`).map(n=>n||" ").join(`
`)}};N(Mx,"fixNewLines",/\r?\n|\r/g);let n_=Mx;const vmt=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function Awe(t){return vmt.test(t)}function bmt(t){return t.replace(/\t/g,ymt)}function xmt(t){const e=t.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let n=1/0;for(const r of e)if(r.trim().length>0){const i=r.length-r.trimStart().length;n=Math.min(n,i)}return e.map(r=>r.slice(n)).join(`
`)}const Mwe={"&amp;":"&","&quot;":'"',"&apos;":"'","&#27;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8230;":"…"},wmt=new RegExp(Object.keys(Mwe).join("|"),"g");function Owe(t){return t.replace(wmt,e=>Mwe[e])}function Smt(t){return t.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function Cmt(t){return Smt(xmt(bmt(t)))}const Emt=5e3,Tmt=10*1024*1024;function Imt(t,e){t.registerExternalAssetHandler("file",async n=>Pmt(t,n,e)),t.registerExternalAssetHandler("url",async n=>kmt(t,n,e)),t.registerExternalContentHandler("svg-text",async n=>Amt(t,n)),t.registerExternalContentHandler("embed",n=>Mmt(t,n)),t.registerExternalContentHandler("files",async n=>Omt(t,n,e)),t.registerExternalContentHandler("file-replace",async n=>_mt(t,n,e)),t.registerExternalContentHandler("text",async n=>Dmt(t,n)),t.registerExternalContentHandler("url",async n=>Rmt(t,n,e)),t.registerExternalContentHandler("tldraw",async n=>Nmt(t,n)),t.registerExternalContentHandler("excalidraw",async n=>jmt(t,n))}async function Pmt(t,{file:e,assetId:n},r){I9(e,r)||it(!1,"File checks failed");const s=await jwe(e,r,n),o=await t.uploadAsset(s,e);return s.props.src=o.src,o.meta&&(s.meta={...s.meta,...o.meta}),Nf.create(s)}async function _mt(t,{file:e,shapeId:n,isImage:r},i){I9(e,i)||it(!1,"File checks failed");const o=t.getShape(n);o||it(!1,"Shape not found");const a=Oue(await e.arrayBuffer()),l=Nf.createId(a);t.createTemporaryAssetPreview(l,e);const c=await Dwe(e,l,r,!r);if(t.createAssets([c]),o.type==="image"){const d=o,h=d.props.crop;let f=c.props.w,y=c.props.h,b=d.x,v=d.y,x=h;if(h){const C=Spt(d,c.props.w,c.props.h);x=C.crop,f=C.w,y=C.h,b=C.x,v=C.y}t.updateShapes([{id:d.id,type:d.type,props:{assetId:l,crop:x,w:f,h:y},x:b,y:v}])}else o.type==="video"&&t.updateShapes([{id:o.id,type:o.type,props:{assetId:l,w:c.props.w,h:c.props.h}}]);const u=await t.getAssetForExternalContent({type:"file",file:e,assetId:l});return t.updateAssets([{...u,id:l}]),u}async function kmt(t,{url:e},{toasts:n,msg:r}){var s,o,a,l,c;let i;try{const d=await(await hc(e,{method:"GET",mode:"no-cors"})).text(),h=new DOMParser().parseFromString(d,"text/html");i={image:((s=h.head.querySelector('meta[property="og:image"]'))==null?void 0:s.getAttribute("content"))??"",favicon:((o=h.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:o.getAttribute("href"))??((a=h.head.querySelector('link[rel="icon"]'))==null?void 0:a.getAttribute("href"))??"",title:((l=h.head.querySelector('meta[property="og:title"]'))==null?void 0:l.getAttribute("content"))??e,description:((c=h.head.querySelector('meta[property="og:description"]'))==null?void 0:c.getAttribute("content"))??""},i.image.startsWith("http")||(i.image=new URL(i.image,e).href),i.favicon.startsWith("http")||(i.favicon=new URL(i.favicon,e).href)}catch(u){console.error(u),n.addToast({title:r("assets.url.failed"),severity:"error"}),i={image:"",favicon:"",title:"",description:""}}return{id:Nf.createId(_z(e)),typeName:"asset",type:"bookmark",props:{src:e,description:i.description,image:i.image,favicon:i.favicon,title:i.title},meta:{}}}async function Amt(t,{point:e,text:n}){const r=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),i=new DOMParser().parseFromString(n,"image/svg+xml").querySelector("svg");if(!i)throw new Error("No <svg/> element present");let s=parseFloat(i.getAttribute("width")||"0"),o=parseFloat(i.getAttribute("height")||"0");if(!(s&&o)){document.body.appendChild(i);const l=i.getBoundingClientRect();document.body.removeChild(i),s=l.width,o=l.height}const a=await t.getAssetForExternalContent({type:"file",file:new File([n],"asset.svg",{type:"image/svg+xml"})});if(!a)throw Error("Could not create an asset");Rwe(t,[a],r)}function Mmt(t,{point:e,url:n,embed:r}){const i=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),{width:s,height:o}=r,a=Sn(),l=Ba(new M(i.x-(s||450)/2,i.y-(o||450)/2),t),c={id:a,type:"embed",x:l.x,y:l.y,props:{w:s,h:o,url:n}};t.canCreateShape(c)&&t.createShape(c).select(a)}async function Omt(t,{point:e,files:n},r){const{acceptedImageMimeTypes:i=Ov,toasts:s,msg:o}=r;if(n.length>t.options.maxFilesAtOnce){s.addToast({title:o("assets.files.amount-too-big"),severity:"error"});return}const a=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),l=new M(a.x,a.y),c=[],u=[];for(const d of n){if(!I9(d,r))continue;const f=await jwe(d,r);i.includes(d.type)&&t.createTemporaryAssetPreview(f.id,d),c.push(f),u.push({asset:f,file:d})}Promise.allSettled(u.map(async d=>{try{const h=await t.getAssetForExternalContent({type:"file",file:d.file});if(!h)throw Error("Could not create an asset");t.updateAssets([{...h,id:d.asset.id}])}catch(h){s.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(h),t.deleteAssets([d.asset.id]);return}})),Rwe(t,c,l)}async function Dmt(t,{point:e,text:n,html:r}){const i=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),s=t.getShapeUtil("text").getDefaultProps(),o=Cmt(n),a=r?mmt(t,r):Dl(o);let l,c,u,d="middle";const h=r??o.replace(/\n/g,"<br>"),f=r?a.content.length>1:o.split(`
`).length>1,y=Awe(o);f&&(d=f?y?"end":"start":"middle");const b=t.textMeasure.measureHtml(h,{...Ds,fontFamily:xf[s.font],fontSize:Qy[s.size],maxWidth:null}),v=Math.min(f?t.getViewportPageBounds().width*.9:920,Math.max(200,t.getViewportPageBounds().width*.9));if(b.w>v){const E=t.textMeasure.measureHtml(h,{...Ds,fontFamily:xf[s.font],fontSize:Qy[s.size],maxWidth:v});l=E.w,c=E.h,u=!1,d=y?"end":"start"}else l=Math.max(b.w,10),c=Math.max(b.h,10),u=!0;i.y-c/2<t.getViewportPageBounds().minY+40&&(i.y=t.getViewportPageBounds().minY+40+c/2);const x=Ba(new M(i.x-l/2,i.y-c/2),t),C=Sn();t.createShapes([{id:C,type:"text",x:x.x,y:x.y,props:{richText:a,textAlign:d,autoSize:u,w:l}}])}async function Rmt(t,{point:e,url:n},{toasts:r,msg:i}){const s=t.getShapeUtil("embed"),o=s==null?void 0:s.getEmbedDefinition(n);if(o)return t.putExternalContent({type:"embed",url:o.url,point:e,embed:o.definition});const a=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),l=Nf.createId(_z(n)),c=Lmt(t,n,a);let u=t.getAsset(l),d=!1;if(!u){d=!0;try{const h=await t.getAssetForExternalContent({type:"url",url:n});if(!h)throw Error("Could not create an asset");u=h}catch{r.addToast({title:i("assets.url.failed"),severity:"error"});return}}t.run(()=>{d&&t.createAssets([u]),t.updateShapes([{id:c.id,type:c.type,props:{assetId:u.id}}])})}async function Nmt(t,{point:e,content:n}){t.run(()=>{const r=t.getSelectionPageBounds();t.markHistoryStoppingPoint("paste");for(const s of n.shapes)n.rootShapeIds.includes(s.id)&&(s.isLocked=!1);t.putContentOntoCurrentPage(n,{point:e,select:!0});const i=t.getSelectionPageBounds();r&&i&&(r!=null&&r.collides(i))&&(t.updateInstanceState({isChangingStyle:!0}),t.timers.setTimeout(()=>{t.updateInstanceState({isChangingStyle:!1})},150))})}async function jmt(t,{point:e,content:n}){t.run(()=>{Ppt(t,n,e)})}async function Dwe(t,e,n,r,i){let s=t.type;t.type==="video/quicktime"&&(s="video/mp4");const o=n?await xa.getImageSize(t):await xa.getVideoSize(t),a=await xa.isAnimated(t)||r,l={id:e,type:n?"image":"video",typeName:"asset",props:{name:t.name,src:"",w:o.w,h:o.h,fileSize:t.size,mimeType:s,isAnimated:a},meta:{}};if(i&&isFinite(i)){const c={w:l.props.w,h:l.props.h},u=Ipt(c,{w:i,h:i});c!==u&&xa.isStaticImageType(t.type)&&(l.props.w=u.w,l.props.h=u.h)}return l}async function Rwe(t,e,n){if(!e.length)return[];const r=M.From(n),i=[];for(let s=0;s<e.length;s++){const o=e[s];switch(o.type){case"image":{i.push({id:Sn(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":i.push({id:Sn(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}}return t.run(()=>{const s=e.filter(o=>!t.getAsset(o.id));t.store.atomic(()=>{t.canCreateShapes(i)&&(s.length&&t.createAssets(s),t.createShapes(i).select(...i.map(o=>o.id)),Nwe(t,n))})}),i.map(s=>s.id)}function Nwe(t,e){const n=t.getViewportPageBounds();let r=t.getSelectionPageBounds();if(r){const i=r.center.sub(e);t.updateShapes(t.getSelectedShapes().map(s=>{const o=t.getShapeParentTransform(s).decompose().rotation,a=M.Rot(i,-o);return{id:s.id,type:s.type,x:s.x-a.x,y:s.y-a.y}}))}if(r=t.getSelectionPageBounds(),r&&t.getInstanceState().isGridMode){const i=t.getDocumentSettings().gridSize,s=new M(r.minX,r.minY),o=s.clone().snapToGrid(i),a=M.Sub(s,o);t.updateShapes(t.getSelectedShapes().map(l=>{const c={x:l.x-a.x,y:l.y-a.y};return{id:l.id,type:l.type,x:c.x,y:c.y}}))}r=t.getSelectionPageBounds(),r&&!n.contains(r)&&t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})}function Lmt(t,e,n){const r={id:Sn(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:e}};return t.run(()=>{t.createShape(r),t.getShape(r.id)&&(t.select(r.id),Nwe(t,n))}),t.getShape(r.id)}function I9(t,e){const{acceptedImageMimeTypes:n=Ov,acceptedVideoMimeTypes:r=bk,maxAssetSize:i=Tmt,toasts:s,msg:o}=e,a=n.includes(t.type),l=r.includes(t.type);return!a&&!l?(s.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),!1):t.size>i?(s.addToast({title:o("assets.files.size-too-big"),severity:"error"}),!1):t.type?!0:(s.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error("No mime type"),!1)}async function jwe(t,e,n){const{acceptedImageMimeTypes:r=Ov,acceptedVideoMimeTypes:i=bk,maxImageDimension:s=Emt}=e,o=r.includes(t.type),a=i.includes(t.type),l=Oue(await t.arrayBuffer());return n??(n=Nf.createId(l)),await Dwe(t,n,o,a,s)}var sF;let Fmt=(sF=class extends Qe{constructor(){super(...arguments);N(this,"isPrecise",!1);N(this,"isPreciseTimerId",null);N(this,"preciseTargetId",null)}onPointerMove(){this.update()}onPointerDown(n){this.parent.transition("pointing",{...n,isPrecise:this.isPrecise})}onEnter(){this.editor.setCursor({type:"cross",rotation:0}),this.update()}onCancel(){this.editor.setCurrentTool("select")}onExit(){u9(this.editor),this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId)}onKeyDown(){this.update()}onKeyUp(n){var r;if(this.update(),n.key==="Enter"){if(this.editor.getIsReadonly())return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(r=this.editor.root.getCurrent())==null||r.transition("editing_shape",{...n,target:"shape",shape:i}))}}update(){const n=this.editor.getShapeUtil("arrow"),r=BA({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0});r&&r.target.id!==this.preciseTargetId?(this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId),this.preciseTargetId=r.target.id,this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.isPrecise=!0,this.update()},n.options.hoverPreciseTimeout)):!r&&this.preciseTargetId&&(this.isPrecise=!1,this.preciseTargetId=null,this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId))}},N(sF,"id","idle"),sF);var oF;let $mt=(oF=class extends Qe{constructor(){super(...arguments);N(this,"shape");N(this,"isPrecise",!1);N(this,"isPreciseTimerId",null);N(this,"markId","")}onEnter(n){if(this.markId="",this.isPrecise=!!n.isPrecise,!BA({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0})&&(this.createArrowShape(),!this.shape)){this.cancel();return}this.startPreciseTimeout()}onExit(){this.shape=void 0,u9(this.editor),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape){this.cancel();return}this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.parent.transition("idle")}createArrowShape(){var d;const{originPagePoint:n}=this.editor.inputs,r=Sn();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${r}`);const i=Ba(n,this.editor);this.editor.createShape({id:r,type:"arrow",x:i.x,y:i.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const s=this.editor.getShape(r);if(!s)return;const o=this.editor.getShapeHandles(s);if(!o)throw Error("expected handles for arrow");const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=o.find(h=>h.id==="start"),u=(d=a.onHandleDrag)==null?void 0:d.call(a,s,{handle:{...c,x:0,y:0},isPrecise:!0,initial:l});u&&this.editor.updateShapes([u]),this.shape=this.editor.getShape(r),this.editor.select(r)}updateArrowShapeEndHandle(){var i,s;const n=this.shape;if(!n)throw Error("expected shape");const r=this.editor.getShapeHandles(n);if(!r)throw Error("expected handles for arrow");{const o=this.editor.getShapeUtil("arrow"),a=this.shape,l=r.find(u=>u.id==="start"),c=(i=o.onHandleDrag)==null?void 0:i.call(o,n,{handle:{...l,x:0,y:0},isPrecise:this.isPrecise,initial:a});c&&this.editor.updateShapes([c])}{const o=this.editor.getShapeUtil("arrow"),a=this.shape,l=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),c=r.find(d=>d.id==="end"),u=(s=o.onHandleDrag)==null?void 0:s.call(o,this.editor.getShape(n),{handle:{...c,x:l.x,y:l.y},isPrecise:!1,initial:a});u&&this.editor.updateShapes([u])}this.shape=this.editor.getShape(n.id)}startPreciseTimeout(){const n=this.editor.getShapeUtil("arrow");this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.isPrecise=!0)},n.options.pointingPreciseTimeout)}clearPreciseTimeout(){this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId)}},N(oF,"id","pointing"),oF);class sB extends Qe{constructor(){super(...arguments);N(this,"shapeType","arrow")}static children(){return[Fmt,$mt]}}N(sB,"id","arrow"),N(sB,"initial","idle");class P9 extends Qe{constructor(){super(...arguments);N(this,"info",{});N(this,"initialShape");N(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");N(this,"util",this.editor.getShapeUtil(this.shapeType));N(this,"isPen",!1);N(this,"isPenOrStylus",!1);N(this,"segmentMode","free");N(this,"didJustShiftClickToExtendPreviousShapeLine",!1);N(this,"pagePointWhereCurrentSegmentChanged",{});N(this,"pagePointWhereNextSegmentChanged",null);N(this,"lastRecordedPoint",{});N(this,"mergeNextPoint",!1);N(this,"currentLineLength",0);N(this,"markId",null)}onEnter(n){this.markId=null,this.info=n,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs:n}=this.editor;if(this.isPen&&!n.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?M.Dist(n.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=n.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(n){if(n.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(n){if(n.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return this.shapeType!=="highlight"}getIsClosed(n,r,i){if(!this.canClose())return!1;const s=ri[r],o=n[0].points[0],a=n[n.length-1],l=a.points[a.points.length-1];return o!==l&&this.currentLineLength>s*4*i&&M.DistMin(o,l,s*2*i)}startShape(){const{inputs:{originPagePoint:n,isPen:r}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:i=.5}=this.info.point;this.isPen=r,this.isPenOrStylus=r||i>0&&i<.5||i>.5&&i<1;const s=this.isPenOrStylus?i*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=n.clone(),this.initialShape){const l=this.editor.getShape(this.initialShape.id);if(l&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const c=Yi(l.props.segments);if(!c)throw Error("Expected a previous segment!");const u=Yi(c.points);if(!u)throw Error("Expected a previous point!");const{x:d,y:h}=this.editor.getPointInShapeSpace(l,n).toFixed(),f={type:this.segmentMode,points:[{x:u.x,y:u.y,z:+s.toFixed(2)},{x:d,y:h,z:+s.toFixed(2)}]},y=xe.applyToPoint(this.editor.getShapePageTransform(l.id),u);this.pagePointWhereCurrentSegmentChanged=y,this.pagePointWhereNextSegmentChanged=null;const b=[...l.props.segments,f];this.currentLineLength<ri[l.props.size]*4&&(this.currentLineLength=this.getLineLength(b));const v={id:l.id,type:this.shapeType,props:{segments:b}};this.canClose()&&(v.props.isClosed=this.getIsClosed(b,l.props.size,l.props.scale)),this.editor.updateShapes([v]);return}}this.pagePointWhereCurrentSegmentChanged=n.clone();const o=Sn();if(this.editor.createShape({id:o,type:this.shapeType,x:n.x,y:n.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+s.toFixed(2)}]}]}}),!this.editor.getShape(o)){this.cancel();return}this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateDrawingShape(){const{initialShape:n}=this,{inputs:r}=this.editor;if(!n)return;const{id:i,props:{size:s,scale:o}}=n,a=this.editor.getShape(i);if(!a)return;const{segments:l}=a.props,{x:c,y:u,z:d}=this.editor.getPointInShapeSpace(a,r.currentPagePoint).toFixed(),h=this.isPenOrStylus?+(r.currentPagePoint.z*1.25).toFixed(2):.5,f={x:c,y:u,z:h};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:y}=this;if(y===null)throw Error("We should have a point where the segment changed");if(M.Dist2(y,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const v=Yi(l);if(!v)throw Error("Expected a previous segment!");const x=Yi(v.points);if(!x)throw Error("Expected a previous last point!");let C;const E=this.editor.getPointInShapeSpace(a,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(v.type==="straight"){this.currentLineLength+=M.Dist(x,E),C={type:"straight",points:[{...x},E]};const P=this.editor.getShapePageTransform(a);this.pagePointWhereCurrentSegmentChanged=xe.applyToPoint(P,x)}else C={type:"straight",points:[E,f]};const I={id:i,type:this.shapeType,props:{segments:[...l,C]}};this.canClose()&&(I.props.isClosed=this.getIsClosed(l,s,o)),this.editor.updateShapes([I])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:y}=this;if(y===null)throw Error("We should have a point where the segment changed");if(M.Dist2(y,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const v=l.slice(),x=v[v.length-1],C=Yi(x.points);if(!C)throw Error("No previous point!");const E={type:"free",points:[...M.PointsBetween(C,f,6).map(_=>({x:ic(_.x),y:ic(_.y),z:ic(_.z)}))]},I=[...v,E];this.currentLineLength<ri[a.props.size]*4&&(this.currentLineLength=this.getLineLength(I));const P={id:i,type:this.shapeType,props:{segments:I}};this.canClose()&&(P.props.isClosed=this.getIsClosed(I,s,o)),this.editor.updateShapes([P])}break}case"straight":{const y=l.slice(),b=y[y.length-1],{pagePointWhereCurrentSegmentChanged:v}=this,{ctrlKey:x,currentPagePoint:C}=this.editor.inputs;if(!v)throw Error("We should have a point where the segment changed");let E,I=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(I=!x,this.didJustShiftClickToExtendPreviousShapeLine=!1):I=!x;let P=this.editor.getPointInShapeSpace(a,C).toFixed().toJson(),_=!1,A;if((this.editor.user.getIsSnapMode()?!x:x)&&y.length>2){let z,$=8/this.editor.getZoomLevel();for(let H=0,R=l.length-2;H<R;H++){const j=l[H];if(!j)break;if(j.type==="free")continue;const B=j.points[0],K=Yi(j.points);if(!(B&&K))continue;const G=M.NearestPointOnLineSegment(B,K,P);if(M.DistMin(G,P,$)){z=G.toFixed().toJson(),$=M.Dist(G,P),A=j;break}}z&&(_=!0,P=z)}if(_&&A){const z=this.editor.getShapePageTransform(a),$=A.points[0],H=Yi(A.points);if(!H)throw Error("Expected a last point!");const R=xe.applyToPoint(z,$),j=xe.applyToPoint(z,H),B=xe.applyToPoint(z,P);this.editor.snaps.setIndicators([{id:fn(),type:"points",points:[R,B,j]}])}else{if(this.editor.snaps.clearIndicators(),I){const z=M.Angle(v,C),H=GI(z,24)-z;E=M.RotWith(C,v,H)}else E=C;P=this.editor.getPointInShapeSpace(a,E).toFixed().toJson()}this.currentLineLength+=M.Dist(b.points[0],P),y[y.length-1]={...b,type:"straight",points:[b.points[0],P]};const L={id:i,type:this.shapeType,props:{segments:y}};this.canClose()&&(L.props.isClosed=this.getIsClosed(l,s,o)),this.editor.updateShapes([L]);break}case"free":{const y=l.slice(),b=y[y.length-1],v=[...b.points];if(v.length&&this.mergeNextPoint){const{z:C}=v[v.length-1];v[v.length-1]={x:f.x,y:f.y,z:C?Math.max(C,f.z):f.z}}else this.currentLineLength+=M.Dist(v[v.length-1],f),v.push(f);y[y.length-1]={...b,points:v},this.currentLineLength<ri[a.props.size]*4&&(this.currentLineLength=this.getLineLength(y));const x={id:i,type:this.shapeType,props:{segments:y}};if(this.canClose()&&(x.props.isClosed=this.getIsClosed(y,s,o)),this.editor.updateShapes([x]),v.length>this.util.options.maxPointsPerShape){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const C=Sn(),E=this.editor.getShape(i).props;if(!this.editor.canCreateShapes([C]))return this.cancel();this.editor.createShape({id:C,type:this.shapeType,x:ic(r.currentPagePoint.x),y:ic(r.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:E.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(d*1.25).toFixed():.5}]}]}});const I=this.editor.getShape(C);if(!I)return this.cancel();this.initialShape=ar(I),this.mergeNextPoint=!1,this.lastRecordedPoint=r.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(n){let r=0;for(const i of n)for(let s=0;s<i.points.length-1;s++){const o=i.points[s],a=i.points[s+1];r+=M.Dist2(a,o)}return Math.sqrt(r)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape:n}=this;n&&(this.editor.updateShapes([{id:n.id,type:n.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}N(P9,"id","drawing");var aF;let Lwe=(aF=class extends Qe{onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},N(aF,"id","idle"),aF);class Ub extends Qe{constructor(){super(...arguments);N(this,"shapeType","draw")}static children(){return[Lwe,P9]}onExit(){const n=this.children.drawing;n.initialShape=void 0}}N(Ub,"id","draw"),N(Ub,"initial","idle"),N(Ub,"isLockable",!1),N(Ub,"useCoalescedEvents",!0);class oB extends r${constructor(){super(...arguments);N(this,"shapeType","frame")}onCreate(n){if(!n)return;const r=this.editor.getShapePageBounds(n),i=[],s=this.editor.getShapeAncestors(n).map(o=>o.id);this.editor.getSortedChildIdsForParent(n.parentId).map(o=>{const a=this.editor.getShape(o);if(!a||a.id===n.id||a.isLocked)return;const l=this.editor.getShapePageBounds(a);l&&r.contains(l)&&Bmt(a,s,n)&&i.push(a.id)}),this.editor.reparentShapes(i,n.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}N(oB,"id","frame"),N(oB,"initial","idle");function Bmt(t,e,n){return e.includes(t.id)?!1:t.parentId===n.parentId}var lF;let zmt=(lF=class extends Qe{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){var n;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},N(lF,"id","idle"),lF);var cF;let Umt=(cF=class extends Qe{onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:n}=this.editor.inputs,r=Sn(),i=this.editor.markHistoryStoppingPoint(`creating_geo:${r}`),s=Ba(n,this.editor);if(this.editor.createShapes([{id:r,type:"geo",x:s.x,y:s.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(uc),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(r),!this.editor.getShape(r)){this.cancel();return}this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:i,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,n=Sn();this.editor.markHistoryStoppingPoint(`creating_geo:${n}`);const r=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,i=this.editor.getStyleForNextShape(uc),s=i==="star"?{w:200,h:190}:i==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:n,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(uc),scale:r,...s}}]);const o=this.editor.getShape(n);if(!o){this.cancel();return}const{w:a,h:l}=o.props,c=new M(a/2,l/2).mul(r),u=this.editor.getShapeParentTransform(o);u&&c.rot(-u.rotation());const d=Ba(new M(o.x-c.x,o.y-c.y),this.editor);this.editor.select(n),this.editor.updateShape({id:o.id,type:"geo",x:d.x,y:d.y,props:{geo:this.editor.getStyleForNextShape(uc),w:a*r,h:l*r}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},N(cF,"id","pointing"),cF);class aB extends Qe{constructor(){super(...arguments);N(this,"shapeType","geo")}static children(){return[zmt,Umt]}}N(aB,"id","geo"),N(aB,"initial","idle");class Hb extends Qe{constructor(){super(...arguments);N(this,"shapeType","highlight")}static children(){return[Lwe,P9]}onExit(){const n=this.children.drawing;n.initialShape=void 0}}N(Hb,"id","highlight"),N(Hb,"initial","idle"),N(Hb,"useCoalescedEvents",!0),N(Hb,"isLockable",!1);var uF;let Hmt=(uF=class extends Qe{constructor(){super(...arguments);N(this,"shapeId","")}onEnter(n){this.shapeId=n.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}},N(uF,"id","idle"),uF);const Hte=2;var dF;let Vmt=(dF=class extends Qe{constructor(){super(...arguments);N(this,"shape",{});N(this,"markId")}onEnter(n){const{inputs:r}=this.editor,{currentPagePoint:i}=r;this.markId=void 0;const s=n.shapeId&&this.editor.getShape(n.shapeId);if(s&&r.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${s.id}`),this.shape=s;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const a=o.filter(y=>y.type==="vertex").sort(Xi),l=a[a.length-1],c=a[a.length-2],u=xe.applyToPoint(this.editor.getShapeParentTransform(this.shape),new M(this.shape.x,this.shape.y)),d=M.Sub(i,u).addXY(.1,.1),h=Ba(d,this.editor),f=ar(this.shape.props.points);if(M.DistMin(l,c,Hte)||M.DistMin(h,l,Hte))f[l.id]={id:l.id,index:l.index,x:h.x,y:h.y};else{const y=ac(l.index);f[y]={id:y,index:y,x:h.x,y:h.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:f}}])}else{const o=Sn();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${o}`);const a=Ba(i,this.editor);if(this.editor.createShapes([{id:o,type:"line",x:a.x,y:a.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),!this.editor.getShape(o)){this.cancel();return}this.editor.select(o),this.shape=this.editor.getShape(o)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const n=this.editor.getShapeHandles(this.shape);if(!n)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const r=Yi(n);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...r,x:r.x-.1,y:r.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},N(dF,"id","pointing"),dF);class lB extends Qe{constructor(){super(...arguments);N(this,"shapeType","line")}static children(){return[Hmt,Vmt]}}N(lB,"id","line"),N(lB,"initial","idle");var hF;let Wmt=(hF=class extends Qe{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},N(hF,"id","idle"),hF);const Kmt=0,wn=200,HA=new M(wn/2,wn/2),Fwe=10,qmt=t=>[[["a1"],new M(wn*.5,wn*-.5-t.options.adjacentShapeMargin)],[["a2"],new M(wn*1.5+t.options.adjacentShapeMargin,wn*.5)],[["a3"],new M(wn*.5,wn*1.5+t.options.adjacentShapeMargin)],[["a4"],new M(wn*-.5-t.options.adjacentShapeMargin,wn*.5)]];function Gmt(t,e){if(e===1)return qmt(t);const n=wn*e,r=t.options.adjacentShapeMargin*e;return[[["a1"],new M(n*.5,n*-.5-r)],[["a2"],new M(n*1.5+r,n*.5)],[["a3"],new M(n*.5,n*1.5+r)],[["a4"],new M(n*-.5-r,n*.5)]]}function $we(t,e,n,r,i,s){return Object.fromEntries(Gmt(t,s).map(([o,a],l)=>{const c=a.clone();return l===0&&i?c.y-=i:l===2&&r&&(c.y+=r),[o,c.rot(n).add(e)]}))}function Bwe(t,e,n,r){const i=new Set(t.getSelectedShapeIds()),s=(wn+t.options.adjacentShapeMargin+r)**2,o=new Map,a=[];for(const u of t.getCurrentPageShapes()){if(!t.isShapeOfType(u,"note")||n!==u.props.scale||i.has(u.id))continue;const d=t.getShapePageTransform(u.id);e===d.rotation()&&(o.set(u,t.getShapePageBounds(u).center),a.push(...Object.values($we(t,d.point(),e,u.props.growY,r,n))))}const l=a.length;let c;for(const[u,d]of o)for(let h=0;h<l;h++)c=a[h],c&&(M.Dist2(d,c)>s||t.isPointInShape(u,c)&&(a[h]=void 0));return bt(a)}function zwe(t,e,n,r,i=!1){let s;const o=t.getCurrentPageShapesSorted(),a=(wn+t.options.adjacentShapeMargin**2)**e.props.scale;for(let l=o.length-1;l>=0;l--){const c=o[l];if(c.type==="note"&&c.id!==e.id){const u=t.getShapePageBounds(c);if(u&&M.Dist2(u.center,n)<a&&t.isPointInShape(c,n)){s=c;break}}}if(t.complete(),!s||i){t.markHistoryStoppingPoint("creating note shape");const l=Sn();t.createShape({id:l,type:"note",x:n.x,y:n.y,rotation:r,opacity:e.opacity,props:{...e.props,richText:Dl(""),growY:0,fontSizeAdjustment:0,url:""}});const c=t.getShape(l);if(!c)return;const u=t.getPointInParentSpace(c,M.Sub(n,M.Rot(HA.clone().mul(c.props.scale),r)));t.updateShape({id:l,type:"note",x:u.x,y:u.y}),s=t.getShape(l)}return t.zoomToSelectionIfOffscreen(16,{animation:{duration:t.options.animationMediumMs},inset:0}),s}var fF;let Ymt=(fF=class extends Qe{constructor(){super(...arguments);N(this,"dragged",!1);N(this,"info",{});N(this,"markId","");N(this,"shape",{})}onEnter(){const{editor:n}=this,r=Sn();this.markId=n.markHistoryStoppingPoint(`creating_note:${r}`);const i=this.editor.inputs.originPagePoint.clone(),s=Xmt(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&i.sub(s);const o=Jmt(this.editor,r,i);o?this.shape=o:this.cancel()}onPointerMove(n){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...n,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},N(fF,"id","pointing"),fF);function Xmt(t,e,n){let r=Fwe/t.getZoomLevel(),i;for(const s of Bwe(t,0,n,0)){const o=M.Sub(e,s),a=o.len();a<r&&(r=a,i=o)}return i}function Jmt(t,e,n){t.createShape({id:e,type:"note",x:n.x,y:n.y,props:{scale:t.user.getIsDynamicResizeMode()?1/t.getZoomLevel():1}});const r=t.getShape(e);if(!r)return;t.select(e);const i=t.getShapeGeometry(r).bounds,s=Ba(new M(r.x-i.width/2,r.y-i.height/2),t);return t.updateShapes([{id:e,type:"note",x:s.x,y:s.y}]),t.getShape(e)}class cB extends Qe{constructor(){super(...arguments);N(this,"shapeType","note")}static children(){return[Wmt,Ymt]}}N(cB,"id","note"),N(cB,"initial","idle");function Zmt(t){const e=t.getShapeAtPoint(t.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),renderingOnly:!0});if(!e)return t.setHoveredShape(null);let n;const r=t.getOutermostSelectableShape(e);return r===e||r.id===t.getFocusedGroupId()||t.getSelectedShapeIds().includes(r.id)?n=e:n=r,t.setHoveredShape(n.id)}const ad=kue(Zmt,32);var pF;let Qmt=(pF=class extends Qe{onPointerMove(e){switch(e.target){case"shape":case"canvas":ad(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){ad.cancel()}onKeyDown(e){var n;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},N(pF,"id","idle"),pF);var gF;let eyt=(gF=class extends Qe{constructor(){super(...arguments);N(this,"shape");N(this,"markId","");N(this,"enterTime",0)}onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(n){if(Date.now()-this.enterTime<150)return;const{editor:r}=this,{isPointing:i}=r.inputs;if(!i)return;const{originPagePoint:s,currentPagePoint:o}=r.inputs,a=Math.abs(s.x-o.x),c=Math.sqrt(r.getInstanceState().isCoarsePointer?r.options.coarseDragDistanceSquared:r.options.dragDistanceSquared)*6/r.getZoomLevel();if(a>c){const u=Sn();this.markId=r.markHistoryStoppingPoint(`creating_text:${u}`);const d=this.createTextShape(u,s,!1,a);if(!d){this.cancel();return}this.shape=r.getShape(d),r.select(u);const h=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1;r.setCurrentTool("select.resizing",{...n,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:a*h,y:1},onInteractionEnd:"text",onCreate:()=>{r.setEditingShape(d.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const n=Sn(),{originPagePoint:r}=this.editor.inputs;this.createTextShape(n,r,!0,20)&&(this.editor.select(n),this.editor.setEditingShape(n))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(n,r,i,s){this.editor.createShape({id:n,type:"text",x:r.x,y:r.y,props:{richText:Dl(""),autoSize:i,w:s,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const o=this.editor.getShape(n);if(!o){this.cancel();return}const a=this.editor.getShapePageBounds(o),l=new M;if(i)switch(o.props.textAlign){case"start":{l.x=0;break}case"middle":{l.x=-a.width/2;break}case"end":{l.x=-a.width;break}}else l.x=0;if(l.y=-a.height/2,io(o.parentId)){const d=this.editor.getShapeParentTransform(o);l.rot(-d.rotation())}const c=o.x+l.x,u=o.y+l.y;if(this.editor.getInstanceState().isGridMode){const d=new M(c,u),h=Ba(d,this.editor),f=M.Sub(d,h);this.editor.updateShape({...o,x:c-f.x,y:u-f.y})}else this.editor.updateShape({...o,x:c,y:u});return o}},N(gF,"id","pointing"),gF);class uB extends Qe{constructor(){super(...arguments);N(this,"shapeType","text")}static children(){return[Qmt,eyt]}}N(uB,"id","text"),N(uB,"initial","idle");const tyt=[uB,Ub,aB,cB,lB,oB,sB,Hb],nyt=$e.forwardRef(function({isEditing:e,text:n,handleFocus:r,handleChange:i,handleKeyDown:s,handlePaste:o,handleBlur:a,handleInputPointerDown:l,handleDoubleClick:c},u){const d=h=>{i({plaintext:h.target.value})};return g.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,disabled:!e,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:n,onFocus:r,onChange:d,onKeyDown:h=>s(h.nativeEvent),onBlur:a,onTouchEnd:tr,onContextMenu:e?tr:void 0,onPointerDown:l,onPaste:o,onDoubleClick:c,onDragStart:St})});function ryt(t,e,n,r){if((t==="start-legacy"||t==="end-legacy")&&n.length!==0){const i=Ee.From(n[0].box);for(const{box:s}of n)i.union(s);if(t==="start-legacy")return(r-2*e-i.width)/2;if(t==="end-legacy")return-(r-2*e-i.width)/2}}function Uwe(t){return t==="start-legacy"||t==="middle-legacy"||t==="end-legacy"}function iyt(t,e,n){const r=Hwe(t),i=r.isEditing,s=re(),o=S.useRef(null),a=(n||"").trim().length===0;S.useEffect(()=>{function u(d){var h,f;d.shapeId===t&&((f=(h=o.current)==null?void 0:h.select)==null||f.call(h))}return s.on("select-all-text",u),()=>{s.off("select-all-text",u)}},[s,t,i]),S.useEffect(()=>{var u,d,h,f;i&&(document.activeElement!==o.current&&((u=o.current)==null||u.focus()),s.getInstanceState().isCoarsePointer&&((d=o.current)==null||d.select()),sn.isSafari&&((h=o.current)==null||h.blur(),(f=o.current)==null||f.focus()))},[s,i]);const l=S.useCallback(u=>{if(s.getEditingShapeId()===t)switch(u.key){case"Enter":{(u.ctrlKey||u.metaKey)&&s.complete();break}}},[s,t]),c=S.useCallback(({plaintext:u})=>{if(s.getEditingShapeId()!==t)return;const d=n_.normalizeText(u||"");s.updateShape({id:t,type:e,props:{text:d}})},[s,t,e]);return{rInput:o,handleKeyDown:l,handleChange:c,isEmpty:a,...r}}function _9(t,e){return ie("isReadyForEditing",()=>{const n=t.getEditingShapeId();return n!==null&&(n===e||t.getHoveredShapeId()===e)},[t,e])}function Hwe(t){const e=re(),n=ie("isEditing",()=>e.getEditingShapeId()===t,[e]),r=_9(e,t),i=S.useCallback(o=>{e.dispatch({...wa(o),type:"pointer",name:"pointer_down",target:"shape",shape:e.getShape(t)}),tr(o)},[e,t]),s=S.useCallback(o=>{if(e.getEditingShapeId()===t&&o.clipboardData){const a=o.clipboardData.getData("text/html");a&&a.includes("<div data-tldraw")&&St(o)}},[e,t]);return{handleFocus:nw,handleBlur:nw,handleInputPointerDown:i,handleDoubleClick:tr,handlePaste:s,isEditing:n,isReadyForEditing:r}}const syt=$e.memo(function({shapeId:e,type:n,text:r,labelColor:i,font:s,fontSize:o,lineHeight:a,align:l,verticalAlign:c,wrap:u,isSelected:d,padding:h=0,onKeyDown:f,classNamePrefix:y,style:b,textWidth:v,textHeight:x}){const{rInput:C,isEmpty:E,isEditing:I,isReadyForEditing:P,..._}=iyt(e,n,r),A=n_.normalizeTextForDom(r||""),D=A.length>0,L=Uwe(l);if(!I&&!D)return null;const z=y||"tl-text";return g.jsx("div",{className:`${z}-label tl-text-wrapper tl-plain-text-wrapper`,"aria-hidden":!I,"data-font":s,"data-align":l,"data-hastext":!E,"data-isediting":I,"data-is-ready-for-editing":P,"data-textwrap":!!u,"data-isselected":d,style:{justifyContent:l==="middle"||L?"center":l,alignItems:c==="middle"?"center":c,padding:h,...b},children:g.jsxs("div",{className:`${z}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:a.toString(),minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(v||0),color:i,width:v?Math.ceil(v):void 0,height:x?Math.ceil(x):void 0},children:[g.jsx("div",{className:`${z} tl-text tl-text-content`,dir:"auto",children:A.split(`
`).map(($,H)=>g.jsx("div",{dir:"auto",children:$},H))}),(P||d)&&g.jsx(nyt,{ref:C,text:r,isEditing:I,shapeId:e,..._,handleKeyDown:f??_.handleKeyDown})]})})});function $l(){return Ud({isDarkMode:NS()})}function k9(t){return{key:`${Td.id}:${t}`,async getElement(){return t!=="pattern"?null:g.jsx(oyt,{})}}}function oyt(){const t=M9(),e=Hg(),n=$l(),r=8/12;return g.jsxs(g.Fragment,{children:[g.jsxs("mask",{id:e,children:[g.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),g.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[g.jsx("line",{x1:r*1,y1:r*3,x2:r*3,y2:r*1}),g.jsx("line",{x1:r*5,y1:r*7,x2:r*7,y2:r*5}),g.jsx("line",{x1:r*9,y1:r*11,x2:r*11,y2:r*9})]})]}),g.jsx("pattern",{id:t(1,n.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:g.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:n.solid,mask:`url(#${e})`})})]})}function A9(){return{key:`${Td.id}:pattern`,component:uyt}}const Vb=8,Vte=(t,e,n)=>new Promise((r,i)=>{const s=Vb*e*t,o=document.createElement("canvas");o.width=s,o.height=s;const a=o.getContext("2d");if(!a)return;a.fillStyle=n?BI.darkMode.solid:BI.lightMode.solid,a.fillRect(0,0,s,s),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*t;const l=8/12,c=u=>u*e*t;a.beginPath(),a.moveTo(c(l*1),c(l*3)),a.lineTo(c(l*3),c(l*1)),a.moveTo(c(l*5),c(l*7)),a.lineTo(c(l*7),c(l*5)),a.moveTo(c(l*9),c(l*11)),a.lineTo(c(l*11),c(l*9)),a.stroke(),o.toBlob(u=>{!u||Jn.throwToBlob.get()?i():r(u)})}),Wte=(t,e)=>{const n=document.createElement("canvas");n.width=t[0],n.height=t[1];const r=n.getContext("2d");return r?(e(r),n.toDataURL()):""};let DL=null;function ayt(){return DL||(DL={white:Wte([1,1],t=>{t.fillStyle="#f8f9fa",t.fillRect(0,0,1,1)}),black:Wte([1,1],t=>{t.fillStyle="#212529",t.fillRect(0,0,1,1)})}),DL}function Vwe(t){return Math.ceil(Math.log2(Math.max(1,t)))}function M9(){const t=fc("hash_pattern");return S.useCallback((e,n)=>{const r=Vwe(e);return bU(t,`${n}_${r}`)},[t])}function Wwe(t){const e=[],r=Vwe(t);for(let i=0;i<=r;i++)e.push(Math.pow(2,i));return e}function lyt(t){const e=ayt();return Wwe(t).flatMap(n=>[{zoom:n,url:e.white,theme:"light"},{zoom:n,url:e.black,theme:"dark"}])}function cyt(){const t=re(),e=ie("devicePixelRatio",()=>t.getInstanceState().devicePixelRatio,[t]),n=ie("maxZoom",()=>Math.ceil(Yi(t.getCameraOptions().zoomSteps)),[t]),[r,i]=S.useState(!1),[s,o]=S.useState(()=>lyt(n)),a=M9();return S.useEffect(()=>{const c=Promise.all(Wwe(n).flatMap(d=>[Vte(e,d,!1).then(h=>({zoom:d,theme:"light",url:URL.createObjectURL(h)})),Vte(e,d,!0).then(h=>({zoom:d,theme:"dark",url:URL.createObjectURL(h)}))]));let u=!1;return c.then(d=>{u||(o(d),i(!0))}),()=>{u=!0,i(!1),c.then(d=>{for(const{url:h}of d)URL.revokeObjectURL(h)})}},[e,n]),{defs:g.jsx(g.Fragment,{children:s.map(c=>{const u=a(c.zoom,c.theme);return g.jsx("pattern",{id:u,width:Vb,height:Vb,patternUnits:"userSpaceOnUse",children:g.jsx("image",{href:c.url,width:Vb,height:Vb})},u)})}),isReady:r}}function uyt(){const t=re(),e=S.useRef(null),{defs:n,isReady:r}=cyt();return S.useEffect(()=>{if(r&&sn.isSafari){const i=Kwe(e.current);i&&t.timers.requestAnimationFrame(()=>{i.style.display="none",t.timers.requestAnimationFrame(()=>{i.style.display=""})})}},[t,r]),g.jsx("g",{ref:e,"data-testid":r?"ready-pattern-fill-defs":void 0,children:n})}function Kwe(t){return t.classList.contains("tl-html-layer")?t:t.parentElement?Kwe(t.parentElement):null}const Aw=$e.memo(function({theme:e,d:n,color:r,fill:i,scale:s}){switch(i){case"none":return null;case"solid":return g.jsx("path",{fill:e[r].semi,d:n});case"semi":return g.jsx("path",{fill:e.solid,d:n});case"fill":return g.jsx("path",{fill:e[r].fill,d:n});case"pattern":return g.jsx(dyt,{theme:e,color:r,fill:i,d:n,scale:s})}});function dyt({d:t,color:e,theme:n}){const r=re(),i=MS(),s=ie("zoomLevel",()=>r.getZoomLevel(),[r]),o=M9(),a=r.getZoomLevel()<=.18;return g.jsxs(g.Fragment,{children:[g.jsx("path",{fill:n[e].pattern,d:t}),g.jsx("path",{fill:i?`url(#${o(1,n.id)})`:a?n[e].semi:`url(#${o(s,n.id)})`,d:t})]})}function hyt(t){return t.replace(/\s/g," ")}function dB(t,e,n){const{padding:r=0}=n;if(e.length===0)return null;const i=Ee.From(e[0].box);for(const{box:c}of e)i.union(c);const s=r+(n.offsetX??0),o=(n.offsetY??0)+n.fontSize/2+(n.verticalTextAlign==="start"?r:n.verticalTextAlign==="end"?n.height-r-i.height:(Math.ceil(n.height)-i.height)/2);let a=null;const l=[];for(const{text:c,box:u}of e)a!==null&&u.y>a&&l.push(g.jsx("tspan",{alignmentBaseline:"mathematical",x:s,y:u.y+o,children:`
`},l.length)),l.push(g.jsx("tspan",{alignmentBaseline:"mathematical",x:u.x+s,y:u.y+o,unicodeBidi:"plaintext",children:hyt(c)},l.length)),a=u.y;return g.jsx("text",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:n.stroke,strokeWidth:n.strokeWidth,fill:n.fill,children:l})}function fyt({fontSize:t,font:e,align:n,verticalAlign:r,text:i,labelColor:s,bounds:o,padding:a=16,stroke:l=!0,showTextOutline:c=!0}){const u=re(),d=$l(),h={fontSize:t,fontFamily:the[e],textAlign:n,verticalTextAlign:r,width:Math.ceil(o.width),height:Math.ceil(o.height),padding:a,lineHeight:Ds.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:s,stroke:void 0,strokeWidth:void 0},f=u.textMeasure.measureTextSpans(i,h),y=ryt(n,a,f,o.width);y&&(h.offsetX=y),h.offsetX+=o.x,h.offsetY+=o.y;const b=dB(u,f,h);let v=null;return c&&l&&(h.fill=d.background,h.stroke=d.background,h.strokeWidth=3,v=dB(u,f,h)),g.jsxs(g.Fragment,{children:[v,b]})}function qwe(t,e,n){switch(e.type){case"straight":return new rn().moveTo(e.start.point.x,e.start.point.y,{offset:0,roundness:0}).lineTo(e.end.point.x,e.end.point.y,{offset:0,roundness:0}).toSvg(n);case"arc":return new rn().moveTo(e.start.point.x,e.start.point.y,{offset:0,roundness:0}).circularArcTo(e.bodyArc.radius,!!e.bodyArc.largeArcFlag,!!e.bodyArc.sweepFlag,e.end.point.x,e.end.point.y,{offset:0,roundness:0}).toSvg(n);case"elbow":{const r=new rn;r.moveTo(e.start.point.x,e.start.point.y,{offset:0});for(let i=1;i<e.route.points.length;i++){const s=e.route.points[i];e.route.skipPointsWhenDrawing.has(s)||r.lineTo(s.x,s.y,{offset:i===e.route.points.length-1?0:void 0})}return r.toSvg(n)}default:Yt(e,"type")}}function pyt(t,e){switch(t.type){case"straight":return new rn().moveTo(t.start.handle.x,t.start.handle.y).lineTo(t.end.handle.x,t.end.handle.y).toSvg(e);case"arc":return new rn().moveTo(t.start.handle.x,t.start.handle.y).circularArcTo(t.handleArc.radius,!!t.handleArc.largeArcFlag,!!t.handleArc.sweepFlag,t.end.handle.x,t.end.handle.y).toSvg(e);case"elbow":{const n=qft(t.elbow,t.route);return rn.lineThroughPoints(n.points).toSvg(e)}default:Yt(t,"type")}}function e1(t,e){const n=vl(t,e);switch(n.type){case"straight":return new Vy({start:M.From(n.start.point),end:M.From(n.end.point)});case"arc":return new $me({center:M.Cast(n.handleArc.center),start:M.Cast(n.start.point),end:M.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});case"elbow":return new AS({points:n.route.points});default:Yt(n,"type")}}const gyt=_k("arrow label size",(t,e)=>{t.fonts.trackFontsForShape(e);let n=0,r=0;const i=e1(t,e),s=e.props.text||"i",o=i.bounds,a=hB(e),{w:l,h:c}=t.textMeasure.measureText(s,{...Ds,fontFamily:xf[e.props.font],fontSize:a,maxWidth:null});n=l,r=c;let u=!1;const d=vl(t,e),h=Ywe(e),f=d.type==="elbow"?Math.max(d.elbow.A.arrowheadOffset+h,32)+Math.max(d.elbow.B.arrowheadOffset+h,32):64;if(o.width>o.height?(n=Math.max(Math.min(l,f),Math.min(o.width-f,l)),u=!0):n>16*a&&(n=16*a,u=!0),u){const{w:y,h:b}=t.textMeasure.measureText(s,{...Ds,fontFamily:xf[e.props.font],fontSize:a,maxWidth:n});n=y,r=b}return new M(n,r).addScalar(X$*2*e.props.scale)},{areRecordsEqual:(t,e)=>{if(t.props===e.props)return!0;const n=eWe(t.props,e.props);return n.length===1&&n[0]==="labelPosition"}});function Gwe(t,e){return gyt.get(t,e.id)??new M(0,0)}function Ywe(t){const e=ri[t.props.size];return(Tpt+(e-ri.s)*2+(e===ri.xl?20:0))*t.props.scale}function myt(t,e,n){const r=e1(t,e),i=[],s=[new yo({children:[r],debugColor:"lime"})],o=Gwe(t,e),a=Ywe(e),l=a/r.length;let c,u;if(n.type==="elbow")i.push(n.start.point,n.end.point),c=Ee.FromCenter(n.start.point,o).expandBy(a),u=Ee.FromCenter(n.end.point,o).expandBy(a);else{const x=r.interpolateAlongEdge(l),C=r.interpolateAlongEdge(1-l);i.push(x,C),c=Ee.FromCenter(x,o),u=Ee.FromCenter(C,o)}const d=r.intersectPolygon(c.corners),h=r.intersectPolygon(u.corners),f=Kte(n.start.point,d),y=Kte(n.end.point,h);let b=f?r.uninterpolateAlongEdge(f):.5,v=y?r.uninterpolateAlongEdge(y):.5;b>v&&(b=.5,v=.5);for(const x of[...d,...h,...i])s.push(new tP({x:x.x-3,y:x.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));return s.push(new uw({points:c.corners,debugColor:"lime",isFilled:!1,ignore:!0}),new uw({points:u.corners,debugColor:"lime",isFilled:!1,ignore:!0})),{start:b,end:v,dbg:s}}function oT(t,e){const n=[],r=vl(t,e),i={hasStartBinding:!!r.bindings.start,hasEndBinding:!!r.bindings.end,hasStartArrowhead:r.start.arrowhead!=="none",hasEndArrowhead:r.end.arrowhead!=="none"},s=myt(t,e,r);s.dbg&&n.push(...s.dbg);const o=yyt(e,s,i),l=e1(t,e).interpolateAlongEdge(o),c=Gwe(t,e);return{box:Ee.FromCenter(l,c),debugGeom:n}}function yyt(t,e,n){const{hasEndArrowhead:r,hasEndBinding:i,hasStartBinding:s,hasStartArrowhead:o}=n;return Ct(t.props.labelPosition,o||s?e.start:0,r||i?e.end:1)}function Kte(t,e){let n=null,r=-1/0;for(const i of e){const s=M.Dist2(t,i);s>r&&(n=i,r=s)}return n}function hB(t){return Ept[t.props.size]*t.props.scale}function Xwe(t,e){const n=vl(t,e);switch(n.type){case"straight":case"arc":return .5;case"elbow":{const r=n.route.midpointHandle,i=e1(t,e);return r&&i?i.uninterpolateAlongEdge(r.point):.5}default:Yt(n,"type")}}function vyt(t,e,n){const r=e==="end"?t.end.point:t.start.point;let i;switch(t.type){case"straight":{const s=e==="end"?t.start.point:t.end.point,o=M.Dist(s,r),a=Ct(o/5,n,n*3);i=M.Nudge(r,s,a);break}case"arc":{const s=Math.abs(t.bodyArc.length),o=Ct(s/5,n,n*3),a=DYe(r,o,t.handleArc.center,t.handleArc.radius);i=e==="end"?t.handleArc.sweepFlag?a[0]:a[1]:t.handleArc.sweepFlag?a[1]:a[0];break}case"elbow":{const s=e==="end"?t.route.points[t.route.points.length-2]:t.route.points[1],o=M.ManhattanDist(s,r),a=Ct(o/2,n,n*3);i=s?M.Nudge(r,s,a):r;break}default:Yt(t,"type")}return M.IsNaN(i)&&(i=r),{point:r,int:i}}function byt({point:t,int:e}){const n=M.RotWith(e,t,un/6),r=M.RotWith(e,t,-un/6);return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${r.x} ${r.y}`}function xyt({point:t,int:e}){const n=M.RotWith(e,t,un/6),r=M.RotWith(e,t,-un/6);return`M ${n.x} ${n.y} L ${r.x} ${r.y} L ${t.x} ${t.y} Z`}function wyt({point:t,int:e}){const n=M.Sub(e,t).div(2),r=M.Add(t,M.Rot(n,Zn)),i=M.Sub(t,M.Rot(n,Zn));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function Syt({point:t,int:e}){const n=M.Lrp(t,e,.45),r=M.Dist(n,t);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function Cyt({point:t,int:e}){const n=M.Lrp(t,e,.75),r=M.RotWith(n,t,un/4),i=M.RotWith(n,t,-un/4),s=M.Lrp(r,i,.5);return s.add(M.Sub(s,t)),`M ${s.x} ${s.y} L ${i.x} ${i.y} ${t.x} ${t.y} L ${r.x} ${r.y} Z`}function Eyt({int:t,point:e}){const n=M.Lrp(e,t,.85),r=M.Sub(n,e).div(2),i=M.Add(e,M.Rot(r,Zn)),s=M.Sub(e,M.Rot(r,Zn)),o=M.Add(n,M.Rot(r,Zn)),a=M.Sub(n,M.Rot(r,Zn));return`M ${i.x} ${i.y} L ${o.x} ${o.y} L ${a.x} ${a.y} L ${s.x} ${s.y} Z`}function Tyt({int:t,point:e}){const n=M.Sub(t,e).div(2),r=M.Add(e,M.Rot(n,Zn)),i=M.Sub(e,M.Rot(n,Zn));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function r_(t,e,n){const r=e==="end"?t.end.arrowhead:t.start.arrowhead;if(r==="none")return;const i=vyt(t,e,n);if(i){switch(r){case"bar":return Tyt(i);case"square":return Eyt(i);case"diamond":return Cyt(i);case"dot":return Syt(i);case"inverted":return wyt(i);case"arrow":return byt(i);case"triangle":return xyt(i)}return""}}function Iyt({arrow:t}){var o,a;const e=re(),n=ie("elbow arrow grid",()=>{try{return cwe(e,e.getShape(t.id),wi(e,t))}catch(l){console.error(l);return}},[e,t.id]);if(!n)return null;const r=Ee.Common([n.A.original,n.B.original]).expandBy(50),i=((o=n.route)==null?void 0:o.name)??"",s=(a=n.route)==null?void 0:a.midpointHandle;return g.jsxs(g.Fragment,{children:[n.midX!==null&&g.jsx(Dp,{a:{x:n.midX,y:r.minY},b:{x:n.midX,y:r.maxY},stroke:"red"}),n.midY!==null&&g.jsx(Dp,{a:{x:r.minX,y:n.midY},b:{x:r.maxX,y:n.midY},stroke:"blue"}),(s==null?void 0:s.axis)==="x"&&n.midXRange&&g.jsx(Dp,{a:{x:n.midXRange.lo,y:s.point.y},b:{x:n.midXRange.hi,y:s.point.y},stroke:"red",strokeDasharray:"0 2"}),(s==null?void 0:s.axis)==="y"&&n.midYRange&&g.jsx(Dp,{a:{x:s.point.x,y:n.midYRange.lo},b:{x:s.point.x,y:n.midYRange.hi},stroke:"blue",strokeDasharray:"0 2"}),g.jsx(Bm,{box:n.A.original,stroke:"orange"}),g.jsx(Bm,{box:n.A.expanded,stroke:"orange",strokeWidth:.5}),g.jsx(Bm,{box:n.A.original.clone().expandBy(n.options.minElbowLegLength),stroke:"orange",strokeWidth:.5}),g.jsx(Bm,{box:n.B.original,stroke:"lightskyblue"}),g.jsx(Bm,{box:n.B.expanded,stroke:"lightskyblue",strokeWidth:.5}),g.jsx(Bm,{box:n.B.original.clone().expandBy(n.options.minElbowLegLength),stroke:"lightskyblue",strokeWidth:.5}),g.jsx(Th,{edge:n.A.edges.top,axis:"x",stroke:"orange"}),g.jsx(Th,{edge:n.B.edges.top,axis:"x",stroke:"lightskyblue"}),g.jsx(Th,{edge:n.A.edges.right,axis:"y",stroke:"orange"}),g.jsx(Th,{edge:n.B.edges.right,axis:"y",stroke:"lightskyblue"}),g.jsx(Th,{edge:n.A.edges.bottom,axis:"x",stroke:"orange"}),g.jsx(Th,{edge:n.B.edges.bottom,axis:"x",stroke:"lightskyblue"}),g.jsx(Th,{edge:n.A.edges.left,axis:"y",stroke:"orange"}),g.jsx(Th,{edge:n.B.edges.left,axis:"y",stroke:"lightskyblue"}),n.route&&g.jsx(Pyt,{route:n.route.points,strokeWidth:10}),g.jsx("text",{x:r.minX+5,y:r.minY-3,fontSize:10,fill:"black",stroke:"var(--color-background)",strokeWidth:2,paintOrder:"stroke",children:i}),g.jsxs("text",{x:n.A.expanded.x,y:n.A.expanded.y,fontSize:10,fill:"black",stroke:"var(--color-background)",strokeWidth:2,paintOrder:"stroke",children:["A",n.route&&`, ${n.route.aEdgePicking}`,n.A.isPoint&&", point"]}),g.jsxs("text",{x:n.B.expanded.x,y:n.B.expanded.y,fontSize:10,fill:"black",stroke:"var(--color-background)",strokeWidth:2,paintOrder:"stroke",children:["B",n.route&&`, ${n.route.bEdgePicking}`,n.B.isPoint&&", point"]})]})}function Dp({a:t,b:e,...n}){return g.jsx("line",{fill:"none",strokeWidth:1,strokeDasharray:"4,4",stroke:"green",x1:t.x,y1:t.y,x2:e.x,y2:e.y,...n})}function Pyt({route:t,...e}){return g.jsx("polyline",{fill:"none",stroke:"darkorchid",strokeWidth:3,opacity:.5,points:t.map(n=>`${n.x},${n.y}`).join(" "),...e})}function Th({edge:t,axis:e,...n}){if(!t||t.expanded===null)return null;const r=i=>e==="x"?{x:i.y,y:i.x}:i;return g.jsxs("g",{children:[g.jsx(Dp,{a:r({x:t.expanded,y:t.cross.min}),b:r({x:t.expanded,y:t.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...n}),g.jsx(Dp,{a:r({x:t.expanded-4,y:t.cross.min}),b:r({x:t.expanded+4,y:t.cross.min}),strokeDasharray:"0",strokeWidth:1.5,...n}),g.jsx(Dp,{a:r({x:t.expanded-4,y:t.cross.max}),b:r({x:t.expanded+4,y:t.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...n})]})}function Bm({box:t,...e}){return g.jsx("rect",{x:t.minX,y:t.minY,width:t.width,height:t.height,strokeDasharray:"4,4",strokeWidth:1,fill:"none",...e})}const _yt=new zs;function kyt(t){return _yt.get(t,e=>{const n=me("current selected arrow shape",()=>{const i=e.getOnlySelectedShape();return!i||!e.isShapeOfType(i,"arrow")?null:i.id}),r=e.store.query.ids("shape",()=>{const i=n.get();return i?{type:{eq:"arrow"},id:{neq:i}}:{type:{eq:"arrow"}}});return me("elbow arrow snap lines",()=>{var a,l;const i=new Map,s=e.getCurrentPageShapeIds(),o=e.getViewportPageBounds();for(const c of r.get()){if(!s.has(c))continue;const u=e.getShape(c);if((u==null?void 0:u.type)!=="arrow")continue;const d=e.getShapePageBounds(c);if(!d||!o.includes(d))continue;const h=wi(e,u),f=e.getShapePageTransform(c);if(!f)continue;const y=e.getShapeGeometry(c),b=f.applyToPoints(y.vertices);for(let v=1;v<b.length;v++){const x=b[v-1],C=b[v];let E=M.Angle(x,C);E<0&&(E+=Math.PI);let I=i.get(E);I||(I=new Set,i.set(E,I));const P=Wb(x,E);I.add({perpDistance:P,startBoundShapeId:(a=h.start)==null?void 0:a.toId,endBoundShapeId:(l=h.end)==null?void 0:l.toId})}}return i})}).get()}function Wb(t,e){const n=M.FromAngle(e).per();return M.Dpr(t,n)}class aT extends pc{constructor(){super(...arguments);N(this,"options",{expandElbowLegLength:{s:28,m:36,l:44,xl:66},minElbowLegLength:{s:ri.s*3,m:ri.m*3,l:ri.l*3,xl:ri.xl*3},minElbowHandleDistance:16,arcArrowCenterSnapDistance:16,elbowArrowCenterSnapDistance:24,elbowArrowEdgeSnapDistance:20,elbowArrowPointSnapDistance:24,elbowArrowAxisSnapDistance:16,labelCenterSnapDistance:10,elbowMidpointSnapDistance:10,elbowMinSegmentLengthToShowMidpointHandle:20,hoverPreciseTimeout:600,pointingPreciseTimeout:320,shouldBeExact:n=>n.inputs.altKey,shouldIgnoreTargets:n=>n.inputs.ctrlKey});N(this,"_resizeInitialBindings",new zs)}canEdit(){return!0}canBind({toShapeType:n}){return n!=="arrow"}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(n,r){if(r.type==="flip"){const i=wi(this.editor,n),{start:s,end:o}=i,{shapes:a=[]}=r;if(s&&!a.find(l=>l.id===s.toId)||o&&!a.find(l=>l.id===o.toId))return!1}return!0}getFontFaces(n){return n.props.text?[E9[`tldraw_${n.props.font}`].normal.normal]:Mr}getDefaultProps(){return{kind:"arc",elbowMidPoint:.5,dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(n){const r=this.editor.getEditingShapeId()===n.id,i=vl(this.editor,n),s=[],o=i.type==="straight"?new Vy({start:M.From(i.start.point),end:M.From(i.end.point)}):i.type==="arc"?new $me({center:M.Cast(i.handleArc.center),start:M.Cast(i.start.point),end:M.Cast(i.end.point),sweepFlag:i.bodyArc.sweepFlag,largeArcFlag:i.bodyArc.largeArcFlag}):new AS({points:i.route.points});let a;if(r||n.props.text.trim()){const l=oT(this.editor,n);Jn.debugGeometry.get()&&s.push(...l.debugGeom),a=new bu({x:l.box.x,y:l.box.y,width:l.box.w,height:l.box.h,isFilled:!0,isLabel:!0})}return new yo({children:[...a?[o,a]:[o],...s]})}getHandles(n){const r=vl(this.editor,n),i=[{id:"start",type:"vertex",index:"a1",x:r.start.handle.x,y:r.start.handle.y},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y}];if(n.props.kind==="arc"&&(r.type==="straight"||r.type==="arc")&&i.push({id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y}),n.props.kind==="elbow"&&r.type==="elbow"&&r.route.midpointHandle){const s=this.editor.getShapePageTransform(n.id),o=s.applyToPoint(r.route.midpointHandle.segmentStart),a=s.applyToPoint(r.route.midpointHandle.segmentEnd);M.Dist(o,a)*this.editor.getZoomLevel()>this.options.elbowMinSegmentLengthToShowMidpointHandle&&i.push({id:"middle",type:"vertex",index:"a2",x:r.route.midpointHandle.point.x,y:r.route.midpointHandle.point.y})}return i}getText(n){return n.props.text}onHandleDrag(n,r){const i=r.handle.id;switch(i){case"middle":switch(n.props.kind){case"arc":return this.onArcMidpointHandleDrag(n,r);case"elbow":return this.onElbowMidpointHandleDrag(n,r);default:Yt(n.props.kind)}case"start":case"end":return this.onTerminalHandleDrag(n,r,i);default:Yt(i)}}onArcMidpointHandleDrag(n,{handle:r}){const i=wi(this.editor,n),{start:s,end:o}=ry(this.editor,n,i),a=M.Sub(o,s),l=M.Per(a),c=M.Med(o,s),u=M.Sub(c,l),d=M.Add(c,l),h=M.NearestPointOnLineSegment(u,d,r,!1);let f=M.Dist(h,c);return M.Clockwise(h,o,c)&&(f*=-1),{id:n.id,type:n.type,props:{bend:f}}}onElbowMidpointHandleDrag(n,{handle:r}){var E,I,P,_,A;const i=vl(this.editor,n);if((i==null?void 0:i.type)!=="elbow")return;const s=this.editor.getShapePageTransform(n.id),o=s.applyToPoint(r),a=(E=i.route.midpointHandle)==null?void 0:E.axis;if(!a)return;const l=Iw[a],c=i.elbow[l.midRange];if(!c)return;let u=M.Angle(s.applyToPoint(l.v(0,0)),s.applyToPoint(l.v(0,1)));u<0&&(u+=Math.PI);const d=Wb(o,u),h=Wb(s.applyToPoint(l.v(c.lo,0)),u),f=Wb(s.applyToPoint(l.v(c.hi,0)),u),y=this.options.elbowMidpointSnapDistance/this.editor.getZoomLevel(),b=Wb(s.applyToPoint(l.v(At(c.lo,c.hi,.5),0)),u);let v=b,x=Math.abs(b-d);for(const[D,L]of kyt(this.editor)){const{isParallel:z,isFlippedParallel:$}=Oyt(u,D);if(z||$)for(const H of L){const R=H.startBoundShapeId&&(H.startBoundShapeId===((I=i.bindings.start)==null?void 0:I.toId)||H.startBoundShapeId===((P=i.bindings.end)==null?void 0:P.toId)),j=H.endBoundShapeId&&(H.endBoundShapeId===((_=i.bindings.start)==null?void 0:_.toId)||H.endBoundShapeId===((A=i.bindings.end)==null?void 0:A.toId));if(!R&&!j)continue;const B=$?-H.perpDistance:H.perpDistance,K=Math.abs(B-d);K<x&&(v=B,x=K)}}x>y&&(v=d);const C=Ct(iw(h,f,v),0,1);return{id:n.id,type:n.type,props:{elbowMidPoint:C}}}onTerminalHandleDrag(n,{handle:r,isPrecise:i},s){const o=wi(this.editor,n),a={id:n.id,type:"arrow",props:{}},l=o[s],u=o[s==="start"?"end":"start"],d=BA({editor:this.editor,pointInPageSpace:this.editor.getShapePageTransform(n.id).applyToPoint(r),arrow:n,isPrecise:i,currentBinding:l,oppositeBinding:u});if(!d){Bb(this.editor,n,s);const y=Ba(new M(r.x,r.y),this.editor);return a.props[s]={x:y.x,y:y.y},a}const h={terminal:s,normalizedAnchor:d.normalizedAnchor,isPrecise:d.isPrecise,isExact:d.isExact,snap:d.snap};ub(this.editor,n,d.target.id,h);const f=wi(this.editor,n);return f.start&&f.end&&f.start.toId===f.end.toId&&M.Equals(f.start.props.normalizedAnchor,f.end.props.normalizedAnchor)&&ub(this.editor,n,f.end.toId,{...f.end.props,normalizedAnchor:{x:f.end.props.normalizedAnchor.x+.05,y:f.end.props.normalizedAnchor.y}}),a}onTranslateStart(n){const r=wi(this.editor,n);if(n.props.kind==="elbow"&&this.editor.getOnlySelectedShapeId()===n.id){const a=vl(this.editor,n);if(!a)return;const l={id:n.id,type:"arrow",props:{}};return r.start&&(l.props.start={x:a.start.point.x,y:a.start.point.y},Bb(this.editor,n,"start")),r.end&&(l.props.end={x:a.end.point.x,y:a.end.point.y},Bb(this.editor,n,"end")),l}const i=ry(this.editor,n,r),s=this.editor.getShapePageTransform(n.id),o=this.editor.getSelectedShapeIds();if(!(r.start&&(o.includes(r.start.toId)||this.editor.isAncestorSelected(r.start.toId))||r.end&&(o.includes(r.end.toId)||this.editor.isAncestorSelected(r.end.toId)))){Gte.set(n,{pagePosition:s.applyToPoint(n),terminalBindings:Mf(i,(a,l)=>{const c=r[a];return c?{binding:c,shapePosition:l,pagePosition:s.applyToPoint(l)}:null})}),r.start&&(IP({editor:this.editor,arrow:n,terminal:"start",useHandle:!0}),n=this.editor.getShape(n.id)),r.end&&IP({editor:this.editor,arrow:n,terminal:"end",useHandle:!0});for(const a of["start","end"]){const l=r[a];l&&this.editor.updateBinding({...l,props:{...l.props,isPrecise:!0}})}}}onTranslate(n,r){const i=Gte.get(n);if(!i)return;const s=this.editor.getShapePageTransform(r.id),o=M.Sub(s.applyToPoint(r),i.pagePosition);for(const a of Object.values(i.terminalBindings)){if(!a)continue;const l=M.Add(a.pagePosition,M.Mul(o,.5)),c=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:u=>!u.isLocked&&this.editor.canBindShapes({fromShape:r,toShape:u,binding:"arrow"})});if((c==null?void 0:c.id)===a.binding.toId){const u=Ee.ZeroFix(this.editor.getShapeGeometry(c).bounds),d=this.editor.getPointInShapeSpace(c,l),h={x:(d.x-u.minX)/u.width,y:(d.y-u.minY)/u.height};ub(this.editor,r,c.id,{...a.binding.props,normalizedAnchor:h,isPrecise:!0})}else Bb(this.editor,r,a.binding.props.terminal)}}onResize(n,r){const{scaleX:i,scaleY:s}=r,o=this._resizeInitialBindings.get(n,()=>wi(this.editor,n)),a=ry(this.editor,n,o),{start:l,end:c}=ar(n.props);let{bend:u}=n.props;o.start||(l.x=a.start.x*i,l.y=a.start.y*s),o.end||(c.x=a.end.x*i,c.y=a.end.y*s);const d=Math.abs(i),h=Math.abs(s),f=o!=null&&o.start?M.From(o.start.props.normalizedAnchor):null,y=o!=null&&o.end?M.From(o.end.props.normalizedAnchor):null;return i<0&&s>=0?(u!==0&&(u*=-1,u*=Math.max(d,h)),f&&(f.x=1-f.x),y&&(y.x=1-y.x)):i>=0&&s<0?(u!==0&&(u*=-1,u*=Math.max(d,h)),f&&(f.y=1-f.y),y&&(y.y=1-y.y)):i>=0&&s>=0?u!==0&&(u*=Math.max(d,h)):i<0&&s<0&&(u!==0&&(u*=Math.max(d,h)),f&&(f.x=1-f.x,f.y=1-f.y),y&&(y.x=1-y.x,y.y=1-y.y)),o.start&&f&&ub(this.editor,n,o.start.toId,{...o.start.props,normalizedAnchor:f.toJson()}),o.end&&y&&ub(this.editor,n,o.end.toId,{...o.end.props,normalizedAnchor:y.toJson()}),{props:{start:l,end:c,bend:u}}}onDoubleClickHandle(n,r){switch(r.id){case"start":return{id:n.id,type:n.type,props:{...n.props,arrowheadStart:n.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:n.id,type:n.type,props:{...n.props,arrowheadEnd:n.props.arrowheadEnd==="none"?"arrow":"none"}}}}component(n){const r=$l(),i=this.editor.getOnlySelectedShape(),s=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),o=vl(this.editor,n);if(!(o!=null&&o.isValid))return null;const a=oT(this.editor,n),l=n.id===this.editor.getOnlySelectedShapeId(),u=this.editor.getEditingShapeId()===n.id||n.props.text;return g.jsxs(g.Fragment,{children:[g.jsxs(pf,{style:{minWidth:50,minHeight:50},children:[g.jsx(qte,{shape:n,shouldDisplayHandles:s&&(i==null?void 0:i.id)===n.id}),n.props.kind==="elbow"&&Jn.debugElbowArrows.get()&&g.jsx(Iyt,{arrow:n})]}),u&&g.jsx(syt,{shapeId:n.id,classNamePrefix:"tl-arrow",type:"arrow",font:n.props.font,fontSize:hB(n),lineHeight:Ds.lineHeight,align:"middle",verticalAlign:"middle",text:n.props.text,labelColor:r[n.props.labelColor].solid,textWidth:a.box.w-X$*2*n.props.scale,isSelected:l,padding:0,style:{transform:`translate(${a.box.center.x}px, ${a.box.center.y}px)`}})]})}indicator(n){const r=FS(n.id),i=fc(n.id+"_clip"),s=vl(this.editor,n);if(!s)return null;const{start:o,end:a}=ry(this.editor,n,s==null?void 0:s.bindings),l=this.editor.getShapeGeometry(n),c=l.bounds,u=r||n.props.text.trim()?l.children[1]:null;if(M.Equals(o,a))return null;const d=ri[n.props.size]*n.props.scale,h=s.start.arrowhead&&r_(s,"start",d),f=s.end.arrowhead&&r_(s,"end",d),y=h&&s.start.arrowhead!=="arrow"||f&&s.end.arrowhead!=="arrow"||!!u,b=u?u.getBounds():new Ee(0,0,0,0);if(r&&u)return g.jsx("rect",{x:te(b.x),y:te(b.y),width:b.w,height:b.h,rx:3.5*n.props.scale,ry:3.5*n.props.scale});const v=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),x=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow");return g.jsxs("g",{children:[y&&g.jsx("defs",{children:g.jsx(Jwe,{radius:3.5*n.props.scale,hasText:n.props.text.trim().length>0,bounds:c,labelBounds:b,as:v&&h?h:"",ae:x&&f?f:""})}),g.jsxs("g",{style:{clipPath:y?`url(#${i})`:void 0,WebkitClipPath:y?`url(#${i})`:void 0},children:[y&&g.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.width+200,height:c.height+200,opacity:0}),qwe(n,s,n.props.dash==="draw"?{style:"draw",randomSeed:n.id,strokeWidth:1,passes:1,offset:0,roundness:d*2,props:{strokeWidth:void 0}}:{style:"solid",strokeWidth:1,props:{strokeWidth:void 0}})]}),h&&g.jsx("path",{d:h}),f&&g.jsx("path",{d:f}),u&&g.jsx("rect",{x:te(b.x),y:te(b.y),width:b.w,height:b.h,rx:3.5,ry:3.5})]})}onEditStart(n){if(n.props.text.trim()===""){const r=Xwe(this.editor,n);this.editor.updateShape({id:n.id,type:n.type,props:{labelPosition:r}})}}onEditEnd(n){const{id:r,type:i,props:{text:s}}=n;s.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])}toSvg(n,r){r.addExportDef(k9(n.props.fill));const i=Ud(r),s=1/n.props.scale;return g.jsxs("g",{transform:`scale(${s})`,children:[g.jsx(qte,{shape:n,shouldDisplayHandles:!1}),g.jsx(fyt,{fontSize:hB(n),font:n.props.font,align:"middle",verticalAlign:"middle",text:n.props.text,labelColor:i[n.props.labelColor].solid,bounds:oT(this.editor,n).box.clone().expandBy(-X$*n.props.scale),padding:0,showTextOutline:!0})]})}getCanvasSvgDefs(){return[A9(),{key:"arrow:dot",component:Ayt},{key:"arrow:cross",component:Myt}]}getInterpolatedProps(n,r,i){return{...i>.5?r.props:n.props,scale:At(n.props.scale,r.props.scale,i),start:{x:At(n.props.start.x,r.props.start.x,i),y:At(n.props.start.y,r.props.start.y,i)},end:{x:At(n.props.end.x,r.props.end.x,i),y:At(n.props.end.y,r.props.end.y,i)},bend:At(n.props.bend,r.props.bend,i),labelPosition:At(n.props.labelPosition,r.props.labelPosition,i)}}}N(aT,"type","arrow"),N(aT,"props",rhe),N(aT,"migrations",ihe);const qte=Lr(function({shape:e,shouldDisplayHandles:n}){const r=re(),i=$l(),s=vl(r,e),o=ie("force solid",()=>r.getZoomLevel()<.2,[r]),a=fc(e.id+"_clip"),l=fc("arrowhead-dot"),c=fc("arrowhead-cross"),u=FS(e.id),d=r.getShapeGeometry(e);if(!d)return null;const h=Ee.ZeroFix(d.bounds),f=wi(r,e);if(!(s!=null&&s.isValid))return null;const y=ri[e.props.size]*e.props.scale,b=s.start.arrowhead&&r_(s,"start",y),v=s.end.arrowhead&&r_(s,"end",y);let x=null;n&&(f.start||f.end)&&(x=pyt(s,{style:"dashed",start:"skip",end:"skip",lengthRatio:2.5,strokeWidth:2/r.getZoomLevel(),props:{className:"tl-arrow-hint",markerStart:f.start?f.start.props.isExact?"":f.start.props.isPrecise?`url(#${c})`:`url(#${l})`:"",markerEnd:f.end?f.end.props.isExact?"":f.end.props.isPrecise?`url(#${c})`:`url(#${l})`:"",opacity:.16}}));const C=oT(r,e),E=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),I=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow");return g.jsxs(g.Fragment,{children:[g.jsx("defs",{children:g.jsx("clipPath",{id:a,children:g.jsx(Jwe,{radius:3.5*e.props.scale,hasText:u||e.props.text.trim().length>0,bounds:h,labelBounds:C.box,as:E&&b?b:"",ae:I&&v?v:""})})}),g.jsxs("g",{fill:"none",stroke:i[e.props.color].solid,strokeWidth:y,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[x,g.jsxs("g",{style:{clipPath:`url(#${a})`,WebkitClipPath:`url(#${a})`},children:[g.jsx("rect",{x:te(h.minX-100),y:te(h.minY-100),width:te(h.width+200),height:te(h.height+200),opacity:0}),qwe(e,s,{style:e.props.dash,strokeWidth:y,forceSolid:o,randomSeed:e.id})]}),b&&E&&e.props.fill!=="none"&&g.jsx(Aw,{theme:i,d:b,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),v&&I&&e.props.fill!=="none"&&g.jsx(Aw,{theme:i,d:v,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),b&&g.jsx("path",{d:b}),v&&g.jsx("path",{d:v})]})]})});function Jwe({radius:t,hasText:e,bounds:n,labelBounds:r,as:i,ae:s}){const o=S.useMemo(()=>{const a=new rn;return a.moveTo(n.left-100,n.top-100).lineTo(n.right+100,n.top-100).lineTo(n.right+100,n.bottom+100).lineTo(n.left-100,n.bottom+100).close(),e&&a.moveTo(r.left,r.top+t).lineTo(r.left,r.bottom-t).circularArcTo(t,!1,!1,r.left+t,r.bottom).lineTo(r.right-t,r.bottom).circularArcTo(t,!1,!1,r.right,r.bottom-t).lineTo(r.right,r.top+t).circularArcTo(t,!1,!1,r.right-t,r.top).lineTo(r.left+t,r.top).circularArcTo(t,!1,!1,r.left,r.top+t).close(),a.toD()},[t,e,n.bottom,n.left,n.right,n.top,r.bottom,r.left,r.right,r.top]);return g.jsx("path",{d:`${o}${i}${s}`})}const Gte=new WeakMap;function Ayt(){const t=fc("arrowhead-dot");return g.jsx("marker",{id:t,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:g.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Myt(){const t=fc("arrowhead-cross");return g.jsxs("marker",{id:t,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[g.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),g.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}function Oyt(t,e,n=1e-4){const r=Math.abs(t-e),i=r<n,s=Math.abs(r-Math.PI)<n,o=Math.abs(r-Pn)<n;return{isParallel:i||o,isFlippedParallel:s}}const Yte="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function ev({url:t}){const e=re(),n=ie("zoomLevel",()=>e.getZoomLevel()<.32,[e]),r=S.useCallback(i=>{e.inputs.shiftKey||tr(i)},[e]);return g.jsx("a",{className:nt("tl-hyperlink-button",{"tl-hyperlink-button__hidden":n}),href:t,target:"_blank",rel:"noopener noreferrer",onPointerDown:r,onPointerUp:r,title:t,draggable:!1,children:g.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${Yte}") center 100% / 100% no-repeat`,WebkitMask:`url("${Yte}") center 100% / 100% no-repeat`}})})}const Xte="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",Dyt=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function i_(t){return Dyt.map(n=>{const{offsetX:r,offsetY:i,blur:s,spread:o,color:a}=n,l=new M(r,i),{x:c,y:u}=l.rot(-t);return`${c}px ${u}px ${s}px ${o}px ${a}`}).join(", ")}const Ryt=300,Zwe=320,Nyt=46,jyt=101;class lT extends zv{canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getAriaDescriptor(e){const n=e.props.assetId?this.editor.getAsset(e.props.assetId):null;if(n!=null&&n.props.title)return Owe(n.props.title)+(n.props.description?", "+n.props.description:"")}getDefaultProps(){return{url:"",w:Ryt,h:Zwe,assetId:null}}component(e){return g.jsx(Lyt,{shape:e})}indicator(e){return g.jsx("rect",{width:te(e.props.w),height:te(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return Jte(this.editor,e)}onBeforeUpdate(e,n){if(e.props.url!==n.props.url)if($a.isValid(n.props.url))$yt(this.editor,n);else return{...n,props:{...n.props,url:e.props.url}};if(e.props.assetId!==n.props.assetId)return Jte(this.editor,n)}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:At(e.props.w,n.props.w,r),h:At(e.props.h,n.props.h,r)}}}N(lT,"type","bookmark"),N(lT,"props",uhe),N(lT,"migrations",dhe);function Lyt({shape:t}){const e=re(),n=t.props.assetId?e.getAsset(t.props.assetId):null,r=!!MS()&&sn.isSafari,i=e.getShapePageTransform(t).rotation(),s=Fyt(t),[o,a]=S.useState(!0),l=()=>a(!1),c=S.useCallback(u=>{e.inputs.shiftKey||tr(u)},[e]);return g.jsx(of,{children:g.jsxs("div",{className:nt("tl-bookmark__container",r&&"tl-bookmark__container--safariExport"),style:{boxShadow:r?void 0:i_(i),maxHeight:t.props.h},children:[(!n||n.props.image)&&g.jsxs("div",{className:"tl-bookmark__image_container",children:[n?g.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:n==null?void 0:n.props.image,alt:(n==null?void 0:n.props.title)||""}):g.jsx("div",{className:"tl-bookmark__placeholder"}),(n==null?void 0:n.props.image)&&g.jsx(ev,{url:t.props.url})]}),g.jsxs("div",{className:"tl-bookmark__copy_container",children:[n!=null&&n.props.title?g.jsx("h2",{className:"tl-bookmark__heading",children:Owe(n.props.title)}):null,n!=null&&n.props.description&&(n!=null&&n.props.image)?g.jsx("p",{className:"tl-bookmark__description",children:n.props.description}):null,g.jsxs("a",{className:"tl-bookmark__link",href:t.props.url||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:c,onPointerUp:c,children:[o&&(n!=null&&n.props.favicon)?g.jsx("img",{className:"tl-bookmark__favicon",src:n==null?void 0:n.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:l,alt:`favicon of ${s}`}):g.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${Xte}") center 100% / 100% no-repeat`,WebkitMask:`url("${Xte}") center 100% / 100% no-repeat`}}),g.jsx("span",{children:s})]})]})]})})}function Jte(t,e){const n=e.props.assetId?t.getAsset(e.props.assetId):null;let r=Zwe;return n&&(n.props.image||(n.props.title?r=jyt:r=Nyt)),{...e,props:{...e.props,h:r}}}const Fyt=t=>{try{return new URL(t.props.url).hostname.replace(/^www\./,"")}catch{return t.props.url}};function $yt(t,e){const{url:n}=e.props,r=Nf.createId(_z(n));t.getAsset(r)?e.props.assetId!==r&&t.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(t.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),Byt(t,e))}const Byt=vk(async(t,e)=>{if(t.isDisposed)return;const{url:n}=e.props,r=await t.getAssetForExternalContent({type:"url",url:n});r&&t.run(()=>{t.createAssets([r]),t.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function Mw(t,e=!1){const n=t.length;if(n<2)return"";let r=t[0].point,i=t[1].point;if(n===2)return`M${Ji(r)}L${Ji(i)}`;let s="";for(let o=2,a=n-1;o<a;o++)r=t[o].point,i=t[o+1].point,s+=Vo(r,i);return e?`M${Vo(t[0].point,t[1].point)}Q${Ji(t[1].point)}${Vo(t[1].point,t[2].point)}T${s}${Vo(t[n-1].point,t[0].point)}${Vo(t[0].point,t[1].point)}Z`:`M${Ji(t[0].point)}Q${Ji(t[1].point)}${Vo(t[1].point,t[2].point)}${t.length>3?"T":""}${s}L${Ji(t[n-1].point)}`}function zyt(t,e={}){const{start:n={},end:r={}}=e,{cap:i=!0}=n,{cap:s=!0}=r;it(!n.taper&&!r.taper,"cap taper not supported here"),it(!n.easing&&!r.easing,"cap easing not supported here"),it(i&&s,"cap must be true");const o=bf(t,e);d9(o,e);const a=Uyt(o);let l="";for(const c of a)l+=Vyt(c,e);return l}function Uyt(t){if(t.length<=2)return[t];const e=[];let n=[t[0]],r=M.Sub(t[1].point,t[0].point).uni(),i,s,o,a,l;for(let c=1,u=t.length;c<u-1;c++){if(o=t[c-1],a=t[c],l=t[c+1],i=M.Sub(l.point,a.point).uni(),s=M.Dpr(r,i),r=i,s<-.8){const d={...a,point:a.input};n.push(d),e.push(RL(n)),n=[d];continue}if(n.push(a),!(s>.7)&&(M.Dist2(o.point,a.point)+M.Dist2(a.point,l.point))/((o.radius+a.radius+l.radius)/3)**2<1.5){n.push(a),e.push(RL(n)),n=[a];continue}}return n.push(t[t.length-1]),e.push(RL(n)),e}function RL(t){const e=t[0];let n;for(;t.length>2&&(n=t[1],M.Dist2(e.point,n.point)<((e.radius+n.radius)/2*.5)**2);)t.splice(1,1);const r=t[t.length-1];let i;for(;t.length>2&&(i=t[t.length-2],M.Dist2(r.point,i.point)<((r.radius+i.radius)/2*.5)**2);)t.splice(t.length-2,1);return t.length>1&&(t[0]={...t[0],vector:M.Sub(t[0].point,t[1].point).uni()},t[t.length-1]={...t[t.length-1],vector:M.Sub(t[t.length-2].point,t[t.length-1].point).uni()}),t}function Hyt(t,e,n){return"M "+t+" "+e+" m -"+n+", 0 a "+n+","+n+" 0 1,1 "+n*2+",0 a "+n+","+n+" 0 1,1 -"+n*2+",0"}function Vyt(t,e={}){if(t.length===0)return"";if(t.length===1)return Hyt(t[0].point.x,t[0].point.y,t[0].radius);const{left:n,right:r}=dwe(t,e);r.reverse();let i=`M${Ji(n[0])}T`;for(let s=1;s<n.length;s++)i+=Vo(n[s-1],n[s]);{const s=t[t.length-1],o=s.radius,a=s.vector.clone().per().neg(),l=M.Add(s.point,M.Mul(a,o)),c=M.Add(s.point,M.Mul(a,-o));i+=`${Ji(l)}A${te(o)},${te(o)} 0 0 1 ${Ji(c)}T`}for(let s=1;s<r.length;s++)i+=Vo(r[s-1],r[s]);{const s=t[0],o=s.radius,a=s.vector.clone().per(),l=M.Add(s.point,M.Mul(a,o)),c=M.Add(s.point,M.Mul(a,-o));i+=`${Ji(l)}A${te(o)},${te(o)} 0 0 1 ${Ji(c)}Z`}return i}const Qwe=(t,e,n)=>{const r=[],i=[];t.forEach(c=>r.push(...c.points)),e.forEach(c=>i.push(...c.points));const s=Math.max(r.length,i.length),o=[],a=[];for(let c=0;c<s;c++)o.push(r[c]||r[r.length-1]),a.push(i[c]||i[i.length-1]);return[{type:"free",points:o.map((c,u)=>{let d=.5;return a[u].z!==void 0&&c.z!==void 0&&(d=At(c.z,a[u].z,n)),{x:At(c.x,a[u].x,n),y:At(c.y,a[u].y,n),z:d}})}]},Wyt=t=>t*.65+VGe(t*un/2)*.35,Kyt=t=>({size:t,thinning:.5,streamline:yu(t,[9,16],[.64,.74],!0),smoothing:.62,easing:Ms.easeOutSine,simulatePressure:!0}),qyt=t=>({size:1+t*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Wyt}),Zte=t=>({size:t,thinning:0,streamline:yu(t,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:Ms.linear}),Gyt=t=>({size:t,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Ms.linear});function O9({strokeWidth:t,showAsComplete:e}){return{size:1+t,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Ms.easeOutSine,last:e}}function fB(t,e,n,r){const i=t.isComplete||n;return r?t.isPen?{...Gyt(e),last:i}:{...Zte(e),last:i}:t.dash==="draw"?t.isPen?{...qyt(e),last:i}:{...Kyt(e),last:i}:{...Zte(e),last:i}}function tv(t){const e=[];for(const n of t)if(n.type==="free"||n.points.length<2)e.push(...n.points.map(M.Cast));else{const r=Math.max(4,Math.floor(M.Dist(n.points[0],n.points[1])/16));e.push(...M.PointsBetween(n.points[0],n.points[1],r))}return e}function Yyt(t,e,n){return{draw:"none",solid:"none",dotted:`${n} ${e*2}`,dashed:`${e*2} ${e*2}`}[t.props.dash]}class cT extends pc{constructor(){super(...arguments);N(this,"options",{maxPointsPerShape:600})}hideResizeHandles(n){return NL(n)}hideRotateHandle(n){return NL(n)}hideSelectionBoundsFg(n){return NL(n)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(n){const r=tv(n.props.segments),i=(ri[n.props.size]+1)*n.props.scale;if(n.props.segments.length===1){const o=Ee.FromPoints(r);if(o.width<i*2&&o.height<i*2)return new tP({x:-i,y:-i,radius:i,isFilled:!0})}const s=bf(r,fB(n.props,i,n.props.isPen,!0)).map(o=>o.point);return n.props.isClosed&&s.length>2?new uw({points:s,isFilled:n.props.fill!=="none"}):s.length===1?new tP({x:-i,y:-i,radius:i,isFilled:!0}):new AS({points:s})}component(n){return g.jsx(pf,{children:g.jsx(Qte,{shape:n})})}indicator(n){var u;const r=tv(n.props.segments);let i=(ri[n.props.size]+1)*n.props.scale;!ie("force solid",()=>{const d=this.editor.getZoomLevel();return d<.5&&d<1.5/i},[this.editor,i])&&!n.props.isPen&&n.props.dash==="draw"&&r.length===1&&(i+=Fg(n.id)()*(i/6));const o=n.props.isComplete||((u=Yi(n.props.segments))==null?void 0:u.type)==="straight",a=fB(n.props,i,o,!0),l=bf(r,a),c=l.length>1?Mw(l,n.props.isClosed):eSe(r[0],i);return g.jsx("path",{d:c})}toSvg(n,r){r.addExportDef(k9(n.props.fill));const i=1/n.props.scale;return g.jsx("g",{transform:`scale(${i})`,children:g.jsx(Qte,{shape:n,zoomOverride:1})})}getCanvasSvgDefs(){return[A9()]}onResize(n,r){const{scaleX:i,scaleY:s}=r,o=[];for(const a of n.props.segments)o.push({...a,points:a.points.map(({x:l,y:c,z:u})=>({x:ic(i*l),y:ic(s*c),z:u}))});return{props:{segments:o}}}expandSelectionOutlinePx(n){const r=n.props.dash==="draw"?1.6:1;return ri[n.props.size]*r/2*n.props.scale}getInterpolatedProps(n,r,i){return{...i>.5?r.props:n.props,segments:Qwe(n.props.segments,r.props.segments,i),scale:At(n.props.scale,r.props.scale,i)}}}N(cT,"type","draw"),N(cT,"props",fhe),N(cT,"migrations",phe);function eSe(t,e){const n=(e+1)*.5;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function NL(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function Qte({shape:t,zoomOverride:e}){var f;const n=$l(),r=re(),i=tv(t.props.segments),s=t.props.isComplete||((f=Yi(t.props.segments))==null?void 0:f.type)==="straight";let o=(ri[t.props.size]+1)*t.props.scale;const a=ie("force solid",()=>{const y=e??r.getZoomLevel();return y<.5&&y<1.5/o},[r,o,e]),l=ie("dot adjustment",()=>(e??r.getZoomLevel())<.2?0:.1,[r,e]);!a&&!t.props.isPen&&t.props.dash==="draw"&&i.length===1&&(o+=Fg(t.id)()*(o/6));const c=fB(t.props,o,s,a);if(!a&&t.props.dash==="draw")return g.jsxs(g.Fragment,{children:[t.props.isClosed&&t.props.fill&&i.length>1?g.jsx(Aw,{d:Mw(bf(i,c),t.props.isClosed),theme:n,color:t.props.color,fill:t.props.isClosed?t.props.fill:"none",scale:t.props.scale}):null,g.jsx("path",{d:zyt(i,c),strokeLinecap:"round",fill:n[t.props.color].solid})]});const u=bf(i,c),d=u.length<2,h=d?eSe(i[0],0):Mw(u,t.props.isClosed);return g.jsxs(g.Fragment,{children:[g.jsx(Aw,{d:h,theme:n,color:t.props.color,fill:d||t.props.isClosed?t.props.fill:"none",scale:t.props.scale}),g.jsx("path",{d:h,strokeLinecap:"round",fill:d?n[t.props.color].solid:"none",stroke:n[t.props.color].solid,strokeWidth:o,strokeDasharray:d?"none":Yyt(t,o,l),strokeDashoffset:"0"})]})}function Xyt(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Jyt(t,e){const n=wt(e);if(!n)return;const r=n.host.replace("www.","");for(const i of t)if(tSe(i.hostnames,r)){const s=i.fromEmbedUrl(e);if(s)return{definition:i,url:s,embedUrl:e}}}const Zyt=t=>t.split("*").map(e=>Xyt(e)).join(".+"),tSe=(t,e)=>!!t.find(n=>{const r=new RegExp(Zyt(n));return e.match(r)});function Qyt(t,e){const n=wt(e);if(!n)return;const r=n.host.replace("www.","");for(const i of t)if(tSe(i.hostnames,r)){const s=i.toEmbedUrl(e);if(s)return{definition:i,embedUrl:s,url:e}}}function evt(t,e){try{return Qyt(t,e)??Jyt(t,e)}catch{return}}const tvt=t=>Object.entries(t).filter(([e,n])=>n).map(([e])=>e).join(" "),ed=class ed extends zv{static setEmbedDefinitions(e){ed.embedDefinitions=e}getEmbedDefinitions(){return ed.embedDefinitions}getEmbedDefinition(e){return evt(ed.embedDefinitions,e)}getText(e){return e.props.url}getAriaDescriptor(e){const n=this.getEmbedDefinition(e.props.url);return n==null?void 0:n.definition.title}hideSelectionBoundsFg(e){return!this.canResize(e)}canEdit(){return!0}canResize(e){var n,r;return!!((r=(n=this.getEmbedDefinition(e.props.url))==null?void 0:n.definition)!=null&&r.doesResize)}canEditInReadonly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(e){const n=this.getEmbedDefinition(e.props.url);return(n==null?void 0:n.definition.isAspectRatioLocked)??!1}onResize(e,n){const r=this.isAspectRatioLocked(e),i=this.getEmbedDefinition(e.props.url);let s=(i==null?void 0:i.definition.minWidth)??200,o=(i==null?void 0:i.definition.minHeight)??200;if(r){const a=e.props.w/e.props.h;a>1?s*=a:o/=a}return qk(e,n,{minWidth:s,minHeight:o})}component(e){const n=MS(),{w:r,h:i,url:s}=e.props,o=FS(e.id),a=this.getEmbedDefinition(s),l=ie("is hovering",()=>{const{editingShapeId:f,hoveredShapeId:y}=this.editor.getCurrentPageState();if(f&&y!==f){const b=this.editor.getShape(f);if(b&&this.editor.isShapeOfType(b,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(e).rotation();if(n)return g.jsx(of,{className:"tl-embed-container",id:e.id,children:g.jsx("div",{className:"tl-embed",style:{border:0,boxShadow:i_(c),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:(a==null?void 0:a.definition.backgroundColor)??"var(--color-background)",width:r,height:i}})});const u=o||l;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(a==null?void 0:a.definition.type)==="tldraw")return null;if((a==null?void 0:a.definition.type)==="github_gist"){const f=a.url.split("/").pop();if(!f)throw Error("No gist id!");return g.jsx(of,{className:"tl-embed-container",id:e.id,children:g.jsx(nvt,{id:f,width:te(r),height:te(i),isInteractive:u,pageRotation:c})})}const h=tvt({...kht,...(a==null?void 0:a.definition.overridePermissions)??{}});return g.jsx(of,{className:"tl-embed-container",id:e.id,children:a!=null&&a.definition?g.jsx("iframe",{className:"tl-embed",sandbox:h,src:a.embedUrl,width:te(r),height:te(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",tabIndex:o?0:-1,style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:i_(c),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(e){const n=this.getEmbedDefinition(e.props.url);return g.jsx("rect",{width:te(e.props.w),height:te(e.props.h),rx:(n==null?void 0:n.definition.overrideOutlineRadius)??8,ry:(n==null?void 0:n.definition.overrideOutlineRadius)??8})}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:At(e.props.w,n.props.w,r),h:At(e.props.h,n.props.h,r)}}};N(ed,"type","embed"),N(ed,"props",ghe),N(ed,"migrations",mhe),N(ed,"embedDefinitions",i9);let s_=ed;function nvt({id:t,isInteractive:e,width:n,height:r,style:i,pageRotation:s}){if(!t.match(/^[0-9a-f]+$/))throw Error("No gist id!");return g.jsx("iframe",{className:"tl-embed",draggable:!1,width:te(n),height:te(r),frameBorder:"0",scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",tabIndex:e?0:-1,style:{...i,pointerEvents:e?"all":"none",zIndex:e?"":"-1",boxShadow:i_(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${t}.js`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function pB(t,e){const i=((qI(t.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(i)}const ene=new WeakMap;function tne(t,e,n){let r=ene.get(e.props);if(!r){const i=D9(e.props.name,"Frame")+"​",s=t.textMeasure.measureTextSpans(i,n),o=s[0],a=Yi(s);r=a.box.w+a.box.x-o.box.x,ene.set(e.props,r)}return new Ee(0,-n.height,r,n.height)}function nne(t,e){return{fontSize:12,fontFamily:e?"Arial":"Inter, sans-serif",textAlign:"start",width:t,height:24,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",offsetY:-34,offsetX:0}}function nSe(t,e,n){const r=n?"":"px",i=n?"":"deg";let s;switch(e){case 0:s="";break;case 3:s=`translate(${te(t.props.w)}${r}, 0${r}) rotate(90${i})`;break;case 2:s=`translate(${te(t.props.w)}${r}, ${te(t.props.h)}${r}) rotate(180${i})`;break;case 1:s=`translate(0${r}, ${te(t.props.h)}${r}) rotate(270${i})`;break;default:throw Error("labelSide out of bounds")}return s}const rvt=S.forwardRef(({id:t,name:e,isEditing:n},r)=>{const i=re(),s=S.useCallback(l=>{l.key==="Enter"&&!l.nativeEvent.isComposing&&(tr(l),l.currentTarget.blur(),i.setEditingShape(null))},[i]),o=S.useCallback(l=>{const c=i.getShape(t);if(!c)return;const u=c.props.name,d=l.currentTarget.value.trim();u!==d&&i.updateShapes([{id:t,type:"frame",props:{name:d}}])},[t,i]),a=S.useCallback(l=>{const c=i.getShape(t);if(!c)return;const u=c.props.name,d=l.currentTarget.value;u!==d&&i.updateShapes([{id:t,type:"frame",props:{name:d}}])},[t,i]);return g.jsxs("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[g.jsx("input",{className:"tl-frame-name-input",ref:r,disabled:!n,readOnly:!n,style:{display:n?void 0:"none"},value:e,autoFocus:!0,onKeyDown:s,onBlur:o,onChange:a,onPointerDown:n?tr:void 0,draggable:!1}),D9(e,"Frame")+"​"]})}),ivt=S.memo(function({id:e,name:n,width:r,height:i,fill:s,stroke:o,color:a,offsetX:l,showColors:c}){const u=re(),{side:d,translation:h}=ie("shape rotation",()=>{const b=u.getShape(e);if(!b)return{side:0,translation:"translate(0, 0)"};const v=pB(u,b);return{side:v,translation:nSe(b,v,!1)}},[u,l,e]),f=S.useRef(null),y=FS(e);return S.useEffect(()=>{const b=f.current;b&&y&&(b.focus(),b.select())},[f,y]),g.jsx("div",{className:"tl-frame-heading",style:{overflow:y?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(d===0||d===2?r:i)}px + ${c?"0px":"var(--frame-offset-width)"})`,bottom:"100%",transform:`${h} scale(var(--tl-scale)) translateX(${l}px)`},children:g.jsx("div",{className:"tl-frame-heading-hit-area",style:{color:a,backgroundColor:s,boxShadow:`inset 0px 0px 0px 1px ${o}`},children:g.jsx(rvt,{ref:f,id:e,name:n,isEditing:y})})})}),svt=12,ovt=32,avt=-7,lvt=4;function D9(t,e){return t.match(/^\s*$/)?e:t}class uT extends zv{constructor(){super(...arguments);N(this,"options",{showColors:!1})}static configure(n){const r=super.configure.call(this,n);return n.showColors&&(r.props={...r.props,color:mo}),r}canEdit(){return!0}canResize(){return!0}canResizeChildren(){return!1}getDefaultProps(){return{w:320,h:180,name:"",color:"black"}}getAriaDescriptor(n){return n.props.name}getGeometry(n){const{editor:r}=this,i=r.getZoomLevel(),s=pB(r,n),o=s%2===1,a=o?n.props.h:n.props.w,l=nne(a,!1),c=tne(r,n,l),u=this.options.showColors,d=svt/i,h=ovt/i,f=a+(u?1:d),y=c.w/i,b=c.h/i,v=Ct(y+d,h,f),x=(u?-1:avt)/i,C=lvt/i,E=o?b:v,I=o?v:b;let P,_;switch(s){case 0:{P=x,_=-(b+C);break}case 1:{P=-(b+C),_=n.props.h-(x+v);break}case 2:{P=n.props.w-(x+v),_=n.props.h+C;break}case 3:{P=n.props.w+C,_=x;break}}return new yo({children:[new bu({width:n.props.w,height:n.props.h,isFilled:!1}),new bu({x:P,y:_,width:E,height:I,isFilled:!0,isLabel:!0})]})}getText(n){return n.props.name}component(n){const r=$l(),i=ie("is creating this shape",()=>{const h=this.editor.getStateDescendant("select.resizing");if(!h||!h.getIsActive())return!1;const f=h==null?void 0:h.info;return f?f.isCreating&&this.editor.getOnlySelectedShapeId()===n.id:!1},[n.id]),s=this.options.showColors,o=r[n.props.color],a=s?o.frame.fill:r.black.frame.fill,l=s?o.frame.stroke:r.black.frame.stroke,c=s?o.frame.headingStroke:r.background,u=s?o.frame.headingFill:r.background,d=s?o.frame.text:r.text;return g.jsxs(g.Fragment,{children:[g.jsx(pf,{children:g.jsx("rect",{className:nt("tl-frame__body",{"tl-frame__creating":i}),fill:a,stroke:l,style:{width:`calc(${n.props.w}px + 1px / var(--tl-zoom))`,height:`calc(${n.props.h}px + 1px / var(--tl-zoom))`,transform:"translate(calc(-0.5px / var(--tl-zoom)), calc(-0.5px / var(--tl-zoom)))"}})}),i?null:g.jsx(ivt,{id:n.id,name:n.props.name,fill:u,stroke:c,color:d,width:n.props.w,height:n.props.h,offsetX:s?-1:-7,showColors:this.options.showColors})]})}toSvg(n,r){const i=Ud({isDarkMode:r.isDarkMode}),s=pB(this.editor,n),a=s%2===1?n.props.h:n.props.w,l=nSe(n,s,!0),c=nne(a-12,!0),u=D9(n.props.name,"Frame")+"​",d=tne(this.editor,n,c),h=this.editor.textMeasure.measureTextSpans(u,c),f=dB(this.editor,h,c),y=this.options.showColors,b=i[n.props.color],v=y?b.frame.fill:i.black.frame.fill,x=y?b.frame.stroke:i.black.frame.stroke,C=y?b.frame.headingStroke:i.background,E=y?b.frame.headingFill:i.background,I=y?b.frame.text:i.text;return g.jsxs(g.Fragment,{children:[g.jsx("rect",{width:n.props.w,height:n.props.h,fill:v,stroke:x,strokeWidth:1,x:0,rx:0,ry:0}),g.jsxs("g",{fill:I,transform:l,children:[g.jsx("rect",{x:d.x-(y?0:6),y:d.y-6,width:Math.min(a,d.width+12),height:d.height,fill:E,stroke:C,rx:4,ry:4}),g.jsx("g",{transform:`translate(${y?8:0}, 4)`,children:f})]})]})}indicator(n){return g.jsx("rect",{width:te(n.props.w),height:te(n.props.h),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}canReceiveNewChildrenOfType(n){return!n.isLocked}onResize(n,r){return qk(n,r)}getInterpolatedProps(n,r,i){return{...i>.5?r.props:n.props,w:At(n.props.w,r.props.w,i),h:At(n.props.h,r.props.h,i)}}onDoubleClickEdge(n,r){if(r.target!=="selection")return;const{handle:i}=r;if(!i)return;const s=i==="left"||i==="right",o=i==="top"||i==="bottom",a=this.editor.getSortedChildIdsForParent(n.id),l=bt(a.map(f=>this.editor.getShape(f)));if(!l.length)return;const{dx:c,dy:u,w:d,h}=qxe(l,this.editor,{padding:10});return this.editor.run(()=>{const f=a.map(y=>{const b=this.editor.getShape(y);return{id:b.id,type:b.type,x:s?b.x+c:b.x,y:o?b.y+u:b.y}});this.editor.updateShapes(f)}),{id:n.id,type:n.type,props:{w:s?d:n.props.w,h:o?h:n.props.h}}}onDoubleClickCorner(n){return Gxe(this.editor,n.id,{padding:10}),{id:n.id,type:n.type}}onDragShapesIn(n,r,{initialParentIds:i,initialIndices:s}){const{editor:o}=this;if(r.every(c=>c.parentId===n.id))return;let a=!1;const l=r.filter(c=>n.id===i.get(c.id));if(l.length>0){const c=bt(o.getSortedChildIdsForParent(n).map(u=>o.getShape(u)));l.every(u=>!c.find(d=>d.index===u.index))&&(a=!0)}if(!r.some(c=>o.hasAncestor(n,c.id))&&(o.reparentShapes(r,n.id),a))for(const c of l)o.updateShape({id:c.id,type:c.type,index:s.get(c.id)})}onDragShapesOut(n,r,i){const{editor:s}=this;i.nextDraggingOverShapeId||s.reparentShapes(r.filter(o=>o.parentId===n.id&&this.canReceiveNewChildrenOfType(o)),s.getCurrentPageId())}}N(uT,"type","frame"),N(uT,"props",yhe),N(uT,"migrations",vhe);const cvt=$e.forwardRef(function({shapeId:e,isEditing:n,richText:r,handleFocus:i,handleChange:s,handleBlur:o,handleKeyDown:a,handleDoubleClick:l,hasCustomTabBehavior:c,handlePaste:u},d){const h=re(),f=Hg("tip-tap-editor"),y=h.getTextOptions().tipTapConfig,b=S.useRef(r),v=S.useRef(null),x=S.useRef(null);S.useLayoutEffect(()=>{v.current?b.current!==r&&v.current.commands.setContent(r):b.current=r},[r]);const C=S.useRef({selectAll:!1,caretPosition:null});S.useLayoutEffect(()=>{function L($){$.shapeId===h.getEditingShapeId()&&(C.current.selectAll=!0)}function z($){$.shapeId===h.getEditingShapeId()&&(C.current.caretPosition=$.point)}return h.on("select-all-text",L),h.on("place-caret",z),()=>{h.off("select-all-text",L),h.off("place-caret",z)}},[h,n]);const E=Zc(s),I=Zc(a),P=Zc(i),_=Zc(o),A=Zc(l),D=Zc(u);return S.useLayoutEffect(()=>{if(!n||!y||!x.current)return;const{editorProps:L,...z}=y,$=new aot({element:x.current,autofocus:!0,editable:n,onUpdate:R=>{const j=R.editor.state.doc.toJSON();b.current=j,E({richText:j})},onFocus:P,onBlur:_,onCreate:R=>{var G;if(h.getEditingShapeId()!==e)return;const j=R.editor;h.setRichTextEditor(j);const{selectAll:B,caretPosition:K}=C.current;if(B)j.chain().focus().selectAll().run();else if(K){const V=(G=j.view.posAtCoords({left:K.x,top:K.y}))==null?void 0:G.pos;V?j.chain().focus().setTextSelection(V).run():j.chain().focus().selectAll().run()}},editorProps:{handleKeyDown:(R,j)=>{!c&&j.key==="Tab"&&uvt(h,R,j),I(j)},handlePaste:(R,j)=>{if(D(j),j.defaultPrevented)return!0},handleDoubleClick:(R,j,B)=>A(B),...L},coreExtensionOptions:{clipboardTextSerializer:{blockSeparator:`
`}},...z,content:b.current}),H=h.timers.setTimeout(()=>{C.current.caretPosition||C.current.selectAll?$.commands.focus():$.commands.focus("end"),C.current.selectAll=!1,C.current.caretPosition=null},100);return v.current=$,()=>{v.current=null,clearTimeout(H),$.destroy()}},[n,y,P,_,A,E,D,I,h,e,c]),!n||!y?null:g.jsx("div",{id:f,ref:d,tabIndex:-1,"data-testid":"rich-text-area",className:"tl-rich-text tl-text tl-text-input",onContextMenu:n?tr:void 0,onPointerDownCapture:tr,onTouchEnd:tr,onDragStart:St,children:g.jsx("div",{className:"tl-rich-text",ref:x})})});function uvt(t,e,n){n.preventDefault();const r=t.getRichTextEditor();if(r!=null&&r.isActive("bulletList")||r!=null&&r.isActive("orderedList"))return;const{state:i,dispatch:s}=e,{$from:o,$to:a}=i.selection,l=n.shiftKey;let c=i.tr,u=a.end();for(;u>=o.start();){const h=i.doc.resolve(u).blockRange();if(!h)break;const f=h.start,y=h.end,b=i.doc.textBetween(f,y,`
`);let v=!1;i.doc.nodesBetween(f,y,x=>{if(x.type.name==="bulletList"||x.type.name==="orderedList")return v=!0,!1}),v||(l?b.startsWith("	")&&(c=c.delete(f+1,f+2)):c=c.insertText("	",f+1)),u=f-1}const d=i.selection.map(c.doc,c.mapping);c.setSelection(d),c.docChanged&&s(c)}function dvt(t,e,n){const r=Hwe(t),i=r.isEditing,s=re(),o=S.useRef(null),a=n&&Uo(n);S.useEffect(()=>{var d;if(!i)return;const u=(d=o.current)==null?void 0:d.querySelector("[contenteditable]");u&&document.activeElement!==o.current&&u.focus()},[s,i]);const l=S.useCallback(u=>{s.getEditingShapeId()===t&&u.key==="Enter"&&ni(u)&&s.complete()},[s,t]),c=S.useCallback(({richText:u})=>{s.getEditingShapeId()===t&&s.updateShape({id:t,type:e,props:{richText:u}})},[s,t,e]);return{rInput:o,handleKeyDown:l,handleChange:c,isEmpty:a,...r}}const R9=$e.memo(function({shapeId:e,type:n,richText:r,labelColor:i,font:s,fontSize:o,lineHeight:a,align:l,verticalAlign:c,wrap:u,isSelected:d,padding:h=0,onKeyDown:f,classNamePrefix:y,style:b,textWidth:v,textHeight:x,hasCustomTabBehavior:C}){const E=re(),I=$e.useRef(!1),{rInput:P,isEmpty:_,isEditing:A,isReadyForEditing:D,...L}=dvt(e,n,r),z=S.useMemo(()=>{if(r)return T9(E,r)},[E,r]),$=ie("isSelectToolActive",()=>E.getCurrentToolId()==="select",[E]);Yz("isDragging",()=>{E.getInstanceState(),I.current=E.inputs.isDragging},[E]);const H=Uwe(l),R=B=>{var K;if(B.target instanceof HTMLElement&&(B.target.tagName==="A"||B.target.closest("a"))){if(St(B),!$)return;const G=((K=B.target.closest("a"))==null?void 0:K.getAttribute("href"))??"",V=W=>{W.name==="pointer_up"&&(I.current||window.open(G,"_blank","noopener, noreferrer"),E.off("event",V))};E.on("event",V)}};if(!A&&_)return null;const j=y||"tl-text";return g.jsx("div",{className:`${j}-label tl-text-wrapper tl-rich-text-wrapper`,"aria-hidden":!A,"data-font":s,"data-align":l,"data-hastext":!_,"data-isediting":A,"data-textwrap":!!u,"data-isselected":d,style:{justifyContent:l==="middle"||H?"center":l,alignItems:c==="middle"?"center":c,padding:h,...b},children:g.jsxs("div",{className:`${j}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:a.toString(),minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(v||0),color:i,width:v?Math.ceil(v):void 0,height:x?Math.ceil(x):void 0},children:[g.jsx("div",{className:`${j} tl-text tl-text-content`,dir:"auto",children:r&&g.jsx("div",{className:"tl-rich-text","data-is-select-tool-active":$,dangerouslySetInnerHTML:{__html:z||""},onPointerDown:R,"data-is-ready-for-editing":D})}),(D||d)&&g.jsx(cvt,{ref:P,richText:r,isEditing:A,shapeId:e,...L,hasCustomTabBehavior:C,handleKeyDown:f??L.handleKeyDown})]})})});function N9({bounds:t,richText:e,fontSize:n,font:r,align:i,verticalAlign:s,wrap:o,labelColor:a,padding:l,showTextOutline:c=!0}){const u=re(),d=T9(u,e),h=i==="middle"?"center":i==="start"?"start":"end",f=i==="middle"?"center":i==="start"?"flex-start":"flex-end",y=s==="middle"?"center":s==="start"?"flex-start":"flex-end",b={display:"flex",fontFamily:the[r],height:"100%",justifyContent:f,alignItems:y,padding:`${l}px`},v={fontSize:`${n}px`,wrap:o?"wrap":"nowrap",color:a,lineHeight:Ds.lineHeight,textAlign:h,width:"100%",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",textShadow:c?"var(--tl-text-outline)":"none"};return g.jsx("foreignObject",{x:t.minX,y:t.minY,width:t.w,height:t.h,className:"tl-export-embed-styles tl-rich-text tl-rich-text-svg",children:g.jsx("div",{style:b,children:g.jsx("div",{dangerouslySetInnerHTML:{__html:d},style:v})})})}const hvt=new zs;function gB(t){return hvt.get(t,fvt)}function fvt(t){const e=Math.max(1,t.props.w),n=Math.max(1,t.props.h+t.props.growY),r=e/2,i=n/2,s=Sa[t.props.size]*t.props.scale,o=t.props.fill!=="none";switch(t.props.geo){case"arrow-down":{const a=e*.16,l=Math.min(e,n)*.38;return new rn().moveTo(a,0,{geometry:{isFilled:o}}).lineTo(e-a,0).lineTo(e-a,n-l).lineTo(e,n-l).lineTo(e/2,n).lineTo(0,n-l).lineTo(a,n-l).close()}case"arrow-left":{const a=Math.min(e,n)*.38,l=n*.16;return new rn().moveTo(a,0,{geometry:{isFilled:o}}).lineTo(a,l).lineTo(e,l).lineTo(e,n-l).lineTo(a,n-l).lineTo(a,n).lineTo(0,n/2).close()}case"arrow-right":{const a=Math.min(e,n)*.38,l=n*.16;return new rn().moveTo(0,l,{geometry:{isFilled:o}}).lineTo(e-a,l).lineTo(e-a,0).lineTo(e,n/2).lineTo(e-a,n).lineTo(e-a,n-l).lineTo(0,n-l).close()}case"arrow-up":{const a=e*.16,l=Math.min(e,n)*.38;return new rn().moveTo(e/2,0,{geometry:{isFilled:o}}).lineTo(e,l).lineTo(e-a,l).lineTo(e-a,n).lineTo(a,n).lineTo(a,l).lineTo(0,l).close()}case"check-box":{const a=Math.min(e,n)*.82,l=(e-a)/2,c=(n-a)/2;return new rn().moveTo(0,0,{geometry:{isFilled:o}}).lineTo(e,0).lineTo(e,n).lineTo(0,n).close().moveTo(Ct(l+a*.25,0,e),Ct(c+a*.52,0,n),{geometry:{isInternal:!0,isFilled:!1},offset:0}).lineTo(Ct(l+a*.45,0,e),Ct(c+a*.82,0,n)).lineTo(Ct(l+a*.82,0,e),Ct(c+a*.22,0,n),{offset:0})}case"diamond":return new rn().moveTo(r,0,{geometry:{isFilled:o}}).lineTo(e,i).lineTo(r,n).lineTo(0,i).close();case"ellipse":return new rn().moveTo(0,i,{geometry:{isFilled:o}}).arcTo(r,i,!1,!0,0,e,i).arcTo(r,i,!1,!0,0,0,i).close();case"heart":{const a=e/4,l=n/4;return new rn().moveTo(r,n,{geometry:{isFilled:o}}).cubicBezierTo(0,l*1.2,a*1.5,l*3,0,l*2.5).cubicBezierTo(r,l*.9,0,-l*.32,a*1.85,-l*.32).cubicBezierTo(e,l*1.2,a*2.15,-l*.32,e,-l*.32).cubicBezierTo(r,n,e,l*2.5,a*2.5,l*3).close()}case"hexagon":return rn.lineThroughPoints(Tj(e,n,6),{geometry:{isFilled:o}}).close();case"octagon":return rn.lineThroughPoints(Tj(e,n,8),{geometry:{isFilled:o}}).close();case"oval":return gvt(e,n,o);case"pentagon":return rn.lineThroughPoints(Tj(e,n,5),{geometry:{isFilled:o}}).close();case"rectangle":return new rn().moveTo(0,0,{geometry:{isFilled:o}}).lineTo(e,0).lineTo(e,n).lineTo(0,n).close();case"rhombus":{const a=Math.min(e*.38,n*.38);return new rn().moveTo(a,0,{geometry:{isFilled:o}}).lineTo(e,0).lineTo(e-a,n).lineTo(0,n).close()}case"rhombus-2":{const a=Math.min(e*.38,n*.38);return new rn().moveTo(0,0,{geometry:{isFilled:o}}).lineTo(e-a,0).lineTo(e,n).lineTo(a,n).close()}case"star":return mvt(e,n,o);case"trapezoid":{const a=Math.min(e*.38,n*.38);return new rn().moveTo(a,0,{geometry:{isFilled:o}}).lineTo(e-a,0).lineTo(e,n).lineTo(0,n).close()}case"triangle":return new rn().moveTo(r,0,{geometry:{isFilled:o}}).lineTo(e,n).lineTo(0,n).close();case"x-box":return pvt(e,n,s,t.props.dash,o);case"cloud":return xvt(e,n,t.id,t.props.size,t.props.scale,o);default:Yt(t.props.geo)}}function pvt(t,e,n,r,i){const s=t/2,o=e/2,a=new rn().moveTo(0,0,{geometry:{isFilled:i}}).lineTo(t,0).lineTo(t,e).lineTo(0,e).close();if(r==="dashed"||r==="dotted")return a.moveTo(0,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(s,o).moveTo(t,e,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(s,o).moveTo(0,e,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(s,o).moveTo(t,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(s,o);const l=r==="draw"?.62:0;return a.moveTo(Ct(n*l,0,t),Ct(n*l,0,e),{geometry:{isInternal:!0,isFilled:!1}}).lineTo(Ct(t-n*l,0,t),Ct(e-n*l,0,e)).moveTo(Ct(t-n*l,0,t),Ct(n*l,0,e)).lineTo(Ct(n*l,0,t),Ct(e-n*l,0,e)),a}function gvt(t,e,n){if(e>t){const i=t/2;return new rn().moveTo(0,i,{geometry:{isFilled:n}}).arcTo(i,i,!1,!0,0,t,i).lineTo(t,e-i).arcTo(i,i,!1,!0,0,0,e-i).close()}const r=e/2;return new rn().moveTo(r,e,{geometry:{isFilled:n}}).arcTo(r,r,!1,!0,0,r,0).lineTo(t-r,0).arcTo(r,r,!1,!0,0,t-r,e).close()}function mvt(t,e,n){const i=Pn/5/2,s=Math.floor(5/4)*2,o=10-s,a=0,l=Math.floor(5/2)*2,c=Math.cos(-Zn+s*i)*t/2,u=Math.cos(-Zn+o*i)*t/2,d=Math.sin(-Zn+a*i)*e/2,h=Math.sin(-Zn+l*i)*e/2,f=t-Math.abs(c-u),y=e-Math.abs(h-d),b=t/2+u-(t/2-c),v=e/2+d-(e/2-h),x=1,C=(t-b)/2,E=(e-v)/2,I=(t+f)/2,P=(e+y)/2,_=I*x/2,A=P*x/2;return rn.lineThroughPoints(Array.from(Array(10),(D,L)=>{const z=-Zn+L*i;return new M(C+(L%2?_:I)*Math.cos(z),E+(L%2?A:P)*Math.sin(z))}),{geometry:{isFilled:n}}).close()}function rne(t,e){return t>e?(un*(e/2)+(t-e))*2:(un*(t/2)+(e-t))*2}function yvt(t,e,n){const r=Math.min(t,e)/2,i=Math.max(t,e)-r*2,o=(Math.PI*(r*2)+2*i)/n,a=t>e?[{type:"straight",start:new M(r,0),delta:new M(1,0)},{type:"arc",center:new M(t-r,r),startAngle:-un/2},{type:"straight",start:new M(t-r,e),delta:new M(-1,0)},{type:"arc",center:new M(r,r),startAngle:un/2}]:[{type:"straight",start:new M(t,r),delta:new M(0,1)},{type:"arc",center:new M(r,e-r),startAngle:0},{type:"straight",start:new M(0,e-r),delta:new M(0,-1)},{type:"arc",center:new M(r,r),startAngle:un}];let l=0;const c=[];for(let u=0;u<n;u++){const d=a[0];d.type==="straight"?c.push(M.Add(d.start,M.Mul(d.delta,l))):c.push(yU(d.center,r,d.startAngle+l/r)),l+=o;let h=d.type==="straight"?i:un*r;for(;l>h;)l-=h,a.push(a.shift()),h=a[0].type==="straight"?i:un*r}return c}const vvt={s:50,m:70,l:100,xl:130},bvt=.2;function xvt(t,e,n,r,i,s){const o=new rn,a=Fg(n),l=rne(t,e),c=Math.max(Math.ceil(l/vvt[r]),6,Math.ceil(l/Math.min(t,e))),u=l/c*bvt,d=Math.max(t-u*2,1),h=Math.max(e-u*2,1),y=rne(d,h)/c,b=(t-d)/2,v=(e-h)/2,x=yvt(d,h,c).map(P=>P.addXY(b,v)),C=t<20?0:u*.3,E=e<20?0:u*.3,I=x.slice(0);for(let P=0;P<Math.floor(c/2);P++)I[P]=M.AddXY(I[P],a()*C*i,a()*E*i),I[c-P-1]=M.AddXY(I[c-P-1],a()*C*i,a()*E*i);for(let P=0;P<I.length;P++){const _=P===I.length-1?0:P+1,A=I[P],D=I[_],L=x[P],z=x[_],$=M.Dist(L,z),H=y-$,j=M.Dist(A,D)/$,B=(Math.max(b,v)+H)*j,K=M.Lrp(L,z,.5).add(M.Sub(z,L).uni().per().mul(B));K.x<0?K.x=0:K.x>t&&(K.x=t),K.y<0?K.y=0:K.y>e&&(K.y=e);const G=jhe(A,D,K),V=M.Dist(G||M.Average([A,D]),A);P===0&&o.moveTo(A.x,A.y,{geometry:{isFilled:s}}),o.circularArcTo(V,!1,!0,D.x,D.y)}return o.close()}function ine({shape:t,shouldScale:e,forceSolid:n}){const r=e?t.props.scale:1,i=$l(),{props:s}=t,{color:o,fill:a,dash:l,size:c}=s,u=ri[c]*r,d=gB(t),h=l==="draw"&&!n?d.toDrawD({strokeWidth:u,randomSeed:t.id,passes:1,offset:0,onlyFilled:!0}):d.toD({onlyFilled:!0});return g.jsxs(g.Fragment,{children:[g.jsx(Aw,{theme:i,d:h,color:o,fill:a,scale:r}),d.toSvg({style:l,strokeWidth:u,forceSolid:n,randomSeed:t.id,props:{fill:"none",stroke:i[o].solid}})]})}const sne=51;class dT extends zv{canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",dash:"draw",growY:0,url:"",scale:1,color:"black",labelColor:"black",fill:"none",size:"m",font:"draw",align:"middle",verticalAlign:"middle",richText:Dl("")}}getGeometry(e){const n=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),i=gB(e),s=xE(this.editor,e),o=n/e.props.scale,a=r/e.props.scale,l=Math.min(100,o/2),c=Math.min(uf[e.props.size]*Ds.lineHeight+ao*2,a/2),u=Math.min(o,Math.max(s.w,Math.min(l,Math.max(1,o-8)))),d=Math.min(a,Math.max(s.h,Math.min(c,Math.max(1,a-8))));return new yo({children:[i.toGeometry(),new bu({x:e.props.align==="start"?0:e.props.align==="end"?(o-u)*e.props.scale:(o-u)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(a-d)*e.props.scale:(a-d)/2*e.props.scale,width:u*e.props.scale,height:d*e.props.scale,isFilled:!0,isLabel:!0,isEmptyLabel:Uo(e.props.richText)})]})}getHandleSnapGeometry(e){const n=this.getGeometry(e),r=n.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:r,points:[...r.vertices,n.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:r,points:[n.bounds.center]};default:Yt(e.props.geo)}}getText(e){return wg(this.editor,e.props.richText)}getFontFaces(e){return Uo(e.props.richText)?Mr:d6(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}component(e){const{id:n,type:r,props:i}=e,{fill:s,font:o,align:a,verticalAlign:l,size:c,richText:u}=i,d=$l(),{editor:h}=this,f=ie("isGeoOnlySelected",()=>e.id===h.getOnlySelectedShapeId(),[h]),y=_9(h,e.id),b=Uo(e.props.richText),v=y||!b,x=ie("force solid",()=>h.getZoomLevel()<.2,[h]);return g.jsxs(g.Fragment,{children:[g.jsx(pf,{children:g.jsx(ine,{shape:e,shouldScale:!0,forceSolid:x})}),v&&g.jsx(of,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+i.growY},children:g.jsx(R9,{shapeId:n,type:r,font:o,fontSize:uf[c]*e.props.scale,lineHeight:Ds.lineHeight,padding:ao*e.props.scale,fill:s,align:a,verticalAlign:l,richText:u,isSelected:f,labelColor:d[i.labelColor].solid,wrap:!0})}),e.props.url&&g.jsx(ev,{url:e.props.url})]})}indicator(e){const n=ie("isZoomedOut",()=>this.editor.getZoomLevel()<.25,[this.editor]),{size:r,dash:i,scale:s}=e.props,o=ri[r];return gB(e).toSvg({style:i==="draw"?"draw":"solid",strokeWidth:1,passes:1,randomSeed:e.id,offset:0,roundness:o*2*s,props:{strokeWidth:void 0},forceSolid:n})}toSvg(e,n){const r=e.props.scale,i={...e,props:{...e.props,w:e.props.w/r,h:(e.props.h+e.props.growY)/r,growY:0}},s=i.props;n.addExportDef(k9(s.fill));let o;if(!Uo(s.richText)){const a=Ud(n),l=new Ee(0,0,s.w,(e.props.h+e.props.growY)/r);o=g.jsx(N9,{fontSize:uf[s.size],font:s.font,align:s.align,verticalAlign:s.verticalAlign,richText:s.richText,labelColor:a[s.labelColor].solid,bounds:l,padding:ao})}return g.jsxs(g.Fragment,{children:[g.jsx(ine,{shouldScale:!1,shape:i,forceSolid:!1}),o]})}getCanvasSvgDefs(){return[A9()]}onResize(e,{handle:n,newPoint:r,scaleX:i,scaleY:s,initialShape:o}){const a=o.props.w/o.props.scale,l=o.props.h/o.props.scale,c=o.props.growY/o.props.scale;let u=a*i,d=(l+c)*s,h=0,f=0;const y=sne;if(!Uo(e.props.richText)){let I=Math.max(Math.abs(u),y),P=Math.max(Math.abs(d),y);I<y&&P===y&&(I=y),I===y&&P<y&&(P=y);const _=xE(this.editor,{...e,props:{...e.props,w:I*e.props.scale,h:P*e.props.scale}}),A=Math.max(Math.abs(u),_.w)*Math.sign(u),D=Math.max(Math.abs(d),_.h)*Math.sign(d);h=Math.abs(A)-Math.abs(u),f=Math.abs(D)-Math.abs(d),u=A,d=D}const b=u*e.props.scale,v=d*e.props.scale,x=new M(0,0);i<0&&(x.x+=b),(n==="left"||n==="top_left"||n==="bottom_left")&&(x.x+=i<0?h:-h),s<0&&(x.y+=v),(n==="top"||n==="top_left"||n==="top_right")&&(x.y+=s<0?f:-f);const{x:C,y:E}=x.rot(e.rotation).add(r);return{x:C,y:E,props:{w:Math.max(Math.abs(b),1),h:Math.max(Math.abs(v),1),growY:0}}}onBeforeCreate(e){if(Uo(e.props.richText))return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const n=e.props.h/e.props.scale,r=xE(this.editor,e).h;let i=null;if(r>n?i=r-n:e.props.growY&&(i=0),i!==null)return{...e,props:{...e.props,growY:i*e.props.scale}}}onBeforeUpdate(e,n){if(Af(e.props.richText,n.props.richText)&&e.props.font===n.props.font&&e.props.size===n.props.size)return;const r=Uo(e.props.richText),i=Uo(n.props.richText);if(!r&&i)return{...n,props:{...n.props,growY:0}};const s=e.props.w/e.props.scale,o=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,l=xE(this.editor,n);if(r&&!i&&wg(this.editor,n.props.richText)){let u=Math.max(s,l.w),d=Math.max(o,l.h);const h=sne;return s<h&&o<h&&(u=Math.max(u,h),d=Math.max(d,h),u=Math.max(u,d),d=Math.max(u,d)),{...n,props:{...n.props,w:u*n.props.scale,h:d*n.props.scale,growY:0}}}let c=null;if(l.h>o?c=l.h-o:a&&(c=0),c!==null){const u=n.props.w/n.props.scale;return{...n,props:{...n.props,growY:c*n.props.scale,w:Math.max(u,l.w)*n.props.scale}}}if(l.w>s)return{...n,props:{...n.props,w:l.w*n.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:At(e.props.w,n.props.w,r),h:At(e.props.h,n.props.h,r),scale:At(e.props.scale,n.props.scale,r)}}}N(dT,"type","geo"),N(dT,"props",bhe),N(dT,"migrations",xhe);const wvt={s:12,m:14,l:16,xl:20},Svt={s:2,m:3.5,l:5,xl:10};function xE(t,e){const{richText:n,font:r,size:i,w:s}=e.props;if(!n||Uo(n))return{w:0,h:0};const o=wvt[i],a=t_(t,n),l=t.textMeasure.measureHtml(a,{...Ds,fontFamily:xf[r],fontSize:uf[i],minWidth:o,maxWidth:Math.max(0,Math.ceil(o+Svt[i]),Math.ceil(s/e.props.scale-ao*2))});return{w:l.w+ao*2,h:l.h+ao*2}}function Cvt(){const[t,e]=S.useState(!1);return S.useEffect(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),i=matchMedia("(color-gamut: p3)");e(r&&i.matches);const s=()=>e(r&&i.matches);return i.addEventListener("change",s),()=>i.removeEventListener("change",s)},[]),ie(Jn.forceSrgb)||!t?"srgb":"p3"}class hT extends pc{constructor(){super(...arguments);N(this,"options",{maxPointsPerShape:600,underlayOpacity:.82,overlayOpacity:.35})}hideResizeHandles(n){return wE(n)}hideRotateHandle(n){return wE(n)}hideSelectionBoundsFg(n){return wE(n)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(n){const r=wp(n);if(wE(n))return new tP({x:-r/2,y:-r/2,radius:r/2,isFilled:!0});const{strokePoints:i,sw:s}=one(n,r,!0),o=O9({strokeWidth:s,showAsComplete:!0});return d9(i,o),new uw({points:hwe(i,o),isFilled:!0})}component(n){const r=jL(this.editor,n),i=wp(n);return g.jsx(pf,{children:g.jsx(SE,{shape:n,forceSolid:r,strokeWidth:i,opacity:this.options.overlayOpacity})})}backgroundComponent(n){const r=jL(this.editor,n),i=wp(n);return g.jsx(pf,{children:g.jsx(SE,{shape:n,forceSolid:r,strokeWidth:i,opacity:this.options.underlayOpacity})})}indicator(n){const r=jL(this.editor,n),i=wp(n),{strokePoints:s,sw:o}=one(n,i,r),a=tv(n.props.segments);let l;return s.length<2?l=Tvt(a[0],o):l=Mw(s,!1),g.jsx("path",{d:l})}toSvg(n){const r=wp(n),i=r<1.5,s=1/n.props.scale;return g.jsx("g",{transform:`scale(${s})`,children:g.jsx(SE,{forceSolid:i,strokeWidth:r,shape:n,opacity:this.options.overlayOpacity})})}toBackgroundSvg(n){const r=wp(n),i=r<1.5,s=1/n.props.scale;return g.jsx("g",{transform:`scale(${s})`,children:g.jsx(SE,{forceSolid:i,strokeWidth:r,shape:n,opacity:this.options.underlayOpacity})})}onResize(n,r){const{scaleX:i,scaleY:s}=r,o=[];for(const a of n.props.segments)o.push({...a,points:a.points.map(({x:l,y:c,z:u})=>({x:i*l,y:s*c,z:u}))});return{props:{segments:o}}}getInterpolatedProps(n,r,i){return{...i>.5?r.props:n.props,...r.props,segments:Qwe(n.props.segments,r.props.segments,i),scale:At(n.props.scale,r.props.scale,i)}}}N(hT,"type","highlight"),N(hT,"props",Che),N(hT,"migrations",Ehe);function Evt(t){return`M ${t.x} ${t.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function Tvt(t,e){const n=e/2;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function one(t,e,n){var l;const r=tv(t.props.segments),i=t.props.isComplete||((l=Yi(t.props.segments))==null?void 0:l.type)==="straight";let s=e;!n&&!t.props.isPen&&r.length===1&&(s+=Fg(t.id)()*(e/6));const o=O9({strokeWidth:s,showAsComplete:i});return{strokePoints:bf(r,o),sw:s}}function wp(t){return Qy[t.props.size]*1.12*t.props.scale}function wE(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function SE({strokeWidth:t,forceSolid:e,shape:n,opacity:r}){var h;const i=$l(),s=tv(n.props.segments);let o=t;!e&&!n.props.isPen&&s.length===1&&(o+=Fg(n.id)()*(o/6));const a=O9({strokeWidth:o,showAsComplete:n.props.isComplete||((h=Yi(n.props.segments))==null?void 0:h.type)==="straight"}),l=bf(s,a),c=l.length>1?Mw(l,!1):Evt(n.props.segments[0].points[0]),u=Cvt(),d=i[n.props.color].highlight[u];return g.jsx("path",{d:c,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:d,strokeWidth:o,opacity:r})}function jL(t,e){return ie("forceSolid",()=>{const n=wp(e),r=t.getZoomLevel();return n/r<1.5},[t])}function rSe(){return g.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),g.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),g.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function iSe({shapeId:t,assetId:e,width:n}){const r=re(),i=MS(),s=gXe(),[o,a]=S.useState(()=>({asset:e?r.getAsset(e)??null:null,url:null})),l=S.useRef(!1),c=S.useRef(null);return S.useEffect(()=>{if(!e)return;let u=!1,d;const h=Ma("update state",()=>{if(!i&&t&&r.getCulledShapes().has(t))return;const f=r.getAsset(e);if(!f){a(v=>({...v,asset:null,url:null}));return}if(!f.props.src){const v=r.getTemporaryAssetPreview(f.id);if(v){c.current!==v&&(c.current=v,a(x=>({...x,isPlaceholder:!0,url:v})),s());return}}const y=i?i.scale*(n/f.props.w):r.getZoomLevel()*(n/f.props.w);function b(v,x){u||c.current!==x&&(l.current=!0,c.current=x,a({asset:v,url:x}),s())}if(l.current){let v=0;const x=()=>{v++,v>500/16&&(ane(r,e,y,i,C=>b(f,C)),d==null||d())};d==null||d(),r.on("tick",x),d=()=>r.off("tick",x)}else ane(r,e,y,i,v=>b(f,v))});return()=>{h(),d==null||d(),u=!0}},[r,e,i,s,t,n]),o}function ane(t,e,n,r,i){t.resolveAssetUrl(e,{screenScale:n,shouldResolveToOriginal:r?r.pixelRatio===null:!1,dpr:(r==null?void 0:r.pixelRatio)??void 0}).then(s=>{i(s)})}async function Ivt(t){const n=await(await hc(t)).blob();return co.blobToDataUrl(n)}const Pvt=new zs;class fT extends zv{isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1,altText:""}}getGeometry(e){var n;return(n=e.props.crop)!=null&&n.isCircle?new att({width:e.props.w,height:e.props.h,isFilled:!0}):new bu({width:e.props.w,height:e.props.h,isFilled:!0})}getAriaDescriptor(e){return e.props.altText}onResize(e,n){let r=qk(e,n);const{flipX:i,flipY:s}=n.initialShape.props,{scaleX:o,scaleY:a,mode:l}=n;if(r={...r,props:{...r.props,flipX:o<0!==i,flipY:a<0!==s}},!e.props.crop)return r;const c=l==="scale_shape"&&o===-1||l==="resize_bounds"&&i!==r.props.flipX,u=l==="scale_shape"&&a===-1||l==="resize_bounds"&&s!==r.props.flipY,{topLeft:d,bottomRight:h}=e.props.crop;return r.props.crop={topLeft:{x:c?1-h.x:d.x,y:u?1-h.y:d.y},bottomRight:{x:c?1-d.x:h.x,y:u?1-d.y:h.y},isCircle:e.props.crop.isCircle},r}component(e){return g.jsx(_vt,{shape:e})}indicator(e){var r;return this.editor.getCroppingShapeId()===e.id?null:(r=e.props.crop)!=null&&r.isCircle?g.jsx("ellipse",{cx:te(e.props.w/2),cy:te(e.props.h/2),rx:te(e.props.w/2),ry:te(e.props.h/2)}):g.jsx("rect",{width:te(e.props.w),height:te(e.props.h)})}async toSvg(e,n){const r=e.props;if(!r.assetId)return null;const i=this.editor.getAsset(r.assetId);if(!i)return null;const{w:s}=Ec(e.props,r.crop),o=await Pvt.get(i,async()=>{let a=await n.resolveAssetUrl(i.id,s);if(!a)return null;if((a.startsWith("blob:")||a.startsWith("http")||a.startsWith("/")||a.startsWith("./"))&&(a=await Ivt(a)||""),sSe(this.editor,i.id)){const{promise:l}=aSe(a);a=await l}return a});return o?g.jsx(kvt,{shape:e,src:o}):null}onDoubleClickEdge(e){const n=e.props;if(!n||this.editor.getCroppingShapeId()!==e.id)return;const r=ar(n.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},{w:i,h:s}=Ec(e.props,r),o=new M(r.topLeft.x*i,r.topLeft.y*s).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:i,h:s}};this.editor.updateShapes([a])}getInterpolatedProps(e,n,r){function i(s,o){var d,h,f,y;if(s.props.crop===null&&o.props.crop===null)return null;const a=((d=s.props.crop)==null?void 0:d.topLeft)||{x:0,y:0},l=((h=s.props.crop)==null?void 0:h.bottomRight)||{x:1,y:1},c=((f=o.props.crop)==null?void 0:f.topLeft)||{x:0,y:0},u=((y=o.props.crop)==null?void 0:y.bottomRight)||{x:1,y:1};return{topLeft:{x:At(a.x,c.x,r),y:At(a.y,c.y,r)},bottomRight:{x:At(l.x,u.x,r),y:At(l.y,u.y,r)}}}return{...r>.5?n.props:e.props,w:At(e.props.w,n.props.w,r),h:At(e.props.h,n.props.h,r),crop:i(e,n)}}}N(fT,"type","image"),N(fT,"props",The),N(fT,"migrations",Ihe);const _vt=S.memo(function({shape:e}){var C,E;const n=re(),{w:r}=Ec(e.props,e.props.crop),{asset:i,url:s}=iSe({shapeId:e.id,assetId:e.props.assetId,width:r}),o=Ive(),[a,l]=S.useState(""),[c,u]=S.useState(null),d=i&&sSe(n,i.id);S.useEffect(()=>{if(s&&d){const{promise:I,cancel:P}=aSe(s);return I.then(_=>{l(_),u(s)}),()=>{P()}}},[n,d,o,s]);const h=ie("show crop preview",()=>e.id===n.getOnlySelectedShapeId()&&n.getCroppingShapeId()===e.id&&n.isIn("select.crop"),[n,e.id]),f=o&&(((C=i==null?void 0:i.props.mimeType)==null?void 0:C.includes("video"))||d),y=oSe(e),b=s===c?null:s,v=f?a:c;if(!s&&!(i!=null&&i.props.src))return g.jsxs(of,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[g.jsx("div",{className:nt("tl-image-container",i&&"tl-image-container-loading"),style:y,children:i?null:g.jsx(rSe,{})}),"url"in e.props&&e.props.url&&g.jsx(ev,{url:e.props.url})]});const x=d?"anonymous":void 0;return g.jsxs(g.Fragment,{children:[h&&v&&g.jsx("div",{style:y,children:g.jsx("img",{className:"tl-image",style:{...Sx(e),opacity:.1},crossOrigin:x,src:v,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""})}),g.jsxs(of,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,borderRadius:(E=e.props.crop)!=null&&E.isCircle?"50%":void 0},children:[g.jsxs("div",{className:nt("tl-image-container"),style:y,children:[v&&g.jsx("img",{className:"tl-image",style:Sx(e),crossOrigin:x,src:v,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""},v),b&&g.jsx("img",{className:"tl-image",style:Sx(e),crossOrigin:x,src:b,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:e.props.altText,onLoad:()=>u(b)},b)]}),e.props.url&&g.jsx(ev,{url:e.props.url})]})]})});function sSe(t,e){const n=e?t.getAsset(e):void 0;return n?"mimeType"in n.props&&xa.isAnimatedImageType(n==null?void 0:n.props.mimeType)||"isAnimated"in n.props&&n.props.isAnimated:!1}function oSe(t){const e=t.props.crop,n=e==null?void 0:e.topLeft;if(!n)return{width:t.props.w,height:t.props.h};const{w:r,h:i}=Ec(t.props,e),s=-n.x*r,o=-n.y*i;return{transform:`translate(${s}px, ${o}px)`,width:r,height:i}}function Sx(t,e){const{flipX:n,flipY:r,crop:i}=t.props;if(!n&&!r)return;let s,o;if(i){const{w:c,h:u}=Ec(t.props,i),d=i.bottomRight.x-i.topLeft.x,h=i.bottomRight.y-i.topLeft.y;s=yu(i.topLeft.x,[0,1-d],[0,c-t.props.w]),o=yu(i.topLeft.y,[0,1-h],[0,u-t.props.h])}const a=`scale(${n?-1:1}, ${r?-1:1})`;return{transform:`${e?`translate(${(n?e.width:0)-(s||0)}px,
		             ${(r?e.height:0)-(o||0)}px)`:""} ${a}`,transformOrigin:e?"0 0":"center center"}}function kvt({shape:t,src:e}){const n=Hg(),r=oSe(t),i=t.props.crop;if(r.transform&&i){const{transform:s,width:o,height:a}=r,l=(i.bottomRight.x-i.topLeft.x)*o,c=(i.bottomRight.y-i.topLeft.y)*a,u=[new M(0,0),new M(l,0),new M(l,c),new M(0,c)],d=Sx(t,{width:o,height:a});return g.jsxs(g.Fragment,{children:[g.jsx("defs",{children:g.jsx("clipPath",{id:n,children:i.isCircle?g.jsx("ellipse",{cx:l/2,cy:c/2,rx:l/2,ry:c/2}):g.jsx("polygon",{points:u.map(h=>`${h.x},${h.y}`).join(" ")})})}),g.jsx("g",{clipPath:`url(#${n})`,children:g.jsx("image",{href:e,width:o,height:a,"aria-label":t.props.altText,style:d?{...d}:{transform:s}})})]})}else return g.jsx("image",{href:e,width:t.props.w,height:t.props.h,"aria-label":t.props.altText,style:Sx(t,{width:t.props.w,height:t.props.h})})}function aSe(t){let e=!1;return{promise:new Promise(r=>{const i=rw();i.onload=()=>{if(e)return;const s=document.createElement("canvas");s.width=i.width,s.height=i.height;const o=s.getContext("2d");o&&(o.drawImage(i,0,0),r(s.toDataURL()))},i.crossOrigin="anonymous",i.src=t}),cancel:()=>e=!0}}const Avt=new zs;class pT extends pc{hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){const[e,n]=sw(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[n]:{id:n,index:n,x:.1,y:.1}},scale:1}}getGeometry(e){const n=mB(e).toGeometry();return it(n instanceof P$),n}getHandles(e){return Avt.get(e.props,()=>{const n=this.getGeometry(e),r=Kb(e),i=r.map(s=>({...s,id:s.index,type:"vertex",canSnap:!0}));for(let s=0;s<r.length-1;s++){const o=By(r[s].index,r[s+1].index),l=n.getSegments()[s].interpolateAlongEdge(.5);i.push({id:o,type:"create",index:o,x:l.x,y:l.y,canSnap:!0})}return i.sort(Xi)})}onResize(e,n){const{scaleX:r,scaleY:i}=n;return{props:{points:Mf(e.props.points,(s,{id:o,index:a,x:l,y:c})=>({id:o,index:a,x:l*r,y:c*i}))}}}onBeforeCreate(e){const{props:{points:n}}=e,r=Object.keys(n);if(r.length<2)return;const i=n[r[0]];if(r.every(o=>{const a=n[o];return a.x===i.x&&a.y===i.y})){const o=r[r.length-1];return n[o]={...n[o],x:n[o].x+.1,y:n[o].y+.1},e}}onHandleDrag(e,{handle:n}){const r=Ba(new M(n.x,n.y),this.editor);return{...e,props:{...e.props,points:{...e.props.points,[n.id]:{id:n.id,index:n.index,x:r.x,y:r.y}}}}}onHandleDragStart(e,{handle:n}){if(n.type==="create")return{...e,props:{...e.props,points:{...e.props.points,[n.index]:{id:n.index,index:n.index,x:n.x,y:n.y}}}}}component(e){return g.jsx(pf,{style:{minWidth:50,minHeight:50},children:g.jsx(lne,{shape:e})})}indicator(e){const n=Sa[e.props.size]*e.props.scale,r=mB(e),{dash:i}=e.props;return r.toSvg({style:i==="draw"?"draw":"solid",strokeWidth:1,passes:1,randomSeed:e.id,offset:0,roundness:n*2,props:{strokeWidth:void 0}})}toSvg(e){return g.jsx(lne,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const n=Kb(e);return{points:n,getSelfSnapPoints:r=>{const i=this.getHandles(e).filter(s=>s.type==="vertex").findIndex(s=>s.id===r.id);return n.filter((s,o)=>Math.abs(o-i)>1).map(M.From)},getSelfSnapOutline:r=>{const i=this.getHandles(e).filter(o=>o.type==="vertex").findIndex(o=>o.id===r.id),s=this.getGeometry(e).getSegments().filter((o,a)=>a!==i-1&&a!==i);return s.length?new yo({children:s}):null}}}getInterpolatedProps(e,n,r){const i=Kb(e),s=Kb(n),o=[],a=[];let l=Xue;if(i.length>s.length)for(let c=0;c<i.length;c++)o[c]={...i[c]},s[c]===void 0?a[c]={...s[s.length-1],id:l}:a[c]={...s[c],id:l},l=ac(l);else if(s.length>i.length)for(let c=0;c<s.length;c++)a[c]={...s[c]},i[c]===void 0?o[c]={...i[i.length-1],id:l}:o[c]={...i[c],id:l},l=ac(l);else for(let c=0;c<s.length;c++)o[c]=i[c],a[c]=s[c];return{...r>.5?n.props:e.props,points:Object.fromEntries(o.map((c,u)=>{const d=a[u];return[c.id,{...c,x:At(c.x,d.x,r),y:At(c.y,d.y,r)}]})),scale:At(e.props.scale,n.props.scale,r)}}}N(pT,"type","line"),N(pT,"props",Phe),N(pT,"migrations",_he);function Kb(t){return Object.values(t.props.points).sort(Xi)}const Mvt=new zs;function mB(t){return Mvt.get(t,()=>{const e=Kb(t).map(M.From);switch(t.props.spline){case"cubic":return rn.cubicSplineThroughPoints(e,{endOffsets:0});case"line":return rn.lineThroughPoints(e,{endOffsets:0})}})}function lne({shape:t,shouldScale:e=!1,forceSolid:n=!1}){const r=$l(),i=mB(t),{dash:s,color:o,size:a}=t.props,l=1/t.props.scale,c=e?l:1,u=Sa[a]*t.props.scale;return i.toSvg({style:s,strokeWidth:u,forceSolid:n,randomSeed:t.id,props:{transform:`scale(${c})`,stroke:r[o].solid,fill:"none"}})}function o_(t,e,n=!1){t.select(e),t.setEditingShape(e),t.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),n&&t.emit("select-all-text",{shapeId:e.id})}class gT extends pc{constructor(){super(...arguments);N(this,"options",{resizeMode:"none"})}canEdit(){return!0}hideResizeHandles(){const{resizeMode:n}=this.options;switch(n){case"none":return!0;case"scale":return!1;default:throw Yt(n)}}isAspectRatioLocked(){return this.options.resizeMode==="scale"}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",richText:Dl(""),size:"m",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(n){const{labelHeight:r,labelWidth:i}=lSe(this.editor,n),{scale:s}=n.props,o=r*s,a=i*s,l=wn*s,c=CE(n);return new yo({children:[new bu({width:l,height:c,isFilled:!0}),new bu({x:n.props.align==="start"?0:n.props.align==="end"?l-a:(l-a)/2,y:n.props.verticalAlign==="start"?0:n.props.verticalAlign==="end"?c-o:(c-o)/2,width:a,height:o,isFilled:!0,isLabel:!0})]})}getHandles(n){const{scale:r}=n.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const s=this.editor.getZoomLevel();if(s*r<.25)return[];const o=CE(n),a=wn*r,l=Kmt/s*r;return s*r<.5?[{id:"bottom",index:"a3",type:"clone",x:a/2,y:o+l}]:[{id:"top",index:"a1",type:"clone",x:a/2,y:-l},{id:"right",index:"a2",type:"clone",x:a+l,y:o/2},{id:"bottom",index:"a3",type:"clone",x:a/2,y:o+l},{id:"left",index:"a4",type:"clone",x:-l,y:o/2}]}onResize(n,r){const{resizeMode:i}=this.options;switch(i){case"none":return;case"scale":return Fme(n,r);default:throw Yt(i)}}getText(n){return wg(this.editor,n.props.richText)}getFontFaces(n){return Uo(n.props.richText)?Mr:d6(this.editor,n.props.richText,{family:`tldraw_${n.props.font}`,weight:"normal",style:"normal"})}component(n){const{id:r,type:i,props:{labelColor:s,scale:o,color:a,font:l,size:c,align:u,richText:d,verticalAlign:h,fontSizeAdjustment:f}}=n,y=Rvt(r),b=$l(),v=wn*o,x=CE(n),C=ie("shape rotation",()=>{var D;return((D=this.editor.getShapePageTransform(r))==null?void 0:D.rotation())??0},[this.editor]),E=ie("zoom",()=>this.editor.getZoomLevel()<.35/o,[o,this.editor]),I=ie("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),P=n.id===this.editor.getOnlySelectedShapeId(),_=_9(this.editor,n.id),A=Uo(d);return g.jsxs(g.Fragment,{children:[g.jsx("div",{id:r,className:"tl-note__container",style:{width:v,height:x,backgroundColor:b[a].note.fill,borderBottom:E?I?`${2*o}px solid rgb(20, 20, 20)`:`${2*o}px solid rgb(144, 144, 144)`:"none",boxShadow:E?"none":Nvt(n.id,C,o)},children:(P||_||!A)&&g.jsx(R9,{shapeId:r,type:i,font:l,fontSize:(f||uf[c])*o,lineHeight:Ds.lineHeight,align:u,verticalAlign:h,richText:d,isSelected:P,labelColor:s==="black"?b[a].note.text:b[s].fill,wrap:!0,padding:ao*o,hasCustomTabBehavior:!0,onKeyDown:y})}),"url"in n.props&&n.props.url&&g.jsx(ev,{url:n.props.url})]})}indicator(n){const{scale:r}=n.props;return g.jsx("rect",{rx:r,width:te(wn*r),height:te(CE(n))})}toSvg(n,r){const i=Ud({isDarkMode:r.isDarkMode}),s=jvt(n),o=g.jsx(N9,{fontSize:n.props.fontSizeAdjustment||uf[n.props.size],font:n.props.font,align:n.props.align,verticalAlign:n.props.verticalAlign,richText:n.props.richText,labelColor:i[n.props.color].note.text,bounds:s,padding:ao,showTextOutline:!1});return g.jsxs(g.Fragment,{children:[g.jsx("rect",{x:5,y:5,rx:1,width:wn-10,height:s.h,fill:"rgba(0,0,0,.1)"}),g.jsx("rect",{rx:1,width:wn,height:s.h,fill:i[n.props.color].note.fill}),o]})}onBeforeCreate(n){return cne(this.editor,n)}onBeforeUpdate(n,r){if(!(Af(n.props.richText,r.props.richText)&&n.props.font===r.props.font&&n.props.size===r.props.size))return cne(this.editor,r)}getInterpolatedProps(n,r,i){return{...i>.5?r.props:n.props,scale:At(n.props.scale,r.props.scale,i)}}}N(gT,"type","note"),N(gT,"props",khe),N(gT,"migrations",Ahe);function cne(t,e){const{labelHeight:n,fontSizeAdjustment:r}=lSe(t,e),i=Math.max(0,n-wn);if(i!==e.props.growY||r!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:i,fontSizeAdjustment:r}}}function Ovt(t,e){const{richText:n}=e.props;if(Uo(n))return{labelHeight:uf[e.props.size]*Ds.lineHeight+ao*2,labelWidth:100,fontSizeAdjustment:0};const r=uf[e.props.size];let i=0,s=0,o=wn,a=wn;const l=1;do{i=Math.min(r,r-s);const c=t_(t,n),u=t.textMeasure.measureHtml(c,{...Ds,fontFamily:xf[e.props.font],fontSize:i,maxWidth:wn-ao*2-l,disableOverflowWrapBreaking:!0,measureScrollWidth:!0});if(o=u.h+ao*2,a=u.w+ao*2,i<=14){const d=t_(t,n),h=t.textMeasure.measureHtml(d,{...Ds,fontFamily:xf[e.props.font],fontSize:i,maxWidth:wn-ao*2-l});o=h.h+ao*2,a=h.w+ao*2;break}if(u.scrollWidth.toFixed(0)===u.w.toFixed(0))break}while(s++<50);return{labelHeight:o,labelWidth:a,fontSizeAdjustment:i}}const Dvt=new zs;function lSe(t,e){return Dvt.get(e,()=>Ovt(t,e))}function Rvt(t){const e=re(),n=Ave();return S.useCallback(r=>{const i=e.getShape(t);if(!i)return;const s=r.key==="Tab",o=(r.metaKey||r.ctrlKey)&&r.key==="Enter";if(s||o){r.preventDefault();const a=e.getShapePageTransform(t),l=a.rotation(),c=!!(n.dir==="rtl"||Awe(wg(e,i.props.richText))),u=(wn+e.options.adjacentShapeMargin+(o&&!r.shiftKey?i.props.growY:0))*i.props.scale,d=new M(s?r.shiftKey!=c?-1:1:0,o?r.shiftKey?-1:1:0).mul(u).add(HA.clone().mul(i.props.scale)).rot(l).add(a.point()),h=zwe(e,i,d,l);h&&o_(e,h,!0)}},[t,e,n.dir])}function CE(t){return(wn+t.props.growY)*t.props.scale}function Nvt(t,e,n){const r=Fg(t),i=Math.abs(r())+.5,s=Math.cos(e),o=5*n,a=4*n,l=6*n,c=7*n;return`0px ${o-i}px ${o}px -${o}px rgba(15, 23, 31, .6),
	0px ${(a+i*c)*Math.max(0,s)}px ${l+i*c}px -${a+i*l}px rgba(15, 23, 31, ${(.3+i*.1).toFixed(2)}), 
	0px ${48*n}px ${10*n}px -${10*n}px inset rgba(15, 23, 44, ${((.022+r()*.005)*((1+s)/2)).toFixed(2)})`}function jvt(t){return new Ee(0,0,wn,wn+t.props.growY)}const Lvt=_k("text size",(t,e)=>(t.fonts.trackFontsForShape(e),cSe(t,e.props)),{areRecordsEqual:(t,e)=>t.props===e.props});class mT extends pc{constructor(){super(...arguments);N(this,"options",{extraArrowHorizontalPadding:10})}getDefaultProps(){return{color:"black",size:"m",w:8,font:"draw",textAlign:"start",autoSize:!0,scale:1,richText:Dl("")}}getMinDimensions(n){return Lvt.get(this.editor,n.id)}getGeometry(n,r){const{scale:i}=n.props,{width:s,height:o}=this.getMinDimensions(n),a=(r==null?void 0:r.context)??"none";return new bu({x:(a==="@tldraw/arrow-without-arrowhead"?-this.options.extraArrowHorizontalPadding:0)*i,width:(s+(a==="@tldraw/arrow-without-arrowhead"?this.options.extraArrowHorizontalPadding*2:0))*i,height:o*i,isFilled:!0,isLabel:!0})}getFontFaces(n){return d6(this.editor,n.props.richText,{family:`tldraw_${n.props.font}`,weight:"normal",style:"normal"})}getText(n){return wg(this.editor,n.props.richText)}canEdit(){return!0}isAspectRatioLocked(){return!0}component(n){const{id:r,props:{font:i,size:s,richText:o,color:a,scale:l,textAlign:c}}=n,{width:u,height:d}=this.getMinDimensions(n),h=n.id===this.editor.getOnlySelectedShapeId(),f=$l(),y=Fvt(r);return g.jsx(R9,{shapeId:r,classNamePrefix:"tl-text-shape",type:"text",font:i,fontSize:Qy[s],lineHeight:Ds.lineHeight,align:c,verticalAlign:"middle",richText:o,labelColor:f[a].solid,isSelected:h,textWidth:u,textHeight:d,style:{transform:`scale(${l})`,transformOrigin:"top left"},wrap:!0,onKeyDown:y})}indicator(n){const r=this.editor.getShapeGeometry(n).bounds,i=re();return n.props.autoSize&&i.getEditingShapeId()===n.id?null:g.jsx("rect",{width:te(r.width),height:te(r.height)})}toSvg(n,r){const i=this.editor.getShapeGeometry(n).bounds,s=i.width/(n.props.scale??1),o=i.height/(n.props.scale??1),a=Ud(r),l=new Ee(0,0,s,o);return g.jsx(N9,{fontSize:Qy[n.props.size],font:n.props.font,align:n.props.textAlign,verticalAlign:"middle",richText:n.props.richText,labelColor:a[n.props.color].solid,bounds:l,padding:0})}onResize(n,r){const{newPoint:i,initialBounds:s,initialShape:o,scaleX:a,handle:l}=r;if(r.mode==="scale_shape"||l!=="right"&&l!=="left")return{id:n.id,type:n.type,...Fme(n,r)};{const c=Math.max(1,Math.abs(s.width*a)),{x:u,y:d}=a<0?M.Sub(i,M.FromAngle(n.rotation).mul(c)):i;return{id:n.id,type:n.type,x:u,y:d,props:{w:c/o.props.scale,autoSize:!1}}}}onEditEnd(n){wg(this.editor,n.props.richText).trimEnd().length===0&&this.editor.deleteShapes([n.id])}onBeforeUpdate(n,r){if(!r.props.autoSize)return;const i=n.props.size!==r.props.size||n.props.textAlign!==r.props.textAlign||n.props.font!==r.props.font||n.props.scale!==1&&r.props.scale===1,s=!Af(n.props.richText,r.props.richText);if(!i&&!s)return;const o=this.getMinDimensions(n),a=cSe(this.editor,r.props),l=o.width*n.props.scale,c=o.height*n.props.scale,u=a.width*r.props.scale,d=a.height*r.props.scale;let h;switch(r.props.textAlign){case"middle":{h=new M((u-l)/2,s?0:(d-c)/2);break}case"end":{h=new M(u-l,s?0:(d-c)/2);break}default:{if(s)break;h=new M(0,(d-c)/2);break}}if(h){h.rot(r.rotation);const{x:f,y}=r;return{...r,x:f-h.x,y:y-h.y,props:{...r.props,w:u}}}else return{...r,props:{...r.props,w:u}}}}N(mT,"type","text"),N(mT,"props",Mhe),N(mT,"migrations",Ohe);function cSe(t,e){const{font:n,richText:r,size:i,w:s}=e,o=16,a=Qy[i],l=e.autoSize?null:Math.max(o,Math.floor(s)),c=t_(t,r),u=t.textMeasure.measureHtml(c,{...Ds,fontFamily:xf[n],fontSize:a,maxWidth:l});return{width:l??Math.max(o,u.w+1),height:Math.max(a,u.h)}}function Fvt(t){const e=re();return S.useCallback(n=>{if(e.getEditingShapeId()===t)switch(n.key){case"Enter":{(n.ctrlKey||n.metaKey)&&e.complete();break}}},[e,t])}const $vt=new zs;class yT extends zv{constructor(){super(...arguments);N(this,"options",{autoplay:!0})}canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,autoplay:this.options.autoplay,url:"",altText:"",time:0,playing:!0}}getAriaDescriptor(n){return n.props.altText}component(n){return g.jsx(Bvt,{shape:n})}indicator(n){return g.jsx("rect",{width:te(n.props.w),height:te(n.props.h)})}async toSvg(n,r){const i=n.props;if(!i.assetId)return null;const s=this.editor.getAsset(i.assetId);if(!s)return null;const o=await $vt.get(s,async()=>{const a=await r.resolveAssetUrl(s.id,i.w);if(!a)return null;const l=await xa.loadVideo(a);return await xa.getVideoFrameAsDataUrl(l,0)});return o?g.jsx("image",{href:o,width:i.w,height:i.h,"aria-label":n.props.altText}):null}}N(yT,"type","video"),N(yT,"props",Dhe),N(yT,"migrations",Rhe);const Bvt=S.memo(function({shape:e}){const n=re(),r=n.getShapeGeometry(e).bounds.w*n.getZoomLevel()>=110,i=FS(e.id),s=Ive(),{Spinner:o}=Cn(),{asset:a,url:l}=iSe({shapeId:e.id,assetId:e.props.assetId,width:e.props.w}),c=S.useRef(null),[u,d]=S.useState(!1),h=S.useCallback(b=>{b.currentTarget&&d(!0)},[]),[f,y]=S.useState(!1);return S.useEffect(()=>{const b=()=>y(document.fullscreenElement===c.current);return document.addEventListener("fullscreenchange",b),()=>document.removeEventListener("fullscreenchange",b)}),S.useEffect(()=>{const b=c.current;b&&i&&document.activeElement!==b&&b.focus()},[i,u]),g.jsxs(g.Fragment,{children:[g.jsx(of,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:a?"transparent":"var(--color-low)",border:a?"none":"1px solid var(--color-low-border)"},children:g.jsx("div",{className:"tl-counter-scaled",children:g.jsx("div",{className:"tl-video-container",children:a?o&&!a.props.src?g.jsx(o,{}):l?g.jsxs(g.Fragment,{children:[g.jsx("video",{ref:c,style:i?{pointerEvents:"all"}:u?void 0:{display:"none"},className:nt("tl-video",`tl-video-shape-${e.id.split(":")[1]}`,{"tl-video-is-fullscreen":f}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:e.props.autoplay&&!s,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:i&&r,onLoadedData:h,hidden:!u,"aria-label":e.props.altText,children:g.jsx("source",{src:l})},l),!u&&o&&g.jsx(o,{})]}):null:g.jsx(rSe,{})})})}),"url"in e.props&&e.props.url&&g.jsx(ev,{url:e.props.url})]})}),uSe=[mT,lT,cT,dT,gT,pT,uT,aT,hT,s_,fT,yT];function zvt(t){return t.sideEffects.register({instance_page_state:{afterChange:(e,n)=>{if(e.croppingShapeId!==n.croppingShapeId){const r=t.isIn("select.crop");!e.croppingShapeId&&n.croppingShapeId?r||t.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!n.croppingShapeId&&r&&t.setCurrentTool("select.idle")}if(e.editingShapeId!==n.editingShapeId)if(!e.editingShapeId&&n.editingShapeId){if(!t.isIn("select.editing_shape")){const r=t.getEditingShape();r&&r.type==="text"&&t.isInAny("text.pointing","select.resizing")&&t.getInstanceState().isToolLocked?t.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):t.setCurrentTool("select.editing_shape")}}else e.editingShapeId&&!n.editingShapeId&&t.isIn("select.editing_shape")&&t.setCurrentTool("select.idle")}}})}class dSe extends Qe{constructor(){super(...arguments);N(this,"info",{});N(this,"scribbleId","id");N(this,"markId","");N(this,"excludedShapeIds",new Set)}onEnter(n){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=n;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>{if(this.editor.isShapeOrAncestorLocked(s))return!0;if(this.editor.isShapeOfType(s,"group")||this.editor.isShapeOfType(s,"frame")){const o=this.editor.getPointInShapeSpace(s,r);return this.editor.getShapeGeometry(s).bounds.containsPoint(o)}return!1}).map(s=>s.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()}pushPointToScribble(){const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,r)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){const{editor:n,excludedShapeIds:r}=this,i=n.getErasingShapeIds(),s=n.getZoomLevel(),o=n.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:a,previousPagePoint:l}}=n;this.pushPointToScribble();const c=new Set(i),u=this.editor.options.hitTestMargin/s;for(const d of o){if(n.isShapeOfType(d,"group"))continue;const h=n.getShapeMask(d.id);if(h&&!po(a,h))continue;const f=n.getShapeGeometry(d),y=n.getShapePageTransform(d);if(!f||!y)continue;const b=y.clone().invert(),v=b.applyToPoint(l),x=b.applyToPoint(a),{bounds:C}=f;C.minX-u>Math.max(v.x,x.x)||C.minY-u>Math.max(v.y,x.y)||C.maxX+u<Math.min(v.x,x.x)||C.maxY+u<Math.min(v.y,x.y)||f.hitTestLineSegment(v,x,u)&&c.add(n.getOutermostSelectableShape(d).id)}this.editor.setErasingShapes([...c].filter(d=>!r.has(d)))}complete(){const{editor:n}=this;n.deleteShapes(n.getCurrentPageState().erasingShapeIds),this.parent.transition("idle")}cancel(){const{editor:n}=this;n.bailToMark(this.markId),this.parent.transition("idle",this.info)}}N(dSe,"id","erasing");var mF;let Uvt=(mF=class extends Qe{onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},N(mF,"id","idle"),mF);var yF;let Hvt=(yF=class extends Qe{onEnter(){const e=this.editor.getZoomLevel(),n=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,i=new Set,s=i.size;for(let o=n.length,a=o-1;a>=0;a--){const l=n[a];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,r,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const c=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(c,"frame")&&i.size>s)break;i.add(c.id)}}this.editor.setErasingShapes([...i])}onLongPress(e){this.startErasing(e)}onExit(e,n){n!=="erasing"&&this.editor.setErasingShapes([])}onPointerMove(e){this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}},N(yF,"id","pointing"),yF);class vT extends Qe{static children(){return[Uvt,Hvt,dSe]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}N(vT,"id","eraser"),N(vT,"initial","idle"),N(vT,"isLockable",!1);class hSe extends Qe{constructor(){super(...arguments);N(this,"initialCamera",new M)}onEnter(){this.initialCamera=M.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:n,editor:r}=this,{currentScreenPoint:i,originScreenPoint:s}=r.inputs,o=M.Sub(i,s).div(r.getZoomLevel());o.len2()!==0&&r.setCamera(n.clone().add(o))}complete(){const{editor:n}=this,{pointerVelocity:r}=n.inputs,i=Math.min(r.len(),2);i>.1&&this.editor.slideCamera({speed:i,direction:r}),this.parent.transition("idle")}}N(hSe,"id","dragging");var vF;let Vvt=(vF=class extends Qe{onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},N(vF,"id","idle"),vF);var bF;let Wvt=(bF=class extends Qe{onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}},N(bF,"id","pointing"),bF);class bT extends Qe{static children(){return[Vvt,Wvt,hSe]}onDoubleClick(e){if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomIn(n,{animation:{duration:220,easing:Ms.easeOutQuint}})}}onTripleClick(e){if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomOut(n,{animation:{duration:320,easing:Ms.easeOutQuint}})}}onQuadrupleClick(e){if(e.phase==="settle"){const n=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:r}}=this.editor;n===1?this.editor.zoomToFit({animation:{duration:400,easing:Ms.easeOutQuint}}):this.editor.resetZoom(r,{animation:{duration:320,easing:Ms.easeOutQuint}})}}}N(bT,"id","hand"),N(bT,"initial","idle"),N(bT,"isLockable",!1);var xF;let Kvt=(xF=class extends Qe{onCancel(){this.editor.setCurrentTool("select")}onPointerDown(e){this.parent.transition("lasering",e)}},N(xF,"id","idle"),xF);class fSe extends Qe{constructor(){super(...arguments);N(this,"scribbleId","id")}onEnter(){const n=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=n.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,r)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}N(fSe,"id","lasering");class xT extends Qe{static children(){return[Kvt,fSe]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}N(xT,"id","laser"),N(xT,"initial","idle"),N(xT,"isLockable",!1);class pSe extends Qe{constructor(){super(...arguments);N(this,"info",{});N(this,"initialSelectedShapeIds",[]);N(this,"excludedShapeIds",new Set);N(this,"isWrapMode",!1);N(this,"viewportDidChange",!1)}cleanupViewportChangeReactor(){}onEnter(n){const{editor:r}=this,{altKey:i}=r.inputs;this.isWrapMode=r.user.getIsWrapMode(),this.viewportDidChange=!1;let s=!0;if(this.cleanupViewportChangeReactor=Ma("viewport change while brushing",()=>{r.getViewportPageBounds(),!s&&!this.viewportDidChange&&(this.viewportDidChange=!0)}),i){this.parent.transition("scribble_brushing",n);return}this.excludedShapeIds=new Set(r.getCurrentPageShapes().filter(o=>r.isShapeOfType(o,"group")||r.isShapeOrAncestorLocked(o)).map(o=>o.id)),this.info=n,this.initialSelectedShapeIds=r.getSelectedShapeIds().slice(),this.hitTestShapes(),s=!1}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null}),this.cleanupViewportChangeReactor()}onTick({elapsed:n}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(n)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(n){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",n)}onKeyDown(n){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",n):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:n,excludedShapeIds:r,isWrapMode:i}=this,{inputs:{originPagePoint:s,currentPagePoint:o,shiftKey:a,ctrlKey:l}}=n,c=new Set(a?this.initialSelectedShapeIds:[]),u=i?!l:l,d=Ee.FromPoints([s,o]),{corners:h}=d;let f,y,b,v,x,C;const I=n.getViewportPageBounds().contains(d)&&!this.viewportDidChange?n.getCurrentPageRenderingShapesSorted():n.getCurrentPageShapesSorted(),P=n.getCurrentPageId();e:for(let D=0,L=I.length;D<L;D++){if(b=I[D],r.has(b.id)||c.has(b.id)||(v=n.getShapePageBounds(b),!v))continue e;if(d.contains(v)){this.handleHit(b,o,P,c,h);continue e}if(u||n.isShapeOfType(b,"frame"))continue e;if(d.collides(v)){if(x=n.getShapePageTransform(b),!x)continue e;C=x.clone().invert().applyToPoints(h);const z=n.getShapeGeometry(b);t:for(let $=0;$<4;$++)if(f=C[$],y=C[($+1)%4],z.hitTestLineSegment(f,y,0)){this.handleHit(b,o,P,c,h);break t}}}const _=n.getInstanceState().brush;(!_||!d.equals(_))&&n.updateInstanceState({brush:{...d.toJson()}});const A=n.getSelectedShapeIds();(A.length!==c.size||A.some(D=>!c.has(D)))&&n.setSelectedShapes(Array.from(c))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(n,r,i,s,o){if(n.parentId===i){s.add(n.id);return}const a=this.editor.getOutermostSelectableShape(n),l=this.editor.getShapeMask(a.id);l&&!afe(l,o)&&!po(r,l)||s.add(a.id)}}N(pSe,"id","brushing");const nv={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class gSe extends Qe{constructor(){super(...arguments);N(this,"info",{})}updateCursor(){const n=this.editor.getSelectedShapes(),r=nv[this.info.handle];this.editor.setCursor({type:r,rotation:n.length===1?this.editor.getSelectionRotation():0})}onEnter(n){this.info=n,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}N(gSe,"id","pointing_resize_handle");class j9 extends Qe{constructor(){super(...arguments);N(this,"info",{});N(this,"markId","");N(this,"snapshot",{})}onEnter(n){this.info=n,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const r=nv[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()})}updateShapes(){var f;const{shape:n,cursorHandleOffset:r}=this.snapshot;if(!n)return;const i=this.editor.getShapeUtil(n.type);if(!i)return;const{shiftKey:s}=this.editor.inputs,o=this.editor.inputs.currentPagePoint.clone().sub(r),a=this.editor.inputs.originPagePoint.clone().sub(r),l=o.clone().sub(a).rot(-n.rotation),c=n.props.crop??dc(),u=Ec(n.props,c),h=(((f=i.onCrop)==null?void 0:f.bind(i))??bpt)(n,{handle:this.info.handle,change:l,crop:c,uncroppedSize:u,initialShape:this.snapshot.shape,aspectRatioLocked:s});h&&(this.editor.updateShapes([{id:n.id,type:n.type,...h}]),this.updateCursor())}complete(){this.updateShapes(),yn(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const n=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getOnlySelectedShape(),s=this.editor.getSelectionRotatedPageBounds(),o=M.RotWith(s.getHandlePoint(this.info.handle),s.point,n),a=M.Sub(r,o);return{shape:i,cursorHandleOffset:a}}}N(j9,"id","cropping");function L9(t,e=!1){const n=t.getZoomLevel(),{inputs:{currentPagePoint:r}}=t;return t.getShapeAtPoint(r,{hitInside:!1,hitLabels:e,margin:t.options.hitTestMargin/n,renderingOnly:!0})??t.getSelectedShapeAtPoint(r)}function mSe(t,e,n){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const i=t.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;i==="x"?n.x=0:i==="y"&&(n.y=0),n.rot(-e.rotation);const{w:s,h:o}=Ec(e.props,r),a=r.bottomRight.x-r.topLeft.x,l=r.bottomRight.y-r.topLeft.y,c=ar(r),u=1-a,d=1-l;return c.topLeft.x=Ct(c.topLeft.x-n.x/s,0,u),c.topLeft.y=Ct(c.topLeft.y-n.y/o,0,d),c.bottomRight.x=c.topLeft.x+a,c.bottomRight.y=c.topLeft.y+l,{id:e.id,type:e.type,props:{crop:c}}}var wF;let qvt=(wF=class extends Qe{onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){var n;if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=L9(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(n=this.editor.getShapeUtil(e.shape))!=null&&n.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}onDoubleClick(e){var s;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const n=this.editor.getCroppingShapeId();if(!n)return;const r=this.editor.getShape(n);if(!r)return;const i=this.editor.getShapeUtil(r);if(i){if(e.target==="selection"){(s=i.onDoubleClickEdge)==null||s.call(i,r,e);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:n}}}=this,r=n.has("ShiftLeft"),i=new M(0,0);if(n.has("ArrowLeft")&&(i.x+=1),n.has("ArrowRight")&&(i.x-=1),n.has("ArrowUp")&&(i.y+=1),n.has("ArrowDown")&&(i.y-=1),i.equals(new M(0,0)))return;r&&i.mul(10);const s=this.editor.getShape(this.editor.getCroppingShapeId());if(!s)return;const o=mSe(this.editor,s,i);o&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([o]))}},N(wF,"id","idle"),wF);class ySe extends Qe{onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.startDragging(e)}onLongPress(e){this.startDragging(e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}startDragging(e){this.editor.setCurrentTool("select.crop.translating_crop",e)}}N(ySe,"id","pointing_crop");class F9 extends Qe{constructor(){super(...arguments);N(this,"info",{})}onEnter(n){this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];if(!r)return;const i=nv[this.info.handle];this.editor.setCursor({type:i,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(r.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}N(F9,"id","pointing_crop_handle");class vSe extends Qe{constructor(){super(...arguments);N(this,"info",{});N(this,"markId","");N(this,"snapshot",{})}onEnter(n){this.info=n,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(n){switch(n.key){case"Alt":case"Shift":{this.updateShapes();return}}}onKeyUp(n){switch(n.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const n=this.snapshot.shape;if(!n)return;const{originPagePoint:r,currentPagePoint:i}=this.editor.inputs,s=i.clone().sub(r),o=mSe(this.editor,n,s);o&&this.editor.updateShapes([o])}}N(vSe,"id","translating_crop");class yB extends Qe{constructor(){super(...arguments);N(this,"markId","");N(this,"didExit",!1)}static children(){return[qvt,vSe,ySe,F9,j9]}onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}N(yB,"id","crop"),N(yB,"initial","idle");class bSe extends Qe{constructor(){super(...arguments);N(this,"shapeId");N(this,"initialHandle");N(this,"initialAdjacentHandle");N(this,"initialPagePoint");N(this,"markId");N(this,"initialPageTransform");N(this,"initialPageRotation");N(this,"info");N(this,"isPrecise",!1);N(this,"isPreciseId",null);N(this,"pointingId",null);N(this,"exactTimeout",-1)}onEnter(n){var h;const{shape:r,isCreating:i,creatingMarkId:s,handle:o}=n;if(this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.shapeId=r.id,this.markId="",i)if(s)this.markId=s;else{const f=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);f&&(this.markId=f)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");this.initialHandle=ar(o),this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:i?"cross":"grabbing",rotation:0});const a=this.editor.getShapeHandles(r).sort(Xi),l=a.findIndex(f=>f.id===n.handle.id);this.initialAdjacentHandle=null;for(let f=l+1;f<a.length;f++){const y=a[f];if(y.type==="vertex"&&y.id!=="middle"&&y.id!==n.handle.id){this.initialAdjacentHandle=y;break}}if(!this.initialAdjacentHandle)for(let f=a.length-1;f>=0;f--){const y=a[f];if(y.type==="vertex"&&y.id!=="middle"&&y.id!==n.handle.id){this.initialAdjacentHandle=y;break}}if(this.editor.isShapeOfType(r,"arrow")){const f=wi(this.editor,r)[n.handle.id];this.isPrecise=!1,f&&(this.isPrecise=f.props.isPrecise,this.isPrecise?this.isPreciseId=f.toId:this.resetExactTimeout())}const c={handle:this.initialHandle,isPrecise:this.isPrecise,initial:r},u=this.editor.getShapeUtil(r),d=(h=u.onHandleDragStart)==null?void 0:h.call(u,r,c);d&&this.editor.updateShapes([{...d,id:r.id,type:r.type}]),this.update(),this.editor.select(this.shapeId)}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),u9(this.editor),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){var i;this.editor.snaps.clearIndicators(),yn(this.editor,[this.shapeId]);const n=this.editor.getShape(this.shapeId);if(n){const s=this.editor.getShapeUtil(n),o={handle:this.initialHandle,isPrecise:this.isPrecise,initial:this.info.shape},a=(i=s.onHandleDragEnd)==null?void 0:i.call(s,n,o);a&&this.editor.updateShapes([{...a,id:n.id,type:n.type}])}const{onInteractionEnd:r}=this.info;if(this.editor.getInstanceState().isToolLocked&&r){this.editor.setCurrentTool(r,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){var i;const n=this.editor.getShape(this.shapeId);if(n){const s=this.editor.getShapeUtil(n),o={handle:this.initialHandle,isPrecise:this.isPrecise,initial:this.info.shape};(i=s.onHandleDragCancel)==null||i.call(s,n,o)}this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:r}=this.info;if(r){this.editor.setCurrentTool(r,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var A;const{editor:n,shapeId:r,initialPagePoint:i}=this,{initialHandle:s,initialPageRotation:o,initialAdjacentHandle:a}=this,l=this.editor.user.getIsSnapMode(),{snaps:c,inputs:{currentPagePoint:u,shiftKey:d,ctrlKey:h,altKey:f,pointerVelocity:y}}=n,b=this.info.shape,v=n.getShape(r);if(!v)return;const x=n.getShapeUtil(v),C=n.isShapeOfType(v,"arrow")?wi(n,v)[s.id]:void 0;let E=u.clone().sub(i).rot(-o).add(s);if(d&&a&&s.id!=="middle"){const D=M.Angle(a,E),z=GI(D,24)-D;E=M.RotWith(E,a,z)}n.snaps.clearIndicators();let I={...s,x:E.x,y:E.y};if(s.canSnap&&(l?!h:h)){if(!n.getShapePageTransform(v.id))throw Error("Expected a page transform");const L=c.handles.snapHandle({currentShapeId:r,handle:I});L&&(L.nudge.rot(-n.getShapeParentTransform(v).rotation()),E.add(L.nudge),I={...s,x:E.x,y:E.y})}const P=(A=x.onHandleDrag)==null?void 0:A.call(x,v,{handle:I,isPrecise:this.isPrecise||f,initial:b}),_={id:v.id,type:v.type,...P};if(s.type==="vertex"&&this.editor.isShapeOfType(v,"arrow")){const D=wi(n,v)[s.id];D?(C==null?void 0:C.toId)!==D.toId&&(this.pointingId=D.toId,this.isPrecise=y.len()<.5||f,this.isPreciseId=this.isPrecise?D.toId:null,this.resetExactTimeout()):C&&(this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}P&&n.updateShapes([_])}}N(bSe,"id","dragging_handle");function xSe(t){return t.isLabel?[t]:t instanceof yo?t.children.filter(e=>e.isLabel):[]}class wSe extends Qe{constructor(){super(...arguments);N(this,"hitShapeForPointerUp",null);N(this,"info",{})}onEnter(n){const r=this.editor.getEditingShape();if(!r)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=n,n.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),ad(this.editor),this.editor.select(r)}onExit(){const{editingShapeId:n}=this.editor.getCurrentPageState();n&&(this.editor.setEditingShape(null),ad.cancel(),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{})))}onPointerMove(n){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",n),this.hitShapeForPointerUp=null;return}switch(n.target){case"shape":case"canvas":{ad(this.editor);return}}}onPointerDown(n){switch(this.hitShapeForPointerUp=null,n.target){case"canvas":{const r=L9(this.editor,!0);if(r){this.onPointerDown({...n,shape:r,target:"shape"});return}break}case"shape":{const{shape:r}=n,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");const s=this.editor.getShapeUtil(r).getGeometry(r),o=xSe(s),a=o.length===1?o[0]:void 0,l=this.editor.isShapeOfType(i,"text")&&wg(this.editor,i.props.richText).trim()==="";if(a&&!l){const c=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(a.bounds.containsPoint(c,0)&&a.hitTestPoint(c)){if(r.id===i.id)return;this.hitShapeForPointerUp=r,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(r.id);return}}else{if(r.id===i.id)this.editor.isShapeOfType(r,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",n));else{this.parent.transition("pointing_shape",n);return}return}break}}this.parent.transition("idle",n),this.editor.root.handleEvent(n)}onPointerUp(n){const r=this.hitShapeForPointerUp;if(!r)return;this.hitShapeForPointerUp=null;const i=this.editor.getShapeUtil(r);if(r.isLocked)return;if(this.editor.getIsReadonly()&&!i.canEditInReadonly(r)){this.parent.transition("pointing_shape",n);return}this.editor.select(r.id);const s=this.editor.getEditingShape(),o=s&&s.id!==r.id;this.editor.setEditingShape(r.id);const a=sn.isIos||sn.isAndroid;!a||!o?this.editor.emit("place-caret",{shapeId:r.id,point:n.point}):a&&o&&this.editor.emit("select-all-text",{shapeId:r.id}),ad(this.editor)}onComplete(n){this.editor.getContainer().focus(),this.parent.transition("idle",n)}onCancel(n){this.editor.getContainer().focus(),this.parent.transition("idle",n)}}N(wSe,"id","editing_shape");function une(t){const e=t.getOnlySelectedShape();return!!(e&&!t.isShapeOrAncestorLocked(e)&&t.getShapeUtil(e).canCrop(e))}function a_(t,e){const n=t.getSelectedShapeIds(),{currentPagePoint:r}=t.inputs,{shiftKey:i,altKey:s,accelKey:o}=e,a=i||o,l=t.getShapeAtPoint(r,{hitInside:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:c=>!c.isLocked});if(l){const c=t.getOutermostSelectableShape(l);if(a&&!s)t.cancelDoubleClick(),n.includes(c.id)?(t.markHistoryStoppingPoint("deselecting shape"),t.deselect(c)):(t.markHistoryStoppingPoint("shift selecting shape"),t.setSelectedShapes([...n,c.id]));else{let u;c===l||c.id===t.getFocusedGroupId()||n.includes(c.id)?u=l:u=c,u&&!n.includes(u.id)&&(t.markHistoryStoppingPoint("selecting shape"),t.select(u.id))}}else{if(a)return;{n.length>0&&(t.markHistoryStoppingPoint("selecting none"),t.selectNone());const c=t.getFocusedGroupId();if(io(c)){const u=t.getShape(c);t.isPointInShape(u,r,{margin:0,hitInside:!0})||t.setFocusedGroup(null)}}}}const Gvt=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var SF;let Yvt=(SF=class extends Qe{constructor(){super(...arguments);N(this,"selectedShapesOnKeyDown",[])}onEnter(){this.parent.setCurrentToolIdMask(void 0),ad(this.editor),this.selectedShapesOnKeyDown=[],this.editor.setCursor({type:"default",rotation:0})}onExit(){ad.cancel()}onPointerMove(){ad(this.editor)}onPointerDown(n){const r=n.ctrlKey&&une(this.editor);switch(n.target){case"canvas":{const i=L9(this.editor);if(i&&!i.isLocked){this.onPointerDown({...n,shape:i,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((s.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&dne(this.editor,a)){this.onPointerDown({...n,target:"selection"});return}this.parent.transition("pointing_canvas",n);break}case"shape":{const{shape:i}=n;if(this.isOverArrowLabelTest(i)){this.parent.transition("pointing_arrow_label",n);break}if(this.editor.isShapeOrAncestorLocked(i)){this.parent.transition("pointing_canvas",n);break}this.parent.transition("pointing_shape",n);break}case"handle":{if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",n):this.parent.transition("pointing_handle",n);break}case"selection":{switch(n.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{if(n.accelKey){this.parent.transition("brushing",n);break}this.parent.transition("pointing_rotate_handle",n);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{if(r)this.parent.transition("crop.pointing_crop_handle",n);else{if(n.accelKey){this.parent.transition("brushing",n);break}this.parent.transition("pointing_resize_handle",n)}break}default:{const i=this.editor.getHoveredShape();if(i&&!this.editor.getSelectedShapeIds().includes(i.id)&&!i.isLocked){this.onPointerDown({...n,shape:i,target:"shape"});return}this.parent.transition("pointing_selection",n)}}break}}}onDoubleClick(n){var r,i,s,o,a;if(!(this.editor.inputs.shiftKey||n.phase!=="up")&&!(n.ctrlKey||n.shiftKey))switch(n.target){case"canvas":{const l=this.editor.getHoveredShape(),c=l&&!this.editor.isShapeOfType(l,"group")?l:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),u=this.editor.getFocusedGroupId();if(c){if(this.editor.isShapeOfType(c,"group")){a_(this.editor,n);return}else{const d=this.editor.getShape(c.parentId);if(d&&this.editor.isShapeOfType(d,"group")&&!(u&&d.id===u)){a_(this.editor,n);return}}this.onDoubleClick({...n,shape:c,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(n);break}case"selection":{if(this.editor.getIsReadonly())break;const l=this.editor.getOnlySelectedShape();if(l){const c=this.editor.getShapeUtil(l);if(!this.canInteractWithShapeInReadOnly(l))return;if(n.handle==="right"||n.handle==="left"||n.handle==="top"||n.handle==="bottom"){const u=(r=c.onDoubleClickEdge)==null?void 0:r.call(c,l,n);if(u){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([u]),yn(this.editor,[l.id]);return}}if(n.handle==="top_left"||n.handle==="top_right"||n.handle==="bottom_right"||n.handle==="bottom_left"){const u=(i=c.onDoubleClickCorner)==null?void 0:i.call(c,l,n);if(u){this.editor.markHistoryStoppingPoint("double click corner"),this.editor.updateShapes([u]),yn(this.editor,[l.id]);return}}if(c.canCrop(l)&&!this.editor.isShapeOrAncestorLocked(l)){this.parent.transition("crop",n);return}this.shouldStartEditingShape(l)&&this.startEditingShape(l,n,!0)}break}case"shape":{const{shape:l}=n,c=this.editor.getShapeUtil(l);if(l.type!=="video"&&l.type!=="embed"&&this.editor.getIsReadonly())break;if(c.onDoubleClick){const u=(s=c.onDoubleClick)==null?void 0:s.call(c,l);if(u){this.editor.updateShapes([u]);return}}if(c.canCrop(l)&&!this.editor.isShapeOrAncestorLocked(l)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select((o=n.shape)==null?void 0:o.id),this.parent.transition("crop",n);return}this.shouldStartEditingShape(l)?this.startEditingShape(l,n,!0):this.handleDoubleClickOnCanvas(n);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape:l,handle:c}=n,u=this.editor.getShapeUtil(l),d=(a=u.onDoubleClickHandle)==null?void 0:a.call(u,l,c);d?this.editor.updateShapes([d]):this.shouldStartEditingShape(l)&&this.startEditingShape(l,n,!0)}}}onRightClick(n){switch(n.target){case"canvas":{const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(i){this.onRightClick({...n,shape:i,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((s.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&dne(this.editor,a)){this.onRightClick({...n,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:r}=this.editor.getCurrentPageState(),{shape:i}=n,s=this.editor.getOutermostSelectableShape(i,o=>!r.includes(o.id));!r.includes(s.id)&&!this.editor.findShapeAncestor(s,o=>r.includes(o.id))&&(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([s.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(n){switch(this.selectedShapesOnKeyDown=this.editor.getSelectedShapes(),n.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{if(n.accelKey){n.shiftKey?n.code==="ArrowDown"?this.editor.selectFirstChildShape():n.code==="ArrowUp"&&this.editor.selectParentShape():this.editor.selectAdjacentShape(n.code.replace("Arrow","").toLowerCase());return}this.nudgeSelectedShapes(!1);return}}if(Jn.editOnType.get()&&!Gvt.includes(n.key)&&!n.altKey&&!n.ctrlKey){const r=this.editor.getOnlySelectedShape();if(r&&this.editor.isShapeOfType(r,"note")&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...n,target:"shape",shape:r},!0);return}}}onKeyRepeat(n){switch(n.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{if(n.accelKey){this.editor.selectAdjacentShape(n.code.replace("Arrow","").toLowerCase());return}this.nudgeSelectedShapes(!0);break}case"Tab":{this.editor.getSelectedShapes().length&&this.editor.selectAdjacentShape(n.shiftKey?"prev":"next");break}}}onKeyUp(n){switch(n.code){case"Enter":{if(!this.selectedShapesOnKeyDown.length)return;const r=this.editor.getSelectedShapes();if(r.every(s=>this.editor.isShapeOfType(s,"group"))){this.editor.setSelectedShapes(r.flatMap(s=>this.editor.getSortedChildIdsForParent(s.id)));return}const i=this.editor.getOnlySelectedShape();if(i&&this.shouldStartEditingShape(i)){this.startEditingShape(i,{...n,target:"shape",shape:i},!0);return}une(this.editor)&&this.parent.transition("crop",n);break}case"Tab":{this.editor.getSelectedShapes().length&&this.editor.selectAdjacentShape(n.shiftKey?"prev":"next");break}}}shouldStartEditingShape(n=this.editor.getOnlySelectedShape()){return!n||this.editor.isShapeOrAncestorLocked(n)&&n.type!=="embed"||!this.canInteractWithShapeInReadOnly(n)?!1:this.editor.getShapeUtil(n).canEdit(n)}startEditingShape(n,r,i){this.editor.isShapeOrAncestorLocked(n)&&n.type!=="embed"||(this.editor.markHistoryStoppingPoint("editing shape"),o_(this.editor,n,i),this.parent.transition("editing_shape",r))}isOverArrowLabelTest(n){if(!n)return!1;if(this.editor.isShapeOfType(n,"arrow")){const r=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),i=this.editor.getShapeGeometry(n).children[1];if(i&&po(r,i.vertices))return!0}return!1}handleDoubleClickOnCanvas(n){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const r=Sn(),{x:i,y:s}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:r,type:"text",x:i,y:s,props:{richText:Dl(""),autoSize:!0}}]);const o=this.editor.getShape(r);if(!o)return;const a=this.editor.getShapeUtil(o);this.editor.getIsReadonly()&&!a.canEditInReadonly(o)||(this.editor.setEditingShape(r),this.editor.select(r),this.parent.transition("editing_shape",n))}nudgeSelectedShapes(n=!1){const{editor:{inputs:{keys:r}}}=this,i=r.has("ShiftLeft"),s=new M(0,0);if(r.has("ArrowLeft")&&(s.x-=1),r.has("ArrowRight")&&(s.x+=1),r.has("ArrowUp")&&(s.y-=1),r.has("ArrowDown")&&(s.y+=1),s.equals(new M(0,0)))return;n||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),a=this.editor.getInstanceState().isGridMode?i?o*Zvt:o:i?Xvt:Jvt,l=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(l,s.mul(a)),yn(this.editor,l)}canInteractWithShapeInReadOnly(n){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(n).canEditInReadonly(n))}},N(SF,"id","idle"),SF);const Xvt=10,Jvt=1,Zvt=5;function dne(t,e){const n=t.getSelectionRotatedPageBounds();if(!n)return!1;const r=t.getSelectionRotation();return r?po(e,n.corners.map(i=>M.RotWith(i,n.point,r))):n.containsPoint(e)}class SSe extends Qe{constructor(){super(...arguments);N(this,"shapeId","");N(this,"markId","");N(this,"wasAlreadySelected",!1);N(this,"didDrag",!1);N(this,"didCtrlOnEnter",!1);N(this,"info",{});N(this,"_labelDragOffset",new M(0,0))}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(n){const{shape:r}=n;this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.info=n,this.shapeId=r.id,this.didDrag=!1,this.didCtrlOnEnter=n.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===r.id,this.updateCursor();const s=this.editor.getShapeGeometry(r).children[1];if(!s)throw Error(`Expected to find an arrow label geometry for shape: ${r.id}`);const{currentPagePoint:o}=this.editor.inputs,a=this.editor.getPointInShapeSpace(r,o);if(this._labelDragOffset=M.Sub(s.center,a),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),n.shiftKey||n.accelKey){const c=this.editor.getSelectedShapeIds();this.editor.setSelectedShapes([...c,this.shapeId]);return}this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){const{isDragging:n}=this.editor.inputs;if(!n)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}const r=this.editor.getShape(this.shapeId);if(!r)return;const i=this.editor.getShapeUtil("arrow").options,s=e1(this.editor,r),o=this.editor.getShapePageTransform(r.id),a=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint).add(this._labelDragOffset),l=Xwe(this.editor,r);let c=s.uninterpolateAlongEdge(a);isNaN(c)&&(c=l);const u=o.applyToPoint(s.interpolateAlongEdge(c)),d=o.applyToPoint(s.interpolateAlongEdge(l));M.DistMin(u,d,i.labelCenterSnapDistance/this.editor.getZoomLevel())&&(c=l),this.didDrag=!0,this.editor.updateShape({id:r.id,type:r.type,props:{labelPosition:c}})}onPointerUp(){const n=this.editor.getShape(this.shapeId);n&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(n.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}N(SSe,"id","pointing_arrow_label");class CSe extends Qe{onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){a_(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}N(CSe,"id","pointing_canvas");class ESe extends Qe{constructor(){super(...arguments);N(this,"didCtrlOnEnter",!1);N(this,"info",{})}onEnter(n){this.info=n,this.didCtrlOnEnter=n.accelKey;const{shape:r}=n;if(this.editor.isShapeOfType(r,"arrow")){const i=wi(this.editor,r),s=i[n.handle.id],o=i[n.handle.id==="start"?"end":"start"],a=this.editor.getShapePageTransform(r.id);s&&BA({editor:this.editor,pointInPageSpace:a.applyToPoint(n.handle),arrow:r,isPrecise:s.props.isPrecise,currentBinding:s,oppositeBinding:o})}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:n,handle:r}=this.info;if(this.editor.isShapeOfType(n,"note")){const{editor:i}=this,s=hne(i,n,r,!1);if(s){o_(i,s,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(n){const{editor:r}=this;r.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",n):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:n}=this;if(n.getIsReadonly())return;const{shape:r,handle:i}=this.info;if(n.isShapeOfType(r,"note")){const s=hne(n,r,i,!0);if(s){const o=n.getPointInParentSpace(s,n.inputs.originPagePoint).sub(M.Rot(HA.clone().mul(r.props.scale),s.rotation));n.updateShape({...s,x:o.x,y:o.y}),n.setHoveredShape(s.id).select(s.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:n.getShape(s),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{o_(n,s,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}N(ESe,"id","pointing_handle");function hne(t,e,n,r){const i=t.getShapePageTransform(e.id),s=i.point(),o=i.rotation(),l=$we(t,s,o,e.props.growY*e.props.scale,0,e.props.scale)[n.index];if(l)return zwe(t,e,l,o,r)}class TSe extends Qe{constructor(){super(...arguments);N(this,"info",{})}updateCursor(){this.editor.setCursor({type:nv[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(n){this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.info=n,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}N(TSe,"id","pointing_rotate_handle");class ISe extends Qe{constructor(){super(...arguments);N(this,"info",{})}onEnter(n){this.info=n}onPointerUp(n){a_(this.editor,n),this.parent.transition("idle",n)}onPointerMove(n){this.editor.inputs.isDragging&&this.startTranslating(n)}onLongPress(n){this.startTranslating(n)}startTranslating(n){this.editor.getIsReadonly()||this.parent.transition("translating",n)}onDoubleClick(n){var s,o;const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(o=(s=this.parent).onDoubleClick)==null||o.call(s,{...n,target:"shape",shape:this.editor.getShape(i)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}N(ISe,"id","pointing_selection");class PSe extends Qe{constructor(){super(...arguments);N(this,"hitShape",{});N(this,"hitShapeForPointerUp",{});N(this,"isDoubleClick",!1);N(this,"didCtrlOnEnter",!1);N(this,"didSelectOnEnter",!1)}onEnter(n){const r=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),s=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:o}}=this.editor,{shiftKey:a,altKey:l,accelKey:c}=n;this.hitShape=n.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=c;const u=this.editor.getOutermostSelectableShape(n.shape),d=this.editor.findShapeAncestor(u,h=>r.includes(h.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(n.shape).onClick||u.id===s||r.includes(u.id)||d||r.length>1&&(i!=null&&i.containsPoint(o))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=u;return}this.didSelectOnEnter=!0,a&&!l?(this.editor.cancelDoubleClick(),r.includes(u.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...r,u.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([u.id]))}onPointerUp(n){var u;const r=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),s=this.editor.getZoomLevel(),{inputs:{currentPagePoint:o}}=this.editor,a=n.shiftKey||n.accelKey,l=this.editor.getShapeAtPoint(o,{margin:this.editor.options.hitTestMargin/s,hitInside:!0,renderingOnly:!0})??this.hitShape,c=l?this.editor.getOutermostSelectableShape(l):this.hitShapeForPointerUp;if(c){const d=this.editor.getShapeUtil(c);if(d.onClick){const h=(u=d.onClick)==null?void 0:u.call(d,c);if(h){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([h]),this.parent.transition("idle",n);return}}if(c.id===i){r.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",n);return}}if(!this.didSelectOnEnter){const d=this.editor.getOutermostSelectableShape(l,h=>!r.includes(h.id));if(r.includes(d.id))if(a)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(c);else if(r.includes(c.id)){if(r.length===1){const h=this.editor.getShapeUtil(c).getGeometry(c),f=xSe(h),y=f.length===1?f[0]:void 0;if(y){const b=this.editor.getPointInShapeSpace(c,o);if(y.bounds.containsPoint(b,0)&&y.hitTestPoint(b)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(c.id);const v=this.editor.getShapeUtil(c);this.editor.getIsReadonly()&&!v.canEditInReadonly(c)||(this.editor.setEditingShape(c.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick?this.editor.emit("select-all-text",{shapeId:c.id}):this.editor.emit("place-caret",{shapeId:c.id,point:n.point}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(c.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(c);else if(a){const h=this.editor.getShapeAncestors(d);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(f=>!h.find(y=>y.id===f)),d.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([d.id])}this.parent.transition("idle",n)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(n){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",n):this.startTranslating(n))}onLongPress(n){this.startTranslating(n)}startTranslating(n){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",n))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}N(PSe,"id","pointing_shape");class _Se extends Qe{constructor(){super(...arguments);N(this,"info",{});N(this,"markId","");N(this,"didHoldCommand",!1);N(this,"creationCursorOffset",{x:0,y:0});N(this,"snapshot",{})}onEnter(n){const{isCreating:r=!1,creatingMarkId:i,creationCursorOffset:s={x:0,y:0}}=n;this.info=n,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.creationCursorOffset=s;try{this.snapshot=this._createSnapshot()}catch(o){console.error(o),this.cancel();return}if(this.markId="",r)if(i)this.markId=i;else{const o=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);o&&(this.markId=o)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");r&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:n}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(n)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){const{shapeSnapshots:n}=this.snapshot;n.forEach(({shape:r})=>{var s;const i=this.editor.getShape(r.id);if(i){const o=this.editor.getShapeUtil(r);(s=o.onResizeCancel)==null||s.call(o,r,i)}}),this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var n,r;if(yn(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(n=this.info).onCreate)==null||r.call(n,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:n}=this.snapshot,r=[];n.forEach(({shape:i})=>{var a;const s=this.editor.getShapeUtil(i),o=(a=s.onResizeStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:n}=this.snapshot,r=[];n.forEach(({shape:i})=>{var l;const s=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),a=(l=o.onResizeEnd)==null?void 0:l.call(o,i,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:n,shiftKey:r}=this.editor.inputs,{frames:i,shapeSnapshots:s,selectionBounds:o,cursorHandleOffset:a,selectedShapeIds:l,selectionRotation:c,canShapesDeform:u}=this.snapshot;let d=r||!u;if(s.size===1){const D=[...s.values()][0];this.editor.isShapeOfType(D.shape,"text")&&(d=!(this.info.handle==="left"||this.info.handle==="right"))}const h=ni(this.editor.inputs),f=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),y=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!h){const{gridSize:D}=this.editor.getDocumentSettings();f.snapToGrid(D)}const b=this.info.handle,v=fne(b,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!h:h)&&c%Zn===0){const{nudge:D}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:M.Sub(f,y),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:fne(b,c),isAspectRatioLocked:d,isResizingFromCenter:n});f.add(D)}const C=M.RotWith(n?o.center:o.getHandlePoint(v),o.point,c),E=M.Sub(f,C).rot(-c),I=M.Sub(y,C).rot(-c),P=M.DivV(E,I);Number.isFinite(P.x)||(P.x=1),Number.isFinite(P.y)||(P.y=1);const _=b==="top"||b==="bottom",A=b==="left"||b==="right";d?A?P.y=Math.abs(P.x):_?P.x=Math.abs(P.y):Math.abs(P.x)>Math.abs(P.y)?P.y=Math.abs(P.x)*(P.y<0?-1:1):P.x=Math.abs(P.y)*(P.x<0?-1:1):(_&&(P.x=1),A&&(P.y=1)),this.info.isCreating||this.updateCursor({dragHandle:b,isFlippedX:P.x<0,isFlippedY:P.y<0,rotation:c});for(const D of s.keys()){const L=s.get(D);this.editor.resizeShape(D,P,{initialShape:L.shape,initialBounds:L.bounds,initialPageTransform:L.pageTransform,dragHandle:b,mode:l.length===1&&D===l[0]?"resize_bounds":"scale_shape",scaleOrigin:C,isAspectRatioLocked:d,scaleAxisRotation:c,skipStartAndEndCallbacks:!0})}if(h){this.didHoldCommand=!0;for(const{id:D,children:L}of i){if(!L.length)continue;const z=s.get(D).shape,$=this.editor.getShape(D);if(!(z&&$))continue;const H=$.x-z.x,R=$.y-z.y,j=new M(H,R).rot(-z.rotation);if(j.x!==0||j.y!==0)for(const B of L)this.editor.updateShape({id:B.id,type:B.type,x:B.x-j.x,y:B.y-j.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:D}of i)if(D.length)for(const L of D)this.editor.updateShape({id:L.id,type:L.type,x:L.x,y:L.y})}}updateCursor({dragHandle:n,isFlippedX:r,isFlippedY:i,rotation:s}){const o={...this.editor.getInstanceState().cursor};switch(n){case"top_left":case"bottom_right":{o.type="nwse-resize",r!==i&&(o.type="nesw-resize");break}case"top_right":case"bottom_left":{o.type="nesw-resize",r!==i&&(o.type="nwse-resize");break}}o.rotation=s,this.editor.setCursor(o)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const{editor:n}=this,r=n.getSelectedShapeIds(),i=n.getSelectionRotation(),{inputs:{originPagePoint:s}}=n,o=n.getSelectionRotatedPageBounds();if(!o)throw Error("Resizing but nothing is selected");const a=M.RotWith(o.getHandlePoint(this.info.handle),o.point,i),l=M.Sub(s,a),c=new Map,u=[],d=f=>{const y=n.getShape(f);if(!y)return!1;const b=n.getShapeUtil(y);if(b.canResize(y)){const v=n.getShapePageTransform(y);c.set(y.id,{shape:y,bounds:n.getShapeGeometry(y).bounds,pageTransform:v,pageRotation:xe.Decompose(v).rotation,isAspectRatioLocked:b.isAspectRatioLocked(y)})}if(n.isShapeOfType(y,"frame")&&u.push({id:y.id,children:bt(n.getSortedChildIdsForParent(y).map(v=>n.getShape(v)))}),!b.canResizeChildren(y))return!1};r.forEach(f=>{d(f)!==!1&&n.visitDescendants(f,d)});const h=![...c.values()].some(f=>!Nhe(f.pageRotation,i)||f.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:o,cursorHandleOffset:l,selectionRotation:i,selectedShapeIds:r,canShapesDeform:h,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:u}}}N(_Se,"id","resizing");const LL=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function fne(t,e){e=e%Pn;const n=Math.round(e/(un/4)),r=LL.indexOf(t);return LL[(r+n)%LL.length]}const pne=Math.PI/180;class kSe extends Qe{constructor(){super(...arguments);N(this,"snapshot",{});N(this,"info",{});N(this,"markId","")}onEnter(n){this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const r=jfe({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r;const i=this._getRotationFromPointerPosition({snapToNearestDegree:!1});GE({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:nv[this.info.handle],rotation:i+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});GE({editor:this.editor,delta:n,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:nv[this.info.handle],rotation:n+this.snapshot.initialShapesRotation})}cancel(){const{shapeSnapshots:n}=this.snapshot;n.forEach(({shape:r})=>{var s;const i=this.editor.getShape(r.id);if(i){const o=this.editor.getShapeUtil(r);(s=o.onRotateCancel)==null||s.call(o,r,i)}}),this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){GE({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),yn(this.editor,this.snapshot.shapeSnapshots.map(n=>n.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:n}){const{inputs:{shiftKey:r,currentPagePoint:i}}=this.editor,{initialCursorAngle:s,initialShapesRotation:o,initialPageCenter:a}=this.snapshot,l=a.angle(i)-s;let c=o+l;if(r)c=GI(c,24);else if(n&&(c=Math.round(c/pne)*pne,this.editor.getInstanceState().isCoarsePointer)){const u=GI(c,4),d=WE(c,u);Math.abs(d)<qGe(5)&&(c=u)}return c-o}}N(kSe,"id","rotating");class ASe extends Qe{constructor(){super(...arguments);N(this,"hits",new Set);N(this,"size",0);N(this,"scribbleId","id");N(this,"initialSelectedShapeIds",new Set);N(this,"newlySelectedShapeIds",new Set)}onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const n=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=n.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,r)}updateScribbleSelection(n){const{editor:r}=this,i=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:s,originPagePoint:o,previousPagePoint:a,currentPagePoint:l}}=this.editor,{newlySelectedShapeIds:c,initialSelectedShapeIds:u}=this;n&&this.pushPointToScribble();const d=i;let h,f,y,b;const v=0;for(let E=0,I=d.length;E<I;E++){if(h=d[E],r.isShapeOfType(h,"group")||c.has(h.id)||r.isShapeOrAncestorLocked(h)||(f=r.getShapeGeometry(h),r.isShapeOfType(h,"frame")&&f.bounds.containsPoint(r.getPointInShapeSpace(h,o))))continue;const P=r.getShapePageTransform(h);if(!f||!P)continue;const _=P.clone().invert();y=_.applyToPoint(a),b=_.applyToPoint(l);const{bounds:A}=f;if(!(A.minX-v>Math.max(y.x,b.x)||A.minY-v>Math.max(y.y,b.y)||A.maxX+v<Math.min(y.x,b.x)||A.maxY+v<Math.min(y.y,b.y))&&f.hitTestLineSegment(y,b,v)){const D=this.editor.getOutermostSelectableShape(h),L=this.editor.getShapeMask(D.id);if(L&&ofe(a,l,L)!==null&&!po(l,L))continue;c.add(D.id)}}const x=r.getSelectedShapeIds(),C=new Set(s?[...c,...u]:[...c]);(x.length!==C.size||x.some(E=>!C.has(E)))&&this.editor.setSelectedShapes(Array.from(C))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}N(ASe,"id","scribble_brushing");var Qvt=Object.create,MSe=Object.defineProperty,e0t=Object.getOwnPropertyDescriptor,t0t=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),OSe=t=>{throw TypeError(t)},DSe=(t,e,n)=>e in t?MSe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,n0t=t=>[,,,Qvt(null)],RSe=["class","method","getter","setter","accessor","field","value","get","set"],NSe=t=>t!==void 0&&typeof t!="function"?OSe("Function expected"):t,r0t=(t,e,n,r,i)=>({kind:RSe[t],name:e,metadata:r,addInitializer:s=>n._?OSe("Already initialized"):i.push(NSe(s||null))}),i0t=(t,e)=>DSe(e,t0t("metadata"),t[3]),s0t=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},o0t=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=RSe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,e0t(i,n)),x=r.length-1;x>=0;x--)l=r0t(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,NSe(o)&&(v[y]=o);return v&&MSe(i,n,v),i},Gu=(t,e,n)=>DSe(t,typeof e!="symbol"?e+"":e,n),jSe,VA;const a0t=320,l0t=60;jSe=[Yo];class $9{constructor(e){this.editor=e,s0t(VA,5,this),Gu(this,"shapesToActuallyMove",[]),Gu(this,"draggedOverShapeIds",new Set),Gu(this,"initialGroupIds",new Map),Gu(this,"initialParentIds",new Map),Gu(this,"initialIndices",new Map),Gu(this,"initialDraggingOverShape"),Gu(this,"prevDraggingOverShape"),Gu(this,"prevPagePoint",new M),Gu(this,"intervalTimerId",-1),e.disposables.add(this.dispose)}startDraggingShapes(e,n,r){const{editor:i}=this;if(this.intervalTimerId!==-1)return;const s=new Set(e),o=new Set;for(const c of s){const u=i.getShapeParent(c);u&&i.isShapeOfType(u,"group")&&(o.has(u)||o.add(u))}for(const c of o){const u=bt(i.getSortedChildIdsForParent(c).map(d=>i.getShape(d)));s.add(c);for(const d of u)s.delete(d)}this.initialParentIds.clear();for(const c of s){const u=i.getShapeParent(c);u&&this.initialParentIds.set(c.id,u.id),this.initialIndices.set(c.id,c.index);const d=i.findShapeAncestor(c,h=>i.isShapeOfType(h,"group"));d&&this.initialGroupIds.set(c.id,d.id)}const a=i.getCurrentPageShapesSorted();this.shapesToActuallyMove=Array.from(s).filter(c=>!c.isLocked).sort((c,u)=>a.indexOf(c)-a.indexOf(u)),this.initialDraggingOverShape=i.getDraggingOverShape(n,this.shapesToActuallyMove),this.prevDraggingOverShape=this.initialDraggingOverShape,this.updateDraggingShapes(n,r);let l=0;this.intervalTimerId=this.editor.timers.setInterval(()=>{l++,!(l%3&&this.editor.inputs.pointerVelocity.len()>.5)&&this.updateDraggingShapes(i.inputs.currentPagePoint,r)},e.length>10?a0t:l0t)}dropShapes(e){var i,s;const{editor:n}=this;this.updateDraggingShapes(n.inputs.currentPagePoint);const r=n.getDraggingOverShape(n.inputs.currentPagePoint,e);if(r){const o=n.getShapeUtil(r);(s=o.onDropShapesOver)==null||s.call(o,r,e,{initialDraggingOverShapeId:((i=this.initialDraggingOverShape)==null?void 0:i.id)??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}this.dispose()}clear(){clearInterval(this.intervalTimerId),this.intervalTimerId=-1,this.initialParentIds.clear(),this.initialIndices.clear(),this.shapesToActuallyMove=[],this.initialDraggingOverShape=void 0,this.prevDraggingOverShape=void 0,this.editor.setHintingShapes([])}dispose(){this.clear()}updateDraggingShapes(e,n){const{editor:r}=this,i=bt(this.shapesToActuallyMove.map(a=>r.getShape(a)));if(!i.length)return;const s=r.getDraggingOverShape(e,this.shapesToActuallyMove),o=!this.prevPagePoint.equals(r.inputs.currentPagePoint);this.prevPagePoint.setTo(r.inputs.currentPagePoint),r.run(()=>{var a,l,c,u,d,h,f,y;if(((a=this.prevDraggingOverShape)==null?void 0:a.id)===(s==null?void 0:s.id)){if(o&&s&&io(s.id)&&!r.inputs.previousPagePoint.equals(r.inputs.currentPagePoint)){const b=r.getShapeUtil(s);(c=b.onDragShapesOver)==null||c.call(b,s,i,{initialDraggingOverShapeId:((l=this.initialDraggingOverShape)==null?void 0:l.id)??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}return}if(this.prevDraggingOverShape){const b=r.getShapeUtil(this.prevDraggingOverShape);(d=b.onDragShapesOut)==null||d.call(b,this.editor.getShape(this.prevDraggingOverShape),i,{nextDraggingOverShapeId:(s==null?void 0:s.id)??null,initialDraggingOverShapeId:((u=this.initialDraggingOverShape)==null?void 0:u.id)??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}if(s){const b=r.getShapeUtil(s);(y=b.onDragShapesIn)==null||y.call(b,s,i,{initialDraggingOverShapeId:((h=this.initialDraggingOverShape)==null?void 0:h.id)??null,prevDraggingOverShapeId:((f=this.prevDraggingOverShape)==null?void 0:f.id)??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),r.setHintingShapes([s.id])}else this.prevDraggingOverShape&&r.setHintingShapes([]);n==null||n()}),this.prevDraggingOverShape=s}}VA=n0t();o0t(VA,1,"dispose",jSe,$9);i0t(VA,$9);var c0t=Object.create,LSe=Object.defineProperty,u0t=Object.getOwnPropertyDescriptor,FSe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),$Se=t=>{throw TypeError(t)},BSe=(t,e,n)=>e in t?LSe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,d0t=t=>[,,,c0t((t==null?void 0:t[FSe("metadata")])??null)],zSe=["class","method","getter","setter","accessor","field","value","get","set"],USe=t=>t!==void 0&&typeof t!="function"?$Se("Function expected"):t,h0t=(t,e,n,r,i)=>({kind:zSe[t],name:e,metadata:r,addInitializer:s=>n._?$Se("Already initialized"):i.push(USe(s||null))}),f0t=(t,e)=>BSe(e,FSe("metadata"),t[3]),p0t=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},g0t=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=zSe[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,u0t(i,n)),x=r.length-1;x>=0;x--)l=h0t(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,USe(o)&&(v[y]=o);return v&&LSe(i,n,v),i},Ah=(t,e,n)=>BSe(t,typeof e!="symbol"?e+"":e,n),HSe,vB,WA;class KA extends(vB=Qe,HSe=[Yo],vB){constructor(){super(...arguments),p0t(WA,5,this),Ah(this,"info",{}),Ah(this,"selectionSnapshot",{}),Ah(this,"snapshot",{}),Ah(this,"markId",""),Ah(this,"isCloning",!1),Ah(this,"isCreating",!1),Ah(this,"dragAndDropManager",new $9(this.editor))}onCreate(e){}onEnter(e){var s;const{isCreating:n=!1,creatingMarkId:r,onCreate:i=()=>{}}=e;if(!((s=this.editor.getSelectedShapeIds())!=null&&s.length)){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=n,this.markId="",n)if(r)this.markId=r;else{const o=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);o&&(this.markId=o)}else this.markId=this.editor.markHistoryStoppingPoint("translating");this.onCreate=i,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=gne(this.editor),!(!this.isCreating&&this.editor.inputs.altKey&&(this.startCloning(),this.isCloning))&&(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes())}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){this.editor.inputs.altKey&&!this.isCloning&&(this.startCloning(),this.isCloning)||this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){if(this.isCreating)return;const e=Array.from(this.editor.getSelectedShapeIds());this.editor.canCreateShapes(e)&&(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=gne(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),yn(this.editor,this.snapshot.movingShapes.map(n=>n.id)),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(e=this.onCreate)==null||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){const{movingShapes:e}=this.snapshot;e.forEach(n=>{var i;const r=this.editor.getShape(n.id);if(r){const s=this.editor.getShapeUtil(n);(i=s.onTranslateCancel)==null||i.call(s,n,r)}}),this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,n=[];e.forEach(r=>{var o;const i=this.editor.getShapeUtil(r),s=(o=i.onTranslateStart)==null?void 0:o.call(i,r);s&&n.push(s)}),n.length>0&&this.editor.updateShapes(n),this.dragAndDropManager.startDraggingShapes(bt(this.snapshot.movingShapes.map(r=>this.editor.getShape(r.id))),this.editor.inputs.originPagePoint,this.updateParentTransforms),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const r=M.Average(e.map(s=>this.editor.getShapePageTransform(s.id).point())),i=M.Sub(r,this.selectionSnapshot.averagePagePoint);M.IsNaN(i)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(s=>s.id),offset:{x:i.x,y:i.y}}})}const n=[];e.forEach(r=>{var a;const i=this.editor.getShape(r.id),s=this.editor.getShapeUtil(r),o=(a=s.onTranslateEnd)==null?void 0:a.call(s,r,i);o&&n.push(o)}),n.length>0&&this.editor.updateShapes(n)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.startDraggingShapes(e.movingShapes,this.editor.inputs.originPagePoint,this.updateParentTransforms),m0t({editor:this.editor,snapshot:e});const{movingShapes:n}=e,r=[];n.forEach(i=>{var l;const s=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),a=(l=o.onTranslate)==null?void 0:l.call(o,i,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:n}}=this;n.forEach(r=>{const i=e.getShape(r.shape.id);if(!i)return null;const s=Vi(i.parentId)?null:xe.Inverse(e.getShapePageTransform(i.parentId));r.parentTransform=s})}}WA=d0t(vB);g0t(WA,1,"updateParentTransforms",HSe,KA);f0t(WA,KA);Ah(KA,"id","translating");function gne(t){var d;const e=[],n=[],r=t.getSelectedShapeIds(),i=bt(r.map(h=>{const f=t.getShape(h);if(!f)return null;e.push(f);const y=t.getShapePageTransform(h),b=y.point(),v=y.rotation();n.push(b);const x=fo.isId(f.parentId)?null:xe.Inverse(t.getShapePageTransform(f.parentId));return{shape:f,pagePoint:b,pageRotation:v,parentTransform:x}})),s=t.getOnlySelectedShape();let o=[];if(s)o=t.snaps.shapeBounds.getSnapPoints(s.id);else{const h=t.getSelectionPageBounds();h&&(o=h.cornersAndCenter.map((f,y)=>({id:"selection:"+y,x:f.x,y:f.y})))}let a,l;const{originPagePoint:c}=t.inputs,u=i.filter(h=>t.isShapeOfType(h.shape,"note")&&t.isPointInShape(h.shape,c));if(u.length!==0)if(u.length===1)l=u[0];else{const h=t.getCurrentPageShapesSorted();l=(d=u.map(f=>({snapshot:f,index:h.findIndex(y=>y.id===f.shape.id)})).sort((f,y)=>y.index-f.index)[0])==null?void 0:d.snapshot}return l&&(a=Bwe(t,l.pageRotation,l.shape.props.scale,l.shape.props.growY??0)),{averagePagePoint:M.Average(n),movingShapes:e,shapeSnapshots:i,initialPageBounds:t.getSelectionPageBounds(),initialSnapPoints:o,noteAdjacentPositions:a,noteSnapshot:l}}function m0t({editor:t,snapshot:e}){const{inputs:n}=t,{noteSnapshot:r,noteAdjacentPositions:i,initialPageBounds:s,initialSnapPoints:o,shapeSnapshots:a,averagePagePoint:l}=e,c=t.getInstanceState().isGridMode,u=t.getDocumentSettings().gridSize,d=M.Sub(n.currentPagePoint,n.originPagePoint),h=t.inputs.shiftKey?Math.abs(d.x)<Math.abs(d.y)?"x":"y":null;h==="x"?d.x=0:h==="y"&&(d.y=0),t.snaps.clearIndicators();const f=t.user.getIsSnapMode()?!n.ctrlKey:n.ctrlKey;let y=!1;if(f&&t.inputs.pointerVelocity.len()<.5){const{nudge:C}=t.snaps.shapeBounds.snapTranslateShapes({dragDelta:d,initialSelectionPageBounds:s,lockedAxis:h,initialSelectionSnapPoints:o});d.add(C)}else if(r&&i){const{scale:C}=r.shape.props,E=r.pagePoint.clone().add(d).add(HA.clone().mul(C).rot(r.pageRotation));let I=Fwe/t.getZoomLevel(),P=new M(0,0);for(const _ of i){const A=M.Sub(E,_),D=A.len();D<I&&(y=!0,I=D,P=A)}d.sub(P)}const b=M.Add(l,d),v=t.snaps.getIndicators();c&&!n.ctrlKey&&!y&&v.length===0&&b.snapToGrid(u);const x=M.Sub(b,l);t.updateShapes(bt(a.map(({shape:C,pagePoint:E,parentTransform:I})=>{const P=M.Add(E,x),_=I?xe.applyToPoint(I,P):P;return{id:C.id,type:C.type,x:_.x,y:_.y}})))}class wT extends Qe{constructor(){super(...arguments);N(this,"reactor")}static children(){return[yB,j9,Yvt,CSe,PSe,KA,pSe,ASe,F9,ISe,gSe,wSe,_Se,kSe,TSe,SSe,ESe,bSe]}cleanUpDuplicateProps(){const n=this.editor.getSelectedShapeIds(),r=this.editor.getInstanceState();if(!r.duplicateProps)return;const i=new Set(r.duplicateProps.shapeIds);n.length===i.size&&n.every(s=>i.has(s))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=Ma("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(n){console.error(n)}})}onExit(){var n;(n=this.reactor)==null||n.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}N(wT,"id","select"),N(wT,"initial","idle"),N(wT,"isLockable",!1);class VSe extends Qe{constructor(){super(...arguments);N(this,"info",{})}onEnter(n){this.info=n}onPointerDown(){this.parent.transition("pointing",this.info)}}N(VSe,"id","idle");class WSe extends Qe{constructor(){super(...arguments);N(this,"info",{})}onEnter(n){this.info=n}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:n}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(n,{animation:{duration:220}}):this.editor.zoomIn(n,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}N(WSe,"id","pointing");class KSe extends Qe{constructor(){super(...arguments);N(this,"info",{});N(this,"zoomBrush",new Ee)}onEnter(n){this.info=n,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:n,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(Ee.FromPoints([n,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:n}=this,r=8/this.editor.getZoomLevel();if(n.width<r&&n.height<r){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{animation:{duration:220}}):this.editor.zoomIn(i,{animation:{duration:220}})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(n,{targetZoom:i,animation:{duration:220}})}this.parent.transition("idle",this.info)}}N(KSe,"id","zoom_brushing");class ST extends Qe{constructor(){super(...arguments);N(this,"info",{})}static children(){return[VSe,KSe,WSe]}onEnter(n){this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(n){this.updateCursor(),n.code==="KeyZ"&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}N(ST,"id","zoom"),N(ST,"initial","idle"),N(ST,"isLockable",!1);const y0t=[vT,bT,xT,ST,wT];function v0t(){const t=re(),e=ie("follow",()=>t.getInstanceState().followingUserId,[t]);return e?g.jsx(b0t,{userId:e}):null}function b0t({userId:t}){const e=Kk(t);return e?g.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}let bB={fonts:{tldraw_mono:`${zr()}/fonts/IBMPlexMono-Medium.woff2`,tldraw_mono_italic:`${zr()}/fonts/IBMPlexMono-MediumItalic.woff2`,tldraw_mono_bold:`${zr()}/fonts/IBMPlexMono-Bold.woff2`,tldraw_mono_italic_bold:`${zr()}/fonts/IBMPlexMono-BoldItalic.woff2`,tldraw_serif:`${zr()}/fonts/IBMPlexSerif-Medium.woff2`,tldraw_serif_italic:`${zr()}/fonts/IBMPlexSerif-MediumItalic.woff2`,tldraw_serif_bold:`${zr()}/fonts/IBMPlexSerif-Bold.woff2`,tldraw_serif_italic_bold:`${zr()}/fonts/IBMPlexSerif-BoldItalic.woff2`,tldraw_sans:`${zr()}/fonts/IBMPlexSans-Medium.woff2`,tldraw_sans_italic:`${zr()}/fonts/IBMPlexSans-MediumItalic.woff2`,tldraw_sans_bold:`${zr()}/fonts/IBMPlexSans-Bold.woff2`,tldraw_sans_italic_bold:`${zr()}/fonts/IBMPlexSans-BoldItalic.woff2`,tldraw_draw:`${zr()}/fonts/Shantell_Sans-Informal_Regular.woff2`,tldraw_draw_italic:`${zr()}/fonts/Shantell_Sans-Informal_Regular_Italic.woff2`,tldraw_draw_bold:`${zr()}/fonts/Shantell_Sans-Informal_Bold.woff2`,tldraw_draw_italic_bold:`${zr()}/fonts/Shantell_Sans-Informal_Bold_Italic.woff2`}};function qSe(t){return S.useMemo(()=>t?{fonts:{...bB.fonts,...t==null?void 0:t.fonts}}:bB,[t])}const x0t=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","alt","arrow-arc","arrow-cycle","arrow-elbow","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bold","bookmark","bring-forward","bring-to-front","broken","bulletList","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","color","comment","corners","crop","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","download","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","heading","help-circle","highlight","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","italic","leading","link","list","lock","manual","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","strike","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","underline","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let fb={...bB,icons:Object.fromEntries(x0t.map(t=>[t,`${zr()}/icons/icon/0_merged.svg#${t}`])),translations:Object.fromEntries(lw.map(t=>[t.locale,`${zr()}/translations/${t.locale}.json`])),embedIcons:Object.fromEntries(i9.map(t=>[t.type,`${zr()}/embed-icons/${t.type}.png`]))};function GSe(t){return S.useMemo(()=>t?{fonts:Object.assign({...fb.fonts},{...t==null?void 0:t.fonts}),icons:Object.assign({...fb.icons},{...t==null?void 0:t.icons}),embedIcons:Object.assign({...fb.embedIcons},{...t==null?void 0:t.embedIcons}),translations:Object.assign({...fb.translations},{...t==null?void 0:t.translations})}:fb,[t])}function Sg({id:t,children:e,onOpenChange:n,open:r}){const[i,s]=Vd(t,n);return g.jsx(W6,{onOpenChange:s,open:r||i,children:g.jsx("div",{className:"tlui-popover",children:e})})}function Cg({children:t}){return g.jsx(K6,{asChild:!0,dir:"ltr",children:t})}function Eg({side:t,children:e,align:n="center",sideOffset:r=8,alignOffset:i=0,disableEscapeKeyDown:s=!1,autoFocusFirstButton:o=!0}){const a=Fr(),l=$e.useRef(null),c=$e.useCallback(()=>{var f;if(!o)return;const h=[...((f=l.current)==null?void 0:f.querySelectorAll("button:not([disabled])"))??[]].filter(y=>y.offsetWidth||y.offsetHeight)[0];h&&h.focus()},[o]);return g.jsx(q6,{container:a,children:g.jsx(G6,{className:"tlui-popover__content",side:t,sideOffset:r,align:n,alignOffset:i,dir:"ltr",ref:l,onOpenAutoFocus:c,onEscapeKeyDown:u=>s&&u.preventDefault(),children:e})})}function w0t(t){return t.getSelectedShapeIds().map(r=>t.getShape(r)).filter(r=>{if(!r)return!1;if(t.isShapeOfType(r,"arrow")){const i=wi(t,r);if(i.start||i.end)return!1}return!0})}const YSe=()=>{const t=re();return ie("threeStackableItems",()=>w0t(t).length>2,[t])},qd=()=>{const t=re();return ie("isInSelectState",()=>t.isIn("select"),[t])},XSe=()=>{const t=re();return ie("allow group",()=>{const e=t.getSelectedShapes();if(e.length<2)return!1;for(const n of e)if(t.isShapeOfType(n,"arrow")){const r=wi(t,n);if(r.start&&!e.some(i=>i.id===r.start.toId)||r.end&&!e.some(i=>i.id===r.end.toId))return!1}return!0},[t])},JSe=()=>{const t=re();return ie("allowUngroup",()=>t.getSelectedShapeIds().some(e=>{var n;return((n=t.getShape(e))==null?void 0:n.type)==="group"}),[t])},S0t=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function ZSe(t,e){const n=re();return ie("selectedShapes",()=>n.getSelectedShapes().length>=t,[n,t,e])}function Io(t,e){const n=re();return ie("selectedShapes",()=>{const r=n.getSelectedShapes().filter(i=>!n.isShapeOrAncestorLocked(i)).length;return t===void 0?r:r>=t},[n])}function C0t(){const t=re();return ie("showAutoSizeToggle",()=>{const e=t.getSelectedShapes();return e.length===1&&t.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[t])}function QSe(){const t=re();return ie("hasLinkShapeSelected",()=>{const e=t.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[t])}function E0t(){const t=re();return ie("onlyFlippableShape",()=>{const e=t.getOnlySelectedShape();return e&&(t.isShapeOfType(e,"group")||t.isShapeOfType(e,"image")||t.isShapeOfType(e,"arrow")||t.isShapeOfType(e,"line")||t.isShapeOfType(e,"draw"))},[t])}function e1e(){const t=re();return ie("useCanRedo",()=>t.getCanRedo(),[t])}function t1e(){const t=re();return ie("useCanUndo",()=>t.getCanUndo(),[t])}function T0t(){return g.jsxs(g.Fragment,{children:[g.jsx(I0t,{}),g.jsx(P0t,{}),g.jsx(_0t,{}),g.jsx(k0t,{}),g.jsx(A0t,{}),g.jsx(D0t,{}),g.jsx(R0t,{}),g.jsx(N0t,{})]})}function I0t(){const t=Io(2),e=qd(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(ye,{actionId:"align-left",disabled:!n}),g.jsx(ye,{actionId:"align-center-horizontal",disabled:!n}),g.jsx(ye,{actionId:"align-right",disabled:!n}),g.jsx(ye,{actionId:"stretch-horizontal",disabled:!n}),g.jsx(ye,{actionId:"align-top",disabled:!n}),g.jsx(ye,{actionId:"align-center-vertical",disabled:!n}),g.jsx(ye,{actionId:"align-bottom",disabled:!n}),g.jsx(ye,{actionId:"stretch-vertical",disabled:!n})]})}function P0t(){const t=Io(3),e=qd(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(ye,{actionId:"distribute-horizontal",disabled:!n}),g.jsx(ye,{actionId:"distribute-vertical",disabled:!n})]})}function _0t(){const t=YSe(),e=qd(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(ye,{actionId:"stack-horizontal",disabled:!n}),g.jsx(ye,{actionId:"stack-vertical",disabled:!n})]})}function k0t(){const t=Io(1),e=qd(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(ye,{actionId:"send-to-back",disabled:!n}),g.jsx(ye,{actionId:"send-backward",disabled:!n}),g.jsx(ye,{actionId:"bring-forward",disabled:!n}),g.jsx(ye,{actionId:"bring-to-front",disabled:!n})]})}function A0t(){return Ys()<wr.TABLET_SM?g.jsx(M0t,{}):g.jsx(O0t,{})}function M0t(){const t=re(),e=ie("zoom is 1",()=>t.getZoomLevel()===1,[t]);return g.jsx(ye,{actionId:"zoom-to-100",disabled:e})}function O0t(){const t=Io(1),e=qd(),n=t&&e;return g.jsx(ye,{actionId:"rotate-ccw",disabled:!n})}function D0t(){const t=Io(1),e=qd(),n=t&&e;return g.jsx(ye,{actionId:"rotate-cw",disabled:!n})}function R0t(){const t=QSe(),e=qd(),n=t&&e;return g.jsx(ye,{actionId:"edit-link",disabled:!n})}function N0t(){const t=XSe(),e=JSe();return t?g.jsx(mne,{}):e?g.jsx(j0t,{}):g.jsx(mne,{})}function mne(){const t=Io(2),e=qd(),n=t&&e;return g.jsx(ye,{actionId:"group",disabled:!n})}function j0t(){return g.jsx(ye,{actionId:"ungroup"})}const L0t=S.memo(function({children:e}){const n=et(),r=Ys(),i=Ka(),s=S.useRef(null);Hd(s);const o=re(),a=ie("should display quick actions when in readonly",()=>o.isInAny("hand","zoom"),[o]),l=e??g.jsx(T0t,{});if(!(i&&!a))return g.jsxs(Sg,{id:"actions-menu",children:[g.jsx(Cg,{children:g.jsx(Ei,{type:"icon","data-testid":"actions-menu.button",title:n("actions-menu.title"),children:g.jsx(vt,{icon:"dots-vertical",small:!0})})}),g.jsx(Eg,{side:r>=wr.TABLET?"bottom":"top",sideOffset:6,children:g.jsx(Or,{ref:s,label:n("actions-menu.title"),className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:g.jsx(So,{type:"icons",sourceId:"actions-menu",children:l})})})]})});function n1e(){return C0t()?g.jsx(ye,{actionId:"toggle-auto-size"}):null}function r1e(){return QSe()?g.jsx(ye,{actionId:"edit-link"}):null}function F0t(){return Io(1)?g.jsx(ye,{actionId:"duplicate"}):null}function i1e(){const t=re();return ie("should display flatten option",()=>{if(t.getSelectedShapeIds().length===0)return!1;const r=t.getOnlySelectedShape();return!(r&&t.isShapeOfType(r,"image"))},[t])?g.jsx(ye,{actionId:"flatten-to-image"}):null}function $0t(){const t=re();return ie("should display download original option",()=>{const n=t.getSelectedShapes();return n.length===0?!1:n.some(r=>lwe(r,t))},[t])?g.jsx(ye,{actionId:"download-original"}):null}function s1e(){return XSe()?g.jsx(ye,{actionId:"group"}):null}function o1e(){return JSe()?g.jsx(ye,{actionId:"ungroup"}):null}function a1e(){const t=re();return ie("allow unframe",()=>{const n=t.getSelectedShapes();return n.length===0?!1:n.every(r=>t.isShapeOfType(r,"frame"))},[t])?g.jsx(ye,{actionId:"remove-frame"}):null}function l1e(){const t=re();return ie("allow fit frame to content",()=>{const n=t.getOnlySelectedShape();return n?t.isShapeOfType(n,"frame")&&t.getSortedChildIdsForParent(n).length>0:!1},[t])?g.jsx(ye,{actionId:"fit-frame-to-content"}):null}function c1e(){const t=re();return ie("selected shapes",()=>t.getSelectedShapes().length>0,[t])?g.jsx(ye,{actionId:"toggle-lock"}):null}function B9(){const t=re(),e=ie("isTransparentBg",()=>!t.getInstanceState().exportBackground,[t]);return g.jsx(Fl,{actionId:"toggle-transparent",checked:e,toggle:!0})}function B0t(){const t=re(),e=ie("any shapes",()=>t.getCurrentPageShapeIds().size>0,[t]);return g.jsx(ye,{actionId:"unlock-all",disabled:!e})}function u1e(){const t=re(),e=ie("zoomed to 100",()=>t.getZoomLevel()===1,[t]);return g.jsx(ye,{actionId:"zoom-to-100",noClose:!0,disabled:e})}function d1e(){const t=re(),e=ie("has shapes",()=>t.getCurrentPageShapeIds().size>0,[t]);return g.jsx(ye,{actionId:"zoom-to-fit",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function h1e(){const t=re(),e=ie("has shapes",()=>t.getSelectedShapeIds().length>0,[t]);return g.jsx(ye,{actionId:"zoom-to-selection",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function f1e(){return g.jsxs(Nt,{id:"clipboard",children:[g.jsx(U0t,{}),g.jsx(H0t,{}),g.jsx(V0t,{}),g.jsx(F0t,{}),g.jsx(W0t,{})]})}function z0t(){var n;const t=re(),e=ie("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return g.jsxs(ta,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[g.jsxs(Nt,{id:"copy-as-group",children:[g.jsx(ye,{actionId:"copy-as-svg"}),!!((n=window.navigator.clipboard)!=null&&n.write)&&g.jsx(ye,{actionId:"copy-as-png"})]}),g.jsx(Nt,{id:"copy-as-bg",children:g.jsx(B9,{})})]})}function U0t(){const t=Io(1);return g.jsx(ye,{actionId:"cut",disabled:!t})}function H0t(){const t=ZSe(1);return g.jsx(ye,{actionId:"copy",disabled:!t})}function V0t(){const t=S0t;return g.jsx(ye,{actionId:"paste",disabled:!t})}function p1e(){const t=re();return ie("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t])?g.jsxs(Nt,{id:"conversions",children:[g.jsx(z0t,{}),g.jsxs(ta,{id:"export-as",label:"context-menu.export-as",size:"small",children:[g.jsxs(Nt,{id:"export-as-group",children:[g.jsx(ye,{actionId:"export-as-svg"}),g.jsx(ye,{actionId:"export-as-png"})]}),g.jsx(Nt,{id:"export-as-bg",children:g.jsx(B9,{})})]}),g.jsx($0t,{})]}):null}function g1e(){const t=re(),e=ie("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return g.jsx(ye,{actionId:"select-all",disabled:!e})}function W0t(){const t=Io(1);return g.jsx(ye,{actionId:"delete",disabled:!t})}function K0t(){const t=Ka();return!ZSe(1)||t?null:g.jsxs(ta,{id:"edit",label:"context-menu.edit",size:"small",children:[g.jsx(s1e,{}),g.jsx(o1e,{}),g.jsx(i1e,{}),g.jsx(r1e,{}),g.jsx(l1e,{}),g.jsx(a1e,{}),g.jsx(y1e,{}),g.jsx(m1e,{}),g.jsx(n1e,{}),g.jsx(c1e,{})]})}function q0t(){const t=Io(2),e=E0t();return Ka()||!(t||e)?null:g.jsxs(ta,{id:"arrange",label:"context-menu.arrange",size:"small",children:[t&&g.jsxs(Nt,{id:"align",children:[g.jsx(ye,{actionId:"align-left"}),g.jsx(ye,{actionId:"align-center-horizontal"}),g.jsx(ye,{actionId:"align-right"}),g.jsx(ye,{actionId:"align-top"}),g.jsx(ye,{actionId:"align-center-vertical"}),g.jsx(ye,{actionId:"align-bottom"})]}),g.jsx(G0t,{}),t&&g.jsxs(Nt,{id:"stretch",children:[g.jsx(ye,{actionId:"stretch-horizontal"}),g.jsx(ye,{actionId:"stretch-vertical"})]}),(t||e)&&g.jsxs(Nt,{id:"flip",children:[g.jsx(ye,{actionId:"flip-horizontal"}),g.jsx(ye,{actionId:"flip-vertical"})]}),g.jsx(Y0t,{})]})}function G0t(){return Io(3)?g.jsxs(Nt,{id:"distribute",children:[g.jsx(ye,{actionId:"distribute-horizontal"}),g.jsx(ye,{actionId:"distribute-vertical"})]}):null}function Y0t(){const t=Io(2),e=YSe();return t?g.jsxs(Nt,{id:"order",children:[g.jsx(ye,{actionId:"pack"}),e&&g.jsx(ye,{actionId:"stack-horizontal"}),e&&g.jsx(ye,{actionId:"stack-vertical"})]}):null}function X0t(){const t=Ka(),e=Io(1);return t||!e?null:g.jsx(ta,{id:"reorder",label:"context-menu.reorder",size:"small",children:g.jsxs(Nt,{id:"reorder",children:[g.jsx(ye,{actionId:"bring-to-front"}),g.jsx(ye,{actionId:"bring-forward"}),g.jsx(ye,{actionId:"send-backward"}),g.jsx(ye,{actionId:"send-to-back"})]})})}function J0t(){const t=re(),e=ie("pages",()=>t.getPages(),[t]),n=ie("current page id",()=>t.getCurrentPageId(),[t]),{addToast:r}=Wd(),i=hr(),s=Ka();return!Io(1)||s?null:g.jsxs(ta,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[g.jsx(Nt,{id:"pages",children:e.map(a=>g.jsx(Jt,{id:a.id,disabled:n===a.id,label:a.name.length>30?`${a.name.slice(0,30)}…`:a.name,onSelect:()=>{t.markHistoryStoppingPoint("move_shapes_to_page"),t.moveShapesToPage(t.getSelectedShapeIds(),a.id);const l=t.getPage(a.id);l&&r({title:"Changed Page",description:`Moved to ${l.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{t.markHistoryStoppingPoint("change-page"),t.setCurrentPage(n)}}]}),i("move-to-page",{source:"context-menu"})}},a.id))}),g.jsx(Nt,{id:"new-page",children:g.jsx(ye,{actionId:"move-to-new-page"})})]})}function m1e(){const t=re();return ie("oneEmbedSelected",()=>{const n=t.getOnlySelectedShape();return n?!!(t.isShapeOfType(n,"embed")&&n.props.url&&!t.isShapeOrAncestorLocked(n)):!1},[t])?g.jsx(ye,{actionId:"convert-to-bookmark"}):null}function y1e(){const t=re(),e=s9();return ie("oneEmbeddableBookmarkSelected",()=>{const r=t.getOnlySelectedShape();return r?!!(t.isShapeOfType(r,"bookmark")&&r.props.url&&e(r.props.url)&&!t.isShapeOrAncestorLocked(r)):!1},[t])?g.jsx(ye,{actionId:"convert-to-embed"}):null}function Z0t(){const t=re(),e=ie("isSnapMode",()=>t.user.getIsSnapMode(),[t]);return g.jsx(Fl,{actionId:"toggle-snap-mode",checked:e})}function Q0t(){const t=re(),e=ie("isToolLock",()=>t.getInstanceState().isToolLocked,[t]);return g.jsx(Fl,{actionId:"toggle-tool-lock",checked:e})}function ebt(){const t=re(),e=ie("isGridMode",()=>t.getInstanceState().isGridMode,[t]);return g.jsx(Fl,{actionId:"toggle-grid",checked:e})}function tbt(){const t=re(),e=ie("isWrapMode",()=>t.user.getIsWrapMode(),[t]);return g.jsx(Fl,{actionId:"toggle-wrap-mode",checked:e})}function nbt(){const t=re(),e=ie("isFocusMode",()=>t.getInstanceState().isFocusMode,[t]);return g.jsx(Fl,{actionId:"toggle-focus-mode",checked:e})}function rbt(){const t=re(),e=ie("edgeScrollSpeed",()=>t.user.getEdgeScrollSpeed(),[t]);return g.jsx(Fl,{actionId:"toggle-edge-scrolling",checked:e===1})}function ibt(){const t=re(),e=ie("animationSpeed",()=>t.user.getAnimationSpeed(),[t]);return g.jsx(Fl,{actionId:"toggle-reduce-motion",checked:e===0})}function sbt(){const t=re(),e=ie("keyboardShortcuts",()=>t.user.getAreKeyboardShortcutsEnabled(),[t]);return g.jsx(Fl,{actionId:"toggle-keyboard-shortcuts",checked:e})}function obt(){const t=re(),e=ie("isDebugMode",()=>t.getInstanceState().isDebugMode,[t]);return g.jsx(Fl,{actionId:"toggle-debug-mode",checked:e})}function abt(){const t=re(),e=ie("dynamic resize",()=>t.user.getIsDynamicResizeMode(),[t]);return g.jsx(Fl,{actionId:"toggle-dynamic-size-mode",checked:e})}function lbt(){const t=re(),e=ie("paste at cursor",()=>t.user.getIsPasteAtCursorMode(),[t]);return g.jsx(Fl,{actionId:"toggle-paste-at-cursor",checked:e})}function cbt(){const t=re();return ie("show cursor chat",()=>t.getCurrentToolId()==="select"&&!t.getInstanceState().isCoarsePointer,[t])?g.jsx(ye,{actionId:"open-cursor-chat"}):null}function ubt(){const t=re(),e=NA(),n=ie("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t]),r=ie("isSinglePageMode",()=>t.options.maxPages<=1,[t]);return n?g.jsxs(g.Fragment,{children:[e&&g.jsx(cbt,{}),g.jsxs(Nt,{id:"modify",children:[g.jsx(K0t,{}),g.jsx(q0t,{}),g.jsx(X0t,{}),!r&&g.jsx(J0t,{})]}),g.jsx(f1e,{}),g.jsx(p1e,{}),g.jsx(Nt,{id:"select-all",children:g.jsx(g1e,{})})]}):null}const dbt=S.memo(function({children:e,disabled:n=!1}){const r=re(),i=et(),{Canvas:s}=Cn(),o=S.useCallback(h=>{h.key==="Escape"&&(h.stopPropagation(),r.getContainer().focus())},[r]);S.useEffect(()=>()=>{document.body.removeEventListener("keydown",o,{capture:!0})},[o]);const a=S.useCallback(h=>{if(h){if(document.body.addEventListener("keydown",o,{capture:!0}),r.getInstanceState().isCoarsePointer){const f=r.getSelectedShapes(),{inputs:{currentPagePoint:y}}=r,b=r.getShapesAtPoint(y);if(!r.getSelectedShapes().length||!b.some(v=>f.includes(v))){const v=b.filter(x=>r.isShapeOrAncestorLocked(x));v.length&&r.select(...v.map(x=>x.id))}}}else{const f=r.getOnlySelectedShape();f&&r.isShapeOrAncestorLocked(f)&&r.setSelectedShapes([]),r.timers.requestAnimationFrame(()=>{document.body.removeEventListener("keydown",o,{capture:!0})})}},[r,o]),l=Fr(),[c,u]=Vd("context menu",a),d=e??g.jsx(ubt,{});return g.jsxs(_ut,{dir:"ltr",onOpenChange:u,modal:!1,children:[g.jsx(kut,{onContextMenu:void 0,dir:"ltr",disabled:n,children:s?g.jsx(s,{}):null}),c&&g.jsx(Aut,{container:l,children:g.jsx(Mut,{className:"tlui-menu tlui-scrollable","data-testid":"context-menu","aria-label":i("context-menu.title"),alignOffset:-4,collisionPadding:4,onContextMenu:St,children:g.jsx(So,{type:"context-menu",sourceId:"context-menu",children:d})})})]})}),hbt=2e3,fbt=5e3,pbt=Lr(function(){const e=re(),{isChatting:n,chatMessage:r}=e.getInstanceState(),i=S.useRef(-1),[s,o]=S.useState("");return S.useEffect(()=>{if(!n&&r||n){const l=n?fbt:hbt;i.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},l)}return()=>{clearTimeout(i.current)}},[e,r,n]),n?g.jsx(mbt,{value:s,setValue:o,chatMessage:r}):r.trim()?g.jsx(gbt,{chatMessage:r}):null});function v1e(t){const e=re();S.useLayoutEffect(()=>{var o;if(!t.current)return;const{x:r,y:i}=e.inputs.currentScreenPoint;(o=t.current)==null||o.style.setProperty("transform",`translate(${r}px, ${i}px)`);function s(a){var u;const{minX:l,minY:c}=e.getViewportScreenBounds();(u=t.current)==null||u.style.setProperty("transform",`translate(${a.clientX-l}px, ${a.clientY-c}px)`)}return window.addEventListener("pointermove",s),()=>{window.removeEventListener("pointermove",s)}},[t,e])}const gbt=({chatMessage:t})=>{const e=re(),n=S.useRef(null);return v1e(n),g.jsx("div",{ref:n,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:t})},mbt=Lr(function({chatMessage:e,value:n,setValue:r}){const i=re(),s=et(),o=S.useRef(null),a=e||s("cursor-chat.type-to-chat");v1e(o),S.useLayoutEffect(()=>{const h=o.current;if(!h)return;const f=i.textMeasure.measureText(n||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});h.style.setProperty("width",f.w+"px")},[i,n,a]),S.useLayoutEffect(()=>{const h=i.timers.requestAnimationFrame(()=>{var f;(f=o.current)==null||f.focus()});return()=>{cancelAnimationFrame(h)}},[i]);const l=S.useCallback(()=>{i.updateInstanceState({isChatting:!1}),i.focus()},[i]),c=S.useCallback(h=>{const{value:f}=h.target;r(f.slice(0,64)),i.updateInstanceState({chatMessage:f})},[i,r]),u=S.useCallback(h=>{const f=o.current;if(!f)return;const{value:y}=f;switch(h.key){case"Enter":{if(St(h),h.stopPropagation(),!y){l();return}r("");break}case"Escape":{St(h),h.stopPropagation(),l();break}}},[l,r]),d=S.useCallback(h=>{h.stopPropagation()},[]);return g.jsx("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:i.user.getColor()},onBlur:l,onChange:c,onKeyDown:u,onPaste:d,value:n,placeholder:a,spellCheck:!1})});function xB({checked:t}){const e=et();return g.jsx(Eu,{"data-checked":!!t,label:e(t?"ui.checked":"ui.unchecked"),icon:t?"check":"none",className:"tlui-button__icon",small:!0})}function ybt(){const t=re(),{addToast:e}=Wd(),{addDialog:n}=ZS(),[r,i]=$e.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(Nt,{id:"items",children:[g.jsx(Jt,{id:"hard-reset",onSelect:Uhe,label:"Hard reset"}),g.jsx(Jt,{id:"add-toast",onSelect:()=>{e({id:fn(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:fn(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:fn(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:fn(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),g.jsx(Jt,{id:"show-dialog",label:"Show dialog",onSelect:()=>{n({component:({onClose:s})=>g.jsx(xbt,{displayDontShowAgain:!0,onCancel:()=>s(),onContinue:()=>s()}),onClose:()=>{}})}}),g.jsx(Jt,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>wbt(t,100)}),g.jsx(Jt,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var a;const s=t.getSelectedShapes(),o=s.length===0?t.getRenderingShapes():s;window.alert(`Shapes ${o.length}, DOM nodes:${(a=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:a.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),g.jsx(Jt,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"})]}),g.jsxs(Nt,{id:"flags",children:[g.jsx(vbt,{}),g.jsx(bbt,{})]})]})}function vbt(){const t=Object.values(Jn);return t.length?g.jsx(ta,{id:"debug flags",label:"Debug Flags",children:g.jsx(Nt,{id:"debug flags",children:t.map(e=>g.jsx(b1e,{flag:e},e.name))})}):null}function bbt(){const t=Object.values(eYe);return t.length?g.jsx(ta,{id:"feature flags",label:"Feature Flags",children:g.jsx(Nt,{id:"feature flags",children:t.map(e=>g.jsx(b1e,{flag:e},e.name))})}):null}function xbt({title:t="title",body:e="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,maxWidth:s="350",onCancel:o,onContinue:a}){const[l,c]=$e.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(MA,{children:[g.jsx(OA,{children:t}),g.jsx(DA,{})]}),g.jsx(Ew,{style:{maxWidth:s},children:e}),g.jsxs(r9,{className:"tlui-dialog__footer__actions",children:[i&&g.jsxs(xt,{type:"normal",onClick:()=>c(!l),style:{marginRight:"auto"},children:[g.jsx(xB,{checked:l}),g.jsx(xr,{children:"Don’t show again"})]}),g.jsx(xt,{type:"normal",onClick:o,children:g.jsx(xr,{children:n})}),g.jsx(xt,{type:"primary",onClick:async()=>a(),children:g.jsx(xr,{children:r})})]})]})}const b1e=Lr(function({flag:e,onChange:n}){const r=e.get();return g.jsx($A,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,i=>`${i[0]} ${i[1].toLowerCase()}`).replace(/^[a-z]/,i=>i.toUpperCase()),checked:r,onSelect:()=>{e.set(!r),n==null||n(!r)}})});let yne=0;function wbt(t,e){const n=t.options.adjacentShapeMargin,r=Array(e),i=Math.floor(Math.sqrt(e));for(let s=0;s<e;s++)yne++,r[s]={id:Sn("box"+yne),type:"geo",x:s%i*(100+n),y:Math.floor(s/i)*(100+n)};t.run(()=>{t.createShapes(r).setSelectedShapes(r.map(s=>s.id))})}function Sbt({children:t}){const e=t??g.jsx(ybt,{});return g.jsxs(jA,{id:"debug",children:[g.jsx(LA,{children:g.jsx(xt,{type:"icon",title:"Debug menu",children:g.jsx(vt,{icon:"dots-horizontal"})})}),g.jsx(FA,{side:"top",align:"end",alignOffset:0,children:g.jsx(So,{type:"menu",sourceId:"debug-panel",children:e})})]})}const Cbt=S.memo(function(){const{DebugMenu:e}=Hf(),n=S.useRef(null);return Hd(n),g.jsxs("footer",{ref:n,className:"tlui-debug-panel",children:[g.jsx(Tbt,{}),g.jsx(Ibt,{}),e&&g.jsx(e,{})]})});function Ebt(t=!0){const[e,n]=S.useState(0),r=re();S.useEffect(()=>{if(!t)return;const i=()=>n(s=>s+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,t])}const Tbt=Lr(function(){Ebt();const e=re(),n=e.getPath(),r=e.getHoveredShape(),i=e.getOnlySelectedShape(),s=n==="select.idle"||!n.includes("select.")?r:i,o=s&&n.includes("select.")?` / ${s.type||""}${"geo"in s.props?" / "+s.props.geo:""} / [${M.ToInt(e.getPointInShapeSpace(s,e.inputs.currentPagePoint))}]`:"",a=n.startsWith("select.")&&!n.includes(".idle")?` / [${M.ToInt(e.inputs.originPagePoint)}] → [${M.ToInt(e.inputs.currentPagePoint)}] = ${M.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return g.jsx("div",{className:"tlui-debug-panel__current-state",children:`${n}${o}${a}`})});function Ibt(){const t=re(),e=ie("show_fps",()=>Jn.showFps.get(),[Jn]),n=S.useRef(null);return S.useEffect(()=>{if(!e)return;const r=250;let i=0,s=-1,o=performance.now(),a=0,l=0,c=!1;function u(){if(l++,a=performance.now()-o,a>r){const d=Math.round(l*(r/a)*(1e3/r));d>i&&(i=d);const h=i*.75;(d<h&&!c||d>=h&&c)&&(c=!c),n.current.innerHTML=`FPS ${d.toString()}`,n.current.className="tlui-debug-panel__fps"+(c?" tlui-debug-panel__fps__slow":""),a-=r,l=0,o=performance.now()}s=t.timers.requestAnimationFrame(u)}return u(),()=>{cancelAnimationFrame(s)}},[e,t]),e?g.jsx("div",{ref:n}):null}const Pbt=S.memo(function(){const e=Ys(),n=et(),r=S.useRef(null);Hd(r);const{MainMenu:i,QuickActions:s,ActionsMenu:o,PageMenu:a}=Hf(),l=re(),c=ie("isSinglePageMode",()=>l.options.maxPages<=1,[l]),u=l.options.actionShortcutsLocation==="menu"?!0:l.options.actionShortcutsLocation==="toolbar"?!1:e>=wr.TABLET;return!i&&!a&&!u?null:g.jsx("nav",{ref:r,className:"tlui-menu-zone",children:g.jsxs("div",{className:"tlui-buttons__horizontal",children:[i&&g.jsx(i,{}),a&&!c&&g.jsx(a,{}),u?g.jsxs(Or,{className:"tlui-buttons__horizontal",label:n("actions-menu.title"),children:[s&&g.jsx(s,{}),o&&g.jsx(o,{})]}):null]})})});function _bt(){const t=re(),e=Kd(),[n,r]=S.useState(!1),i=S.useRef(!1);return lg("toggle showback to content",()=>{const s=i.current,o=t.getCurrentPageShapeIds();let a=!1;o.size&&(a=o.size===t.getCulledShapes().size),s!==a&&(r(a),i.current=a)},[t]),n?g.jsx(ye,{actionId:"back-to-content",onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function kbt(){const t=re();return ie("is pen mode",()=>t.getInstanceState().isPenMode,[t])?g.jsx(ye,{actionId:"exit-pen-mode"}):null}function Abt(){const t=re(),e=Kd();return ie("is following user",()=>!!t.getInstanceState().followingUserId,[t])?g.jsx(Jt,{...e["stop-following"]}):null}function Mbt(){return g.jsxs(g.Fragment,{children:[g.jsx(kbt,{}),g.jsx(_bt,{}),g.jsx(Abt,{})]})}function Obt({children:t}){const e=t??g.jsx(Mbt,{});return g.jsx("div",{className:"tlui-helper-buttons",children:g.jsx(So,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function x1e(){const t=as(),e=hr(),n=ie("locale",()=>t==null?void 0:t.user.getLocale(),[t]);return t?g.jsx(ta,{id:"help menu language",label:"menu.language",children:g.jsx(Nt,{id:"languages",className:"tlui-language-menu",children:lw.map(({locale:r,label:i})=>g.jsx($A,{id:`language-${r}`,title:r,label:i,checked:r===n,readonlyOk:!0,onSelect:()=>{t.user.updateUserPreferences({locale:r}),e("change-language",{source:"menu",locale:r})}},r))})}):null}function Dbt(){return g.jsxs(g.Fragment,{children:[g.jsx(x1e,{}),g.jsx(w1e,{})]})}function w1e(){const{KeyboardShortcutsDialog:t}=Hf(),{addDialog:e}=ZS(),n=S.useCallback(()=>{t&&e({component:t})},[e,t]);return t?g.jsx(Jt,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:n}):null}function Rbt(){return g.jsxs(g.Fragment,{children:[g.jsxs(Nt,{id:"basic",children:[g.jsx(jbt,{}),g.jsx(Bbt,{}),g.jsx(Nbt,{}),g.jsx(zbt,{})]}),g.jsx(Ubt,{})]})}function Nbt(){return g.jsxs(ta,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[g.jsxs(Nt,{id:"export-all-as-group",children:[g.jsx(ye,{actionId:"export-all-as-svg"}),g.jsx(ye,{actionId:"export-all-as-png"})]}),g.jsx(Nt,{id:"export-all-as-bg",children:g.jsx(B9,{})})]})}function jbt(){return g.jsxs(ta,{id:"edit",label:"menu.edit",children:[g.jsx($bt,{}),g.jsx(f1e,{}),g.jsx(p1e,{}),g.jsx(Lbt,{}),g.jsx(Fbt,{}),g.jsx(Nt,{id:"select-all",children:g.jsx(g1e,{})})]})}function Lbt(){return g.jsxs(Nt,{id:"misc",children:[g.jsx(s1e,{}),g.jsx(o1e,{}),g.jsx(r1e,{}),g.jsx(n1e,{}),g.jsx(a1e,{}),g.jsx(l1e,{}),g.jsx(y1e,{}),g.jsx(m1e,{}),g.jsx(i1e,{})]})}function Fbt(){return g.jsxs(Nt,{id:"lock",children:[g.jsx(c1e,{}),g.jsx(B0t,{})]})}function $bt(){const t=t1e(),e=e1e();return g.jsxs(Nt,{id:"undo-redo",children:[g.jsx(ye,{actionId:"undo",disabled:!t}),g.jsx(ye,{actionId:"redo",disabled:!e})]})}function Bbt(){return g.jsx(ta,{id:"view",label:"menu.view",children:g.jsxs(Nt,{id:"view-actions",children:[g.jsx(ye,{actionId:"zoom-in"}),g.jsx(ye,{actionId:"zoom-out"}),g.jsx(u1e,{}),g.jsx(d1e,{}),g.jsx(h1e,{})]})})}function zbt(){return g.jsxs(g.Fragment,{children:[g.jsx(ye,{actionId:"insert-embed"}),g.jsx(ye,{actionId:"insert-media"})]})}function Ubt(){return g.jsxs(Nt,{id:"preferences",children:[g.jsxs(ta,{id:"preferences",label:"menu.preferences",children:[g.jsxs(Nt,{id:"preferences-actions",children:[g.jsx(Z0t,{}),g.jsx(Q0t,{}),g.jsx(ebt,{}),g.jsx(tbt,{}),g.jsx(nbt,{}),g.jsx(rbt,{}),g.jsx(ibt,{}),g.jsx(sbt,{}),g.jsx(abt,{}),g.jsx(lbt,{}),g.jsx(obt,{})]}),g.jsx(Nt,{id:"color-scheme",children:g.jsx(Ift,{})})]}),g.jsx(x1e,{}),g.jsx(w1e,{})]})}const Hbt=S.memo(function({children:e}){const n=Fr(),[r,i]=Vd("main menu"),s=et(),o=e??g.jsx(Rbt,{});return g.jsxs(z6,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[g.jsx(U6,{asChild:!0,dir:"ltr",children:g.jsx(xt,{type:"icon","data-testid":"main-menu.button",title:s("menu.title"),children:g.jsx(vt,{icon:"menu",small:!0})})}),g.jsx(PA,{container:n,children:g.jsx(H6,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:g.jsx(So,{type:"menu",sourceId:"main-menu",children:o})})})]})}),FL={};function pb(t){if(FL[t])return FL[t];const n=document.createElement("canvas").getContext("2d");n.fillStyle=t,n.fillRect(0,0,1,1);const[r,i,s,o]=n.getImageData(0,0,1,1).data,a=new Float32Array([r/255,i/255,s/255,o/255]);return FL[t]=a,a}const CT=10,S1e=24*CT+12+48;function Km(t,{center:e,radius:n,numArcSegments:r=20,startAngle:i=0,endAngle:s=Pn,offset:o=0}){const a=(s-i)/r;let l=o;for(let c=i;c<s;c+=a)t[l++]=e.x,t[l++]=e.y,t[l++]=e.x+Math.cos(c)*n,t[l++]=e.y+Math.sin(c)*n,t[l++]=e.x+Math.cos(c+a)*n,t[l++]=e.y+Math.sin(c+a)*n;return t}function qm(t,e,n,r,i,s){t[e++]=n,t[e++]=r,t[e++]=n,t[e++]=r+s,t[e++]=n+i,t[e++]=r,t[e++]=n+i,t[e++]=r,t[e++]=n,t[e++]=r+s,t[e++]=n+i,t[e++]=r+s}function Vbt(t,e,n){const r=CT;n=Math.min(n,Math.min(e.w,e.h)/2);const i=Ee.ExpandBy(e,-n);if(i.w<=0||i.h<=0)return Km(t,{center:e.center,radius:n,numArcSegments:CT*4}),CT*4*6;let s=0;return qm(t,s,i.minX,i.minY,i.w,i.h),s+=12,qm(t,s,i.minX,e.minY,i.w,n),s+=12,qm(t,s,i.maxX,i.minY,n,i.h),s+=12,qm(t,s,i.minX,i.maxY,i.w,n),s+=12,qm(t,s,e.minX,i.minY,n,i.h),s+=12,Km(t,{numArcSegments:r,offset:s,center:i.point,radius:n,startAngle:un,endAngle:un*1.5}),s+=r*6,Km(t,{numArcSegments:r,offset:s,center:M.Add(i.point,new M(i.w,0)),radius:n,startAngle:un*1.5,endAngle:Pn}),s+=r*6,Km(t,{numArcSegments:r,offset:s,center:M.Add(i.point,i.size),radius:n,startAngle:0,endAngle:Zn}),s+=r*6,Km(t,{numArcSegments:r,offset:s,center:M.Add(i.point,new M(0,i.h)),radius:n,startAngle:Zn,endAngle:un}),S1e}function Wbt(t){if(!t)throw new Error("Canvas element not found");const e=t.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const n=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=e.createShader(e.VERTEX_SHADER);if(!r)throw new Error("Failed to create vertex shader");if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,s=e.createShader(e.FRAGMENT_SHADER);if(!s)throw new Error("Failed to create fragment shader");if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const o=e.createProgram();if(!o)throw new Error("Failed to create program");if(e.attachShader(o,r),e.attachShader(o,s),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(o);const a=e.getAttribLocation(o,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const l=e.getUniformLocation(o,"canvasPageBounds"),c=e.getUniformLocation(o,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:EE(e,1024),unselectedShapes:EE(e,4096),viewport:EE(e,S1e),collaborators:EE(e,1024),prepareTriangles(h,f){e.bindBuffer(e.ARRAY_BUFFER,h.buffer),e.bufferData(e.ARRAY_BUFFER,h.vertices,e.STATIC_DRAW,0,f),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(h){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,h/2),e.disable(e.BLEND)},drawTriangles(h){e.drawArrays(e.TRIANGLES,0,h/2)},setFillColor(h){e.uniform4fv(c,h)},setCanvasPageBounds(h){e.uniform4fv(l,h)}}}function EE(t,e){const n=t.createBuffer();if(!n)throw new Error("Failed to create buffer");return{buffer:n,vertices:new Float32Array(e)}}function vne(t,e,n){let r=t.vertices.length;for(;r<e+n.length;)r*=2;if(r!=t.vertices.length){const i=new Float32Array(r);i.set(t.vertices),t.vertices=i}t.vertices.set(n,e)}var Kbt=Object.create,C1e=Object.defineProperty,qbt=Object.getOwnPropertyDescriptor,Gbt=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),E1e=t=>{throw TypeError(t)},T1e=(t,e,n)=>e in t?C1e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ybt=t=>[,,,Kbt(null)],I1e=["class","method","getter","setter","accessor","field","value","get","set"],P1e=t=>t!==void 0&&typeof t!="function"?E1e("Function expected"):t,Xbt=(t,e,n,r,i)=>({kind:I1e[t],name:e,metadata:r,addInitializer:s=>n._?E1e("Already initialized"):i.push(P1e(s||null))}),Jbt=(t,e)=>T1e(e,Gbt("metadata"),t[3]),Zbt=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)s[i].call(n);return r},ku=(t,e,n,r,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,y=I1e[u+5],b=t[f]||(t[f]=[]),v=(i=i.prototype,qbt(i,n)),x=r.length-1;x>=0;x--)l=Xbt(u,n,a={},t[3],b),l.static=d,l.private=h,c=l.access={has:C=>n in C},c.get=C=>C[n],o=(0,r[x])(v[y],l),a._=1,P1e(o)&&(v[y]=o);return v&&C1e(i,n,v),i},Yu=(t,e,n)=>T1e(t,typeof e!="symbol"?e+"":e,n),_1e,k1e,A1e,M1e,O1e,D1e,R1e,N1e,j1e,L1e,qa;L1e=[Yo],j1e=[me],N1e=[me],R1e=[me],D1e=[me],O1e=[me],M1e=[me],A1e=[me],k1e=[me],_1e=[Yo];class Bl{constructor(e,n,r){this.editor=e,this.elem=n,this.container=r,Zbt(qa,5,this),Yu(this,"disposables",[]),Yu(this,"gl"),Yu(this,"shapeGeometryCache"),Yu(this,"colors"),Yu(this,"id",fn()),Yu(this,"canvasBoundingClientRect",lr("canvasBoundingClientRect",new Ee)),Yu(this,"originPagePoint",new M),Yu(this,"originPageCenter",new M),Yu(this,"isInViewport",!1),this.gl=Wbt(n),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",i=>{const s=e.getShapeMaskedPageBounds(i.id);if(!s)return null;const o=new Float32Array(12);return qm(o,0,s.x,s.y,s.w,s.h),o}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),Ma("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:pb(e.getPropertyValue("--color-text-3").trim()),selectFill:pb(e.getPropertyValue("--color-selected").trim()),viewportFill:pb(e.getPropertyValue("--color-muted-1").trim()),background:pb(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),n=this.editor.getCurrentPageBounds();return n?Ee.Expand(n,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),n=this.editor.pageToScreen(e.point),r=this.editor.pageToScreen(new M(e.maxX,e.maxY));return new Ee(n.x,n.y,r.x-n.x,r.y-n.y)}_getCanvasBoundingRect(){const{x:e,y:n,width:r,height:i}=this.elem.getBoundingClientRect();return new Ee(e,n,r,i)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const n=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(n)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),n=this.getDpr();return new M(e.width*n,e.height*n)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),n=this.getContentPageBounds(),r=e.width/e.height;let i=n.width,s=i/r;s<n.height&&(s=n.height,i=s*r);const o=new Ee(0,0,i,s);return o.center=n.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:n,w:r,h:i}=this.getCanvasPageBounds();return new Float32Array([e,n,r,i])}getMinimapPagePoint(e,n){const r=this.getCanvasPageBounds(),i=this.getCanvasScreenBounds();let s=e-i.x,o=n-i.y;return s*=r.width/i.width,o*=r.height/i.height,s+=r.minX,o+=r.minY,new M(s,o,1)}minimapScreenPointToPagePoint(e,n,r=!1,i=!1){const{editor:s}=this,o=s.getViewportPageBounds();let{x:a,y:l}=this.getMinimapPagePoint(e,n);if(i){const c=this.editor.getCurrentPageBounds()??new Ee,u=c.minX-o.width/2,d=c.maxX+o.width/2,h=c.minY-o.height/2,f=c.maxY+o.height/2,y=Math.max(0,u+o.width-a),b=Math.max(0,-(d-o.width-a)),v=Math.max(0,h+o.height-l),x=Math.max(0,-(f-o.height-l));a+=(y-b)/2,l+=(v-x)/2,a=Ct(a,u,d),l=Ct(l,h,f)}if(r){const{originPagePoint:c}=this,u=Math.abs(a-c.x),d=Math.abs(l-c.y);u>d?l=c.y:a=c.x}return new M(a,l)}render(){const e=this.gl.context,n=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=n.x,this.elem.height=n.y,e.viewport(0,0,n.x,n.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const r=new Set(this.editor.getSelectedShapeIds()),i=this.colors;let s=0,o=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let l=0,c=a.length;l<c;l++){const u=a[l],d=this.shapeGeometryCache.get(u);if(!d)continue;const h=d.length;r.has(u)?(vne(this.gl.selectedShapes,s,d),s+=h):(vne(this.gl.unselectedShapes,o,d),o+=h)}this.drawShapes(this.gl.unselectedShapes,o,i.shapeFill),this.drawShapes(this.gl.selectedShapes,s,i.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,n,r){this.gl.prepareTriangles(e,n),this.gl.setFillColor(r),this.gl.drawTriangles(n)}drawViewport(){const e=this.editor.getViewportPageBounds(),n=Vbt(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,n),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(n),sn.isSafari&&(this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const n=20,r=n*6,i=r*e.length;this.gl.collaborators.vertices.length<i&&(this.gl.collaborators.vertices=new Float32Array(i));const s=this.gl.collaborators.vertices;let o=0;const a=this.getZoom();for(const{cursor:l}of e)l&&(Km(s,{center:M.From(l),radius:3*a,offset:o,numArcSegments:n}),o+=r);this.gl.prepareTriangles(this.gl.collaborators,i),o=0;for(const{color:l}of e)this.gl.setFillColor(pb(l)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,o/2,r/2),o+=r}}qa=Ybt();ku(qa,1,"close",L1e,Bl);ku(qa,1,"getDpr",j1e,Bl);ku(qa,1,"getContentPageBounds",N1e,Bl);ku(qa,1,"getContentScreenBounds",R1e,Bl);ku(qa,1,"getCanvasSize",D1e,Bl);ku(qa,1,"getCanvasClientPosition",O1e,Bl);ku(qa,1,"getCanvasPageBounds",M1e,Bl);ku(qa,1,"getZoom",A1e,Bl);ku(qa,1,"getCanvasPageBoundsArray",k1e,Bl);ku(qa,1,"render",_1e,Bl);Jbt(qa,Bl);function Qbt(){const t=re(),e=Fr(),n=et(),r=S.useRef(null),i=S.useRef(!1),s=S.useRef();S.useEffect(()=>{try{const d=new Bl(t,r.current,e);return s.current=d,s.current.close}catch(d){t.annotateError(d,{origin:"minimap",willCrashApp:!1}),t.timers.setTimeout(()=>{throw d})}},[t,e]);const o=S.useCallback(d=>{if(!t.getCurrentPageShapeIds().size||!s.current)return;const h=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),f=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);s.current.originPagePoint.setTo(f),s.current.originPageCenter.setTo(t.getViewportPageBounds().center),t.centerOnPoint(h,{animation:{duration:t.options.animationMediumMs}})},[t]),a=S.useCallback(d=>{if(!s.current)return;const h=d.currentTarget;if(PS(h,d),!t.getCurrentPageShapeIds().size)return;i.current=!0,s.current.isInViewport=!1;const f=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),y=t.getViewportPageBounds(),b=s.current.getContentPageBounds();if(new Ee(b.x-y.width/2,b.y-y.height/2,b.width+y.width,b.height+y.height).containsPoint(f)&&!y.containsPoint(f)){s.current.isInViewport=y.containsPoint(f);const C=M.Sub(y.center,y.point),E=M.Add(f,C);s.current.originPagePoint.setTo(E),s.current.originPageCenter.setTo(f),t.centerOnPoint(f,{animation:{duration:t.options.animationMediumMs}})}else{const C=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);s.current.isInViewport=y.containsPoint(C),s.current.originPagePoint.setTo(C),s.current.originPageCenter.setTo(y.center)}function x(C){h&&_S(h,C),i.current=!1,document.body.removeEventListener("pointerup",x)}document.body.addEventListener("pointerup",x)},[t]),l=S.useCallback(d=>{if(!s.current)return;const h=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,d.shiftKey,!0);if(i.current){if(s.current.isInViewport){const v=s.current.originPagePoint.clone().sub(s.current.originPageCenter);t.centerOnPoint(M.Sub(h,v));return}t.centerOnPoint(h)}const f=s.current.getMinimapPagePoint(d.clientX,d.clientY),y=t.pageToScreen(f),b={type:"pointer",target:"canvas",name:"pointer_move",...wa(d),point:y,isPen:t.getInstanceState().isPenMode};t.dispatch(b)},[t]),c=S.useCallback(d=>{const h=Ome(d);t.dispatch({type:"wheel",name:"wheel",delta:h,point:new M(d.clientX,d.clientY),shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,metaKey:d.metaKey,accelKey:ni(d)})},[t]),u=NS();return S.useEffect(()=>{t.timers.setTimeout(()=>{var d,h;(d=s.current)==null||d.updateColors(),(h=s.current)==null||h.render()})},[u,t]),g.jsx("div",{className:"tlui-minimap",children:g.jsx("canvas",{role:"img","aria-label":n("navigation-zone.minimap"),ref:r,className:"tlui-minimap__canvas",onDoubleClick:o,onPointerMove:l,onPointerDown:a,onWheelCapture:c})})}function ext(t,e){const[n,r]=$e.useState(e);$e.useLayoutEffect(()=>{const s=Oz(t);if(s)try{r(JSON.parse(s))}catch{console.error(`Could not restore value ${t} from local storage.`)}},[t]);const i=$e.useCallback(s=>{r(o=>{const a=typeof s=="function"?s(o):s;return Dz(t,JSON.stringify(a)),a})},[t]);return[n,i]}const txt=S.memo(function(){const e=Kd(),n=et(),r=Ys(),i=S.useRef(null);Hd(i);const[s,o]=ext("minimap",!0),a=S.useCallback(()=>{o(u=>!u)},[o]),{ZoomMenu:l,Minimap:c}=Hf();return r<wr.MOBILE?null:g.jsxs("div",{ref:i,className:"tlui-navigation-panel",children:[g.jsx(Or,{className:"tlui-buttons__horizontal",label:n("navigation-zone.title"),children:l&&r<wr.TABLET?g.jsx(l,{}):g.jsxs(g.Fragment,{children:[!s&&g.jsx(Ei,{type:"icon","data-testid":"minimap.zoom-out",title:`${n(Tw(e["zoom-out"].label))} ${H$(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:g.jsx(vt,{small:!0,icon:"minus"})}),l&&g.jsx(l,{},"zoom-menu"),!s&&g.jsx(Ei,{type:"icon","data-testid":"minimap.zoom-in",title:`${n(Tw(e["zoom-in"].label))} ${H$(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:g.jsx(vt,{small:!0,icon:"plus"})}),c&&g.jsx(Ei,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),onClick:a,children:g.jsx(vt,{small:!0,icon:s?"chevron-right":"chevron-left"})})]})}),c&&r>=wr.TABLET&&!s&&g.jsx(c,{})]})}),nxt=function({name:e,id:n,isCurrentPage:r,onCancel:i,onComplete:s}){const o=re(),a=hr(),l=S.useRef(null),c=S.useRef(null),u=S.useCallback(()=>{c.current=o.markHistoryStoppingPoint("rename page")},[o]),d=S.useCallback(f=>{o.renamePage(n,f||"New Page"),a("rename-page",{source:"page-menu"})},[o,n,a]),h=S.useCallback(()=>{c.current&&o.bailToMark(c.current),i()},[o,i]);return g.jsx(qv,{className:"tlui-page-menu__item__input",ref:f=>l.current=f,defaultValue:e,onValueChange:d,onComplete:s,onCancel:h,onFocus:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},wB=(t,e,n,r,i)=>{let s;const o=t.getPages(),a=n>r?o[r-1]:o[r],l=n>r?o[r]:o[r+1];a&&!l?s=ac(a.index):!a&&l?s=bWe(o[0].index):s=By(a.index,l.index),s!==o[n].index&&(t.markHistoryStoppingPoint("moving page"),t.updatePage({id:e,index:s}),i("move-page",{source:"page-menu"}))},bne=Lr(function({index:e,listSize:n,item:r,onRename:i}){const s=re(),o=et(),a=s.getPages(),l=hr(),c=S.useCallback(()=>{s.markHistoryStoppingPoint("creating page");const f=fo.createId();s.duplicatePage(r.id,f),l("duplicate-page",{source:"page-menu"})},[s,r,l]),u=S.useCallback(()=>{wB(s,r.id,e,e-1,l)},[s,r,e,l]),d=S.useCallback(()=>{wB(s,r.id,e,e+1,l)},[s,r,e,l]),h=S.useCallback(()=>{s.markHistoryStoppingPoint("deleting page"),s.deletePage(r.id),l("delete-page",{source:"page-menu"})},[s,r,l]);return g.jsxs(jA,{id:`page item submenu ${e}`,children:[g.jsx(LA,{children:g.jsx(xt,{type:"icon",title:o("page-menu.submenu.title"),children:g.jsx(vt,{icon:"dots-vertical",small:!0})})}),g.jsx(FA,{alignOffset:0,side:"right",sideOffset:-4,children:g.jsxs(So,{type:"menu",sourceId:"page-menu",children:[g.jsxs(Nt,{id:"modify",children:[i&&g.jsx(Jt,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),g.jsx(Jt,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:c,disabled:a.length>=s.options.maxPages}),e>0&&g.jsx(Jt,{id:"move-up",onSelect:u,label:"page-menu.submenu.move-up"}),e<n-1&&g.jsx(Jt,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:d})]}),n>1&&g.jsx(Nt,{id:"delete",children:g.jsx(Jt,{id:"delete",onSelect:h,label:"page-menu.submenu.delete"})})]})})]})}),rxt=S.memo(function(){const e=re(),n=hr(),r=et(),i=Ys(),s=S.useCallback(()=>x(!1),[]),[o,a]=Vd("page-menu",s),l=36,c=S.useRef(null),u=ie("pages",()=>e.getPages(),[e]),d=ie("currentPage",()=>e.getCurrentPage(),[e]),h=ie("currentPageId",()=>e.getCurrentPageId(),[e]),f=Ka(),y=ie("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),b=ie("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[v,x]=S.useState(!1);S.useEffect(function(){function j(){v||document.activeElement===document.body&&e.menus.clearOpenMenus()}return document.addEventListener("keydown",j,{passive:!0}),()=>{document.removeEventListener("keydown",j)}},[e,v]);const C=S.useCallback(()=>{f||x(R=>!R)},[f]),E=S.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[I,P]=S.useState(Object.fromEntries(u.map((R,j)=>[R.id,{y:j*l,offsetY:0,isSelected:!1}])));S.useLayoutEffect(()=>{P(Object.fromEntries(u.map((R,j)=>[R.id,{y:j*l,offsetY:0,isSelected:!1}])))},[l,u]),S.useEffect(()=>{o&&e.timers.requestAnimationFrame(()=>{var j;const R=document.querySelector(`[data-pageid="${h}"]`);if(R){(j=R.querySelector("button"))==null||j.focus();const B=c.current;if(!B)return;const K=R.offsetTop,G=B.scrollTop;K<G&&B.scrollTo({top:K});const V=K+l,W=B.scrollTop+B.offsetHeight;V>W&&B.scrollTo({top:V-B.offsetHeight})}})},[l,h,o,e]);const _=S.useCallback(R=>{const{clientY:j,currentTarget:B}=R,{dataset:{id:K,index:G}}=B;if(!K||!G)return;const V=E.current;PS(R.currentTarget,R),V.status="pointing",V.pointing={id:K,index:+G};const Z=I[K].y;V.startY=j,V.startIndex=Math.max(0,Math.min(Math.round(Z/l),u.length-1))},[l,u.length,I]),A=S.useCallback(R=>{const j=E.current;if(j.status==="pointing"){const{clientY:B}=R,K=B-j.startY;Math.abs(K)>5&&(j.status="dragging")}if(j.status==="dragging"){const{clientY:B}=R,K=B-j.startY,G=I[j.pointing.id],{startIndex:V,pointing:W}=j,Z=G.y+K,U=Math.max(0,Math.min(Math.round(Z/l),u.length-1)),J={...I};if(J[W.id]={y:G.y,offsetY:K,isSelected:!0},U!==j.dragIndex){j.dragIndex=U;for(let ge=0;ge<u.length;ge++){const _e=u[ge];if(_e.id===j.pointing.id)continue;let{y:fe}=J[_e.id];U===V?fe=ge*l:U<V?U<=ge&&ge<V?fe=(ge+1)*l:fe=ge*l:U>V&&(U>=ge&&ge>V?fe=(ge-1)*l:fe=ge*l),fe!==J[_e.id].y&&(J[_e.id]={y:fe,offsetY:0,isSelected:!0})}}P(J)}},[l,u,I]),D=S.useCallback(R=>{const j=E.current;if(j.status==="dragging"){const{id:B,index:K}=j.pointing;wB(e,B,K,j.dragIndex,n)}_S(R.currentTarget,R),j.status="idle"},[e,n]),L=S.useCallback(R=>{const j=E.current;R.key==="Escape"&&(j.status==="dragging"&&P(Object.fromEntries(u.map((B,K)=>[B.id,{y:K*l,offsetY:0,isSelected:!1}]))),j.status="idle")},[l,u]),z=S.useCallback(()=>{f||(e.run(()=>{e.markHistoryStoppingPoint("creating page");const R=fo.createId();e.createPage({name:r("page-menu.new-page-initial-name"),id:R}),e.setCurrentPage(R),x(!0),e.timers.requestAnimationFrame(()=>{var B;const j=document.querySelector(`[data-pageid="${R}"]`);j&&((B=j.querySelector("button"))==null||B.focus())})}),n("new-page",{source:"page-menu"}))},[e,r,f,n]),$=S.useCallback(R=>{e.setCurrentPage(R),n("change-page",{source:"page-menu"})},[e,n]),H=S.useCallback((R,j)=>{e.renamePage(R,j),n("rename-page",{source:"page-menu"})},[e,n]);return g.jsxs(Sg,{id:"pages",onOpenChange:a,open:o,children:[g.jsx(Cg,{"data-testid":"main.page-menu",children:g.jsxs(xt,{type:"menu",title:d.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[g.jsx("div",{className:"tlui-page-menu__name",children:d.name}),g.jsx(vt,{icon:"chevron-down",small:!0})]})}),g.jsx(Eg,{side:"bottom",align:"start",sideOffset:0,disableEscapeKeyDown:v,children:g.jsxs("div",{className:"tlui-page-menu__wrapper",children:[g.jsxs("div",{className:"tlui-page-menu__header",children:[g.jsx("div",{className:"tlui-page-menu__header__title",children:r("page-menu.title")}),!f&&g.jsxs("div",{className:"tlui-buttons__horizontal",children:[g.jsx(xt,{type:"icon","data-testid":"page-menu.edit",title:r(v?"page-menu.edit-done":"page-menu.edit-start"),onClick:C,children:g.jsx(vt,{icon:v?"check":"edit"})}),g.jsx(xt,{type:"icon","data-testid":"page-menu.create",title:r(y?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:y,onClick:z,children:g.jsx(vt,{icon:"plus"})})]})]}),g.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:l*u.length+4},ref:c,children:u.map((R,j)=>{const B=I[R.id]??{offsetY:0};return v?g.jsxs("div",{"data-testid":"page-menu.item","data-pageid":R.id,className:"tlui-page_menu__item__sortable",style:{zIndex:R.id===d.id?888:j,transform:`translate(0px, ${B.y+B.offsetY}px)`},children:[g.jsx(xt,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:_,onPointerUp:D,onPointerMove:A,onKeyDown:L,"data-id":R.id,"data-index":j,children:g.jsx(vt,{icon:"drag-handle-dots"})}),i<wr.TABLET_SM&&b?g.jsxs(xt,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const K=window.prompt("Rename page",R.name);K&&K!==R.name&&H(R.id,K)},onDoubleClick:C,children:[g.jsx(xB,{checked:R.id===d.id}),g.jsx(xr,{children:R.name})]}):g.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:l},children:g.jsx(nxt,{id:R.id,name:R.name,isCurrentPage:R.id===d.id,onComplete:()=>{x(!1)},onCancel:()=>{x(!1)}})}),!f&&g.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":v,children:g.jsx(bne,{index:j,item:R,listSize:u.length})})]},R.id+"_editing"):g.jsxs("div",{"data-pageid":R.id,"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[g.jsxs(xt,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>$(R.id),onDoubleClick:C,title:r("page-menu.go-to-page"),onKeyDown:K=>{K.key==="Enter"&&R.id===d.id&&(C(),tr(K))},children:[g.jsx(xB,{checked:R.id===d.id}),g.jsx(xr,{children:R.name})]}),!f&&g.jsx("div",{className:"tlui-page_menu__item__submenu",children:g.jsx(bne,{index:j,item:R,listSize:u.length,onRename:()=>{if(sn.isIos){const K=window.prompt("Rename page",R.name);K&&K!==R.name&&H(R.id,K)}else x(!0),h!==R.id&&$(R.id)}})})]},R.id)})})]})})]})});function ixt(){const t=re(),e=Ka(),n=ie("should display quick actions",()=>t.isInAny("select","hand","zoom"),[t]);if(!(e&&!n))return g.jsxs(g.Fragment,{children:[g.jsx(oxt,{}),g.jsx(sxt,{})]})}function sxt(){const t=Io(1),e=qd(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(ye,{actionId:"delete",disabled:!n}),g.jsx(ye,{actionId:"duplicate",disabled:!n})]})}function oxt(){const t=t1e(),e=e1e();return g.jsxs(g.Fragment,{children:[g.jsx(ye,{actionId:"undo",disabled:!t}),g.jsx(ye,{actionId:"redo",disabled:!e})]})}const axt=S.memo(function({children:e}){const n=e??g.jsx(ixt,{});return g.jsx(So,{type:"small-icons",sourceId:"quick-actions",children:n})});function lxt({userId:t}){var n;const e=Kk(t);return e?g.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:((n=e.userName)==null?void 0:n[0])??""},t):null}const cxt=Lr(function({userId:e}){var c;const n=re(),r=et(),i=hr(),s=Kk(e),o=S.useCallback(()=>{n.getInstanceState().followingUserId===e?(n.stopFollowingUser(),i("stop-following",{source:"people-menu"})):(n.startFollowingUser(e),i("start-following",{source:"people-menu"}))},[n,e,i]),a=(s==null?void 0:s.followingUserId)===n.user.getId(),l=n.getInstanceState().followingUserId===e;return s?g.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal","data-follow":l||a,children:[g.jsxs(xt,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>n.zoomToUser(e),onDoubleClick:o,children:[g.jsx(Eu,{label:r("people-menu.avatar-color"),icon:"color",color:s.color}),g.jsx("div",{className:"tlui-people-menu__name",children:((c=s.userName)==null?void 0:c.trim())||r("people-menu.anonymous-user")})]}),g.jsx(xt,{type:"icon",className:"tlui-people-menu__item__follow",title:r(a?"people-menu.leading":l?"people-menu.following":"people-menu.follow"),onClick:o,disabled:a,children:g.jsx(vt,{icon:a?"leading":l?"following":"follow"})})]}):null});function uxt({count:t}){return g.jsx("div",{className:"tlui-people-menu__avatar tlui-people-menu__more",children:Math.abs(t)})}const dxt=Lr(function(){const e=re(),n=Fr(),r=et(),i=hr(),s=S.useRef(!1),[o,a]=S.useState(!1),l=S.useCallback(b=>{a(b)},[]),c=e.user.getColor(),u=S.useCallback(b=>{e.user.updateUserPreferences({color:b}),i("set-color",{source:"people-menu"})},[e,i]),{handleButtonClick:d,handleButtonPointerDown:h,handleButtonPointerEnter:f,handleButtonPointerUp:y}=$e.useMemo(()=>{const b=()=>{s.current=!1,window.removeEventListener("pointerup",b)};return{handleButtonClick:I=>{const{id:P}=I.currentTarget.dataset;P&&c!==P&&u(P)},handleButtonPointerDown:I=>{const{id:P}=I.currentTarget.dataset;P&&(u(P),s.current=!0,window.addEventListener("pointerup",b))},handleButtonPointerEnter:I=>{if(!s.current)return;const{id:P}=I.currentTarget.dataset;P&&u(P)},handleButtonPointerUp:I=>{const{id:P}=I.currentTarget.dataset;P&&u(P)}}},[c,u]);return g.jsxs(W6,{onOpenChange:l,open:o,children:[g.jsx(K6,{dir:"ltr",asChild:!0,children:g.jsx(xt,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:r("people-menu.change-color"),children:g.jsx(vt,{icon:"color"})})}),g.jsx(q6,{container:n,children:g.jsx(G6,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:g.jsx("div",{className:"tlui-buttons__grid",children:W3.map(b=>g.jsx(xt,{type:"icon","data-id":b,"data-testid":b,"aria-label":b,isActive:c===b,title:b,className:"tlui-button-grid__button",style:{color:b},onPointerEnter:f,onPointerDown:h,onPointerUp:y,onClick:d,children:g.jsx(vt,{icon:"color"})},b))})})})]})});function hxt(){const t=re(),e=hr(),n=ie("userName",()=>t.user.getName(),[]),r=et(),i=S.useRef(n),s=S.useRef(n),[o,a]=S.useState(!1),l=S.useCallback(()=>{a(h=>!h)},[]),c=S.useCallback(h=>{s.current=h,t.user.updateUserPreferences({name:h})},[t]),u=S.useCallback(()=>{i.current!==s.current&&(e("change-user-name",{source:"people-menu"}),i.current=s.current)},[e]),d=S.useCallback(()=>{a(!1),t.user.updateUserPreferences({name:i.current}),t.menus.clearOpenMenus()},[t]);return g.jsxs("div",{className:"tlui-people-menu__user",children:[g.jsx(dxt,{}),o?g.jsx(qv,{className:"tlui-people-menu__user__input",defaultValue:n,onValueChange:c,onComplete:l,onCancel:d,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{o||a(!0)},children:n||r("people-menu.anonymous-user")}),n?null:g.jsx("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")})]}),g.jsx(xt,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:l,children:g.jsx(vt,{icon:o?"check":"edit"})})]})}function fxt({children:t}){const e=et(),n=Fr(),r=re(),i=Lme(),s=ie("user",()=>r.user.getColor(),[r]),o=ie("user",()=>r.user.getName(),[r]),[a,l]=Vd("people menu");return i.length?g.jsxs(W6,{onOpenChange:l,open:a,children:[g.jsx(K6,{dir:"ltr",asChild:!0,children:g.jsx("button",{className:"tlui-people-menu__avatars-button",title:e("people-menu.title"),children:g.jsxs("div",{className:"tlui-people-menu__avatars",children:[i.slice(-5).map(c=>g.jsx(lxt,{userId:c},c)),i.length>0&&g.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:s},children:(o==null?void 0:o[0])??""}),i.length>5&&g.jsx(uxt,{count:i.length-5})]})})}),g.jsx(q6,{container:n,children:g.jsx(G6,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,children:g.jsxs("div",{className:"tlui-people-menu__wrapper",children:[g.jsx("div",{className:"tlui-people-menu__section",children:g.jsx(hxt,{})}),i.length>0&&g.jsx("div",{className:"tlui-people-menu__section",children:i.map(c=>g.jsx(cxt,{userId:c},c+"_presence"))}),t]})})})]}):null}function pxt(){return g.jsx("div",{className:"tlui-share-zone",draggable:!1,children:g.jsx(fxt,{})})}const gxt=Object.freeze([mo,hg,fg,vu]);function F1e(t=gxt){const e=re();return ie("getRelevantStyles",()=>{var s;const n=new J3(e.getSharedStyles()),r=!!((s=e.root.getCurrent())!=null&&s.shapeType),i=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(n.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const o of t)n.applyValue(o,e.getStyleForNextShape(o));return r||i||n.size>0?n:null},[e])}const Ca={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowKind:[{value:"arc",icon:"arrow-arc"},{value:"elbow",icon:"arrow-elbow"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},Rp=S.memo(function(e){const{uiType:n,items:r,title:i,style:s,value:o,onValueChange:a,onHistoryMark:l,theme:c}=e,u=re(),d=et(),h=Ys(),f=S.useRef(!1),y=S.useRef(null),{handleButtonClick:b,handleButtonPointerDown:v,handleButtonPointerEnter:x,handleButtonPointerUp:C}=S.useMemo(()=>{const E=()=>{f.current=!1,window.removeEventListener("pointerup",E);const D=y.current;D&&(["TEXTAREA","INPUT"].includes(D.nodeName)||D.isContentEditable)?D.focus():h>=wr.TABLET_SM&&u.getContainer().focus(),y.current=null};return{handleButtonClick:D=>{const{id:L}=D.currentTarget.dataset;o.type==="shared"&&o.value===L||(l==null||l("point picker item"),a(s,L))},handleButtonPointerDown:D=>{const{id:L}=D.currentTarget.dataset;l==null||l("point picker item"),a(s,L),f.current=!0,y.current=document.activeElement,window.addEventListener("pointerup",E)},handleButtonPointerEnter:D=>{if(!f.current)return;const{id:L}=D.currentTarget.dataset;a(s,L)},handleButtonPointerUp:D=>{const{id:L}=D.currentTarget.dataset;o.type==="shared"&&o.value===L||a(s,L)}}},[u,h,o,l,a,s]);return g.jsx(Uht,{"data-testid":`style.${n}`,type:"single",className:nt("tlui-buttons__grid"),value:o.type==="shared"?o.value:void 0,children:r.map(E=>{const I=i+" — "+d(`${n}-style.${E.value}`);return g.jsx(Hht,{type:"icon","data-id":E.value,"data-testid":`style.${n}.${E.value}`,"aria-label":I,value:E.value,"data-state":o.type==="shared"&&o.value===E.value?"on":"off","data-isactive":o.type==="shared"&&o.value===E.value,title:I,className:nt("tlui-button-grid__button"),style:s===mo?{color:c[E.value].solid}:void 0,onPointerEnter:x,onPointerDown:v,onPointerUp:C,onClick:b,children:g.jsx(vt,{icon:E.icon})},E.value)})})}),$1e=$e.forwardRef(function({onHistoryMark:e,title:n,min:r,steps:i,value:s,label:o,onValueChange:a,["data-testid"]:l,ariaValueModifier:c=1},u){const d=et(),[h,f]=S.useState(-1);S.useEffect(()=>{f(0)},[]);const y=S.useCallback(x=>{a(x[0])},[a]),b=S.useCallback(()=>{e("click slider")},[e]),v=S.useCallback(x=>{x.key==="Tab"&&x.stopPropagation()},[]);return g.jsx("div",{className:"tlui-slider__container",children:g.jsxs(Ndt,{"data-testid":l,className:"tlui-slider",dir:"ltr",min:r??0,max:i,step:1,value:s!==null?[s]:void 0,onPointerDown:b,onValueChange:y,onKeyDownCapture:v,onKeyUpCapture:v,title:n+" — "+d(o),children:[g.jsx(jdt,{className:"tlui-slider__track",dir:"ltr",children:s!==null&&g.jsx(Ldt,{className:"tlui-slider__range",dir:"ltr"})}),s!==null&&g.jsx(Fdt,{"aria-valuemin":(r??0)*c,"aria-valuenow":s*c,"aria-valuemax":i*c,className:"tlui-slider__thumb",dir:"ltr",ref:u,tabIndex:h})]})})});function mxt({label:t,uiTypeA:e,uiTypeB:n,labelA:r,labelB:i,itemsA:s,itemsB:o,styleA:a,styleB:l,valueA:c,valueB:u,onValueChange:d}){const h=re(),f=et(),[y,b]=S.useState(!1),[v,x]=S.useState(!1),C=S.useMemo(()=>{var _;return((_=s.find(A=>c.type==="shared"&&c.value===A.value))==null?void 0:_.icon)??"mixed"},[s,c]),E=S.useMemo(()=>{var _;return((_=o.find(A=>u.type==="shared"&&u.value===A.value))==null?void 0:_.icon)??"mixed"},[o,u]);if(c===void 0&&u===void 0)return null;const I=`style panel ${e} A`,P=`style panel ${n} B`;return g.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[g.jsx("div",{title:f(t),className:"tlui-style-panel__double-select-picker-label",children:f(t)}),g.jsxs(Or,{label:f(t),className:"tlui-buttons__horizontal",children:[g.jsxs(Sg,{id:I,open:y,onOpenChange:b,children:[g.jsx(Cg,{children:g.jsx(Ei,{type:"icon","data-testid":`style.${e}`,title:f(r)+" — "+(c===null||c.type==="mixed"?f("style-panel.mixed"):f(`${e}-style.${c.value}`)),children:g.jsx(vt,{icon:C,small:!0,invertIcon:!0})})}),g.jsx(Eg,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:g.jsx(Or,{label:f(r),className:"tlui-buttons__grid",children:g.jsx(So,{type:"icons",sourceId:"style-panel",children:s.map(_=>g.jsx(Ei,{"data-testid":`style.${e}.${_.value}`,type:"icon",onClick:()=>{d(a,_.value),oo.deleteOpenMenu(I,h.contextId),b(!1)},title:`${f(r)} — ${f(`${e}-style.${_.value}`)}`,children:g.jsx(vt,{icon:_.icon,invertIcon:!0})},_.value))})})})]}),g.jsxs(Sg,{id:P,open:v,onOpenChange:x,children:[g.jsx(Cg,{children:g.jsx(Ei,{type:"icon","data-testid":`style.${n}`,title:f(i)+" — "+(u===null||u.type==="mixed"?f("style-panel.mixed"):f(`${n}-style.${u.value}`)),children:g.jsx(vt,{icon:E,small:!0})})}),g.jsx(Eg,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:g.jsx(Or,{label:f(i),className:"tlui-buttons__grid",children:g.jsx(So,{type:"icons",sourceId:"style-panel",children:o.map(_=>g.jsx(Ei,{type:"icon",title:`${f(i)} — ${f(`${n}-style.${_.value}`)}`,"data-testid":`style.${n}.${_.value}`,onClick:()=>{d(l,_.value),oo.deleteOpenMenu(P,h.contextId),x(!1)},children:g.jsx(vt,{icon:_.icon})},_.value))})})})]})]})]})}const yxt=S.memo(mxt);function vxt({id:t,label:e,uiType:n,stylePanelType:r,style:i,items:s,type:o,value:a,onValueChange:l}){const c=et(),u=re(),[d,h]=S.useState(!1),f=S.useMemo(()=>{var C;return(C=s.find(E=>a.type==="shared"&&E.value===a.value))==null?void 0:C.icon},[s,a]),y=c(`style-panel.${r}`),b=a.type==="mixed"?c("style-panel.mixed"):y+" — "+c(`${n}-style.${a.value}`),v=e?c(e):"",x=`style panel ${t}`;return g.jsxs(Sg,{id:x,open:d,onOpenChange:h,children:[g.jsx(Cg,{children:g.jsxs(Ei,{type:o,"data-testid":`style.${n}`,"data-direction":"left",title:b,children:[v&&g.jsx(xr,{children:v}),g.jsx(vt,{icon:f??"mixed"})]})}),g.jsx(Eg,{side:"left",align:"center",children:g.jsx(Or,{label:v,className:nt("tlui-buttons__grid",`tlui-buttons__${r}`),children:g.jsx(So,{type:"icons",sourceId:"style-panel",children:s.map(C=>g.jsx(Ei,{type:"icon","data-testid":`style.${n}.${C.value}`,title:y+" — "+c(`${n}-style.${C.value}`),isActive:f===C.icon,onClick:()=>{u.markHistoryStoppingPoint("select style dropdown item"),l(i,C.value),oo.deleteOpenMenu(x,u.contextId),h(!1)},children:g.jsx(vt,{icon:C.icon})},C.value))})})})]})}const qA=S.memo(vxt);function bxt({styles:t}){const e=NS();if(!t)return null;const n=t.get(uc),r=t.get(UI),i=t.get(zI),s=t.get(ow),o=t.get(KI),a=t.get(Td),l=n===void 0,c=r===void 0&&i===void 0,u=o===void 0,d=s===void 0,h=a===void 0,f=Ud({isDarkMode:e});return g.jsxs(g.Fragment,{children:[g.jsx(xxt,{theme:f,styles:t}),!h&&g.jsx(wxt,{theme:f,styles:t}),!(l&&c&&u&&d)&&g.jsxs("div",{className:"tlui-style-panel__section",children:[g.jsx(Sxt,{styles:t}),g.jsx(Ext,{styles:t}),g.jsx(Txt,{styles:t}),g.jsx(Cxt,{styles:t})]})]})}function Gv(){const t=re(),e=hr();return $e.useMemo(()=>function(r,i){t.run(()=>{t.isIn("select")&&t.setStyleForSelectedShapes(r,i),t.setStyleForNextShapes(r,i),t.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:r.id,value:i})},[t,e])}function xxt({styles:t,theme:e}){const n=et(),r=re(),i=S.useCallback(d=>r.markHistoryStoppingPoint(d),[r]),s=Gv(),o=t.get(mo),a=t.get(fg),l=t.get(hg),c=t.get(vu),u=a!==void 0||l!==void 0||c!==void 0;return g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"tlui-style-panel__section__common","data-testid":"style.panel",children:[o===void 0?null:g.jsx(Or,{label:n("style-panel.color"),children:g.jsx(Rp,{title:n("style-panel.color"),uiType:"color",style:mo,items:Ca.color,value:o,onValueChange:s,theme:e,onHistoryMark:i})}),g.jsx(Ixt,{})]}),u&&g.jsxs("div",{className:"tlui-style-panel__section",children:[a===void 0?null:g.jsx(Or,{label:n("style-panel.fill"),children:g.jsx(Rp,{title:n("style-panel.fill"),uiType:"fill",style:fg,items:Ca.fill,value:a,onValueChange:s,theme:e,onHistoryMark:i})}),l===void 0?null:g.jsx(Or,{label:n("style-panel.dash"),children:g.jsx(Rp,{title:n("style-panel.dash"),uiType:"dash",style:hg,items:Ca.dash,value:l,onValueChange:s,theme:e,onHistoryMark:i})}),c===void 0?null:g.jsx(Or,{label:n("style-panel.size"),children:g.jsx(Rp,{title:n("style-panel.size"),uiType:"size",style:vu,items:Ca.size,value:c,onValueChange:(d,h)=>{s(d,h);const f=r.getSelectedShapeIds();f.length>0&&yn(r,f)},theme:e,onHistoryMark:i})})]})]})}function wxt({theme:t,styles:e}){const n=et(),r=Gv(),i=re(),s=S.useCallback(u=>i.markHistoryStoppingPoint(u),[i]),o=e.get(Td),a=e.get(H3),l=e.get(VI),c=e.get(WI);return o===void 0&&l===void 0?null:g.jsxs("div",{className:"tlui-style-panel__section",children:[o===void 0?null:g.jsx(Or,{label:n("style-panel.font"),children:g.jsx(Rp,{title:n("style-panel.font"),uiType:"font",style:Td,items:Ca.font,value:o,onValueChange:r,theme:t,onHistoryMark:s})}),a===void 0?null:g.jsxs(Or,{label:n("style-panel.align"),className:"tlui-style-panel__row",children:[g.jsx(Rp,{title:n("style-panel.align"),uiType:"align",style:H3,items:Ca.textAlign,value:a,onValueChange:r,theme:t,onHistoryMark:s}),g.jsx("div",{className:"tlui-style-panel__row__extra-button",children:g.jsx(Ei,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:g.jsx(vt,{icon:"vertical-align-middle"})})})]}),l===void 0?null:g.jsxs(Or,{label:n("style-panel.label-align"),className:"tlui-style-panel__row",children:[g.jsx(Rp,{title:n("style-panel.label-align"),uiType:"align",style:VI,items:Ca.horizontalAlign,value:l,onValueChange:r,theme:t,onHistoryMark:s}),g.jsx("div",{className:"tlui-style-panel__row__extra-button",children:c===void 0?g.jsx(Ei,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:g.jsx(vt,{icon:"vertical-align-middle"})}):g.jsx(qA,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:WI,items:Ca.verticalAlign,value:c,onValueChange:r})})]})]})}function Sxt({styles:t}){const e=et(),n=Gv(),r=t.get(uc);return r===void 0?null:g.jsx(Or,{label:e("style-panel.geo"),children:g.jsx(qA,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",stylePanelType:"geo",style:uc,items:Ca.geo,value:r,onValueChange:n})})}function Cxt({styles:t}){const e=et(),n=Gv(),r=t.get(KI);return r===void 0?null:g.jsx(Or,{label:e("style-panel.spline"),children:g.jsx(qA,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",stylePanelType:"spline",style:KI,items:Ca.spline,value:r,onValueChange:n})})}function Ext({styles:t}){const e=et(),n=Gv(),r=t.get(ow);return r===void 0?null:g.jsx(Or,{label:e("style-panel.arrow-kind"),children:g.jsx(qA,{id:"arrow-kind",type:"menu",label:"style-panel.arrow-kind",uiType:"arrow-kind",stylePanelType:"arrow-kind",style:ow,items:Ca.arrowKind,value:r,onValueChange:n})})}function Txt({styles:t}){const e=Gv(),n=t.get(UI),r=t.get(zI);return!n||!r?null:g.jsx(yxt,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:zI,itemsA:Ca.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:UI,itemsB:Ca.arrowheadEnd,valueB:n,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const gb=[.1,.25,.5,.75,1];function Ixt(){const t=re(),e=S.useCallback(a=>t.markHistoryStoppingPoint(a),[t]),n=ie("opacity",()=>t.getSharedOpacity(),[t]),r=hr(),i=et(),s=$e.useCallback(a=>{const l=gb[a];t.run(()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(l),t.setOpacityForNextShapes(l),t.updateInstanceState({isChangingStyle:!0})}),r("set-style",{source:"style-panel",id:"opacity",value:a})},[t,r]);if(n===void 0)return null;const o=n.type==="mixed"?-1:gb.indexOf(Aue(gb,a=>Math.abs(a-n.value)));return g.jsx($1e,{"data-testid":"style.opacity",value:o>=0?o:gb.length-1,label:n.type==="mixed"?"style-panel.mixed":`opacity-style.${n.value}`,onValueChange:s,steps:gb.length-1,title:i("style-panel.opacity"),onHistoryMark:e,ariaValueModifier:25})}const Pxt=S.memo(function({isMobile:e,children:n}){const r=re(),i=S.useRef(null);Hd(i);const s=F1e(),o=S.useCallback(()=>{e||r.updateInstanceState({isChangingStyle:!1})},[r,e]),a=n??g.jsx(bxt,{styles:s});return S.useEffect(()=>{function l(u){var d;u.key==="Escape"&&((d=i.current)!=null&&d.contains(document.activeElement))&&(u.stopPropagation(),r.getContainer().focus())}const c=i.current;return c==null||c.addEventListener("keydown",l,{capture:!0}),()=>{c==null||c.removeEventListener("keydown",l,{capture:!0})}},[r]),g.jsx("div",{ref:i,className:nt("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:o,children:a})}),_xt=150,kxt=16,Axt=16,xne=16**2,Mxt=8,Ih=16,z9=({children:t,className:e,isMousingDown:n,getSelectionBounds:r,changeOnlyWhenYChanges:i=!1,label:s})=>{const o=re(),a=S.useRef(null);Hd(a),rtt(a);const{isVisible:l,isInteractive:c,hide:u,show:d,position:h,move:f}=Rxt(i),y=S.useRef(!1),[b,v]=S.useState(!1),x=ES("content size update counter",0);S.useEffect(()=>{it(a.current);const E=new ResizeObserver(()=>{x.update(I=>I+1)});return E.observe(a.current),()=>E.disconnect()},[x]),S.useEffect(()=>{let E=x.get();return Ma("toolbar position",function(){const P=a.current;if(!P)return;const _=x.get();o.getCamera(),x.get();const A=Oxt(o,P,r);if(!A)y.current&&(y.current=!1,v(!1));else{if(o.getCameraState()==="moving")a.current.style.setProperty("transform",`translate(${A.x}px, ${A.y}px)`);else{const L=E!==_;f(A.x,A.y,L)}y.current||(y.current=!0,v(!0))}E=_})},[o,r,x,f]);const C=ie("camera state",()=>o.getCameraState(),[o]);return S.useEffect(()=>{if(n||!b){u();return}d()},[b,C,n,d,u]),S.useLayoutEffect(()=>{const E=a.current;E&&(E.dataset.visible=`${l}`)},[l,h]),S.useLayoutEffect(()=>{const E=a.current;E&&E.style.setProperty("transform",`translate(${h.x}px, ${h.y}px)`)},[h]),S.useLayoutEffect(()=>{const E=a.current;E&&(E.dataset.interactive=`${c}`)},[c]),g.jsx("div",{ref:a,"data-interactive":!1,"data-visible":!1,"data-testid":"contextual-toolbar",className:nt("tlui-contextual-toolbar",e),onPointerDown:tr,children:g.jsx(Or,{className:"tlui-menu tlui-buttons__horizontal",label:s,children:t})})};function B1e(t){return new Ee(t.x,t.y,t.width,t.height)}function Oxt(t,e,n){var u;const r=(u=n())==null?void 0:u.clone();if(!r)return;const i=t.getViewportScreenBounds();if(r.x-=i.x,r.y-=i.y,r.midY<Ih||r.midY>i.h-Ih||r.midX<Ih||r.midX>i.w-Ih)return;const s=B1e(e.getBoundingClientRect());if(!s.width||!s.height)return;const{scrollLeft:o,scrollTop:a}=t.getContainer();let l=r.midX-s.w/2,c=r.y-s.h-Mxt;return l=Ct(l,Ih,i.w-s.w-Ih),c=Ct(c,Ih,i.h-s.h-Ih),l+=o,c+=a,l=Math.round(l),c=Math.round(c),{x:l,y:c}}function Dxt(t,e,n){return n?M.Sub(e,t).y**2>=xne:M.Len2(M.Sub(e,t))>=xne}function Rxt(t){const e=re(),n=S.useRef({name:"hidden"}),[r,i]=S.useState(!1),[s,o]=S.useState(!1),[a,l]=S.useState({x:-1e3,y:-1e3}),c=S.useRef(new M(-1e3,-1e3)),u=S.useRef(new M(-1e3,-1e3)),d=S.useRef(-1),h=S.useRef(-1),f=S.useCallback((v,x,C=!1)=>{if(u.current.x=v,u.current.y=x,n.current.name==="hidden"||n.current.name==="showing")return;clearTimeout(h.current);const E=()=>{if(n.current.name==="shown"&&Dxt(u.current,c.current,t)){const{x:I,y:P}=u.current;c.current=new M(I,P),C?_c.flushSync(()=>l({x:I,y:P})):l({x:I,y:P})}};C?E():h.current=e.timers.setTimeout(E,_xt)},[e,t]),y=S.useCallback((v=!1)=>{switch(n.current.name){case"showing":{clearTimeout(d.current),n.current={name:"hidden"};break}case"shown":{n.current={name:"hiding"},i(!1),v?(n.current={name:"hidden"},o(!1)):d.current=e.timers.setTimeout(()=>{n.current={name:"hidden"},o(!1)},kxt);break}}},[e]),b=S.useCallback(()=>{switch(n.current.name){case"hidden":{n.current={name:"showing"},d.current=e.timers.setTimeout(()=>{const{x:v,y:x}=u.current;c.current=new M(v,x),l({x:v,y:x}),n.current={name:"shown"},o(!0),i(!0)},Axt);break}case"hiding":{clearTimeout(d.current),n.current={name:"shown"},i(!0),f(u.current.x,u.current.y);break}}},[e,f]);return{isVisible:s,isInteractive:r,show:b,hide:y,move:f,position:a}}function z1e({shapeId:t,onClose:e,source:n}){const r=re(),[i,s]=S.useState(()=>{const y=r.getShape(t);if(!y)return"";if(!("altText"in y.props))throw Error("Shape does not have altText property");return y.props.altText||""}),o=et(),a=S.useRef(null),l=hr(),c=r.getIsReadonly(),u=y=>s(y),d=()=>{l("set-alt-text",{source:n});const y=r.getShape(t);y&&(r.updateShapes([{id:y.id,type:y.type,props:{altText:i}}]),e())},h=()=>d(),f=S.useCallback(()=>e(),[e]);return S.useEffect(()=>{var b;(b=a.current)==null||b.select();function y(v){v.key==="Escape"&&(v.stopPropagation(),f())}return document.addEventListener("keydown",y,{capture:!0}),()=>{document.removeEventListener("keydown",y,{capture:!0})}},[f]),g.jsxs(g.Fragment,{children:[g.jsx(qv,{ref:a,className:"tlui-media__toolbar-alt-text-input","data-testid":"media-toolbar.alt-text-input",value:i,placeholder:o("tool.media-alt-text-desc"),onValueChange:u,onComplete:d,onCancel:f,disabled:c}),!c&&g.jsx(xt,{title:o("tool.media-alt-text-confirm"),type:"icon",onPointerDown:St,onClick:h,children:g.jsx(vt,{small:!0,icon:"check"})})]})}const Nxt=Lr(function({imageShapeId:e,isManipulating:n,onEditAltTextStart:r,onManipulatingStart:i,onManipulatingEnd:s}){const o=re(),a=hr(),l=et(),c="image-toolbar",u=S.useRef(null),d=o.getIsReadonly(),h=ie("crop",()=>o.getShape(e).props.crop,[o,e]),f=h?Math.min(1-(h.bottomRight.x-h.topLeft.x),1-(h.bottomRight.y-h.topLeft.y)):0,[y,b]=S.useState(h?Math.max(f,1-1/zo):zo),v=Kd();S.useEffect(()=>{b(h?Math.max(f,1-1/zo):zo)},[h,f,y]);const x=S.useCallback($=>o.markHistoryStoppingPoint($),[o]),C=S.useCallback(($,H)=>{const R=zo/(zo-1);return Math.pow($/H,R)*H},[]),E=h&&y?yu(C(f,y),[0,y],[0,100],!0):0,I=S.useCallback($=>{o.setCurrentTool("select.crop.idle");const H=$/100,R=1-1/zo,j=Math.min(R,y??R),B=zo/(zo-1),K=Math.pow(H,1/B)*j,G=K>=1?1:K/(2*(1-K)),V=o.getShape(e);if(!V)return;const W=wpt(G,V,y);o.updateShape({id:V.id,type:V.type,x:W.x,y:W.y,props:{w:W.w,h:W.h,crop:W.crop}}),a("set-style",{source:"image-toolbar",id:"zoom",value:$})},[o,a,e,y]),P=S.useCallback(()=>v["image-replace"].onSelect("image-toolbar"),[v]),_=S.useCallback(()=>v["download-original"].onSelect("image-toolbar"),[v]),A=$=>{const H=o.getShape(e);H&&o.run(()=>{o.setCurrentTool("select.crop.idle");const R=Cpt($,H);o.markHistoryStoppingPoint("aspect ratio"),o.updateShape({id:e,type:"image",x:R.x,y:R.y,props:{crop:R.crop,w:R.w,h:R.h}}),yn(o,[e])})},D=ie("altText",()=>o.getShape(e).props.altText,[o,e]),L=ie("shapeAspectRatio",()=>{const $=o.getShape(e);return $.props.w/$.props.h},[o,e]),z=!h||Af(h,dc());return S.useEffect(()=>{n&&o.timers.setTimeout(()=>{var $;return($=u.current)==null?void 0:$.focus()},0)},[o,n]),S.useEffect(()=>{function $(R){n&&(R.key==="Escape"?(o.cancel(),s()):R.key==="Enter"&&(o.complete(),s()))}const H=u.current;return H&&H.addEventListener("keydown",$),()=>{H&&H.removeEventListener("keydown",$)}},[o,n,s]),n?g.jsxs(g.Fragment,{children:[g.jsx($1e,{ref:u,value:E,label:"tool.image-zoom",onValueChange:I,onHistoryMark:x,min:0,steps:100,"data-testid":"tool.image-zoom",title:l("tool.image-zoom")}),g.jsxs(jA,{id:"image-toolbar-aspect-ratio",children:[g.jsx(LA,{children:g.jsx(xt,{title:l("tool.aspect-ratio"),type:"icon",children:g.jsx(vt,{icon:"corners"})})}),g.jsx(FA,{side:"top",align:"center",children:vpt.map($=>{let H=!1;return z?$==="original"&&(H=!0):$==="circle"?H=!!h.isCircle:$==="square"?H=!(h!=null&&h.isCircle)&&Nr(L,Y$[$],.1):$==="original"?H=!1:H=!z&&Nr(L,Y$[$],.01),g.jsx(zht,{onSelect:()=>A($),checked:H,title:l(`tool.aspect-ratio.${$}`),children:g.jsx(xr,{children:l(`tool.aspect-ratio.${$}`)})},$)})})]}),g.jsx(xt,{type:"icon",onClick:s,"data-testid":"tool.image-confirm",style:{borderLeft:"1px solid var(--color-divider)",marginLeft:"2px"},children:g.jsx(vt,{small:!0,icon:"check"})})]}):g.jsxs(g.Fragment,{children:[!d&&g.jsx(xt,{type:"icon",title:l("tool.replace-media"),onClick:P,children:g.jsx(vt,{small:!0,icon:"tool-media"})}),!d&&g.jsx(xt,{type:"icon",title:l("tool.image-crop"),onClick:i,children:g.jsx(vt,{small:!0,icon:"crop"})}),g.jsx(xt,{type:"icon",title:l("action.download-original"),onClick:_,children:g.jsx(vt,{small:!0,icon:"download"})}),(D||!d)&&g.jsx(xt,{type:"normal",title:l("tool.media-alt-text"),onClick:()=>{a("alt-text-start",{source:c}),r()},children:g.jsx(vt,{small:!0,icon:"alt"})})]})});function jxt({children:t}){const e=re(),n=ie("imageShape",()=>{const s=e.getOnlySelectedShape();return!s||s.type!=="image"?null:s.id},[e]),r=ie("showToolbar",()=>e.isInAny("select.idle","select.pointing_shape","select.crop"),[e]),i=ie("locked",()=>{var s;return n?(s=e.getShape(n))==null?void 0:s.isLocked:!1},[e,n]);return!n||!r||i?null:g.jsx(Lxt,{imageShapeId:n,children:t},n)}function Lxt({children:t,imageShapeId:e}){const n=re(),r=et(),i=ie("editor path",()=>n.isInAny("select.crop.cropping","select.crop.pointing_crop_handle","select.crop.translating_crop"),[n]),s=ie("camera",()=>n.getCamera(),[n]),o=ie("editor path",()=>n.isIn("select.crop."),[n]),a=S.useRef(),l=S.useCallback(()=>{n.setCroppingShape(null),n.setCurrentTool("select.idle")},[n]),[c,u]=S.useState(!1),d=S.useCallback(()=>u(!0),[]),h=S.useCallback(()=>n.setCurrentTool("select.crop.idle"),[n]),f=S.useCallback(()=>u(!1),[]);S.useEffect(()=>{a.current=void 0},[s]);const y=S.useCallback(()=>{if(o&&a.current)return a.current;const b=n.getSelectionScreenBounds();if(!b)return;const v=new Ee(b.x,b.y,b.width,0);return a.current=v,v},[n,o]);return i?(a.current=void 0,null):g.jsx(z9,{className:"tlui-image__toolbar",getSelectionBounds:y,label:r("tool.image-toolbar-title"),children:t||(c?g.jsx(z1e,{shapeId:e,onClose:f,source:"image-toolbar"}):g.jsx(Nxt,{imageShapeId:e,isManipulating:o,onEditAltTextStart:d,onManipulatingStart:h,onManipulatingEnd:l}))})}function Fxt({textEditor:t,onEditLinkStart:e}){const n=hr(),r=et(),i="rich-text-menu",[s,o]=S.useState(0);return S.useEffect(function(){function c(){o(u=>u+1)}t.on("update",c),t.on("selectionUpdate",c)},[t]),S.useEffect(()=>{function l(c){e&&ni(c)&&c.shiftKey&&c.key==="k"&&(c.preventDefault(),e())}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[e]),S.useMemo(()=>{function l(c,u){n("rich-text",{operation:c,source:i}),t.chain().focus()[u]().run()}return[{name:"bold",onSelect(){l("bold","toggleBold")}},{name:"italic",onSelect(){l("bold","toggleItalic")}},{name:"code",onSelect(){l("bold","toggleCode")}},e?{name:"link",onSelect(){e()}}:void 0,{name:"bulletList",onSelect(){l("bulletList","toggleBulletList")}},{name:"highlight",onSelect(){l("bulletList","toggleHighlight")}}].filter(Boolean)},[t,n,e]).map(({name:l,attrs:c,onSelect:u})=>{const d=t.isActive(l,c);return g.jsx(Ei,{title:r(`tool.rich-text-${l}`),"data-testid":`rich-text.${l}`,type:"icon",isActive:d,onPointerDown:St,onClick:u,role:"option","aria-pressed":d,children:g.jsx(vt,{small:!0,icon:l})},l)})}function $xt({textEditor:t,value:e,onClose:n}){const r=re(),[i,s]=S.useState(e),o=et(),a=S.useRef(null),l=hr(),c="rich-text-menu",u=i.startsWith("http")?i:`https://${i}`,d=v=>s(v),h=v=>{l("rich-text",{operation:"link-edit",source:c}),!v.startsWith("http://")&&!v.startsWith("https://")&&(v=`https://${v}`),t.commands.setLink({href:v}),r.getInstanceState().isCoarsePointer?t.commands.blur():t.commands.focus(),n()},f=()=>{l("rich-text",{operation:"link-visit",source:c}),window.open(u,"_blank","noopener, noreferrer"),n()},y=()=>{l("rich-text",{operation:"link-remove",source:c}),t.chain().unsetLink().focus().run(),n()},b=()=>n();return S.useEffect(()=>{var v;(v=a.current)==null||v.focus()},[i]),S.useEffect(()=>{s(e)},[e]),g.jsxs(g.Fragment,{children:[g.jsx(qv,{ref:a,"data-testid":"rich-text.link-input",className:"tlui-rich-text__toolbar-link-input",value:i,onValueChange:d,onComplete:h,onCancel:b,placeholder:"example.com"}),g.jsx(xt,{className:"tlui-rich-text__toolbar-link-visit",title:o("tool.rich-text-link-visit"),type:"icon",onPointerDown:St,onClick:f,disabled:!i,children:g.jsx(vt,{small:!0,icon:"external-link"})}),g.jsx(xt,{className:"tlui-rich-text__toolbar-link-remove",title:o("tool.rich-text-link-remove"),"data-testid":"rich-text.link-remove",type:"icon",onPointerDown:St,onClick:y,children:g.jsx(vt,{small:!0,icon:"trash"})})]})}const Bxt=Lr(function({children:e}){const n=re(),r=ie("textEditor",()=>n.getRichTextEditor(),[n]);return n.getInstanceState().isCoarsePointer||!r?null:g.jsx(zxt,{textEditor:r,children:e})});function zxt({textEditor:t,children:e}){const{isEditingLink:n,onEditLinkStart:r,onEditLinkClose:i}=Uxt(t),[s,o]=S.useState(null),a=S.useRef(),l=Hxt(t),c=et(),u=S.useCallback(()=>{if(n)return a.current;const d=window.getSelection();if(!s||!d||d.rangeCount===0||d.isCollapsed)return;const h=[];for(let y=0;y<d.rangeCount;y++){const b=d.getRangeAt(y);h.push(B1e(b.getBoundingClientRect()))}const f=Ee.Common(h);return a.current=f,f},[s,n]);return S.useEffect(()=>{const d=({editor:h})=>o(h.state.selection);return t.on("selectionUpdate",d),d({editor:t}),()=>{t.off("selectionUpdate",d)}},[t]),g.jsx(z9,{className:"tlui-rich-text__toolbar",getSelectionBounds:u,isMousingDown:l,changeOnlyWhenYChanges:!0,label:c("tool.rich-text-toolbar-title"),children:e||(n?g.jsx($xt,{textEditor:t,value:t.isActive("link")?t.getAttributes("link").href:"",onClose:i}):g.jsx(Fxt,{textEditor:t,onEditLinkStart:r}))})}function Uxt(t){const[e,n]=S.useState(!1);S.useEffect(()=>{if(!t){n(!1);return}const o=()=>{const a=t.isActive("link");n(a)};return t.view.dom.addEventListener("click",o),()=>{t.view.dom.removeEventListener("click",o)}},[t,e]),S.useEffect(()=>{if(t&&t.isActive("link"))try{const{from:o,to:a}=lA(t.state.doc.resolve(t.state.selection.from),t.schema.marks.link);t.state.selection.empty&&t.commands.setTextSelection({from:o,to:a})}catch{}},[t,e]);const r=S.useCallback(()=>{n(!0)},[]),i=S.useCallback(()=>{n(!1)},[]),s=S.useCallback(()=>{if(n(!1),!t)return;const o=t.state.selection.from;t.commands.setTextSelection({from:o,to:o})},[t]);return{isEditingLink:e,onEditLinkStart:r,onEditLinkClose:s,onEditLinkCancel:i}}function Hxt(t){const[e,n]=S.useState(!1);return S.useEffect(()=>{if(!t)return;const r=vk(({isPointing:l})=>{n(l)},16),i=()=>r({isPointing:!0}),s=()=>r({isPointing:!1}),o=["touchstart","pointerdown","mousedown"],a=["touchend","pointerup","mouseup"];return o.forEach(l=>{t.view.dom.addEventListener(l,i)}),a.forEach(l=>{document.body.addEventListener(l,s)}),()=>{o.forEach(l=>{t.view.dom.removeEventListener(l,i)}),a.forEach(l=>{document.body.removeEventListener(l,s)})}},[t]),e}function Vxt(){const t=re(),e=et(),n=F1e(),r=n==null?void 0:n.get(mo),i=Ud({isDarkMode:t.user.getIsDarkMode()}),s=((r==null?void 0:r.type)==="shared"?i[r.value]:i.black).solid,o=ie("disable style panel",()=>t.isInAny("hand","zoom","eraser","laser"),[t]),a=S.useCallback(c=>{c||t.updateInstanceState({isChangingStyle:!1})},[t]),{StylePanel:l}=Hf();return l?g.jsxs(Sg,{id:"mobile style menu",onOpenChange:a,children:[g.jsx(Cg,{children:g.jsx(xt,{type:"tool","data-testid":"mobile-styles.button",style:{color:o?"var(--color-muted-1)":s},title:e("style-panel.title"),disabled:o,children:g.jsx(vt,{icon:o?"blob":(r==null?void 0:r.type)==="mixed"?"mixed":"blob"})})}),g.jsx(Eg,{side:"top",align:"end",children:l&&g.jsx(l,{isMobile:!0})})]}):null}function Wxt(){return g.jsxs(g.Fragment,{children:[g.jsx(qxt,{}),g.jsx(Gxt,{}),g.jsx(Yxt,{}),g.jsx(Xxt,{}),g.jsx(Jxt,{}),g.jsx(Zxt,{}),g.jsx(Qxt,{}),g.jsx(ewt,{}),g.jsx(twt,{}),g.jsx(nwt,{}),g.jsx(iwt,{}),g.jsx(rwt,{}),g.jsx(awt,{}),g.jsx(uwt,{}),g.jsx(swt,{}),g.jsx(cwt,{}),g.jsx(lwt,{}),g.jsx(owt,{}),g.jsx(dwt,{}),g.jsx(hwt,{}),g.jsx(fwt,{}),g.jsx(pwt,{}),g.jsx(gwt,{}),g.jsx(mwt,{}),g.jsx(ywt,{}),g.jsx(vwt,{}),g.jsx(xwt,{}),g.jsx(bwt,{})]})}function Kxt(t){var r;const e=re(),n=(r=t==null?void 0:t.meta)==null?void 0:r.geo;return ie("is tool selected",()=>{if(!t)return!1;const i=e.getCurrentToolId();return i==="geo"?n===e.getSharedStyles().getAsKnownValue(uc):i===t.id},[e,t==null?void 0:t.id,n])}function kn({tool:t}){const e=l9(),n=Kxt(e[t]);return g.jsx($o,{toolId:t,isSelected:n})}function qxt(){return g.jsx(kn,{tool:"select"})}function Gxt(){return g.jsx(kn,{tool:"hand"})}function Yxt(){return g.jsx(kn,{tool:"draw"})}function Xxt(){return g.jsx(kn,{tool:"eraser"})}function Jxt(){return g.jsx(kn,{tool:"arrow"})}function Zxt(){return g.jsx(kn,{tool:"text"})}function Qxt(){return g.jsx(kn,{tool:"note"})}function ewt(){return g.jsx($o,{toolId:"asset"})}function twt(){return g.jsx(kn,{tool:"rectangle"})}function nwt(){return g.jsx(kn,{tool:"ellipse"})}function rwt(){return g.jsx(kn,{tool:"diamond"})}function iwt(){return g.jsx(kn,{tool:"triangle"})}function swt(){return g.jsx(kn,{tool:"rhombus"})}function owt(){return g.jsx(kn,{tool:"heart"})}function awt(){return g.jsx(kn,{tool:"hexagon"})}function lwt(){return g.jsx(kn,{tool:"cloud"})}function cwt(){return g.jsx(kn,{tool:"star"})}function uwt(){return g.jsx(kn,{tool:"oval"})}function dwt(){return g.jsx(kn,{tool:"x-box"})}function hwt(){return g.jsx(kn,{tool:"check-box"})}function fwt(){return g.jsx(kn,{tool:"arrow-left"})}function pwt(){return g.jsx(kn,{tool:"arrow-up"})}function gwt(){return g.jsx(kn,{tool:"arrow-down"})}function mwt(){return g.jsx(kn,{tool:"arrow-right"})}function ywt(){return g.jsx(kn,{tool:"line"})}function vwt(){return g.jsx(kn,{tool:"highlight"})}function bwt(){return g.jsx(kn,{tool:"frame"})}function xwt(){return g.jsx(kn,{tool:"laser"})}const $L=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function BL(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on".concat(e),n)}function mb(t,e,n,r){t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on".concat(e),n)}function U1e(t,e){const n=e.slice(0,e.length-1);for(let r=0;r<n.length;r++)n[r]=t[n[r].toLowerCase()];return n}function H1e(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function wwt(t,e){const n=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let i=!0;for(let s=0;s<n.length;s++)r.indexOf(n[s])===-1&&(i=!1);return i}const Ow={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":$L?173:189,"=":$L?61:187,";":$L?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},mc={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},qb={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},qi={16:!1,18:!1,17:!1,91:!1},ur={};for(let t=1;t<20;t++)Ow["f".concat(t)]=111+t;let Xn=[],Cx=null,V1e="all";const Qu=new Map,Yv=t=>Ow[t.toLowerCase()]||mc[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Swt=t=>Object.keys(Ow).find(e=>Ow[e]===t),Cwt=t=>Object.keys(mc).find(e=>mc[e]===t);function W1e(t){V1e=t||"all"}function Dw(){return V1e||"all"}function Ewt(){return Xn.slice(0)}function Twt(){return Xn.map(t=>Swt(t)||Cwt(t)||String.fromCharCode(t))}function Iwt(){const t=[];return Object.keys(ur).forEach(e=>{ur[e].forEach(n=>{let{key:r,scope:i,mods:s,shortcut:o}=n;t.push({scope:i,shortcut:o,mods:s,keys:r.split("+").map(a=>Yv(a))})})}),t}function Pwt(t){const e=t.target||t.srcElement,{tagName:n}=e;let r=!0;const i=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(i||n==="TEXTAREA"||n==="SELECT")&&!e.readOnly)&&(r=!1),r}function _wt(t){return typeof t=="string"&&(t=Yv(t)),Xn.indexOf(t)!==-1}function kwt(t,e){let n,r;t||(t=Dw());for(const i in ur)if(Object.prototype.hasOwnProperty.call(ur,i))for(n=ur[i],r=0;r<n.length;)n[r].scope===t?n.splice(r,1).forEach(o=>{let{element:a}=o;return U9(a)}):r++;Dw()===t&&W1e(e||"all")}function Awt(t){let e=t.keyCode||t.which||t.charCode;t.key&&t.key.toLowerCase()==="capslock"&&(e=Yv(t.key));const n=Xn.indexOf(e);if(n>=0&&Xn.splice(n,1),t.key&&t.key.toLowerCase()==="meta"&&Xn.splice(0,Xn.length),(e===93||e===224)&&(e=91),e in qi){qi[e]=!1;for(const r in mc)mc[r]===e&&(El[r]=!1)}}function K1e(t){if(typeof t>"u")Object.keys(ur).forEach(i=>{Array.isArray(ur[i])&&ur[i].forEach(s=>TE(s)),delete ur[i]}),U9(null);else if(Array.isArray(t))t.forEach(i=>{i.key&&TE(i)});else if(typeof t=="object")t.key&&TE(t);else if(typeof t=="string"){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];let[i,s]=n;typeof i=="function"&&(s=i,i=""),TE({key:t,scope:i,method:s,splitKey:"+"})}}const TE=t=>{let{key:e,scope:n,method:r,splitKey:i="+"}=t;H1e(e).forEach(o=>{const a=o.split(i),l=a.length,c=a[l-1],u=c==="*"?"*":Yv(c);if(!ur[u])return;n||(n=Dw());const d=l>1?U1e(mc,a):[],h=[];ur[u]=ur[u].filter(f=>{const b=(r?f.method===r:!0)&&f.scope===n&&wwt(f.mods,d);return b&&h.push(f.element),!b}),h.forEach(f=>U9(f))})};function wne(t,e,n,r){if(e.element!==r)return;let i;if(e.scope===n||e.scope==="all"){i=e.mods.length>0;for(const s in qi)Object.prototype.hasOwnProperty.call(qi,s)&&(!qi[s]&&e.mods.indexOf(+s)>-1||qi[s]&&e.mods.indexOf(+s)===-1)&&(i=!1);(e.mods.length===0&&!qi[16]&&!qi[18]&&!qi[17]&&!qi[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Xn),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function Sne(t,e){const n=ur["*"];let r=t.keyCode||t.which||t.charCode;if(t.key&&t.key.toLowerCase()==="capslock"||!El.filter.call(this,t))return;if((r===93||r===224)&&(r=91),Xn.indexOf(r)===-1&&r!==229&&Xn.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const l=qb[a];t[a]&&Xn.indexOf(l)===-1?Xn.push(l):!t[a]&&Xn.indexOf(l)>-1?Xn.splice(Xn.indexOf(l),1):a==="metaKey"&&t[a]&&(Xn=Xn.filter(c=>c in qb||c===r))}),r in qi){qi[r]=!0;for(const a in mc)if(Object.prototype.hasOwnProperty.call(mc,a)){const l=qb[mc[a]];El[a]=t[l]}if(!n)return}for(const a in qi)Object.prototype.hasOwnProperty.call(qi,a)&&(qi[a]=t[qb[a]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Xn.indexOf(17)===-1&&Xn.push(17),Xn.indexOf(18)===-1&&Xn.push(18),qi[17]=!0,qi[18]=!0);const i=Dw();if(n)for(let a=0;a<n.length;a++)n[a].scope===i&&(t.type==="keydown"&&n[a].keydown||t.type==="keyup"&&n[a].keyup)&&wne(t,n[a],i,e);if(!(r in ur))return;const s=ur[r],o=s.length;for(let a=0;a<o;a++)if((t.type==="keydown"&&s[a].keydown||t.type==="keyup"&&s[a].keyup)&&s[a].key){const l=s[a],{splitKey:c}=l,u=l.key.split(c),d=[];for(let h=0;h<u.length;h++)d.push(Yv(u[h]));d.sort().join("")===Xn.sort().join("")&&wne(t,l,i,e)}}function El(t,e,n){Xn=[];const r=H1e(t);let i=[],s="all",o=document,a=0,l=!1,c=!0,u="+",d=!1,h=!1;for(n===void 0&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(s=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(h=!0)),typeof e=="string"&&(s=e),h&&K1e(t,s);a<r.length;a++)t=r[a].split(u),i=[],t.length>1&&(i=U1e(mc,t)),t=t[t.length-1],t=t==="*"?"*":Yv(t),t in ur||(ur[t]=[]),ur[t].push({keyup:l,keydown:c,scope:s,mods:i,shortcut:r[a],method:n,key:r[a],splitKey:u,element:o});if(typeof o<"u"&&window){if(!Qu.has(o)){const f=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return Sne(b,o)},y=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;Sne(b,o),Awt(b)};Qu.set(o,{keydownListener:f,keyupListenr:y,capture:d}),BL(o,"keydown",f,d),BL(o,"keyup",y,d)}if(!Cx){const f=()=>{Xn=[]};Cx={listener:f,capture:d},BL(window,"focus",f,d)}}}function Mwt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(ur).forEach(n=>{ur[n].filter(i=>i.scope===e&&i.shortcut===t).forEach(i=>{i&&i.method&&i.method()})})}function U9(t){const e=Object.values(ur).flat();if(e.findIndex(r=>{let{element:i}=r;return i===t})<0){const{keydownListener:r,keyupListenr:i,capture:s}=Qu.get(t)||{};r&&i&&(mb(t,"keyup",i,s),mb(t,"keydown",r,s),Qu.delete(t))}if((e.length<=0||Qu.size<=0)&&(Object.keys(Qu).forEach(i=>{const{keydownListener:s,keyupListenr:o,capture:a}=Qu.get(i)||{};s&&o&&(mb(i,"keyup",o,a),mb(i,"keydown",s,a),Qu.delete(i))}),Qu.clear(),Object.keys(ur).forEach(i=>delete ur[i]),Cx)){const{listener:i,capture:s}=Cx;mb(window,"focus",i,s),Cx=null}}const zL={getPressedKeyString:Twt,setScope:W1e,getScope:Dw,deleteScope:kwt,getPressedKeyCodes:Ewt,getAllKeyCodes:Iwt,isPressed:_wt,filter:Pwt,trigger:Mwt,unbind:K1e,keyMap:Ow,modifier:mc,modifierMap:qb};for(const t in zL)Object.prototype.hasOwnProperty.call(zL,t)&&(El[t]=zL[t]);if(typeof window<"u"){const t=window.hotkeys;El.noConflict=e=>(e&&window.hotkeys===El&&(window.hotkeys=t),El),window.hotkeys=El}const Cne=["copy","cut","paste","asset"];function Owt(){const t=re(),e=Ka(),n=Kd(),r=l9(),i=ie("is focused",()=>t.getInstanceState().isFocused,[t]);S.useEffect(()=>{if(!i)return;const s=new Array,o=t.getContainer(),a=(c,u)=>{El(c,{element:o.ownerDocument.body},u),s.push(()=>{El.unbind(c,u)})},l=(c,u)=>{El(c,{element:o.ownerDocument.body,keyup:!0,keydown:!1},u),s.push(()=>{El.unbind(c,u)})};for(const c of Object.values(n))c.kbd&&(e&&!c.readonlyOk||Cne.includes(c.id)||a(Ene(c.kbd),u=>{Gb(t)&&!c.isRequiredA11yAction||(St(u),c.onSelect("kbd"))}));for(const c of Object.values(r))!c.kbd||!c.readonlyOk&&t.getIsReadonly()||Cne.includes(c.id)||a(Ene(c.kbd),u=>{Gb(t)||(St(u),c.onSelect("kbd"))});return a(",",c=>{if(Gb(t)||t.inputs.keys.has("Comma"))return;St(c),t.focus(),t.inputs.keys.add("Comma");const{x:u,y:d,z:h}=t.inputs.currentPagePoint,f=t.pageToScreen({x:u,y:d}),y={type:"pointer",name:"pointer_down",point:{x:f.x,y:f.y,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:ni(c),pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(y)}),l(",",c=>{if(Gb(t)||!t.inputs.keys.has("Comma"))return;t.inputs.keys.delete("Comma");const{x:u,y:d,z:h}=t.inputs.currentScreenPoint,f={type:"pointer",name:"pointer_up",point:{x:u,y:d,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:ni(c),pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(f)}),()=>{s.forEach(c=>c())}},[n,r,e,t,i])}function Gb(t){return t.menus.hasAnyOpenMenus()||t.getEditingShapeId()!==null||t.getCrashingError()||!t.user.getAreKeyboardShortcutsEnabled()}function Ene(t){return Dwt(t).map(e=>{let n="";const r=e.includes("!"),i=e.includes("?"),s=e.includes("$"),o=e.replace(/[!?$]/g,"");return r&&i&&s?n=`cmd+shift+alt+${o},ctrl+shift+alt+${o}`:r&&s?n=`cmd+shift+${o},ctrl+shift+${o}`:i&&s?n=`cmd+alt+${o},ctrl+alt+${o}`:i&&r?n=`shift+alt+${o}`:r?n=`shift+${o}`:i?n=`alt+${o}`:s?n=`cmd+${o},ctrl+${o}`:n=o,n}).join(",")}function Dwt(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}const Rwt=S.createContext(!1),Nwt={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,0:9};function jwt({children:t}){const e=re(),n=Hg(),r=Ys(),i=et(),s=S.useRef([]),[o,a]=S.useState(!1),l=Math.min(8,5+r),[c,u]=S.useState(0),d=S.useRef(null),[h,f]=S.useState(null),y=S.useMemo(()=>{const x=h?`:not([data-value="${h}"])`:"";return`
			#${n}_main > *:nth-child(n + ${l+(h?1:2)})${x} {
				display: none;
			}
			#${n}_more > *:nth-child(-n + ${l}) {
				display: none;
			}
			#${n}_more > *:nth-child(-n + ${l+4}) {
				margin-top: 0;
			}
        `},[h,n,l]),b=Zc(()=>{var I;if(!d.current)return;const x=Array.from(d.current.children);u(x.length),x.findIndex(P=>P.getAttribute("data-value")===h)<=l&&f(null);const E=Array.from(d.current.children).findIndex(P=>P.getAttribute("aria-pressed")==="true");E!==-1&&(E>=l&&f(x[E].getAttribute("data-value")),s.current=Array.from(((I=d.current)==null?void 0:I.children)??[]).filter(P=>!(P instanceof HTMLElement)||P.tagName.toLowerCase()!=="button"?!1:!!(P.offsetWidth||P.offsetHeight)))});S.useLayoutEffect(()=>{b()}),S.useLayoutEffect(()=>{if(!d.current)return;const x=new MutationObserver(b);return x.observe(d.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-pressed"]}),()=>{x.disconnect()}},[b]),S.useEffect(()=>{if(!e.options.enableToolbarKeyboardShortcuts)return;function x(C){var I;if(Gb(e)||Fhe(!0)||C.ctrlKey||C.metaKey||C.altKey||C.shiftKey)return;const E=Nwt[C.key];typeof E=="number"&&(St(C),(I=s.current[E])==null||I.click())}return document.addEventListener("keydown",x),()=>{document.removeEventListener("keydown",x)}},[e]);const v="toolbar overflow";return g.jsxs(g.Fragment,{children:[g.jsx("style",{nonce:e.options.nonce,children:y}),g.jsxs(Or,{className:nt("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<wr.TABLET_SM}),label:i("tool-panel.title"),children:[g.jsx("div",{id:`${n}_main`,ref:d,className:"tlui-toolbar__tools__list",children:g.jsx(So,{type:"toolbar",sourceId:"toolbar",children:t})}),c>l+1&&g.jsx(Rwt.Provider,{value:!0,children:g.jsxs(Sg,{id:v,open:o,onOpenChange:a,children:[g.jsx(Cg,{children:g.jsx(Ei,{title:i("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:g.jsx(vt,{icon:"chevron-up"})})}),g.jsx(Eg,{side:"top",align:"center",children:g.jsx(Or,{className:"tlui-buttons__grid","data-testid":"tools.more-content",label:i("tool-panel.more"),id:`${n}_more`,onClick:()=>{oo.deleteOpenMenu(v,e.contextId),a(!1)},children:g.jsx(So,{type:"toolbar-overflow",sourceId:"toolbar",children:t})})})]})})]})]})}function Lwt({activeToolId:t}){const e=re(),n=Ys(),r=et(),i=ie("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),s=ie("current tool",()=>e.getCurrentTool(),[e]);return!t||!s.isLockable?null:g.jsx(xt,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:nt("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<wr.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!i}),children:g.jsx(vt,{icon:i?"lock":"unlock",small:!0})})}const Fwt=S.memo(function({children:e}){const n=re(),r=et(),i=Ys(),s=Ka(),o=ie("current tool id",()=>n.getCurrentToolId(),[n]),a=S.useRef(null);Hd(a);const{ActionsMenu:l,QuickActions:c}=Hf(),u=n.options.actionShortcutsLocation==="menu"?!1:n.options.actionShortcutsLocation==="toolbar"?!0:i<wr.TABLET;return g.jsx("div",{ref:a,className:"tlui-toolbar",children:g.jsxs("div",{className:"tlui-toolbar__inner",children:[g.jsxs("div",{className:"tlui-toolbar__left",children:[!s&&g.jsxs("div",{className:"tlui-toolbar__extras",children:[u&&g.jsxs(Or,{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",label:r("actions-menu.title"),children:[c&&g.jsx(c,{}),l&&g.jsx(l,{})]}),g.jsx(Lwt,{activeToolId:o})]}),g.jsx(jwt,{children:e??g.jsx(Wxt,{})})]}),i<wr.TABLET_SM&&!s&&g.jsx("div",{className:"tlui-toolbar__tools",children:g.jsx(Vxt,{})})]})})}),$wt=Lr(function({videoShapeId:e,onEditAltTextStart:n}){const r=re(),i=hr(),s=et(),o="video-toolbar",a=r.getIsReadonly(),l=Kd(),c=S.useCallback(()=>l["video-replace"].onSelect("video-toolbar"),[l]),u=S.useCallback(()=>l["download-original"].onSelect("video-toolbar"),[l]),d=ie("altText",()=>r.getShape(e).props.altText,[r,e]);return g.jsxs(g.Fragment,{children:[!a&&g.jsx(xt,{type:"icon",title:s("tool.replace-media"),onClick:c,children:g.jsx(vt,{small:!0,icon:"tool-media"})}),g.jsx(xt,{type:"icon",title:s("action.download-original"),onClick:u,children:g.jsx(vt,{small:!0,icon:"download"})}),(d||!a)&&g.jsx(xt,{type:"normal",isActive:!!d,title:s("tool.media-alt-text"),onClick:()=>{i("alt-text-start",{source:o}),n()},children:g.jsx(vt,{small:!0,icon:"alt"})})]})}),Bwt=Lr(function({children:e}){const n=re(),r=ie("videoShape",()=>{const o=n.getOnlySelectedShape();return!o||o.type!=="video"?null:o.id},[n]),i=n.isInAny("select.idle","select.pointing_shape"),s=ie("locked",()=>{var o;return r?(o=n.getShape(r))==null?void 0:o.isLocked:!1},[n,r]);return!r||!i||s?null:g.jsx(zwt,{videoShapeId:r,children:e},r)});function zwt({children:t,videoShapeId:e}){const n=re(),r=et(),[i,s]=S.useState(!1),o=S.useCallback(()=>s(!0),[]),a=S.useCallback(()=>s(!1),[]),l=S.useCallback(()=>{const c=n.getSelectionScreenBounds();if(c)return new Ee(c.x,c.y,c.width,0)},[n]);return g.jsx(z9,{className:"tlui-video__toolbar",getSelectionBounds:l,label:r("tool.video-toolbar-title"),children:t||(i?g.jsx(z1e,{shapeId:e,onClose:a,source:"video-toolbar"}):g.jsx($wt,{videoShapeId:e,onEditAltTextStart:o}))})}function Uwt(){const t=et();return g.jsxs("div",{className:nt("tlui-offline-indicator"),children:[t("status.offline"),g.jsx(Eu,{label:t("status.offline"),icon:"status-offline",small:!0})]})}function Hwt({maxWidth:t=420,ignoreRightWidth:e=0,stylePanelWidth:n=148,marginBetweenZones:r=12,squeezeAmount:i=52,children:s}){const o=S.useRef(null),a=Ys(),l=S.useCallback(()=>{const c=o.current;if(!c)return;const u=c.parentElement.parentElement,d=u.querySelector(".tlui-layout__top__left"),h=u.querySelector(".tlui-layout__top__right"),f=u.offsetWidth,y=d.offsetWidth,b=h.offsetWidth,v=c.offsetWidth-e;let x=(f-v)/2;f%2!==0&&(x-=.5);const C=y+r,E=c.offsetLeft,I=Math.min(f-b-y-2*r,t),P=Math.max(x,C)-E;h.offsetWidth>n&&a<=6?c.style.setProperty("max-width",I-i+"px"):c.style.setProperty("max-width",I+"px"),c.style.setProperty("transform",`translate(${P}px, 0px)`)},[a,e,r,t,i,n]);return S.useLayoutEffect(()=>{const c=o.current;if(!c)return;const u=c.parentElement.parentElement,d=u.querySelector(".tlui-layout__top__left"),h=u.querySelector(".tlui-layout__top__right"),f=new ResizeObserver(l);return f.observe(d),f.observe(h),f.observe(u),f.observe(c),l(),()=>{f.disconnect()}},[l]),S.useLayoutEffect(()=>{l()}),g.jsx("div",{ref:o,className:"tlui-top-panel__container",children:s})}function Vwt(){const t=Nht()==="offline";return g.jsx(Hwt,{children:t&&g.jsx(Uwt,{})})}function Wwt(){return g.jsxs(g.Fragment,{children:[g.jsx(ye,{actionId:"zoom-in",noClose:!0}),g.jsx(ye,{actionId:"zoom-out",noClose:!0}),g.jsx(u1e,{}),g.jsx(d1e,{}),g.jsx(h1e,{})]})}const Kwt=S.memo(function({children:e}){const n=Fr(),[r,i]=Vd("zoom menu"),s=e??g.jsx(Wwt,{});return g.jsxs(z6,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[g.jsx(qwt,{}),g.jsx(PA,{container:n,children:g.jsx(H6,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:g.jsx(So,{type:"menu",sourceId:"zoom-menu",children:s})})})]})}),qwt=()=>{const t=re(),e=Ys(),n=ie("zoom",()=>t.getZoomLevel(),[t]),r=et(),i=S.useCallback(()=>{t.resetZoom(t.getViewportScreenCenter(),{animation:{duration:t.options.animationMediumMs}})},[t]),s=`${Math.floor(n*100)}%`;return g.jsx(Ei,{asChild:!0,type:"icon","aria-label":`${r("navigation-zone.zoom")} — ${s}`,title:`${r("navigation-zone.zoom")} — ${s}`,"data-testid":"minimap.zoom-menu-button",className:"tlui-zoom-menu__button",onDoubleClick:i,children:g.jsx(U6,{dir:"ltr",children:e<wr.MOBILE?null:g.jsx("span",{style:{flexGrow:0,textAlign:"center"},children:s})})})},q1e=S.createContext(null);function Gwt({overrides:t={},children:e}){const n=Fv(t),r=NA();return g.jsx(q1e.Provider,{value:S.useMemo(()=>({ContextMenu:dbt,ActionsMenu:L0t,HelpMenu:null,ZoomMenu:Kwt,MainMenu:Hbt,Minimap:Qbt,StylePanel:Pxt,PageMenu:rxt,NavigationPanel:txt,Toolbar:Fwt,RichTextToolbar:Bxt,ImageToolbar:jxt,VideoToolbar:Bwt,KeyboardShortcutsDialog:owe,QuickActions:axt,HelperButtons:Obt,DebugPanel:Cbt,DebugMenu:Sbt,MenuPanel:Pbt,SharePanel:r?pxt:null,CursorChatBubble:r?pbt:null,TopPanel:r?Vwt:null,Dialogs:_ft,Toasts:Oft,A11y:bot,...n}),[n,r]),children:e})}function Hf(){const t=S.useContext(q1e);if(!t)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return t}const Ywt=Lr(function({overrides:e,components:n,assetUrls:r,onUiEvent:i,forceMobile:s,mediaMimeTypes:o,children:a}){const l=as();return g.jsx(nwe.Provider,{value:o,children:g.jsx(_ve,{assetUrls:GSe(r),children:g.jsx(Mve,{overrides:iwe(e),locale:(l==null?void 0:l.user.getLocale())??hl.locale,children:g.jsx(Sot,{onEvent:i,children:g.jsx(Wht,{children:g.jsx(Vht,{context:"tla",children:g.jsx(pot,{children:g.jsx(Rht,{forceMobile:s,children:g.jsx(Gwt,{overrides:n,children:g.jsx(Xwt,{overrides:e,children:a})})})})})})})})})})});function Xwt({overrides:t,children:e}){const n=vft(t);return g.jsx(Cft,{overrides:n.actions,children:g.jsx(bft,{overrides:n.tools,children:e})})}function Jwt(){const t=re(),{addToast:e}=Wd();S.useEffect(()=>{function n({name:r,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${i}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return t.addListener("max-shapes",n),()=>{t.removeListener("max-shapes",n)}},[t,e])}const Zwt=$e.memo(function({renderDebugMenuItems:e,children:n,hideUi:r,components:i,...s}){return g.jsx(Ywt,{...s,components:i,children:g.jsx(Qwt,{hideUi:r,renderDebugMenuItems:e,children:n})})}),Qwt=$e.memo(function({children:e,hideUi:n,...r}){return g.jsxs(g.Fragment,{children:[e,n?null:g.jsx(eSt,{...r})]})}),eSt=$e.memo(function(){const e=re(),n=et(),r=Ys(),i=Ka(),s=ie("focus",()=>e.getInstanceState().isFocusMode,[e]),o=ie("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:l,MenuPanel:c,StylePanel:u,Toolbar:d,HelpMenu:h,NavigationPanel:f,HelperButtons:y,DebugPanel:b,CursorChatBubble:v,RichTextToolbar:x,ImageToolbar:C,VideoToolbar:E,Toasts:I,Dialogs:P,A11y:_}=Hf();Owt(),lft(),Jwt();const A=S.useRef(!1),D=S.useRef(-1),[L,z]=S.useState(!1);Yz("update hide toolbar while delayed",()=>{if(!(sn.isIos||sn.isAndroid))return;if(e.getEditingShapeId()===null){A.current&&(A.current=!1,clearTimeout(D.current),sn.isAndroid?D.current=e.timers.setTimeout(()=>{z(!1)},150):z(!1));return}A.current||(A.current=!0,clearTimeout(D.current),z(!0))},[]);const{"toggle-focus-mode":$}=Kd();return g.jsxs("div",{className:nt("tlui-layout",{"tlui-layout__mobile":r<wr.TABLET_SM}),"data-iseditinganything":L,"data-breakpoint":r,children:[g.jsx(vot,{}),s?g.jsx("div",{className:"tlui-layout__top",children:g.jsx(xt,{type:"icon",className:"tlui-focus-button",title:n("focus-mode.toggle-focus-mode"),onClick:()=>$.onSelect("menu"),children:g.jsx(vt,{icon:"dot"})})}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"tlui-layout__top",children:[g.jsxs("div",{className:"tlui-layout__top__left",children:[c&&g.jsx(c,{}),y&&g.jsx(y,{})]}),g.jsx("div",{className:"tlui-layout__top__center",children:l&&g.jsx(l,{})}),g.jsxs("div",{className:"tlui-layout__top__right",children:[a&&g.jsx(a,{}),u&&r>=wr.TABLET_SM&&!i&&g.jsx(u,{})]})]}),g.jsxs("div",{className:"tlui-layout__bottom",children:[g.jsxs("div",{className:"tlui-layout__bottom__main",children:[f&&g.jsx(f,{}),d&&g.jsx(d,{}),h&&g.jsx(h,{})]}),o&&b&&g.jsx(b,{}),_&&g.jsx(_,{})]})]}),x&&g.jsx(x,{}),C&&g.jsx(C,{}),E&&g.jsx(E,{}),I&&g.jsx(I,{}),P&&g.jsx(P,{}),g.jsx(v0t,{}),v&&g.jsx(v,{})]})}),tSt=()=>{const{Spinner:t}=Cn();return g.jsx(vme,{children:t?g.jsx(t,{}):null})},nSt=[...y0t,...tyt];function rSt(t){var H;const{children:e,maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s,onMount:o,components:a={},shapeUtils:l=[],bindingUtils:c=[],tools:u=[],embeds:d,textOptions:h,...f}=t,y=Fv(a),b=S.useMemo(()=>({Scribble:Pte,ShapeIndicators:ypt,CollaboratorScribble:Pte,SelectionForeground:ppt,Handles:rpt,Overlays:apt,Spinner:V$,LoadingScreen:tSt,...y}),[y]),v=Bh(l),x=S.useMemo(()=>ix("type",v,uSe),[v]),C=Bh(c),E=S.useMemo(()=>ix("type",C,fwe),[C]),I=Bh(u),P=S.useMemo(()=>ix("id",I,nSt),[I]),_=Bh(i??Ov),A=Bh(s??bk),D=S.useMemo(()=>({addFontsFromNode:kwe,...h,tipTapConfig:{extensions:QS,...h==null?void 0:h.tipTapConfig}}),[h]),L=S.useMemo(()=>[..._,...A],[_,A]),z=qSe(f.assetUrls);return x.find(R=>R.type==="embed")&&d&&s_.setEmbedDefinitions(d),g.jsx(_ve,{assetUrls:GSe(f.assetUrls),children:g.jsx(Mve,{overrides:iwe(f.overrides),locale:((H=f.user)==null?void 0:H.userPreferences.get().locale)??hl.locale,children:g.jsx(eQe,{initialState:"select",...f,components:b,shapeUtils:x,bindingUtils:E,tools:P,textOptions:D,assetUrls:z,children:g.jsxs(Zwt,{...f,components:b,mediaMimeTypes:L,children:[g.jsx(iSt,{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:_,acceptedVideoMimeTypes:A,onMount:o}),e]})})})})}function iSt({maxImageDimension:t,maxAssetSize:e,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r,onMount:i}){const s=re(),o=Wd(),a=et(),l=hr();bme(()=>{const d=[];return d.push(zvt(s)),s.fonts.requestFonts(dmt),s.once("edit",()=>l("edit",{source:"unknown"})),Imt(s,{maxImageDimension:t,maxAssetSize:e,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r,toasts:o,msg:a}),d.push(s.store.props.onMount(s)),d.push(i==null?void 0:i(s)),()=>{d.forEach(h=>h==null?void 0:h())}});const{Canvas:c}=Cn(),{ContextMenu:u}=Hf();return u?g.jsx(u,{}):c?g.jsx(c,{}):null}const sSt={tipTapConfig:{extensions:QS},addFontsFromNode:kwe};S.memo(function(e){const[n,r]=S.useState(null),[i,s]=S.useState(null),o=Bh(e.shapeUtils??[]),a=S.useMemo(()=>ix("type",o,uSe),[o]),l=Bh(e.bindingUtils??[]),c=S.useMemo(()=>ix("type",l,fwe),[l]),u=itt({snapshot:e.snapshot,shapeUtils:a}),{pageId:d,bounds:h,scale:f,pixelRatio:y,background:b,padding:v,darkMode:x,preserveAspectRatio:C,format:E="svg",licenseKey:I,assetUrls:P,textOptions:_=sSt}=e,A=qSe(P);return S.useLayoutEffect(()=>{if(!i||!u)return;let D=!1;const L=document.createElement("div");i.appendChild(L),i.classList.add("tl-container","tl-theme__light");const z=new Be({store:u,shapeUtils:a,bindingUtils:c,tools:[],getContainer:()=>L,licenseKey:I,fontAssetUrls:A.fonts,textOptions:_});d&&z.setCurrentPage(d);const $=z.getCurrentPageShapeIds();async function H(){await z.fonts.loadRequiredFontsForCurrentPage(z.options.maxFontsToLoadBeforeRender);const R=await z.toImage([...$],{bounds:h,scale:f,background:b,padding:v,darkMode:x,preserveAspectRatio:C,format:E});if(!R||D)return;const j=URL.createObjectURL(R.blob);r(j),z.dispose()}return H(),()=>{D=!0}},[E,i,u,a,c,d,h,f,b,v,x,C,I,y,A,_]),S.useEffect(()=>()=>{n&&URL.revokeObjectURL(n)},[n]),g.jsx("div",{ref:s,style:{position:"relative",width:"100%",height:"100%"},children:n&&g.jsx("img",{src:n,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})})});S.memo(function({children:e}){const n=et(),r=Ys(),i=S.useRef(null);Hd(i);const s=e??g.jsx(Dbt,{});return r<wr.MOBILE?null:g.jsx("div",{ref:i,className:"tlui-help-menu",children:g.jsxs(jA,{id:"help menu",children:[g.jsx(LA,{children:g.jsx(xt,{type:"help",title:n("help-menu.title"),"data-testid":"help-menu.button",children:g.jsx(vt,{icon:"question-mark",small:!0})})}),g.jsx(FA,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:g.jsx(So,{type:"menu",sourceId:"help-menu",children:s})})]})})});const oSt=Vt({schemaVersion:Fs(1),storeVersion:VE,recordVersions:$I(Rt,Vt({version:VE,subTypeVersions:$I(Rt,VE).optional(),subTypeKey:Rt.optional()}))}),aSt=Vt({schemaVersion:Fs(2),sequences:$I(Rt,VE)});Vt({tldrawFileFormatVersion:kqe,schema:Aqe("schemaVersion",{1:oSt,2:aSt}),records:Si(Vt({id:Rt,typeName:Rt}).allowUnknownProperties())});Fd("tldraw","3.15.3","esm");Fd("@tldraw/tldraw","3.15.3","esm");var lSt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ue,H9=H9||{},Mt=lSt||self;function GA(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function YA(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function cSt(t,e,n){return t.call.apply(t.bind,arguments)}function uSt(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function Rs(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Rs=cSt:Rs=uSt,Rs.apply(null,arguments)}function IE(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function Li(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Vf(){this.s=this.s,this.o=this.o}var dSt=0;Vf.prototype.s=!1;Vf.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),dSt!=0)};Vf.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const G1e=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function V9(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Tne(t,e){for(let n=1;n<arguments.length;n++){const r=arguments[n];if(GA(r)){const i=t.length||0,s=r.length||0;t.length=i+s;for(let o=0;o<s;o++)t[i+o]=r[o]}else t.push(r)}}function Ns(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Ns.prototype.h=function(){this.defaultPrevented=!0};var hSt=function(){if(!Mt.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Mt.addEventListener("test",()=>{},e),Mt.removeEventListener("test",()=>{},e)}catch{}return t}();function Rw(t){return/^[\s\xa0]*$/.test(t)}function XA(){var t=Mt.navigator;return t&&(t=t.userAgent)?t:""}function tu(t){return XA().indexOf(t)!=-1}function W9(t){return W9[" "](t),t}W9[" "]=function(){};function fSt(t,e){var n=o1t;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var pSt=tu("Opera"),rv=tu("Trident")||tu("MSIE"),Y1e=tu("Edge"),SB=Y1e||rv,X1e=tu("Gecko")&&!(XA().toLowerCase().indexOf("webkit")!=-1&&!tu("Edge"))&&!(tu("Trident")||tu("MSIE"))&&!tu("Edge"),gSt=XA().toLowerCase().indexOf("webkit")!=-1&&!tu("Edge");function J1e(){var t=Mt.document;return t?t.documentMode:void 0}var CB;e:{var UL="",HL=function(){var t=XA();if(X1e)return/rv:([^\);]+)(\)|;)/.exec(t);if(Y1e)return/Edge\/([\d\.]+)/.exec(t);if(rv)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(gSt)return/WebKit\/(\S+)/.exec(t);if(pSt)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(HL&&(UL=HL?HL[1]:""),rv){var VL=J1e();if(VL!=null&&VL>parseFloat(UL)){CB=String(VL);break e}}CB=UL}var EB;if(Mt.document&&rv){var Ine=J1e();EB=Ine||parseInt(CB,10)||void 0}else EB=void 0;var mSt=EB;function Nw(t,e){if(Ns.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(X1e){e:{try{W9(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:ySt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Nw.$.h.call(this)}}Li(Nw,Ns);var ySt={2:"touch",3:"pen",4:"mouse"};Nw.prototype.h=function(){Nw.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var JA="closure_listenable_"+(1e6*Math.random()|0),vSt=0;function bSt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++vSt,this.fa=this.ia=!1}function ZA(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function K9(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function xSt(t,e){for(const n in t)e.call(void 0,t[n],n,t)}function Z1e(t){const e={};for(const n in t)e[n]=t[n];return e}const Pne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Q1e(t,e){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)t[n]=r[n];for(let s=0;s<Pne.length;s++)n=Pne[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function QA(t){this.src=t,this.g={},this.h=0}QA.prototype.add=function(t,e,n,r,i){var s=t.toString();t=this.g[s],t||(t=this.g[s]=[],this.h++);var o=IB(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):(e=new bSt(e,this.src,s,!!r,i),e.ia=n,t.push(e)),e};function TB(t,e){var n=e.type;if(n in t.g){var r=t.g[n],i=G1e(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(ZA(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function IB(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}var q9="closure_lm_"+(1e6*Math.random()|0),WL={};function eCe(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)eCe(t,e[s],n,r,i);return null}return n=rCe(n),t&&t[JA]?t.O(e,n,YA(r)?!!r.capture:!1,i):wSt(t,e,n,!1,r,i)}function wSt(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=YA(i)?!!i.capture:!!i,a=Y9(t);if(a||(t[q9]=a=new QA(t)),n=a.add(e,n,r,o,s),n.proxy)return n;if(r=SSt(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)hSt||(i=o),i===void 0&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(nCe(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function SSt(){function t(n){return e.call(t.src,t.listener,n)}const e=CSt;return t}function tCe(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)tCe(t,e[s],n,r,i);else r=YA(r)?!!r.capture:!!r,n=rCe(n),t&&t[JA]?(t=t.i,e=String(e).toString(),e in t.g&&(s=t.g[e],n=IB(s,n,r,i),-1<n&&(ZA(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete t.g[e],t.h--)))):t&&(t=Y9(t))&&(e=t.g[e.toString()],t=-1,e&&(t=IB(e,n,r,i)),(n=-1<t?e[t]:null)&&G9(n))}function G9(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[JA])TB(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(nCe(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Y9(e))?(TB(n,t),n.h==0&&(n.src=null,e[q9]=null)):ZA(t)}}}function nCe(t){return t in WL?WL[t]:WL[t]="on"+t}function CSt(t,e){if(t.fa)t=!0;else{e=new Nw(e,this);var n=t.listener,r=t.la||t.src;t.ia&&G9(t),t=n.call(r,e)}return t}function Y9(t){return t=t[q9],t instanceof QA?t:null}var KL="__closure_events_fn_"+(1e9*Math.random()>>>0);function rCe(t){return typeof t=="function"?t:(t[KL]||(t[KL]=function(e){return t.handleEvent(e)}),t[KL])}function Mi(){Vf.call(this),this.i=new QA(this),this.S=this,this.J=null}Li(Mi,Vf);Mi.prototype[JA]=!0;Mi.prototype.removeEventListener=function(t,e,n,r){tCe(this,t,e,n,r)};function is(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,typeof e=="string")e=new Ns(e,t);else if(e instanceof Ns)e.target=e.target||t;else{var i=e;e=new Ns(r,t),Q1e(e,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=PE(o,r,!0,e)&&i}if(o=e.g=t,i=PE(o,r,!0,e)&&i,i=PE(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)o=e.g=n[s],i=PE(o,r,!1,e)&&i}Mi.prototype.N=function(){if(Mi.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ZA(n[r]);delete t.g[e],t.h--}}this.J=null};Mi.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};Mi.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function PE(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&TB(t.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var X9=Mt.JSON.stringify;class ESt{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function TSt(){var t=J9;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class ISt{constructor(){this.h=this.g=null}add(e,n){const r=iCe.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}}var iCe=new ESt(()=>new PSt,t=>t.reset());class PSt{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function _St(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function kSt(t){Mt.setTimeout(()=>{throw t},0)}let jw,Lw=!1,J9=new ISt,sCe=()=>{const t=Mt.Promise.resolve(void 0);jw=()=>{t.then(ASt)}};var ASt=()=>{for(var t;t=TSt();){try{t.h.call(t.g)}catch(n){kSt(n)}var e=iCe;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Lw=!1};function eM(t,e){Mi.call(this),this.h=t||1,this.g=e||Mt,this.j=Rs(this.qb,this),this.l=Date.now()}Li(eM,Mi);Ue=eM.prototype;Ue.ga=!1;Ue.T=null;Ue.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),is(this,"tick"),this.ga&&(Z9(this),this.start()))}};Ue.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Z9(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}Ue.N=function(){eM.$.N.call(this),Z9(this),delete this.g};function Q9(t,e,n){if(typeof t=="function")n&&(t=Rs(t,n));else if(t&&typeof t.handleEvent=="function")t=Rs(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:Mt.setTimeout(t,e||0)}function oCe(t){t.g=Q9(()=>{t.g=null,t.i&&(t.i=!1,oCe(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class MSt extends Vf{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:oCe(this)}N(){super.N(),this.g&&(Mt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fw(t){Vf.call(this),this.h=t,this.g={}}Li(Fw,Vf);var _ne=[];function aCe(t,e,n,r){Array.isArray(n)||(n&&(_ne[0]=n.toString()),n=_ne);for(var i=0;i<n.length;i++){var s=eCe(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function lCe(t){K9(t.g,function(e,n){this.g.hasOwnProperty(n)&&G9(e)},t),t.g={}}Fw.prototype.N=function(){Fw.$.N.call(this),lCe(this)};Fw.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function tM(){this.g=!0}tM.prototype.Ea=function(){this.g=!1};function OSt(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&d[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+n+`
`+o})}function DSt(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+n+`
`+s+" "+o})}function sy(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+NSt(t,n)+(r?" "+r:"")})}function RSt(t,e){t.info(function(){return"TIMEOUT: "+e})}tM.prototype.info=function(){};function NSt(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return X9(n)}catch{return e}}var qg={},kne=null;function nM(){return kne=kne||new Mi}qg.Ta="serverreachability";function cCe(t){Ns.call(this,qg.Ta,t)}Li(cCe,Ns);function $w(t){const e=nM();is(e,new cCe(e))}qg.STAT_EVENT="statevent";function uCe(t,e){Ns.call(this,qg.STAT_EVENT,t),this.stat=e}Li(uCe,Ns);function uo(t){const e=nM();is(e,new uCe(e,t))}qg.Ua="timingevent";function dCe(t,e){Ns.call(this,qg.Ua,t),this.size=e}Li(dCe,Ns);function t1(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return Mt.setTimeout(function(){t()},e)}var rM={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},hCe={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function e8(){}e8.prototype.h=null;function Ane(t){return t.h||(t.h=t.i())}function fCe(){}var n1={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function t8(){Ns.call(this,"d")}Li(t8,Ns);function n8(){Ns.call(this,"c")}Li(n8,Ns);var PB;function iM(){}Li(iM,e8);iM.prototype.g=function(){return new XMLHttpRequest};iM.prototype.i=function(){return{}};PB=new iM;function r1(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Fw(this),this.P=jSt,t=SB?125:void 0,this.V=new eM(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new pCe}function pCe(){this.i=null,this.g="",this.h=!1}var jSt=45e3,_B={},l_={};Ue=r1.prototype;Ue.setTimeout=function(t){this.P=t};function kB(t,e,n){t.L=1,t.v=oM(kd(e)),t.s=n,t.S=!0,gCe(t,null)}function gCe(t,e){t.G=Date.now(),i1(t),t.A=kd(t.v);var n=t.A,r=t.W;Array.isArray(r)||(r=[String(r)]),CCe(n.i,"t",r),t.C=0,n=t.l.J,t.h=new pCe,t.g=VCe(t.l,n?e:null,!t.s),0<t.O&&(t.M=new MSt(Rs(t.Pa,t,t.g),t.O)),aCe(t.U,t.g,"readystatechange",t.nb),e=t.I?Z1e(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),$w(),OSt(t.j,t.u,t.A,t.m,t.W,t.s)}Ue.nb=function(t){t=t.target;const e=this.M;e&&ou(t)==3?e.l():this.Pa(t)};Ue.Pa=function(t){try{if(t==this.g)e:{const u=ou(this.g);var e=this.g.Ia();const d=this.g.da();if(!(3>u)&&(u!=3||SB||this.g&&(this.h.h||this.g.ja()||Rne(this.g)))){this.J||u!=4||e==7||(e==8||0>=d?$w(3):$w(2)),sM(this);var n=this.g.da();this.ca=n;t:if(mCe(this)){var r=Rne(this.g);t="";var i=r.length,s=ou(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Np(this),Ex(this);var o="";break t}this.h.i=new Mt.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,DSt(this.j,this.u,this.A,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Rw(a)){var c=a;break t}}c=null}if(n=c)sy(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,AB(this,n);else{this.i=!1,this.o=3,uo(12),Np(this),Ex(this);break e}}this.S?(yCe(this,u,o),SB&&this.i&&u==3&&(aCe(this.U,this.V,"tick",this.mb),this.V.start())):(sy(this.j,this.m,o,null),AB(this,o)),u==4&&Np(this),this.i&&!this.J&&(u==4?BCe(this.l,this):(this.i=!1,i1(this)))}else r1t(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.o=3,uo(12)):(this.o=0,uo(13)),Np(this),Ex(this)}}}catch{}finally{}};function mCe(t){return t.g?t.u=="GET"&&t.L!=2&&t.l.Ha:!1}function yCe(t,e,n){let r=!0,i;for(;!t.J&&t.C<n.length;)if(i=LSt(t,n),i==l_){e==4&&(t.o=4,uo(14),r=!1),sy(t.j,t.m,null,"[Incomplete Response]");break}else if(i==_B){t.o=4,uo(15),sy(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else sy(t.j,t.m,i,null),AB(t,i);mCe(t)&&i!=l_&&i!=_B&&(t.h.g="",t.C=0),e!=4||n.length!=0||t.h.h||(t.o=1,uo(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),l8(e),e.M=!0,uo(11))):(sy(t.j,t.m,n,"[Invalid Chunked Response]"),Np(t),Ex(t))}Ue.mb=function(){if(this.g){var t=ou(this.g),e=this.g.ja();this.C<e.length&&(sM(this),yCe(this,t,e),this.i&&t!=4&&i1(this))}};function LSt(t,e){var n=t.C,r=e.indexOf(`
`,n);return r==-1?l_:(n=Number(e.substring(n,r)),isNaN(n)?_B:(r+=1,r+n>e.length?l_:(e=e.slice(r,r+n),t.C=r+n,e)))}Ue.cancel=function(){this.J=!0,Np(this)};function i1(t){t.Y=Date.now()+t.P,vCe(t,t.P)}function vCe(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=t1(Rs(t.lb,t),e)}function sM(t){t.B&&(Mt.clearTimeout(t.B),t.B=null)}Ue.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(RSt(this.j,this.A),this.L!=2&&($w(),uo(17)),Np(this),this.o=2,Ex(this)):vCe(this,this.Y-t)};function Ex(t){t.l.H==0||t.J||BCe(t.l,t)}function Np(t){sM(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,Z9(t.V),lCe(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function AB(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||MB(n.i,t))){if(!t.K&&MB(n.i,t)&&n.H==3){try{var r=n.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)d_(n),cM(n);else break e;a8(n),uo(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&n.A==0&&!n.v&&(n.v=t1(Rs(n.ib,n),6e3));if(1>=ICe(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else jp(n,11)}else if((t.K||n.g==t)&&d_(n),!Rw(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(n.V=c[0],c=c[1],n.H==2)if(c[0]=="c"){n.K=c[1],n.pa=c[2];const u=c[3];u!=null&&(n.ra=u,n.l.info("VER="+n.ra));const d=c[4];d!=null&&(n.Ga=d,n.l.info("SVER="+n.Ga));const h=c[5];h!=null&&typeof h=="number"&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const f=t.g;if(f){const y=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var s=r.i;s.g||y.indexOf("spdy")==-1&&y.indexOf("quic")==-1&&y.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(r8(s,s.h),s.h=null))}if(r.F){const b=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;b&&(r.Da=b,Vn(r.I,r.F,b))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=t;if(r.wa=HCe(r,r.J?r.pa:null,r.Y),o.K){PCe(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.B&&(sM(a),i1(a)),r.g=o}else FCe(r);0<n.j.length&&uM(n)}else c[0]!="stop"&&c[0]!="close"||jp(n,7);else n.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?jp(n,7):o8(n):c[0]!="noop"&&n.h&&n.h.Aa(c),n.A=0)}}$w(4)}catch{}}function FSt(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(GA(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function $St(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(GA(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}function bCe(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(GA(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=$St(t),r=FSt(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}var xCe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function BSt(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Xp(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Xp){this.h=t.h,c_(this,t.j),this.s=t.s,this.g=t.g,u_(this,t.m),this.l=t.l;var e=t.i,n=new Bw;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Mne(this,n),this.o=t.o}else t&&(e=String(t).match(xCe))?(this.h=!1,c_(this,e[1]||"",!0),this.s=Yb(e[2]||""),this.g=Yb(e[3]||"",!0),u_(this,e[4]),this.l=Yb(e[5]||"",!0),Mne(this,e[6]||"",!0),this.o=Yb(e[7]||"")):(this.h=!1,this.i=new Bw(null,this.h))}Xp.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Xb(e,One,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(Xb(e,One,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(Xb(n,n.charAt(0)=="/"?HSt:USt,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Xb(n,WSt)),t.join("")};function kd(t){return new Xp(t)}function c_(t,e,n){t.j=n?Yb(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function u_(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Mne(t,e,n){e instanceof Bw?(t.i=e,KSt(t.i,t.h)):(n||(e=Xb(e,VSt)),t.i=new Bw(e,t.h))}function Vn(t,e,n){t.i.set(e,n)}function oM(t){return Vn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Yb(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Xb(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,zSt),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function zSt(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var One=/[#\/\?@]/g,USt=/[#\?:]/g,HSt=/[#\?]/g,VSt=/[#\?@]/g,WSt=/#/g;function Bw(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Wf(t){t.g||(t.g=new Map,t.h=0,t.i&&BSt(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}Ue=Bw.prototype;Ue.add=function(t,e){Wf(this),this.i=null,t=Xv(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function wCe(t,e){Wf(t),e=Xv(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function SCe(t,e){return Wf(t),e=Xv(t,e),t.g.has(e)}Ue.forEach=function(t,e){Wf(this),this.g.forEach(function(n,r){n.forEach(function(i){t.call(e,i,r,this)},this)},this)};Ue.ta=function(){Wf(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let s=0;s<i.length;s++)n.push(e[r])}return n};Ue.Z=function(t){Wf(this);let e=[];if(typeof t=="string")SCe(this,t)&&(e=e.concat(this.g.get(Xv(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};Ue.set=function(t,e){return Wf(this),this.i=null,t=Xv(this,t),SCe(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};Ue.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function CCe(t,e,n){wCe(t,e),0<n.length&&(t.i=null,t.g.set(Xv(t,e),V9(n)),t.h+=n.length)}Ue.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};function Xv(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function KSt(t,e){e&&!t.j&&(Wf(t),t.i=null,t.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(wCe(this,r),CCe(this,i,n))},t)),t.j=e}var qSt=class{constructor(t,e){this.g=t,this.map=e}};function ECe(t){this.l=t||GSt,Mt.PerformanceNavigationTiming?(t=Mt.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(Mt.g&&Mt.g.Ka&&Mt.g.Ka()&&Mt.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var GSt=10;function TCe(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function ICe(t){return t.h?1:t.g?t.g.size:0}function MB(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function r8(t,e){t.g?t.g.add(e):t.h=e}function PCe(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}ECe.prototype.cancel=function(){if(this.i=_Ce(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function _Ce(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return V9(t.i)}var YSt=class{stringify(t){return Mt.JSON.stringify(t,void 0)}parse(t){return Mt.JSON.parse(t,void 0)}};function XSt(){this.g=new YSt}function JSt(t,e,n){const r=n||"";try{bCe(t,function(i,s){let o=i;YA(i)&&(o=X9(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function ZSt(t,e){const n=new tM;if(Mt.Image){const r=new Image;r.onload=IE(_E,n,r,"TestLoadImage: loaded",!0,e),r.onerror=IE(_E,n,r,"TestLoadImage: error",!1,e),r.onabort=IE(_E,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=IE(_E,n,r,"TestLoadImage: timeout",!1,e),Mt.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function _E(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function s1(t){this.l=t.fc||null,this.j=t.ob||!1}Li(s1,e8);s1.prototype.g=function(){return new aM(this.l,this.j)};s1.prototype.i=function(t){return function(){return t}}({});function aM(t,e){Mi.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=i8,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Li(aM,Mi);var i8=0;Ue=aM.prototype;Ue.open=function(t,e){if(this.readyState!=i8)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,zw(this)};Ue.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||Mt).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};Ue.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,o1(this)),this.readyState=i8};Ue.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,zw(this)),this.g&&(this.readyState=3,zw(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Mt.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;kCe(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function kCe(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}Ue.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?o1(this):zw(this),this.readyState==3&&kCe(this)}};Ue.Za=function(t){this.g&&(this.response=this.responseText=t,o1(this))};Ue.Ya=function(t){this.g&&(this.response=t,o1(this))};Ue.ka=function(){this.g&&o1(this)};function o1(t){t.readyState=4,t.l=null,t.j=null,t.A=null,zw(t)}Ue.setRequestHeader=function(t,e){this.v.append(t,e)};Ue.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};Ue.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function zw(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(aM.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var QSt=Mt.JSON.parse;function Sr(t){Mi.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=ACe,this.L=this.M=!1}Li(Sr,Mi);var ACe="",e1t=/^https?$/i,t1t=["POST","PUT"];Ue=Sr.prototype;Ue.Oa=function(t){this.M=t};Ue.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():PB.g(),this.C=this.u?Ane(this.u):Ane(PB),this.g.onreadystatechange=Rs(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(s){Dne(this,s);return}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=Mt.FormData&&t instanceof Mt.FormData,!(0<=G1e(t1t,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of n)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{DCe(this),0<this.B&&((this.L=n1t(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Rs(this.ua,this)):this.A=Q9(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(s){Dne(this,s)}};function n1t(t){return rv&&typeof t.timeout=="number"&&t.ontimeout!==void 0}Ue.ua=function(){typeof H9<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,is(this,"timeout"),this.abort(8))};function Dne(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,MCe(t),lM(t)}function MCe(t){t.F||(t.F=!0,is(t,"complete"),is(t,"error"))}Ue.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,is(this,"complete"),is(this,"abort"),lM(this))};Ue.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),lM(this,!0)),Sr.$.N.call(this)};Ue.La=function(){this.s||(this.G||this.v||this.l?OCe(this):this.kb())};Ue.kb=function(){OCe(this)};function OCe(t){if(t.h&&typeof H9<"u"&&(!t.C[1]||ou(t)!=4||t.da()!=2)){if(t.v&&ou(t)==4)Q9(t.La,0,t);else if(is(t,"readystatechange"),ou(t)==4){t.h=!1;try{const o=t.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=o===0){var i=String(t.I).match(xCe)[1]||null;!i&&Mt.self&&Mt.self.location&&(i=Mt.self.location.protocol.slice(0,-1)),r=!e1t.test(i?i.toLowerCase():"")}n=r}if(n)is(t,"complete"),is(t,"success");else{t.m=6;try{var s=2<ou(t)?t.g.statusText:""}catch{s=""}t.j=s+" ["+t.da()+"]",MCe(t)}}finally{lM(t)}}}}function lM(t,e){if(t.g){DCe(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||is(t,"ready");try{n.onreadystatechange=r}catch{}}}function DCe(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(Mt.clearTimeout(t.A),t.A=null)}Ue.isActive=function(){return!!this.g};function ou(t){return t.g?t.g.readyState:0}Ue.da=function(){try{return 2<ou(this)?this.g.status:-1}catch{return-1}};Ue.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};Ue.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),QSt(e)}};function Rne(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case ACe:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function r1t(t){const e={};t=(t.g&&2<=ou(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<t.length;r++){if(Rw(t[r]))continue;var n=_St(t[r]);const i=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}xSt(e,function(r){return r.join(", ")})}Ue.Ia=function(){return this.m};Ue.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function RCe(t){let e="";return K9(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function s8(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=RCe(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):Vn(t,e,n))}function yb(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function NCe(t){this.Ga=0,this.j=[],this.l=new tM,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=yb("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=yb("baseRetryDelayMs",5e3,t),this.hb=yb("retryDelaySeedMs",1e4,t),this.eb=yb("forwardChannelMaxRetries",2,t),this.xa=yb("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new ECe(t&&t.concurrentRequestLimit),this.Ja=new XSt,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}Ue=NCe.prototype;Ue.ra=8;Ue.H=1;function o8(t){if(jCe(t),t.H==3){var e=t.W++,n=kd(t.I);if(Vn(n,"SID",t.K),Vn(n,"RID",e),Vn(n,"TYPE","terminate"),a1(t,n),e=new r1(t,t.l,e),e.L=2,e.v=oM(kd(n)),n=!1,Mt.navigator&&Mt.navigator.sendBeacon)try{n=Mt.navigator.sendBeacon(e.v.toString(),"")}catch{}!n&&Mt.Image&&(new Image().src=e.v,n=!0),n||(e.g=VCe(e.l,null),e.g.ha(e.v)),e.G=Date.now(),i1(e)}UCe(t)}function cM(t){t.g&&(l8(t),t.g.cancel(),t.g=null)}function jCe(t){cM(t),t.u&&(Mt.clearTimeout(t.u),t.u=null),d_(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&Mt.clearTimeout(t.m),t.m=null)}function uM(t){if(!TCe(t.i)&&!t.m){t.m=!0;var e=t.Na;jw||sCe(),Lw||(jw(),Lw=!0),J9.add(e,t),t.C=0}}function i1t(t,e){return ICe(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=t1(Rs(t.Na,t,e),zCe(t,t.C)),t.C++,!0)}Ue.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const i=new r1(this,this.l,t);let s=this.s;if(this.U&&(s?(s=Z1e(s),Q1e(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=LCe(this,i,e),n=kd(this.I),Vn(n,"RID",t),Vn(n,"CVER",22),this.F&&Vn(n,"X-HTTP-Session-Id",this.F),a1(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(RCe(s)))+"&"+e:this.o&&s8(n,this.o,s)),r8(this.i,i),this.bb&&Vn(n,"TYPE","init"),this.P?(Vn(n,"$req",e),Vn(n,"SID","null"),i.aa=!0,kB(i,n,null)):kB(i,n,e),this.H=2}}else this.H==3&&(t?Nne(this,t):this.j.length==0||TCe(this.i)||Nne(this))};function Nne(t,e){var n;e?n=e.m:n=t.W++;const r=kd(t.I);Vn(r,"SID",t.K),Vn(r,"RID",n),Vn(r,"AID",t.V),a1(t,r),t.o&&t.s&&s8(r,t.o,t.s),n=new r1(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=LCe(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),r8(t.i,n),kB(n,r,e)}function a1(t,e){t.na&&K9(t.na,function(n,r){Vn(e,r,n)}),t.h&&bCe({},function(n,r){Vn(e,r,n)})}function LCe(t,e,n){n=Math.min(t.j.length,n);var r=t.h?Rs(t.h.Va,t.h,t):null;e:{var i=t.j;let s=-1;for(;;){const o=["count="+n];s==-1?0<n?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<n;l++){let c=i[l].g;const u=i[l].map;if(c-=s,0>c)s=Math.max(0,i[l].g-100),a=!1;else try{JSt(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,r}function FCe(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;jw||sCe(),Lw||(jw(),Lw=!0),J9.add(e,t),t.A=0}}function a8(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=t1(Rs(t.Ma,t),zCe(t,t.A)),t.A++,!0)}Ue.Ma=function(){if(this.u=null,$Ce(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=t1(Rs(this.jb,this),t)}};Ue.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,uo(10),cM(this),$Ce(this))};function l8(t){t.B!=null&&(Mt.clearTimeout(t.B),t.B=null)}function $Ce(t){t.g=new r1(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=kd(t.wa);Vn(e,"RID","rpc"),Vn(e,"SID",t.K),Vn(e,"AID",t.V),Vn(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Vn(e,"TO",t.qa),Vn(e,"TYPE","xmlhttp"),a1(t,e),t.o&&t.s&&s8(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=oM(kd(e)),n.s=null,n.S=!0,gCe(n,t)}Ue.ib=function(){this.v!=null&&(this.v=null,cM(this),a8(this),uo(19))};function d_(t){t.v!=null&&(Mt.clearTimeout(t.v),t.v=null)}function BCe(t,e){var n=null;if(t.g==e){d_(t),l8(t),t.g=null;var r=2}else if(MB(t.i,e))n=e.F,PCe(t.i,e),r=1;else return;if(t.H!=0){if(e.i)if(r==1){n=e.s?e.s.length:0,e=Date.now()-e.G;var i=t.C;r=nM(),is(r,new dCe(r,n)),uM(t)}else FCe(t);else if(i=e.o,i==3||i==0&&0<e.ca||!(r==1&&i1t(t,e)||r==2&&a8(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:jp(t,5);break;case 4:jp(t,10);break;case 3:jp(t,6);break;default:jp(t,2)}}}function zCe(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function jp(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var r=Rs(t.pb,t);n||(n=new Xp("//www.google.com/images/cleardot.gif"),Mt.location&&Mt.location.protocol=="http"||c_(n,"https"),oM(n)),ZSt(n.toString(),r)}else uo(2);t.H=0,t.h&&t.h.za(e),UCe(t),jCe(t)}Ue.pb=function(t){t?(this.l.info("Successfully pinged google.com"),uo(2)):(this.l.info("Failed to ping google.com"),uo(1))};function UCe(t){if(t.H=0,t.ma=[],t.h){const e=_Ce(t.i);(e.length!=0||t.j.length!=0)&&(Tne(t.ma,e),Tne(t.ma,t.j),t.i.i.length=0,V9(t.j),t.j.length=0),t.h.ya()}}function HCe(t,e,n){var r=n instanceof Xp?kd(n):new Xp(n);if(r.g!="")e&&(r.g=e+"."+r.g),u_(r,r.m);else{var i=Mt.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Xp(null);r&&c_(s,r),e&&(s.g=e),i&&u_(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&Vn(r,n,e),Vn(r,"VER",t.ra),a1(t,r),r}function VCe(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n&&t.Ha&&!t.va?new Sr(new s1({ob:!0})):new Sr(t.va),e.Oa(t.J),e}Ue.isActive=function(){return!!this.h&&this.h.isActive(this)};function WCe(){}Ue=WCe.prototype;Ue.Ba=function(){};Ue.Aa=function(){};Ue.za=function(){};Ue.ya=function(){};Ue.isActive=function(){return!0};Ue.Va=function(){};function h_(){if(rv&&!(10<=Number(mSt)))throw Error("Environmental error: no available transport.")}h_.prototype.g=function(t,e){return new za(t,e)};function za(t,e){Mi.call(this),this.g=new NCe(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Rw(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Rw(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Jv(this)}Li(za,Mi);za.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;uo(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=HCe(t,null,t.Y),uM(t)};za.prototype.close=function(){o8(this.g)};za.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=X9(t),t=n);e.j.push(new qSt(e.fb++,t)),e.H==3&&uM(e)};za.prototype.N=function(){this.g.h=null,delete this.j,o8(this.g),delete this.g,za.$.N.call(this)};function KCe(t){t8.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}Li(KCe,t8);function qCe(){n8.call(this),this.status=1}Li(qCe,n8);function Jv(t){this.g=t}Li(Jv,WCe);Jv.prototype.Ba=function(){is(this.g,"a")};Jv.prototype.Aa=function(t){is(this.g,new KCe(t))};Jv.prototype.za=function(t){is(this.g,new qCe)};Jv.prototype.ya=function(){is(this.g,"b")};function s1t(){this.blockSize=-1}function Tc(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Li(Tc,s1t);Tc.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function qL(t,e,n){n||(n=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[4]+4118548399&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[8]+1770035416&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[12]+1804603682&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(n^i))+r[1]+4129170786&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[5]+3593408605&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[9]+568446438&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[13]+2850285829&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(n^i^s)+r[5]+4294588738&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[1]+2763975236&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[13]+681279174&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[9]+3654602809&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(i^(n|~s))+r[0]+4096336452&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[12]+1700485571&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[8]+1873313359&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[4]+4149444226&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}Tc.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=n;)qL(this,t,s),s+=this.blockSize;if(typeof t=="string"){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){qL(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){qL(this,r),i=0;break}}this.h=i,this.i+=e};Tc.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};function bn(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=t[i]|0;r&&s==e||(n[i]=s,r=!1)}this.g=n}var o1t={};function c8(t){return-128<=t&&128>t?fSt(t,function(e){return new bn([e|0],0>e?-1:0)}):new bn([t|0],0>t?-1:0)}function au(t){if(isNaN(t)||!isFinite(t))return wy;if(0>t)return es(au(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=OB;return new bn(e,0)}function GCe(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return es(GCe(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=au(Math.pow(e,8)),r=wy,i=0;i<t.length;i+=8){var s=Math.min(8,t.length-i),o=parseInt(t.substring(i,i+s),e);8>s?(s=au(Math.pow(e,s)),r=r.R(s).add(au(o))):(r=r.R(n),r=r.add(au(o)))}return r}var OB=4294967296,wy=c8(0),DB=c8(1),jne=c8(16777216);Ue=bn.prototype;Ue.ea=function(){if(xl(this))return-es(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:OB+r)*e,e*=OB}return t};Ue.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(ld(this))return"0";if(xl(this))return"-"+es(this).toString(t);for(var e=au(Math.pow(t,6)),n=this,r="";;){var i=p_(n,e).g;n=f_(n,i.R(e));var s=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=i,ld(n))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};Ue.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function ld(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function xl(t){return t.h==-1}Ue.X=function(t){return t=f_(this,t),xl(t)?-1:ld(t)?0:1};function es(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new bn(n,~t.h).add(DB)}Ue.abs=function(){return xl(this)?es(this):this};Ue.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(t.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new bn(n,n[n.length-1]&-2147483648?-1:0)};function f_(t,e){return t.add(es(e))}Ue.R=function(t){if(ld(this)||ld(t))return wy;if(xl(this))return xl(t)?es(this).R(es(t)):es(es(this).R(t));if(xl(t))return es(this.R(es(t)));if(0>this.X(jne)&&0>t.X(jne))return au(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=t.D(i)>>>16,l=t.D(i)&65535;n[2*r+2*i]+=o*l,kE(n,2*r+2*i),n[2*r+2*i+1]+=s*l,kE(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,kE(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,kE(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new bn(n,0)};function kE(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function vb(t,e){this.g=t,this.h=e}function p_(t,e){if(ld(e))throw Error("division by zero");if(ld(t))return new vb(wy,wy);if(xl(t))return e=p_(es(t),e),new vb(es(e.g),es(e.h));if(xl(e))return e=p_(t,es(e)),new vb(es(e.g),e.h);if(30<t.g.length){if(xl(t)||xl(e))throw Error("slowDivide_ only works with positive integers.");for(var n=DB,r=e;0>=r.X(t);)n=Lne(n),r=Lne(r);var i=zm(n,1),s=zm(r,1);for(r=zm(r,2),n=zm(n,2);!ld(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=zm(r,1),n=zm(n,1)}return e=f_(t,i.R(e)),new vb(i,e)}for(i=wy;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=au(n),o=s.R(e);xl(o)||0<o.X(t);)n-=r,s=au(n),o=s.R(e);ld(s)&&(s=DB),i=i.add(s),t=f_(t,o)}return new vb(i,t)}Ue.gb=function(t){return p_(this,t).h};Ue.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new bn(n,this.h&t.h)};Ue.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new bn(n,this.h|t.h)};Ue.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new bn(n,this.h^t.h)};function Lne(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new bn(n,t.h)}function zm(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new bn(i,t.h)}h_.prototype.createWebChannel=h_.prototype.g;za.prototype.send=za.prototype.u;za.prototype.open=za.prototype.m;za.prototype.close=za.prototype.close;rM.NO_ERROR=0;rM.TIMEOUT=8;rM.HTTP_ERROR=6;hCe.COMPLETE="complete";fCe.EventType=n1;n1.OPEN="a";n1.CLOSE="b";n1.ERROR="c";n1.MESSAGE="d";Mi.prototype.listen=Mi.prototype.O;Sr.prototype.listenOnce=Sr.prototype.P;Sr.prototype.getLastError=Sr.prototype.Sa;Sr.prototype.getLastErrorCode=Sr.prototype.Ia;Sr.prototype.getStatus=Sr.prototype.da;Sr.prototype.getResponseJson=Sr.prototype.Wa;Sr.prototype.getResponseText=Sr.prototype.ja;Sr.prototype.send=Sr.prototype.ha;Sr.prototype.setWithCredentials=Sr.prototype.Oa;Tc.prototype.digest=Tc.prototype.l;Tc.prototype.reset=Tc.prototype.reset;Tc.prototype.update=Tc.prototype.j;bn.prototype.add=bn.prototype.add;bn.prototype.multiply=bn.prototype.R;bn.prototype.modulo=bn.prototype.gb;bn.prototype.compare=bn.prototype.X;bn.prototype.toNumber=bn.prototype.ea;bn.prototype.toString=bn.prototype.toString;bn.prototype.getBits=bn.prototype.D;bn.fromNumber=au;bn.fromString=GCe;var a1t=function(){return new h_},l1t=function(){return nM()},GL=rM,c1t=hCe,u1t=qg,Fne={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},d1t=s1,AE=fCe,h1t=Sr,f1t=Tc,Sy=bn;const $ne="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Is.UNAUTHENTICATED=new Is(null),Is.GOOGLE_CREDENTIALS=new Is("google-credentials-uid"),Is.FIRST_PARTY=new Is("first-party-uid"),Is.MOCK_USER=new Is("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zv="9.23.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tg=new T_("@firebase/firestore");function Bne(){return Tg.logLevel}function lt(t,...e){if(Tg.logLevel<=cn.DEBUG){const n=e.map(u8);Tg.debug(`Firestore (${Zv}): ${t}`,...n)}}function Ad(t,...e){if(Tg.logLevel<=cn.ERROR){const n=e.map(u8);Tg.error(`Firestore (${Zv}): ${t}`,...n)}}function iv(t,...e){if(Tg.logLevel<=cn.WARN){const n=e.map(u8);Tg.warn(`Firestore (${Zv}): ${t}`,...n)}}function u8(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kt(t="Unexpected state"){const e=`FIRESTORE (${Zv}) INTERNAL ASSERTION FAILED: `+t;throw Ad(e),new Error(e)}function Kn(t,e){t||kt()}function Lt(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const we={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ye extends Rl{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YCe{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class p1t{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Is.UNAUTHENTICATED))}shutdown(){}}class g1t{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class m1t{constructor(e){this.t=e,this.currentUser=Is.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i;const i=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let s=new md;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new md,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},a=l=>{lt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(lt("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new md)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(lt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Kn(typeof r.accessToken=="string"),new YCe(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Kn(e===null||typeof e=="string"),new Is(e)}}class y1t{constructor(e,n,r){this.h=e,this.l=n,this.m=r,this.type="FirstParty",this.user=Is.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class v1t{constructor(e,n,r){this.h=e,this.l=n,this.m=r}getToken(){return Promise.resolve(new y1t(this.h,this.l,this.m))}start(e,n){e.enqueueRetryable(()=>n(Is.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class b1t{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class x1t{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,n){const r=s=>{s.error!=null&&lt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.T;return this.T=s.token,lt("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{lt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.I.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.I.getImmediate({optional:!0});s?i(s):lt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Kn(typeof n.token=="string"),this.T=n.token,new b1t(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w1t(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XCe{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=w1t(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}}function hn(t,e){return t<e?-1:t>e?1:0}function sv(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Ye(we.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Ye(we.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new Ye(we.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ye(we.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ii.fromMillis(Date.now())}static fromDate(e){return ii.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new ii(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?hn(this.nanoseconds,e.nanoseconds):hn(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Dt(e)}static min(){return new Dt(new ii(0,0))}static max(){return new Dt(new ii(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{constructor(e,n,r){n===void 0?n=0:n>e.length&&kt(),r===void 0?r=e.length-n:r>e.length-n&&kt(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Uw.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Uw?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=e.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class Wn extends Uw{construct(e,n,r){return new Wn(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ye(we.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new Wn(n)}static emptyPath(){return new Wn([])}}const S1t=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ks extends Uw{construct(e,n,r){return new ks(e,n,r)}static isValidIdentifier(e){return S1t.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ks.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ks(["__name__"])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new Ye(we.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new Ye(we.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Ye(we.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new Ye(we.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ks(n)}static emptyPath(){return new ks([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e){this.path=e}static fromPath(e){return new ht(Wn.fromString(e))}static fromName(e){return new ht(Wn.fromString(e).popFirst(5))}static empty(){return new ht(Wn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Wn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Wn.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ht(new Wn(e.slice()))}}function C1t(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Dt.fromTimestamp(r===1e9?new ii(n+1,0):new ii(n,r));return new wf(i,ht.empty(),e)}function E1t(t){return new wf(t.readTime,t.key,-1)}class wf{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new wf(Dt.min(),ht.empty(),-1)}static max(){return new wf(Dt.max(),ht.empty(),-1)}}function T1t(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ht.comparator(t.documentKey,e.documentKey),n!==0?n:hn(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I1t="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class P1t{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l1(t){if(t.code!==we.FAILED_PRECONDITION||t.message!==I1t)throw t;lt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&kt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new De((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof De?n:De.resolve(n)}catch(n){return De.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):De.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):De.reject(n)}static resolve(e){return new De((n,r)=>{n(e)})}static reject(e){return new De((n,r)=>{r(e)})}static waitFor(e){return new De((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},l=>r(l))}),o=!0,s===i&&n()})}static or(e){let n=De.resolve(!1);for(const r of e)n=n.next(i=>i?De.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new De((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let l=0;l<s;l++){const c=l;n(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,n){return new De((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}function c1(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d8{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ot(r),this.ut=r=>n.writeSequenceNumber(r))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}d8.ct=-1;function dM(t){return t==null}function g_(t){return t===0&&1/t==-1/0}function _1t(t){return typeof t=="number"&&Number.isInteger(t)&&!g_(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zne(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Gg(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function JCe(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e,n){this.comparator=e,this.root=n||Gi.EMPTY}insert(e,n){return new dr(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Gi.BLACK,null,null))}remove(e){return new dr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gi.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ME(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ME(this.root,e,this.comparator,!1)}getReverseIterator(){return new ME(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ME(this.root,e,this.comparator,!0)}}class ME{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Gi{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??Gi.RED,this.left=i??Gi.EMPTY,this.right=s??Gi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new Gi(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Gi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Gi.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Gi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Gi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw kt();const e=this.left.check();if(e!==this.right.check())throw kt();return e+(this.isRed()?0:1)}}Gi.EMPTY=null,Gi.RED=!0,Gi.BLACK=!1;Gi.EMPTY=new class{constructor(){this.size=0}get key(){throw kt()}get value(){throw kt()}get color(){throw kt()}get left(){throw kt()}get right(){throw kt()}copy(t,e,n,r,i){return this}insert(t,e,n){return new Gi(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e){this.comparator=e,this.data=new dr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Une(this.data.getIterator())}getIteratorFrom(e){return new Une(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof js)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new js(this.comparator);return n.data=e,n}}class Une{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e){this.fields=e,e.sort(ks.comparator)}static empty(){return new Ea([])}unionWith(e){let n=new js(ks.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Ea(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return sv(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZCe extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ZCe("Invalid base64 string: "+i):i}}(e);return new $s(n)}static fromUint8Array(e){const n=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new $s(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return hn(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$s.EMPTY_BYTE_STRING=new $s("");const k1t=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sf(t){if(Kn(!!t),typeof t=="string"){let e=0;const n=k1t.exec(t);if(Kn(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Vr(t.seconds),nanos:Vr(t.nanos)}}function Vr(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ig(t){return typeof t=="string"?$s.fromBase64String(t):$s.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h8(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function f8(t){const e=t.mapValue.fields.__previous_value__;return h8(e)?f8(e):e}function Hw(t){const e=Sf(t.mapValue.fields.__local_write_time__.timestampValue);return new ii(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1t{constructor(e,n,r,i,s,o,a,l,c){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class Vw{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Vw("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Vw&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE={mapValue:{}};function Pg(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?h8(t)?4:M1t(t)?9007199254740991:10:kt()}function Tu(t,e){if(t===e)return!0;const n=Pg(t);if(n!==Pg(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Hw(t).isEqual(Hw(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=Sf(r.timestampValue),o=Sf(i.timestampValue);return s.seconds===o.seconds&&s.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,i){return Ig(r.bytesValue).isEqual(Ig(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,i){return Vr(r.geoPointValue.latitude)===Vr(i.geoPointValue.latitude)&&Vr(r.geoPointValue.longitude)===Vr(i.geoPointValue.longitude)}(t,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return Vr(r.integerValue)===Vr(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=Vr(r.doubleValue),o=Vr(i.doubleValue);return s===o?g_(s)===g_(o):isNaN(s)&&isNaN(o)}return!1}(t,e);case 9:return sv(t.arrayValue.values||[],e.arrayValue.values||[],Tu);case 10:return function(r,i){const s=r.mapValue.fields||{},o=i.mapValue.fields||{};if(zne(s)!==zne(o))return!1;for(const a in s)if(s.hasOwnProperty(a)&&(o[a]===void 0||!Tu(s[a],o[a])))return!1;return!0}(t,e);default:return kt()}}function Ww(t,e){return(t.values||[]).find(n=>Tu(n,e))!==void 0}function ov(t,e){if(t===e)return 0;const n=Pg(t),r=Pg(e);if(n!==r)return hn(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return hn(t.booleanValue,e.booleanValue);case 2:return function(i,s){const o=Vr(i.integerValue||i.doubleValue),a=Vr(s.integerValue||s.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(t,e);case 3:return Hne(t.timestampValue,e.timestampValue);case 4:return Hne(Hw(t),Hw(e));case 5:return hn(t.stringValue,e.stringValue);case 6:return function(i,s){const o=Ig(i),a=Ig(s);return o.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(i,s){const o=i.split("/"),a=s.split("/");for(let l=0;l<o.length&&l<a.length;l++){const c=hn(o[l],a[l]);if(c!==0)return c}return hn(o.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,s){const o=hn(Vr(i.latitude),Vr(s.latitude));return o!==0?o:hn(Vr(i.longitude),Vr(s.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(i,s){const o=i.values||[],a=s.values||[];for(let l=0;l<o.length&&l<a.length;++l){const c=ov(o[l],a[l]);if(c)return c}return hn(o.length,a.length)}(t.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===OE.mapValue&&s===OE.mapValue)return 0;if(i===OE.mapValue)return 1;if(s===OE.mapValue)return-1;const o=i.fields||{},a=Object.keys(o),l=s.fields||{},c=Object.keys(l);a.sort(),c.sort();for(let u=0;u<a.length&&u<c.length;++u){const d=hn(a[u],c[u]);if(d!==0)return d;const h=ov(o[a[u]],l[c[u]]);if(h!==0)return h}return hn(a.length,c.length)}(t.mapValue,e.mapValue);default:throw kt()}}function Hne(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return hn(t,e);const n=Sf(t),r=Sf(e),i=hn(n.seconds,r.seconds);return i!==0?i:hn(n.nanos,r.nanos)}function av(t){return RB(t)}function RB(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const i=Sf(r);return`time(${i.seconds},${i.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Ig(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ht.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(r){let i="[",s=!0;for(const o of r.values||[])s?s=!1:i+=",",i+=RB(o);return i+"]"}(t.arrayValue):"mapValue"in t?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",o=!0;for(const a of i)o?o=!1:s+=",",s+=`${a}:${RB(r.fields[a])}`;return s+"}"}(t.mapValue):kt();var e,n}function Vne(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function NB(t){return!!t&&"integerValue"in t}function p8(t){return!!t&&"arrayValue"in t}function Wne(t){return!!t&&"nullValue"in t}function Kne(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ET(t){return!!t&&"mapValue"in t}function Tx(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Gg(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Tx(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Tx(t.arrayValue.values[n]);return e}return Object.assign({},t)}function M1t(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e){this.value=e}static empty(){return new qo({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!ET(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Tx(n)}setAll(e){let n=ks.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=Tx(o):i.push(a.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());ET(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Tu(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];ET(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Gg(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new qo(Tx(this.value))}}function QCe(t){const e=[];return Gg(t.fields,(n,r)=>{const i=new ks([n]);if(ET(r)){const s=QCe(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Ea(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new _s(e,0,Dt.min(),Dt.min(),Dt.min(),qo.empty(),0)}static newFoundDocument(e,n,r,i){return new _s(e,1,n,Dt.min(),r,i,0)}static newNoDocument(e,n){return new _s(e,2,n,Dt.min(),Dt.min(),qo.empty(),0)}static newUnknownDocument(e,n){return new _s(e,3,n,Dt.min(),Dt.min(),qo.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Dt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=qo.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=qo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Dt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof _s&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _s(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e,n){this.position=e,this.inclusive=n}}function qne(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(s.field.isKeyField()?r=ht.comparator(ht.fromName(o.referenceValue),n.key):r=ov(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Gne(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Tu(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ix{constructor(e,n="asc"){this.field=e,this.dir=n}}function O1t(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eEe{}class Kr extends eEe{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new R1t(e,n,r):n==="array-contains"?new L1t(e,r):n==="in"?new F1t(e,r):n==="not-in"?new $1t(e,r):n==="array-contains-any"?new B1t(e,r):new Kr(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new N1t(e,r):new j1t(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(ov(n,this.value)):n!==null&&Pg(this.value)===Pg(n)&&this.matchesComparison(ov(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return kt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Ic extends eEe{constructor(e,n){super(),this.filters=e,this.op=n,this.lt=null}static create(e,n){return new Ic(e,n)}matches(e){return tEe(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.lt!==null||(this.lt=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft(n=>n.isInequality());return e!==null?e.field:null}ft(e){for(const n of this.getFlattenedFilters())if(e(n))return n;return null}}function tEe(t){return t.op==="and"}function nEe(t){return D1t(t)&&tEe(t)}function D1t(t){for(const e of t.filters)if(e instanceof Ic)return!1;return!0}function jB(t){if(t instanceof Kr)return t.field.canonicalString()+t.op.toString()+av(t.value);if(nEe(t))return t.filters.map(e=>jB(e)).join(",");{const e=t.filters.map(n=>jB(n)).join(",");return`${t.op}(${e})`}}function rEe(t,e){return t instanceof Kr?function(n,r){return r instanceof Kr&&n.op===r.op&&n.field.isEqual(r.field)&&Tu(n.value,r.value)}(t,e):t instanceof Ic?function(n,r){return r instanceof Ic&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce((i,s,o)=>i&&rEe(s,r.filters[o]),!0):!1}(t,e):void kt()}function iEe(t){return t instanceof Kr?function(e){return`${e.field.canonicalString()} ${e.op} ${av(e.value)}`}(t):t instanceof Ic?function(e){return e.op.toString()+" {"+e.getFilters().map(iEe).join(" ,")+"}"}(t):"Filter"}class R1t extends Kr{constructor(e,n,r){super(e,n,r),this.key=ht.fromName(r.referenceValue)}matches(e){const n=ht.comparator(e.key,this.key);return this.matchesComparison(n)}}class N1t extends Kr{constructor(e,n){super(e,"in",n),this.keys=sEe("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class j1t extends Kr{constructor(e,n){super(e,"not-in",n),this.keys=sEe("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function sEe(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>ht.fromName(r.referenceValue))}class L1t extends Kr{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return p8(n)&&Ww(n.arrayValue,this.value)}}class F1t extends Kr{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Ww(this.value.arrayValue,n)}}class $1t extends Kr{constructor(e,n){super(e,"not-in",n)}matches(e){if(Ww(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Ww(this.value.arrayValue,n)}}class B1t extends Kr{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!p8(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Ww(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1t{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.dt=null}}function Yne(t,e=null,n=[],r=[],i=null,s=null,o=null){return new z1t(t,e,n,r,i,s,o)}function g8(t){const e=Lt(t);if(e.dt===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>jB(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),dM(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>av(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>av(r)).join(",")),e.dt=n}return e.dt}function m8(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!O1t(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!rEe(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Gne(t.startAt,e.startAt)&&Gne(t.endAt,e.endAt)}function LB(t){return ht.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.wt=null,this._t=null,this.startAt,this.endAt}}function U1t(t,e,n,r,i,s,o,a){return new u1(t,e,n,r,i,s,o,a)}function y8(t){return new u1(t)}function Xne(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function oEe(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function v8(t){for(const e of t.filters){const n=e.getFirstInequalityField();if(n!==null)return n}return null}function aEe(t){return t.collectionGroup!==null}function Cy(t){const e=Lt(t);if(e.wt===null){e.wt=[];const n=v8(e),r=oEe(e);if(n!==null&&r===null)n.isKeyField()||e.wt.push(new Ix(n)),e.wt.push(new Ix(ks.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.wt.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new Ix(ks.keyField(),s))}}}return e.wt}function Md(t){const e=Lt(t);if(!e._t)if(e.limitType==="F")e._t=Yne(e.path,e.collectionGroup,Cy(e),e.filters,e.limit,e.startAt,e.endAt);else{const n=[];for(const s of Cy(e)){const o=s.dir==="desc"?"asc":"desc";n.push(new Ix(s.field,o))}const r=e.endAt?new m_(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new m_(e.startAt.position,e.startAt.inclusive):null;e._t=Yne(e.path,e.collectionGroup,n,e.filters,e.limit,r,i)}return e._t}function FB(t,e){e.getFirstInequalityField(),v8(t);const n=t.filters.concat([e]);return new u1(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function $B(t,e,n){return new u1(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function hM(t,e){return m8(Md(t),Md(e))&&t.limitType===e.limitType}function lEe(t){return`${g8(Md(t))}|lt:${t.limitType}`}function BB(t){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(r=>iEe(r)).join(", ")}]`),dM(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(r=>function(i){return`${i.field.canonicalString()} (${i.dir})`}(r)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>av(r)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>av(r)).join(",")),`Target(${n})`}(Md(t))}; limitType=${t.limitType})`}function fM(t,e){return e.isFoundDocument()&&function(n,r){const i=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):ht.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(t,e)&&function(n,r){for(const i of Cy(n))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(t,e)&&function(n,r){for(const i of n.filters)if(!i.matches(r))return!1;return!0}(t,e)&&function(n,r){return!(n.startAt&&!function(i,s,o){const a=qne(i,s,o);return i.inclusive?a<=0:a<0}(n.startAt,Cy(n),r)||n.endAt&&!function(i,s,o){const a=qne(i,s,o);return i.inclusive?a>=0:a>0}(n.endAt,Cy(n),r))}(t,e)}function H1t(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function cEe(t){return(e,n)=>{let r=!1;for(const i of Cy(t)){const s=V1t(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function V1t(t,e,n){const r=t.field.isKeyField()?ht.comparator(e.key,n.key):function(i,s,o){const a=s.data.field(i),l=o.data.field(i);return a!==null&&l!==null?ov(a,l):kt()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return kt()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qv=class{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Gg(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return JCe(this.inner)}size(){return this.innerSize}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W1t=new dr(ht.comparator);function Od(){return W1t}const uEe=new dr(ht.comparator);function Jb(...t){let e=uEe;for(const n of t)e=e.insert(n.key,n);return e}function dEe(t){let e=uEe;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Lp(){return Px()}function hEe(){return Px()}function Px(){return new Qv(t=>t.toString(),(t,e)=>t.isEqual(e))}const K1t=new dr(ht.comparator),q1t=new js(ht.comparator);function Xt(...t){let e=q1t;for(const n of t)e=e.add(n);return e}const G1t=new js(hn);function Y1t(){return G1t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fEe(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:g_(e)?"-0":e}}function pEe(t){return{integerValue:""+t}}function X1t(t,e){return _1t(e)?pEe(e):fEe(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pM{constructor(){this._=void 0}}function J1t(t,e,n){return t instanceof y_?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&h8(i)&&(i=f8(i)),i&&(s.fields.__previous_value__=i),{mapValue:s}}(n,e):t instanceof Kw?mEe(t,e):t instanceof qw?yEe(t,e):function(r,i){const s=gEe(r,i),o=Jne(s)+Jne(r.gt);return NB(s)&&NB(r.gt)?pEe(o):fEe(r.serializer,o)}(t,e)}function Z1t(t,e,n){return t instanceof Kw?mEe(t,e):t instanceof qw?yEe(t,e):n}function gEe(t,e){return t instanceof v_?NB(n=e)||function(r){return!!r&&"doubleValue"in r}(n)?e:{integerValue:0}:null;var n}class y_ extends pM{}class Kw extends pM{constructor(e){super(),this.elements=e}}function mEe(t,e){const n=vEe(e);for(const r of t.elements)n.some(i=>Tu(i,r))||n.push(r);return{arrayValue:{values:n}}}class qw extends pM{constructor(e){super(),this.elements=e}}function yEe(t,e){let n=vEe(e);for(const r of t.elements)n=n.filter(i=>!Tu(i,r));return{arrayValue:{values:n}}}class v_ extends pM{constructor(e,n){super(),this.serializer=e,this.gt=n}}function Jne(t){return Vr(t.integerValue||t.doubleValue)}function vEe(t){return p8(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Q1t(t,e){return t.field.isEqual(e.field)&&function(n,r){return n instanceof Kw&&r instanceof Kw||n instanceof qw&&r instanceof qw?sv(n.elements,r.elements,Tu):n instanceof v_&&r instanceof v_?Tu(n.gt,r.gt):n instanceof y_&&r instanceof y_}(t.transform,e.transform)}class eCt{constructor(e,n){this.version=e,this.transformResults=n}}class kl{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new kl}static exists(e){return new kl(void 0,e)}static updateTime(e){return new kl(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function TT(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class gM{}function bEe(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new b8(t.key,kl.none()):new d1(t.key,t.data,kl.none());{const n=t.data,r=qo.empty();let i=new js(ks.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Kf(t.key,r,new Ea(i.toArray()),kl.none())}}function tCt(t,e,n){t instanceof d1?function(r,i,s){const o=r.value.clone(),a=Qne(r.fieldTransforms,i,s.transformResults);o.setAll(a),i.convertToFoundDocument(s.version,o).setHasCommittedMutations()}(t,e,n):t instanceof Kf?function(r,i,s){if(!TT(r.precondition,i))return void i.convertToUnknownDocument(s.version);const o=Qne(r.fieldTransforms,i,s.transformResults),a=i.data;a.setAll(xEe(r)),a.setAll(o),i.convertToFoundDocument(s.version,a).setHasCommittedMutations()}(t,e,n):function(r,i,s){i.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,n)}function _x(t,e,n,r){return t instanceof d1?function(i,s,o,a){if(!TT(i.precondition,s))return o;const l=i.value.clone(),c=ere(i.fieldTransforms,a,s);return l.setAll(c),s.convertToFoundDocument(s.version,l).setHasLocalMutations(),null}(t,e,n,r):t instanceof Kf?function(i,s,o,a){if(!TT(i.precondition,s))return o;const l=ere(i.fieldTransforms,a,s),c=s.data;return c.setAll(xEe(i)),c.setAll(l),s.convertToFoundDocument(s.version,c).setHasLocalMutations(),o===null?null:o.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(u=>u.field))}(t,e,n,r):function(i,s,o){return TT(i.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):o}(t,e,n)}function nCt(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),s=gEe(r.transform,i||null);s!=null&&(n===null&&(n=qo.empty()),n.set(r.field,s))}return n||null}function Zne(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&sv(n,r,(i,s)=>Q1t(i,s))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class d1 extends gM{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Kf extends gM{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function xEe(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Qne(t,e,n){const r=new Map;Kn(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Z1t(o,a,n[i]))}return r}function ere(t,e,n){const r=new Map;for(const i of t){const s=i.transform,o=n.data.field(i.field);r.set(i.field,J1t(s,o,e))}return r}class b8 extends gM{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class rCt extends gM{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iCt{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&tCt(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=_x(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=_x(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=hEe();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;const l=bEe(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(Dt.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Xt())}isEqual(e){return this.batchId===e.batchId&&sv(this.mutations,e.mutations,(n,r)=>Zne(n,r))&&sv(this.baseMutations,e.baseMutations,(n,r)=>Zne(n,r))}}class x8{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){Kn(e.mutations.length===r.length);let i=K1t;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new x8(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sCt{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oCt{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Br,Qt;function aCt(t){switch(t){default:return kt();case we.CANCELLED:case we.UNKNOWN:case we.DEADLINE_EXCEEDED:case we.RESOURCE_EXHAUSTED:case we.INTERNAL:case we.UNAVAILABLE:case we.UNAUTHENTICATED:return!1;case we.INVALID_ARGUMENT:case we.NOT_FOUND:case we.ALREADY_EXISTS:case we.PERMISSION_DENIED:case we.FAILED_PRECONDITION:case we.ABORTED:case we.OUT_OF_RANGE:case we.UNIMPLEMENTED:case we.DATA_LOSS:return!0}}function wEe(t){if(t===void 0)return Ad("GRPC error has no .code"),we.UNKNOWN;switch(t){case Br.OK:return we.OK;case Br.CANCELLED:return we.CANCELLED;case Br.UNKNOWN:return we.UNKNOWN;case Br.DEADLINE_EXCEEDED:return we.DEADLINE_EXCEEDED;case Br.RESOURCE_EXHAUSTED:return we.RESOURCE_EXHAUSTED;case Br.INTERNAL:return we.INTERNAL;case Br.UNAVAILABLE:return we.UNAVAILABLE;case Br.UNAUTHENTICATED:return we.UNAUTHENTICATED;case Br.INVALID_ARGUMENT:return we.INVALID_ARGUMENT;case Br.NOT_FOUND:return we.NOT_FOUND;case Br.ALREADY_EXISTS:return we.ALREADY_EXISTS;case Br.PERMISSION_DENIED:return we.PERMISSION_DENIED;case Br.FAILED_PRECONDITION:return we.FAILED_PRECONDITION;case Br.ABORTED:return we.ABORTED;case Br.OUT_OF_RANGE:return we.OUT_OF_RANGE;case Br.UNIMPLEMENTED:return we.UNIMPLEMENTED;case Br.DATA_LOSS:return we.DATA_LOSS;default:return kt()}}(Qt=Br||(Br={}))[Qt.OK=0]="OK",Qt[Qt.CANCELLED=1]="CANCELLED",Qt[Qt.UNKNOWN=2]="UNKNOWN",Qt[Qt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qt[Qt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qt[Qt.NOT_FOUND=5]="NOT_FOUND",Qt[Qt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qt[Qt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qt[Qt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qt[Qt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qt[Qt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qt[Qt.ABORTED=10]="ABORTED",Qt[Qt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qt[Qt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qt[Qt.INTERNAL=13]="INTERNAL",Qt[Qt.UNAVAILABLE=14]="UNAVAILABLE",Qt[Qt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w8{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return DE}static getOrCreateInstance(){return DE===null&&(DE=new w8),DE}onExistenceFilterMismatch(e){const n=Symbol();return this.onExistenceFilterMismatchCallbacks.set(n,e),()=>this.onExistenceFilterMismatchCallbacks.delete(n)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(n=>n(e))}}let DE=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lCt(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cCt=new Sy([4294967295,4294967295],0);function tre(t){const e=lCt().encode(t),n=new f1t;return n.update(e),new Uint8Array(n.digest())}function nre(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Sy([n,r],0),new Sy([i,s],0)]}class S8{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Zb(`Invalid padding: ${n}`);if(r<0)throw new Zb(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Zb(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Zb(`Invalid padding when bitmap length is 0: ${n}`);this.It=8*e.length-n,this.Tt=Sy.fromNumber(this.It)}Et(e,n,r){let i=e.add(n.multiply(Sy.fromNumber(r)));return i.compare(cCt)===1&&(i=new Sy([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}vt(e){if(this.It===0)return!1;const n=tre(e),[r,i]=nre(n);for(let s=0;s<this.hashCount;s++){const o=this.Et(r,i,s);if(!this.At(o))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new S8(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.It===0)return;const n=tre(e),[r,i]=nre(n);for(let s=0;s<this.hashCount;s++){const o=this.Et(r,i,s);this.Rt(o)}}Rt(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Zb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mM{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,h1.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new mM(Dt.min(),i,new dr(hn),Od(),Xt())}}class h1{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new h1(r,n,Xt(),Xt(),Xt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IT{constructor(e,n,r,i){this.Pt=e,this.removedTargetIds=n,this.key=r,this.bt=i}}class SEe{constructor(e,n){this.targetId=e,this.Vt=n}}class CEe{constructor(e,n,r=$s.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class rre{constructor(){this.St=0,this.Dt=sre(),this.Ct=$s.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return this.St!==0}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=Xt(),n=Xt(),r=Xt();return this.Dt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:kt()}}),new h1(this.Ct,this.xt,e,n,r)}Ft(){this.Nt=!1,this.Dt=sre()}Bt(e,n){this.Nt=!0,this.Dt=this.Dt.insert(e,n)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class uCt{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Od(),this.zt=ire(),this.Wt=new dr(hn)}Ht(e){for(const n of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(n,e.bt):this.Yt(n,e.key,e.bt);for(const n of e.removedTargetIds)this.Yt(n,e.key,e.bt)}Xt(e){this.forEachTarget(e,n=>{const r=this.Zt(n);switch(e.state){case 0:this.te(n)&&r.$t(e.resumeToken);break;case 1:r.Ut(),r.kt||r.Ft(),r.$t(e.resumeToken);break;case 2:r.Ut(),r.kt||this.removeTarget(n);break;case 3:this.te(n)&&(r.Kt(),r.$t(e.resumeToken));break;case 4:this.te(n)&&(this.ee(n),r.$t(e.resumeToken));break;default:kt()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Qt.forEach((r,i)=>{this.te(i)&&n(i)})}ne(e){var n;const r=e.targetId,i=e.Vt.count,s=this.se(r);if(s){const o=s.target;if(LB(o))if(i===0){const a=new ht(o.path);this.Yt(r,a,_s.newNoDocument(a,Dt.min()))}else Kn(i===1);else{const a=this.ie(r);if(a!==i){const l=this.re(e,a);if(l!==0){this.ee(r);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(r,c)}(n=w8.instance)===null||n===void 0||n.notifyOnExistenceFilterMismatch(function(c,u,d){var h,f,y,b,v,x;const C={localCacheCount:u,existenceFilterCount:d.count},E=d.unchangedNames;return E&&(C.bloomFilter={applied:c===0,hashCount:(h=E==null?void 0:E.hashCount)!==null&&h!==void 0?h:0,bitmapLength:(b=(y=(f=E==null?void 0:E.bits)===null||f===void 0?void 0:f.bitmap)===null||y===void 0?void 0:y.length)!==null&&b!==void 0?b:0,padding:(x=(v=E==null?void 0:E.bits)===null||v===void 0?void 0:v.padding)!==null&&x!==void 0?x:0}),C}(l,a,e.Vt))}}}}re(e,n){const{unchangedNames:r,count:i}=e.Vt;if(!r||!r.bits)return 1;const{bits:{bitmap:s="",padding:o=0},hashCount:a=0}=r;let l,c;try{l=Ig(s).toUint8Array()}catch(u){if(u instanceof ZCe)return iv("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw u}try{c=new S8(l,o,a)}catch(u){return iv(u instanceof Zb?"BloomFilter error: ":"Applying bloom filter failed: ",u),1}return c.It===0?1:i!==n-this.oe(e.targetId,c)?2:0}oe(e,n){const r=this.Gt.getRemoteKeysForTarget(e);let i=0;return r.forEach(s=>{const o=this.Gt.ue(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;n.vt(a)||(this.Yt(e,s,null),i++)}),i}ce(e){const n=new Map;this.Qt.forEach((s,o)=>{const a=this.se(o);if(a){if(s.current&&LB(a.target)){const l=new ht(a.target.path);this.jt.get(l)!==null||this.ae(o,l)||this.Yt(o,l,_s.newNoDocument(l,e))}s.Mt&&(n.set(o,s.Ot()),s.Ft())}});let r=Xt();this.zt.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.se(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.jt.forEach((s,o)=>o.setReadTime(e));const i=new mM(e,n,this.Wt,this.jt,r);return this.jt=Od(),this.zt=ire(),this.Wt=new dr(hn),i}Jt(e,n){if(!this.te(e))return;const r=this.ae(e,n.key)?2:0;this.Zt(e).Bt(n.key,r),this.jt=this.jt.insert(n.key,n),this.zt=this.zt.insert(n.key,this.he(n.key).add(e))}Yt(e,n,r){if(!this.te(e))return;const i=this.Zt(e);this.ae(e,n)?i.Bt(n,1):i.Lt(n),this.zt=this.zt.insert(n,this.he(n).delete(e)),r&&(this.jt=this.jt.insert(n,r))}removeTarget(e){this.Qt.delete(e)}ie(e){const n=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let n=this.Qt.get(e);return n||(n=new rre,this.Qt.set(e,n)),n}he(e){let n=this.zt.get(e);return n||(n=new js(hn),this.zt=this.zt.insert(e,n)),n}te(e){const n=this.se(e)!==null;return n||lt("WatchChangeAggregator","Detected inactive target",e),n}se(e){const n=this.Qt.get(e);return n&&n.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new rre),this.Gt.getRemoteKeysForTarget(e).forEach(n=>{this.Yt(e,n,null)})}ae(e,n){return this.Gt.getRemoteKeysForTarget(e).has(n)}}function ire(){return new dr(ht.comparator)}function sre(){return new dr(ht.comparator)}const dCt={asc:"ASCENDING",desc:"DESCENDING"},hCt={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fCt={and:"AND",or:"OR"};class pCt{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function zB(t,e){return t.useProto3Json||dM(e)?e:{value:e}}function b_(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function EEe(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function gCt(t,e){return b_(t,e.toTimestamp())}function gu(t){return Kn(!!t),Dt.fromTimestamp(function(e){const n=Sf(e);return new ii(n.seconds,n.nanos)}(t))}function C8(t,e){return function(n){return new Wn(["projects",n.projectId,"databases",n.database])}(t).child("documents").child(e).canonicalString()}function TEe(t){const e=Wn.fromString(t);return Kn(kEe(e)),e}function UB(t,e){return C8(t.databaseId,e.path)}function YL(t,e){const n=TEe(e);if(n.get(1)!==t.databaseId.projectId)throw new Ye(we.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ye(we.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ht(IEe(n))}function HB(t,e){return C8(t.databaseId,e)}function mCt(t){const e=TEe(t);return e.length===4?Wn.emptyPath():IEe(e)}function VB(t){return new Wn(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function IEe(t){return Kn(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function ore(t,e,n){return{name:UB(t,e),fields:n.value.mapValue.fields}}function yCt(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:kt()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,c){return l.useProto3Json?(Kn(c===void 0||typeof c=="string"),$s.fromBase64String(c||"")):(Kn(c===void 0||c instanceof Uint8Array),$s.fromUint8Array(c||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const c=l.code===void 0?we.UNKNOWN:wEe(l.code);return new Ye(c,l.message||"")}(o);n=new CEe(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=YL(t,r.document.name),s=gu(r.document.updateTime),o=r.document.createTime?gu(r.document.createTime):Dt.min(),a=new qo({mapValue:{fields:r.document.fields}}),l=_s.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];n=new IT(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=YL(t,r.document),s=r.readTime?gu(r.readTime):Dt.min(),o=_s.newNoDocument(i,s),a=r.removedTargetIds||[];n=new IT([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=YL(t,r.document),s=r.removedTargetIds||[];n=new IT([],s,i,null)}else{if(!("filter"in e))return kt();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new oCt(i,s),a=r.targetId;n=new SEe(a,o)}}return n}function vCt(t,e){let n;if(e instanceof d1)n={update:ore(t,e.key,e.value)};else if(e instanceof b8)n={delete:UB(t,e.key)};else if(e instanceof Kf)n={update:ore(t,e.key,e.data),updateMask:PCt(e.fieldMask)};else{if(!(e instanceof rCt))return kt();n={verify:UB(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const o=s.transform;if(o instanceof y_)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Kw)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof qw)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof v_)return{fieldPath:s.field.canonicalString(),increment:o.gt};throw kt()}(0,r))),e.precondition.isNone||(n.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:gCt(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:kt()}(t,e.precondition)),n}function bCt(t,e){return t&&t.length>0?(Kn(e!==void 0),t.map(n=>function(r,i){let s=r.updateTime?gu(r.updateTime):gu(i);return s.isEqual(Dt.min())&&(s=gu(i)),new eCt(s,r.transformResults||[])}(n,e))):[]}function xCt(t,e){return{documents:[HB(t,e.path)]}}function wCt(t,e){const n={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(n.parent=HB(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=HB(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(l){if(l.length!==0)return _Ee(Ic.create(l,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const s=function(l){if(l.length!==0)return l.map(c=>function(u){return{field:Gm(u.field),direction:ECt(u.dir)}}(c))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=zB(t,e.limit);var a;return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),n}function SCt(t){let e=mCt(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Kn(r===1);const u=n.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];n.where&&(s=function(u){const d=PEe(u);return d instanceof Ic&&nEe(d)?d.getFilters():[d]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(u=>function(d){return new Ix(Ym(d.field),function(h){switch(h){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(d.direction))}(u)));let a=null;n.limit&&(a=function(u){let d;return d=typeof u=="object"?u.value:u,dM(d)?null:d}(n.limit));let l=null;n.startAt&&(l=function(u){const d=!!u.before,h=u.values||[];return new m_(h,d)}(n.startAt));let c=null;return n.endAt&&(c=function(u){const d=!u.before,h=u.values||[];return new m_(h,d)}(n.endAt)),U1t(e,i,o,s,a,"F",l,c)}function CCt(t,e){const n=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return kt()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function PEe(t){return t.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=Ym(e.unaryFilter.field);return Kr.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=Ym(e.unaryFilter.field);return Kr.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ym(e.unaryFilter.field);return Kr.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Ym(e.unaryFilter.field);return Kr.create(s,"!=",{nullValue:"NULL_VALUE"});default:return kt()}}(t):t.fieldFilter!==void 0?function(e){return Kr.create(Ym(e.fieldFilter.field),function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return kt()}}(e.fieldFilter.op),e.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(e){return Ic.create(e.compositeFilter.filters.map(n=>PEe(n)),function(n){switch(n){case"AND":return"and";case"OR":return"or";default:return kt()}}(e.compositeFilter.op))}(t):kt()}function ECt(t){return dCt[t]}function TCt(t){return hCt[t]}function ICt(t){return fCt[t]}function Gm(t){return{fieldPath:t.canonicalString()}}function Ym(t){return ks.fromServerFormat(t.fieldPath)}function _Ee(t){return t instanceof Kr?function(e){if(e.op==="=="){if(Kne(e.value))return{unaryFilter:{field:Gm(e.field),op:"IS_NAN"}};if(Wne(e.value))return{unaryFilter:{field:Gm(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Kne(e.value))return{unaryFilter:{field:Gm(e.field),op:"IS_NOT_NAN"}};if(Wne(e.value))return{unaryFilter:{field:Gm(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gm(e.field),op:TCt(e.op),value:e.value}}}(t):t instanceof Ic?function(e){const n=e.getFilters().map(r=>_Ee(r));return n.length===1?n[0]:{compositeFilter:{op:ICt(e.op),filters:n}}}(t):kt()}function PCt(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function kEe(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(e,n,r,i,s=Dt.min(),o=Dt.min(),a=$s.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Jh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Jh(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Jh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Jh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _Ct{constructor(e){this.fe=e}}function kCt(t){const e=SCt({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?$B(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ACt{constructor(){this.rn=new MCt}addToCollectionParentIndex(e,n){return this.rn.add(n),De.resolve()}getCollectionParents(e,n){return De.resolve(this.rn.getEntries(n))}addFieldIndex(e,n){return De.resolve()}deleteFieldIndex(e,n){return De.resolve()}getDocumentsMatchingTarget(e,n){return De.resolve(null)}getIndexType(e,n){return De.resolve(0)}getFieldIndexes(e,n){return De.resolve([])}getNextCollectionGroupToUpdate(e){return De.resolve(null)}getMinOffset(e,n){return De.resolve(wf.min())}getMinOffsetFromCollectionGroup(e,n){return De.resolve(wf.min())}updateCollectionGroup(e,n,r){return De.resolve()}updateIndexEntries(e,n){return De.resolve()}}class MCt{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new js(Wn.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new js(Wn.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new lv(0)}static Mn(){return new lv(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OCt{constructor(){this.changes=new Qv(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,_s.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?De.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DCt{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RCt{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&_x(r.mutation,i,Ea.empty(),ii.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Xt()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Xt()){const i=Lp();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=Jb();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=Lp();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Xt()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=Od();const o=Px(),a=Px();return n.forEach((l,c)=>{const u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof Kf)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),_x(u.mutation,c,u.mutation.getFieldMask(),ii.now())):o.set(c.key,Ea.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),n.forEach((c,u)=>{var d;return a.set(c,new DCt(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,n){const r=Px();let i=new dr((o,a)=>o-a),s=Xt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=n.get(l);if(c===null)return;let u=r.get(l)||Ea.empty();u=a.applyToLocalView(c,u),r.set(l,u);const d=(i.get(a.batchId)||Xt()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,d=hEe();u.forEach(h=>{if(!s.has(h)){const f=bEe(n.get(h),r.get(h));f!==null&&d.set(h,f),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return De.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r){return function(i){return ht.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):aEe(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r):this.getDocumentsMatchingCollectionQuery(e,n,r)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):De.resolve(Lp());let a=-1,l=s;return o.next(c=>De.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?De.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{l=l.insert(u,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Xt())).next(u=>({batchId:a,changes:dEe(u)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ht(n)).next(r=>{let i=Jb();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r){const i=n.collectionGroup;let s=Jb();return this.indexManager.getCollectionParents(e,i).next(o=>De.forEach(o,a=>{const l=function(c,u){return new u1(u,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(n,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,l,r).next(c=>{c.forEach((u,d)=>{s=s.insert(u,d)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i))).next(s=>{i.forEach((a,l)=>{const c=l.getKey();s.get(c)===null&&(s=s.insert(c,_s.newInvalidDocument(c)))});let o=Jb();return s.forEach((a,l)=>{const c=i.get(a);c!==void 0&&_x(c.mutation,l,Ea.empty(),ii.now()),fM(n,l)&&(o=o.insert(a,l))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NCt{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,n){return De.resolve(this.cs.get(n))}saveBundleMetadata(e,n){var r;return this.cs.set(n.id,{id:(r=n).id,version:r.version,createTime:gu(r.createTime)}),De.resolve()}getNamedQuery(e,n){return De.resolve(this.hs.get(n))}saveNamedQuery(e,n){return this.hs.set(n.name,function(r){return{name:r.name,query:kCt(r.bundledQuery),readTime:gu(r.readTime)}}(n)),De.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jCt{constructor(){this.overlays=new dr(ht.comparator),this.ls=new Map}getOverlay(e,n){return De.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Lp();return De.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.we(e,n,s)}),De.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.ls.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.ls.delete(r)),De.resolve()}getOverlaysForCollection(e,n,r){const i=Lp(),s=n.length+1,o=new ht(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!n.isPrefixOf(c.path))break;c.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return De.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new dr((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===n&&c.largestBatchId>r){let u=s.get(c.largestBatchId);u===null&&(u=Lp(),s=s.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=Lp(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=i)););return De.resolve(a)}we(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.ls.get(i.largestBatchId).delete(r.key);this.ls.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new sCt(n,r));let s=this.ls.get(n);s===void 0&&(s=Xt(),this.ls.set(n,s)),this.ls.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E8{constructor(){this.fs=new js(bi.ds),this.ws=new js(bi._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,n){const r=new bi(e,n);this.fs=this.fs.add(r),this.ws=this.ws.add(r)}gs(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.ys(new bi(e,n))}ps(e,n){e.forEach(r=>this.removeReference(r,n))}Is(e){const n=new ht(new Wn([])),r=new bi(n,e),i=new bi(n,e+1),s=[];return this.ws.forEachInRange([r,i],o=>{this.ys(o),s.push(o.key)}),s}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const n=new ht(new Wn([])),r=new bi(n,e),i=new bi(n,e+1);let s=Xt();return this.ws.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const n=new bi(e,0),r=this.fs.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class bi{constructor(e,n){this.key=e,this.As=n}static ds(e,n){return ht.comparator(e.key,n.key)||hn(e.As,n.As)}static _s(e,n){return hn(e.As,n.As)||ht.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LCt{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.vs=1,this.Rs=new js(bi.ds)}checkEmpty(e){return De.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new iCt(s,n,r,i);this.mutationQueue.push(o);for(const a of i)this.Rs=this.Rs.add(new bi(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return De.resolve(o)}lookupMutationBatch(e,n){return De.resolve(this.Ps(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.bs(r),s=i<0?0:i;return De.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return De.resolve(this.mutationQueue.length===0?-1:this.vs-1)}getAllMutationBatches(e){return De.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new bi(n,0),i=new bi(n,Number.POSITIVE_INFINITY),s=[];return this.Rs.forEachInRange([r,i],o=>{const a=this.Ps(o.As);s.push(a)}),De.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new js(hn);return n.forEach(i=>{const s=new bi(i,0),o=new bi(i,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([s,o],a=>{r=r.add(a.As)})}),De.resolve(this.Vs(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;ht.isDocumentKey(s)||(s=s.child(""));const o=new bi(new ht(s),0);let a=new js(hn);return this.Rs.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(l.As)),!0)},o),De.resolve(this.Vs(a))}Vs(e){const n=[];return e.forEach(r=>{const i=this.Ps(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){Kn(this.Ss(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Rs;return De.forEach(n.mutations,i=>{const s=new bi(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Rs=r})}Cn(e){}containsKey(e,n){const r=new bi(n,0),i=this.Rs.firstAfterOrEqual(r);return De.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,De.resolve()}Ss(e,n){return this.bs(e)}bs(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Ps(e){const n=this.bs(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FCt{constructor(e){this.Ds=e,this.docs=new dr(ht.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.Ds(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return De.resolve(r?r.document.mutableCopy():_s.newInvalidDocument(n))}getEntries(e,n){let r=Od();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():_s.newInvalidDocument(i))}),De.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=Od();const o=n.path,a=new ht(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||T1t(E1t(u),r)<=0||(i.has(u.key)||fM(n,u))&&(s=s.insert(u.key,u.mutableCopy()))}return De.resolve(s)}getAllFromCollectionGroup(e,n,r,i){kt()}Cs(e,n){return De.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new $Ct(this)}getSize(e){return De.resolve(this.size)}}class $Ct extends OCt{constructor(e){super(),this.os=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.os.addEntry(e,i)):this.os.removeEntry(r)}),De.waitFor(n)}getFromCache(e,n){return this.os.getEntry(e,n)}getAllFromCache(e,n){return this.os.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BCt{constructor(e){this.persistence=e,this.xs=new Qv(n=>g8(n),m8),this.lastRemoteSnapshotVersion=Dt.min(),this.highestTargetId=0,this.Ns=0,this.ks=new E8,this.targetCount=0,this.Ms=lv.kn()}forEachTarget(e,n){return this.xs.forEach((r,i)=>n(i)),De.resolve()}getLastRemoteSnapshotVersion(e){return De.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return De.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),De.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Ns&&(this.Ns=n),De.resolve()}Fn(e){this.xs.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Ms=new lv(n),this.highestTargetId=n),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,n){return this.Fn(n),this.targetCount+=1,De.resolve()}updateTargetData(e,n){return this.Fn(n),De.resolve()}removeTargetData(e,n){return this.xs.delete(n.target),this.ks.Is(n.targetId),this.targetCount-=1,De.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.xs.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.xs.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),De.waitFor(s).next(()=>i)}getTargetCount(e){return De.resolve(this.targetCount)}getTargetData(e,n){const r=this.xs.get(n)||null;return De.resolve(r)}addMatchingKeys(e,n,r){return this.ks.gs(n,r),De.resolve()}removeMatchingKeys(e,n,r){this.ks.ps(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),De.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.ks.Is(n),De.resolve()}getMatchingKeysForTargetId(e,n){const r=this.ks.Es(n);return De.resolve(r)}containsKey(e,n){return De.resolve(this.ks.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zCt{constructor(e,n){this.$s={},this.overlays={},this.Os=new d8(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new BCt(this),this.indexManager=new ACt,this.remoteDocumentCache=function(r){return new FCt(r)}(r=>this.referenceDelegate.Ls(r)),this.serializer=new _Ct(n),this.qs=new NCt(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new jCt,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.$s[e.toKey()];return r||(r=new LCt(n,this.referenceDelegate),this.$s[e.toKey()]=r),r}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,n,r){lt("MemoryPersistence","Starting transaction:",e);const i=new UCt(this.Os.next());return this.referenceDelegate.Us(),r(i).next(s=>this.referenceDelegate.Ks(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gs(e,n){return De.or(Object.values(this.$s).map(r=>()=>r.containsKey(e,n)))}}class UCt extends P1t{constructor(e){super(),this.currentSequenceNumber=e}}class T8{constructor(e){this.persistence=e,this.Qs=new E8,this.js=null}static zs(e){return new T8(e)}get Ws(){if(this.js)return this.js;throw kt()}addReference(e,n,r){return this.Qs.addReference(r,n),this.Ws.delete(r.toString()),De.resolve()}removeReference(e,n,r){return this.Qs.removeReference(r,n),this.Ws.add(r.toString()),De.resolve()}markPotentiallyOrphaned(e,n){return this.Ws.add(n.toString()),De.resolve()}removeTarget(e,n){this.Qs.Is(n.targetId).forEach(i=>this.Ws.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.Ws.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}Us(){this.js=new Set}Ks(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return De.forEach(this.Ws,r=>{const i=ht.fromPath(r);return this.Hs(e,i).next(s=>{s||n.removeEntry(i,Dt.min())})}).next(()=>(this.js=null,n.apply(e)))}updateLimboDocument(e,n){return this.Hs(e,n).next(r=>{r?this.Ws.delete(n.toString()):this.Ws.add(n.toString())})}Ls(e){return 0}Hs(e,n){return De.or([()=>De.resolve(this.Qs.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Gs(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I8{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Fi=r,this.Bi=i}static Li(e,n){let r=Xt(),i=Xt();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new I8(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HCt{constructor(){this.qi=!1}initialize(e,n){this.Ui=e,this.indexManager=n,this.qi=!0}getDocumentsMatchingQuery(e,n,r,i){return this.Ki(e,n).next(s=>s||this.Gi(e,n,i,r)).next(s=>s||this.Qi(e,n))}Ki(e,n){if(Xne(n))return De.resolve(null);let r=Md(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=$B(n,null,"F"),r=Md(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=Xt(...s);return this.Ui.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ji(n,a);return this.zi(n,c,o,l.readTime)?this.Ki(e,$B(n,null,"F")):this.Wi(e,c,n,l)}))})))}Gi(e,n,r,i){return Xne(n)||i.isEqual(Dt.min())?this.Qi(e,n):this.Ui.getDocuments(e,r).next(s=>{const o=this.ji(n,s);return this.zi(n,o,r,i)?this.Qi(e,n):(Bne()<=cn.DEBUG&&lt("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),BB(n)),this.Wi(e,o,n,C1t(i,-1)))})}ji(e,n){let r=new js(cEe(e));return n.forEach((i,s)=>{fM(e,s)&&(r=r.add(s))}),r}zi(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Qi(e,n){return Bne()<=cn.DEBUG&&lt("QueryEngine","Using full collection scan to execute query:",BB(n)),this.Ui.getDocumentsMatchingQuery(e,n,wf.min())}Wi(e,n,r,i){return this.Ui.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VCt{constructor(e,n,r,i){this.persistence=e,this.Hi=n,this.serializer=i,this.Ji=new dr(hn),this.Yi=new Qv(s=>g8(s),m8),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(r)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new RCt(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ji))}}function WCt(t,e,n,r){return new VCt(t,e,n,r)}async function AEe(t,e){const n=Lt(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.tr(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let l=Xt();for(const c of i){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of s){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return n.localDocuments.getDocuments(r,l).next(c=>({er:c,removedBatchIds:o,addedBatchIds:a}))})})}function KCt(t,e){const n=Lt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=n.Zi.newChangeBuffer({trackRemovals:!0});return function(o,a,l,c){const u=l.batch,d=u.keys();let h=De.resolve();return d.forEach(f=>{h=h.next(()=>c.getEntry(a,f)).next(y=>{const b=l.docVersions.get(f);Kn(b!==null),y.version.compareTo(b)<0&&(u.applyToRemoteDocument(y,l),y.isValidDocument()&&(y.setReadTime(l.commitVersion),c.addEntry(y)))})}),h.next(()=>o.mutationQueue.removeMutationBatch(a,u))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let a=Xt();for(let l=0;l<o.mutationResults.length;++l)o.mutationResults[l].transformResults.length>0&&(a=a.add(o.batch.mutations[l].key));return a}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function MEe(t){const e=Lt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Bs.getLastRemoteSnapshotVersion(n))}function qCt(t,e){const n=Lt(t),r=e.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const a=[];e.targetChanges.forEach((u,d)=>{const h=i.get(d);if(!h)return;a.push(n.Bs.removeMatchingKeys(s,u.removedDocuments,d).next(()=>n.Bs.addMatchingKeys(s,u.addedDocuments,d)));let f=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?f=f.withResumeToken($s.EMPTY_BYTE_STRING,Dt.min()).withLastLimboFreeSnapshotVersion(Dt.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,r)),i=i.insert(d,f),function(y,b,v){return y.resumeToken.approximateByteSize()===0||b.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8?!0:v.addedDocuments.size+v.modifiedDocuments.size+v.removedDocuments.size>0}(h,f,u)&&a.push(n.Bs.updateTargetData(s,f))});let l=Od(),c=Xt();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(GCt(s,o,e.documentUpdates).next(u=>{l=u.nr,c=u.sr})),!r.isEqual(Dt.min())){const u=n.Bs.getLastRemoteSnapshotVersion(s).next(d=>n.Bs.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return De.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(n.Ji=i,s))}function GCt(t,e,n){let r=Xt(),i=Xt();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=Od();return n.forEach((a,l)=>{const c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(Dt.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):lt("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{nr:o,sr:i}})}function YCt(t,e){const n=Lt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function XCt(t,e){const n=Lt(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Bs.getTargetData(r,e).next(s=>s?(i=s,De.resolve(i)):n.Bs.allocateTargetId(r).next(o=>(i=new Jh(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Bs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.Ji.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(r.targetId,r),n.Yi.set(e,r.targetId)),r})}async function WB(t,e,n){const r=Lt(t),i=r.Ji.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!c1(o))throw o;lt("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ji=r.Ji.remove(e),r.Yi.delete(i.target)}function are(t,e,n){const r=Lt(t);let i=Dt.min(),s=Xt();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,l,c){const u=Lt(a),d=u.Yi.get(c);return d!==void 0?De.resolve(u.Ji.get(d)):u.Bs.getTargetData(l,c)}(r,o,Md(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.Hi.getDocumentsMatchingQuery(o,e,n?i:Dt.min(),n?s:Xt())).next(a=>(JCt(r,H1t(e),a),{documents:a,ir:s})))}function JCt(t,e,n){let r=t.Xi.get(e)||Dt.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.Xi.set(e,r)}class lre{constructor(){this.activeTargetIds=Y1t()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ZCt{constructor(){this.Hr=new lre,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,n,r){this.Jr[e]=n}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new lre,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QCt{Yr(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cre{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){lt("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){lt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let RE=null;function XL(){return RE===null?RE=268435456+Math.round(2147483648*Math.random()):RE++,"0x"+RE.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eEt={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tEt{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xs="WebChannelConnection";class nEt extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http";this.mo=n+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,n,r,i,s){const o=XL(),a=this.To(e,n);lt("RestConnection",`Sending RPC '${e}' ${o}:`,a,r);const l={};return this.Eo(l,i,s),this.Ao(e,a,l,r).then(c=>(lt("RestConnection",`Received RPC '${e}' ${o}: `,c),c),c=>{throw iv("RestConnection",`RPC '${e}' ${o} failed with error: `,c,"url: ",a,"request:",r),c})}vo(e,n,r,i,s,o){return this.Io(e,n,r,i,s)}Eo(e,n,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Zv,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}To(e,n){const r=eEt[e];return`${this.mo}/v1/${n}:${r}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,n,r,i){const s=XL();return new Promise((o,a)=>{const l=new h1t;l.setWithCredentials(!0),l.listenOnce(c1t.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case GL.NO_ERROR:const u=l.getResponseJson();lt(xs,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(u)),o(u);break;case GL.TIMEOUT:lt(xs,`RPC '${e}' ${s} timed out`),a(new Ye(we.DEADLINE_EXCEEDED,"Request time out"));break;case GL.HTTP_ERROR:const d=l.getStatus();if(lt(xs,`RPC '${e}' ${s} failed with status:`,d,"response text:",l.getResponseText()),d>0){let h=l.getResponseJson();Array.isArray(h)&&(h=h[0]);const f=h==null?void 0:h.error;if(f&&f.status&&f.message){const y=function(b){const v=b.toLowerCase().replace(/_/g,"-");return Object.values(we).indexOf(v)>=0?v:we.UNKNOWN}(f.status);a(new Ye(y,f.message))}else a(new Ye(we.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Ye(we.UNAVAILABLE,"Connection failed."));break;default:kt()}}finally{lt(xs,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);lt(xs,`RPC '${e}' ${s} sending request:`,i),l.send(n,"POST",c,r,15)})}Ro(e,n,r){const i=XL(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=a1t(),a=l1t(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.xmlHttpFactory=new d1t({})),this.Eo(l.initMessageHeaders,n,r),l.encodeInitMessageHeaders=!0;const u=s.join("");lt(xs,`Creating RPC '${e}' stream ${i}: ${u}`,l);const d=o.createWebChannel(u,l);let h=!1,f=!1;const y=new tEt({ro:v=>{f?lt(xs,`Not sending because RPC '${e}' stream ${i} is closed:`,v):(h||(lt(xs,`Opening RPC '${e}' stream ${i} transport.`),d.open(),h=!0),lt(xs,`RPC '${e}' stream ${i} sending:`,v),d.send(v))},oo:()=>d.close()}),b=(v,x,C)=>{v.listen(x,E=>{try{C(E)}catch(I){setTimeout(()=>{throw I},0)}})};return b(d,AE.EventType.OPEN,()=>{f||lt(xs,`RPC '${e}' stream ${i} transport opened.`)}),b(d,AE.EventType.CLOSE,()=>{f||(f=!0,lt(xs,`RPC '${e}' stream ${i} transport closed`),y.wo())}),b(d,AE.EventType.ERROR,v=>{f||(f=!0,iv(xs,`RPC '${e}' stream ${i} transport errored:`,v),y.wo(new Ye(we.UNAVAILABLE,"The operation could not be completed")))}),b(d,AE.EventType.MESSAGE,v=>{var x;if(!f){const C=v.data[0];Kn(!!C);const E=C,I=E.error||((x=E[0])===null||x===void 0?void 0:x.error);if(I){lt(xs,`RPC '${e}' stream ${i} received error:`,I);const P=I.status;let _=function(D){const L=Br[D];if(L!==void 0)return wEe(L)}(P),A=I.message;_===void 0&&(_=we.INTERNAL,A="Unknown error status: "+P+" with message "+I.message),f=!0,y.wo(new Ye(_,A)),d.close()}else lt(xs,`RPC '${e}' stream ${i} received:`,C),y._o(C)}}),b(a,u1t.STAT_EVENT,v=>{v.stat===Fne.PROXY?lt(xs,`RPC '${e}' stream ${i} detected buffering proxy`):v.stat===Fne.NOPROXY&&lt(xs,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{y.fo()},0),y}}function JL(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yM(t){return new pCt(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OEe{constructor(e,n,r=1e3,i=1.5,s=6e4){this.ii=e,this.timerId=n,this.Po=r,this.bo=i,this.Vo=s,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const n=Math.floor(this.So+this.ko()),r=Math.max(0,Date.now()-this.Co),i=Math.max(0,n-r);i>0&&lt("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){this.Do!==null&&(this.Do.skipDelay(),this.Do=null)}cancel(){this.Do!==null&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DEe{constructor(e,n,r,i,s,o,a,l){this.ii=e,this.$o=r,this.Oo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new OEe(e,n)}Uo(){return this.state===1||this.state===5||this.Ko()}Ko(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&this.Bo===null&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,n){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,e!==4?this.qo.reset():n&&n.code===we.RESOURCE_EXHAUSTED?(Ad(n.toString()),Ad("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):n&&n.code===we.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(n)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),n=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Fo===n&&this.Zo(r,i)},r=>{e(()=>{const i=new Ye(we.UNKNOWN,"Fetching auth token failed: "+r.message);return this.tu(i)})})}Zo(e,n){const r=this.Xo(this.Fo);this.stream=this.eu(e,n),this.stream.uo(()=>{r(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(i=>{r(()=>this.tu(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Go(){this.state=5,this.qo.No(async()=>{this.state=0,this.start()})}tu(e){return lt("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return n=>{this.ii.enqueueAndForget(()=>this.Fo===e?n():(lt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class rEt extends DEe{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}eu(e,n){return this.connection.Ro("Listen",e,n)}onMessage(e){this.qo.reset();const n=yCt(this.serializer,e),r=function(i){if(!("targetChange"in i))return Dt.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?Dt.min():s.readTime?gu(s.readTime):Dt.min()}(e);return this.listener.nu(n,r)}su(e){const n={};n.database=VB(this.serializer),n.addTarget=function(i,s){let o;const a=s.target;if(o=LB(a)?{documents:xCt(i,a)}:{query:wCt(i,a)},o.targetId=s.targetId,s.resumeToken.approximateByteSize()>0){o.resumeToken=EEe(i,s.resumeToken);const l=zB(i,s.expectedCount);l!==null&&(o.expectedCount=l)}else if(s.snapshotVersion.compareTo(Dt.min())>0){o.readTime=b_(i,s.snapshotVersion.toTimestamp());const l=zB(i,s.expectedCount);l!==null&&(o.expectedCount=l)}return o}(this.serializer,e);const r=CCt(this.serializer,e);r&&(n.labels=r),this.Wo(n)}iu(e){const n={};n.database=VB(this.serializer),n.removeTarget=e,this.Wo(n)}}class iEt extends DEe{constructor(e,n,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,n){return this.connection.Ro("Write",e,n)}onMessage(e){if(Kn(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const n=bCt(e.writeResults,e.commitTime),r=gu(e.commitTime);return this.listener.cu(r,n)}return Kn(!e.writeResults||e.writeResults.length===0),this.ru=!0,this.listener.au()}hu(){const e={};e.database=VB(this.serializer),this.Wo(e)}uu(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>vCt(this.serializer,r))};this.Wo(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sEt extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new Ye(we.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Io(e,n,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===we.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Ye(we.UNKNOWN,i.toString())})}vo(e,n,r,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.vo(e,n,r,s,o,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===we.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Ye(we.UNKNOWN,s.toString())})}terminate(){this.lu=!0}}class oEt{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){this.wu===0&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){this.state==="Online"?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,e==="Online"&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Ad(n),this.mu=!1):lt("OnlineStateTracker",n)}Tu(){this._u!==null&&(this._u.cancel(),this._u=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aEt{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=s,this.Pu.Yr(o=>{r.enqueueAndForget(async()=>{Yg(this)&&(lt("RemoteStore","Restarting streams for network reachability change."),await async function(a){const l=Lt(a);l.vu.add(4),await f1(l),l.bu.set("Unknown"),l.vu.delete(4),await vM(l)}(this))})}),this.bu=new oEt(r,i)}}async function vM(t){if(Yg(t))for(const e of t.Ru)await e(!0)}async function f1(t){for(const e of t.Ru)await e(!1)}function REe(t,e){const n=Lt(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),k8(n)?_8(n):e0(n).Ko()&&P8(n,e))}function NEe(t,e){const n=Lt(t),r=e0(n);n.Au.delete(e),r.Ko()&&jEe(n,e),n.Au.size===0&&(r.Ko()?r.jo():Yg(n)&&n.bu.set("Unknown"))}function P8(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Dt.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}e0(t).su(e)}function jEe(t,e){t.Vu.qt(e),e0(t).iu(e)}function _8(t){t.Vu=new uCt({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),e0(t).start(),t.bu.gu()}function k8(t){return Yg(t)&&!e0(t).Uo()&&t.Au.size>0}function Yg(t){return Lt(t).vu.size===0}function LEe(t){t.Vu=void 0}async function lEt(t){t.Au.forEach((e,n)=>{P8(t,e)})}async function cEt(t,e){LEe(t),k8(t)?(t.bu.Iu(e),_8(t)):t.bu.set("Unknown")}async function uEt(t,e,n){if(t.bu.set("Online"),e instanceof CEe&&e.state===2&&e.cause)try{await async function(r,i){const s=i.cause;for(const o of i.targetIds)r.Au.has(o)&&(await r.remoteSyncer.rejectListen(o,s),r.Au.delete(o),r.Vu.removeTarget(o))}(t,e)}catch(r){lt("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await x_(t,r)}else if(e instanceof IT?t.Vu.Ht(e):e instanceof SEe?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(Dt.min()))try{const r=await MEe(t.localStore);n.compareTo(r)>=0&&await function(i,s){const o=i.Vu.ce(s);return o.targetChanges.forEach((a,l)=>{if(a.resumeToken.approximateByteSize()>0){const c=i.Au.get(l);c&&i.Au.set(l,c.withResumeToken(a.resumeToken,s))}}),o.targetMismatches.forEach((a,l)=>{const c=i.Au.get(a);if(!c)return;i.Au.set(a,c.withResumeToken($s.EMPTY_BYTE_STRING,c.snapshotVersion)),jEe(i,a);const u=new Jh(c.target,a,l,c.sequenceNumber);P8(i,u)}),i.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(r){lt("RemoteStore","Failed to raise snapshot:",r),await x_(t,r)}}async function x_(t,e,n){if(!c1(e))throw e;t.vu.add(1),await f1(t),t.bu.set("Offline"),n||(n=()=>MEe(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{lt("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await vM(t)})}function FEe(t,e){return e().catch(n=>x_(t,n,e))}async function bM(t){const e=Lt(t),n=Cf(e);let r=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;dEt(e);)try{const i=await YCt(e.localStore,r);if(i===null){e.Eu.length===0&&n.jo();break}r=i.batchId,hEt(e,i)}catch(i){await x_(e,i)}$Ee(e)&&BEe(e)}function dEt(t){return Yg(t)&&t.Eu.length<10}function hEt(t,e){t.Eu.push(e);const n=Cf(t);n.Ko()&&n.ou&&n.uu(e.mutations)}function $Ee(t){return Yg(t)&&!Cf(t).Uo()&&t.Eu.length>0}function BEe(t){Cf(t).start()}async function fEt(t){Cf(t).hu()}async function pEt(t){const e=Cf(t);for(const n of t.Eu)e.uu(n.mutations)}async function gEt(t,e,n){const r=t.Eu.shift(),i=x8.from(r,e,n);await FEe(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await bM(t)}async function mEt(t,e){e&&Cf(t).ou&&await async function(n,r){if(i=r.code,aCt(i)&&i!==we.ABORTED){const s=n.Eu.shift();Cf(n).Qo(),await FEe(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,r)),await bM(n)}var i}(t,e),$Ee(t)&&BEe(t)}async function ure(t,e){const n=Lt(t);n.asyncQueue.verifyOperationInProgress(),lt("RemoteStore","RemoteStore received new credentials");const r=Yg(n);n.vu.add(3),await f1(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await vM(n)}async function yEt(t,e){const n=Lt(t);e?(n.vu.delete(2),await vM(n)):e||(n.vu.add(2),await f1(n),n.bu.set("Unknown"))}function e0(t){return t.Su||(t.Su=function(e,n,r){const i=Lt(e);return i.fu(),new rEt(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(t.datastore,t.asyncQueue,{uo:lEt.bind(null,t),ao:cEt.bind(null,t),nu:uEt.bind(null,t)}),t.Ru.push(async e=>{e?(t.Su.Qo(),k8(t)?_8(t):t.bu.set("Unknown")):(await t.Su.stop(),LEe(t))})),t.Su}function Cf(t){return t.Du||(t.Du=function(e,n,r){const i=Lt(e);return i.fu(),new iEt(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(t.datastore,t.asyncQueue,{uo:fEt.bind(null,t),ao:mEt.bind(null,t),au:pEt.bind(null,t),cu:gEt.bind(null,t)}),t.Ru.push(async e=>{e?(t.Du.Qo(),await bM(t)):(await t.Du.stop(),t.Eu.length>0&&(lt("RemoteStore",`Stopping write stream with ${t.Eu.length} pending writes`),t.Eu=[]))})),t.Du}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A8{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new md,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,n,r,i,s){const o=Date.now()+r,a=new A8(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ye(we.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function M8(t,e){if(Ad("AsyncQueue",`${e}: ${t}`),c1(t))return new Ye(we.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ey{constructor(e){this.comparator=e?(n,r)=>e(n,r)||ht.comparator(n.key,r.key):(n,r)=>ht.comparator(n.key,r.key),this.keyedMap=Jb(),this.sortedSet=new dr(this.comparator)}static emptySet(e){return new Ey(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Ey)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Ey;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dre{constructor(){this.Cu=new dr(ht.comparator)}track(e){const n=e.doc.key,r=this.Cu.get(n);r?e.type!==0&&r.type===3?this.Cu=this.Cu.insert(n,e):e.type===3&&r.type!==1?this.Cu=this.Cu.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Cu=this.Cu.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Cu=this.Cu.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Cu=this.Cu.remove(n):e.type===1&&r.type===2?this.Cu=this.Cu.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Cu=this.Cu.insert(n,{type:2,doc:e.doc}):kt():this.Cu=this.Cu.insert(n,e)}xu(){const e=[];return this.Cu.inorderTraversal((n,r)=>{e.push(r)}),e}}class cv{constructor(e,n,r,i,s,o,a,l,c){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,n,r,i,s){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new cv(e,n,Ey.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hM(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vEt{constructor(){this.Nu=void 0,this.listeners=[]}}class bEt{constructor(){this.queries=new Qv(e=>lEe(e),hM),this.onlineState="Unknown",this.ku=new Set}}async function zEe(t,e){const n=Lt(t),r=e.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new vEt),i)try{s.Nu=await n.onListen(r)}catch(o){const a=M8(o,`Initialization of query '${BB(e.query)}' failed`);return void e.onError(a)}n.queries.set(r,s),s.listeners.push(e),e.Mu(n.onlineState),s.Nu&&e.$u(s.Nu)&&O8(n)}async function UEe(t,e){const n=Lt(t),r=e.query;let i=!1;const s=n.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=s.listeners.length===0)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function xEt(t,e){const n=Lt(t);let r=!1;for(const i of e){const s=i.query,o=n.queries.get(s);if(o){for(const a of o.listeners)a.$u(i)&&(r=!0);o.Nu=i}}r&&O8(n)}function wEt(t,e,n){const r=Lt(t),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(e)}function O8(t){t.ku.forEach(e=>{e.next()})}class HEe{constructor(e,n,r){this.query=e,this.Ou=n,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=r||{}}$u(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new cv(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),n=!0):this.qu(e,this.onlineState)&&(this.Uu(e),n=!0),this.Bu=e,n}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let n=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),n=!0),n}qu(e,n){if(!e.fromCache)return!0;const r=n!=="Offline";return(!this.options.Ku||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Lu(e){if(e.docChanges.length>0)return!0;const n=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Uu(e){e=cv.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VEe{constructor(e){this.key=e}}class WEe{constructor(e){this.key=e}}class SEt{constructor(e,n){this.query=e,this.Yu=n,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=Xt(),this.mutatedKeys=Xt(),this.tc=cEe(e),this.ec=new Ey(this.tc)}get nc(){return this.Yu}sc(e,n){const r=n?n.ic:new dre,i=n?n.ec:this.ec;let s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{const h=i.get(u),f=fM(this.query,d)?d:null,y=!!h&&this.mutatedKeys.has(h.key),b=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let v=!1;h&&f?h.data.isEqual(f.data)?y!==b&&(r.track({type:3,doc:f}),v=!0):this.rc(h,f)||(r.track({type:2,doc:f}),v=!0,(l&&this.tc(f,l)>0||c&&this.tc(f,c)<0)&&(a=!0)):!h&&f?(r.track({type:0,doc:f}),v=!0):h&&!f&&(r.track({type:1,doc:h}),v=!0,(l||c)&&(a=!0)),v&&(f?(o=o.add(f),s=b?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{ec:o,ic:r,zi:a,mutatedKeys:s}}rc(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r){const i=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const s=e.ic.xu();s.sort((c,u)=>function(d,h){const f=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return kt()}};return f(d)-f(h)}(c.type,u.type)||this.tc(c.doc,u.doc)),this.oc(r);const o=n?this.uc():[],a=this.Zu.size===0&&this.current?1:0,l=a!==this.Xu;return this.Xu=a,s.length!==0||l?{snapshot:new cv(this.query,e.ec,i,s,e.mutatedKeys,a===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),cc:o}:{cc:o}}Mu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ec:this.ec,ic:new dre,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(n=>this.Yu=this.Yu.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Yu=this.Yu.delete(n)),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=Xt(),this.ec.forEach(r=>{this.ac(r.key)&&(this.Zu=this.Zu.add(r.key))});const n=[];return e.forEach(r=>{this.Zu.has(r)||n.push(new WEe(r))}),this.Zu.forEach(r=>{e.has(r)||n.push(new VEe(r))}),n}hc(e){this.Yu=e.ir,this.Zu=Xt();const n=this.sc(e.documents);return this.applyChanges(n,!0)}lc(){return cv.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,this.Xu===0,this.hasCachedResults)}}class CEt{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class EEt{constructor(e){this.key=e,this.fc=!1}}class TEt{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.dc={},this.wc=new Qv(a=>lEe(a),hM),this._c=new Map,this.mc=new Set,this.gc=new dr(ht.comparator),this.yc=new Map,this.Ic=new E8,this.Tc={},this.Ec=new Map,this.Ac=lv.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return this.vc===!0}}async function IEt(t,e){const n=jEt(t);let r,i;const s=n.wc.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.lc();else{const o=await XCt(n.localStore,Md(e)),a=n.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=await PEt(n,e,r,a==="current",o.resumeToken),n.isPrimaryClient&&REe(n.remoteStore,o)}return i}async function PEt(t,e,n,r,i){t.Rc=(d,h,f)=>async function(y,b,v,x){let C=b.view.sc(v);C.zi&&(C=await are(y.localStore,b.query,!1).then(({documents:P})=>b.view.sc(P,C)));const E=x&&x.targetChanges.get(b.targetId),I=b.view.applyChanges(C,y.isPrimaryClient,E);return fre(y,b.targetId,I.cc),I.snapshot}(t,d,h,f);const s=await are(t.localStore,e,!0),o=new SEt(e,s.ir),a=o.sc(s.documents),l=h1.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),c=o.applyChanges(a,t.isPrimaryClient,l);fre(t,n,c.cc);const u=new CEt(e,n,o);return t.wc.set(e,u),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),c.snapshot}async function _Et(t,e){const n=Lt(t),r=n.wc.get(e),i=n._c.get(r.targetId);if(i.length>1)return n._c.set(r.targetId,i.filter(s=>!hM(s,e))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await WB(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),NEe(n.remoteStore,r.targetId),KB(n,r.targetId)}).catch(l1)):(KB(n,r.targetId),await WB(n.localStore,r.targetId,!0))}async function kEt(t,e,n){const r=LEt(t);try{const i=await function(s,o){const a=Lt(s),l=ii.now(),c=o.reduce((h,f)=>h.add(f.key),Xt());let u,d;return a.persistence.runTransaction("Locally write mutations","readwrite",h=>{let f=Od(),y=Xt();return a.Zi.getEntries(h,c).next(b=>{f=b,f.forEach((v,x)=>{x.isValidDocument()||(y=y.add(v))})}).next(()=>a.localDocuments.getOverlayedDocuments(h,f)).next(b=>{u=b;const v=[];for(const x of o){const C=nCt(x,u.get(x.key).overlayedDocument);C!=null&&v.push(new Kf(x.key,C,QCe(C.value.mapValue),kl.exists(!0)))}return a.mutationQueue.addMutationBatch(h,l,v,o)}).next(b=>{d=b;const v=b.applyToLocalDocumentSet(u,y);return a.documentOverlayCache.saveOverlays(h,b.batchId,v)})}).then(()=>({batchId:d.batchId,changes:dEe(u)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,o,a){let l=s.Tc[s.currentUser.toKey()];l||(l=new dr(hn)),l=l.insert(o,a),s.Tc[s.currentUser.toKey()]=l}(r,i.batchId,n),await p1(r,i.changes),await bM(r.remoteStore)}catch(i){const s=M8(i,"Failed to persist write");n.reject(s)}}async function KEe(t,e){const n=Lt(t);try{const r=await qCt(n.localStore,e);e.targetChanges.forEach((i,s)=>{const o=n.yc.get(s);o&&(Kn(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.fc=!0:i.modifiedDocuments.size>0?Kn(o.fc):i.removedDocuments.size>0&&(Kn(o.fc),o.fc=!1))}),await p1(n,r,e)}catch(r){await l1(r)}}function hre(t,e,n){const r=Lt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.wc.forEach((s,o)=>{const a=o.view.Mu(e);a.snapshot&&i.push(a.snapshot)}),function(s,o){const a=Lt(s);a.onlineState=o;let l=!1;a.queries.forEach((c,u)=>{for(const d of u.listeners)d.Mu(o)&&(l=!0)}),l&&O8(a)}(r.eventManager,e),i.length&&r.dc.nu(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function AEt(t,e,n){const r=Lt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.yc.get(e),s=i&&i.key;if(s){let o=new dr(ht.comparator);o=o.insert(s,_s.newNoDocument(s,Dt.min()));const a=Xt().add(s),l=new mM(Dt.min(),new Map,new dr(hn),o,a);await KEe(r,l),r.gc=r.gc.remove(s),r.yc.delete(e),D8(r)}else await WB(r.localStore,e,!1).then(()=>KB(r,e,n)).catch(l1)}async function MEt(t,e){const n=Lt(t),r=e.batch.batchId;try{const i=await KCt(n.localStore,e);GEe(n,r,null),qEe(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await p1(n,i)}catch(i){await l1(i)}}async function OEt(t,e,n){const r=Lt(t);try{const i=await function(s,o){const a=Lt(s);return a.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return a.mutationQueue.lookupMutationBatch(l,o).next(u=>(Kn(u!==null),c=u.keys(),a.mutationQueue.removeMutationBatch(l,u))).next(()=>a.mutationQueue.performConsistencyCheck(l)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(l,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,c)).next(()=>a.localDocuments.getDocuments(l,c))})}(r.localStore,e);GEe(r,e,n),qEe(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await p1(r,i)}catch(i){await l1(i)}}function qEe(t,e){(t.Ec.get(e)||[]).forEach(n=>{n.resolve()}),t.Ec.delete(e)}function GEe(t,e,n){const r=Lt(t);let i=r.Tc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.Tc[r.currentUser.toKey()]=i}}function KB(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t._c.get(e))t.wc.delete(r),n&&t.dc.Pc(r,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach(r=>{t.Ic.containsKey(r)||YEe(t,r)})}function YEe(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);n!==null&&(NEe(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),D8(t))}function fre(t,e,n){for(const r of n)r instanceof VEe?(t.Ic.addReference(r.key,e),DEt(t,r)):r instanceof WEe?(lt("SyncEngine","Document no longer in limbo: "+r.key),t.Ic.removeReference(r.key,e),t.Ic.containsKey(r.key)||YEe(t,r.key)):kt()}function DEt(t,e){const n=e.key,r=n.path.canonicalString();t.gc.get(n)||t.mc.has(r)||(lt("SyncEngine","New document in limbo: "+n),t.mc.add(r),D8(t))}function D8(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new ht(Wn.fromString(e)),r=t.Ac.next();t.yc.set(r,new EEt(n)),t.gc=t.gc.insert(n,r),REe(t.remoteStore,new Jh(Md(y8(n.path)),r,"TargetPurposeLimboResolution",d8.ct))}}async function p1(t,e,n){const r=Lt(t),i=[],s=[],o=[];r.wc.isEmpty()||(r.wc.forEach((a,l)=>{o.push(r.Rc(l,e,n).then(c=>{if((c||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c!=null&&c.fromCache?"not-current":"current"),c){i.push(c);const u=I8.Li(l.targetId,c);s.push(u)}}))}),await Promise.all(o),r.dc.nu(i),await async function(a,l){const c=Lt(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",u=>De.forEach(l,d=>De.forEach(d.Fi,h=>c.persistence.referenceDelegate.addReference(u,d.targetId,h)).next(()=>De.forEach(d.Bi,h=>c.persistence.referenceDelegate.removeReference(u,d.targetId,h)))))}catch(u){if(!c1(u))throw u;lt("LocalStore","Failed to update sequence numbers: "+u)}for(const u of l){const d=u.targetId;if(!u.fromCache){const h=c.Ji.get(d),f=h.snapshotVersion,y=h.withLastLimboFreeSnapshotVersion(f);c.Ji=c.Ji.insert(d,y)}}}(r.localStore,s))}async function REt(t,e){const n=Lt(t);if(!n.currentUser.isEqual(e)){lt("SyncEngine","User change. New user:",e.toKey());const r=await AEe(n.localStore,e);n.currentUser=e,function(i,s){i.Ec.forEach(o=>{o.forEach(a=>{a.reject(new Ye(we.CANCELLED,s))})}),i.Ec.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await p1(n,r.er)}}function NEt(t,e){const n=Lt(t),r=n.yc.get(e);if(r&&r.fc)return Xt().add(r.key);{let i=Xt();const s=n._c.get(e);if(!s)return i;for(const o of s){const a=n.wc.get(o);i=i.unionWith(a.view.nc)}return i}}function jEt(t){const e=Lt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=KEe.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=NEt.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=AEt.bind(null,e),e.dc.nu=xEt.bind(null,e.eventManager),e.dc.Pc=wEt.bind(null,e.eventManager),e}function LEt(t){const e=Lt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=MEt.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=OEt.bind(null,e),e}class pre{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=yM(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,n){return null}createIndexBackfillerScheduler(e,n){return null}createLocalStore(e){return WCt(this.persistence,new HCt,e.initialUser,this.serializer)}createPersistence(e){return new zCt(T8.zs,this.serializer)}createSharedClientState(e){return new ZCt}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class FEt{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>hre(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=REt.bind(null,this.syncEngine),await yEt(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new bEt}createDatastore(e){const n=yM(e.databaseInfo.databaseId),r=(i=e.databaseInfo,new nEt(i));var i;return function(s,o,a,l){return new sEt(s,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return n=this.localStore,r=this.datastore,i=e.asyncQueue,s=a=>hre(this.syncEngine,a,0),o=cre.D()?new cre:new QCt,new aEt(n,r,i,s,o);var n,r,i,s,o}createSyncEngine(e,n){return function(r,i,s,o,a,l,c){const u=new TEt(r,i,s,o,a,l);return c&&(u.vc=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(e){const n=Lt(e);lt("RemoteStore","RemoteStore shutting down."),n.vu.add(5),await f1(n),n.Pu.shutdown(),n.bu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XEe{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):Ad("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Et{constructor(e,n,r,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Is.UNAUTHENTICATED,this.clientId=XCe.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async s=>{lt("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(r,s=>(lt("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ye(we.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new md;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=M8(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function ZL(t,e){t.asyncQueue.verifyOperationInProgress(),lt("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await AEe(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function gre(t,e){t.asyncQueue.verifyOperationInProgress();const n=await zEt(t);lt("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener(i=>ure(e.remoteStore,i)),t.setAppCheckTokenChangeListener((i,s)=>ure(e.remoteStore,s)),t._onlineComponents=e}function BEt(t){return t.name==="FirebaseError"?t.code===we.FAILED_PRECONDITION||t.code===we.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function zEt(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){lt("FirestoreClient","Using user provided OfflineComponentProvider");try{await ZL(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!BEt(n))throw n;iv("Error using user provided cache. Falling back to memory cache: "+n),await ZL(t,new pre)}}else lt("FirestoreClient","Using default OfflineComponentProvider"),await ZL(t,new pre);return t._offlineComponents}async function JEe(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(lt("FirestoreClient","Using user provided OnlineComponentProvider"),await gre(t,t._uninitializedComponentsProvider._online)):(lt("FirestoreClient","Using default OnlineComponentProvider"),await gre(t,new FEt))),t._onlineComponents}function UEt(t){return JEe(t).then(e=>e.syncEngine)}async function ZEe(t){const e=await JEe(t),n=e.eventManager;return n.onListen=IEt.bind(null,e.syncEngine),n.onUnlisten=_Et.bind(null,e.syncEngine),n}function HEt(t,e,n={}){const r=new md;return t.asyncQueue.enqueueAndForget(async()=>function(i,s,o,a,l){const c=new XEe({next:d=>{s.enqueueAndForget(()=>UEe(i,u));const h=d.docs.has(o);!h&&d.fromCache?l.reject(new Ye(we.UNAVAILABLE,"Failed to get document because the client is offline.")):h&&d.fromCache&&a&&a.source==="server"?l.reject(new Ye(we.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(d)},error:d=>l.reject(d)}),u=new HEe(y8(o.path),c,{includeMetadataChanges:!0,Ku:!0});return zEe(i,u)}(await ZEe(t),t.asyncQueue,e,n,r)),r.promise}function VEt(t,e,n={}){const r=new md;return t.asyncQueue.enqueueAndForget(async()=>function(i,s,o,a,l){const c=new XEe({next:d=>{s.enqueueAndForget(()=>UEe(i,u)),d.fromCache&&a.source==="server"?l.reject(new Ye(we.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(d)},error:d=>l.reject(d)}),u=new HEe(o,c,{includeMetadataChanges:!0,Ku:!0});return zEe(i,u)}(await ZEe(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QEe(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mre=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eTe(t,e,n){if(!n)throw new Ye(we.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function WEt(t,e,n,r){if(e===!0&&r===!0)throw new Ye(we.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function yre(t){if(!ht.isDocumentKey(t))throw new Ye(we.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function vre(t){if(ht.isDocumentKey(t))throw new Ye(we.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function xM(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":kt()}function Pc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ye(we.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=xM(t);throw new Ye(we.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bre{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Ye(we.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ye(we.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}WEt("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=QEe((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Ye(we.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Ye(we.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Ye(we.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(n=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,n.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var n,r}}class wM{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bre({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ye(we.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new Ye(we.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bre(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new p1t;switch(n.type){case"firstParty":return new v1t(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Ye(we.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=mre.get(e);n&&(lt("ComponentProvider","Removing Datastore"),mre.delete(e),n.terminate())}(this),Promise.resolve()}}function KEt(t,e,n,r={}){var i;const s=(t=Pc(t,wM))._getSettings(),o=`${e}:${n}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&iv("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Is.MOCK_USER;else{a=tie(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new Ye(we.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Is(c)}t._authCredentials=new g1t(new YCe(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new df(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new go(this.firestore,e,this._key)}}class t0{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new t0(this.firestore,e,this._query)}}class df extends t0{constructor(e,n,r){super(e,n,y8(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new go(this.firestore,null,new ht(e))}withConverter(e){return new df(this.firestore,e,this._path)}}function Rc(t,e,...n){if(t=Nn(t),eTe("collection","path",e),t instanceof wM){const r=Wn.fromString(e,...n);return vre(r),new df(t,null,r)}{if(!(t instanceof go||t instanceof df))throw new Ye(we.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Wn.fromString(e,...n));return vre(r),new df(t.firestore,null,r)}}function na(t,e,...n){if(t=Nn(t),arguments.length===1&&(e=XCe.A()),eTe("doc","path",e),t instanceof wM){const r=Wn.fromString(e,...n);return yre(r),new go(t,null,new ht(r))}{if(!(t instanceof go||t instanceof df))throw new Ye(we.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Wn.fromString(e,...n));return yre(r),new go(t.firestore,t instanceof df?t.converter:null,new ht(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qEt{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new OEe(this,"async_queue_retry"),this.Xc=()=>{const n=JL();n&&lt("AsyncQueue","Visibility state changed to "+n.visibilityState),this.qo.Mo()};const e=JL();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const n=JL();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const n=new md;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}async ea(){if(this.Qc.length!==0){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!c1(e))throw e;lt("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No(()=>this.ea())}}ta(e){const n=this.Gc.then(()=>(this.Hc=!0,e().catch(r=>{this.Wc=r,this.Hc=!1;const i=function(s){let o=s.message||"";return s.stack&&(o=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),o}(r);throw Ad("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Hc=!1,r))));return this.Gc=n,n}enqueueAfterDelay(e,n,r){this.Zc(),this.Yc.indexOf(e)>-1&&(n=0);const i=A8.createAndSchedule(this,e,n,r,s=>this.na(s));return this.zc.push(i),i}Zc(){this.Wc&&kt()}verifyOperationInProgress(){}async sa(){let e;do e=this.Gc,await e;while(e!==this.Gc)}ia(e){for(const n of this.zc)if(n.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.zc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const n=this.zc.indexOf(e);this.zc.splice(n,1)}}class Xg extends wM{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new qEt,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||tTe(this),this._firestoreClient.terminate()}}function Gd(t,e){const n=typeof t=="object"?t:I_(),r=typeof t=="string"?t:"(default)",i=Tf(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=Zre("firestore");s&&KEt(i,...s)}return i}function R8(t){return t._firestoreClient||tTe(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function tTe(t){var e,n,r;const i=t._freezeSettings(),s=function(o,a,l,c){return new A1t(o,a,l,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,QEe(c.experimentalLongPollingOptions),c.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new $Et(t._authCredentials,t._appCheckCredentials,t._queue,s),!((n=i.cache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.cache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(e){this._byteString=e}static fromBase64String(e){try{return new uv($s.fromBase64String(e))}catch(n){throw new Ye(we.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new uv($s.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SM{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Ye(we.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ks(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N8{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j8{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Ye(we.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Ye(we.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return hn(this._lat,e._lat)||hn(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GEt=/^__.*__$/;class YEt{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Kf(e,this.data,this.fieldMask,n,this.fieldTransforms):new d1(e,this.data,n,this.fieldTransforms)}}class nTe{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Kf(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function rTe(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw kt()}}class L8{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.ua(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new L8(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.aa({path:r,la:!1});return i.fa(e),i}da(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.aa({path:r,la:!1});return i.ua(),i}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return w_(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(e.length===0)throw this._a("Document fields must not be empty");if(rTe(this.ca)&&GEt.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class XEt{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||yM(e)}ya(e,n,r,i=!1){return new L8({ca:e,methodName:n,ga:r,path:ks.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function CM(t){const e=t._freezeSettings(),n=yM(t._databaseId);return new XEt(t._databaseId,!!e.ignoreUndefinedProperties,n)}function iTe(t,e,n,r,i,s={}){const o=t.ya(s.merge||s.mergeFields?2:0,e,n,i);F8("Data must be an object, but it was:",o,r);const a=sTe(r,o);let l,c;if(s.merge)l=new Ea(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const u=[];for(const d of s.mergeFields){const h=qB(e,d,n);if(!o.contains(h))throw new Ye(we.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);aTe(u,h)||u.push(h)}l=new Ea(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new YEt(new qo(a),l,c)}class EM extends N8{_toFieldTransform(e){if(e.ca!==2)throw e.ca===1?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof EM}}function JEt(t,e,n,r){const i=t.ya(1,e,n);F8("Data must be an object, but it was:",i,r);const s=[],o=qo.empty();Gg(r,(l,c)=>{const u=$8(e,l,n);c=Nn(c);const d=i.da(u);if(c instanceof EM)s.push(u);else{const h=g1(c,d);h!=null&&(s.push(u),o.set(u,h))}});const a=new Ea(s);return new nTe(o,a,i.fieldTransforms)}function ZEt(t,e,n,r,i,s){const o=t.ya(1,e,n),a=[qB(e,r,n)],l=[i];if(s.length%2!=0)throw new Ye(we.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(qB(e,s[h])),l.push(s[h+1]);const c=[],u=qo.empty();for(let h=a.length-1;h>=0;--h)if(!aTe(c,a[h])){const f=a[h];let y=l[h];y=Nn(y);const b=o.da(f);if(y instanceof EM)c.push(f);else{const v=g1(y,b);v!=null&&(c.push(f),u.set(f,v))}}const d=new Ea(c);return new nTe(u,d,o.fieldTransforms)}function QEt(t,e,n,r=!1){return g1(n,t.ya(r?4:3,e))}function g1(t,e){if(oTe(t=Nn(t)))return F8("Unsupported field value:",e,t),sTe(t,e);if(t instanceof N8)return function(n,r){if(!rTe(r.ca))throw r._a(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r._a(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.la&&e.ca!==4)throw e._a("Nested arrays are not supported");return function(n,r){const i=[];let s=0;for(const o of n){let a=g1(o,r.wa(s));a==null&&(a={nullValue:"NULL_VALUE"}),i.push(a),s++}return{arrayValue:{values:i}}}(t,e)}return function(n,r){if((n=Nn(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return X1t(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=ii.fromDate(n);return{timestampValue:b_(r.serializer,i)}}if(n instanceof ii){const i=new ii(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:b_(r.serializer,i)}}if(n instanceof j8)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof uv)return{bytesValue:EEe(r.serializer,n._byteString)};if(n instanceof go){const i=r.databaseId,s=n.firestore._databaseId;if(!s.isEqual(i))throw r._a(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:C8(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r._a(`Unsupported field value: ${xM(n)}`)}(t,e)}function sTe(t,e){const n={};return JCe(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gg(t,(r,i)=>{const s=g1(i,e.ha(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function oTe(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ii||t instanceof j8||t instanceof uv||t instanceof go||t instanceof N8)}function F8(t,e,n){if(!oTe(n)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(n)){const r=xM(n);throw r==="an object"?e._a(t+" a custom object"):e._a(t+" "+r)}}function qB(t,e,n){if((e=Nn(e))instanceof SM)return e._internalPath;if(typeof e=="string")return $8(t,e);throw w_("Field path arguments must be of type string or ",t,!1,void 0,n)}const eTt=new RegExp("[~\\*/\\[\\]]");function $8(t,e,n){if(e.search(eTt)>=0)throw w_(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new SM(...e.split("."))._internalPath}catch{throw w_(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function w_(t,e,n,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new Ye(we.INVALID_ARGUMENT,a+t+l)}function aTe(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lTe{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new go(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new tTt(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(B8("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class tTt extends lTe{data(){return super.data()}}function B8(t,e){return typeof e=="string"?$8(t,e):e instanceof SM?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nTt(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Ye(we.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class z8{}class rTt extends z8{}function n0(t,e,...n){let r=[];e instanceof z8&&r.push(e),r=r.concat(n),function(i){const s=i.filter(a=>a instanceof U8).length,o=i.filter(a=>a instanceof TM).length;if(s>1||s>0&&o>0)throw new Ye(we.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class TM extends rTt{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new TM(e,n,r)}_apply(e){const n=this._parse(e);return cTe(e._query,n),new t0(e.firestore,e.converter,FB(e._query,n))}_parse(e){const n=CM(e.firestore);return function(i,s,o,a,l,c,u){let d;if(l.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new Ye(we.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){wre(u,c);const h=[];for(const f of u)h.push(xre(a,i,f));d={arrayValue:{values:h}}}else d=xre(a,i,u)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||wre(u,c),d=QEt(o,s,u,c==="in"||c==="not-in");return Kr.create(l,c,d)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function r0(t,e,n){const r=e,i=B8("where",t);return TM._create(i,r,n)}class U8 extends z8{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new U8(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Ic.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(r,i){let s=r;const o=i.getFlattenedFilters();for(const a of o)cTe(s,a),s=FB(s,a)}(e._query,n),new t0(e.firestore,e.converter,FB(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function xre(t,e,n){if(typeof(n=Nn(n))=="string"){if(n==="")throw new Ye(we.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aEe(e)&&n.indexOf("/")!==-1)throw new Ye(we.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Wn.fromString(n));if(!ht.isDocumentKey(r))throw new Ye(we.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Vne(t,new ht(r))}if(n instanceof go)return Vne(t,n._key);throw new Ye(we.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xM(n)}.`)}function wre(t,e){if(!Array.isArray(t)||t.length===0)throw new Ye(we.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function cTe(t,e){if(e.isInequality()){const r=v8(t),i=e.field;if(r!==null&&!r.isEqual(i))throw new Ye(we.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);const s=oEe(t);s!==null&&iTt(t,i,s)}const n=function(r,i){for(const s of r)for(const o of s.getFlattenedFilters())if(i.indexOf(o.op)>=0)return o.op;return null}(t.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new Ye(we.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ye(we.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function iTt(t,e,n){if(!n.isEqual(e))throw new Ye(we.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class sTt{convertValue(e,n="none"){switch(Pg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Vr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ig(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw kt()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Gg(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertGeoPoint(e){return new j8(Vr(e.latitude),Vr(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=f8(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Hw(e));default:return null}}convertTimestamp(e){const n=Sf(e);return new ii(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Wn.fromString(e);Kn(kEe(r));const i=new Vw(r.get(1),r.get(3)),s=new ht(r.popFirst(5));return i.isEqual(n)||Ad(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uTe(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qb{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class dTe extends lTe{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new PT(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(B8("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class PT extends dTe{data(e={}){return super.data(e)}}class oTt{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Qb(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new PT(this._firestore,this._userDataWriter,r.key,r,new Qb(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Ye(we.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(o=>{const a=new PT(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Qb(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);return o.doc,{type:"added",doc:a,oldIndex:-1,newIndex:s++}})}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>i||o.type!==3).map(o=>{const a=new PT(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Qb(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let l=-1,c=-1;return o.type!==0&&(l=s.indexOf(o.doc.key),s=s.delete(o.doc.key)),o.type!==1&&(s=s.add(o.doc),c=s.indexOf(o.doc.key)),{type:aTt(o.type),doc:a,oldIndex:l,newIndex:c}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function aTt(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return kt()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lTt(t){t=Pc(t,go);const e=Pc(t.firestore,Xg);return HEt(R8(e),t._key).then(n=>cTt(e,t,n))}class hTe extends sTt{constructor(e){super(),this.firestore=e}convertBytes(e){return new uv(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new go(this.firestore,null,n)}}function i0(t){t=Pc(t,t0);const e=Pc(t.firestore,Xg),n=R8(e),r=new hTe(e);return nTt(t._query),VEt(n,t._query).then(i=>new oTt(e,r,t,i))}function H8(t,e,n){t=Pc(t,go);const r=Pc(t.firestore,Xg),i=uTe(t.converter,e,n);return PM(r,[iTe(CM(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,kl.none())])}function IM(t,e,n,...r){t=Pc(t,go);const i=Pc(t.firestore,Xg),s=CM(i);let o;return o=typeof(e=Nn(e))=="string"||e instanceof SM?ZEt(s,"updateDoc",t._key,e,n,r):JEt(s,"updateDoc",t._key,e),PM(i,[o.toMutation(t._key,kl.exists(!0))])}function m1(t){return PM(Pc(t.firestore,Xg),[new b8(t._key,kl.none())])}function y1(t,e){const n=Pc(t.firestore,Xg),r=na(t),i=uTe(t.converter,e);return PM(n,[iTe(CM(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,kl.exists(!1))]).then(()=>r)}function PM(t,e){return function(n,r){const i=new md;return n.asyncQueue.enqueueAndForget(async()=>kEt(await UEt(n),r,i)),i.promise}(R8(t),e)}function cTt(t,e,n){const r=n.docs.get(e._key),i=new hTe(t);return new dTe(t,i,e._key,r,new Qb(n.hasPendingWrites,n.fromCache),e.converter)}(function(t,e=!0){(function(n){Zv=n})(Mg),yc(new Al("firestore",(n,{instanceIdentifier:r,options:i})=>{const s=n.getProvider("app").getImmediate(),o=new Xg(new m1t(n.getProvider("auth-internal")),new x1t(n.getProvider("app-check-internal")),function(a,l){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new Ye(we.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Vw(a.options.projectId,l)}(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Xo($ne,"3.13.0",t),Xo($ne,"3.13.0","esm2017")})();const _M=Gd(Co);async function uTt(t,e,n){const r=`drawing_${Date.now()}`,i=new Date().toISOString(),s={id:r,userId:t,name:e,records:n,createdAt:i,updatedAt:i};return await H8(na(_M,"drawings",r),s),s}async function dTt(t,e){const n=new Date().toISOString();await H8(na(_M,"drawings",t),{records:e,updatedAt:n},{merge:!0})}async function hTt(t){const e=n0(Rc(_M,"drawings"),r0("userId","==",t));return(await i0(e)).docs.map(r=>r.data())}async function fTt(t){await H8(na(_M,"drawings",t),{deleted:!0},{merge:!0})}const pTt=({key:t,onMount:e,initialSnapshot:n})=>{const[r,i]=S.useState(null),s=S.useCallback(o=>{i(o),e(o)},[e]);return S.useEffect(()=>{r&&n&&setTimeout(()=>{try{console.log("Carregando snapshot inicial:",n),IU(r.store,n),console.log("Snapshot inicial carregado com sucesso!")}catch(o){console.error("Erro ao carregar snapshot inicial:",o)}},100)},[r,n]),g.jsx(rSt,{autoFocus:!0,onMount:s},t)},gTt=({userId:t,theme:e})=>{const[n,r]=S.useState([]),[i,s]=S.useState(null),[o,a]=S.useState(""),[l,c]=S.useState(!1),[u,d]=S.useState(!1),[h,f]=S.useState(!1),[y,b]=S.useState(!1),[v,x]=S.useState(null),[C,E]=S.useState(!1),[I,P]=S.useState(0),[_,A]=S.useState(null);S.useEffect(()=>{(async()=>{try{const j=await hTt(t);r(j.filter(B=>!B.deleted))}catch(j){console.error("Erro ao carregar desenhos:",j)}})()},[t]);const D=S.useCallback(async R=>{if(!v||!C){console.warn("Editor não está pronto ainda");return}c(!0);try{const j=ife(v.store);if(console.log("Salvando snapshot:",j),i)await dTt(i,j);else{const B=await uTt(t,R||`Desenho ${Date.now()}`,j);s(B.id),r(K=>[...K,B])}}catch(j){console.error("Erro ao salvar desenho:",j)}finally{c(!1),d(!1)}},[v,C,i,t]),L=S.useCallback(async()=>{if(!i){console.warn("Nenhum desenho selecionado para excluir");return}try{await fTt(i),r(R=>R.filter(j=>j.id!==i)),s(null),a(""),A(null),P(R=>R+1),console.log("Desenho excluído com sucesso")}catch(R){console.error("Erro ao excluir desenho:",R),alert("Erro ao excluir o desenho. Tente novamente.")}finally{b(!1)}},[i]),z=S.useCallback(()=>{P(R=>R+1),s(null),a(""),A(null),E(!1),x(null),console.log("Novo desenho iniciado")},[]),$=S.useCallback(async R=>{const j=n.find(B=>B.id===R);if(j){console.log("Preparando para carregar desenho:",j.name),console.log("Dados do desenho:",j.records);let B=j.records;if(!B.schemaVersion){if(console.log("Snapshot não tem schemaVersion, tentando extrair store..."),B.store)B=B.store;else if(Array.isArray(B)){const K={};B.forEach(G=>{G&&G.id&&(K[G.id]=G)}),B=K}}console.log("Snapshot final para carregar:",B),A(B),s(j.id),a(j.name),P(K=>K+1),f(!1)}},[n]),H=S.useCallback(R=>{x(R),setTimeout(()=>{E(!0),console.log("Editor pronto para uso")},1e3)},[]);return g.jsxs("div",{className:"h-full flex flex-col",children:[g.jsxs("div",{className:"flex items-center justify-between p-4 bg-card border-b border-gray-600",children:[g.jsxs("div",{className:"flex items-center space-x-4",children:[g.jsx("button",{onClick:z,disabled:!C,className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Novo Desenho"}),g.jsxs("button",{onClick:()=>f(!0),disabled:!C||n.length===0,className:"px-4 py-2 bg-secondary text-text-primary rounded-md hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:["Abrir Desenho (",n.length,")"]}),g.jsx("span",{className:"text-text-secondary",children:i?`Editando: ${o}`:"Novo desenho"})]}),g.jsxs("div",{className:"flex items-center space-x-2",children:[i&&g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:()=>D(),disabled:l||!C,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Salvando...":"Salvar"}),g.jsx("button",{onClick:()=>b(!0),disabled:!C,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Excluir"})]}),g.jsx("button",{onClick:()=>d(!0),disabled:!C,className:"px-4 py-2 bg-accent text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Salvar Como"})]})]}),g.jsx("div",{className:"flex-1",children:g.jsx(pTt,{onMount:H,initialSnapshot:_},I)}),u&&g.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-xl w-96",children:[g.jsx("h3",{className:"text-xl font-bold mb-4",children:"Salvar Desenho"}),g.jsx("input",{type:"text",value:o,onChange:R=>a(R.target.value),placeholder:"Nome do desenho",className:"w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md mb-4 text-text-primary"}),g.jsxs("div",{className:"flex justify-end space-x-2",children:[g.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 bg-secondary text-text-primary rounded-md hover:bg-gray-600",children:"Cancelar"}),g.jsx("button",{onClick:()=>{o.trim()&&D(o)},disabled:!o.trim()||l||!C,className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:"Salvar"})]})]})}),h&&g.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-xl w-96 max-h-96 overflow-y-auto",children:[g.jsx("h3",{className:"text-xl font-bold mb-4",children:"Abrir Desenho"}),n.length===0?g.jsx("p",{className:"text-text-secondary mb-4",children:"Nenhum desenho salvo encontrado."}):g.jsx("div",{className:"space-y-2 mb-4",children:n.map(R=>g.jsxs("div",{onClick:()=>$(R.id),className:"p-3 bg-secondary rounded-md cursor-pointer hover:bg-gray-600 transition-colors",children:[g.jsx("div",{className:"font-medium text-text-primary",children:R.name}),g.jsxs("div",{className:"text-sm text-text-secondary",children:["Criado em: ",new Date(R.createdAt).toLocaleDateString("pt-BR")]}),g.jsxs("div",{className:"text-sm text-text-secondary",children:["Atualizado em: ",new Date(R.updatedAt).toLocaleDateString("pt-BR")]})]},R.id))}),g.jsx("div",{className:"flex justify-end",children:g.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-secondary text-text-primary rounded-md hover:bg-gray-600",children:"Fechar"})})]})}),y&&g.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-xl w-96",children:[g.jsx("h3",{className:"text-xl font-bold mb-4",children:"Excluir Desenho"}),g.jsxs("p",{className:"text-text-secondary mb-6",children:['Tem certeza que deseja excluir o desenho "',o,'"? Esta ação não pode ser desfeita.']}),g.jsxs("div",{className:"flex justify-end space-x-2",children:[g.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-secondary text-text-primary rounded-md hover:bg-gray-600",children:"Cancelar"}),g.jsx("button",{onClick:L,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Excluir"})]})]})})]})},fTe=Gd(Co);async function mTt(t,e){const n=await y1(Rc(fTe,"projects"),{...t,ownerUid:e});return{...t,id:n.id,ownerUid:e}}async function yTt(t){const e=n0(Rc(fTe,"projects"),r0("ownerUid","==",t));return(await i0(e)).docs.map(r=>({id:r.id,...r.data()}))}async function vTt(t){const e=Gd(Co),n=na(e,"projects",t),r=await lTt(n);return r.exists()?{id:r.id,...r.data()}:null}async function pTe(t,e){const n=Gd(Co),r=na(n,"projects",t);await IM(r,e)}async function bTt(t){const e=Gd(Co),n=na(e,"projects",t);await m1(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gTe="firebasestorage.googleapis.com",mTe="storageBucket",xTt=120*1e3,wTt=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er extends Rl{constructor(e,n,r=0){super(QL(e),`Firebase Storage: ${n} (${QL(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Er.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return QL(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Cr;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Cr||(Cr={}));function QL(t){return"storage/"+t}function V8(){const t="An unknown error occurred, please check the error payload for server response.";return new Er(Cr.UNKNOWN,t)}function STt(t){return new Er(Cr.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function CTt(t){return new Er(Cr.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function ETt(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Er(Cr.UNAUTHENTICATED,t)}function TTt(){return new Er(Cr.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function ITt(t){return new Er(Cr.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function PTt(){return new Er(Cr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function _Tt(){return new Er(Cr.CANCELED,"User canceled the upload/download.")}function kTt(t){return new Er(Cr.INVALID_URL,"Invalid URL '"+t+"'.")}function ATt(t){return new Er(Cr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function MTt(){return new Er(Cr.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+mTe+"' property when initializing the app?")}function OTt(){return new Er(Cr.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function DTt(){return new Er(Cr.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function RTt(t){return new Er(Cr.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function GB(t){return new Er(Cr.INVALID_ARGUMENT,t)}function yTe(){return new Er(Cr.APP_DELETED,"The Firebase app was deleted.")}function NTt(t){return new Er(Cr.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function kx(t,e){return new Er(Cr.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function bb(t){throw new Er(Cr.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=Ta.makeFromUrl(e,n)}catch{return new Ta(e,"")}if(r.path==="")return r;throw ATt(e)}static makeFromUrl(e,n){let r=null;const i="([A-Za-z0-9.\\-_]+)";function s(I){I.path.charAt(I.path.length-1)==="/"&&(I.path_=I.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),l={bucket:1,path:3};function c(I){I.path_=decodeURIComponent(I.path)}const u="v[A-Za-z0-9_]+",d=n.replace(/[.]/g,"\\."),h="(/([^?#]*).*)?$",f=new RegExp(`^https?://${d}/${u}/b/${i}/o${h}`,"i"),y={bucket:1,path:3},b=n===gTe?"(?:storage.googleapis.com|storage.cloud.google.com)":n,v="([^?#]*)",x=new RegExp(`^https?://${b}/${i}/${v}`,"i"),E=[{regex:a,indices:l,postModify:s},{regex:f,indices:y,postModify:c},{regex:x,indices:{bucket:1,path:2},postModify:c}];for(let I=0;I<E.length;I++){const P=E[I],_=P.regex.exec(e);if(_){const A=_[P.indices.bucket];let D=_[P.indices.path];D||(D=""),r=new Ta(A,D),P.postModify(r);break}}if(r==null)throw kTt(e);return r}}class jTt{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LTt(t,e,n){let r=1,i=null,s=null,o=!1,a=0;function l(){return a===2}let c=!1;function u(...v){c||(c=!0,e.apply(null,v))}function d(v){i=setTimeout(()=>{i=null,t(f,l())},v)}function h(){s&&clearTimeout(s)}function f(v,...x){if(c){h();return}if(v){h(),u.call(null,v,...x);return}if(l()||o){h(),u.call(null,v,...x);return}r<64&&(r*=2);let E;a===1?(a=2,E=0):E=(r+Math.random())*1e3,d(E)}let y=!1;function b(v){y||(y=!0,h(),!c&&(i!==null?(v||(a=2),clearTimeout(i),d(0)):v||(a=1)))}return d(0),s=setTimeout(()=>{o=!0,b(!0)},n),b}function FTt(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $Tt(t){return t!==void 0}function BTt(t){return typeof t=="object"&&!Array.isArray(t)}function W8(t){return typeof t=="string"||t instanceof String}function Sre(t){return K8()&&t instanceof Blob}function K8(){return typeof Blob<"u"&&!A_e()}function Cre(t,e,n,r){if(r<e)throw GB(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw GB(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kM(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function vTe(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const i=e(r)+"="+e(t[r]);n=n+i+"&"}return n=n.slice(0,-1),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Jp;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Jp||(Jp={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zTt(t,e){const n=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,s=e.indexOf(t)!==-1;return n||i||s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UTt{constructor(e,n,r,i,s,o,a,l,c,u,d,h=!0){this.url_=e,this.method_=n,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=d,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,y)=>{this.resolve_=f,this.reject_=y,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new NE(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;const a=s.getErrorCode()===Jp.NO_ERROR,l=s.getStatus();if(!a||zTt(l,this.additionalRetryCodes_)&&this.retry){const u=s.getErrorCode()===Jp.ABORT;r(!1,new NE(!1,null,u));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new NE(c,s))})},n=(r,i)=>{const s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());$Tt(l)?s(l):s()}catch(l){o(l)}else if(a!==null){const l=V8();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(i.canceled){const l=this.appDelete_?yTe():_Tt();o(l)}else{const l=PTt();o(l)}};this.canceled_?n(!1,new NE(!1,null,!0)):this.backoffId_=LTt(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&FTt(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class NE{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function HTt(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function VTt(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function WTt(t,e){e&&(t["X-Firebase-GMPID"]=e)}function KTt(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function qTt(t,e,n,r,i,s,o=!0){const a=vTe(t.urlParams),l=t.url+a,c=Object.assign({},t.headers);return WTt(c,e),HTt(c,n),VTt(c,s),KTt(c,r),new UTt(l,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GTt(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function YTt(...t){const e=GTt();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(K8())return new Blob(t);throw new Er(Cr.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function XTt(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JTt(t){if(typeof atob>"u")throw RTt("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lu={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class eF{constructor(e,n){this.data=e,this.contentType=n||null}}function ZTt(t,e){switch(t){case lu.RAW:return new eF(bTe(e));case lu.BASE64:case lu.BASE64URL:return new eF(xTe(t,e));case lu.DATA_URL:return new eF(eIt(e),tIt(e))}throw V8()}function bTe(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const s=r,o=t.charCodeAt(++n);r=65536|(s&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function QTt(t){let e;try{e=decodeURIComponent(t)}catch{throw kx(lu.DATA_URL,"Malformed data URL.")}return bTe(e)}function xTe(t,e){switch(t){case lu.BASE64:{const i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw kx(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case lu.BASE64URL:{const i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw kx(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=JTt(e)}catch(i){throw i.message.includes("polyfill")?i:kx(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class wTe{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw kx(lu.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=nIt(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function eIt(t){const e=new wTe(t);return e.base64?xTe(lu.BASE64,e.rest):QTt(e.rest)}function tIt(t){return new wTe(t).contentType}function nIt(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh{constructor(e,n){let r=0,i="";Sre(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,n){if(Sre(this.data_)){const r=this.data_,i=XTt(r,e,n);return i===null?null:new Hh(i)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new Hh(r,!0)}}static getBlob(...e){if(K8()){const n=e.map(r=>r instanceof Hh?r.data_:r);return new Hh(YTt.apply(null,n))}else{const n=e.map(o=>W8(o)?ZTt(lu.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const i=new Uint8Array(r);let s=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)i[s++]=o[a]}),new Hh(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function STe(t){let e;try{e=JSON.parse(t)}catch{return null}return BTt(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rIt(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function iIt(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function CTe(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sIt(t,e){return e}class ro{constructor(e,n,r,i){this.server=e,this.local=n||e,this.writable=!!r,this.xform=i||sIt}}let jE=null;function oIt(t){return!W8(t)||t.length<2?t:CTe(t)}function ETe(){if(jE)return jE;const t=[];t.push(new ro("bucket")),t.push(new ro("generation")),t.push(new ro("metageneration")),t.push(new ro("name","fullPath",!0));function e(s,o){return oIt(o)}const n=new ro("name");n.xform=e,t.push(n);function r(s,o){return o!==void 0?Number(o):o}const i=new ro("size");return i.xform=r,t.push(i),t.push(new ro("timeCreated")),t.push(new ro("updated")),t.push(new ro("md5Hash",null,!0)),t.push(new ro("cacheControl",null,!0)),t.push(new ro("contentDisposition",null,!0)),t.push(new ro("contentEncoding",null,!0)),t.push(new ro("contentLanguage",null,!0)),t.push(new ro("contentType",null,!0)),t.push(new ro("metadata","customMetadata",!0)),jE=t,jE}function aIt(t,e){function n(){const r=t.bucket,i=t.fullPath,s=new Ta(r,i);return e._makeStorageReference(s)}Object.defineProperty(t,"ref",{get:n})}function lIt(t,e,n){const r={};r.type="file";const i=n.length;for(let s=0;s<i;s++){const o=n[s];r[o.local]=o.xform(r,e[o.server])}return aIt(r,t),r}function TTe(t,e,n){const r=STe(e);return r===null?null:lIt(t,r,n)}function cIt(t,e,n,r){const i=STe(e);if(i===null||!W8(i.downloadTokens))return null;const s=i.downloadTokens;if(s.length===0)return null;const o=encodeURIComponent;return s.split(",").map(c=>{const u=t.bucket,d=t.fullPath,h="/b/"+o(u)+"/o/"+o(d),f=kM(h,n,r),y=vTe({alt:"media",token:c});return f+y})[0]}function uIt(t,e){const n={},r=e.length;for(let i=0;i<r;i++){const s=e[i];s.writable&&(n[s.server]=t[s.local])}return JSON.stringify(n)}class q8{constructor(e,n,r,i){this.url=e,this.method=n,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ITe(t){if(!t)throw V8()}function dIt(t,e){function n(r,i){const s=TTe(t,i,e);return ITe(s!==null),s}return n}function hIt(t,e){function n(r,i){const s=TTe(t,i,e);return ITe(s!==null),cIt(s,i,t.host,t._protocol)}return n}function PTe(t){function e(n,r){let i;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?i=TTt():i=ETt():n.getStatus()===402?i=CTt(t.bucket):n.getStatus()===403?i=ITt(t.path):i=r,i.status=n.getStatus(),i.serverResponse=r.serverResponse,i}return e}function _Te(t){const e=PTe(t);function n(r,i){let s=e(r,i);return r.getStatus()===404&&(s=STt(t.path)),s.serverResponse=i.serverResponse,s}return n}function fIt(t,e,n){const r=e.fullServerUrl(),i=kM(r,t.host,t._protocol),s="GET",o=t.maxOperationRetryTime,a=new q8(i,s,hIt(t,n),o);return a.errorHandler=_Te(e),a}function pIt(t,e){const n=e.fullServerUrl(),r=kM(n,t.host,t._protocol),i="DELETE",s=t.maxOperationRetryTime;function o(l,c){}const a=new q8(r,i,o,s);return a.successCodes=[200,204],a.errorHandler=_Te(e),a}function gIt(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function mIt(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=gIt(null,e)),r}function yIt(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let E="";for(let I=0;I<2;I++)E=E+Math.random().toString().slice(2);return E}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=mIt(e,r,i),u=uIt(c,n),d="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,h=`\r
--`+l+"--",f=Hh.getBlob(d,r,h);if(f===null)throw OTt();const y={name:c.fullPath},b=kM(s,t.host,t._protocol),v="POST",x=t.maxUploadRetryTime,C=new q8(b,v,dIt(t,n),x);return C.urlParams=y,C.headers=o,C.body=f.uploadData(),C.errorHandler=PTe(e),C}class vIt{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Jp.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Jp.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Jp.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,i){if(this.sent_)throw bb("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw bb("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw bb("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw bb("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw bb("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class bIt extends vIt{initXhr(){this.xhr_.responseType="text"}}function G8(){return new bIt}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(e,n){this._service=e,n instanceof Ta?this._location=n:this._location=Ta.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new _g(e,n)}get root(){const e=new Ta(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return CTe(this._location.path)}get storage(){return this._service}get parent(){const e=rIt(this._location.path);if(e===null)return null;const n=new Ta(this._location.bucket,e);return new _g(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw NTt(e)}}function xIt(t,e,n){t._throwIfRoot("uploadBytes");const r=yIt(t.storage,t._location,ETe(),new Hh(e,!0),n);return t.storage.makeRequestWithTokens(r,G8).then(i=>({metadata:i,ref:t}))}function wIt(t){t._throwIfRoot("getDownloadURL");const e=fIt(t.storage,t._location,ETe());return t.storage.makeRequestWithTokens(e,G8).then(n=>{if(n===null)throw DTt();return n})}function SIt(t){t._throwIfRoot("deleteObject");const e=pIt(t.storage,t._location);return t.storage.makeRequestWithTokens(e,G8)}function CIt(t,e){const n=iIt(t._location.path,e),r=new Ta(t._location.bucket,n);return new _g(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EIt(t){return/^[A-Za-z]+:\/\//.test(t)}function TIt(t,e){return new _g(t,e)}function kTe(t,e){if(t instanceof Y8){const n=t;if(n._bucket==null)throw MTt();const r=new _g(n,n._bucket);return e!=null?kTe(r,e):r}else return e!==void 0?CIt(t,e):t}function IIt(t,e){if(e&&EIt(e)){if(t instanceof Y8)return TIt(t,e);throw GB("To use ref(service, url), the first argument must be a Storage instance.")}else return kTe(t,e)}function Ere(t,e){const n=e==null?void 0:e[mTe];return n==null?null:Ta.makeFromBucketSpec(n,t)}function PIt(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:tie(i,t.app.options.projectId))}class Y8{constructor(e,n,r,i,s){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=gTe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=xTt,this._maxUploadRetryTime=wTt,this._requests=new Set,i!=null?this._bucket=Ta.makeFromBucketSpec(i,this._host):this._bucket=Ere(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ta.makeFromBucketSpec(this._url,e):this._bucket=Ere(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Cre("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Cre("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new _g(this,e)}_makeRequest(e,n,r,i,s=!0){if(this._deleted)return new jTt(yTe());{const o=qTt(e,this._appId,r,i,n,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,i).getPromise()}}const Tre="@firebase/storage",Ire="0.11.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ATe="storage";function MTe(t,e,n){return t=Nn(t),xIt(t,e,n)}function OTe(t){return t=Nn(t),wIt(t)}function _It(t){return t=Nn(t),SIt(t)}function X8(t,e){return t=Nn(t),IIt(t,e)}function kIt(t=I_(),e){t=Nn(t);const r=Tf(t,ATe).getImmediate({identifier:e}),i=Zre("storage");return i&&AIt(r,...i),r}function AIt(t,e,n,r={}){PIt(t,e,n,r)}function MIt(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new Y8(n,r,i,e,Mg)}function OIt(){yc(new Al(ATe,MIt,"PUBLIC").setMultipleInstances(!0)),Xo(Tre,Ire,""),Xo(Tre,Ire,"esm2017")}OIt();const J8=Gd(Co),Z8=kIt(Co);async function Q8(t,e){const n=X8(Z8,`projectFiles/${t}/${e.name}`);await MTe(n,e);const r=await OTe(n),i=new Date().toISOString();return{id:(await y1(Rc(J8,"projectFiles"),{projectId:t,name:e.name,type:e.type,size:e.size,url:r,uploadedAt:i})).id,projectId:t,name:e.name,type:e.type,size:e.size,url:r,uploadedAt:i}}async function YB(t){const e=n0(Rc(J8,"projectFiles"),r0("projectId","==",t));return(await i0(e)).docs.map(r=>({id:r.id,...r.data()}))}async function DIt(t,e,n){const r=X8(Z8,`projectFiles/${e}/${n}`);try{await _It(r)}catch(i){if(i.code!=="storage/object-not-found")throw i}await m1(na(J8,"projectFiles",t))}async function eH(t,e){const n=X8(Z8,`projectImages/${t}/${e.name}`);return await MTe(n,e),await OTe(n)}const RIt=Object.freeze(Object.defineProperty({__proto__:null,deleteProjectFile:DIt,getFilesForProject:YB,uploadProjectFile:Q8,uploadProjectImage:eH},Symbol.toStringTag,{value:"Module"})),AM=Gd(Co);async function NIt(t){const e=new Date().toISOString(),n=await y1(Rc(AM,"tasks"),{...t,createdAt:e});return{...t,id:n.id,createdAt:e}}async function DTe(t){const e=n0(Rc(AM,"tasks"),r0("projectId","==",t));return(await i0(e)).docs.map(r=>({id:r.id,...r.data()}))}async function RTe(t,e){await IM(na(AM,"tasks",t),e)}async function jIt(t){await m1(na(AM,"tasks",t))}var er=(t=>(t.ToDo="A Fazer",t.InProgress="Em Andamento",t.Done="Concluído",t))(er||{});const _T={TODO:er.ToDo,IN_PROGRESS:er.InProgress,DONE:er.Done};function LIt(){const[t,e]=S.useState(()=>typeof window<"u"&&localStorage.getItem("theme")||"dark");return S.useEffect(()=>{const r=document.documentElement;t==="dark"?(r.classList.add("dark"),r.style.setProperty("--bg-main","#18181b"),r.style.setProperty("--bg-card","#23232b"),r.style.setProperty("--bg-secondary","#23232b"),r.style.setProperty("--text-primary","#fff"),r.style.setProperty("--text-secondary","#a1a1aa"),r.style.setProperty("--accent","#3b82f6"),r.style.setProperty("--primary","#2563eb")):(r.classList.remove("dark"),r.style.setProperty("--bg-main","#f3f4f6"),r.style.setProperty("--bg-card","#fff"),r.style.setProperty("--bg-secondary","#f1f5f9"),r.style.setProperty("--text-primary","#18181b"),r.style.setProperty("--text-secondary","#52525b"),r.style.setProperty("--accent","#2563eb"),r.style.setProperty("--primary","#3b82f6")),localStorage.setItem("theme",t)},[t]),{theme:t,toggleTheme:()=>e(r=>r==="dark"?"light":"dark")}}const FIt=({onSave:t,onCancel:e})=>{const[n,r]=S.useState(""),[i,s]=S.useState(""),[o,a]=S.useState(""),[l,c]=S.useState(""),[u,d]=S.useState(null),h=f=>{f.preventDefault(),t({name:n,description:i,startDate:o,endDate:l,imageFile:u})};return g.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",children:g.jsxs("div",{className:"bg-card rounded-lg shadow-xl p-6 w-full max-w-lg",children:[g.jsx("h3",{className:"text-xl font-bold mb-4",children:"Novo Projeto"}),g.jsxs("form",{onSubmit:h,className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{htmlFor:"proj-name",className:"block text-sm font-medium text-text-secondary",children:"Nome do Projeto"}),g.jsx("input",{id:"proj-name",type:"text",value:n,onChange:f=>r(f.target.value),required:!0,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent"})]}),g.jsxs("div",{children:[g.jsx("label",{htmlFor:"proj-desc",className:"block text-sm font-medium text-text-secondary",children:"Descrição"}),g.jsx("textarea",{id:"proj-desc",value:i,onChange:f=>s(f.target.value),rows:3,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent"})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[g.jsxs("div",{children:[g.jsx("label",{htmlFor:"proj-start",className:"block text-sm font-medium text-text-secondary",children:"Data de Início"}),g.jsx("input",{id:"proj-start",type:"date",value:o,onChange:f=>a(f.target.value),required:!0,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent"})]}),g.jsxs("div",{children:[g.jsx("label",{htmlFor:"proj-end",className:"block text-sm font-medium text-text-secondary",children:"Data de Término"}),g.jsx("input",{id:"proj-end",type:"date",value:l,onChange:f=>c(f.target.value),required:!0,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent"})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-text-secondary",children:"Imagem do Projeto"}),g.jsxs("label",{className:"block mt-1",children:[g.jsx("span",{className:"sr-only",children:"Escolher imagem"}),g.jsx("input",{type:"file",accept:"image/*",onChange:f=>{var y;return d(((y=f.target.files)==null?void 0:y[0])||null)},className:"block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-accent/20 file:text-accent hover:file:bg-accent/30"})]}),u&&g.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Imagem selecionada: ",u.name]})]}),g.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[g.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 rounded-md bg-secondary hover:bg-gray-600",children:"Cancelar"}),g.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md bg-primary text-white hover:bg-blue-700",children:"Salvar Projeto"})]})]})]})})},$It=()=>{const{user:t}=S.useContext(tH),{theme:e}=LIt(),[n,r]=S.useState([]),[i,s]=S.useState([]),[o,a]=S.useState(!1),[l,c]=S.useState("projects"),[u,d]=S.useState(!0),[h,f]=S.useState("");console.log("DashboardPage renderizado, usuário:",t?`Logado: ${t.name}`:"Não logado");const y={[er.ToDo]:"#f97316",[er.InProgress]:"#3b82f6",[er.Done]:"#22c55e"};S.useEffect(()=>{if(!t){d(!1);return}(async()=>{d(!0);try{const I=await yTt(t.uid);if(r(I),I.length>0){const P=I.map(A=>DTe(A.id)),_=await Promise.all(P);s(_.flat())}}catch(I){f(I.message||"Falha ao carregar os dados.")}finally{d(!1)}})()},[t]);const b=async E=>{if(t)try{const{imageFile:I,...P}=E,_=await mTt({...P,imageUrl:""},t.uid);if(I){const A=await eH(_.id,I);await pTe(_.id,{imageUrl:A}),_.imageUrl=A}r(A=>[...A,_]),a(!1)}catch(I){f(I.message||"Falha ao criar projeto.")}},v=async E=>{const{source:I,destination:P,draggableId:_}=E;if(!P||I.droppableId===P.droppableId)return;const A=P.droppableId,D=I.droppableId,L=i.map(z=>z.id===_?{...z,status:A}:z);s(L);try{await RTe(_,{status:A})}catch(z){console.error("Falha ao atualizar tarefa:",z),s(i.map($=>$.id===_?{...$,status:D}:$)),f("Não foi possível mover a tarefa. Tente novamente.")}},x=$e.useMemo(()=>{const E=i.length,I=i.filter(A=>A.status===_T.DONE).length,P=E-I,_=Object.values(_T).map(A=>({name:A,value:i.filter(D=>D.status===A).length})).filter(A=>A.value>0);return{total:E,done:I,pending:P,distribution:_}},[i]),C=({title:E,value:I,icon:P})=>g.jsxs("div",{className:"bg-secondary p-4 rounded-lg flex items-center space-x-4",children:[g.jsx("div",{className:"bg-gray-900/50 p-3 rounded-full",children:P}),g.jsxs("div",{children:[g.jsx("p",{className:"text-sm text-text-secondary",children:E}),g.jsx("p",{className:"text-2xl font-bold text-text-primary",children:I})]})]});return g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"flex justify-between items-center border-b border-gray-600",children:[g.jsxs("div",{className:"flex space-x-4",children:[g.jsx("button",{onClick:()=>c("projects"),className:`px-4 py-2 font-medium transition-colors ${l==="projects"?"text-accent border-b-2 border-accent":"text-text-secondary hover:text-text-primary"}`,children:"Seus Projetos"}),g.jsx("button",{onClick:()=>c("tasks"),className:`px-4 py-2 font-medium transition-colors ${l==="tasks"?"text-accent border-b-2 border-accent":"text-text-secondary hover:text-text-primary"}`,children:"Tarefas"}),g.jsx("button",{onClick:()=>c("tldraw"),className:`px-4 py-2 font-medium transition-colors ${l==="tldraw"?"text-accent border-b-2 border-accent":"text-text-secondary hover:text-text-primary"}`,children:"TL;Draw"})]}),l==="projects"&&g.jsxs("button",{onClick:()=>a(!0),className:"bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center space-x-2 transition-colors",children:[g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:g.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),g.jsx("span",{children:"Novo Projeto"})]})]}),g.jsxs("div",{className:"p-8",style:{marginTop:"-15px"},children:[o&&g.jsx(FIt,{onSave:b,onCancel:()=>a(!1)}),u&&g.jsx("p",{children:"Carregando dados..."}),h&&g.jsx("p",{className:"text-red-400",children:h}),!u&&n.length===0&&g.jsxs("div",{className:"text-center py-16 bg-card rounded-lg",children:[g.jsx("h3",{className:"text-xl font-medium text-text-primary",children:"Nenhum projeto encontrado."}),g.jsx("p",{className:"text-text-secondary mt-2",children:"Comece criando seu primeiro projeto!"})]}),l==="projects"&&!u&&g.jsx(BIt,{projects:n,tasks:i}),l==="tldraw"&&g.jsx("div",{style:{width:"100%",height:"calc(100vh - 200px)",minHeight:600,backgroundColor:e==="dark"?"#18181b":"#f3f4f6",borderRadius:"8px",border:`1px solid ${e==="dark"?"#374151":"#e5e7eb"}`,overflow:"hidden"},children:g.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden"},children:g.jsx(gTt,{userId:(t==null?void 0:t.uid)||"",theme:e})})}),l==="tasks"&&!u&&g.jsxs("div",{children:[g.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Panorama Geral das Tarefas"}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[g.jsx("div",{className:"md:col-span-2 lg:col-span-1",children:g.jsxs("div",{className:"bg-card p-4 rounded-lg shadow-lg h-full flex flex-col justify-center",children:[g.jsx("h3",{className:"text-lg font-semibold mb-4 text-center",children:"Status das Tarefas"}),g.jsx("div",{style:{width:"100%",height:220},children:g.jsx(mk,{width:"100%",height:"100%",children:g.jsxs(yk,{children:[g.jsx(yS,{data:x.distribution,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:"70%",label:!0,children:x.distribution.map((E,I)=>g.jsx(Lg,{fill:y[E.name]},`cell-${I}`))}),g.jsx(mz,{contentStyle:{backgroundColor:"#1f2937",borderColor:"#374151"}}),g.jsx(wv,{})]})})})]})}),g.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-6",children:[g.jsx(C,{title:"Total de Tarefas",value:x.total,icon:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),g.jsx(C,{title:"Tarefas Pendentes",value:x.pending,icon:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),g.jsx(C,{title:"Tarefas Concluídas",value:x.done,icon:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})]}),g.jsx(voe,{onDragEnd:v,children:g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.values(_T).map(E=>g.jsx(_oe,{droppableId:E,children:I=>g.jsxs("div",{ref:I.innerRef,...I.droppableProps,className:"bg-card p-4 rounded-lg min-h-[300px]",children:[g.jsx("h3",{className:`font-bold text-lg mb-4 ${E==="A Fazer"?"text-orange-500":E==="Em Andamento"?"text-blue-500":"text-green-500"}`,children:E}),i.filter(P=>P.status===E).sort((P,_)=>new Date(_.createdAt).getTime()-new Date(P.createdAt).getTime()).map((P,_)=>g.jsx(Coe,{draggableId:P.id,index:_,children:A=>{var D;return g.jsxs("div",{ref:A.innerRef,...A.draggableProps,...A.dragHandleProps,className:"mb-4 bg-secondary p-3 rounded-md shadow",children:[g.jsx("div",{className:"font-semibold text-text-primary",children:P.title}),g.jsx("div",{className:"text-sm text-text-secondary",children:P.description}),g.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Projeto: ",((D=n.find(L=>L.id===P.projectId))==null?void 0:D.name)||"Desconhecido"]})]})}},P.id)),I.placeholder]})},E))})})]})]})]})};function BIt({projects:t,tasks:e}){const n={[er.ToDo]:"#f97316",[er.InProgress]:"#3b82f6",[er.Done]:"#22c55e"};return g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(r=>{const i=e.filter(o=>o.projectId===r.id),s=Object.values(_T).map(o=>({name:o,value:i.filter(a=>a.status===o).length})).filter(o=>o.value>0);return g.jsxs(IF,{to:`/project/${r.id}`,className:"block bg-card p-6 rounded-lg shadow-lg hover:shadow-xl hover:scale-[1.02] transition-transform duration-300 relative",children:[r.imageUrl&&g.jsx("div",{className:"w-full h-32 flex items-center justify-center bg-secondary rounded-md mb-3 overflow-hidden",children:g.jsx("img",{src:r.imageUrl,alt:r.name,className:"max-h-full max-w-full object-contain"})}),g.jsx("h3",{className:"text-xl font-bold text-accent",children:r.name}),g.jsx("p",{className:"text-text-secondary mt-2 h-12 overflow-hidden text-ellipsis",children:r.description}),g.jsxs("div",{className:"flex justify-between items-end mt-4",children:[g.jsxs("div",{className:"text-sm text-gray-400",children:[g.jsxs("p",{children:["Início: ",new Date(r.startDate).toLocaleDateString()]}),g.jsxs("p",{children:["Término: ",new Date(r.endDate).toLocaleDateString()]})]}),g.jsx("div",{style:{width:60,height:60},className:"flex-shrink-0",children:s.length>0&&g.jsx(mk,{width:"100%",height:"100%",children:g.jsx(yk,{children:g.jsx(yS,{data:s,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:"80%",children:s.map((o,a)=>g.jsx(Lg,{fill:n[o.name]},`cell-mini-${a}`))})})})})]})]},r.id)})})}const zIt="modulepreload",UIt=function(t){return"/project-manager/"+t},Pre={},HIt=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let o=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=o(n.map(c=>{if(c=UIt(c),c in Pre)return;Pre[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":zIt,u||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),u)return new Promise((f,y)=>{h.addEventListener("load",f),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},MM=Gd(Co);async function _re(t){const e=new Date().toISOString(),n=await y1(Rc(MM,"notes"),{...t,createdAt:e});return{...t,id:n.id,createdAt:e}}async function VIt(t){const e=n0(Rc(MM,"notes"),r0("projectId","==",t));return(await i0(e)).docs.map(r=>({id:r.id,...r.data()}))}async function WIt(t,e){await IM(na(MM,"notes",t),e)}async function KIt(t){await m1(na(MM,"notes",t))}const OM=Gd(Co);async function qIt(t){const e=new Date().toISOString(),n=await y1(Rc(OM,"taskNotes"),{...t,createdAt:e});return{...t,id:n.id,createdAt:e}}async function GIt(t){const e=n0(Rc(OM,"taskNotes"),r0("taskId","==",t));return(await i0(e)).docs.map(r=>({id:r.id,...r.data()}))}async function YIt(t,e){await IM(na(OM,"taskNotes",t),e)}async function XIt(t){await m1(na(OM,"taskNotes",t))}const Ty=[er.ToDo,er.InProgress,er.Done];function JIt(t=!0){const[e,n]=$e.useState(t);return{open:e,toggle:()=>n(i=>!i)}}const ZIt={[er.ToDo]:"#f97316",[er.InProgress]:"#3b82f6",[er.Done]:"#22c55e"},tF=({title:t,value:e,icon:n})=>g.jsxs("div",{className:"bg-secondary p-4 rounded-lg flex items-center space-x-4",children:[g.jsx("div",{className:"bg-gray-900/50 p-3 rounded-full",children:n}),g.jsxs("div",{children:[g.jsx("p",{className:"text-sm text-text-secondary",children:t}),g.jsx("p",{className:"text-2xl font-bold text-text-primary",children:e})]})]}),NTe=({note:t,onUpdate:e,onDelete:n})=>{const[r,i]=S.useState(!1),[s,o]=S.useState(t.content),a=()=>{s.trim()&&(e(t.id,s),i(!1))};return g.jsxs("div",{className:"bg-secondary p-4 rounded-lg",children:[r?g.jsx("textarea",{value:s,onChange:l=>o(l.target.value),rows:4,className:"w-full bg-gray-900/80 p-2 rounded-md focus:outline-none focus:ring-1 focus:ring-accent"}):g.jsx("p",{className:"text-text-secondary whitespace-pre-wrap",children:t.content}),g.jsxs("div",{className:"text-xs text-gray-500 mt-3",children:["Criado em: ",new Date(t.createdAt).toLocaleString()]}),g.jsx("div",{className:"flex items-center justify-end space-x-2 mt-3",children:r?g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:()=>{i(!1),o(t.content)},className:"text-sm px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700",children:"Cancelar"}),g.jsx("button",{onClick:a,className:"text-sm px-3 py-1 rounded-md bg-primary hover:bg-blue-700",children:"Salvar"})]}):g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:()=>i(!0),className:"text-gray-400 hover:text-accent",children:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.5 3.464z"})})}),g.jsx("button",{onClick:()=>n(t.id),className:"text-gray-400 hover:text-red-500",children:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]})},QIt=({task:t,onClose:e,onUpdateTask:n,onDeleteTask:r})=>{const[i,s]=S.useState(t.status),[o,a]=S.useState([]),[l,c]=S.useState(""),[u,d]=S.useState(!0);S.useEffect(()=>{(async()=>{d(!0);const C=await GIt(t.id);a(C),d(!1)})()},[t.id]);const h=async x=>{s(x),await n(t.id,{status:x})},f=async()=>{window.confirm("Tem certeza que deseja excluir esta tarefa?")&&(await r(t.id),e())},y=async x=>{if(x.preventDefault(),!l.trim())return;const C=await qIt({taskId:t.id,content:l});a(E=>[C,...E]),c("")},b=async(x,C)=>{await YIt(x,{content:C}),a(o.map(E=>E.id===x?{...E,content:C}:E))},v=async x=>{await XIt(x),a(o.filter(C=>C.id!==x))};return g.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50",onClick:e,children:g.jsxs("div",{className:"bg-card rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col",onClick:x=>x.stopPropagation(),children:[g.jsxs("div",{className:"p-6 border-b border-gray-700 flex justify-between items-start",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-2xl font-bold text-accent",children:t.title}),g.jsx("p",{className:"text-text-secondary mt-1",children:t.description})]}),g.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:"×"})]}),g.jsxs("div",{className:"p-6 overflow-y-auto flex-grow",children:[g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[g.jsxs("div",{children:[g.jsx("label",{className:"text-sm font-medium text-text-secondary",children:"Status"}),g.jsx("select",{value:i,onChange:x=>h(x.target.value),className:"mt-1 w-full bg-secondary p-2 rounded-md",children:Ty.map(x=>g.jsx("option",{value:x,children:x},x))})]}),g.jsxs("div",{children:[g.jsx("label",{className:"text-sm font-medium text-text-secondary",children:"Criada em"}),g.jsx("p",{className:"mt-1 text-text-primary",children:new Date(t.createdAt).toLocaleString()})]})]}),g.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-3",children:"Anotações da Tarefa"}),g.jsxs("form",{onSubmit:y,className:"mb-4",children:[g.jsx("textarea",{value:l,onChange:x=>c(x.target.value),placeholder:"Adicionar uma anotação...",rows:2,className:"w-full bg-secondary p-2 rounded-md mb-2"}),g.jsx("div",{className:"text-right",children:g.jsx("button",{type:"submit",className:"px-4 py-2 text-sm rounded-md bg-primary text-white hover:bg-blue-700",children:"Adicionar"})})]}),g.jsxs("div",{className:"space-y-3",children:[u?g.jsx("p",{children:"Carregando anotações..."}):o.map(x=>g.jsx(NTe,{note:{...x,projectId:""},onUpdate:(C,E)=>b(C,E),onDelete:v},x.id)),!u&&o.length===0&&g.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Nenhuma anotação para esta tarefa."})]})]}),g.jsx("div",{className:"p-4 bg-secondary/50 rounded-b-lg flex justify-end",children:g.jsx("button",{onClick:f,className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700",children:"Excluir Tarefa"})})]})})},ePt=({projectId:t,files:e,onFileChange:n})=>{const r=S.useRef(null),i=async a=>{var c;const l=(c=a.target.files)==null?void 0:c[0];if(l)try{await Q8(t,l),n()}catch{alert("Falha no upload do arquivo.")}finally{r.current&&(r.current.value="")}},s=async(a,l)=>{if(window.confirm("Tem certeza que deseja excluir este arquivo?"))try{await deleteProjectFile(a,t,l),n()}catch{alert("Falha ao excluir o arquivo.")}},o=a=>{if(a===0)return"0 Bytes";const l=1024,c=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(a)/Math.log(l));return parseFloat((a/Math.pow(l,u)).toFixed(2))+" "+c[u]};return g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx("h2",{className:"text-2xl font-bold",children:"Arquivos do Projeto"}),g.jsx("input",{type:"file",ref:r,onChange:i,className:"hidden"}),g.jsx("button",{onClick:()=>{var a;return(a=r.current)==null?void 0:a.click()},className:"bg-accent/20 text-accent px-4 py-2 rounded-md hover:bg-accent/30 text-sm",children:"Adicionar Arquivo"})]}),g.jsx("div",{className:"bg-card p-4 rounded-lg",children:g.jsxs("ul",{className:"space-y-3",children:[e.map(a=>g.jsxs("li",{className:"flex items-center justify-between p-3 bg-secondary rounded-md",children:[g.jsxs("div",{className:"flex items-center space-x-4",children:[g.jsx("span",{children:"📄"})," ",g.jsxs("div",{children:[g.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-text-primary hover:underline cursor-pointer",children:a.name}),g.jsxs("p",{className:"text-sm text-text-secondary",children:[o(a.size)," - ",new Date(a.uploadedAt).toLocaleDateString()]})]})]}),g.jsx("button",{onClick:()=>s(a.id,a.name),className:"text-gray-400 hover:text-red-500",children:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},a.id)),e.length===0&&g.jsx("p",{className:"text-center text-gray-500 py-8",children:"Nenhum arquivo anexado."})]})})]})},tPt=({notes:t,files:e,onAddNote:n,onUploadFile:r,open:i,toggle:s,onDeleteNote:o,onUpdateNote:a})=>{const[l,c]=S.useState(""),u=S.useRef(null);if(!i)return g.jsx("button",{onClick:s,className:"fixed right-0 top-1/2 z-50 bg-accent text-white rounded-l px-2 py-1 shadow-lg",children:"<"});const d=f=>{f.preventDefault(),l.trim()&&(n(l),c(""))},h=f=>{var b;const y=(b=f.target.files)==null?void 0:b[0];y&&(r(y),u.current&&(u.current.value=""))};return g.jsxs("aside",{className:"fixed right-0 top-0 w-80 h-full bg-card border-l border-gray-700 flex flex-col shadow-xl transition-all duration-300 z-40",children:[g.jsx("button",{onClick:s,className:"absolute left-0 -translate-x-full top-1/2 z-50 bg-accent text-white rounded-r px-2 py-1 shadow-lg",children:">"}),g.jsxs("div",{className:"flex-1 flex flex-col divide-y divide-gray-700 h-full",children:[g.jsxs("div",{className:"flex-1 flex flex-col p-4 overflow-y-auto",style:{maxHeight:"50%"},children:[g.jsx("h3",{className:"text-lg font-bold mb-2",children:"Notas do Projeto"}),g.jsxs("form",{onSubmit:d,className:"mb-3",children:[g.jsx("textarea",{value:l,onChange:f=>c(f.target.value),rows:2,placeholder:"Adicionar nota...",className:"w-full bg-secondary p-2 rounded-md mb-2"}),g.jsx("button",{type:"submit",className:"w-full bg-primary text-white py-1 rounded-md",children:"Adicionar"})]}),g.jsxs("div",{className:"space-y-2 overflow-y-auto",children:[t.length===0&&g.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma nota."}),t.map(f=>g.jsx(nPt,{note:f,onUpdate:a,onDelete:o},f.id))]})]}),g.jsxs("div",{className:"flex-1 flex flex-col p-4 overflow-y-auto",style:{maxHeight:"50%"},children:[g.jsx("h3",{className:"text-lg font-bold mb-2",children:"Anexos do Projeto"}),g.jsxs("label",{className:"block mb-2",children:[g.jsx("span",{className:"sr-only",children:"Escolher anexo"}),g.jsx("input",{type:"file",ref:u,onChange:h,className:"block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-accent/20 file:text-accent hover:file:bg-accent/30"})]}),g.jsxs("div",{className:"space-y-2 overflow-y-auto",children:[e.length===0&&g.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum anexo."}),e.map(f=>g.jsxs("div",{className:"bg-secondary p-2 rounded-md text-sm flex items-center justify-between",children:[g.jsx("a",{href:f.url,target:"_blank",rel:"noopener noreferrer",className:"hover:underline cursor-pointer flex-1",children:f.name.length>24?f.name.slice(0,21)+"...":f.name}),g.jsx("span",{className:"text-xs text-gray-400 ml-2",children:new Date(f.uploadedAt).toLocaleDateString()}),g.jsx("button",{onClick:async()=>{if(window.confirm("Tem certeza que deseja excluir este arquivo?"))try{await HIt(()=>Promise.resolve().then(()=>RIt),void 0).then(y=>y.deleteProjectFile(f.id,f.projectId,f.name)),typeof window<"u"&&window.location&&window.location.reload()}catch{alert("Falha ao excluir o arquivo.")}},className:"ml-2 text-gray-400 hover:text-red-500",title:"Excluir anexo",children:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},f.id))]})]})]})]})},nPt=({note:t,onUpdate:e,onDelete:n})=>{const[r,i]=S.useState(!1),[s,o]=S.useState(t.content);return g.jsxs("div",{className:"bg-secondary p-2 rounded-md text-sm mb-2",children:[r?g.jsx("textarea",{value:s,onChange:a=>o(a.target.value),rows:2,className:"w-full bg-gray-900/80 p-2 rounded-md mb-2"}):g.jsx("div",{className:"text-text-secondary whitespace-pre-wrap",children:t.content}),g.jsxs("div",{className:"flex items-center justify-between mt-1",children:[g.jsx("div",{className:"text-xs text-gray-400",children:new Date(t.createdAt).toLocaleDateString()}),g.jsx("div",{className:"flex space-x-2",children:r?g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:()=>{e(t.id,s),i(!1)},className:"text-xs text-primary",children:"Salvar"}),g.jsx("button",{onClick:()=>{i(!1),o(t.content)},className:"text-xs text-gray-400",children:"Cancelar"})]}):g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:()=>i(!0),className:"text-xs text-accent",children:"Editar"}),g.jsx("button",{onClick:()=>n(t.id),className:"text-xs text-red-500",children:"Excluir"})]})})]})]})},rPt=()=>{const{projectId:t}=Hre(),e=Yw(),[n,r]=S.useState(null),[i,s]=S.useState([]),[o,a]=S.useState([]),[l,c]=S.useState([]),[u,d]=S.useState(!0),[h,f]=S.useState(""),[y,b]=S.useState("tasks"),[v,x]=S.useState(null),[C,E]=S.useState(!1),[I,P]=S.useState(""),[_,A]=S.useState(""),[D,L]=S.useState(!1),[z,$]=S.useState(""),[H,R]=S.useState(!1),[j,B]=S.useState({name:"",description:"",startDate:"",endDate:"",imageUrl:""}),[K,G]=S.useState(null),V=()=>{n&&(B({name:n.name,description:n.description,startDate:n.startDate,endDate:n.endDate,imageUrl:n.imageUrl||""}),G(null),R(!0))},W=async pe=>{if(pe.preventDefault(),!!n)try{let Se=j.imageUrl;K&&(Se=await eH(n.id,K)),await pTe(n.id,{...j,imageUrl:Se}),r(Fe=>Fe&&{...Fe,...j,imageUrl:Se}),R(!1)}catch{alert("Erro ao atualizar projeto.")}},Z=S.useCallback(async()=>{if(t)try{d(!0);const[pe,Se,Fe,ut]=await Promise.all([vTt(t),DTe(t),VIt(t),YB(t)]);pe?(r(pe),s(Se),a(Fe),c(ut)):f("Projeto não encontrado.")}catch(pe){f(pe.message||"Erro ao carregar dados do projeto.")}finally{d(!1)}},[t]);S.useEffect(()=>{Z()},[Z]);const U=async(pe,Se)=>{const Fe=[...i],ut=i.map(Tt=>Tt.id===pe?{...Tt,...Se}:Tt);s(ut),v&&v.id===pe&&x({...v,...Se});try{await RTe(pe,Se)}catch{s(Fe),alert("Falha ao atualizar tarefa.")}},J=async pe=>{const Se=[...i];s(i.filter(Fe=>Fe.id!==pe));try{await jIt(pe)}catch{s(Se),alert("Falha ao excluir tarefa.")}},ge=async pe=>{if(pe.preventDefault(),!(!t||!I))try{const Se=await NIt({title:I,description:_,projectId:t,status:er.ToDo});s(Fe=>[...Fe,Se]),P(""),A(""),E(!1)}catch{alert("Falha ao criar tarefa.")}},_e=async pe=>{if(pe.preventDefault(),!(!t||!z.trim()))try{const Se=await _re({content:z,projectId:t});a(Fe=>[Se,...Fe]),$(""),L(!1)}catch{alert("Falha ao criar nota.")}},fe=async(pe,Se)=>{const Fe=[...o];a(o.map(ut=>ut.id===pe?{...ut,content:Se}:ut));try{await WIt(pe,{content:Se})}catch{a(Fe),alert("Falha ao atualizar nota.")}},je=async pe=>{if(window.confirm("Tem certeza que deseja excluir esta nota?")){const Se=[...o];a(o.filter(Fe=>Fe.id!==pe));try{await KIt(pe)}catch{a(Se),alert("Falha ao excluir nota.")}}},Ae=async()=>{if(n&&window.confirm(`Tem certeza que deseja excluir o projeto "${n.name}"? Esta ação não pode ser desfeita.`))try{await bTt(n.id),e("/dashboard")}catch{alert("Falha ao excluir o projeto.")}},ke=async()=>{if(n)try{const pe=await generateShareLink(n.id);navigator.clipboard.writeText(pe).then(()=>alert(`Link de compartilhamento copiado!
${pe}`)).catch(()=>alert(`Aqui está seu link:
${pe}`)),await Z()}catch{alert("Falha ao gerar link de compartilhamento.")}},le=S.useMemo(()=>{const pe=i.length,Se=i.filter(Tt=>Tt.status===er.Done).length,Fe=pe-Se,ut=Ty.map(Tt=>({name:Tt,value:i.filter(pn=>pn.status===Tt).length})).filter(Tt=>Tt.value>0);return{total:pe,done:Se,pending:Fe,distribution:ut}},[i]),ve=Ty.reduce((pe,Se)=>(pe[Se]=i.filter(Fe=>Fe.status===Se),pe),{}),qe=async pe=>{const{source:Se,destination:Fe,draggableId:ut}=pe;if(!Fe||Se.droppableId===Fe.droppableId)return;const Tt=Fe.droppableId;await U(ut,{status:Tt})},de=JIt(!0);return u?g.jsx("div",{className:"text-center p-10",children:"Carregando..."}):h?g.jsx("div",{className:"text-center p-10 text-red-400",children:h}):n?g.jsxs("div",{className:"flex flex-row h-full",children:[g.jsxs("div",{className:`flex-1 space-y-6 transition-all duration-300 ${de.open?"mr-56":""}`,children:[v&&g.jsx(QIt,{task:v,onClose:()=>x(null),onUpdateTask:U,onDeleteTask:J}),H&&g.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-xl w-full max-w-lg",children:[g.jsx("h2",{className:"text-xl font-bold mb-4",children:"Editar Projeto"}),g.jsxs("form",{onSubmit:W,className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-text-secondary",children:"Imagem do Projeto"}),g.jsxs("label",{className:"block mt-1",children:[g.jsx("span",{className:"sr-only",children:"Escolher imagem"}),g.jsx("input",{type:"file",accept:"image/*",onChange:pe=>{var Se;return G(((Se=pe.target.files)==null?void 0:Se[0])||null)},className:"block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-accent/20 file:text-accent hover:file:bg-accent/30"})]}),j.imageUrl&&!K&&g.jsx("img",{src:j.imageUrl,alt:"Imagem do Projeto",className:"w-full h-32 object-cover rounded-md mt-2"}),K&&g.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Nova imagem selecionada: ",K.name]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-text-secondary",children:"Nome"}),g.jsx("input",{type:"text",value:j.name,onChange:pe=>B({...j,name:pe.target.value}),required:!0,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md"})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-text-secondary",children:"Descrição"}),g.jsx("textarea",{value:j.description,onChange:pe=>B({...j,description:pe.target.value}),rows:3,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md"})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-text-secondary",children:"Data de Início"}),g.jsx("input",{type:"date",value:j.startDate,onChange:pe=>B({...j,startDate:pe.target.value}),required:!0,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md"})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-text-secondary",children:"Data de Término"}),g.jsx("input",{type:"date",value:j.endDate,onChange:pe=>B({...j,endDate:pe.target.value}),required:!0,className:"mt-1 w-full px-3 py-2 bg-secondary border border-gray-600 rounded-md"})]})]}),g.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[g.jsx("button",{type:"button",onClick:()=>R(!1),className:"px-4 py-2 rounded-md bg-secondary hover:bg-gray-600",children:"Cancelar"}),g.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md bg-primary text-white hover:bg-blue-700",children:"Salvar"})]})]})]})}),g.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-lg flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[g.jsxs("div",{children:[g.jsx("h1",{className:"text-3xl font-bold text-accent",children:n.name}),g.jsx("p",{className:"text-text-secondary mt-2",children:n.description}),g.jsxs("div",{className:"text-sm text-gray-400 mt-2",children:[g.jsxs("span",{children:["Início: ",new Date(n.startDate).toLocaleDateString()]}),g.jsx("span",{className:"mx-2",children:"|"}),g.jsxs("span",{children:["Término: ",new Date(n.endDate).toLocaleDateString()]})]})]}),g.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[g.jsx("button",{onClick:V,className:"bg-accent/20 text-accent px-3 py-2 rounded-md text-sm hover:bg-accent/30",children:"Editar Projeto"}),g.jsx("button",{onClick:ke,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-md text-sm",children:"Compartilhar"}),g.jsx("button",{onClick:Ae,className:"bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-md text-sm",children:"Excluir"})]})]}),g.jsx("div",{className:"border-b border-gray-700",children:g.jsx("nav",{className:"flex space-x-4",children:g.jsx("button",{onClick:()=>b("tasks"),className:`px-3 py-2 font-medium text-sm rounded-t-md ${y==="tasks"?"border-b-2 border-accent text-accent":"text-text-secondary hover:text-text-primary"}`,children:"Tarefas"})})}),y==="tasks"&&g.jsxs("div",{className:"space-y-8",children:[g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[g.jsx("div",{className:"md:col-span-2 lg:col-span-1",children:g.jsxs("div",{className:"bg-card p-4 rounded-lg shadow-lg h-full flex flex-col justify-center",children:[g.jsx("h3",{className:"text-lg font-semibold mb-4 text-center",children:"Status das Tarefas"}),g.jsx("div",{style:{width:"100%",height:"220px"},children:g.jsx(mk,{width:"100%",height:"100%",children:g.jsxs(yk,{children:[g.jsx(yS,{data:le.distribution,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:"70%",label:!0,children:le.distribution.map((pe,Se)=>g.jsx(Lg,{fill:ZIt[pe.name]},`cell-${Se}`))}),g.jsx(mz,{contentStyle:{backgroundColor:"#1f2937",borderColor:"#374151"}}),g.jsx(wv,{})]})})})]})}),g.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-6",children:[g.jsx(tF,{title:"Total de Tarefas",value:le.total,icon:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),g.jsx(tF,{title:"Tarefas Pendentes",value:le.pending,icon:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),g.jsx(tF,{title:"Tarefas Concluídas",value:le.done,icon:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex justify-between items-center mb-4",children:[g.jsx("h2",{className:"text-2xl font-bold",children:"Quadro de Tarefas"}),g.jsx("button",{onClick:()=>E(!C),className:"bg-accent/20 text-accent px-4 py-2 rounded-md hover:bg-accent/30 text-sm",children:C?"Cancelar":"Nova Tarefa"})]}),C&&g.jsx("div",{className:"bg-card p-4 rounded-lg mb-6",children:g.jsxs("form",{onSubmit:ge,className:"space-y-3",children:[g.jsx("input",{type:"text",placeholder:"Título da tarefa",value:I,onChange:pe=>P(pe.target.value),className:"w-full bg-secondary p-2 rounded-md",required:!0}),g.jsx("textarea",{placeholder:"Descrição...",value:_,onChange:pe=>A(pe.target.value),className:"w-full bg-secondary p-2 rounded-md",rows:2}),g.jsx("div",{className:"flex justify-end",children:g.jsx("button",{type:"submit",className:"bg-primary text-white px-4 py-2 rounded-md",children:"Adicionar"})})]})}),g.jsx(voe,{onDragEnd:qe,children:g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Ty.map(pe=>g.jsx(_oe,{droppableId:pe,children:(Se,Fe)=>g.jsxs("div",{ref:Se.innerRef,...Se.droppableProps,className:`bg-card p-4 rounded-lg min-h-[300px] ${Fe.isDraggingOver?"ring-2 ring-accent":""}`,children:[g.jsx("h3",{className:"text-lg font-bold mb-4",children:pe===er.ToDo?"A Fazer":pe===er.InProgress?"Em Andamento":"Concluído"}),ve[pe].map((ut,Tt)=>g.jsx(Coe,{draggableId:ut.id,index:Tt,children:(pn,qn)=>g.jsx("div",{ref:pn.innerRef,...pn.draggableProps,...pn.dragHandleProps,className:`mb-4 bg-secondary p-3 rounded-md shadow ${qn.isDragging?"ring-2 ring-accent":""}`,style:{...pn.draggableProps.style},children:g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsxs("div",{children:[g.jsx("div",{className:"font-semibold text-text-primary",children:ut.title}),g.jsx("div",{className:"text-sm text-text-secondary",children:ut.description})]}),g.jsx("button",{onClick:()=>x(ut),className:"ml-2 text-accent hover:underline text-xs",children:"Detalhes"})]})})},ut.id)),Se.placeholder]})},pe))})})]})]}),y==="notes"&&g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx("h2",{className:"text-2xl font-bold",children:"Notas do Projeto"}),g.jsx("button",{onClick:()=>L(!D),className:"bg-accent/20 text-accent px-4 py-2 rounded-md hover:bg-accent/30 text-sm",children:D?"Cancelar":"Nova Nota"})]}),D&&g.jsx("div",{className:"bg-card p-4 rounded-lg",children:g.jsxs("form",{onSubmit:_e,className:"space-y-3",children:[g.jsx("textarea",{placeholder:"Escreva sua nota aqui...",value:z,onChange:pe=>$(pe.target.value),className:"w-full bg-secondary p-2 rounded-md",rows:4,required:!0}),g.jsxs("div",{className:"flex justify-end space-x-2",children:[g.jsx("button",{type:"button",onClick:()=>L(!1),className:"px-4 py-2 rounded-md bg-secondary hover:bg-gray-600",children:"Cancelar"}),g.jsx("button",{type:"submit",className:"bg-primary text-white px-4 py-2 rounded-md",children:"Salvar Nota"})]})]})}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[o.map(pe=>g.jsx(NTe,{note:pe,onUpdate:fe,onDelete:je},pe.id)),o.length===0&&!D&&g.jsxs("div",{className:"md:col-span-3 text-center py-16 bg-card rounded-lg",children:[g.jsx("h3",{className:"text-xl font-medium text-text-primary",children:"Nenhuma nota encontrada."}),g.jsx("p",{className:"text-text-secondary mt-2",children:"Crie sua primeira nota para este projeto!"})]})]})]}),y==="files"&&t&&g.jsx(ePt,{projectId:t,files:l,onFileChange:Z})]}),g.jsx(tPt,{notes:o,files:l,onAddNote:async pe=>{if(!n)return;const Se=await _re({content:pe,projectId:n.id});a(Fe=>[Se,...Fe])},onUploadFile:async pe=>{if(!n)return;await Q8(n.id,pe);const Se=await YB(n.id);c(Se)},open:de.open,toggle:de.toggle,onDeleteNote:je,onUpdateNote:fe})]}):g.jsx("div",{className:"text-center p-10",children:"Projeto não encontrado."})},s0=t=>{try{const e=localStorage.getItem(t);return e?new Map(JSON.parse(e)):new Map}catch{return new Map}};s0("mock_users");let DM=s0("mock_projects"),iPt=s0("mock_tasks"),sPt=s0("mock_notes");s0("mock_task_notes");let oPt=s0("mock_project_files"),dv=JSON.parse(localStorage.getItem("mock_currentUser")||"null");const aPt=async t=>(await new Promise(e=>setTimeout(e,500)),Array.from(DM.values()).find(e=>e.shareId===t&&e.isPublic)||null),lPt=async t=>{await new Promise(n=>setTimeout(n,500));const e=DM.get(t);return e?(!e.isPublic&&(!dv||(e.ownerUid,dv.uid)),Array.from(iPt.values()).filter(n=>n.projectId===t)):[]},cPt=async t=>{await new Promise(n=>setTimeout(n,500));const e=DM.get(t);return e?(!e.isPublic&&(!dv||(e.ownerUid,dv.uid)),Array.from(sPt.values()).filter(n=>n.projectId===t).sort((n,r)=>new Date(r.createdAt).getTime()-new Date(n.createdAt).getTime())):[]},uPt=async t=>{await new Promise(n=>setTimeout(n,500));const e=DM.get(t);if(!e)return[];if(!e.isPublic&&(!dv||e.ownerUid!==dv.uid))throw new Error("Permission denied.");return Array.from(oPt.values()).filter(n=>n.projectId===t).sort((n,r)=>new Date(r.uploadedAt).getTime()-new Date(n.uploadedAt).getTime())},kre={[er.ToDo]:"#f97316",[er.InProgress]:"#3b82f6",[er.Done]:"#22c55e"},nF=({title:t,value:e})=>g.jsxs("div",{className:"bg-secondary p-4 rounded-lg",children:[g.jsx("p",{className:"text-sm text-text-secondary",children:t}),g.jsx("p",{className:"text-2xl font-bold text-text-primary",children:e})]}),dPt=()=>{const{shareId:t}=Hre(),[e,n]=S.useState(null),[r,i]=S.useState([]),[s,o]=S.useState([]),[a,l]=S.useState([]),[c,u]=S.useState(!0),[d,h]=S.useState(""),[f,y]=S.useState("tasks"),b=S.useCallback(async()=>{if(t)try{u(!0);const C=await aPt(t);if(C){n(C);const[E,I,P]=await Promise.all([lPt(C.id),cPt(C.id),uPt(C.id)]);i(E),o(I),l(P)}else h("Link de compartilhamento inválido ou o projeto não é mais público.")}catch(C){h(C.message||"Erro ao carregar projeto.")}finally{u(!1)}},[t]);S.useEffect(()=>{b()},[b]);const v=S.useMemo(()=>{const C=r.length,E=r.filter(_=>_.status===er.Done).length,I=C-E,P=Ty.map(_=>({name:_,value:r.filter(A=>A.status===_).length})).filter(_=>_.value>0);return{total:C,done:E,pending:I,distribution:P}},[r]),x=C=>{if(C===0)return"0 Bytes";const E=1024,I=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(C)/Math.log(E));return parseFloat((C/Math.pow(E,P)).toFixed(2))+" "+I[P]};return c?g.jsx("div",{className:"text-center p-10",children:"Carregando visualização pública..."}):d?g.jsx("div",{className:"text-center p-10 text-red-400",children:d}):e?g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-lg",children:[g.jsxs("h1",{className:"text-3xl font-bold text-accent",children:[e.name," (Visualização Pública)"]}),g.jsx("p",{className:"text-text-secondary mt-2",children:e.description}),g.jsxs("div",{className:"text-sm text-gray-400 mt-2",children:[g.jsxs("span",{children:["Início: ",new Date(e.startDate).toLocaleDateString()]}),g.jsx("span",{className:"mx-2",children:"|"}),g.jsxs("span",{children:["Término: ",new Date(e.endDate).toLocaleDateString()]})]})]}),g.jsx("div",{className:"border-b border-gray-700",children:g.jsxs("nav",{className:"flex space-x-4",children:[g.jsx("button",{onClick:()=>y("tasks"),className:`px-3 py-2 font-medium text-sm rounded-t-md ${f==="tasks"?"border-b-2 border-accent text-accent":"text-text-secondary hover:text-text-primary"}`,children:"Tarefas"}),g.jsx("button",{onClick:()=>y("notes"),className:`px-3 py-2 font-medium text-sm rounded-t-md ${f==="notes"?"border-b-2 border-accent text-accent":"text-text-secondary hover:text-text-primary"}`,children:"Notas"}),g.jsx("button",{onClick:()=>y("files"),className:`px-3 py-2 font-medium text-sm rounded-t-md ${f==="files"?"border-b-2 border-accent text-accent":"text-text-secondary hover:text-text-primary"}`,children:"Arquivos"})]})}),f==="tasks"&&g.jsxs("div",{className:"space-y-8",children:[g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[g.jsxs("div",{className:"md:col-span-2 lg:col-span-1 bg-card p-4 rounded-lg shadow-lg",children:[g.jsx("h3",{className:"text-lg font-semibold mb-4 text-center",children:"Status das Tarefas"}),g.jsx(mk,{width:"100%",height:200,children:g.jsxs(yk,{children:[g.jsx(yS,{data:v.distribution,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",label:!0,children:v.distribution.map((C,E)=>g.jsx(Lg,{fill:kre[C.name]},`cell-${E}`))}),g.jsx(mz,{contentStyle:{backgroundColor:"#1f2937",borderColor:"#374151"}}),g.jsx(wv,{})]})})]}),g.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-6",children:[g.jsx(nF,{title:"Total de Tarefas",value:v.total}),g.jsx(nF,{title:"Tarefas Pendentes",value:v.pending}),g.jsx(nF,{title:"Tarefas Concluídas",value:v.done})]})]}),g.jsxs("div",{children:[g.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Tarefas do Projeto"}),g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Ty.map(C=>g.jsxs("div",{className:"bg-card p-4 rounded-lg",children:[g.jsx("h3",{className:"font-bold text-lg mb-4",style:{color:kre[C]},children:C}),g.jsxs("div",{className:"space-y-3",children:[r.filter(E=>E.status===C).map(E=>g.jsxs("div",{className:"bg-secondary p-3 rounded-md",children:[g.jsx("h4",{className:"font-bold",children:E.title}),g.jsx("p",{className:"text-sm text-text-secondary mt-1",children:E.description})]},E.id)),r.filter(E=>E.status===C).length===0&&g.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma tarefa aqui."})]})]},C))})]})]}),f==="notes"&&g.jsxs("div",{className:"space-y-4",children:[g.jsx("h2",{className:"text-2xl font-bold",children:"Notas do Projeto"}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.map(C=>g.jsxs("div",{className:"bg-card p-4 rounded-lg",children:[g.jsx("p",{className:"text-text-secondary whitespace-pre-wrap",children:C.content}),g.jsxs("div",{className:"text-xs text-gray-500 mt-3",children:["Criado em: ",new Date(C.createdAt).toLocaleString()]})]},C.id)),s.length===0&&g.jsx("div",{className:"md:col-span-3 text-center py-16 bg-card rounded-lg",children:g.jsx("h3",{className:"text-xl font-medium text-text-primary",children:"Nenhuma nota para este projeto."})})]})]}),f==="files"&&g.jsxs("div",{className:"space-y-4",children:[g.jsx("h2",{className:"text-2xl font-bold",children:"Arquivos do Projeto"}),g.jsx("div",{className:"bg-card p-4 rounded-lg",children:g.jsxs("ul",{className:"space-y-3",children:[a.map(C=>g.jsxs("li",{className:"flex items-center space-x-4 p-3 bg-secondary rounded-md",children:[g.jsx("span",{children:"📄"})," ",g.jsxs("div",{children:[g.jsx("p",{className:"font-medium text-text-primary",children:C.name}),g.jsxs("p",{className:"text-sm text-text-secondary",children:[x(C.size)," - ",new Date(C.uploadedAt).toLocaleDateString()]})]})]},C.id)),a.length===0&&g.jsx("p",{className:"text-center text-gray-500 py-8",children:"Nenhum arquivo anexado."})]})})]})]}):null},hPt=()=>new Promise((t,e)=>{if(!navigator.geolocation){console.warn("Geolocalização não suportada, usando localização padrão"),t({lat:-26.3044,lon:-48.8461});return}navigator.geolocation.getCurrentPosition(n=>{t({lat:n.coords.latitude,lon:n.coords.longitude})},n=>{console.warn("Erro ao obter localização:",n.message),t({lat:-26.3044,lon:-48.8461})},{timeout:1e4,enableHighAccuracy:!1,maximumAge:3e5})}),fPt=async()=>{try{const{lat:t,lon:e}=await hPt(),n="b41d53fe0d4bbacff0966229fcc687f3",r=`https://api.openweathermap.org/data/2.5/weather?lat=${t}&lon=${e}&appid=${n}&units=metric&lang=pt_br`,i=await fetch(r);if(!i.ok)throw new Error(`Erro na API: ${i.status} ${i.statusText}`);const s=await i.json();return{temperature:Math.round(s.main.temp),feelsLike:Math.round(s.main.feels_like),description:s.weather[0].description,icon:s.weather[0].icon,city:s.name,humidity:s.main.humidity,windSpeed:Math.round(s.wind.speed*3.6)}}catch(t){return console.error("Erro ao buscar dados do clima:",t),pPt()}},pPt=()=>{const e=new Date().getHours();return e>=6&&e<12?{temperature:22,feelsLike:24,description:"ensolarado",icon:"01d",city:"Joinville",humidity:65,windSpeed:12}:e>=12&&e<18?{temperature:25,feelsLike:28,description:"parcialmente nublado",icon:"02d",city:"Joinville",humidity:60,windSpeed:15}:e>=18&&e<22?{temperature:20,feelsLike:22,description:"nublado",icon:"03d",city:"Joinville",humidity:75,windSpeed:8}:{temperature:18,feelsLike:16,description:"névoa",icon:"50d",city:"Joinville",humidity:85,windSpeed:5}},Are=t=>`https://openweathermap.org/img/wn/${t}@2x.png`,Mre=t=>t.charAt(0).toUpperCase()+t.slice(1),Ore=()=>{const[t,e]=S.useState(null),[n,r]=S.useState(!0),[i,s]=S.useState(null),[o,a]=S.useState(!1),[l,c]=S.useState(null),u=S.useCallback(async(f=!1)=>{if(!f&&t&&l){const y=Date.now()-l.getTime(),b=300*1e3;if(y<b){console.log("Usando dados em cache do clima");return}}try{r(!0),s(null);const y=await fPt();e(y),c(new Date)}catch(y){s("Erro ao carregar clima"),console.error("Erro ao buscar clima:",y)}finally{r(!1)}},[t,l]);if(S.useEffect(()=>{u();const f=setInterval(()=>u(),1800*1e3);return()=>clearInterval(f)},[u]),S.useEffect(()=>{const f=y=>{const b=y.target;o&&!b.closest(".weather-widget")&&a(!1)};return o&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[o]),n&&!t)return g.jsxs("div",{className:"weather-widget flex items-center space-x-2 px-3 py-2 bg-secondary/50 rounded-lg",children:[g.jsx("div",{className:"w-4 h-4 border-2 border-accent border-t-transparent rounded-full animate-spin"}),g.jsx("span",{className:"text-sm text-text-secondary",children:"Carregando clima..."})]});if(i&&!t)return g.jsxs("div",{className:"weather-widget flex items-center space-x-2 px-3 py-2 bg-secondary/50 rounded-lg",children:[g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),g.jsx("span",{className:"text-sm text-text-secondary",children:"Clima indisponível"})]});if(!t)return null;const d=f=>{f.stopPropagation(),u(!0)},h=t.feelsLike!==t.temperature;return g.jsxs("div",{className:"weather-widget relative",children:[g.jsxs("button",{onClick:()=>a(!o),className:"flex items-center space-x-2 px-3 py-2 bg-secondary/50 rounded-lg hover:bg-secondary transition-colors duration-200",title:"Clique para ver detalhes do clima",children:[g.jsx("img",{src:Are(t.icon),alt:t.description,className:"w-8 h-8"}),g.jsxs("div",{className:"text-left",children:[g.jsxs("div",{className:"text-sm font-medium text-text-primary",children:[t.temperature,"°C",h&&g.jsxs("span",{className:"text-xs text-text-secondary ml-1",children:["(sente ",t.feelsLike,"°C)"]})]}),g.jsx("div",{className:"text-xs text-text-secondary",children:Mre(t.description)})]}),g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 text-text-secondary transition-transform duration-200 ${o?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&g.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-card border border-gray-600 rounded-lg shadow-lg z-50 p-4",children:[g.jsxs("div",{className:"flex items-center justify-between mb-3",children:[g.jsx("h3",{className:"text-sm font-medium text-text-primary",children:t.city}),g.jsx("button",{onClick:()=>a(!1),className:"text-text-secondary hover:text-text-primary transition-colors",title:"Fechar",children:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[g.jsx("img",{src:Are(t.icon),alt:t.description,className:"w-12 h-12"}),g.jsxs("div",{className:"flex-1",children:[g.jsxs("div",{className:"text-2xl font-bold text-text-primary",children:[t.temperature,"°C"]}),h&&g.jsxs("div",{className:"text-sm text-text-secondary",children:["Sensação: ",t.feelsLike,"°C"]}),g.jsx("div",{className:"text-sm text-text-secondary",children:Mre(t.description)})]})]}),g.jsxs("div",{className:"space-y-2 mb-3",children:[g.jsxs("div",{className:"flex justify-between items-center text-sm",children:[g.jsx("span",{className:"text-text-secondary",children:"Umidade:"}),g.jsxs("span",{className:"text-text-primary",children:[t.humidity,"%"]})]}),g.jsxs("div",{className:"flex justify-between items-center text-sm",children:[g.jsx("span",{className:"text-text-secondary",children:"Vento:"}),g.jsxs("span",{className:"text-text-primary",children:[t.windSpeed," km/h"]})]})]}),l&&g.jsxs("div",{className:"text-xs text-text-secondary mb-3",children:["Atualizado: ",l.toLocaleTimeString()]}),g.jsx("div",{className:"flex space-x-2",children:g.jsxs("button",{onClick:d,className:"flex-1 text-xs bg-accent/20 text-accent hover:bg-accent/30 transition-colors py-2 px-3 rounded-md flex items-center justify-center space-x-1",title:"Atualizar dados do clima",children:[g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),g.jsx("span",{children:"Atualizar"})]})})]})]})},gPt=()=>{const{user:t}=S.useContext(tH),e=Yw();console.log("Header renderizado, usuário:",t?`Logado: ${t.name}`:"Não logado");const n=async()=>{console.log("Botão Sair clicado!");try{console.log("Iniciando logout..."),await $2e(),console.log("Logout realizado com sucesso"),e("/login")}catch(r){console.error("Erro ao fazer logout:",r),alert("Erro ao fazer logout. Tente novamente.")}};return g.jsxs("header",{className:"bg-card shadow-md relative z-50",children:[g.jsxs("div",{className:"container mx-auto px-4 md:px-6 py-4 flex justify-between items-center",children:[g.jsxs(IF,{to:"/",className:"flex items-center space-x-2",children:[g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-accent",viewBox:"0 0 20 20",fill:"currentColor",children:g.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM6.5 9a.5.5 0 000 1h7a.5.5 0 000-1h-7zM7 6.5a.5.5 0 01.5-.5h5a.5.5 0 010 1h-5a.5.5 0 01-.5-.5zM10 12a.5.5 0 01.5.5v2a.5.5 0 01-1 0v-2A.5.5 0 0110 12z",clipRule:"evenodd"})}),g.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Project Manager"})]}),g.jsx("div",{className:"hidden md:block",children:g.jsx(Ore,{})}),g.jsx("nav",{children:t?g.jsxs("div",{className:"flex items-center space-x-4",children:[g.jsxs("span",{className:"text-text-secondary hidden sm:block",children:["Olá, ",t.name]}),g.jsx("button",{onClick:()=>{console.log("Clique detectado no botão Sair!"),n()},className:"bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors cursor-pointer relative z-10",style:{pointerEvents:"auto"},children:"Sair"})]}):g.jsx("div",{className:"flex items-center space-x-2",children:g.jsx(IF,{to:"/login",className:"text-text-secondary hover:text-accent transition-colors",children:"Login"})})})]}),g.jsx("div",{className:"md:hidden border-t border-gray-600 bg-secondary/30",children:g.jsx("div",{className:"container mx-auto px-4 py-2 flex justify-center",children:g.jsx(Ore,{})})})]})},tH=S.createContext({user:null,loading:!0}),mPt=()=>{const[t,e]=S.useState(null),[n,r]=S.useState(!0),i=S.useCallback(s=>{console.log("Estado de autenticação alterado:",s?`Usuário: ${s.name}`:"Usuário deslogado"),e(s),r(!1)},[]);return S.useEffect(()=>{console.log("Configurando listener de autenticação...");const s=B2e(i);return()=>{console.log("Removendo listener de autenticação..."),s()}},[i]),n?g.jsx("div",{className:"flex items-center justify-center h-screen bg-background",children:g.jsx("div",{className:"w-16 h-16 border-4 border-t-transparent border-accent rounded-full animate-spin"})}):g.jsx(tH.Provider,{value:{user:t,loading:n},children:g.jsx(y_e,{children:g.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[g.jsx(gPt,{}),g.jsx("main",{className:"flex-grow container mx-auto p-4 md:p-6",children:g.jsxs(u_e,{children:[g.jsx(Um,{path:"/login",element:t?g.jsx(hC,{to:"/dashboard"}):g.jsx(z2e,{})}),g.jsx(Um,{path:"/dashboard",element:t?g.jsx($It,{}):g.jsx(hC,{to:"/login"})}),g.jsx(Um,{path:"/project/:projectId",element:t?g.jsx(rPt,{}):g.jsx(hC,{to:"/login"})}),g.jsx(Um,{path:"/share/:shareId",element:g.jsx(dPt,{})}),g.jsx(Um,{path:"/",element:g.jsx(hC,{to:t?"/dashboard":"/login"})})]})})]})})})},jTe=document.getElementById("root");if(!jTe)throw new Error("Could not find root element to mount to");const yPt=bPe.createRoot(jTe);yPt.render(g.jsx($e.StrictMode,{children:g.jsx(mPt,{})}));
